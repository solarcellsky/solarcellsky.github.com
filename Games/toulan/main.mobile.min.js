var AssetAdapter = function() {
    function e() {}
    var t = (__define, e),
    n = t.prototype;
    return n.getAsset = function(e, t, n) {
        function s(s) {
            t.call(n, s, e)
        }
        if (RES.hasRes(e)) {
            var i = RES.getRes(e);
            i ? s(i) : RES.getResAsync(e, s, this)
        } else RES.getResByUrl(e, s, this, RES.ResourceItem.TYPE_IMAGE)
    },
    e
} ();
egret.registerClass(AssetAdapter, "AssetAdapter", ["eui.IAssetAdapter"]);
var BaseScene = function(e) {
    function t(t) {
        e.call(this),
        this.inited = !1,
        this.percentWidth = 100,
        this.percentHeight = 100,
        this.touchEnabled = !1,
        this.addEventListener(eui.UIEvent.CREATION_COMPLETE, this.componentCreated, this),
        this.skinName = t
    }
    __extends(t, e);
    var n = (__define, t),
    s = n.prototype;
    return s.componentCreated = function() {
        this.removeEventListener(eui.UIEvent.CREATION_COMPLETE, this.componentCreated, this),
        this.inited = !0
    },
    s.onEnable = function() {},
    s.onRemove = function() {},
    s.onDestroy = function() {},
    t
} (eui.Component);
egret.registerClass(BaseScene, "BaseScene");
var BaseUI = function(e) {
    function t(t) {
        e.call(this),
        this.inited = !1,
        this.addEventListener(eui.UIEvent.CREATION_COMPLETE, this.componentCreated, this),
        this.skinName = t
    }
    __extends(t, e);
    var n = (__define, t),
    s = n.prototype;
    return s.componentCreated = function() {
        this.removeEventListener(eui.UIEvent.CREATION_COMPLETE, this.componentCreated, this),
        this.inited = !0
    },
    t
} (eui.Component);
egret.registerClass(BaseUI, "BaseUI");
var HttpUtil = function() {
    function e() {
        this.request = new egret.HttpRequest,
        this.request.responseType = egret.HttpResponseType.TEXT,
        this.request.addEventListener(egret.Event.COMPLETE, this.onPostComplete, this),
        this.request.addEventListener(egret.IOErrorEvent.IO_ERROR, this.onPostIOError, this)
    }
    var t = (__define, e),
    n = t.prototype;
    return n.send = function(e, t, n, s) {
        this.thisObject = s,
        this.request.open(e, t),
        this.request.setRequestHeader("Content-type", "application/x-www-form-urlencoded"),
        "" != n ? this.request.send(n) : this.request.send()
    },
    n.onPostComplete = function(e) {
        this.completeHandler && this.completeHandler.call(this.thisObject, this.request.response)
    },
    n.onPostIOError = function(e) {
        this.errorHandler && this.errorHandler.call(this.thisObject, e)
    },
    e
} ();
egret.registerClass(HttpUtil, "HttpUtil");
var LayerManager = function() {
    function e() {
        this.tweenTime = 500
    }
    var t = (__define, e),
    n = t.prototype;
    return n.initialize = function(e) {
        this.main = e,
        this.sceneLayer = new eui.Group,
        this.sceneLayer.percentWidth = 100,
        this.sceneLayer.percentHeight = 100,
        this.main.addChild(this.sceneLayer),
        this.popLayer = new eui.Group,
        this.popLayer.percentWidth = 100,
        this.popLayer.percentHeight = 100,
        this.popLayer.touchEnabled = !1,
        this.popLayer.touchThrough = !0,
        this.main.addChild(this.popLayer)
    },
    n.runScene = function(e, t) {
        void 0 === t && (t = !1),
        null != this.curScene && this.curScene && (this.sceneLayer.removeChild(this.curScene), this.curScene.onRemove(), t && this.curScene.onDestroy()),
        this.sceneLayer.addChild(e),
        e.inited && e.onEnable(),
        this.curScene = e
    },
    e.getInstance = function() {
        return null == this.instance && (this.instance = new e),
        this.instance
    },
    e
} ();
egret.registerClass(LayerManager, "LayerManager");
var LoadManager = function() {
    function e() {
        this.loadComplete = new Object,
        this.loadError = new Object,
        this.loadProgress = new Object,
        this.thisObject = new Object
    }
    var t = (__define, e),
    n = t.prototype;
    return e.getInstance = function() {
        return null == this.instance && (this.instance = new e),
        this.instance
    },
    n.loadGroup = function(e, t, n, s, i) {
        void 0 === n && (n = null),
        void 0 === s && (s = null),
        void 0 === i && (i = null),
        this.loadComplete[e] = n,
        this.loadError[e] = i,
        this.loadProgress[e] = s,
        this.thisObject[e] = t,
        RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE, this.onResourceLoadComplete, this),
        RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR, this.onResourceLoadError, this),
        RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS, this.onResourceProgress, this),
        RES.loadGroup(e)
    },
    n.onResourceLoadComplete = function(e) {
        var t = e.groupName;
        RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE, this.onResourceLoadComplete, this),
        RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR, this.onResourceLoadError, this),
        RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS, this.onResourceProgress, this);
        var n = this.loadComplete[t];
        null != n && n.call(this.thisObject[t], e),
        this.clearCallBack(t)
    },
    n.onResourceLoadError = function(e) {
        console.warn("Group:" + e.groupName + " has failed to load");
        var t = this.loadError[e.groupName];
        null != t && t.call(this.thisObject[e.groupName], e),
        this.clearCallBack(e.groupName)
    },
    n.onResourceProgress = function(e) {
        var t = this.loadProgress[e.groupName];
        null != t && t.call(this.thisObject[e.groupName], e)
    },
    n.clearCallBack = function(e) {
        this.loadComplete[e] = null,
        this.loadError[e] = null,
        this.loadProgress[e] = null
    },
    e
} ();
egret.registerClass(LoadManager, "LoadManager");
var ObjectPool = function() {
    function e(e) {
        this.className = e,
        this.list = []
    }
    var t = (__define, e),
    n = t.prototype;
    return n.getObject = function() {
        if (this.list.length > 0) return this.list.shift();
        var e = egret.getDefinitionByName(this.className);
        return new e
    },
    n.returnObject = function(e) {
        this.list.push(e)
    },
    e.getPool = function(t, n) {
        if (void 0 === n && (n = 0), !e.pool[t] && (e.pool[t] = new e(t), 0 != n)) for (var s = egret.getDefinitionByName(t), i = e.pool[t], o = 0; n > o; o++) i.returnObject(new s);
        return e.pool[t]
    },
    e.pool = {},
    e
} ();
egret.registerClass(ObjectPool, "ObjectPool");
var GameConst = function() {
    function e() {}
    var t = (__define, e);
    t.prototype;
    return e.isDebug = !1,
    e
} ();
egret.registerClass(GameConst, "GameConst");
var GameManager = function() {
    function e() {
        this.homeScene = new HomeScene,
        this.messageBox = new MessageBox
    }
    var t = (__define, e),
    n = t.prototype;
    return n.startup = function(e) {
        GameConst.stage = e.stage,
        LayerManager.getInstance().initialize(e),
        LayerManager.getInstance().runScene(this.homeScene)
    },
    e.getInstance = function() {
        return null == this.instance && (this.instance = new e),
        this.instance
    },
    e
} ();
egret.registerClass(GameManager, "GameManager");
var ClientSocket = function() {
    function e() {}
    var t = (__define, e),
    n = t.prototype;
    return e.getInstance = function() {
        return null == this.instance && (this.instance = new e),
        this.instance
    },
    n.isConnected = function() {
        return this.socket && this.socket.connected ? !0 : !1
    },
    n.closeSocket = function() {
        egret.log("主动断开连接"),
        this.socket.disconnect()
    },
    n.startConnect = function() {
        this.socket = io.connect(window.server, {
            reconnection: !1,
            "force new connection": !0
        });
        var e = this;
        this.socket.on("connect",
        function() {
            egret.log("connect success"),
            e.homeScene.onConnect()
        }),
        this.socket.on("error",
        function(t) {
            egret.log("socket error"),
            e.homeScene.onError(t)
        }),
        this.socket.on("disconnect",
        function() {
            egret.log("socket disconnect"),
            e.homeScene.onDisconnect()
        }),
        this.socket.on("gameOver",
        function(t) {
            e.homeScene.revGameOver(t)
        })
    },
    n.sendMessage = function(e, t, n, s) {
        void 0 === t && (t = null),
        void 0 === n && (n = null),
        void 0 === s && (s = null),
        this.socket && this.socket.connected && this.socket.emit(e, t,
        function(e) {
            n && s && n.call(s, e)
        })
    },
    e
} ();
egret.registerClass(ClientSocket, "ClientSocket");
var HomeScene = function(e) {
    function t() {
        e.call(this, "HomeSceneSkin"),
        this.resultPanel = new ResultPanel,
        this.countDownTimer = new egret.Timer(650),
        this.countDownLimit = 3
    }
    __extends(t, e);
    var n = (__define, t),
    s = n.prototype;
    return s.componentCreated = function() {
        e.prototype.componentCreated.call(this),
        this.ballX = this.ball.x,
        this.ballY = this.ball.y,
        this.socket = ClientSocket.getInstance(),
        this.socket.homeScene = this
    },
    s.onEnable = function() {
        this.socket.startConnect(),
        this.introduce(),
        GameConst.isDebug && this.revLogin({
            bSuccess: !0,
            msg: ""
        })
    },
    s.onRemove = function() {},
    s.startGame = function() {
        this.configListeners(),
        GameConst.isDebug && this.revGameOver({
            score: 100
        })
    },
    s.gameOver = function() {
        egret.Tween.removeTweens(this.ball),
        this.ball.x = this.ballX,
        this.ball.y = this.ballY,
        this.deConfigListeners()
    },
    s.configListeners = function() {
        this.ball.addEventListener(egret.TouchEvent.TOUCH_BEGIN, this.onTouchBegin, this)
    },
    s.deConfigListeners = function() {
        this.ball.removeEventListener(egret.TouchEvent.TOUCH_BEGIN, this.onTouchBegin, this),
        this.removeEventListener(egret.TouchEvent.TOUCH_END, this.onTouchEnd, this)
    },
    s.onTouchBegin = function(e) {
        this.addEventListener(egret.TouchEvent.TOUCH_END, this.onTouchEnd, this),
        this.startX = e.stageX,
        this.startY = e.stageY
    },
    s.onTouchEnd = function(e) {
        if (this.removeEventListener(egret.TouchEvent.TOUCH_END, this.onTouchEnd, this), this.endX = e.stageX, this.endY = e.stageY, this.startY - this.endY > 25) {
            var t = Math.atan2(this.endY - this.startY, this.endX - this.startX);
            this.deConfigListeners();
            var n = this,
            s = 1e3 * Math.cos(t),
            i = 1e3 * Math.sin(t);
            egret.Tween.get(this.ball).to({
                x: this.ballX + s,
                y: this.ballY + i
            },
            300).call(function() {
                n.configListeners(),
                n.ball.x = n.ballX,
                n.ball.y = n.ballY
            }),
            this.sendShoot(t)
        }
    },
    s.introduce = function() {
        this.tipLabel.visible = !0,
        this.hand.visible = !0,
        this.ball.visible = !0;
        var e = this.hand.y;
        egret.Tween.get(this.hand, {
            loop: !0
        }).to({
            y: e - 50
        },
        500).to({
            y: e
        },
        500),
        GameManager.getInstance().messageBox.showMessage("在wifi下游戏更流畅")
    },
    s.startCountDown = function() {
        this.countDownTimer.addEventListener(egret.TimerEvent.TIMER, this.onCountDownHandler, this),
        this.countDownTimer.reset(),
        this.countDownTimer.start();
        var e = GameManager.getInstance().messageBox;
        e.showMessage(this.countDownLimit + "", 50)
    },
    s.onCountDownHandler = function() {
        var e = this.countDownLimit - this.countDownTimer.currentCount;
        e > 0 ? GameManager.getInstance().messageBox.showMessage(e + "", 50) : (this.countDownTimer.removeEventListener(egret.TimerEvent.TIMER, this.onCountDownHandler, this), this.countDownTimer.stop(), egret.Tween.removeTweens(this.hand), this.hand.visible = !1, GameManager.getInstance().messageBox.hide(), this.startGame())
    },
    s.onConnect = function() {
        this.sendLogin()
    },
    s.onError = function(e) {
        GameManager.getInstance().messageBox.showMessage("连接服务器失败")
    },
    s.onDisconnect = function() {
        this.resultPanel.parent || GameManager.getInstance().messageBox.showMessage("网页连接已断开")
    },
    s.sendLogin = function() {
        var e = {
            rid: egret.getOption("rid")
        };
        this.socket.sendMessage("login", e, this.revLogin, this),
        egret.log("发送登录请求:" + e.rid)
    },
    s.sendShoot = function(e) {
        this.socket.sendMessage("shoot", {
            angle: parseFloat(e.toFixed(2))
        }),
        egret.log("shoot angle:", parseFloat(e.toFixed(2)))
    },
    s.revLogin = function(e) {
        var t = e.bSuccess,
        n = e.msg;
        egret.log("接收登录结果:", t, n),
        t ? this.startCountDown() : GameManager.getInstance().messageBox.showMessage(n)
    },
    s.revGameOver = function(e) {
        var t = e.score;
        egret.log("接收游戏结束:", t),
        this.gameOver(),
        this.resultPanel.showScore(t),
        this.resultPanel.x = (GameConst.stage.stageWidth - this.resultPanel.width) / 2,
        this.resultPanel.y = (GameConst.stage.stageHeight - this.resultPanel.height) / 2,
        this.addChild(this.resultPanel)
    },
    t
} (BaseScene);
egret.registerClass(HomeScene, "HomeScene");
var MessageBox = function(e) {
    function t() {
        e.call(this, "MessageBoxSkin")
    }
    __extends(t, e);
    var n = (__define, t),
    s = n.prototype;
    return s.componentCreated = function() {
        e.prototype.componentCreated.call(this)
    },
    s.showMessage = function(e, t) {
        void 0 === t && (t = 25),
        this.msgLabel.size = t,
        this.x = (GameConst.stage.stageWidth - this.width) / 2,
        this.y = (GameConst.stage.stageHeight - this.height) / 2,
        LayerManager.getInstance().popLayer.addChild(this),
        this.msgLabel.text = e
    },
    s.hide = function() {
        this.parent && this.parent.removeChild(this)
    },
    t
} (BaseUI);
egret.registerClass(MessageBox, "MessageBox");
var ResultPanel = function(e) {
    function t() {
        e.call(this, "ResultPanelSkin")
    }
    __extends(t, e);
    var n = (__define, t),
    s = n.prototype;
    return s.componentCreated = function() {
        e.prototype.componentCreated.call(this)
    },
    s.showScore = function(e) {
        this.scoreLabel.text = e.toString()
    },
    t
} (BaseUI);
egret.registerClass(ResultPanel, "ResultPanel");
var Main = function(e) {
    function t() {
        e.apply(this, arguments)
    }
    __extends(t, e);
    var n = (__define, t),
    s = n.prototype;
    return s.createChildren = function() {
        e.prototype.createChildren.call(this);
        var t = new AssetAdapter;
        this.stage.registerImplementation("eui.IAssetAdapter", t),
        this.stage.registerImplementation("eui.IThemeAdapter", new ThemeAdapter),
        RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE, this.onConfigComplete, this),
        RES.loadConfig("resource/default.mobile.res.json", "resource/")
    },
    s.onConfigComplete = function(e) {
        RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE, this.onConfigComplete, this);
        var t = new eui.Theme("resource/default.mobile.thm.json", this.stage);
        t.addEventListener(eui.UIEvent.COMPLETE, this.onThemeLoadComplete, this)
    },
    s.onThemeLoadComplete = function() {
        LoadManager.getInstance().loadGroup("preload", this, this.onPreloadComplete)
    },
    s.onPreloadComplete = function(e) {
        GameManager.getInstance().startup(this)
    },
    t
} (eui.UILayer);
egret.registerClass(Main, "Main");
var ThemeAdapter = function() {
    function e() {}
    var t = (__define, e),
    n = t.prototype;
    return n.getTheme = function(e, t, n, s) {
        function i(e) {
            t.call(s, e)
        }
        function o(t) {
            t.resItem.url == e && (RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR, o, null), n.call(s))
        }
        RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR, o, null),
        RES.getResByUrl(e, i, this, RES.ResourceItem.TYPE_TEXT)
    },
    e
} ();
egret.registerClass(ThemeAdapter, "ThemeAdapter", ["eui.IThemeAdapter"]);