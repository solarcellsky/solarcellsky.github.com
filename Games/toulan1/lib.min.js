function BlockData(t,e){this.selMenuHander=t,this.target=e}function BlockCCControlData(t,e,i){this.selCCControlHandler=t,this.target=e,this.controlEvents=i}var cc=cc||{};if(cc._tmp=cc._tmp||{},cc._LogInfos={},_p=window,_p=Object.prototype,delete window._p,cc.newElement=function(t){return document.createElement(t)},cc._addEventListener=function(t,e,i,n){t.addEventListener(e,i,n)},cc._isNodeJs="undefined"!=typeof require&&require("fs"),cc.each=function(t,e,i){if(t)if(t instanceof Array)for(var n=0,r=t.length;r>n&&!1!==e.call(i,t[n],n);n++);else for(n in t)if(!1===e.call(i,t[n],n))break},cc.extend=function(t){var e=2<=arguments.length?Array.prototype.slice.call(arguments,1):[];return cc.each(e,function(e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}),t},cc.isFunction=function(t){return"function"==typeof t},cc.isNumber=function(t){return"number"==typeof t||"[object Number]"===Object.prototype.toString.call(t)},cc.isString=function(t){return"string"==typeof t||"[object String]"===Object.prototype.toString.call(t)},cc.isArray=function(t){return Array.isArray(t)||"object"==typeof t&&"[object Array]"===Object.prototype.toString.call(t)},cc.isUndefined=function(t){return"undefined"==typeof t},cc.isObject=function(t){return"object"==typeof t&&"[object Object]"===Object.prototype.toString.call(t)},cc.isCrossOrigin=function(t){if(!t)return cc.log("invalid URL"),!1;var e=t.indexOf("://");return-1===e?!1:(e=t.indexOf("/",e+3),(-1===e?t:t.substring(0,e))!==location.origin)},cc.AsyncPool=function(t,e,i,n,r){var o=this;o._srcObj=t,o._limit=e,o._pool=[],o._iterator=i,o._iteratorTarget=r,o._onEnd=n,o._onEndTarget=r,o._results=t instanceof Array?[]:{},o._isErr=!1,cc.each(t,function(t,e){o._pool.push({index:e,value:t})}),o.size=o._pool.length,o.finishedSize=0,o._workingSize=0,o._limit=o._limit||o.size,o.onIterator=function(t,e){o._iterator=t,o._iteratorTarget=e},o.onEnd=function(t,e){o._onEnd=t,o._onEndTarget=e},o._handleItem=function(){var t=this;if(!(0===t._pool.length||t._workingSize>=t._limit)){var e=t._pool.shift(),i=e.value,n=e.index;t._workingSize++,t._iterator.call(t._iteratorTarget,i,n,function(e){if(!t._isErr)if(t.finishedSize++,t._workingSize--,e)t._isErr=!0,t._onEnd&&t._onEnd.call(t._onEndTarget,e);else{var i=Array.prototype.slice.call(arguments,1);t._results[this.index]=i[0],t.finishedSize===t.size?t._onEnd&&t._onEnd.call(t._onEndTarget,null,t._results):t._handleItem()}}.bind(e),t)}},o.flow=function(){if(0===this._pool.length)this._onEnd&&this._onEnd.call(this._onEndTarget,null,[]);else for(var t=0;t<this._limit;t++)this._handleItem()}},cc.async={series:function(t,e,i){return t=new cc.AsyncPool(t,1,function(t,e,n){t.call(i,n)},e,i),t.flow(),t},parallel:function(t,e,i){return t=new cc.AsyncPool(t,0,function(t,e,n){t.call(i,n)},e,i),t.flow(),t},waterfall:function(t,e,i){var n=[],r=[null],o=new cc.AsyncPool(t,1,function(e,o,s){n.push(function(){n=Array.prototype.slice.call(arguments,1),t.length-1===o&&(r=r.concat(n)),s.apply(null,arguments)}),e.apply(i,n)},function(t){if(e){if(t)return e.call(i,t);e.apply(i,r)}});return o.flow(),o},map:function(t,e,i,n){var r=e;return"object"==typeof e&&(i=e.cb,n=e.iteratorTarget,r=e.iterator),t=new cc.AsyncPool(t,0,r,i,n),t.flow(),t},mapLimit:function(t,e,i,n,r){return t=new cc.AsyncPool(t,e,i,n,r),t.flow(),t}},cc.path={join:function(){for(var t=arguments.length,e="",i=0;t>i;i++)e=(e+(""===e?"":"/")+arguments[i]).replace(/(\/|\\\\)$/,"");return e},extname:function(t){return(t=/(\.[^\.\/\?\\]*)(\?.*)?$/.exec(t))?t[1]:null},mainFileName:function(t){if(t){var e=t.lastIndexOf(".");if(-1!==e)return t.substring(0,e)}return t},basename:function(t,e){var i=t.indexOf("?");return i>0&&(t=t.substring(0,i)),(i=/(\/|\\\\)([^(\/|\\\\)]+)$/g.exec(t.replace(/(\/|\\\\)$/,"")))?(i=i[2],e&&t.substring(t.length-e.length).toLowerCase()===e.toLowerCase()?i.substring(0,i.length-e.length):i):null},dirname:function(t){return t.replace(/((.*)(\/|\\|\\\\))?(.*?\..*$)?/,"$2")},changeExtname:function(t,e){e=e||"";var i=t.indexOf("?"),n="";return i>0&&(n=t.substring(i),t=t.substring(0,i)),i=t.lastIndexOf("."),0>i?t+e+n:t.substring(0,i)+e+n},changeBasename:function(t,e,i){if(0===e.indexOf("."))return this.changeExtname(t,e);var n=t.indexOf("?"),r="";return i=i?this.extname(t):"",n>0&&(r=t.substring(n),t=t.substring(0,n)),n=t.lastIndexOf("/"),t.substring(0,0>=n?0:n+1)+e+i+r}},cc.loader={_jsCache:{},_register:{},_langPathCache:{},_aliases:{},resPath:"",audioPath:"",cache:{},getXMLHttpRequest:function(){return window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP")},_getArgs4Js:function(t){var e=t[0],i=t[1],n=t[2],r=["",null,null];if(1===t.length)r[1]=e instanceof Array?e:[e];else if(2===t.length)"function"==typeof i?(r[1]=e instanceof Array?e:[e],r[2]=i):(r[0]=e||"",r[1]=i instanceof Array?i:[i]);else{if(3!==t.length)throw"arguments error to load js!";r[0]=e||"",r[1]=i instanceof Array?i:[i],r[2]=n}return r},loadJs:function(){var t=this,e=t._jsCache,i=t._getArgs4Js(arguments),n=i[0],r=i[1],i=i[2];-1<navigator.userAgent.indexOf("Trident/5")?t._loadJs4Dependency(n,r,0,i):cc.async.map(r,function(i,r,o){return i=cc.path.join(n,i),e[i]?o(null):void t._createScript(i,!1,o)},i)},loadJsWithImg:function(){var t=this._loadJsImg(),e=this._getArgs4Js(arguments);this.loadJs(e[0],e[1],function(i){if(i)throw i;t.parentNode.removeChild(t),e[2]&&e[2]()})},_createScript:function(t,e,i){var n=document,r=cc.newElement("script");r.async=e,this._jsCache[t]=!0,r.src=cc.game.config.noCache&&"string"==typeof t?this._noCacheRex.test(t)?t+"&_t="+(new Date-0):t+"?_t="+(new Date-0):t,cc._addEventListener(r,"load",function(){r.parentNode.removeChild(r),this.removeEventListener("load",arguments.callee,!1),i()},!1),cc._addEventListener(r,"error",function(){r.parentNode.removeChild(r),i("Load "+t+" failed!")},!1),n.body.appendChild(r)},_loadJs4Dependency:function(t,e,i,n){if(i>=e.length)n&&n();else{var r=this;r._createScript(cc.path.join(t,e[i]),!1,function(o){return o?n(o):void r._loadJs4Dependency(t,e,i+1,n)})}},_loadJsImg:function(){var t=document,e=t.getElementById("cocos2d_loadJsImg");if(!e){e=cc.newElement("img"),cc._loadingImage&&(e.src=cc._loadingImage),t=t.getElementById(cc.game.config.id),t.style.backgroundColor="black",t.parentNode.appendChild(e);var i=getComputedStyle?getComputedStyle(t):t.currentStyle;i||(i={width:t.width,height:t.height}),e.style.left=t.offsetLeft+(parseFloat(i.width)-e.width)/2+"px",e.style.top=t.offsetTop+(parseFloat(i.height)-e.height)/2+"px",e.style.position="absolute"}return e},loadTxt:function(t,e){if(cc._isNodeJs)require("fs").readFile(t,function(t,i){t?e(t):e(null,i.toString())});else{var i=this.getXMLHttpRequest(),n="load "+t+" failed!";i.open("GET",t,!0),/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)?(i.setRequestHeader("Accept-Charset","utf-8"),i.onreadystatechange=function(){4===i.readyState&&(200===i.status?e(null,i.responseText):e(n))}):(i.overrideMimeType&&i.overrideMimeType("text/plain; charset=utf-8"),i.onload=function(){4===i.readyState&&(200===i.status?e(null,i.responseText):e(n))}),i.send(null)}},_loadTxtSync:function(t){if(cc._isNodeJs)return require("fs").readFileSync(t).toString();var e=this.getXMLHttpRequest();return e.open("GET",t,!1),/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)?e.setRequestHeader("Accept-Charset","utf-8"):e.overrideMimeType&&e.overrideMimeType("text/plain; charset=utf-8"),e.send(null),4===!e.readyState||200!==e.status?null:e.responseText},loadCsb:function(t,e){var i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="arraybuffer",i.onload=function(){var n=i.response;n&&(window.msg=n),4===i.readyState&&(200===i.status?e(null,i.response):e("load "+t+" failed!"))},i.send(null)},loadJson:function(t,e){this.loadTxt(t,function(i,n){if(i)e(i);else{try{var r=JSON.parse(n)}catch(o){throw"parse json ["+t+"] failed : "+o}e(null,r)}})},_checkIsImageURL:function(t){return null!=/(\.png)|(\.jpg)|(\.bmp)|(\.jpeg)|(\.gif)/.exec(t)},loadImg:function(t,e,i){var n={isCrossOrigin:!0};void 0!==i?n.isCrossOrigin=null===e.isCrossOrigin?n.isCrossOrigin:e.isCrossOrigin:void 0!==e&&(i=e);var r=this.getRes(t);if(r)return i&&i(null,r),r;r=new Image,n.isCrossOrigin&&"file://"!==location.origin&&(r.crossOrigin="Anonymous");var o=function(){this.removeEventListener("load",o,!1),this.removeEventListener("error",c,!1),i&&i(null,r)},s=this,c=function(){this.removeEventListener("error",c,!1),r.crossOrigin&&"anonymous"===r.crossOrigin.toLowerCase()?(n.isCrossOrigin=!1,s.release(t),cc.loader.loadImg(t,n,i)):"function"==typeof i&&i("load image failed")};return cc._addEventListener(r,"load",o),cc._addEventListener(r,"error",c),r.src=t,r},_loadResIterator:function(t,e,i){var n=this,r=null,o=t.type;return o?(o="."+o.toLowerCase(),r=t.src?t.src:t.name+o):(r=t,o=cc.path.extname(r)),(e=n.getRes(r))?i(null,e):(e=null,o&&(e=n._register[o.toLowerCase()]),e?(o=r,cc._urlRegExp.test(r)||(o=e.getBasePath?e.getBasePath():n.resPath,o=n.getUrl(o,r)),cc.game.config.noCache&&"string"==typeof o&&(o=n._noCacheRex.test(o)?o+("&_t="+(new Date-0)):o+("?_t="+(new Date-0))),void e.load(o,r,t,function(t,e){t?(cc.log(t),n.cache[r]=null,delete n.cache[r],i()):(n.cache[r]=e,i(null,e))})):(cc.error("loader for ["+o+"] not exists!"),i()))},_noCacheRex:/\?/,getUrl:function(t,e){var i=this._langPathCache,n=cc.path;if(void 0!==t&&void 0===e){e=t;var r=n.extname(e),r=r?r.toLowerCase():"";t=(r=this._register[r])&&r.getBasePath?r.getBasePath():this.resPath}if(e=cc.path.join(t||"",e),e.match(/[\/(\\\\)]lang[\/(\\\\)]/i)){if(i[e])return i[e];n=n.extname(e)||"",e=i[e]=e.substring(0,e.length-n.length)+"_"+cc.sys.language+n}return e},load:function(t,e,i){var n=this,r=arguments.length;if(0===r)throw"arguments error!";return 3===r?"function"==typeof e&&(e="function"==typeof i?{trigger:e,cb:i}:{cb:e,cbTarget:i}):2===r?"function"==typeof e&&(e={cb:e}):1===r&&(e={}),t instanceof Array||(t=[t]),r=new cc.AsyncPool(t,0,function(t,i,r,o){n._loadResIterator(t,i,function(t){if(t)return r(t);var i=Array.prototype.slice.call(arguments,1);e.trigger&&e.trigger.call(e.triggerTarget,i[0],o.size,o.finishedSize),r(null,i[0])})},e.cb,e.cbTarget),r.flow(),r},_handleAliases:function(t,e){var i,n=this._aliases,r=[];for(i in t){var o=t[i];n[i]=o,r.push(o)}this.load(r,e)},loadAliases:function(t,e){var i=this,n=i.getRes(t);n?i._handleAliases(n.filenames,e):i.load(t,function(t,n){i._handleAliases(n[0].filenames,e)})},register:function(t,e){if(t&&e){if("string"==typeof t)return this._register[t.trim().toLowerCase()]=e;for(var i=0,n=t.length;n>i;i++)this._register["."+t[i].trim().toLowerCase()]=e}},getRes:function(t){return this.cache[t]||this.cache[this._aliases[t]]},release:function(t){var e=this.cache,i=this._aliases;delete e[t],delete e[i[t]],delete i[t]},releaseAll:function(){var t,e=this.cache,i=this._aliases;for(t in e)delete e[t];for(t in i)delete i[t]}},cc.formatStr=function(){var t=arguments,e=t.length;if(1>e)return"";var i=t[0],n=!0;"object"==typeof i&&(n=!1);for(var r=1;e>r;++r){var o=t[r];if(n)for(;;){var s=null;if("number"==typeof o&&(s=i.match(/(%d)|(%s)/))){i=i.replace(/(%d)|(%s)/,o);break}i=(s=i.match(/%s/))?i.replace(/%s/,o):i+("    "+o);break}else i+="    "+o}return i},function(){var t,e,i=window;cc.isUndefined(document.hidden)?cc.isUndefined(document.mozHidden)?cc.isUndefined(document.msHidden)?cc.isUndefined(document.webkitHidden)||(t="webkitHidden",e="webkitvisibilitychange"):(t="msHidden",e="msvisibilitychange"):(t="mozHidden",e="mozvisibilitychange"):(t="hidden",e="visibilitychange");var n=function(){cc.eventManager&&cc.game._eventHide&&cc.eventManager.dispatchEvent(cc.game._eventHide)},r=function(){cc.eventManager&&cc.game._eventShow&&cc.eventManager.dispatchEvent(cc.game._eventShow),cc.game._intervalId&&(window.cancelAnimationFrame(cc.game._intervalId),cc.game._runMainLoop())};t?cc._addEventListener(document,e,function(){document[t]?n():r()},!1):(cc._addEventListener(i,"blur",n,!1),cc._addEventListener(i,"focus",r,!1)),-1<navigator.userAgent.indexOf("MicroMessenger")&&(i.onfocus=function(){r()}),"onpageshow"in window&&"onpagehide"in window&&(cc._addEventListener(i,"pagehide",n,!1),cc._addEventListener(i,"pageshow",r,!1)),e=i=null}(),cc.log=cc.warn=cc.error=cc.assert=function(){},cc.create3DContext=function(t,e){for(var i=["webgl","experimental-webgl","webkit-3d","moz-webgl"],n=null,r=0;r<i.length;++r){try{n=t.getContext(i[r],e)}catch(o){}if(n)break}return n},cc._initSys=function(t,e){cc._RENDER_TYPE_CANVAS=0,cc._RENDER_TYPE_WEBGL=1,cc.sys={};var i=cc.sys;i.LANGUAGE_ENGLISH="en",i.LANGUAGE_CHINESE="zh",i.LANGUAGE_FRENCH="fr",i.LANGUAGE_ITALIAN="it",i.LANGUAGE_GERMAN="de",i.LANGUAGE_SPANISH="es",i.LANGUAGE_DUTCH="du",i.LANGUAGE_RUSSIAN="ru",i.LANGUAGE_KOREAN="ko",i.LANGUAGE_JAPANESE="ja",i.LANGUAGE_HUNGARIAN="hu",i.LANGUAGE_PORTUGUESE="pt",i.LANGUAGE_ARABIC="ar",i.LANGUAGE_NORWEGIAN="no",i.LANGUAGE_POLISH="pl",i.OS_IOS="iOS",i.OS_ANDROID="Android",i.OS_WINDOWS="Windows",i.OS_MARMALADE="Marmalade",i.OS_LINUX="Linux",i.OS_BADA="Bada",i.OS_BLACKBERRY="Blackberry",i.OS_OSX="OS X",i.OS_WP8="WP8",i.OS_WINRT="WINRT",i.OS_UNKNOWN="Unknown",i.UNKNOWN=-1,i.WIN32=0,i.LINUX=1,i.MACOS=2,i.ANDROID=3,i.IPHONE=4,i.IPAD=5,i.BLACKBERRY=6,i.NACL=7,i.EMSCRIPTEN=8,i.TIZEN=9,i.WINRT=10,i.WP8=11,i.MOBILE_BROWSER=100,i.DESKTOP_BROWSER=101,i.BROWSER_TYPE_WECHAT="wechat",i.BROWSER_TYPE_ANDROID="androidbrowser",i.BROWSER_TYPE_IE="ie",i.BROWSER_TYPE_QQ="qqbrowser",i.BROWSER_TYPE_MOBILE_QQ="mqqbrowser",i.BROWSER_TYPE_UC="ucbrowser",i.BROWSER_TYPE_360="360browser",i.BROWSER_TYPE_BAIDU_APP="baiduboxapp",i.BROWSER_TYPE_BAIDU="baidubrowser",i.BROWSER_TYPE_MAXTHON="maxthon",i.BROWSER_TYPE_OPERA="opera",i.BROWSER_TYPE_OUPENG="oupeng",i.BROWSER_TYPE_MIUI="miuibrowser",i.BROWSER_TYPE_FIREFOX="firefox",i.BROWSER_TYPE_SAFARI="safari",i.BROWSER_TYPE_CHROME="chrome",i.BROWSER_TYPE_LIEBAO="liebao",i.BROWSER_TYPE_QZONE="qzone",i.BROWSER_TYPE_SOUGOU="sogou",i.BROWSER_TYPE_UNKNOWN="unknown",i.isNative=!1;var n=window,r=n.navigator,o=document,s=o.documentElement,c=r.userAgent.toLowerCase();i.isMobile=-1!==c.indexOf("mobile")||-1!==c.indexOf("android"),i.platform=i.isMobile?i.MOBILE_BROWSER:i.DESKTOP_BROWSER;var a=r.language,a=(a=a?a:r.browserLanguage)?a.split("-")[0]:i.LANGUAGE_ENGLISH;i.language=a;var a=i.BROWSER_TYPE_UNKNOWN,l=c.match(/sogou|qzone|liebao|micromessenger|qqbrowser|ucbrowser|360 aphone|360browser|baiduboxapp|baidubrowser|maxthon|trident|oupeng|opera|miuibrowser|firefox/i)||c.match(/chrome|safari/i);l&&0<l.length?(a=l[0],"micromessenger"===a?a=i.BROWSER_TYPE_WECHAT:"safari"===a&&c.match(/android.*applewebkit/)?a=i.BROWSER_TYPE_ANDROID:"trident"===a?a=i.BROWSER_TYPE_IE:"360 aphone"===a&&(a=i.BROWSER_TYPE_360)):c.indexOf("iphone")&&c.indexOf("mobile")&&(a="safari"),i.browserType=a,a=c.match(/(iPad|iPhone|iPod)/i)?!0:!1,c=c.match(/android/i)||r.platform.match(/android/i)?!0:!1,l=i.OS_UNKNOWN,-1!==r.appVersion.indexOf("Win")?l=i.OS_WINDOWS:a?l=i.OS_IOS:-1!==r.appVersion.indexOf("Mac")?l=i.OS_OSX:-1!==r.appVersion.indexOf("X11")&&-1===r.appVersion.indexOf("Linux")?l=i.OS_UNIX:c?l=i.OS_ANDROID:-1!==r.appVersion.indexOf("Linux")&&(l=i.OS_LINUX),i.os=l,i._supportMultipleAudio=-1<[i.BROWSER_TYPE_BAIDU,i.BROWSER_TYPE_OPERA,i.BROWSER_TYPE_FIREFOX,i.BROWSER_TYPE_CHROME,i.BROWSER_TYPE_BAIDU_APP,i.BROWSER_TYPE_SAFARI,i.BROWSER_TYPE_UC,i.BROWSER_TYPE_QQ,i.BROWSER_TYPE_MOBILE_QQ,i.BROWSER_TYPE_IE].indexOf(i.browserType),function(t,i){var r=i[e.renderMode]-0;(isNaN(r)||r>2||0>r)&&(r=0);var o=[t.OS_ANDROID],s=[],c=cc.newElement("canvas");cc._renderType=cc._RENDER_TYPE_CANVAS,cc._supportRender=!1;var a=n.WebGLRenderingContext;if(2===r||0===r&&a&&-1===o.indexOf(t.os)&&-1===s.indexOf(t.browserType))try{cc.create3DContext(c,{stencil:!0,preserveDrawingBuffer:!0})&&(cc._renderType=cc._RENDER_TYPE_WEBGL,cc._supportRender=!0)}catch(l){}if(1===r||0===r&&!1===cc._supportRender)try{c.getContext("2d"),cc._renderType=cc._RENDER_TYPE_CANVAS,cc._supportRender=!0}catch(h){}}(i,t),i._canUseCanvasNewBlendModes=function(){var t=document.createElement("canvas");t.width=1,t.height=1,t=t.getContext("2d"),t.fillStyle="#000",t.fillRect(0,0,1,1),t.globalCompositeOperation="multiply";var e=document.createElement("canvas");e.width=1,e.height=1;var i=e.getContext("2d");return i.fillStyle="#fff",i.fillRect(0,0,1,1),t.drawImage(e,0,0,1,1),0===t.getImageData(0,0,1,1).data[0]},i._supportCanvasNewBlendModes=i._canUseCanvasNewBlendModes();try{i._supportWebAudio=!!(n.AudioContext||n.webkitAudioContext||n.mozAudioContext)}catch(h){i._supportWebAudio=!1}try{var u=i.localStorage=n.localStorage;u.setItem("storage",""),u.removeItem("storage"),u=null}catch(d){u=function(){cc.warn("Warning: localStorage isn't enabled. Please confirm browser cookie or privacy option")},i.localStorage={getItem:u,setItem:u,removeItem:u,clear:u}}u=i.capabilities={canvas:!0},cc._renderType===cc._RENDER_TYPE_WEBGL&&(u.opengl=!0),(void 0!==s.ontouchstart||void 0!==o.ontouchstart||r.msPointerEnabled)&&(u.touches=!0),void 0!==s.onmouseup&&(u.mouse=!0),void 0!==s.onkeyup&&(u.keyboard=!0),(n.DeviceMotionEvent||n.DeviceOrientationEvent)&&(u.accelerometer=!0),i.garbageCollect=function(){},i.dumpRoot=function(){},i.restartVM=function(){},i.cleanScript=function(){},i.isObjectValid=function(t){return t?!0:!1},i.dump=function(){var t;t=""+("isMobile : "+this.isMobile+"\r\n"),t+="language : "+this.language+"\r\n",t+="browserType : "+this.browserType+"\r\n",t+="capabilities : "+JSON.stringify(this.capabilities)+"\r\n",t+="os : "+this.os+"\r\n",t+="platform : "+this.platform+"\r\n",cc.log(t)},i.openURL=function(t){window.open(t)}},cc.ORIENTATION_PORTRAIT=0,cc.ORIENTATION_PORTRAIT_UPSIDE_DOWN=1,cc.ORIENTATION_LANDSCAPE_LEFT=2,cc.ORIENTATION_LANDSCAPE_RIGHT=3,cc._drawingUtil=null,cc._renderContext=null,cc._canvas=null,cc._gameDiv=null,cc._rendererInitialized=!1,cc._setupCalled=!1,cc._setup=function(t,e,i){if(!cc._setupCalled){cc._setupCalled=!0;var n,r=window,o=cc.$(t)||cc.$("#"+t);cc.game._setAnimFrame(),"CANVAS"===o.tagName?(e=e||o.width,i=i||o.height,n=cc.container=cc.newElement("DIV"),t=cc._canvas=o,t.parentNode.insertBefore(n,t),t.appendTo(n),n.setAttribute("id","Cocos2dGameContainer")):("DIV"!==o.tagName&&cc.log("Warning: target element is not a DIV or CANVAS"),e=e||o.clientWidth,i=i||o.clientHeight,n=cc.container=o,t=cc._canvas=cc.$(cc.newElement("CANVAS")),o.appendChild(t)),t.addClass("gameCanvas"),t.setAttribute("width",e||480),t.setAttribute("height",i||320),t.setAttribute("tabindex",99),t.style.outline="none",o=n.style,o.width=(e||480)+"px",o.height=(i||320)+"px",o.margin="0 auto",o.position="relative",o.overflow="hidden",n.top="100%",cc._renderType===cc._RENDER_TYPE_WEBGL&&(cc._renderContext=cc.webglContext=cc.create3DContext(t,{stencil:!0,preserveDrawingBuffer:!0,antialias:!cc.sys.isMobile,alpha:!1})),cc._renderContext?(r.gl=cc._renderContext,cc._drawingUtil=new cc.DrawingPrimitiveWebGL(cc._renderContext),cc._rendererInitialized=!0,cc.textureCache._initializingRenderer(),cc.shaderCache._init()):(cc._renderContext=new cc.CanvasContextWrapper(t.getContext("2d")),cc._drawingUtil=cc.DrawingPrimitiveCanvas?new cc.DrawingPrimitiveCanvas(cc._renderContext):null),cc._gameDiv=n,cc.log(cc.ENGINE_VERSION),cc._setContextMenuEnable(!1),cc.sys.isMobile&&(e=cc.newElement("style"),e.type="text/css",document.body.appendChild(e),e.textContent="body,canvas,div{ -moz-user-select: none;-webkit-user-select: none;-ms-user-select: none;-khtml-user-select: none;-webkit-tap-highlight-color:rgba(0,0,0,0);}"),cc.view=cc.EGLView._getInstance(),cc.inputManager.registerSystemEvent(cc._canvas),cc.director=cc.Director._getInstance(),cc.director.setOpenGLView&&cc.director.setOpenGLView(cc.view),cc.winSize=cc.director.getWinSize(),cc.saxParser=new cc.SAXParser,cc.plistParser=new cc.PlistParser}},cc._checkWebGLRenderMode=function(){if(cc._renderType!==cc._RENDER_TYPE_WEBGL)throw"This feature supports WebGL render mode only."},cc._isContextMenuEnable=!1,cc._setContextMenuEnable=function(t){cc._isContextMenuEnable=t,cc._canvas.oncontextmenu=function(){return cc._isContextMenuEnable?void 0:!1}},cc.game={DEBUG_MODE_NONE:0,DEBUG_MODE_INFO:1,DEBUG_MODE_WARN:2,DEBUG_MODE_ERROR:3,DEBUG_MODE_INFO_FOR_WEB_PAGE:4,DEBUG_MODE_WARN_FOR_WEB_PAGE:5,DEBUG_MODE_ERROR_FOR_WEB_PAGE:6,EVENT_HIDE:"game_on_hide",EVENT_SHOW:"game_on_show",EVENT_RESIZE:"game_on_resize",_eventHide:null,_eventShow:null,_onBeforeStartArr:[],CONFIG_KEY:{engineDir:"engineDir",dependencies:"dependencies",debugMode:"debugMode",showFPS:"showFPS",frameRate:"frameRate",id:"id",renderMode:"renderMode",jsList:"jsList",classReleaseMode:"classReleaseMode"},_prepareCalled:!1,_prepared:!1,_paused:!0,_intervalId:null,_lastTime:null,_frameTime:null,config:null,onStart:null,onStop:null,setFrameRate:function(t){this.config[this.CONFIG_KEY.frameRate]=t,this._intervalId&&window.cancelAnimationFrame(this._intervalId),this._paused=!0,this._setAnimFrame(),this._runMainLoop()},_setAnimFrame:function(){this._lastTime=new Date,this._frameTime=1e3/cc.game.config[cc.game.CONFIG_KEY.frameRate],cc.sys.os===cc.sys.OS_IOS&&cc.sys.browserType===cc.sys.BROWSER_TYPE_WECHAT||60!==cc.game.config[cc.game.CONFIG_KEY.frameRate]?(window.requestAnimFrame=this._stTime,window.cancelAnimationFrame=this._ctTime):(window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||this._stTime,window.cancelAnimationFrame=window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.oCancelAnimationFrame||this._ctTime)},_stTime:function(t){var e=(new Date).getTime(),i=Math.max(0,cc.game._frameTime-(e-cc.game._lastTime)),n=window.setTimeout(function(){t()},i);return cc.game._lastTime=e+i,n},_ctTime:function(t){window.clearTimeout(t)},_runMainLoop:function(){var t,e=this,i=cc.director;i.setDisplayStats(e.config[e.CONFIG_KEY.showFPS]),t=function(){e._paused||(i.mainLoop(),e._intervalId&&window.cancelAnimationFrame(e._intervalId),e._intervalId=window.requestAnimFrame(t))},window.requestAnimFrame(t),e._paused=!1},restart:function(){cc.director.popToSceneStackLevel(0),cc.audioEngine&&cc.audioEngine.end(),cc.game.onStart()},run:function(t){var e=this,i=function(){t&&(e.config[e.CONFIG_KEY.id]=t),e._prepareCalled||e.prepare(function(){e._prepared=!0}),cc._supportRender&&(e._checkPrepare=setInterval(function(){e._prepared&&(cc._setup(e.config[e.CONFIG_KEY.id]),e._runMainLoop(),e._eventHide=e._eventHide||new cc.EventCustom(e.EVENT_HIDE),e._eventHide.setUserData(e),e._eventShow=e._eventShow||new cc.EventCustom(e.EVENT_SHOW),e._eventShow.setUserData(e),e.onStart(),clearInterval(e._checkPrepare))},10))};document.body?i():cc._addEventListener(window,"load",function(){this.removeEventListener("load",arguments.callee,!1),i()},!1)},_initConfig:function(){var t=this.CONFIG_KEY,e=function(e){return e[t.engineDir]=e[t.engineDir]||"frameworks/cocos2d-html5",null==e[t.debugMode]&&(e[t.debugMode]=0),e[t.frameRate]=e[t.frameRate]||60,null==e[t.renderMode]&&(e[t.renderMode]=1),e};if(document.ccConfig)this.config=e(document.ccConfig);else try{for(var i=document.getElementsByTagName("script"),n=0;n<i.length;n++){var r=i[n].getAttribute("cocos");if(""===r||r)break}var o,s,c;n<i.length&&((o=i[n].src)&&(c=/(.*)\//.exec(o)[0],cc.loader.resPath=c,o=cc.path.join(c,"project.json")),s=cc.loader._loadTxtSync(o)),s||(s=cc.loader._loadTxtSync("project.json"));var a=JSON.parse(s);this.config=e(a||{})}catch(l){cc.log("Failed to read or parse project.json"),this.config=e({})}cc._initSys(this.config,t)},_jsAddedCache:{},_getJsListOfModule:function(t,e,i){var n=this._jsAddedCache;if(n[e])return null;i=i||"";var r=[],o=t[e];if(!o)throw"can not find module ["+e+"]";e=cc.path;for(var s=0,c=o.length;c>s;s++){var a=o[s];if(!n[a]){var l=e.extname(a);l?".js"===l.toLowerCase()&&r.push(e.join(i,a)):(l=this._getJsListOfModule(t,a,i))&&(r=r.concat(l)),n[a]=1}}return r},prepare:function(t){var e=this,i=e.config,n=e.CONFIG_KEY,r=i[n.engineDir],o=cc.loader;if(!cc._supportRender)throw"The renderer doesn't support the renderMode "+i[n.renderMode];e._prepareCalled=!0;var s=i[n.jsList]||[];cc.Class?o.loadJsWithImg("",s,function(i){if(i)throw i;e._prepared=!0,t&&t()}):(n=cc.path.join(r,"moduleConfig.json"),o.loadJson(n,function(n,o){if(n)throw n;var c=i.modules||[],a=o.module,l=[];cc._renderType===cc._RENDER_TYPE_WEBGL?c.splice(0,0,"shaders"):0>c.indexOf("core")&&c.splice(0,0,"core");for(var h=0,u=c.length;u>h;h++){var d=e._getJsListOfModule(a,c[h],r);d&&(l=l.concat(d))}l=l.concat(s),cc.loader.loadJsWithImg(l,function(i){if(i)throw i;e._prepared=!0,t&&t()})}))}},cc.game._initConfig(),Function.prototype.bind=Function.prototype.bind||function(t){if(!cc.isFunction(this))throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),i=this,n=function(){},r=function(){return i.apply(this instanceof n&&t?this:t,e.concat(Array.prototype.slice.call(arguments)))};return n.prototype=this.prototype,r.prototype=new n,r},cc._urlRegExp=RegExp("^(?:(?:https?|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))|(?:localhost))(?::\\d{2,5})?(?:/\\S*)?$","i"),cc._LogInfos={ActionManager_addAction:"cc.ActionManager.addAction(): action must be non-null",ActionManager_removeAction:"cocos2d: removeAction: Target not found",ActionManager_removeActionByTag:"cc.ActionManager.removeActionByTag(): an invalid tag",ActionManager_removeActionByTag_2:"cc.ActionManager.removeActionByTag(): target must be non-null",ActionManager_getActionByTag:"cc.ActionManager.getActionByTag(): an invalid tag",ActionManager_getActionByTag_2:"cocos2d : getActionByTag(tag = %s): Action not found",configuration_dumpInfo:"cocos2d: **** WARNING **** CC_ENABLE_PROFILERS is defined. Disable it when you finish profiling (from ccConfig.js)",configuration_loadConfigFile:"Expected 'data' dict, but not found. Config file: %s",configuration_loadConfigFile_2:"Please load the resource first : %s",Director_resume:"cocos2d: Director: Error in gettimeofday",Director_setProjection:"cocos2d: Director: unrecognized projection",Director_popToSceneStackLevel:"cocos2d: Director: unrecognized projection",Director_popToSceneStackLevel_2:"cocos2d: Director: Error in gettimeofday",Director_popScene:"running scene should not null",Director_pushScene:"the scene should not null",arrayVerifyType:"element type is wrong!",Scheduler_scheduleCallbackForTarget:"CCSheduler#scheduleCallback. Callback already scheduled. Updating interval from:%s to %s",Scheduler_scheduleCallbackForTarget_2:"cc.scheduler.scheduleCallbackForTarget(): callback_fn should be non-null.",Scheduler_scheduleCallbackForTarget_3:"cc.scheduler.scheduleCallbackForTarget(): target should be non-null.",Scheduler_pauseTarget:"cc.Scheduler.pauseTarget():target should be non-null",Scheduler_resumeTarget:"cc.Scheduler.resumeTarget():target should be non-null",Scheduler_isTargetPaused:"cc.Scheduler.isTargetPaused():target should be non-null",Node_getZOrder:"getZOrder is deprecated. Please use getLocalZOrder instead.",Node_setZOrder:"setZOrder is deprecated. Please use setLocalZOrder instead.",Node_getRotation:"RotationX != RotationY. Don't know which one to return",Node_getScale:"ScaleX != ScaleY. Don't know which one to return",Node_addChild:"An Node can't be added as a child of itself.",Node_addChild_2:"child already added. It can't be added again",Node_addChild_3:"child must be non-null",Node_removeFromParentAndCleanup:"removeFromParentAndCleanup is deprecated. Use removeFromParent instead",Node_boundingBox:"boundingBox is deprecated. Use getBoundingBox instead",Node_removeChildByTag:"argument tag is an invalid tag",Node_removeChildByTag_2:"cocos2d: removeChildByTag(tag = %s): child not found!",Node_removeAllChildrenWithCleanup:"removeAllChildrenWithCleanup is deprecated. Use removeAllChildren instead",Node_stopActionByTag:"cc.Node.stopActionBy(): argument tag an invalid tag",Node_getActionByTag:"cc.Node.getActionByTag(): argument tag is an invalid tag",Node_resumeSchedulerAndActions:"resumeSchedulerAndActions is deprecated, please use resume instead.",Node_pauseSchedulerAndActions:"pauseSchedulerAndActions is deprecated, please use pause instead.",Node__arrayMakeObjectsPerformSelector:"Unknown callback function",Node_reorderChild:"child must be non-null",Node_runAction:"cc.Node.runAction(): action must be non-null",Node_schedule:"callback function must be non-null",Node_schedule_2:"interval must be positive",Node_initWithTexture:"cocos2d: Could not initialize cc.AtlasNode. Invalid Texture.",AtlasNode_updateAtlasValues:"cc.AtlasNode.updateAtlasValues(): Shall be overridden in subclasses",AtlasNode_initWithTileFile:"",AtlasNode__initWithTexture:"cocos2d: Could not initialize cc.AtlasNode. Invalid Texture.",_EventListenerKeyboard_checkAvailable:"cc._EventListenerKeyboard.checkAvailable(): Invalid EventListenerKeyboard!",_EventListenerTouchOneByOne_checkAvailable:"cc._EventListenerTouchOneByOne.checkAvailable(): Invalid EventListenerTouchOneByOne!",_EventListenerTouchAllAtOnce_checkAvailable:"cc._EventListenerTouchAllAtOnce.checkAvailable(): Invalid EventListenerTouchAllAtOnce!",_EventListenerAcceleration_checkAvailable:"cc._EventListenerAcceleration.checkAvailable(): _onAccelerationEvent must be non-nil",EventListener_create:"Invalid parameter.",__getListenerID:"Don't call this method if the event is for touch.",eventManager__forceAddEventListener:"Invalid scene graph priority!",eventManager_addListener:"0 priority is forbidden for fixed priority since it's used for scene graph based priority.",eventManager_removeListeners:"Invalid listener type!",eventManager_setPriority:"Can't set fixed priority with scene graph based listener.",eventManager_addListener_2:"Invalid parameters.",eventManager_addListener_3:"listener must be a cc.EventListener object when adding a fixed priority listener",eventManager_addListener_4:"The listener has been registered, please don't register it again.",LayerMultiplex_initWithLayers:"parameters should not be ending with null in Javascript",LayerMultiplex_switchTo:"Invalid index in MultiplexLayer switchTo message",LayerMultiplex_switchToAndReleaseMe:"Invalid index in MultiplexLayer switchTo message",LayerMultiplex_addLayer:"cc.Layer.addLayer(): layer should be non-null",EGLView_setDesignResolutionSize:"Resolution not valid",EGLView_setDesignResolutionSize_2:"should set resolutionPolicy",inputManager_handleTouchesBegin:"The touches is more than MAX_TOUCHES, nUnusedIndex = %s",swap:"cc.swap is being modified from original macro, please check usage",checkGLErrorDebug:"WebGL error %s",animationCache__addAnimationsWithDictionary:"cocos2d: cc.AnimationCache: No animations were found in provided dictionary.",animationCache__addAnimationsWithDictionary_2:"cc.AnimationCache. Invalid animation format",animationCache_addAnimations:"cc.AnimationCache.addAnimations(): File could not be found",animationCache__parseVersion1:"cocos2d: cc.AnimationCache: Animation '%s' found in dictionary without any frames - cannot add to animation cache.",animationCache__parseVersion1_2:"cocos2d: cc.AnimationCache: Animation '%s' refers to frame '%s' which is not currently in the cc.SpriteFrameCache. This frame will not be added to the animation.",animationCache__parseVersion1_3:"cocos2d: cc.AnimationCache: None of the frames for animation '%s' were found in the cc.SpriteFrameCache. Animation is not being added to the Animation Cache.",animationCache__parseVersion1_4:"cocos2d: cc.AnimationCache: An animation in your dictionary refers to a frame which is not in the cc.SpriteFrameCache. Some or all of the frames for the animation '%s' may be missing.",animationCache__parseVersion2:"cocos2d: CCAnimationCache: Animation '%s' found in dictionary without any frames - cannot add to animation cache.",animationCache__parseVersion2_2:"cocos2d: cc.AnimationCache: Animation '%s' refers to frame '%s' which is not currently in the cc.SpriteFrameCache. This frame will not be added to the animation.",animationCache_addAnimations_2:"cc.AnimationCache.addAnimations(): Invalid texture file name",Sprite_reorderChild:"cc.Sprite.reorderChild(): this child is not in children list",Sprite_ignoreAnchorPointForPosition:"cc.Sprite.ignoreAnchorPointForPosition(): it is invalid in cc.Sprite when using SpriteBatchNode",Sprite_setDisplayFrameWithAnimationName:"cc.Sprite.setDisplayFrameWithAnimationName(): Frame not found",Sprite_setDisplayFrameWithAnimationName_2:"cc.Sprite.setDisplayFrameWithAnimationName(): Invalid frame index",Sprite_setDisplayFrame:"setDisplayFrame is deprecated, please use setSpriteFrame instead.",Sprite__updateBlendFunc:"cc.Sprite._updateBlendFunc(): _updateBlendFunc doesn't work when the sprite is rendered using a cc.CCSpriteBatchNode",Sprite_initWithSpriteFrame:"cc.Sprite.initWithSpriteFrame(): spriteFrame should be non-null",Sprite_initWithSpriteFrameName:"cc.Sprite.initWithSpriteFrameName(): spriteFrameName should be non-null",Sprite_initWithSpriteFrameName1:" is null, please check.",Sprite_initWithFile:"cc.Sprite.initWithFile(): filename should be non-null",Sprite_setDisplayFrameWithAnimationName_3:"cc.Sprite.setDisplayFrameWithAnimationName(): animationName must be non-null",Sprite_reorderChild_2:"cc.Sprite.reorderChild(): child should be non-null",Sprite_addChild:"cc.Sprite.addChild(): cc.Sprite only supports cc.Sprites as children when using cc.SpriteBatchNode",Sprite_addChild_2:"cc.Sprite.addChild(): cc.Sprite only supports a sprite using same texture as children when using cc.SpriteBatchNode",Sprite_addChild_3:"cc.Sprite.addChild(): child should be non-null",Sprite_setTexture:"cc.Sprite.texture setter: Batched sprites should use the same texture as the batchnode",Sprite_updateQuadFromSprite:"cc.SpriteBatchNode.updateQuadFromSprite(): cc.SpriteBatchNode only supports cc.Sprites as children",Sprite_insertQuadFromSprite:"cc.SpriteBatchNode.insertQuadFromSprite(): cc.SpriteBatchNode only supports cc.Sprites as children",Sprite_addChild_4:"cc.SpriteBatchNode.addChild(): cc.SpriteBatchNode only supports cc.Sprites as children",Sprite_addChild_5:"cc.SpriteBatchNode.addChild(): cc.Sprite is not using the same texture",Sprite_initWithTexture:"Sprite.initWithTexture(): Argument must be non-nil ",Sprite_setSpriteFrame:"Invalid spriteFrameName",Sprite_setTexture_2:"Invalid argument: cc.Sprite.texture setter expects a CCTexture2D.",Sprite_updateQuadFromSprite_2:"cc.SpriteBatchNode.updateQuadFromSprite(): sprite should be non-null",Sprite_insertQuadFromSprite_2:"cc.SpriteBatchNode.insertQuadFromSprite(): sprite should be non-null",SpriteBatchNode_addSpriteWithoutQuad:"cc.SpriteBatchNode.addQuadFromSprite(): SpriteBatchNode only supports cc.Sprites as children",SpriteBatchNode_increaseAtlasCapacity:"cocos2d: CCSpriteBatchNode: resizing TextureAtlas capacity from %s to %s.",SpriteBatchNode_increaseAtlasCapacity_2:"cocos2d: WARNING: Not enough memory to resize the atlas",SpriteBatchNode_reorderChild:"cc.SpriteBatchNode.addChild(): Child doesn't belong to Sprite",SpriteBatchNode_removeChild:"cc.SpriteBatchNode.addChild(): sprite batch node should contain the child",SpriteBatchNode_addSpriteWithoutQuad_2:"cc.SpriteBatchNode.addQuadFromSprite(): child should be non-null",SpriteBatchNode_reorderChild_2:"cc.SpriteBatchNode.addChild(): child should be non-null",spriteFrameCache__getFrameConfig:"cocos2d: WARNING: originalWidth/Height not found on the cc.SpriteFrame. AnchorPoint won't work as expected. Regenrate the .plist",spriteFrameCache_addSpriteFrames:"cocos2d: WARNING: an alias with name %s already exists",spriteFrameCache__checkConflict:"cocos2d: WARNING: Sprite frame: %s has already been added by another source, please fix name conflit",spriteFrameCache_getSpriteFrame:"cocos2d: cc.SpriteFrameCahce: Frame %s not found",spriteFrameCache__getFrameConfig_2:"Please load the resource first : %s",spriteFrameCache_addSpriteFrames_2:"cc.SpriteFrameCache.addSpriteFrames(): plist should be non-null",spriteFrameCache_addSpriteFrames_3:"Argument must be non-nil",CCSpriteBatchNode_updateQuadFromSprite:"cc.SpriteBatchNode.updateQuadFromSprite(): cc.SpriteBatchNode only supports cc.Sprites as children",CCSpriteBatchNode_insertQuadFromSprite:"cc.SpriteBatchNode.insertQuadFromSprite(): cc.SpriteBatchNode only supports cc.Sprites as children",CCSpriteBatchNode_addChild:"cc.SpriteBatchNode.addChild(): cc.SpriteBatchNode only supports cc.Sprites as children",CCSpriteBatchNode_initWithTexture:"Sprite.initWithTexture(): Argument must be non-nil ",CCSpriteBatchNode_addChild_2:"cc.Sprite.addChild(): child should be non-null",CCSpriteBatchNode_setSpriteFrame:"Invalid spriteFrameName",CCSpriteBatchNode_setTexture:"Invalid argument: cc.Sprite texture setter expects a CCTexture2D.",CCSpriteBatchNode_updateQuadFromSprite_2:"cc.SpriteBatchNode.updateQuadFromSprite(): sprite should be non-null",CCSpriteBatchNode_insertQuadFromSprite_2:"cc.SpriteBatchNode.insertQuadFromSprite(): sprite should be non-null",CCSpriteBatchNode_addChild_3:"cc.SpriteBatchNode.addChild(): child should be non-null",TextureAtlas_initWithFile:"cocos2d: Could not open file: %s",TextureAtlas_insertQuad:"cc.TextureAtlas.insertQuad(): invalid totalQuads",TextureAtlas_initWithTexture:"cc.TextureAtlas.initWithTexture():texture should be non-null",TextureAtlas_updateQuad:"cc.TextureAtlas.updateQuad(): quad should be non-null",TextureAtlas_updateQuad_2:"cc.TextureAtlas.updateQuad(): Invalid index",TextureAtlas_insertQuad_2:"cc.TextureAtlas.insertQuad(): Invalid index",TextureAtlas_insertQuads:"cc.TextureAtlas.insertQuad(): Invalid index + amount",TextureAtlas_insertQuadFromIndex:"cc.TextureAtlas.insertQuadFromIndex(): Invalid newIndex",TextureAtlas_insertQuadFromIndex_2:"cc.TextureAtlas.insertQuadFromIndex(): Invalid fromIndex",TextureAtlas_removeQuadAtIndex:"cc.TextureAtlas.removeQuadAtIndex(): Invalid index",TextureAtlas_removeQuadsAtIndex:"cc.TextureAtlas.removeQuadsAtIndex(): index + amount out of bounds",TextureAtlas_moveQuadsFromIndex:"cc.TextureAtlas.moveQuadsFromIndex(): move is out of bounds",TextureAtlas_moveQuadsFromIndex_2:"cc.TextureAtlas.moveQuadsFromIndex(): Invalid newIndex",TextureAtlas_moveQuadsFromIndex_3:"cc.TextureAtlas.moveQuadsFromIndex(): Invalid oldIndex",textureCache_addPVRTCImage:"TextureCache:addPVRTCImage does not support on HTML5",textureCache_addETCImage:"TextureCache:addPVRTCImage does not support on HTML5",textureCache_textureForKey:"textureForKey is deprecated. Please use getTextureForKey instead.",textureCache_addPVRImage:"addPVRImage does not support on HTML5",textureCache_addUIImage:"cocos2d: Couldn't add UIImage in TextureCache",textureCache_dumpCachedTextureInfo:"cocos2d: '%s' id=%s %s x %s",textureCache_dumpCachedTextureInfo_2:"cocos2d: '%s' id= HTMLCanvasElement %s x %s",textureCache_dumpCachedTextureInfo_3:"cocos2d: TextureCache dumpDebugInfo: %s textures, HTMLCanvasElement for %s KB (%s MB)",textureCache_addUIImage_2:"cc.Texture.addUIImage(): image should be non-null",Texture2D_initWithETCFile:"initWithETCFile does not support on HTML5",Texture2D_initWithPVRFile:"initWithPVRFile does not support on HTML5",Texture2D_initWithPVRTCData:"initWithPVRTCData does not support on HTML5",Texture2D_addImage:"cc.Texture.addImage(): path should be non-null",Texture2D_initWithImage:"cocos2d: cc.Texture2D. Can't create Texture. UIImage is nil",Texture2D_initWithImage_2:"cocos2d: WARNING: Image (%s x %s) is bigger than the supported %s x %s",Texture2D_initWithString:"initWithString isn't supported on cocos2d-html5",Texture2D_initWithETCFile_2:"initWithETCFile does not support on HTML5",Texture2D_initWithPVRFile_2:"initWithPVRFile does not support on HTML5",Texture2D_initWithPVRTCData_2:"initWithPVRTCData does not support on HTML5",Texture2D_bitsPerPixelForFormat:"bitsPerPixelForFormat: %s, cannot give useful result, it's a illegal pixel format",Texture2D__initPremultipliedATextureWithImage:"cocos2d: cc.Texture2D: Using RGB565 texture since image has no alpha",Texture2D_addImage_2:"cc.Texture.addImage(): path should be non-null",Texture2D_initWithData:"NSInternalInconsistencyException",MissingFile:"Missing file: %s",radiansToDegress:"cc.radiansToDegress() should be called cc.radiansToDegrees()",RectWidth:"Rect width exceeds maximum margin: %s",RectHeight:"Rect height exceeds maximum margin: %s",EventManager__updateListeners:"If program goes here, there should be event in dispatch.",EventManager__updateListeners_2:"_inDispatch should be 1 here."},cc._logToWebPage=function(t){if(cc._canvas){var e=cc._logList,i=document;
if(!e){var n=i.createElement("Div"),e=n.style;n.setAttribute("id","logInfoDiv"),cc._canvas.parentNode.appendChild(n),n.setAttribute("width","200"),n.setAttribute("height",cc._canvas.height),e.zIndex="99999",e.position="absolute",e.top="0",e.left="0",e=cc._logList=i.createElement("textarea"),i=e.style,e.setAttribute("rows","20"),e.setAttribute("cols","30"),e.setAttribute("disabled",!0),n.appendChild(e),i.backgroundColor="transparent",i.borderBottom="1px solid #cccccc",i.borderRightWidth="0px",i.borderLeftWidth="0px",i.borderTopWidth="0px",i.borderTopStyle="none",i.borderRightStyle="none",i.borderLeftStyle="none",i.padding="0px",i.margin=0}e.value=e.value+t+"\r\n",e.scrollTop=e.scrollHeight}},cc._formatString=function(t){if(!cc.isObject(t))return t;try{return JSON.stringify(t)}catch(e){return""}},cc._initDebugSetting=function(t){var e=cc.game;if(t!==e.DEBUG_MODE_NONE){var i;t>e.DEBUG_MODE_ERROR?(i=cc._logToWebPage.bind(cc),cc.error=function(){i("ERROR :  "+cc.formatStr.apply(cc,arguments))},cc.assert=function(t,e){if(!t&&e){for(var n=2;n<arguments.length;n++)e=e.replace(/(%s)|(%d)/,cc._formatString(arguments[n]));i("Assert: "+e)}},t!==e.DEBUG_MODE_ERROR_FOR_WEB_PAGE&&(cc.warn=function(){i("WARN :  "+cc.formatStr.apply(cc,arguments))}),t===e.DEBUG_MODE_INFO_FOR_WEB_PAGE&&(cc.log=function(){i(cc.formatStr.apply(cc,arguments))})):console&&console.log.apply&&(cc.error=function(){return console.error.apply(console,arguments)},cc.assert=function(t,e){if(!t&&e){for(var i=2;i<arguments.length;i++)e=e.replace(/(%s)|(%d)/,cc._formatString(arguments[i]));throw e}},t!==e.DEBUG_MODE_ERROR&&(cc.warn=function(){return console.warn.apply(console,arguments)}),t===e.DEBUG_MODE_INFO&&(cc.log=function(){}))}},cc._initDebugSetting(cc.game.config[cc.game.CONFIG_KEY.debugMode]),cc.loader.loadBinary=function(t,e){var i=this,n=this.getXMLHttpRequest(),r="load "+t+" failed!";n.open("GET",t,!0),cc.loader.loadBinary._IEFilter?(n.setRequestHeader("Accept-Charset","x-user-defined"),n.onreadystatechange=function(){if(4===n.readyState&&200===n.status){var t=cc._convertResponseBodyToText(n.responseBody);e(null,i._str2Uint8Array(t))}else e(r)}):(n.overrideMimeType&&n.overrideMimeType("text/plain; charset=x-user-defined"),n.onload=function(){4===n.readyState&&200===n.status?e(null,i._str2Uint8Array(n.responseText)):e(r)}),n.send(null)},cc.loader.loadBinary._IEFilter=/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)&&window.IEBinaryToArray_ByteStr&&window.IEBinaryToArray_ByteStr_Last,cc.loader._str2Uint8Array=function(t){if(!t)return null;for(var e=new Uint8Array(t.length),i=0;i<t.length;i++)e[i]=255&t.charCodeAt(i);return e},cc.loader.loadBinarySync=function(t){var e=this.getXMLHttpRequest(),i="load "+t+" failed!";if(e.open("GET",t,!1),t=null,cc.loader.loadBinary._IEFilter){if(e.setRequestHeader("Accept-Charset","x-user-defined"),e.send(null),200!==e.status)return cc.log(i),null;(e=cc._convertResponseBodyToText(e.responseBody))&&(t=this._str2Uint8Array(e))}else{if(e.overrideMimeType&&e.overrideMimeType("text/plain; charset=x-user-defined"),e.send(null),200!==e.status)return cc.log(i),null;t=this._str2Uint8Array(e.responseText)}return t},window.Uint8Array=window.Uint8Array||window.Array,cc.loader.loadBinary._IEFilter){var IEBinaryToArray_ByteStr_Script='<!-- IEBinaryToArray_ByteStr -->\r\nFunction IEBinaryToArray_ByteStr(Binary)\r\n   IEBinaryToArray_ByteStr = CStr(Binary)\r\nEnd Function\r\nFunction IEBinaryToArray_ByteStr_Last(Binary)\r\n   Dim lastIndex\r\n   lastIndex = LenB(Binary)\r\n   if lastIndex mod 2 Then\r\n       IEBinaryToArray_ByteStr_Last = Chr( AscB( MidB( Binary, lastIndex, 1 ) ) )\r\n   Else\r\n       IEBinaryToArray_ByteStr_Last = ""\r\n   End If\r\nEnd Function\r\n',myVBScript=cc.newElement("script");myVBScript.type="text/vbscript",myVBScript.textContent=IEBinaryToArray_ByteStr_Script,document.body.appendChild(myVBScript),cc._convertResponseBodyToText=function(t){for(var e={},i=0;256>i;i++)for(var n=0;256>n;n++)e[String.fromCharCode(i+256*n)]=String.fromCharCode(i)+String.fromCharCode(n);return i=IEBinaryToArray_ByteStr(t),t=IEBinaryToArray_ByteStr_Last(t),i.replace(/[\s\S]/g,function(t){return e[t]})+t}}cc=cc||{},cc._loadingImage="data:image/gif;base64,R0lGODlhEAAQALMNAD8/P7+/vyoqKlVVVX9/fxUVFUBAQGBgYMDAwC8vL5CQkP///wAAAP///wAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh+QQFAAANACwAAAAAEAAQAAAEO5DJSau9OOvNex0IMnDIsiCkiW6g6BmKYlBFkhSUEgQKlQCARG6nEBwOgl+QApMdCIRD7YZ5RjlGpCUCACH5BAUAAA0ALAAAAgAOAA4AAAQ6kLGB0JA4M7QW0hrngRllkYyhKAYqKUGguAws0ypLS8JxCLQDgXAIDg+FRKIA6v0SAECCBpXSkstMBAAh+QQFAAANACwAAAAACgAQAAAEOJDJORAac6K1kDSKYmydpASBUl0mqmRfaGTCcQgwcxDEke+9XO2WkxQSiUIuAQAkls0n7JgsWq8RACH5BAUAAA0ALAAAAAAOAA4AAAQ6kMlplDIzTxWC0oxwHALnDQgySAdBHNWFLAvCukc215JIZihVIZEogDIJACBxnCSXTcmwGK1ar1hrBAAh+QQFAAANACwAAAAAEAAKAAAEN5DJKc4RM+tDyNFTkSQF5xmKYmQJACTVpQSBwrpJNteZSGYoFWjIGCAQA2IGsVgglBOmEyoxIiMAIfkEBQAADQAsAgAAAA4ADgAABDmQSVZSKjPPBEDSGucJxyGA1XUQxAFma/tOpDlnhqIYN6MEAUXvF+zldrMBAjHoIRYLhBMqvSmZkggAIfkEBQAADQAsBgAAAAoAEAAABDeQyUmrnSWlYhMASfeFVbZdjHAcgnUQxOHCcqWylKEohqUEAYVkgEAMfkEJYrFA6HhKJsJCNFoiACH5BAUAAA0ALAIAAgAOAA4AAAQ3kMlJq704611SKloCAEk4lln3DQgyUMJxCBKyLAh1EMRR3wiDQmHY9SQslyIQUMRmlmVTIyRaIgA7",cc._fpsImage="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAAgCAYAAAD9qabkAAAKQ2lDQ1BJQ0MgcHJvZmlsZQAAeNqdU3dYk/cWPt/3ZQ9WQtjwsZdsgQAiI6wIyBBZohCSAGGEEBJAxYWIClYUFRGcSFXEgtUKSJ2I4qAouGdBiohai1VcOO4f3Ke1fXrv7e371/u855zn/M55zw+AERImkeaiagA5UoU8Otgfj09IxMm9gAIVSOAEIBDmy8JnBcUAAPADeXh+dLA//AGvbwACAHDVLiQSx+H/g7pQJlcAIJEA4CIS5wsBkFIAyC5UyBQAyBgAsFOzZAoAlAAAbHl8QiIAqg0A7PRJPgUA2KmT3BcA2KIcqQgAjQEAmShHJAJAuwBgVYFSLALAwgCgrEAiLgTArgGAWbYyRwKAvQUAdo5YkA9AYACAmUIszAAgOAIAQx4TzQMgTAOgMNK/4KlfcIW4SAEAwMuVzZdL0jMUuJXQGnfy8ODiIeLCbLFCYRcpEGYJ5CKcl5sjE0jnA0zODAAAGvnRwf44P5Dn5uTh5mbnbO/0xaL+a/BvIj4h8d/+vIwCBAAQTs/v2l/l5dYDcMcBsHW/a6lbANpWAGjf+V0z2wmgWgrQevmLeTj8QB6eoVDIPB0cCgsL7SViob0w44s+/zPhb+CLfvb8QB7+23rwAHGaQJmtwKOD/XFhbnauUo7nywRCMW735yP+x4V//Y4p0eI0sVwsFYrxWIm4UCJNx3m5UpFEIcmV4hLpfzLxH5b9CZN3DQCshk/ATrYHtctswH7uAQKLDljSdgBAfvMtjBoLkQAQZzQyefcAAJO/+Y9AKwEAzZek4wAAvOgYXKiUF0zGCAAARKCBKrBBBwzBFKzADpzBHbzAFwJhBkRADCTAPBBCBuSAHAqhGJZBGVTAOtgEtbADGqARmuEQtMExOA3n4BJcgetwFwZgGJ7CGLyGCQRByAgTYSE6iBFijtgizggXmY4EImFINJKApCDpiBRRIsXIcqQCqUJqkV1II/ItchQ5jVxA+pDbyCAyivyKvEcxlIGyUQPUAnVAuagfGorGoHPRdDQPXYCWomvRGrQePYC2oqfRS+h1dAB9io5jgNExDmaM2WFcjIdFYIlYGibHFmPlWDVWjzVjHVg3dhUbwJ5h7wgkAouAE+wIXoQQwmyCkJBHWExYQ6gl7CO0EroIVwmDhDHCJyKTqE+0JXoS+cR4YjqxkFhGrCbuIR4hniVeJw4TX5NIJA7JkuROCiElkDJJC0lrSNtILaRTpD7SEGmcTCbrkG3J3uQIsoCsIJeRt5APkE+S+8nD5LcUOsWI4kwJoiRSpJQSSjVlP+UEpZ8yQpmgqlHNqZ7UCKqIOp9aSW2gdlAvU4epEzR1miXNmxZDy6Qto9XQmmlnafdoL+l0ugndgx5Fl9CX0mvoB+nn6YP0dwwNhg2Dx0hiKBlrGXsZpxi3GS+ZTKYF05eZyFQw1zIbmWeYD5hvVVgq9ip8FZHKEpU6lVaVfpXnqlRVc1U/1XmqC1SrVQ+rXlZ9pkZVs1DjqQnUFqvVqR1Vu6k2rs5Sd1KPUM9RX6O+X/2C+mMNsoaFRqCGSKNUY7fGGY0hFsYyZfFYQtZyVgPrLGuYTWJbsvnsTHYF+xt2L3tMU0NzqmasZpFmneZxzQEOxrHg8DnZnErOIc4NznstAy0/LbHWaq1mrX6tN9p62r7aYu1y7Rbt69rvdXCdQJ0snfU6bTr3dQm6NrpRuoW623XP6j7TY+t56Qn1yvUO6d3RR/Vt9KP1F+rv1u/RHzcwNAg2kBlsMThj8MyQY+hrmGm40fCE4agRy2i6kcRoo9FJoye4Ju6HZ+M1eBc+ZqxvHGKsNN5l3Gs8YWJpMtukxKTF5L4pzZRrmma60bTTdMzMyCzcrNisyeyOOdWca55hvtm82/yNhaVFnMVKizaLx5balnzLBZZNlvesmFY+VnlW9VbXrEnWXOss623WV2xQG1ebDJs6m8u2qK2brcR2m23fFOIUjynSKfVTbtox7PzsCuya7AbtOfZh9iX2bfbPHcwcEh3WO3Q7fHJ0dcx2bHC866ThNMOpxKnD6VdnG2ehc53zNRemS5DLEpd2lxdTbaeKp26fesuV5RruutK10/Wjm7ub3K3ZbdTdzD3Ffav7TS6bG8ldwz3vQfTw91jicczjnaebp8LzkOcvXnZeWV77vR5Ps5wmntYwbcjbxFvgvct7YDo+PWX6zukDPsY+Ap96n4e+pr4i3z2+I37Wfpl+B/ye+zv6y/2P+L/hefIW8U4FYAHBAeUBvYEagbMDawMfBJkEpQc1BY0FuwYvDD4VQgwJDVkfcpNvwBfyG/ljM9xnLJrRFcoInRVaG/owzCZMHtYRjobPCN8Qfm+m+UzpzLYIiOBHbIi4H2kZmRf5fRQpKjKqLupRtFN0cXT3LNas5Fn7Z72O8Y+pjLk722q2cnZnrGpsUmxj7Ju4gLiquIF4h/hF8ZcSdBMkCe2J5MTYxD2J43MC52yaM5zkmlSWdGOu5dyiuRfm6c7Lnnc8WTVZkHw4hZgSl7I/5YMgQlAvGE/lp25NHRPyhJuFT0W+oo2iUbG3uEo8kuadVpX2ON07fUP6aIZPRnXGMwlPUit5kRmSuSPzTVZE1t6sz9lx2S05lJyUnKNSDWmWtCvXMLcot09mKyuTDeR55m3KG5OHyvfkI/lz89sVbIVM0aO0Uq5QDhZML6greFsYW3i4SL1IWtQz32b+6vkjC4IWfL2QsFC4sLPYuHhZ8eAiv0W7FiOLUxd3LjFdUrpkeGnw0n3LaMuylv1Q4lhSVfJqedzyjlKD0qWlQyuCVzSVqZTJy26u9Fq5YxVhlWRV72qX1VtWfyoXlV+scKyorviwRrjm4ldOX9V89Xlt2treSrfK7etI66Trbqz3Wb+vSr1qQdXQhvANrRvxjeUbX21K3nShemr1js20zcrNAzVhNe1bzLas2/KhNqP2ep1/XctW/a2rt77ZJtrWv913e/MOgx0VO97vlOy8tSt4V2u9RX31btLugt2PGmIbur/mft24R3dPxZ6Pe6V7B/ZF7+tqdG9s3K+/v7IJbVI2jR5IOnDlm4Bv2pvtmne1cFoqDsJB5cEn36Z8e+NQ6KHOw9zDzd+Zf7f1COtIeSvSOr91rC2jbaA9ob3v6IyjnR1eHUe+t/9+7zHjY3XHNY9XnqCdKD3x+eSCk+OnZKeenU4/PdSZ3Hn3TPyZa11RXb1nQ8+ePxd07ky3X/fJ897nj13wvHD0Ivdi2yW3S609rj1HfnD94UivW2/rZffL7Vc8rnT0Tes70e/Tf/pqwNVz1/jXLl2feb3vxuwbt24m3Ry4Jbr1+Hb27Rd3Cu5M3F16j3iv/L7a/eoH+g/qf7T+sWXAbeD4YMBgz8NZD+8OCYee/pT/04fh0kfMR9UjRiONj50fHxsNGr3yZM6T4aeypxPPyn5W/3nrc6vn3/3i+0vPWPzY8Av5i8+/rnmp83Lvq6mvOscjxx+8znk98ab8rc7bfe+477rfx70fmSj8QP5Q89H6Y8en0E/3Pud8/vwv94Tz+4A5JREAAAAGYktHRAD/AP8A/6C9p5MAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAHdElNRQfcAgcQLxxUBNp/AAAQZ0lEQVR42u2be3QVVZbGv1N17829eRLyIKAEOiISEtPhJTJAYuyBDmhWjAEx4iAGBhxA4wABbVAMWUAeykMCM+HRTcBRWkNH2l5moS0LCCrQTkYeQWBQSCAIgYRXEpKbW/XNH5zS4noR7faPEeu31l0h4dSpvc+t/Z199jkFWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhY/H9D/MR9qfKnLj/00U71aqfJn9+HCkCR/Wk36ddsgyJ/1wF4fkDfqqm9/gPsUeTnVr6a2xlQfnxdI7zs0W7irzD17Ytb2WT7EeNv/r4ox1O3Quf2QP2pgt9utwfout4FQE8AVBSlnaRmfvAURQkg2RlAbwB9AThlW5L0GaiKojhJhgOIBqDa7XaPrusdPtr5kQwF0BVAAoBIABRCKDd5aFUhRDAAw57eAOwAhKIoupft3zoqhB1AqLwuHIBut9uFt02qqvqRDJR2dAEQJj/BAOjn56dqmma+xiaECAEQAWAggLsB6A6HQ2iaZggBhBAqgEAAnQB0kzaEmT4hAITT6VQ8Ho/HJAKKECJQtr8LwD1y/A1/vcdfEUIEyfZ9AcQbYvZ942Px88L2UwlJR0dH0EMPPbRj5syZPUeNGrXR7Xb/641xIwJ1XY9NSUlZm52dfW+XLl1w8uRJzJ8//+OGhoYJqqqe1TSt1Wsm9NN1PSIqKmr12rVrR5WUlHy1bdu2AQCumWc3IYRD1/UwVVXnFRQUTIuNjUVzczN2797dWFJSkq8oymZd15sAGAEnFEUJ1nX9nzIzM1dnZmZGh4SE4OTJk5g5c+Zf29vbp9pstrMej6fVOyhIhgAYU1hY+B+hoaGoqKg4XVlZea+XTULTNFdCQsLGiRMnPuR2u3UhBOV9eeDAAWXTpk095DUe6WsoyRE5OTlr0tLSAux2O/bs2cO5c+e+pijKUpIXSHaQVAGkvPLKK++6XK4OksJLCFlXV2cvKSlJBFAjhU+x2WwhHo9nUHp6+urMzMy7wsLCUF9fjxdffPHjxsbGiTab7WuPx9NiEutOuq4PyMjI+M+srKyYqKgoHD58GDNmzNjq8XhyVFU9b/q+LH7hBAEYu3PnTlZVVRFAGgCX6f/tAHoOHDjwa0p27txp/JO9e/f+QM7cipw9nfL3kQBKt2zZQpJ87rnn6mQmoHilw2EACs+cOUOSrK+vZ1NTE0nyo48+IoBpxswoBcMJ4Ndjx471kOTFixe5d+9ekqTH42H//v13A4jyzpAURfEH0H/OnDnthu1z5sw558MmFUCPWbNmnaMP3nrrLZoyDmP8Hl68eDFJ8siRI9/Yc+zYMQKYKdtAztrTrl27xptRXV1NAKMAOAyBBBA/Y8aMdpLs6Ojgxx9//E37+++//29yvFXppwvAwMcee8xjtDHsuXLlCqOjo//ia3wsfpkoALqFhoZuIckJEyackimm3dQmEMDUmpoakmRISMhhAHOHDx/eQJIbN24kgKEyMAHAFRMTs2XXrl1saWkhSZ0kp0+ffhrAr3wEW/S8efOukORLL72kA1gKYMPWrVtJkk899dRJAHeYrgsEsIQkjx8/TgDvAPjd448/3kaSb7zxBmUa7vC6z53BwcFbSHL9+vU6Sc6aNes8gF5ewWAH0PfVV18lSQL4DMBGIcQ6AKtcLleBFC2jXtFt8ODBe0iyoqKCAJYByC8qKmJDQwOzsrK+MAmqo1OnTveHhoa+GRkZ+XZkZOSWiIiIvzgcjk9mzpypkWRmZuZpmbYbGV4AgPnNzc1sa2sjgN0A5iQmJtaSZHl5OQHcb/K3s81mW0uSTU1NBFAFYFbfvn1Pk+Tbb79NAA8IIVzW42/hByA+Pz/fLR/2ZXIda05NI/z9/TeR5J49ewhgqlxTrtI0jY2NjQQw3zTLuWJiYjaUlJToS5Ys6fjkk080kwDEeAmADcA9GzZsIElGRUW9CyAWwLApU6Y0kOSKFSsog9QICGdERMTGsrIyZmVlEcC9AB4IDw/fTpLbtm0jgN94CUAnAJmVlZVcs2aNZ/LkyRdJcvbs2b4EwAkgZfPmzTxw4AABFAN4BkC6vFeUSewcAO5duXIlSTIhIaEawGMAxgKYAmAGgCS73e5vrKVk/yGythANYEhCQsIhkly+fDkBpKqqGmL6DgIALDKN/3yZpVWQZGVlJQE8aPI3KiMjo5okV61aRQAjAPQBMPfIkSN0u90EUCBtsPiFEwpgbn19PdetW2fM5N4zQ9ekpKQqkty0aRMBpMjiWM6JEydIkoqirJUFJ6iq6pAPVy8A6cZMehMBUACEuVyuFwG8HBwcPEIWx367ZMkSjSQXLVrUJouTRorrkAHdA8BdQogsAOsKCwtJkmPGjDkvMw2bDDo/ADEjRoz4XylyFbm5uY0mAbjLyyZ/AOOrq6tZVlbWsWDBgo69e/eyoqKCgwcPPg4gSQaoIRbp27dvN7KF+tLSUr28vJwFBQXtMpvpYRIM7+wrAkDeqVOnePbsWQIoNKfzpiXPg8uXLydJJicnNwF4f+nSpW6STEtLq5fjYwhk1wkTJtSQ5Ouvv04AqTKj+N2xY8dIkgEBAW/Ie1v8wncRegwZMmQvSfbr12+3Ua33WqPfOWbMmP0kWVpaSgCDZAqcfejQIWNZsEGKgvnh9gfQb9myZd8nAEJVVZtMkUNk8CcNHTq0liR1XWdYWNhmH1mJIme80OnTp18x1rp5eXkEsNJms92Fb7e/IgEsvHz5Mp999tkmAI/l5uZeMC0B7vEqqAYAyL106RJJsra2lpWVld+sucePH38ZQG+5NncBeOrgwYMkqbe3t/Po0aOsra011wAWyl0H7x0JJ4DE+fPnu0kyPT29DsDdUrBuyNKEEAkAdpw/f/6GeoEM8GUmfwEgPCIiopwkGxsbabPZPgOw6L777vvm4p49e26VGYjFLxUhhD+ApLKyMp44ccIoVnXybgbgzkcfffRzklyzZg0BDJYCMMmoCwQFBXkLgLGWvvcWAgBToSsKwNPTp09vMR7UuLi4rwH0lgU8c/Db5ezbeeTIkRWzZ8++aMxu+fn5BPCADBwHgP4LFy701NXVEUAJgAnPP/98kyxMNgHo53A4zH77BQQETMvPz7+Um5vbBuAlAFMSExPPmdbVL0qh8Acw8fDhw5SCchVAEYAVb775JknyhRdeaJYztHfxMwLAaqNwCGC2FArv8x0hAHKNLGPKlCme5OTk/Zs3bzb7O0wKiiG8KXl5ed8IxenTp0mSR48e1UmyW7duWywBuD2xyQcgFECgoih+8H1gyJgZV5Lkyy+/3CbTRIePtl2HDBmyw1QBHyGDdXZdXR1JUghRKkXBjOMHCoBdpr0L3nvvPZLkF198wejo6O0A4lVVDTb74HQ6AwD8Wq7Jh8rgGgDgQ13XjVR8qaxJuADMbmlpYXl5uV5UVNRWUFDgfv/993Vj/ZydnU1c37eHXML4S3viAcQqitJD2l104cIFY8lTKsXSBWBMVVWVcd9yed2A1NTUQ6Zl00CvLMMOoHdubm6zFIlWOf5+PsY/Kj09vdrU11QAwwGsv3jxIk21m2DZr10I0RXAuAcffPBgaWkpV69eTYfDcdiwUxY0w6xw+flX8L1xApjevXv3lREREaW6rofB93aPDUDQpEmTMgHgtddeqwBwEd/utZvpqK6uPgEAcXFxkA94NwB9unfvjrNnz4LklwDcf08iIqv66Zs2bXrl4YcfxooVKxAbG7uqrq5uAYA2TdOEqqpGYIi2tjbl6aeffu/YsWPv5uTk7JaC1wHg4Pnz542MwoVvTx+21dbWYvjw4WLixIl+2dnZ9lGjRgmSTE1NRUpKCkwFTGiaxtTU1OXTpk3707Bhw/6g67pDipnT4biuj7qut+Lbk3Vf1tTUXI9qu91Pjq1QFEUBgJaWFgBo8yGOQ8eNGxcAAOvXr/8QwBUfYygAKL169eoCABcuXACAWtn2hOGv0+kMNO1KiPDw8F4A4rZv3/7R1KlTR0+bNu1ht9u9r1+/fqitrQXJgwDarRC6/QjPzs4+QJIffPCB9/aQmSAA43ft2mW0e1QGoi8CAPyLsZccExNTC2BlRkbGRdOyYJCP2csBIN6UAZzCd7cBbQCijYp/dXU1ExMTz6SmptaMHj36f9LS0vYlJCRsl6mxIWSdu3fv/g5J7t+/nwC2AShMTk6+SJKff/45AWRLYbD7+fndAeDf5BJnLoCCyZMnt5JkdnZ2C4B/F0KEm1Pu+Pj4rST55ZdfEsBWAK+mpaVdMo3raDn7KwDuSEpK+m+S3LBhAwG8DuCtHTt2UBbpjgC408vvcFVV15HkuXPnjMp+p5uMf0RcXNyHJNnQ0EBVVfcCWBQXF3fG+Jv0yxABPwB5LS0tRmFxN4BlTzzxxGWSXLx4sS5F3GGFy+1Hp5SUlJq6ujoWFxdTpsZ2H+0iIyMj/0iSWVlZX5mr5jfJFroPGzasxlhTnjp1iiTZ3NxMl8tlrCd9pfa9SkpKSJI5OTmnZOageLUZZqxvfVFWVkZcPwdgNwnSCKPqb17jkmR8fPzfZMDZ5CRsFBmNI7h95s2b1yhT7/MAYmStwCx4vy0uLqa3v5qmEcCfvSr1QQAeXb16NY3Cm3HQ55133iGAp+SxZTNhKSkpfzUddkrFjYevzAQCeGjp0qXfsYckY2NjTwD4leGDLCL2HTdunNtoY+zWSHFcIHdsFCtcfuZ1vO9Eqs3m7/F47sb1k2qX/f3997W2tl7BjWfpBYDOzzzzzIVJkyZh0KBBCwEsB3AJvl9AETabLcDj8dwRFRW1ctasWb8JCgpSzp07d62wsPC/Wltb8xRFadR1/ZqPXYbgAQMGbI2Pjw/+6quv9ldVVT0r01ezuPRJSUn5Y9euXXVd11WzDaqq6kePHm3+7LPPRgO4KlNuxWazhXo8nuTk5OSXMjIyEl0uFxoaGtqKior+dPXq1VdUVT0jj7r68ieoT58+vx8yZMjdx48fP1JVVTVF9m20VW02WyfZf97YsWPjXS4X6urqWvPy8jYCWCyEuEDS8FdVFKWzruv//OSTTy5OTk7uqWkaPv3007qysrJ8RVH+LI8ym8/rB3Tu3HnRI488knLo0KG2ffv2ZQI4C98vP6mqqoZqmpaclpa2cOTIkX39/f3R0NDQUVxc/G5TU9PLqqrWa5rWLH1QVFUN0TStX1JSUvH48eP7BwYG4uDBg1cKCgpeBbBe2u+2Qug2EwD5N5sMPuNtMe8XP4TT6Qxoa2sbIGeXvUKIK7d4IISiKC5d1wPljOfA9bPwzYqiXNV13dd6Uqiq6qdpml2mpe02m63d4/G4vcTF5fF47LJf71nJA6BZVVW3pmntuPHlmAD5wk6Q9NnbHp9vHaqq6tA0zU/64PZhk1FfCZB9G/23ALiqKEqzD39tpvbGUqoFwFUhRLP3yzpCCDtJpxyXDulfG27+pqRR3DXsUWVd4Yq0x/taVQjhIhksC8L+ABpM9ljBf5sKwI8pIBr75L5E4vvu+UNeG/a+hv+AL7yFH8qPtOfHjtOP6V/Bja8D6z/B2Nys/1u9Xv33tLf4GfF/LC4GCJwByWIAAAAASUVORK5CYII=",cc._loaderImage="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAAAlAAD/4QMpaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjAtYzA2MCA2MS4xMzQ3NzcsIDIwMTAvMDIvMTItMTc6MzI6MDAgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjM4MDBEMDY2QTU1MjExRTFBQTAzQjEzMUNFNzMxRkQwIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjM4MDBEMDY1QTU1MjExRTFBQTAzQjEzMUNFNzMxRkQwIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDUzUgV2luZG93cyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkU2RTk0OEM4OERCNDExRTE5NEUyRkE3M0M3QkE1NTlEIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkU2RTk0OEM5OERCNDExRTE5NEUyRkE3M0M3QkE1NTlEIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+/+4ADkFkb2JlAGTAAAAAAf/bAIQADQkJCQoJDQoKDRMMCwwTFhENDREWGhUVFhUVGhkUFhUVFhQZGR0fIB8dGScnKionJzk4ODg5QEBAQEBAQEBAQAEODAwOEA4RDw8RFA4RDhQVERISERUfFRUXFRUfKB0ZGRkZHSgjJiAgICYjLCwoKCwsNzc1NzdAQEBAQEBAQEBA/8AAEQgAyACgAwEiAAIRAQMRAf/EALAAAAEFAQEAAAAAAAAAAAAAAAQAAgMFBgcBAQEAAwEBAAAAAAAAAAAAAAAAAQMEAgUQAAIBAgIEBwoLBgQGAwAAAAECAwAEEQUhMRIGQVFxsTITFGGBwdEiQlKSMzWRoeFicqKyI1NzFYJjJDQWB9KjVCbxwkNkJWXik3QRAAIBAgMFBQcDBQEAAAAAAAABAhEDIRIEMUFRcTJhwVIUBZGhsSJyEzOB0ULhYpIjUxX/2gAMAwEAAhEDEQA/AMJSpUqAVKlXuFAeUq9wpUB5XuFe4V6ooDzZHDox0CnGMinzwl7Z8NajaHeoO3vmTBZBtp9YUIqTEV5ROxHKnWRnaU8VRMhFBUjpV7hSoSeUq9pUB5Sr2lhQHlKvcK8oBV7hSFSRrtaKAZs07YNPM1pG2xJIAw1jSeandry/8X4m8VCKkWwaWwam7Xl/4v1W8VLtmX/i/VbxUoKkWwakSM407tmX/i/VbxUmzGwjQsjdY41IARie/U0IbZO0kNtCXnOCkEBeFu4KI3Bs7DNb27ya+jDx3kJeEnpJJEcQVbWDsk17u5urd591ucZkWhym2Vnd9RkCDEpFxDRpbw0bunu5mlp2De2FMLYXOD2wB2xbOeraUcYGJ72mlSUiqzzdzMd3Z3mixltA2yzcK/NlHM1DQyRXce1HocdNOEfJXZ88y9ZojOqhiBszIRiHQ8Y4cK5TvHuzLljHNMqxNoDjLFraHHnjPxcNCGVbxEUzYNTx5jZSxhpW6qTzlwJ+DCvO2Zf+L9VvFSgqyHYNLYNTdssPxfibxUu15f8Ai/VPiqCakOwa82DU/a8v/F+JvFTDdWPBL8R8VKCvYRYV5UzoMAy6QdIIqI0B4KJtxiRQwou16QoGUkntH5Tz0RbZbmF2hktraSVBo2lUkY8tDye0flPPXTslVUyiyVRsjqUOA4yMT8dW2ram2m6UVTNq9S7EIyUVJydMTn/6DnP+im9Wl+g5z/opvVrpteEhQWY4AaSTwAVf5WPiZh/9S5/zj7zltzlmYWkfWXNvJDGTgGcYDHirR7i7mSbwXParsFMrgb7w6jKw/wCmnc9I14kF3vpvCljbMyWMOJL4aEiB8qU/ObUK7HYWVrl1pFZWiCOCBQqKOLjPGTrNZZqKbUXVHq2nNwTuJRk1VpbgXN8s7Rk5ym0UQQzhIG2NAjhxHWbI+gCBVjBBFbwxwQqEiiUJGg1BVGAFe7dV28WYLYZFmF2Th1UD7JGjymGyn1iK5OyzIBGB1HgrLZhamzumQAGJwSqnSCh1q3GOCodxt4cxurdcpzuN4cyhiWaF5Bg09udUmnWw1H/jV9nFuJ7Quo+8h8peThFA+047vduyMtk7fYqTl07YFdfUufMPzT5p71UdtlmYXaGS2t3mQHAsgxANdadYJopLe4QS2867EsZ4QfCNYrCFbjdDPmgkYyWFxgVf04ifJf6ScNdRUW1XBb6FU5TjF5EpSSrGu/s5lN+g5z/opvVpfoOc/wCim9WtdHnatvObJXDW7xLGhB8nrPaY9/HCr+tEdPCVaSeDoYLnqF63lzW4/PFSW3ecxbI84VSzWUwUaSdg0DXXK5nvAipnd6qgKvWnQO7pri9ZUEmm3Vl2j1kr8pRlFRyquBNZjGxQ/S56Y1S2fu9OVueon11Szahoou06QoQUXadIVCD2FJJ7R+U89dMydv8Axdn+TH9muZye0flPPXQstlK5Tbka1gUjlC1q0vVLkeb6r+O3Tx9xcY1nt8c0NrZCyiOE1108NYjGv1joo7Js1jzKyScYLIvkzL6LDwHXVJksH9Sb49dKNq0tj1jA6uriOCL+02FWX7iVtZX1/AzaHTyeoauKn2MX9W79zebiZCuR5MjSrhfXuEtwTrUeZH+yNfdrRNcxI6IzhXlJEak6WIGJ2Rw4ChWnChndtlVBLMdQA0k1gbXNMzzDfDLs6mjaPKppJbWwJ1bOwwxw43OnHh71YT3DpfWUJmFlb5jHHDdeXBHIsrRea5TSqvxqG04cNN62vetoCS4tre5mgnkGE9q+3DKOkuI2WX6LDQRRHWDh1UCtwj7QRg2wdl8Djgw1qe7XvW0BQ3kfZ7mSLgU+T9E6RVbnuVrnWVSWqj+Lt8ZbRuHEdKPkYVcZ2MJY5fSGyeVar45+rkWQHAqccalPE5km1htWK5nK4Wnt5FuUBUwOMG4nGkA/BXUrW4S6torlOjMgcd/xVn7rLo7zKs0uEjCNeSvdwoBhgsZxX1l2j36k3Lu+uyprdj5Vs5A+i/lD48a0aaVJOPi7jB6lbzWozpjB48pf1NDXNN4vfl7+Z4BXS65pvF78vfzPAK71XTHmZ/S/yT+jvJ7L3fHytz1E+upbL+Qj5W56jfXWRnsIYKLtekKEFGWvSFQgyjk9o/Keet3YthlMP/5x9msJJ7R+U89biyb/AMXEv7gD6tadL1T+kwepRrC39ZkLDMbiwMvUHRPG0bjlGg8ore/23sxBldxfMPLupNhT8yL/AORNZbdzJ484scytxgLqJY5LZj6Q2sV5G1Vud1mjjyG0ij0NEGSZToKyhjtqw4waztuiXA3qKTbSxltfGhbZlE95ZtZqxVbgiOZhrER9ph3Svk9+pJILZ4Y4DGBFCUMKjRsGPobPFhUfW0NJmljE2xJcIrcI2vFUEln1lRXd6lrazXT9GCNpD+yNqoI7mOVduNw6nzlOIoPOUa6yye1XXcbMR5GdQ3xY0BSbj31/FcTQZirJ+q431q7anbHCTZ72Bw7lbPrKBMcBWNNgbMBBh+bsjBdni0VJ1lARZs6yWiupxCuMDy6KpS2IwOo6DTr3Mre3e5tZZVUM4ZBjqOOJoWO4jkXajcOOMHGgDISvWIrdAkKR80+TzVl908bPPL3LzxOuHdifxVfiTAg92qI/w+/8gGgSyN/mR7XPVlp0lF/3L3mbVKtu5Hjbk/8AHE2Fc03i9+Xv5ngFdKNc13i9+Xv5ngFaNV0x5nn+l/kn9HeEWXu+PlbnqJ9dS2Xu9OVueon11kZ7CGCjLXpCgxRlr0hUIPYUcntH5Tz1s8vb+Bt1/dqPirGSe0flPPWusG/g4Py15q06XqlyMWvVYQ+ruI9xJOqzO9hOto/sP8tbGOFIrmWeM7IuMDMnAXXQJOUjQeOsJk0nY96ip0CYunrjaHx1t+srPJUbXBm2LrFPikwTOb+T+VhbZxGMrDXp83x1QSy2tucJpUjPETp+Cn5/ftaRvKvtp3Kx48HG3erHMzOxZiWZtLMdJNQSbbL71Vk6yynViOkqnEEfOWtPbXi3EQkGg6mXiNckjeSJxJGxR10qw0GtxuxmvbImD4CZMFlA4fRfv0BqesqqzTMZNMEDbIHtHH2QeCiZJSqMQdOGiue53mz3czQwsRbIcNHnkec3c4qAMuriz68gTIToxwOOnlp0MjxMJYW741Gs3RVldtbygE/dMcHX/moDaxTiWNZB53B3arb8/wC+4SOF4sf/AKxU9kcBsfOGHfoUHtG/RbzY5Die5HHhXdvavqiZ9Q8Jdlq4/gbKua7xe/L38zwCuhpf2Uk/Zo50kmwJKIdogDjw1VzzeL35e/meAVp1LTgqY4nn+mRauzqmqwrjzCLL3fHytz1E+upLL+Qj5W56jfXWRnroYKLtekKEFF2vSFQg9hSSe0flPPWosm/hIfoLzVl5PaPynnrRWb/w0X0F5q06XqlyM2sVYx5gmbFre/t71NY2T+0h8VbSO5SWNJUOKSAMp7jDGspmMPaLRlXS6eWve1/FRO7WYdbZm1Y/eW/R7qHxHRXGojlm3ulid6aVbaW+OALvgCLq2Hm9WxHKWqjhj6xsK1e8dm15l4niG1LZkswGsxtrPeOmsvayBJA1VItlWjptLuTdPMo7LtjRDq9naK4+WF9IrUW7BaHOljGqVHB7w2hzVoZt87d8vaNYSLl02CcRsDEbJbj71Uu7UBkvJ7/D7q2QoDxySaAO8MTXdxRVMpRp5XZOWdF/ms7R5XdyKfKWJsO/5PhrG5XlNxmEywW6bTnTxAAcJNbGSMXkM1pjgbiNo1PziPJ+Os7u7m/6ReM00ZOgxSpqYYHT3wRXMKN4ll9zUG4bQfNshu8sZVuEA2hirA4qe/VOwwrVbzbww5mI44UKRRYkbWG0S3JWctbd7u5WFfOOLHiUdJqmaipfLsIsObhWe001lMkMVvJNjhghIALMcBxCs7fxXQmkupx1bXDswGPlaTidVaEyKNXkoo4eBV+Sq7L7Vs9zcBgeyQ4GQ/MB1crmoim2orezqcowTuSeEY48jQ7oZX2PLzdyLhNd6RjrEY6I7+uspvH78vfzPAK6UAAAFGAGgAcArmu8Xvy9/M8ArTfio24RW5nnaG67uou3H/KPuqT2X8hHytz1G+upLL3enK3PUb66ys9RDBRdr0hQgou06QqEGUkntH5Tz1e238vF9BeaqKT2j8p56vbb+Xi+gvNWjTdUuRn1XTHmTh8KrJTJlt8t1CPIY44cGnpJVjTJYkmjaN9Ib4u7V923njTethRauZJV3PaW1rfLIiXEDYg6R4VYc9CXW7thfOZbKdbGZtLW8uPVY/u3GrkNUkM9zlcxUjbhfWOA90cRq4gv4LhdqN+VToNYWmnRm9NNVWNTyHc6VWBv8wt4YeHqm6xyPmroq1Z7WGFLSxTq7WLSuPSdjrkfumq5yHXDUeA92oO2SKpVumNAaoJLMXH3myp0rpJ4uKhc3tbDM5BMri1zAj79j7KTiY8TcdBpcsith0286o+sPCagEX9Pzg4zXUCp6QYse8oouCG3tk6m1BYv05W6T+IdyolxbHDAAa2OgDlNCz3ryN2WxBd5PJMg1t81eId2ukqnLlTBbfcuY+9uJLiRcvtPvHdsHK+cfRHcHDWsyawjyy0WBcDI3lTP6TeIcFV+S5OmXx9bJg1048o8Cj0V8Jq2DVu09nL80up7OxHi+oal3P8AXB/IsZS8T/YOV65zvCcc7vfzPAK3ivWCz445zeH954BXOr6I8yfSfyz+jvCLP3fHytz1G+upLP3fHytz1E+usbPaQ0UXadIUIKLtekKhB7Ckk9o/Keer22/l4/oLzVRSe0flPPV7b/y8X0F5q0abqlyM+q6Y8yQsBTDMor1o8aiaE1pbluMqS3sbLLHIhSRQyngqukhaJ9uBjo+H5aOa3ao2t34qouRlLajTalGP8v0IY8ylXQ+PKPFU/bYXOLPge6CKia0LaxTOxHu1Q7cuBd9yPEJ7TbjXKO8CajbMIF6CNIeNvJHjqIWJ7tSpYkalqVblwIdyG+RGXur0hXYJFxal+Dhq5y3slkv3Y2pD0pTr+QUClpJRUdo9XW4OLrTHtM16cZLLWkeC7y4jvlNEpcRtw1Ux27Ci448NZrTFy3nn3IQWxlgGrDZ3pza7/M8ArZo+ArF5171uvp+CqdV0R5l/psUrs2vB3hdl7vTlbnqJ9dS2Xu+PlbnqJ9dY2eshooq16QoQUXa9IVCD2FLJ7RuU89WNtmUSQqkgYMgw0accKrpPaPynnrZWG4Vi+VWmY5tnMWXG+XrIYnA0rhj0mdcTgdNdwnKDqjmduM1SRR/qlr8/4KX6pa8T/BVzDuLZXudRZblmbxXcPUNPc3KqCIwrbOzgrHEnHjoyD+3eSXkht7DeKG4umDGOJVUklfouThXfmbnZ7Cvy1vt9pmv1W1+d8FL9VteJvgq5yrcOGfLmzHN80iyyETPbptAEFo2ZG8pmUa1OFNn3Ky6W/sbDKM5hv5bx2WTZA+7RF2y52WOPJTzE+z2Dy1vt9pT/AKpacTerS/U7Tib1a04/t7kDXPY03jhN0W6sQ7K7W3q2dnrMccaDy/8At80kuZfqWYxWNtlcvUPPhiGYhWDeUy7IwYU8xPs9g8tb7faUn6pacTerTxm9oOBvVq3v9z927aynuId44LiWKNnjhAXF2UYhRg516qpsryjLr21665zFLSTaK9U2GOA87SwqY37knRU+BzOzags0s1Oyr+BKM6sxwP6tSDPLMen6vy0rvdm3Sxlu7K/S7WDDrFUDUTxgnTU826eXW7KlxmqQuwDBXUKcD+1Xee/wXuKX5XDGWLapSVcOyhEM/seJ/V+WnjeGx4pPV+Wkm6kKZlFay3Jlt7iFpYZY8ASVK6DjtDDA0f8A0Tl340/1f8Ndx8xJVWXB0KbktFFpNzdVXAC/qOwA0CQni2flrO3Vwbm5lnI2TKxbDirX/wBE5d+NcfV/wVR7xZPa5U9utvI8nWhmbbw0YEAYYAVxfhfy5rlKR4Fulu6X7mW1mzT8S4Yis/5CPlbnqJ9dSWfu9OVueon11mZvQ2i7XpChKKtekKhBlNJ7R+U89bDfGTb3a3ZX0Lcj6kdY+T2j8p560288m1kWQr6MJ+ylSAr+2cnV5renjs3H1loX+3j9XvbbtxLN9lqW4UnV5jdnjtXHxihtyZNjeSBu5J9k1BJe7xy7W5CJ/wCzuD/mTVTf2+fq97LJuLrPsNRueS7W6aJ/38x+vLVXuY+xvHaNxbf2GoCezf8A36j/APsSf8w1sLnqczTefJluYoLm5uo5F61sBshItP1cNFYe1f8A3ir/APfE/wCZUe9bB94r5jwuPsrQFhmG4l/Z2M17HdW90tuu3IkTHaCjWdIw0VVZdks9/C06yJFEp2dp+E1bbqybGTZ8vpQD7L1XRv8A7blT96Oda7tpNuuNE37Cq9KSisjyuUoxrStKllHbLlWTXsMs8chuSuwEPDqwoLe5y+YRE/gLzmqRekvKKtd4327yM/ulHxmrHJStySWVRyrjxKI2XC/CTlnlPPKTpTdFbP0L1bgrf5Lp0G3dPhQHwV0S1lzBsns3sESR8Crh9WAJGjSOKuU3E+zdZQ3oJh8IArdZXFDmOTpHa3i2+YrI2KtKy4ricBsBuHHgFXSo440+Wa2qqxjvM9uMoy+WvzWpLCWWWE28HxL6e43ojgkeSCBY1Ri5BGIUDT51cl3vm276BBqSEH4WbxV0tlkyXJcxTMb+OW6uY9mGHrCzDQwwAbTp2uKuTZ9N1uYsfRRR8WPhrm419mSSjRyiqxVK7y23B/ftuTm2oSdJyzNVw3BFn7vTlbnqF9dS2fu9OVueon11lZuQ2iLdsGFD05H2dNQGV0ntG5Tz1dWm9N1b2kVq8EVwsI2UaQaQOKhmitZGLOmk68DhSFvY+gfWNSAg7z3Qvo7yKCKIohiaNR5LKxx8qpxvjcqS0VpbxvwOAcRQPZ7D0G9Y0uz2HoH1jUCpLY7zXlpbm3eKO5QuzjrBqZji3x17PvNcyT288VvDBJbMWUovS2hslW7mFQ9nsPQPrGl2ew9A+saCod/WNxtbYsrfb17WBxx5ddD2281xC88klvDcSXEnWuzrqOGGC9zRUPZ7D0G9Y0uzWHoH1jQVCLreq6ntZbaO3it1mGy7RjTs1X2mYy20ZiCq8ZOODcdEdmsPQb1jS7PYegfWNdJuLqnQiSUlRqpFLmryxtH1Ma7Qw2gNNPOdSt0oI27p007s9h6B9Y0uz2HoH1jXX3Z+I4+1b8IJdX89xLHKQFMXQUahpxoiPN5P+onfU+A0/s9h6DesaXZ7D0D6xpG7OLbUtu0StW5JJx2bBsmbtiSiEk+cxoCWWSaVpZOk2vDVo0VYdnsPQb1jSNvZcCH1jSd2c+p1XAmFqEOmOPEfaH+BQd1ueo211IzrgFUYKNAAqI1WztCpUqVCRUqVKgFSpUqAVKlSoBUqVKgFSpUqAVKlSoBUqVKgFSpUqAVKlSoD/9k=";var cc=cc||{},ClassManager={id:0|998*Math.random(),instanceId:0|998*Math.random(),compileSuper:function(t,e,i){t=t.toString();var n=t.indexOf("("),r=t.indexOf(")"),n=t.substring(n+1,r),n=n.trim(),r=t.indexOf("{"),o=t.lastIndexOf("}");for(t=t.substring(r+1,o);-1!==t.indexOf("this._super");){var r=t.indexOf("this._super"),o=t.indexOf("(",r),s=t.indexOf(")",o),s=t.substring(o+1,s),s=(s=s.trim())?",":"";t=t.substring(0,r)+"ClassManager["+i+"]."+e+".call(this"+s+t.substring(o+1)}return Function(n,t)},getNewID:function(){return this.id++},getNewInstanceId:function(){return this.instanceId++}};switch(ClassManager.compileSuper.ClassManager=ClassManager,function(){var t=/\b_super\b/,e=cc.game.config[cc.game.CONFIG_KEY.classReleaseMode];e&&console.log("release Mode"),cc.Class=function(){},cc.Class.extend=function(){function i(){this.__instanceId=ClassManager.getNewInstanceId(),this.ctor&&this.ctor.apply(this,arguments)}var n=this.prototype,r=Object.create(n),o=ClassManager.getNewID();ClassManager[o]=n;var s={writable:!0,enumerable:!1,configurable:!0};r.__instanceId=null,i.id=o,s.value=o,Object.defineProperty(r,"__pid",s),i.prototype=r,s.value=i,Object.defineProperty(i.prototype,"constructor",s),this.__getters__&&(i.__getters__=cc.clone(this.__getters__)),this.__setters__&&(i.__setters__=cc.clone(this.__setters__));for(var c=0,a=arguments.length;a>c;++c){var l,h=arguments[c];for(l in h){var u="function"==typeof h[l],d="function"==typeof n[l],_=t.test(h[l]);if(e&&u&&d&&_?(s.value=ClassManager.compileSuper(h[l],l,o),Object.defineProperty(r,l,s)):u&&d&&_?(s.value=function(t,e){return function(){var i=this._super;this._super=n[t];var r=e.apply(this,arguments);return this._super=i,r}}(l,h[l]),Object.defineProperty(r,l,s)):u?(s.value=h[l],Object.defineProperty(r,l,s)):r[l]=h[l],u){var p,f;if(this.__getters__&&this.__getters__[l]){var m,u=this.__getters__[l];for(m in this.__setters__)if(this.__setters__[m]===u){f=m;break}cc.defineGetterSetter(r,u,h[l],h[f]?h[f]:r[f],l,f)}if(this.__setters__&&this.__setters__[l]){u=this.__setters__[l];for(m in this.__getters__)if(this.__getters__[m]===u){p=m;break}cc.defineGetterSetter(r,u,h[p]?h[p]:r[p],h[l],p,l)}}}}return i.extend=cc.Class.extend,i.implement=function(t){for(var e in t)r[e]=t[e]},i}}(),cc.defineGetterSetter=function(t,e,i,n,r,o){if(t.__defineGetter__)i&&t.__defineGetter__(e,i),n&&t.__defineSetter__(e,n);else{if(!Object.defineProperty)throw Error("browser does not support getters");var s={enumerable:!1,configurable:!0};i&&(s.get=i),n&&(s.set=n),Object.defineProperty(t,e,s)}if(!r&&!o)for(var s=null!=i,c=void 0!=n,a=Object.getOwnPropertyNames(t),l=0;l<a.length;l++){var h=a[l];if((t.__lookupGetter__?!t.__lookupGetter__(h):!Object.getOwnPropertyDescriptor(t,h))&&"function"==typeof t[h]){var u=t[h];if(s&&u===i&&(r=h,!c||o))break;if(c&&u===n&&(o=h,!s||r))break}}t=t.constructor,r&&(t.__getters__||(t.__getters__={}),t.__getters__[r]=e),o&&(t.__setters__||(t.__setters__={}),t.__setters__[o]=e)},cc.clone=function(t){var e,i=t.constructor?new t.constructor:{};for(e in t){var n=t[e];i[e]="object"!=typeof n||!n||n instanceof cc.Node||n instanceof HTMLElement?n:cc.clone(n)}return i},cc.inject=function(t,e){for(var i in t)e[i]=t[i]},cc=cc||{},cc._tmp=cc._tmp||{},cc.associateWithNative=function(){},cc.KEY={none:0,back:6,menu:18,backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,select:41,insert:45,Delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,num0:96,num1:97,num2:98,num3:99,num4:100,num5:101,num6:102,num7:103,num8:104,num9:105,"*":106,"+":107,"-":109,numdel:110,"/":111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,";":186,semicolon:186,equal:187,"=":187,",":188,comma:188,dash:189,".":190,period:190,forwardslash:191,grave:192,"[":219,openbracket:219,backslash:220,"]":221,closebracket:221,quote:222,dpadLeft:1e3,dpadRight:1001,dpadUp:1003,dpadDown:1004,dpadCenter:1005},cc.FMT_JPG=0,cc.FMT_PNG=1,cc.FMT_TIFF=2,cc.FMT_RAWDATA=3,cc.FMT_WEBP=4,cc.FMT_UNKNOWN=5,cc.getImageFormatByData=function(t){return 8<t.length&&137===t[0]&&80===t[1]&&78===t[2]&&71===t[3]&&13===t[4]&&10===t[5]&&26===t[6]&&10===t[7]?cc.FMT_PNG:2<t.length&&(73===t[0]&&73===t[1]||77===t[0]&&77===t[1]||255===t[0]&&216===t[1])?cc.FMT_TIFF:cc.FMT_UNKNOWN},cc.inherits=function(t,e){function i(){}i.prototype=e.prototype,t.superClass_=e.prototype,t.prototype=new i,t.prototype.constructor=t},cc.base=function(t,e){var i=arguments.callee.caller;if(i.superClass_)return ret=i.superClass_.constructor.apply(t,Array.prototype.slice.call(arguments,1));for(var n=Array.prototype.slice.call(arguments,2),r=!1,o=t.constructor;o;o=o.superClass_&&o.superClass_.constructor)if(o.prototype[e]===i)r=!0;else if(r)return o.prototype[e].apply(t,n);if(t[e]===i)return t.constructor.prototype[e].apply(t,n);throw Error("cc.base called from a method of one name to a method of a different name")},cc.Point=function(t,e){this.x=t||0,this.y=e||0},cc.p=function(t,e){return void 0===t?{x:0,y:0}:void 0===e?{x:t.x,y:t.y}:{x:t,y:e}},cc.pointEqualToPoint=function(t,e){return t&&e&&t.x===e.x&&t.y===e.y},cc.Size=function(t,e){this.width=t||0,this.height=e||0},cc.size=function(t,e){return void 0===t?{width:0,height:0}:void 0===e?{width:t.width,height:t.height}:{width:t,height:e}},cc.sizeEqualToSize=function(t,e){return t&&e&&t.width===e.width&&t.height===e.height},cc.Rect=function(t,e,i,n){this.x=t||0,this.y=e||0,this.width=i||0,this.height=n||0},cc.rect=function(t,e,i,n){return void 0===t?{x:0,y:0,width:0,height:0}:void 0===e?{x:t.x,y:t.y,width:t.width,height:t.height}:{x:t,y:e,width:i,height:n}},cc.rectEqualToRect=function(t,e){return t&&e&&t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height},cc._rectEqualToZero=function(t){return t&&0===t.x&&0===t.y&&0===t.width&&0===t.height},cc.rectContainsRect=function(t,e){return t&&e?!(t.x>=e.x||t.y>=e.y||t.x+t.width<=e.x+e.width||t.y+t.height<=e.y+e.height):!1},cc.rectGetMaxX=function(t){return t.x+t.width},cc.rectGetMidX=function(t){return t.x+t.width/2},cc.rectGetMinX=function(t){return t.x},cc.rectGetMaxY=function(t){return t.y+t.height},cc.rectGetMidY=function(t){return t.y+t.height/2},cc.rectGetMinY=function(t){return t.y},cc.rectContainsPoint=function(t,e){return e.x>=cc.rectGetMinX(t)&&e.x<=cc.rectGetMaxX(t)&&e.y>=cc.rectGetMinY(t)&&e.y<=cc.rectGetMaxY(t)},cc.rectIntersectsRect=function(t,e){var i=t.y+t.height,n=e.x+e.width,r=e.y+e.height;return!(t.x+t.width<e.x||n<t.x||i<e.y||r<t.y)},cc.rectOverlapsRect=function(t,e){return!(t.x+t.width<e.x||e.x+e.width<t.x||t.y+t.height<e.y||e.y+e.height<t.y)},cc.rectUnion=function(t,e){var i=cc.rect(0,0,0,0);return i.x=Math.min(t.x,e.x),i.y=Math.min(t.y,e.y),i.width=Math.max(t.x+t.width,e.x+e.width)-i.x,i.height=Math.max(t.y+t.height,e.y+e.height)-i.y,i},cc.rectIntersection=function(t,e){var i=cc.rect(Math.max(cc.rectGetMinX(t),cc.rectGetMinX(e)),Math.max(cc.rectGetMinY(t),cc.rectGetMinY(e)),0,0);return i.width=Math.min(cc.rectGetMaxX(t),cc.rectGetMaxX(e))-cc.rectGetMinX(i),i.height=Math.min(cc.rectGetMaxY(t),cc.rectGetMaxY(e))-cc.rectGetMinY(i),i},cc.SAXParser=cc.Class.extend({_parser:null,_isSupportDOMParser:null,ctor:function(){window.DOMParser?(this._isSupportDOMParser=!0,this._parser=new DOMParser):this._isSupportDOMParser=!1},parse:function(t){return this._parseXML(t)},_parseXML:function(t){var e;return this._isSupportDOMParser?e=this._parser.parseFromString(t,"text/xml"):(e=new ActiveXObject("Microsoft.XMLDOM"),e.async="false",e.loadXML(t)),e}}),cc.PlistParser=cc.SAXParser.extend({parse:function(t){if(t=this._parseXML(t).documentElement,"plist"!==t.tagName)throw"Not a plist file!";for(var e=null,i=0,n=t.childNodes.length;n>i&&(e=t.childNodes[i],1!==e.nodeType);i++);return this._parseNode(e)},_parseNode:function(t){var e=null,i=t.tagName;if("dict"===i)e=this._parseDict(t);else if("array"===i)e=this._parseArray(t);else if("string"===i)if(1===t.childNodes.length)e=t.firstChild.nodeValue;else for(e="",i=0;i<t.childNodes.length;i++)e+=t.childNodes[i].nodeValue;else"false"===i?e=!1:"true"===i?e=!0:"real"===i?e=parseFloat(t.firstChild.nodeValue):"integer"===i&&(e=parseInt(t.firstChild.nodeValue,10));
return e},_parseArray:function(t){for(var e=[],i=0,n=t.childNodes.length;n>i;i++){var r=t.childNodes[i];1===r.nodeType&&e.push(this._parseNode(r))}return e},_parseDict:function(t){for(var e={},i=null,n=0,r=t.childNodes.length;r>n;n++){var o=t.childNodes[n];1===o.nodeType&&("key"===o.tagName?i=o.firstChild.nodeValue:e[i]=this._parseNode(o))}return e}}),cc._txtLoader={load:function(t,e,i,n){cc.loader.loadTxt(t,n)}},cc.loader.register(["txt","xml","vsh","fsh","atlas"],cc._txtLoader),cc._jsonLoader={load:function(t,e,i,n){cc.loader.loadJson(t,n)}},cc.loader.register(["json","ExportJson"],cc._jsonLoader),cc._jsLoader={load:function(t,e,i,n){cc.loader.loadJs(t,n)}},cc.loader.register(["js"],cc._jsLoader),cc._imgLoader={load:function(t,e,i,n){cc.loader.cache[e]=cc.loader.loadImg(t,function(t,i){return t?n(t):(cc.textureCache.handleLoadedTexture(e),void n(null,i))})}},cc.loader.register("png jpg bmp jpeg gif ico tiff".split(" "),cc._imgLoader),cc._serverImgLoader={load:function(t,e,i,n){cc.loader.cache[e]=cc.loader.loadImg(i.src,function(t,i){return t?n(t):(cc.textureCache.handleLoadedTexture(e),void n(null,i))})}},cc.loader.register(["serverImg"],cc._serverImgLoader),cc._plistLoader={load:function(t,e,i,n){cc.loader.loadTxt(t,function(t,e){return t?n(t):void n(null,cc.plistParser.parse(e))})}},cc.loader.register(["plist"],cc._plistLoader),cc._fontLoader={TYPE:{".eot":"embedded-opentype",".ttf":"truetype",".ttc":"truetype",".woff":"woff",".svg":"svg"},_loadFont:function(t,e,i){var n=document,r=cc.path,o=this.TYPE,s=cc.newElement("style");s.type="text/css",n.body.appendChild(s);var c="",c=isNaN(t-0)?c+("@font-face { font-family:"+t+"; src:"):c+("@font-face { font-family:'"+t+"'; src:");if(e instanceof Array)for(var a=0,l=e.length;l>a;a++)i=r.extname(e[a]).toLowerCase(),c+="url('"+e[a]+"') format('"+o[i]+"')",c+=a===l-1?";":",";else i=i.toLowerCase(),c+="url('"+e+"') format('"+o[i]+"');";s.textContent+=c+"}",e=cc.newElement("div"),i=e.style,i.fontFamily=t,e.innerHTML=".",i.position="absolute",i.left="-100px",i.top="-100px",n.body.appendChild(e)},load:function(t,e,i,n){e=i.type,t=i.name,e=i.srcs,cc.isString(i)?(e=cc.path.extname(i),t=cc.path.basename(i,e),this._loadFont(t,i,e)):this._loadFont(t,e),n(null,!0)}},cc.loader.register("font eot ttf woff svg ttc".split(" "),cc._fontLoader),cc._binaryLoader={load:function(t,e,i,n){cc.loader.loadBinary(t,n)}},cc._csbLoader={load:function(t,e,i,n){cc.loader.loadCsb(t,n)}},cc.loader.register(["csb"],cc._csbLoader),window.CocosEngine=cc.ENGINE_VERSION="Cocos2d-JS v3.7",cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL=0,cc.DIRECTOR_STATS_POSITION=cc.p(0,0),cc.DIRECTOR_FPS_INTERVAL=.5,cc.COCOSNODE_RENDER_SUBPIXEL=1,cc.SPRITEBATCHNODE_RENDER_SUBPIXEL=1,cc.OPTIMIZE_BLEND_FUNC_FOR_PREMULTIPLIED_ALPHA=1,cc.TEXTURE_ATLAS_USE_TRIANGLE_STRIP=0,cc.TEXTURE_ATLAS_USE_VAO=0,cc.TEXTURE_NPOT_SUPPORT=0,cc.RETINA_DISPLAY_SUPPORT=1,cc.RETINA_DISPLAY_FILENAME_SUFFIX="-hd",cc.USE_LA88_LABELS=1,cc.SPRITE_DEBUG_DRAW=0,cc.SPRITEBATCHNODE_DEBUG_DRAW=0,cc.LABELBMFONT_DEBUG_DRAW=0,cc.LABELATLAS_DEBUG_DRAW=0,cc.IS_RETINA_DISPLAY_SUPPORTED=1,cc.DEFAULT_ENGINE=cc.ENGINE_VERSION+"-canvas",cc.ENABLE_STACKABLE_ACTIONS=1,cc.ENABLE_GL_STATE_CACHE=1,cc.$=function(t){var e=this===cc?document:this;return(t=t instanceof HTMLElement?t:e.querySelector(t))&&(t.find=t.find||cc.$,t.hasClass=t.hasClass||function(t){return this.className.match(RegExp("(\\s|^)"+t+"(\\s|$)"))},t.addClass=t.addClass||function(t){return this.hasClass(t)||(this.className&&(this.className+=" "),this.className+=t),this},t.removeClass=t.removeClass||function(t){return this.hasClass(t)&&(this.className=this.className.replace(t,"")),this},t.remove=t.remove||function(){return this.parentNode&&this.parentNode.removeChild(this),this},t.appendTo=t.appendTo||function(t){return t.appendChild(this),this},t.prependTo=t.prependTo||function(t){return t.childNodes[0]?t.insertBefore(this,t.childNodes[0]):t.appendChild(this),this},t.transforms=t.transforms||function(){return this.style[cc.$.trans]=cc.$.translate(this.position)+cc.$.rotate(this.rotation)+cc.$.scale(this.scale)+cc.$.skew(this.skew),this},t.position=t.position||{x:0,y:0},t.rotation=t.rotation||0,t.scale=t.scale||{x:1,y:1},t.skew=t.skew||{x:0,y:0},t.translates=function(t,e){return this.position.x=t,this.position.y=e,this.transforms(),this},t.rotate=function(t){return this.rotation=t,this.transforms(),this},t.resize=function(t,e){return this.scale.x=t,this.scale.y=e,this.transforms(),this},t.setSkew=function(t,e){return this.skew.x=t,this.skew.y=e,this.transforms(),this}),t},cc.sys.browserType){case cc.sys.BROWSER_TYPE_FIREFOX:cc.$.pfx="Moz",cc.$.hd=!0;break;case cc.sys.BROWSER_TYPE_CHROME:case cc.sys.BROWSER_TYPE_SAFARI:cc.$.pfx="webkit",cc.$.hd=!0;break;case cc.sys.BROWSER_TYPE_OPERA:cc.$.pfx="O",cc.$.hd=!1;break;case cc.sys.BROWSER_TYPE_IE:cc.$.pfx="ms",cc.$.hd=!1;break;default:cc.$.pfx="webkit",cc.$.hd=!0}switch(cc.$.trans=cc.$.pfx+"Transform",cc.$.translate=cc.$.hd?function(t){return"translate3d("+t.x+"px, "+t.y+"px, 0) "}:function(t){return"translate("+t.x+"px, "+t.y+"px) "},cc.$.rotate=cc.$.hd?function(t){return"rotateZ("+t+"deg) "}:function(t){return"rotate("+t+"deg) "},cc.$.scale=function(t){return"scale("+t.x+", "+t.y+") "},cc.$.skew=function(t){return"skewX("+-t.x+"deg) skewY("+t.y+"deg)"},cc.$new=function(t){return cc.$(document.createElement(t))},cc.$.findpos=function(t){var e=0,i=0;do e+=t.offsetLeft,i+=t.offsetTop;while(t=t.offsetParent);return{x:e,y:i}},cc.INVALID_INDEX=-1,cc.PI=Math.PI,cc.FLT_MAX=parseFloat("3.402823466e+38F"),cc.FLT_MIN=parseFloat("1.175494351e-38F"),cc.RAD=cc.PI/180,cc.DEG=180/cc.PI,cc.UINT_MAX=4294967295,cc.swap=function(t,e,i){if(!cc.isObject(i)||cc.isUndefined(i.x)||cc.isUndefined(i.y))cc.log(cc._LogInfos.swap);else{var n=i[t];i[t]=i[e],i[e]=n}},cc.lerp=function(t,e,i){return t+(e-t)*i},cc.rand=function(){return 16777215*Math.random()},cc.randomMinus1To1=function(){return 2*(Math.random()-.5)},cc.random0To1=Math.random,cc.degreesToRadians=function(t){return t*cc.RAD},cc.radiansToDegrees=function(t){return t*cc.DEG},cc.radiansToDegress=function(t){return cc.log(cc._LogInfos.radiansToDegress),t*cc.DEG},cc.REPEAT_FOREVER=Number.MAX_VALUE-1,cc.nodeDrawSetup=function(t){t._shaderProgram&&(t._shaderProgram.use(),t._shaderProgram.setUniformForModelViewAndProjectionMatrixWithMat4())},cc.enableDefaultGLStates=function(){},cc.disableDefaultGLStates=function(){},cc.incrementGLDraws=function(t){cc.g_NumberOfDraws+=t},cc.FLT_EPSILON=1.192092896e-7,cc.contentScaleFactor=cc.IS_RETINA_DISPLAY_SUPPORTED?function(){return cc.director.getContentScaleFactor()}:function(){return 1},cc.pointPointsToPixels=function(t){var e=cc.contentScaleFactor();return cc.p(t.x*e,t.y*e)},cc.pointPixelsToPoints=function(t){var e=cc.contentScaleFactor();return cc.p(t.x/e,t.y/e)},cc._pointPixelsToPointsOut=function(t,e){var i=cc.contentScaleFactor();e.x=t.x/i,e.y=t.y/i},cc.sizePointsToPixels=function(t){var e=cc.contentScaleFactor();return cc.size(t.width*e,t.height*e)},cc.sizePixelsToPoints=function(t){var e=cc.contentScaleFactor();return cc.size(t.width/e,t.height/e)},cc._sizePixelsToPointsOut=function(t,e){var i=cc.contentScaleFactor();e.width=t.width/i,e.height=t.height/i},cc.rectPixelsToPoints=cc.IS_RETINA_DISPLAY_SUPPORTED?function(t){var e=cc.contentScaleFactor();return cc.rect(t.x/e,t.y/e,t.width/e,t.height/e)}:function(t){return t},cc.rectPointsToPixels=cc.IS_RETINA_DISPLAY_SUPPORTED?function(t){var e=cc.contentScaleFactor();return cc.rect(t.x*e,t.y*e,t.width*e,t.height*e)}:function(t){return t},cc.ONE=1,cc.ZERO=0,cc.SRC_ALPHA=770,cc.SRC_ALPHA_SATURATE=776,cc.SRC_COLOR=768,cc.DST_ALPHA=772,cc.DST_COLOR=774,cc.ONE_MINUS_SRC_ALPHA=771,cc.ONE_MINUS_SRC_COLOR=769,cc.ONE_MINUS_DST_ALPHA=773,cc.ONE_MINUS_DST_COLOR=775,cc.ONE_MINUS_CONSTANT_ALPHA=32772,cc.ONE_MINUS_CONSTANT_COLOR=32770,cc.LINEAR=9729,cc.REPEAT=10497,cc.CLAMP_TO_EDGE=33071,cc.MIRRORED_REPEAT=33648,cc.BLEND_SRC=cc._renderType===cc._RENDER_TYPE_WEBGL&&cc.OPTIMIZE_BLEND_FUNC_FOR_PREMULTIPLIED_ALPHA?cc.ONE:cc.SRC_ALPHA,cc.BLEND_DST=771,cc.checkGLErrorDebug=function(){if(cc.renderMode===cc._RENDER_TYPE_WEBGL){var t=cc._renderContext.getError();t&&cc.log(cc._LogInfos.checkGLErrorDebug,t)}},cc.DEVICE_ORIENTATION_PORTRAIT=0,cc.DEVICE_ORIENTATION_LANDSCAPE_LEFT=1,cc.DEVICE_ORIENTATION_PORTRAIT_UPSIDE_DOWN=2,cc.DEVICE_ORIENTATION_LANDSCAPE_RIGHT=3,cc.DEVICE_MAX_ORIENTATIONS=2,cc.VERTEX_ATTRIB_FLAG_NONE=0,cc.VERTEX_ATTRIB_FLAG_POSITION=1,cc.VERTEX_ATTRIB_FLAG_COLOR=2,cc.VERTEX_ATTRIB_FLAG_TEX_COORDS=4,cc.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX=cc.VERTEX_ATTRIB_FLAG_POSITION|cc.VERTEX_ATTRIB_FLAG_COLOR|cc.VERTEX_ATTRIB_FLAG_TEX_COORDS,cc.GL_ALL=0,cc.VERTEX_ATTRIB_POSITION=0,cc.VERTEX_ATTRIB_COLOR=1,cc.VERTEX_ATTRIB_TEX_COORDS=2,cc.VERTEX_ATTRIB_MAX=3,cc.UNIFORM_PMATRIX=0,cc.UNIFORM_MVMATRIX=1,cc.UNIFORM_MVPMATRIX=2,cc.UNIFORM_TIME=3,cc.UNIFORM_SINTIME=4,cc.UNIFORM_COSTIME=5,cc.UNIFORM_RANDOM01=6,cc.UNIFORM_SAMPLER=7,cc.UNIFORM_MAX=8,cc.SHADER_POSITION_TEXTURECOLOR="ShaderPositionTextureColor",cc.SHADER_POSITION_TEXTURECOLORALPHATEST="ShaderPositionTextureColorAlphaTest",cc.SHADER_POSITION_COLOR="ShaderPositionColor",cc.SHADER_POSITION_TEXTURE="ShaderPositionTexture",cc.SHADER_POSITION_TEXTURE_UCOLOR="ShaderPositionTexture_uColor",cc.SHADER_POSITION_TEXTUREA8COLOR="ShaderPositionTextureA8Color",cc.SHADER_POSITION_UCOLOR="ShaderPosition_uColor",cc.SHADER_POSITION_LENGTHTEXTURECOLOR="ShaderPositionLengthTextureColor",cc.UNIFORM_PMATRIX_S="CC_PMatrix",cc.UNIFORM_MVMATRIX_S="CC_MVMatrix",cc.UNIFORM_MVPMATRIX_S="CC_MVPMatrix",cc.UNIFORM_TIME_S="CC_Time",cc.UNIFORM_SINTIME_S="CC_SinTime",cc.UNIFORM_COSTIME_S="CC_CosTime",cc.UNIFORM_RANDOM01_S="CC_Random01",cc.UNIFORM_SAMPLER_S="CC_Texture0",cc.UNIFORM_ALPHA_TEST_VALUE_S="CC_alpha_value",cc.ATTRIBUTE_NAME_COLOR="a_color",cc.ATTRIBUTE_NAME_POSITION="a_position",cc.ATTRIBUTE_NAME_TEX_COORD="a_texCoord",cc.ITEM_SIZE=32,cc.CURRENT_ITEM=3233828865,cc.ZOOM_ACTION_TAG=3233828866,cc.NORMAL_TAG=8801,cc.SELECTED_TAG=8802,cc.DISABLE_TAG=8803,cc.arrayVerifyType=function(t,e){if(t&&0<t.length)for(var i=0;i<t.length;i++)if(!(t[i]instanceof e))return cc.log("element type is wrong!"),!1;return!0},cc.arrayRemoveObject=function(t,e){for(var i=0,n=t.length;n>i;i++)if(t[i]===e){t.splice(i,1);break}},cc.arrayRemoveArray=function(t,e){for(var i=0,n=e.length;n>i;i++)cc.arrayRemoveObject(t,e[i])},cc.arrayAppendObjectsToIndex=function(t,e,i){return t.splice.apply(t,[i,0].concat(e)),t},cc.copyArray=function(t){var e,i=t.length,n=Array(i);for(e=0;i>e;e+=1)n[e]=t[e];return n},cc=cc||{},cc._tmp=cc._tmp||{},cc._tmp.WebGLColor=function(){cc.color=function(t,e,i,n,r,o){return void 0===t?new cc.Color(0,0,0,255,r,o):cc.isString(t)?(t=cc.hexToColor(t),new cc.Color(t.r,t.g,t.b,t.a)):cc.isObject(t)?new cc.Color(t.r,t.g,t.b,t.a,t.arrayBuffer,t.offset):new cc.Color(t,e,i,n,r,o)},cc.Color=function(t,e,i,n,r,o){this._arrayBuffer=r||new ArrayBuffer(cc.Color.BYTES_PER_ELEMENT),this._offset=o||0,r=this._arrayBuffer,o=this._offset;var s=Uint8Array.BYTES_PER_ELEMENT;this._rU8=new Uint8Array(r,o,1),this._gU8=new Uint8Array(r,o+s,1),this._bU8=new Uint8Array(r,o+2*s,1),this._aU8=new Uint8Array(r,o+3*s,1),this._rU8[0]=t||0,this._gU8[0]=e||0,this._bU8[0]=i||0,this._aU8[0]=null==n?255:n,void 0===n&&(this.a_undefined=!0)},cc.Color.BYTES_PER_ELEMENT=4;var t=cc.Color.prototype;t._getR=function(){return this._rU8[0]},t._setR=function(t){this._rU8[0]=0>t?0:t},t._getG=function(){return this._gU8[0]},t._setG=function(t){this._gU8[0]=0>t?0:t},t._getB=function(){return this._bU8[0]},t._setB=function(t){this._bU8[0]=0>t?0:t},t._getA=function(){return this._aU8[0]},t._setA=function(t){this._aU8[0]=0>t?0:t},cc.defineGetterSetter(t,"r",t._getR,t._setR),cc.defineGetterSetter(t,"g",t._getG,t._setG),cc.defineGetterSetter(t,"b",t._getB,t._setB),cc.defineGetterSetter(t,"a",t._getA,t._setA),cc.Vertex2F=function(t,e,i,n){this._arrayBuffer=i||new ArrayBuffer(cc.Vertex2F.BYTES_PER_ELEMENT),this._offset=n||0,this._xF32=new Float32Array(this._arrayBuffer,this._offset,1),this._yF32=new Float32Array(this._arrayBuffer,this._offset+4,1),this._xF32[0]=t||0,this._yF32[0]=e||0},cc.Vertex2F.BYTES_PER_ELEMENT=8,t=cc.Vertex2F.prototype,t._getX=function(){return this._xF32[0]},t._setX=function(t){this._xF32[0]=t},t._getY=function(){return this._yF32[0]},t._setY=function(t){this._yF32[0]=t},cc.defineGetterSetter(t,"x",t._getX,t._setX),cc.defineGetterSetter(t,"y",t._getY,t._setY),cc.Vertex3F=function(t,e,i,n,r){this._arrayBuffer=n||new ArrayBuffer(cc.Vertex3F.BYTES_PER_ELEMENT),this._offset=r||0,n=this._arrayBuffer,r=this._offset,this._xF32=new Float32Array(n,r,1),this._xF32[0]=t||0,this._yF32=new Float32Array(n,r+Float32Array.BYTES_PER_ELEMENT,1),this._yF32[0]=e||0,this._zF32=new Float32Array(n,r+2*Float32Array.BYTES_PER_ELEMENT,1),this._zF32[0]=i||0},cc.Vertex3F.BYTES_PER_ELEMENT=12,t=cc.Vertex3F.prototype,t._getX=function(){return this._xF32[0]},t._setX=function(t){this._xF32[0]=t},t._getY=function(){return this._yF32[0]},t._setY=function(t){this._yF32[0]=t},t._getZ=function(){return this._zF32[0]},t._setZ=function(t){this._zF32[0]=t},cc.defineGetterSetter(t,"x",t._getX,t._setX),cc.defineGetterSetter(t,"y",t._getY,t._setY),cc.defineGetterSetter(t,"z",t._getZ,t._setZ),cc.Tex2F=function(t,e,i,n){this._arrayBuffer=i||new ArrayBuffer(cc.Tex2F.BYTES_PER_ELEMENT),this._offset=n||0,this._uF32=new Float32Array(this._arrayBuffer,this._offset,1),this._vF32=new Float32Array(this._arrayBuffer,this._offset+4,1),this._uF32[0]=t||0,this._vF32[0]=e||0},cc.Tex2F.BYTES_PER_ELEMENT=8,t=cc.Tex2F.prototype,t._getU=function(){return this._uF32[0]},t._setU=function(t){this._uF32[0]=t},t._getV=function(){return this._vF32[0]},t._setV=function(t){this._vF32[0]=t},cc.defineGetterSetter(t,"u",t._getU,t._setU),cc.defineGetterSetter(t,"v",t._getV,t._setV),cc.Quad2=function(t,e,i,n,r,o){this._arrayBuffer=r||new ArrayBuffer(cc.Quad2.BYTES_PER_ELEMENT),this._offset=o||0,r=this._arrayBuffer,o=cc.Vertex2F.BYTES_PER_ELEMENT,this._tl=t?new cc.Vertex2F(t.x,t.y,r,0):new cc.Vertex2F(0,0,r,0),this._tr=e?new cc.Vertex2F(e.x,e.y,r,o):new cc.Vertex2F(0,0,r,o),this._bl=i?new cc.Vertex2F(i.x,i.y,r,2*o):new cc.Vertex2F(0,0,r,2*o),this._br=n?new cc.Vertex2F(n.x,n.y,r,3*o):new cc.Vertex2F(0,0,r,3*o)},cc.Quad2.BYTES_PER_ELEMENT=32,t=cc.Quad2.prototype,t._getTL=function(){return this._tl},t._setTL=function(t){this._tl.x=t.x,this._tl.y=t.y},t._getTR=function(){return this._tr},t._setTR=function(t){this._tr.x=t.x,this._tr.y=t.y},t._getBL=function(){return this._bl},t._setBL=function(t){this._bl.x=t.x,this._bl.y=t.y},t._getBR=function(){return this._br},t._setBR=function(t){this._br.x=t.x,this._br.y=t.y},cc.defineGetterSetter(t,"tl",t._getTL,t._setTL),cc.defineGetterSetter(t,"tr",t._getTR,t._setTR),cc.defineGetterSetter(t,"bl",t._getBL,t._setBL),cc.defineGetterSetter(t,"br",t._getBR,t._setBR),cc.Quad3=function(t,e,i,n){this.bl=t||new cc.Vertex3F(0,0,0),this.br=e||new cc.Vertex3F(0,0,0),this.tl=i||new cc.Vertex3F(0,0,0),this.tr=n||new cc.Vertex3F(0,0,0)},cc.V3F_C4B_T2F=function(t,e,i,n,r){this._arrayBuffer=n||new ArrayBuffer(cc.V3F_C4B_T2F.BYTES_PER_ELEMENT),this._offset=r||0,n=this._arrayBuffer,r=this._offset;var o=cc.Vertex3F.BYTES_PER_ELEMENT;this._vertices=t?new cc.Vertex3F(t.x,t.y,t.z,n,r):new cc.Vertex3F(0,0,0,n,r),this._colors=e?cc.color(e.r,e.g,e.b,e.a,n,r+o):cc.color(0,0,0,0,n,r+o),this._texCoords=i?new cc.Tex2F(i.u,i.v,n,r+o+cc.Color.BYTES_PER_ELEMENT):new cc.Tex2F(0,0,n,r+o+cc.Color.BYTES_PER_ELEMENT)},cc.V3F_C4B_T2F.BYTES_PER_ELEMENT=24,t=cc.V3F_C4B_T2F.prototype,t._getVertices=function(){return this._vertices},t._setVertices=function(t){var e=this._vertices;e.x=t.x,e.y=t.y,e.z=t.z},t._getColor=function(){return this._colors},t._setColor=function(t){var e=this._colors;e.r=t.r,e.g=t.g,e.b=t.b,e.a=t.a},t._getTexCoords=function(){return this._texCoords},t._setTexCoords=function(t){this._texCoords.u=t.u,this._texCoords.v=t.v},cc.defineGetterSetter(t,"vertices",t._getVertices,t._setVertices),cc.defineGetterSetter(t,"colors",t._getColor,t._setColor),cc.defineGetterSetter(t,"texCoords",t._getTexCoords,t._setTexCoords),cc.V3F_C4B_T2F_Quad=function(t,e,i,n,r,o){this._arrayBuffer=r||new ArrayBuffer(cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT),this._offset=o||0,r=this._arrayBuffer,o=this._offset;var s=cc.V3F_C4B_T2F.BYTES_PER_ELEMENT;this._tl=t?new cc.V3F_C4B_T2F(t.vertices,t.colors,t.texCoords,r,o):new cc.V3F_C4B_T2F(null,null,null,r,o),this._bl=e?new cc.V3F_C4B_T2F(e.vertices,e.colors,e.texCoords,r,o+s):new cc.V3F_C4B_T2F(null,null,null,r,o+s),this._tr=i?new cc.V3F_C4B_T2F(i.vertices,i.colors,i.texCoords,r,o+2*s):new cc.V3F_C4B_T2F(null,null,null,r,o+2*s),this._br=n?new cc.V3F_C4B_T2F(n.vertices,n.colors,n.texCoords,r,o+3*s):new cc.V3F_C4B_T2F(null,null,null,r,o+3*s)},cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT=96,t=cc.V3F_C4B_T2F_Quad.prototype,t._getTL=function(){return this._tl},t._setTL=function(t){var e=this._tl;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},t._getBL=function(){return this._bl},t._setBL=function(t){var e=this._bl;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},t._getTR=function(){return this._tr},t._setTR=function(t){var e=this._tr;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},t._getBR=function(){return this._br},t._setBR=function(t){var e=this._br;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},t._getArrayBuffer=function(){return this._arrayBuffer},cc.defineGetterSetter(t,"tl",t._getTL,t._setTL),cc.defineGetterSetter(t,"tr",t._getTR,t._setTR),cc.defineGetterSetter(t,"bl",t._getBL,t._setBL),cc.defineGetterSetter(t,"br",t._getBR,t._setBR),cc.defineGetterSetter(t,"arrayBuffer",t._getArrayBuffer,null),cc.V3F_C4B_T2F_QuadZero=function(){return new cc.V3F_C4B_T2F_Quad},cc.V3F_C4B_T2F_QuadCopy=function(t){if(!t)return cc.V3F_C4B_T2F_QuadZero();var e=t.tl,i=t.bl,n=t.tr;return t=t.br,{tl:{vertices:{x:e.vertices.x,y:e.vertices.y,z:e.vertices.z},colors:{r:e.colors.r,g:e.colors.g,b:e.colors.b,a:e.colors.a},texCoords:{u:e.texCoords.u,v:e.texCoords.v}},bl:{vertices:{x:i.vertices.x,y:i.vertices.y,z:i.vertices.z},colors:{r:i.colors.r,g:i.colors.g,b:i.colors.b,a:i.colors.a},texCoords:{u:i.texCoords.u,v:i.texCoords.v}},tr:{vertices:{x:n.vertices.x,y:n.vertices.y,z:n.vertices.z},colors:{r:n.colors.r,g:n.colors.g,b:n.colors.b,a:n.colors.a},texCoords:{u:n.texCoords.u,v:n.texCoords.v}},br:{vertices:{x:t.vertices.x,y:t.vertices.y,z:t.vertices.z},colors:{r:t.colors.r,g:t.colors.g,b:t.colors.b,a:t.colors.a},texCoords:{u:t.texCoords.u,v:t.texCoords.v}}}},cc.V3F_C4B_T2F_QuadsCopy=function(t){if(!t)return[];for(var e=[],i=0;i<t.length;i++)e.push(cc.V3F_C4B_T2F_QuadCopy(t[i]));return e},cc.V2F_C4B_T2F=function(t,e,i,n,r){this._arrayBuffer=n||new ArrayBuffer(cc.V2F_C4B_T2F.BYTES_PER_ELEMENT),this._offset=r||0,n=this._arrayBuffer,r=this._offset;var o=cc.Vertex2F.BYTES_PER_ELEMENT;this._vertices=t?new cc.Vertex2F(t.x,t.y,n,r):new cc.Vertex2F(0,0,n,r),this._colors=e?cc.color(e.r,e.g,e.b,e.a,n,r+o):cc.color(0,0,0,0,n,r+o),this._texCoords=i?new cc.Tex2F(i.u,i.v,n,r+o+cc.Color.BYTES_PER_ELEMENT):new cc.Tex2F(0,0,n,r+o+cc.Color.BYTES_PER_ELEMENT)},cc.V2F_C4B_T2F.BYTES_PER_ELEMENT=20,t=cc.V2F_C4B_T2F.prototype,t._getVertices=function(){return this._vertices},t._setVertices=function(t){this._vertices.x=t.x,this._vertices.y=t.y},t._getColor=function(){return this._colors},t._setColor=function(t){var e=this._colors;e.r=t.r,e.g=t.g,e.b=t.b,e.a=t.a},t._getTexCoords=function(){return this._texCoords},t._setTexCoords=function(t){this._texCoords.u=t.u,this._texCoords.v=t.v},cc.defineGetterSetter(t,"vertices",t._getVertices,t._setVertices),cc.defineGetterSetter(t,"colors",t._getColor,t._setColor),cc.defineGetterSetter(t,"texCoords",t._getTexCoords,t._setTexCoords),cc.V2F_C4B_T2F_Triangle=function(t,e,i,n,r){this._arrayBuffer=n||new ArrayBuffer(cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT),this._offset=r||0,n=this._arrayBuffer,r=this._offset;var o=cc.V2F_C4B_T2F.BYTES_PER_ELEMENT;this._a=t?new cc.V2F_C4B_T2F(t.vertices,t.colors,t.texCoords,n,r):new cc.V2F_C4B_T2F(null,null,null,n,r),this._b=e?new cc.V2F_C4B_T2F(e.vertices,e.colors,e.texCoords,n,r+o):new cc.V2F_C4B_T2F(null,null,null,n,r+o),this._c=i?new cc.V2F_C4B_T2F(i.vertices,i.colors,i.texCoords,n,r+2*o):new cc.V2F_C4B_T2F(null,null,null,n,r+2*o)},cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT=60,t=cc.V2F_C4B_T2F_Triangle.prototype,t._getA=function(){return this._a},t._setA=function(t){var e=this._a;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},t._getB=function(){return this._b},t._setB=function(t){var e=this._b;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},t._getC=function(){return this._c},t._setC=function(t){var e=this._c;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},cc.defineGetterSetter(t,"a",t._getA,t._setA),cc.defineGetterSetter(t,"b",t._getB,t._setB),cc.defineGetterSetter(t,"c",t._getC,t._setC)},cc._tmp.PrototypeColor=function(){var t=cc.color;t._getWhite=function(){return t(255,255,255)},t._getYellow=function(){return t(255,255,0)},t._getBlue=function(){return t(0,0,255)},t._getGreen=function(){return t(0,255,0)},t._getRed=function(){return t(255,0,0)},t._getMagenta=function(){return t(255,0,255)},t._getBlack=function(){return t(0,0,0)},t._getOrange=function(){return t(255,127,0)},t._getGray=function(){return t(166,166,166)},cc.defineGetterSetter(t,"WHITE",t._getWhite),cc.defineGetterSetter(t,"YELLOW",t._getYellow),cc.defineGetterSetter(t,"BLUE",t._getBlue),cc.defineGetterSetter(t,"GREEN",t._getGreen),cc.defineGetterSetter(t,"RED",t._getRed),cc.defineGetterSetter(t,"MAGENTA",t._getMagenta),cc.defineGetterSetter(t,"BLACK",t._getBlack),cc.defineGetterSetter(t,"ORANGE",t._getOrange),cc.defineGetterSetter(t,"GRAY",t._getGray),cc.BlendFunc._disable=function(){return new cc.BlendFunc(cc.ONE,cc.ZERO)},cc.BlendFunc._alphaPremultiplied=function(){return new cc.BlendFunc(cc.ONE,cc.ONE_MINUS_SRC_ALPHA)},cc.BlendFunc._alphaNonPremultiplied=function(){return new cc.BlendFunc(cc.SRC_ALPHA,cc.ONE_MINUS_SRC_ALPHA)},cc.BlendFunc._additive=function(){return new cc.BlendFunc(cc.SRC_ALPHA,cc.ONE)},cc.defineGetterSetter(cc.BlendFunc,"DISABLE",cc.BlendFunc._disable),cc.defineGetterSetter(cc.BlendFunc,"ALPHA_PREMULTIPLIED",cc.BlendFunc._alphaPremultiplied),cc.defineGetterSetter(cc.BlendFunc,"ALPHA_NON_PREMULTIPLIED",cc.BlendFunc._alphaNonPremultiplied),cc.defineGetterSetter(cc.BlendFunc,"ADDITIVE",cc.BlendFunc._additive)},cc.Color=function(t,e,i,n){this.r=t||0,this.g=e||0,this.b=i||0,this.a=null==n?255:n},cc.color=function(t,e,i,n){return void 0===t?{r:0,g:0,b:0,a:255}:cc.isString(t)?cc.hexToColor(t):cc.isObject(t)?{r:t.r,g:t.g,b:t.b,a:null==t.a?255:t.a}:{r:t,g:e,b:i,a:null==n?255:n}},cc.colorEqual=function(t,e){return t.r===e.r&&t.g===e.g&&t.b===e.b},cc.Acceleration=function(t,e,i,n){this.x=t||0,this.y=e||0,this.z=i||0,this.timestamp=n||0},cc.Vertex2F=function(t,e){this.x=t||0,this.y=e||0},cc.vertex2=function(t,e){return new cc.Vertex2F(t,e)},cc.Vertex3F=function(t,e,i){this.x=t||0,this.y=e||0,this.z=i||0},cc.vertex3=function(t,e,i){return new cc.Vertex3F(t,e,i)},cc.Tex2F=function(t,e){this.u=t||0,this.v=e||0},cc.tex2=function(t,e){return new cc.Tex2F(t,e)},cc.BlendFunc=function(t,e){this.src=t,this.dst=e},cc.blendFuncDisable=function(){return new cc.BlendFunc(cc.ONE,cc.ZERO)},cc.hexToColor=function(t){return t=t.replace(/^#?/,"0x"),t=parseInt(t),cc.color(t>>16,(t>>8)%256,t%256)},cc.colorToHex=function(t){var e=t.r.toString(16),i=t.g.toString(16),n=t.b.toString(16);return"#"+(16>t.r?"0"+e:e)+(16>t.g?"0"+i:i)+(16>t.b?"0"+n:n)},cc.TEXT_ALIGNMENT_LEFT=0,cc.TEXT_ALIGNMENT_CENTER=1,cc.TEXT_ALIGNMENT_RIGHT=2,cc.VERTICAL_TEXT_ALIGNMENT_TOP=0,cc.VERTICAL_TEXT_ALIGNMENT_CENTER=1,cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM=2,cc._Dictionary=cc.Class.extend({_keyMapTb:null,_valueMapTb:null,__currId:0,ctor:function(){this._keyMapTb={},this._valueMapTb={},this.__currId=2<<(0|10*Math.random())},__getKey:function(){return this.__currId++,"key_"+this.__currId},setObject:function(t,e){if(null!=e){var i=this.__getKey();this._keyMapTb[i]=e,this._valueMapTb[i]=t}},objectForKey:function(t){if(null==t)return null;var e,i=this._keyMapTb;for(e in i)if(i[e]===t)return this._valueMapTb[e];return null},valueForKey:function(t){return this.objectForKey(t)},removeObjectForKey:function(t){if(null!=t){var e,i=this._keyMapTb;for(e in i)if(i[e]===t){delete this._valueMapTb[e],delete i[e];break}}},removeObjectsForKeys:function(t){if(null!=t)for(var e=0;e<t.length;e++)this.removeObjectForKey(t[e])},allKeys:function(){var t,e=[],i=this._keyMapTb;for(t in i)e.push(i[t]);return e},removeAllObjects:function(){this._keyMapTb={},this._valueMapTb={}},count:function(){return this.allKeys().length}}),cc.FontDefinition=function(t){if(this.fontName="Arial",this.fontSize=12,this.textAlign=cc.TEXT_ALIGNMENT_CENTER,this.verticalAlign=cc.VERTICAL_TEXT_ALIGNMENT_TOP,this.fillStyle=cc.color(255,255,255,255),this.boundingHeight=this.boundingWidth=0,this.strokeEnabled=!1,this.strokeStyle=cc.color(255,255,255,255),this.lineWidth=1,this.fontWeight=this.fontStyle=this.lineHeight="normal",this.shadowEnabled=!1,this.shadowBlur=this.shadowOffsetY=this.shadowOffsetX=0,this.shadowOpacity=1,t&&t instanceof Object)for(var e in t)this[e]=t[e]},cc.FontDefinition.prototype._getCanvasFontStr=function(){return this.fontStyle+" "+this.fontWeight+" "+this.fontSize+"px/"+(this.lineHeight.charAt?this.lineHeight:this.lineHeight+"px")+" '"+this.fontName+"'"},cc._renderType===cc._RENDER_TYPE_WEBGL&&(cc.assert(cc.isFunction(cc._tmp.WebGLColor),cc._LogInfos.MissingFile,"CCTypesWebGL.js"),cc._tmp.WebGLColor(),delete cc._tmp.WebGLColor),cc.assert(cc.isFunction(cc._tmp.PrototypeColor),cc._LogInfos.MissingFile,"CCTypesPropertyDefine.js"),cc._tmp.PrototypeColor(),delete cc._tmp.PrototypeColor,cc.Touches=[],cc.TouchesIntergerDict={},cc.DENSITYDPI_DEVICE="device-dpi",cc.DENSITYDPI_HIGH="high-dpi",cc.DENSITYDPI_MEDIUM="medium-dpi",cc.DENSITYDPI_LOW="low-dpi",cc.__BrowserGetter={init:function(){this.html=document.getElementsByTagName("html")[0]},availWidth:function(t){return t&&t!==this.html?t.clientWidth:window.innerWidth},availHeight:function(t){return t&&t!==this.html?t.clientHeight:window.innerHeight},meta:{width:"device-width","user-scalable":"no"},adaptationType:cc.sys.browserType},-1<window.navigator.userAgent.indexOf("OS 8_1_")&&(cc.__BrowserGetter.adaptationType=cc.sys.BROWSER_TYPE_MIUI),cc.sys.os===cc.sys.OS_IOS&&(cc.__BrowserGetter.adaptationType=cc.sys.BROWSER_TYPE_SAFARI),cc.__BrowserGetter.adaptationType){case cc.sys.BROWSER_TYPE_SAFARI:cc.__BrowserGetter.meta["minimal-ui"]="true",cc.__BrowserGetter.availWidth=function(t){return t.clientWidth},cc.__BrowserGetter.availHeight=function(t){return t.clientHeight};break;case cc.sys.BROWSER_TYPE_CHROME:cc.__BrowserGetter.__defineGetter__("target-densitydpi",function(){return cc.view._targetDensityDPI});case cc.sys.BROWSER_TYPE_SOUGOU:case cc.sys.BROWSER_TYPE_UC:cc.__BrowserGetter.availWidth=function(t){return t.clientWidth},cc.__BrowserGetter.availHeight=function(t){return t.clientHeight};break;case cc.sys.BROWSER_TYPE_MIUI:cc.__BrowserGetter.init=function(t){if(!t.__resizeWithBrowserSize){var e=function(){t.setDesignResolutionSize(t._designResolutionSize.width,t._designResolutionSize.height,t._resolutionPolicy),window.removeEventListener("resize",e,!1)};window.addEventListener("resize",e,!1)}}}cc.EGLView=cc.Class.extend({_delegate:null,_frameSize:null,_designResolutionSize:null,_originalDesignResolutionSize:null,_viewPortRect:null,_visibleRect:null,_retinaEnabled:!1,_autoFullScreen:!0,_devicePixelRatio:1,_viewName:"",_resizeCallback:null,_scaleX:1,_originalScaleX:1,_scaleY:1,_originalScaleY:1,_indexBitsUsed:0,_maxTouches:5,_resolutionPolicy:null,_rpExactFit:null,_rpShowAll:null,_rpNoBorder:null,_rpFixedHeight:null,_rpFixedWidth:null,_initialized:!1,_captured:!1,_wnd:null,_hDC:null,_hRC:null,_supportTouch:!1,_contentTranslateLeftTop:null,_frame:null,_frameZoomFactor:1,__resizeWithBrowserSize:!1,_isAdjustViewPort:!0,_targetDensityDPI:null,ctor:function(){var t=document,e=cc.ContainerStrategy,i=cc.ContentStrategy;cc.__BrowserGetter.init(this),this._frame=cc.container.parentNode===t.body?t.documentElement:cc.container.parentNode,this._frameSize=cc.size(0,0),this._initFrameSize();var t=cc._canvas.width,n=cc._canvas.height;this._designResolutionSize=cc.size(t,n),this._originalDesignResolutionSize=cc.size(t,n),this._viewPortRect=cc.rect(0,0,t,n),this._visibleRect=cc.rect(0,0,t,n),this._contentTranslateLeftTop={left:0,top:0},this._viewName="Cocos2dHTML5",t=cc.sys,this.enableRetina(t.os===t.OS_IOS||t.os===t.OS_OSX),cc.visibleRect&&cc.visibleRect.init(this._visibleRect),this._rpExactFit=new cc.ResolutionPolicy(e.EQUAL_TO_FRAME,i.EXACT_FIT),this._rpShowAll=new cc.ResolutionPolicy(e.PROPORTION_TO_FRAME,i.SHOW_ALL),this._rpNoBorder=new cc.ResolutionPolicy(e.EQUAL_TO_FRAME,i.NO_BORDER),this._rpFixedHeight=new cc.ResolutionPolicy(e.EQUAL_TO_FRAME,i.FIXED_HEIGHT),this._rpFixedWidth=new cc.ResolutionPolicy(e.EQUAL_TO_FRAME,i.FIXED_WIDTH),this._hDC=cc._canvas,this._hRC=cc._renderContext,this._targetDensityDPI=cc.DENSITYDPI_HIGH},_resizeEvent:function(){var t;t=this.setDesignResolutionSize?this:cc.view;var e=t._frameSize.width,i=t._frameSize.height;t._initFrameSize(),(t._frameSize.width!==e||t._frameSize.height!==i)&&(t._resizeCallback&&t._resizeCallback.call(),e=t._originalDesignResolutionSize.width,i=t._originalDesignResolutionSize.height,e>0&&t.setDesignResolutionSize(e,i,t._resolutionPolicy))},setTargetDensityDPI:function(t){this._targetDensityDPI=t,this._setViewPortMeta()},getTargetDensityDPI:function(){return this._targetDensityDPI},resizeWithBrowserSize:function(t){t?this.__resizeWithBrowserSize||(this.__resizeWithBrowserSize=!0,cc._addEventListener(window,"resize",this._resizeEvent),cc._addEventListener(window,"orientationchange",this._resizeEvent)):this.__resizeWithBrowserSize&&(this.__resizeWithBrowserSize=!1,window.removeEventListener("resize",this._resizeEvent),window.removeEventListener("orientationchange",this._resizeEvent))},setResizeCallback:function(t){(cc.isFunction(t)||null==t)&&(this._resizeCallback=t)},_initFrameSize:function(){var t=this._frameSize;t.width=cc.__BrowserGetter.availWidth(this._frame),t.height=cc.__BrowserGetter.availHeight(this._frame)},_adjustSizeKeepCanvasSize:function(){var t=this._originalDesignResolutionSize.width,e=this._originalDesignResolutionSize.height;t>0&&this.setDesignResolutionSize(t,e,this._resolutionPolicy)},_setViewPortMeta:function(){if(this._isAdjustViewPort){var t=document.getElementById("cocosMetaElement");t&&document.head.removeChild(t);var e,i,n=(t=document.getElementsByName("viewport"))?t[0]:null,t=cc.newElement("meta");t.id="cocosMetaElement",t.name="viewport",t.content="",e=cc.__BrowserGetter.meta,i=n?n.content:"";for(var r in e)RegExp(r).test(i)||(i+=","+r+"="+e[r]);/^,/.test(i)&&(i=i.substr(1)),t.content=i,n&&(n.content=i),document.head.appendChild(t)}},_setScaleXYForRenderTexture:function(){var t=cc.contentScaleFactor();this._scaleY=this._scaleX=t},_resetScale:function(){this._scaleX=this._originalScaleX,this._scaleY=this._originalScaleY},_adjustSizeToBrowser:function(){},initialize:function(){this._initialized=!0},adjustViewPort:function(t){this._isAdjustViewPort=t},enableRetina:function(t){this._retinaEnabled=t?!0:!1},isRetinaEnabled:function(){return this._retinaEnabled},enableAutoFullScreen:function(t){this._autoFullScreen=t?!0:!1},isAutoFullScreenEnabled:function(){return this._autoFullScreen},end:function(){},isOpenGLReady:function(){return null!==this._hDC&&null!==this._hRC},setFrameZoomFactor:function(t){this._frameZoomFactor=t,this.centerWindow(),cc.director.setProjection(cc.director.getProjection())},swapBuffers:function(){},setIMEKeyboardState:function(){},setContentTranslateLeftTop:function(t,e){this._contentTranslateLeftTop={left:t,top:e}},getContentTranslateLeftTop:function(){return this._contentTranslateLeftTop},getFrameSize:function(){return cc.size(this._frameSize.width,this._frameSize.height)
},setFrameSize:function(t,e){this._frameSize.width=t,this._frameSize.height=e,this._frame.style.width=t+"px",this._frame.style.height=e+"px",this._resizeEvent(),cc.director.setProjection(cc.director.getProjection())},centerWindow:function(){},getVisibleSize:function(){return cc.size(this._visibleRect.width,this._visibleRect.height)},getVisibleOrigin:function(){return cc.p(this._visibleRect.x,this._visibleRect.y)},canSetContentScaleFactor:function(){return!0},getResolutionPolicy:function(){return this._resolutionPolicy},setResolutionPolicy:function(t){if(t instanceof cc.ResolutionPolicy)this._resolutionPolicy=t;else{var e=cc.ResolutionPolicy;t===e.EXACT_FIT&&(this._resolutionPolicy=this._rpExactFit),t===e.SHOW_ALL&&(this._resolutionPolicy=this._rpShowAll),t===e.NO_BORDER&&(this._resolutionPolicy=this._rpNoBorder),t===e.FIXED_HEIGHT&&(this._resolutionPolicy=this._rpFixedHeight),t===e.FIXED_WIDTH&&(this._resolutionPolicy=this._rpFixedWidth)}},setDesignResolutionSize:function(t,e,i){if(t>0||e>0)if(this.setResolutionPolicy(i),i=this._resolutionPolicy){i.preApply(this),cc.sys.isMobile&&this._setViewPortMeta(),this._initFrameSize(),this._originalDesignResolutionSize.width=this._designResolutionSize.width=t,this._originalDesignResolutionSize.height=this._designResolutionSize.height=e;var n=i.apply(this,this._designResolutionSize);n.scale&&2===n.scale.length&&(this._scaleX=n.scale[0],this._scaleY=n.scale[1]),n.viewport&&(t=this._viewPortRect,e=this._visibleRect,n=n.viewport,t.x=n.x,t.y=n.y,t.width=n.width,t.height=n.height,e.x=-t.x/this._scaleX,e.y=-t.y/this._scaleY,e.width=cc._canvas.width/this._scaleX,e.height=cc._canvas.height/this._scaleY,cc._renderContext.setOffset&&cc._renderContext.setOffset(t.x,-t.y)),t=cc.director,t._winSizeInPoints.width=this._designResolutionSize.width,t._winSizeInPoints.height=this._designResolutionSize.height,i.postApply(this),cc.winSize.width=t._winSizeInPoints.width,cc.winSize.height=t._winSizeInPoints.height,cc._renderType===cc._RENDER_TYPE_WEBGL&&(t._createStatsLabel(),t.setGLDefaultValues()),this._originalScaleX=this._scaleX,this._originalScaleY=this._scaleY,cc.DOM&&cc.DOM._resetEGLViewDiv(),cc.visibleRect&&cc.visibleRect.init(this._visibleRect)}else cc.log(cc._LogInfos.EGLView_setDesignResolutionSize_2);else cc.log(cc._LogInfos.EGLView_setDesignResolutionSize)},getDesignResolutionSize:function(){return cc.size(this._designResolutionSize.width,this._designResolutionSize.height)},setViewPortInPoints:function(t,e,i,n){var r=this._frameZoomFactor,o=this._scaleX,s=this._scaleY;cc._renderContext.viewport(t*o*r+this._viewPortRect.x*r,e*s*r+this._viewPortRect.y*r,i*o*r,n*s*r)},setScissorInPoints:function(t,e,i,n){var r=this._frameZoomFactor,o=this._scaleX,s=this._scaleY;cc._renderContext.scissor(t*o*r+this._viewPortRect.x*r,e*s*r+this._viewPortRect.y*r,i*o*r,n*s*r)},isScissorEnabled:function(){var t=cc._renderContext;return t.isEnabled(t.SCISSOR_TEST)},getScissorRect:function(){var t=cc._renderContext,e=this._scaleX,i=this._scaleY,t=t.getParameter(t.SCISSOR_BOX);return cc.rect((t[0]-this._viewPortRect.x)/e,(t[1]-this._viewPortRect.y)/i,t[2]/e,t[3]/i)},setViewName:function(t){null!=t&&0<t.length&&(this._viewName=t)},getViewName:function(){return this._viewName},getViewPortRect:function(){return this._viewPortRect},getScaleX:function(){return this._scaleX},getScaleY:function(){return this._scaleY},getDevicePixelRatio:function(){return this._devicePixelRatio},convertToLocationInView:function(t,e,i){return{x:this._devicePixelRatio*(t-i.left),y:this._devicePixelRatio*(i.top+i.height-e)}},_convertMouseToLocationInView:function(t,e){var i=this._viewPortRect;t.x=(this._devicePixelRatio*(t.x-e.left)-i.x)/this._scaleX,t.y=(this._devicePixelRatio*(e.top+e.height-t.y)-i.y)/this._scaleY},_convertTouchesWithScale:function(t){for(var e,i,n,r=this._viewPortRect,o=this._scaleX,s=this._scaleY,c=0;c<t.length;c++)e=t[c],i=e._point,n=e._prevPoint,e._setPoint((i.x-r.x)/o,(i.y-r.y)/s),e._setPrevPoint((n.x-r.x)/o,(n.y-r.y)/s)}}),cc.EGLView._getInstance=function(){return this._instance||(this._instance=this._instance||new cc.EGLView,this._instance.initialize()),this._instance},cc.ContainerStrategy=cc.Class.extend({preApply:function(){},apply:function(){},postApply:function(){},_setupContainer:function(t,e,i){var n=t._frame;cc.view._autoFullScreen&&cc.sys.isMobile&&n===document.documentElement&&cc.screen.autoFullScreen(n);var n=cc._canvas,r=cc.container;r.style.width=n.style.width=e+"px",r.style.height=n.style.height=i+"px",r=t._devicePixelRatio=1,r=t._devicePixelRatio=t.isRetinaEnabled()?window.devicePixelRatio||1:640/e,n.width=e*r,n.height=i*r,cc._renderContext.resetCache&&cc._renderContext.resetCache(),t=document.body;var o;t&&(o=t.style)&&(o.paddingTop=o.paddingTop||"0px",o.paddingRight=o.paddingRight||"0px",o.paddingBottom=o.paddingBottom||"0px",o.paddingLeft=o.paddingLeft||"0px",o.borderTop=o.borderTop||"0px",o.borderRight=o.borderRight||"0px",o.borderBottom=o.borderBottom||"0px",o.borderLeft=o.borderLeft||"0px",o.marginTop=o.marginTop||"0px",o.marginRight=o.marginRight||"0px",o.marginBottom=o.marginBottom||"0px",o.marginLeft=o.marginLeft||"0px")},_fixContainer:function(){document.body.insertBefore(cc.container,document.body.firstChild);var t=document.body.style;t.width=window.innerWidth+"px",t.height=window.innerHeight+"px",t.overflow="hidden",t=cc.container.style,t.position="fixed",t.left=t.top="0px",document.body.scrollTop=0}}),cc.ContentStrategy=cc.Class.extend({_result:{scale:[1,1],viewport:null},_buildResult:function(t,e,i,n,r,o){return 2>Math.abs(t-i)&&(i=t),2>Math.abs(e-n)&&(n=e),t=cc.rect(Math.round((t-i)/2),Math.round((e-n)/2),i,n),this._result.scale=[r,o],this._result.viewport=t,this._result},preApply:function(){},apply:function(){return{scale:[1,1]}},postApply:function(){}}),function(){var t=cc.ContainerStrategy.extend({apply:function(t){this._setupContainer(t,t._frameSize.width,t._frameSize.height)}}),e=cc.ContainerStrategy.extend({apply:function(t,e){var i,n,r=t._frameSize.width,o=t._frameSize.height,s=cc.container.style,c=e.width,a=e.height,l=r/c,h=o/a;h>l?(i=r,n=a*l):(i=c*h,n=o),c=Math.round((r-i)/2),n=Math.round((o-n)/2),this._setupContainer(t,r-2*c,o-2*n),s.marginLeft=c+"px",s.marginRight=c+"px",s.marginTop=n+"px",s.marginBottom=n+"px"}});t.extend({preApply:function(t){this._super(t),t._frame=document.documentElement},apply:function(t){this._super(t),this._fixContainer()}}),e.extend({preApply:function(t){this._super(t),t._frame=document.documentElement},apply:function(t,e){this._super(t,e),this._fixContainer()}});var i=cc.ContainerStrategy.extend({apply:function(t){this._setupContainer(t,cc._canvas.width,cc._canvas.height)}});cc.ContainerStrategy.EQUAL_TO_FRAME=new t,cc.ContainerStrategy.PROPORTION_TO_FRAME=new e,cc.ContainerStrategy.ORIGINAL_CONTAINER=new i;var t=cc.ContentStrategy.extend({apply:function(t,e){var i=cc._canvas.width,n=cc._canvas.height;return this._buildResult(i,n,i,n,i/e.width,n/e.height)}}),e=cc.ContentStrategy.extend({apply:function(t,e){var i,n,r=cc._canvas.width,o=cc._canvas.height,s=e.width,c=e.height,a=r/s,l=o/c,h=0;return l>a?(h=a,i=r,n=c*h):(h=l,i=s*h,n=o),this._buildResult(r,o,i,n,h,h)}}),i=cc.ContentStrategy.extend({apply:function(t,e){var i,n,r,o=cc._canvas.width,s=cc._canvas.height,c=e.width,a=e.height,l=o/c,h=s/a;return h>l?(i=h,n=c*i,r=s):(i=l,n=o,r=a*i),this._buildResult(o,s,n,r,i,i)}}),n=cc.ContentStrategy.extend({apply:function(t,e){var i=cc._canvas.width,n=cc._canvas.height,r=n/e.height;return this._buildResult(i,n,i,n,r,r)},postApply:function(t){cc.director._winSizeInPoints=t.getVisibleSize()}}),r=cc.ContentStrategy.extend({apply:function(t,e){var i=cc._canvas.width,n=cc._canvas.height,r=i/e.width;return this._buildResult(i,n,i,n,r,r)},postApply:function(t){cc.director._winSizeInPoints=t.getVisibleSize()}});cc.ContentStrategy.EXACT_FIT=new t,cc.ContentStrategy.SHOW_ALL=new e,cc.ContentStrategy.NO_BORDER=new i,cc.ContentStrategy.FIXED_HEIGHT=new n,cc.ContentStrategy.FIXED_WIDTH=new r}(),cc.ResolutionPolicy=cc.Class.extend({_containerStrategy:null,_contentStrategy:null,ctor:function(t,e){this.setContainerStrategy(t),this.setContentStrategy(e)},preApply:function(t){this._containerStrategy.preApply(t),this._contentStrategy.preApply(t)},apply:function(t,e){return this._containerStrategy.apply(t,e),this._contentStrategy.apply(t,e)},postApply:function(t){this._containerStrategy.postApply(t),this._contentStrategy.postApply(t)},setContainerStrategy:function(t){t instanceof cc.ContainerStrategy&&(this._containerStrategy=t)},setContentStrategy:function(t){t instanceof cc.ContentStrategy&&(this._contentStrategy=t)}}),cc.ResolutionPolicy.EXACT_FIT=0,cc.ResolutionPolicy.NO_BORDER=1,cc.ResolutionPolicy.SHOW_ALL=2,cc.ResolutionPolicy.FIXED_HEIGHT=3,cc.ResolutionPolicy.FIXED_WIDTH=4,cc.ResolutionPolicy.UNKNOWN=5,cc.screen={_supportsFullScreen:!1,_preOnFullScreenChange:null,_touchEvent:"",_fn:null,_fnMap:[["requestFullscreen","exitFullscreen","fullscreenchange","fullscreenEnabled","fullscreenElement"],["requestFullScreen","exitFullScreen","fullScreenchange","fullScreenEnabled","fullScreenElement"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitfullscreenchange","webkitIsFullScreen","webkitCurrentFullScreenElement"],["mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozFullScreen","mozFullScreenElement"],["msRequestFullscreen","msExitFullscreen","MSFullscreenChange","msFullscreenEnabled","msFullscreenElement"]],init:function(){this._fn={};var t,e,i,n=this._fnMap;for(t=0,l=n.length;l>t;t++)if((e=n[t])&&e[1]in document){for(t=0,i=e.length;i>t;t++)this._fn[n[0][t]]=e[t];break}this._supportsFullScreen="undefined"!=typeof this._fn.requestFullscreen,this._touchEvent="ontouchstart"in window?"touchstart":"mousedown"},fullScreen:function(){return this._supportsFullScreen&&document[this._fn.fullscreenElement]},requestFullScreen:function(t,e){if(this._supportsFullScreen){if(t=t||document.documentElement,e){var i=this._fn.fullscreenchange;this._preOnFullScreenChange&&document.removeEventListener(i,this._preOnFullScreenChange),this._preOnFullScreenChange=e,cc._addEventListener(document,i,e,!1)}return t[this._fn.requestFullscreen]()}},exitFullScreen:function(){return this._supportsFullScreen?document[this._fn.exitFullscreen]():!0},autoFullScreen:function(t,e){function i(){r.requestFullScreen(t,e),n.removeEventListener(r._touchEvent,i)}t=t||document.body;var n=cc._canvas||t,r=this;this.requestFullScreen(t,e),cc._addEventListener(n,this._touchEvent,i)}},cc.screen.init(),cc.visibleRect={topLeft:cc.p(0,0),topRight:cc.p(0,0),top:cc.p(0,0),bottomLeft:cc.p(0,0),bottomRight:cc.p(0,0),bottom:cc.p(0,0),center:cc.p(0,0),left:cc.p(0,0),right:cc.p(0,0),width:0,height:0,init:function(t){var e=this.width=t.width,i=this.height=t.height,n=t.x;t=t.y;var r=t+i,o=n+e;this.topLeft.x=n,this.topLeft.y=r,this.topRight.x=o,this.topRight.y=r,this.top.x=n+e/2,this.top.y=r,this.bottomLeft.x=n,this.bottomLeft.y=t,this.bottomRight.x=o,this.bottomRight.y=t,this.bottom.x=n+e/2,this.bottom.y=t,this.center.x=n+e/2,this.center.y=t+i/2,this.left.x=n,this.left.y=t+i/2,this.right.x=o,this.right.y=t+i/2}},cc.UIInterfaceOrientationLandscapeLeft=-90,cc.UIInterfaceOrientationLandscapeRight=90,cc.UIInterfaceOrientationPortraitUpsideDown=180,cc.UIInterfaceOrientationPortrait=0,cc.inputManager={_mousePressed:!1,_isRegisterEvent:!1,_preTouchPoint:cc.p(0,0),_prevMousePoint:cc.p(0,0),_preTouchPool:[],_preTouchPoolPointer:0,_touches:[],_touchesIntegerDict:{},_indexBitsUsed:0,_maxTouches:5,_accelEnabled:!1,_accelInterval:1/30,_accelMinus:1,_accelCurTime:0,_acceleration:null,_accelDeviceEvent:null,_getUnUsedIndex:function(){for(var t=this._indexBitsUsed,e=0;e<this._maxTouches;e++){if(!(1&t))return this._indexBitsUsed|=1<<e,e;t>>=1}return-1},_removeUsedIndexBit:function(t){0>t||t>=this._maxTouches||(t=~(1<<t),this._indexBitsUsed&=t)},_glView:null,handleTouchesBegin:function(t){for(var e,i,n,r=[],o=this._touchesIntegerDict,s=0,c=t.length;c>s;s++)if(e=t[s],n=e.getID(),i=o[n],null==i){var a=this._getUnUsedIndex();-1===a?cc.log(cc._LogInfos.inputManager_handleTouchesBegin,a):(i=this._touches[a]=new cc.Touch(e._point.x,e._point.y,e.getID()),i._setPrevPoint(e._prevPoint),o[n]=a,r.push(i))}0<r.length&&(this._glView._convertTouchesWithScale(r),t=new cc.EventTouch(r),t._eventCode=cc.EventTouch.EventCode.BEGAN,cc.eventManager.dispatchEvent(t))},handleTouchesMove:function(t){for(var e,i,n=[],r=this._touches,o=0,s=t.length;s>o;o++)e=t[o],i=e.getID(),i=this._touchesIntegerDict[i],null!=i&&r[i]&&(r[i]._setPoint(e._point),r[i]._setPrevPoint(e._prevPoint),n.push(r[i]));0<n.length&&(this._glView._convertTouchesWithScale(n),t=new cc.EventTouch(n),t._eventCode=cc.EventTouch.EventCode.MOVED,cc.eventManager.dispatchEvent(t))},handleTouchesEnd:function(t){t=this.getSetOfTouchesEndOrCancel(t),0<t.length&&(this._glView._convertTouchesWithScale(t),t=new cc.EventTouch(t),t._eventCode=cc.EventTouch.EventCode.ENDED,cc.eventManager.dispatchEvent(t))},handleTouchesCancel:function(t){t=this.getSetOfTouchesEndOrCancel(t),0<t.length&&(this._glView._convertTouchesWithScale(t),t=new cc.EventTouch(t),t._eventCode=cc.EventTouch.EventCode.CANCELLED,cc.eventManager.dispatchEvent(t))},getSetOfTouchesEndOrCancel:function(t){for(var e,i,n,r=[],o=this._touches,s=this._touchesIntegerDict,c=0,a=t.length;a>c;c++)e=t[c],n=e.getID(),i=s[n],null!=i&&o[i]&&(o[i]._setPoint(e._point),o[i]._setPrevPoint(e._prevPoint),r.push(o[i]),this._removeUsedIndexBit(i),delete s[n]);return r},getHTMLElementPosition:function(t){var e=document.documentElement,i=window,n=null,n=cc.isFunction(t.getBoundingClientRect)?t.getBoundingClientRect():t instanceof HTMLCanvasElement?{left:0,top:0,width:t.width,height:t.height}:{left:0,top:0,width:parseInt(t.style.width),height:parseInt(t.style.height)};return{left:n.left+i.pageXOffset-e.clientLeft,top:n.top+i.pageYOffset-e.clientTop,width:n.width,height:n.height}},getPreTouch:function(t){for(var e=null,i=this._preTouchPool,n=t.getID(),r=i.length-1;r>=0;r--)if(i[r].getID()===n){e=i[r];break}return e||(e=t),e},setPreTouch:function(t){for(var e=!1,i=this._preTouchPool,n=t.getID(),r=i.length-1;r>=0;r--)if(i[r].getID()===n){i[r]=t,e=!0;break}e||(50>=i.length?i.push(t):(i[this._preTouchPoolPointer]=t,this._preTouchPoolPointer=(this._preTouchPoolPointer+1)%50))},getTouchByXY:function(t,e,i){var n=this._preTouchPoint;return t=this._glView.convertToLocationInView(t,e,i),e=new cc.Touch(t.x,t.y),e._setPrevPoint(n.x,n.y),n.x=t.x,n.y=t.y,e},getMouseEvent:function(t,e,i){var n=this._prevMousePoint;return this._glView._convertMouseToLocationInView(t,e),e=new cc.EventMouse(i),e.setLocation(t.x,t.y),e._setPrevCursor(n.x,n.y),n.x=t.x,n.y=t.y,e},getPointByEvent:function(t,e){return null!=t.pageX?{x:t.pageX,y:t.pageY}:(e.left-=document.body.scrollLeft,e.top-=document.body.scrollTop,{x:t.clientX,y:t.clientY})},getTouchesByEvent:function(t,e){for(var i,n,r=[],o=this._glView,s=this._preTouchPoint,c=t.changedTouches.length,a=0;c>a;a++)if(i=t.changedTouches[a]){var l;l=cc.sys.BROWSER_TYPE_FIREFOX===cc.sys.browserType?o.convertToLocationInView(i.pageX,i.pageY,e):o.convertToLocationInView(i.clientX,i.clientY,e),null!=i.identifier?(i=new cc.Touch(l.x,l.y,i.identifier),n=this.getPreTouch(i).getLocation(),i._setPrevPoint(n.x,n.y),this.setPreTouch(i)):(i=new cc.Touch(l.x,l.y),i._setPrevPoint(s.x,s.y)),s.x=l.x,s.y=l.y,r.push(i)}return r},registerSystemEvent:function(t){if(!this._isRegisterEvent){this._glView=cc.view;var e=this,i="mouse"in cc.sys.capabilities,n="touches"in cc.sys.capabilities,r=!1;if(cc.sys.isMobile&&(r=!0),i&&(cc._addEventListener(window,"mousedown",function(){e._mousePressed=!0},!1),cc._addEventListener(window,"mouseup",function(i){if(!r){var n=e._mousePressed;if(e._mousePressed=!1,n){var n=e.getHTMLElementPosition(t),o=e.getPointByEvent(i,n);cc.rectContainsPoint(new cc.Rect(n.left,n.top,n.width,n.height),o)||(e.handleTouchesEnd([e.getTouchByXY(o.x,o.y,n)]),n=e.getMouseEvent(o,n,cc.EventMouse.UP),n.setButton(i.button),cc.eventManager.dispatchEvent(n))}}},!1),cc._addEventListener(t,"mousedown",function(i){if(!r){e._mousePressed=!0;var n=e.getHTMLElementPosition(t),o=e.getPointByEvent(i,n);e.handleTouchesBegin([e.getTouchByXY(o.x,o.y,n)]),n=e.getMouseEvent(o,n,cc.EventMouse.DOWN),n.setButton(i.button),cc.eventManager.dispatchEvent(n),i.stopPropagation(),i.preventDefault(),t.focus()}},!1),cc._addEventListener(t,"mouseup",function(i){if(!r){e._mousePressed=!1;var n=e.getHTMLElementPosition(t),o=e.getPointByEvent(i,n);e.handleTouchesEnd([e.getTouchByXY(o.x,o.y,n)]),n=e.getMouseEvent(o,n,cc.EventMouse.UP),n.setButton(i.button),cc.eventManager.dispatchEvent(n),i.stopPropagation(),i.preventDefault()}},!1),cc._addEventListener(t,"mousemove",function(i){if(!r){var n=e.getHTMLElementPosition(t),o=e.getPointByEvent(i,n);e.handleTouchesMove([e.getTouchByXY(o.x,o.y,n)]),n=e.getMouseEvent(o,n,cc.EventMouse.MOVE),n.setButton(e._mousePressed?i.button:null),cc.eventManager.dispatchEvent(n),i.stopPropagation(),i.preventDefault()}},!1),cc._addEventListener(t,"mousewheel",function(i){var n=e.getHTMLElementPosition(t),r=e.getPointByEvent(i,n),n=e.getMouseEvent(r,n,cc.EventMouse.SCROLL);n.setButton(i.button),n.setScrollData(0,i.wheelDelta),cc.eventManager.dispatchEvent(n),i.stopPropagation(),i.preventDefault()},!1),cc._addEventListener(t,"DOMMouseScroll",function(i){var n=e.getHTMLElementPosition(t),r=e.getPointByEvent(i,n),n=e.getMouseEvent(r,n,cc.EventMouse.SCROLL);n.setButton(i.button),n.setScrollData(0,-120*i.detail),cc.eventManager.dispatchEvent(n),i.stopPropagation(),i.preventDefault()},!1)),window.navigator.msPointerEnabled){var o,i={MSPointerDown:e.handleTouchesBegin,MSPointerMove:e.handleTouchesMove,MSPointerUp:e.handleTouchesEnd,MSPointerCancel:e.handleTouchesCancel};for(o in i)(function(i,n){cc._addEventListener(t,i,function(i){var r=e.getHTMLElementPosition(t);r.left-=document.documentElement.scrollLeft,r.top-=document.documentElement.scrollTop,n.call(e,[e.getTouchByXY(i.clientX,i.clientY,r)]),i.stopPropagation()},!1)})(o,i[o])}n&&(cc._addEventListener(t,"touchstart",function(i){if(i.changedTouches){var n=e.getHTMLElementPosition(t);n.left-=document.body.scrollLeft,n.top-=document.body.scrollTop,e.handleTouchesBegin(e.getTouchesByEvent(i,n)),i.stopPropagation(),i.preventDefault(),t.focus()}},!1),cc._addEventListener(t,"touchmove",function(i){if(i.changedTouches){var n=e.getHTMLElementPosition(t);n.left-=document.body.scrollLeft,n.top-=document.body.scrollTop,e.handleTouchesMove(e.getTouchesByEvent(i,n)),i.stopPropagation(),i.preventDefault()}},!1),cc._addEventListener(t,"touchend",function(i){if(i.changedTouches){var n=e.getHTMLElementPosition(t);n.left-=document.body.scrollLeft,n.top-=document.body.scrollTop,e.handleTouchesEnd(e.getTouchesByEvent(i,n)),i.stopPropagation(),i.preventDefault()}},!1),cc._addEventListener(t,"touchcancel",function(i){if(i.changedTouches){var n=e.getHTMLElementPosition(t);n.left-=document.body.scrollLeft,n.top-=document.body.scrollTop,e.handleTouchesCancel(e.getTouchesByEvent(i,n)),i.stopPropagation(),i.preventDefault()}},!1)),this._registerKeyboardEvent(),this._registerAccelerometerEvent(),this._isRegisterEvent=!0}},_registerKeyboardEvent:function(){},_registerAccelerometerEvent:function(){},update:function(t){this._accelCurTime>this._accelInterval&&(this._accelCurTime-=this._accelInterval,cc.eventManager.dispatchEvent(new cc.EventAcceleration(this._acceleration))),this._accelCurTime+=t}};var _p=cc.inputManager;_p.setAccelerometerEnabled=function(t){this._accelEnabled!==t&&(this._accelEnabled=t,t=cc.director.getScheduler(),this._accelCurTime=0,t.scheduleUpdate(this))},_p.setAccelerometerInterval=function(t){this._accelInterval!==t&&(this._accelInterval=t)},_p._registerKeyboardEvent=function(){cc._addEventListener(cc._canvas,"keydown",function(t){cc.eventManager.dispatchEvent(new cc.EventKeyboard(t.keyCode,!0)),t.stopPropagation(),t.preventDefault()},!1),cc._addEventListener(cc._canvas,"keyup",function(t){cc.eventManager.dispatchEvent(new cc.EventKeyboard(t.keyCode,!1)),t.stopPropagation(),t.preventDefault()},!1)},_p._registerAccelerometerEvent=function(){var t=window;this._acceleration=new cc.Acceleration,this._accelDeviceEvent=t.DeviceMotionEvent||t.DeviceOrientationEvent,cc.sys.browserType===cc.sys.BROWSER_TYPE_MOBILE_QQ&&(this._accelDeviceEvent=window.DeviceOrientationEvent);var e=this._accelDeviceEvent===t.DeviceMotionEvent?"devicemotion":"deviceorientation",i=navigator.userAgent;(/Android/.test(i)||/Adr/.test(i)&&cc.sys.browserType===cc.BROWSER_TYPE_UC)&&(this._minus=-1),cc._addEventListener(t,e,this.didAccelerate.bind(this),!1)},_p.didAccelerate=function(t){var e=window;if(this._accelEnabled){var i,n,r,o=this._acceleration;this._accelDeviceEvent===window.DeviceMotionEvent?(r=t.accelerationIncludingGravity,i=this._accelMinus*r.x*.1,n=this._accelMinus*r.y*.1,r=.1*r.z):(i=t.gamma/90*.981,n=.981*-(t.beta/90),r=t.alpha/90*.981),cc.sys.os===cc.sys.OS_ANDROID?(o.x=-i,o.y=-n):(o.x=i,o.y=n),o.z=r,o.timestamp=t.timeStamp||Date.now(),t=o.x,e.orientation===cc.UIInterfaceOrientationLandscapeRight?(o.x=-o.y,o.y=t):e.orientation===cc.UIInterfaceOrientationLandscapeLeft?(o.x=o.y,o.y=-t):e.orientation===cc.UIInterfaceOrientationPortraitUpsideDown&&(o.x=-o.x,o.y=-o.y)}},delete _p,cc.AffineTransform=function(t,e,i,n,r,o){this.a=t,this.b=e,this.c=i,this.d=n,this.tx=r,this.ty=o},cc.affineTransformMake=function(t,e,i,n,r,o){return{a:t,b:e,c:i,d:n,tx:r,ty:o}},cc.pointApplyAffineTransform=function(t,e,i){var n;return void 0===i?(i=e,n=t.x,t=t.y):(n=t,t=e),{x:i.a*n+i.c*t+i.tx,y:i.b*n+i.d*t+i.ty}},cc._pointApplyAffineTransform=function(t,e,i){return cc.pointApplyAffineTransform(t,e,i)},cc.sizeApplyAffineTransform=function(t,e){return{width:e.a*t.width+e.c*t.height,height:e.b*t.width+e.d*t.height}},cc.affineTransformMakeIdentity=function(){return{a:1,b:0,c:0,d:1,tx:0,ty:0}},cc.affineTransformIdentity=function(){return{a:1,b:0,c:0,d:1,tx:0,ty:0}},cc.rectApplyAffineTransform=function(t,e){var i=cc.rectGetMinY(t),n=cc.rectGetMinX(t),r=cc.rectGetMaxX(t),o=cc.rectGetMaxY(t),s=cc.pointApplyAffineTransform(n,i,e),i=cc.pointApplyAffineTransform(r,i,e),n=cc.pointApplyAffineTransform(n,o,e),c=cc.pointApplyAffineTransform(r,o,e),r=Math.min(s.x,i.x,n.x,c.x),o=Math.max(s.x,i.x,n.x,c.x),a=Math.min(s.y,i.y,n.y,c.y),s=Math.max(s.y,i.y,n.y,c.y);return cc.rect(r,a,o-r,s-a)},cc._rectApplyAffineTransformIn=function(t,e){var i=cc.rectGetMinY(t),n=cc.rectGetMinX(t),r=cc.rectGetMaxX(t),o=cc.rectGetMaxY(t),s=cc.pointApplyAffineTransform(n,i,e),i=cc.pointApplyAffineTransform(r,i,e),n=cc.pointApplyAffineTransform(n,o,e),c=cc.pointApplyAffineTransform(r,o,e),r=Math.min(s.x,i.x,n.x,c.x),o=Math.max(s.x,i.x,n.x,c.x),a=Math.min(s.y,i.y,n.y,c.y),s=Math.max(s.y,i.y,n.y,c.y);return t.x=r,t.y=a,t.width=o-r,t.height=s-a,t},cc.affineTransformTranslate=function(t,e,i){return{a:t.a,b:t.b,c:t.c,d:t.d,tx:t.tx+t.a*e+t.c*i,ty:t.ty+t.b*e+t.d*i}},cc.affineTransformScale=function(t,e,i){return{a:t.a*e,b:t.b*e,c:t.c*i,d:t.d*i,tx:t.tx,ty:t.ty}},cc.affineTransformRotate=function(t,e){var i=Math.sin(e),n=Math.cos(e);return{a:t.a*n+t.c*i,b:t.b*n+t.d*i,c:t.c*n-t.a*i,d:t.d*n-t.b*i,tx:t.tx,ty:t.ty}},cc.affineTransformConcat=function(t,e){return{a:t.a*e.a+t.b*e.c,b:t.a*e.b+t.b*e.d,c:t.c*e.a+t.d*e.c,d:t.c*e.b+t.d*e.d,tx:t.tx*e.a+t.ty*e.c+e.tx,ty:t.tx*e.b+t.ty*e.d+e.ty}},cc.affineTransformEqualToTransform=function(t,e){return t.a===e.a&&t.b===e.b&&t.c===e.c&&t.d===e.d&&t.tx===e.tx&&t.ty===e.ty},cc.affineTransformInvert=function(t){var e=1/(t.a*t.d-t.b*t.c);return{a:e*t.d,b:-e*t.b,c:-e*t.c,d:e*t.a,tx:e*(t.c*t.ty-t.d*t.tx),ty:e*(t.b*t.tx-t.a*t.ty)}},cc.POINT_EPSILON=parseFloat("1.192092896e-07F"),cc.pNeg=function(t){return cc.p(-t.x,-t.y)},cc.pAdd=function(t,e){return cc.p(t.x+e.x,t.y+e.y)},cc.pSub=function(t,e){return cc.p(t.x-e.x,t.y-e.y)},cc.pMult=function(t,e){return cc.p(t.x*e,t.y*e)},cc.pMidpoint=function(t,e){return cc.pMult(cc.pAdd(t,e),.5)},cc.pDot=function(t,e){return t.x*e.x+t.y*e.y},cc.pCross=function(t,e){return t.x*e.y-t.y*e.x},cc.pPerp=function(t){return cc.p(-t.y,t.x)},cc.pRPerp=function(t){return cc.p(t.y,-t.x)},cc.pProject=function(t,e){return cc.pMult(e,cc.pDot(t,e)/cc.pDot(e,e))},cc.pRotate=function(t,e){return cc.p(t.x*e.x-t.y*e.y,t.x*e.y+t.y*e.x)},cc.pUnrotate=function(t,e){return cc.p(t.x*e.x+t.y*e.y,t.y*e.x-t.x*e.y)},cc.pLengthSQ=function(t){return cc.pDot(t,t)},cc.pDistanceSQ=function(t,e){return cc.pLengthSQ(cc.pSub(t,e))},cc.pLength=function(t){return Math.sqrt(cc.pLengthSQ(t))},cc.pDistance=function(t,e){return cc.pLength(cc.pSub(t,e))},cc.pNormalize=function(t){var e=cc.pLength(t);return 0===e?cc.p(t):cc.pMult(t,1/e)},cc.pForAngle=function(t){return cc.p(Math.cos(t),Math.sin(t))},cc.pToAngle=function(t){return Math.atan2(t.y,t.x)},cc.clampf=function(t,e,i){if(e>i){var n=e;e=i,i=n}return e>t?e:i>t?t:i},cc.pClamp=function(t,e,i){return cc.p(cc.clampf(t.x,e.x,i.x),cc.clampf(t.y,e.y,i.y))},cc.pFromSize=function(t){return cc.p(t.width,t.height)},cc.pCompOp=function(t,e){return cc.p(e(t.x),e(t.y))},cc.pLerp=function(t,e,i){return cc.pAdd(cc.pMult(t,1-i),cc.pMult(e,i))},cc.pFuzzyEqual=function(t,e,i){return t.x-i<=e.x&&e.x<=t.x+i&&t.y-i<=e.y&&e.y<=t.y+i?!0:!1},cc.pCompMult=function(t,e){return cc.p(t.x*e.x,t.y*e.y)},cc.pAngleSigned=function(t,e){var i=cc.pNormalize(t),n=cc.pNormalize(e),i=Math.atan2(i.x*n.y-i.y*n.x,cc.pDot(i,n));return Math.abs(i)<cc.POINT_EPSILON?0:i},cc.pAngle=function(t,e){var i=Math.acos(cc.pDot(cc.pNormalize(t),cc.pNormalize(e)));return Math.abs(i)<cc.POINT_EPSILON?0:i},cc.pRotateByAngle=function(t,e,i){t=cc.pSub(t,e);var n=Math.cos(i);i=Math.sin(i);var r=t.x;return t.x=r*n-t.y*i+e.x,t.y=r*i+t.y*n+e.y,t},cc.pLineIntersect=function(t,e,i,n,r){if(t.x===e.x&&t.y===e.y||i.x===n.x&&i.y===n.y)return!1;var o=e.x-t.x;e=e.y-t.y;var s=n.x-i.x;n=n.y-i.y;var c=t.x-i.x;return t=t.y-i.y,i=n*o-s*e,r.x=s*t-n*c,r.y=o*t-e*c,0===i?0===r.x||0===r.y?!0:!1:(r.x/=i,r.y/=i,!0)},cc.pSegmentIntersect=function(t,e,i,n){var r=cc.p(0,0);return cc.pLineIntersect(t,e,i,n,r)&&0<=r.x&&1>=r.x&&0<=r.y&&1>=r.y?!0:!1},cc.pIntersectPoint=function(t,e,i,n){var r=cc.p(0,0);return cc.pLineIntersect(t,e,i,n,r)?(i=cc.p(0,0),i.x=t.x+r.x*(e.x-t.x),i.y=t.y+r.x*(e.y-t.y),i):cc.p(0,0)},cc.pSameAs=function(t,e){return null!=t&&null!=e?t.x===e.x&&t.y===e.y:!1},cc.pZeroIn=function(t){t.x=0,t.y=0},cc.pIn=function(t,e){t.x=e.x,t.y=e.y},cc.pMultIn=function(t,e){t.x*=e,t.y*=e},cc.pSubIn=function(t,e){t.x-=e.x,t.y-=e.y},cc.pAddIn=function(t,e){t.x+=e.x,t.y+=e.y},cc.pNormalizeIn=function(t){cc.pMultIn(t,1/Math.sqrt(t.x*t.x+t.y*t.y))},cc.vertexLineToPolygon=function(t,e,i,n,r){if(r+=n,!(1>=r)){e*=.5;for(var o,s=r-1,c=n;r>c;c++){o=2*c;var a,l=cc.p(t[2*c],t[2*c+1]);if(0===c)a=cc.pPerp(cc.pNormalize(cc.pSub(l,cc.p(t[2*(c+1)],t[2*(c+1)+1]))));else if(c===s)a=cc.pPerp(cc.pNormalize(cc.pSub(cc.p(t[2*(c-1)],t[2*(c-1)+1]),l)));else{a=cc.p(t[2*(c-1)],t[2*(c-1)+1]);var h=cc.p(t[2*(c+1)],t[2*(c+1)+1]),u=cc.pNormalize(cc.pSub(h,l)),d=cc.pNormalize(cc.pSub(a,l)),_=Math.acos(cc.pDot(u,d));a=_<cc.degreesToRadians(70)?cc.pPerp(cc.pNormalize(cc.pMidpoint(u,d))):_<cc.degreesToRadians(170)?cc.pNormalize(cc.pMidpoint(u,d)):cc.pPerp(cc.pNormalize(cc.pSub(h,a)))}a=cc.pMult(a,e),i[2*o]=l.x+a.x,i[2*o+1]=l.y+a.y,i[2*(o+1)]=l.x-a.x,i[2*(o+1)+1]=l.y-a.y}for(c=0===n?0:n-1;s>c;c++)o=2*c,t=o+2,e=cc.vertex2(i[2*o],i[2*o+1]),r=cc.vertex2(i[2*(o+1)],i[2*(o+1)+1]),o=cc.vertex2(i[2*t],i[2*t]),n=cc.vertex2(i[2*(t+1)],i[2*(t+1)+1]),e=!cc.vertexLineIntersect(e.x,e.y,n.x,n.y,r.x,r.y,o.x,o.y),!e.isSuccess&&(0>e.value||1<e.value)&&(e.isSuccess=!0),e.isSuccess&&(i[2*t]=n.x,i[2*t+1]=n.y,i[2*(t+1)]=o.x,i[2*(t+1)+1]=o.y)}},cc.vertexLineIntersect=function(t,e,i,n,r,o,s,c){return t===i&&e===n||r===s&&o===c?{isSuccess:!1,value:0}:(i-=t,n-=e,r-=t,o-=e,s-=t,c-=e,t=Math.sqrt(i*i+n*n),i/=t,n/=t,e=r*i+o*n,o=o*i-r*n,r=e,e=s*i+c*n,c=c*i-s*n,s=e,o===c?{isSuccess:!1,value:0}:{isSuccess:!0,value:(s+(r-s)*c/(c-o))/t})},cc.vertexListIsClockwise=function(t){for(var e=0,i=t.length;i>e;e++){var n=t[(e+1)%i],r=t[(e+2)%i];if(0<cc.pCross(cc.pSub(n,t[e]),cc.pSub(r,n)))return!1}return!0},cc.CGAffineToGL=function(t,e){e[2]=e[3]=e[6]=e[7]=e[8]=e[9]=e[11]=e[14]=0,e[10]=e[15]=1,e[0]=t.a,e[4]=t.c,e[12]=t.tx,e[1]=t.b,e[5]=t.d,e[13]=t.ty},cc.GLToCGAffine=function(t,e){e.a=t[0],e.c=t[4],e.tx=t[12],e.b=t[1],e.d=t[5],e.ty=t[13]},cc.Touch=cc.Class.extend({_point:null,_prevPoint:null,_id:0,_startPointCaptured:!1,_startPoint:null,ctor:function(t,e,i){this._point=cc.p(t||0,e||0),this._id=i||0},getLocation:function(){return{x:this._point.x,y:this._point.y}},getLocationX:function(){return this._point.x},getLocationY:function(){return this._point.y},getPreviousLocation:function(){return{x:this._prevPoint.x,y:this._prevPoint.y}},getStartLocation:function(){return{x:this._startPoint.x,y:this._startPoint.y}},getDelta:function(){return cc.pSub(this._point,this._prevPoint)},getLocationInView:function(){return{x:this._point.x,y:this._point.y}},getPreviousLocationInView:function(){return{x:this._prevPoint.x,y:this._prevPoint.y}},getStartLocationInView:function(){return{x:this._startPoint.x,y:this._startPoint.y}},getID:function(){return this._id},getId:function(){return cc.log("getId is deprecated. Please use getID instead."),this._id},setTouchInfo:function(t,e,i){this._prevPoint=this._point,this._point=cc.p(e||0,i||0),this._id=t,this._startPointCaptured||(this._startPoint=cc.p(this._point),this._startPointCaptured=!0)},_setPoint:function(t,e){void 0===e?(this._point.x=t.x,this._point.y=t.y):(this._point.x=t,this._point.y=e)},_setPrevPoint:function(t,e){this._prevPoint=void 0===e?cc.p(t.x,t.y):cc.p(t||0,e||0)}}),cc.Event=cc.Class.extend({_type:0,_isStopped:!1,_currentTarget:null,_setCurrentTarget:function(t){this._currentTarget=t},ctor:function(t){this._type=t},getType:function(){return this._type},stopPropagation:function(){this._isStopped=!0},isStopped:function(){return this._isStopped},getCurrentTarget:function(){return this._currentTarget}}),cc.Event.TOUCH=0,cc.Event.KEYBOARD=1,cc.Event.ACCELERATION=2,cc.Event.MOUSE=3,cc.Event.FOCUS=4,cc.Event.CUSTOM=6,cc.EventCustom=cc.Event.extend({_eventName:null,_userData:null,ctor:function(t){cc.Event.prototype.ctor.call(this,cc.Event.CUSTOM),this._eventName=t},setUserData:function(t){this._userData=t},getUserData:function(){return this._userData},getEventName:function(){return this._eventName}}),cc.EventMouse=cc.Event.extend({_eventType:0,_button:0,_x:0,_y:0,_prevX:0,_prevY:0,_scrollX:0,_scrollY:0,ctor:function(t){cc.Event.prototype.ctor.call(this,cc.Event.MOUSE),this._eventType=t},setScrollData:function(t,e){this._scrollX=t,this._scrollY=e},getScrollX:function(){return this._scrollX},getScrollY:function(){return this._scrollY},setLocation:function(t,e){this._x=t,this._y=e},getLocation:function(){return{x:this._x,y:this._y}},getLocationInView:function(){return{x:this._x,y:cc.view._designResolutionSize.height-this._y}},_setPrevCursor:function(t,e){this._prevX=t,this._prevY=e},getDelta:function(){return{x:this._x-this._prevX,y:this._y-this._prevY}},getDeltaX:function(){return this._x-this._prevX},getDeltaY:function(){return this._y-this._prevY},setButton:function(t){this._button=t},getButton:function(){return this._button},getLocationX:function(){return this._x},getLocationY:function(){return this._y}}),cc.EventMouse.NONE=0,cc.EventMouse.DOWN=1,cc.EventMouse.UP=2,cc.EventMouse.MOVE=3,cc.EventMouse.SCROLL=4,cc.EventMouse.BUTTON_LEFT=0,cc.EventMouse.BUTTON_RIGHT=2,cc.EventMouse.BUTTON_MIDDLE=1,cc.EventMouse.BUTTON_4=3,cc.EventMouse.BUTTON_5=4,cc.EventMouse.BUTTON_6=5,cc.EventMouse.BUTTON_7=6,cc.EventMouse.BUTTON_8=7,cc.EventTouch=cc.Event.extend({_eventCode:0,_touches:null,ctor:function(t){cc.Event.prototype.ctor.call(this,cc.Event.TOUCH),this._touches=t||[]},getEventCode:function(){return this._eventCode},getTouches:function(){return this._touches},_setEventCode:function(t){this._eventCode=t},_setTouches:function(t){this._touches=t}}),cc.EventTouch.MAX_TOUCHES=5,cc.EventTouch.EventCode={BEGAN:0,MOVED:1,ENDED:2,CANCELLED:3},cc.EventFocus=cc.Event.extend({_widgetGetFocus:null,_widgetLoseFocus:null,ctor:function(t,e){cc.Event.prototype.ctor.call(this,cc.Event.FOCUS),this._widgetGetFocus=e,this._widgetLoseFocus=t
}}),cc.EventListener=cc.Class.extend({_onEvent:null,_type:0,_listenerID:null,_registered:!1,_fixedPriority:0,_node:null,_paused:!0,_isEnabled:!0,ctor:function(t,e,i){this._onEvent=i,this._type=t||0,this._listenerID=e||""},_setPaused:function(t){this._paused=t},_isPaused:function(){return this._paused},_setRegistered:function(t){this._registered=t},_isRegistered:function(){return this._registered},_getType:function(){return this._type},_getListenerID:function(){return this._listenerID},_setFixedPriority:function(t){this._fixedPriority=t},_getFixedPriority:function(){return this._fixedPriority},_setSceneGraphPriority:function(t){this._node=t},_getSceneGraphPriority:function(){return this._node},checkAvailable:function(){return null!==this._onEvent},clone:function(){return null},setEnabled:function(t){this._isEnabled=t},isEnabled:function(){return this._isEnabled},retain:function(){},release:function(){}}),cc.EventListener.UNKNOWN=0,cc.EventListener.TOUCH_ONE_BY_ONE=1,cc.EventListener.TOUCH_ALL_AT_ONCE=2,cc.EventListener.KEYBOARD=3,cc.EventListener.MOUSE=4,cc.EventListener.ACCELERATION=5,cc.EventListener.ACCELERATION=6,cc.EventListener.CUSTOM=8,cc.EventListener.FOCUS=7,cc._EventListenerCustom=cc.EventListener.extend({_onCustomEvent:null,ctor:function(t,e){this._onCustomEvent=e;var i=this;cc.EventListener.prototype.ctor.call(this,cc.EventListener.CUSTOM,t,function(t){null!==i._onCustomEvent&&i._onCustomEvent(t)})},checkAvailable:function(){return cc.EventListener.prototype.checkAvailable.call(this)&&null!==this._onCustomEvent},clone:function(){return new cc._EventListenerCustom(this._listenerID,this._onCustomEvent)}}),cc._EventListenerCustom.create=function(t,e){return new cc._EventListenerCustom(t,e)},cc._EventListenerMouse=cc.EventListener.extend({onMouseDown:null,onMouseUp:null,onMouseMove:null,onMouseScroll:null,ctor:function(){var t=this;cc.EventListener.prototype.ctor.call(this,cc.EventListener.MOUSE,cc._EventListenerMouse.LISTENER_ID,function(e){var i=cc.EventMouse;switch(e._eventType){case i.DOWN:t.onMouseDown&&t.onMouseDown(e);break;case i.UP:t.onMouseUp&&t.onMouseUp(e);break;case i.MOVE:t.onMouseMove&&t.onMouseMove(e);break;case i.SCROLL:t.onMouseScroll&&t.onMouseScroll(e)}})},clone:function(){var t=new cc._EventListenerMouse;return t.onMouseDown=this.onMouseDown,t.onMouseUp=this.onMouseUp,t.onMouseMove=this.onMouseMove,t.onMouseScroll=this.onMouseScroll,t},checkAvailable:function(){return!0}}),cc._EventListenerMouse.LISTENER_ID="__cc_mouse",cc._EventListenerMouse.create=function(){return new cc._EventListenerMouse},cc._EventListenerTouchOneByOne=cc.EventListener.extend({_claimedTouches:null,swallowTouches:!1,onTouchBegan:null,onTouchMoved:null,onTouchEnded:null,onTouchCancelled:null,ctor:function(){cc.EventListener.prototype.ctor.call(this,cc.EventListener.TOUCH_ONE_BY_ONE,cc._EventListenerTouchOneByOne.LISTENER_ID,null),this._claimedTouches=[]},setSwallowTouches:function(t){this.swallowTouches=t},isSwallowTouches:function(){return this.swallowTouches},clone:function(){var t=new cc._EventListenerTouchOneByOne;return t.onTouchBegan=this.onTouchBegan,t.onTouchMoved=this.onTouchMoved,t.onTouchEnded=this.onTouchEnded,t.onTouchCancelled=this.onTouchCancelled,t.swallowTouches=this.swallowTouches,t},checkAvailable:function(){return this.onTouchBegan?!0:(cc.log(cc._LogInfos._EventListenerTouchOneByOne_checkAvailable),!1)}}),cc._EventListenerTouchOneByOne.LISTENER_ID="__cc_touch_one_by_one",cc._EventListenerTouchOneByOne.create=function(){return new cc._EventListenerTouchOneByOne},cc._EventListenerTouchAllAtOnce=cc.EventListener.extend({onTouchesBegan:null,onTouchesMoved:null,onTouchesEnded:null,onTouchesCancelled:null,ctor:function(){cc.EventListener.prototype.ctor.call(this,cc.EventListener.TOUCH_ALL_AT_ONCE,cc._EventListenerTouchAllAtOnce.LISTENER_ID,null)},clone:function(){var t=new cc._EventListenerTouchAllAtOnce;return t.onTouchesBegan=this.onTouchesBegan,t.onTouchesMoved=this.onTouchesMoved,t.onTouchesEnded=this.onTouchesEnded,t.onTouchesCancelled=this.onTouchesCancelled,t},checkAvailable:function(){return null===this.onTouchesBegan&&null===this.onTouchesMoved&&null===this.onTouchesEnded&&null===this.onTouchesCancelled?(cc.log(cc._LogInfos._EventListenerTouchAllAtOnce_checkAvailable),!1):!0}}),cc._EventListenerTouchAllAtOnce.LISTENER_ID="__cc_touch_all_at_once",cc._EventListenerTouchAllAtOnce.create=function(){return new cc._EventListenerTouchAllAtOnce},cc.EventListener.create=function(t){cc.assert(t&&t.event,cc._LogInfos.EventListener_create);var e=t.event;delete t.event;var i=null;e===cc.EventListener.TOUCH_ONE_BY_ONE?i=new cc._EventListenerTouchOneByOne:e===cc.EventListener.TOUCH_ALL_AT_ONCE?i=new cc._EventListenerTouchAllAtOnce:e===cc.EventListener.MOUSE?i=new cc._EventListenerMouse:e===cc.EventListener.CUSTOM?(i=new cc._EventListenerCustom(t.eventName,t.callback),delete t.eventName,delete t.callback):e===cc.EventListener.KEYBOARD?i=new cc._EventListenerKeyboard:e===cc.EventListener.ACCELERATION?(i=new cc._EventListenerAcceleration(t.callback),delete t.callback):e===cc.EventListener.FOCUS&&(i=new cc._EventListenerFocus);for(var n in t)i[n]=t[n];return i},cc._EventListenerFocus=cc.EventListener.extend({clone:function(){var t=new cc._EventListenerFocus;return t.onFocusChanged=this.onFocusChanged,t},checkAvailable:function(){return this.onFocusChanged?!0:(cc.log("Invalid EventListenerFocus!"),!1)},onFocusChanged:null,ctor:function(){cc.EventListener.prototype.ctor.call(this,cc.EventListener.FOCUS,cc._EventListenerFocus.LISTENER_ID,function(t){this.onFocusChanged&&this.onFocusChanged(t._widgetLoseFocus,t._widgetGetFocus)})}}),cc._EventListenerFocus.LISTENER_ID="__cc_focus_event",cc._EventListenerVector=cc.Class.extend({_fixedListeners:null,_sceneGraphListeners:null,gt0Index:0,ctor:function(){this._fixedListeners=[],this._sceneGraphListeners=[]},size:function(){return this._fixedListeners.length+this._sceneGraphListeners.length},empty:function(){return 0===this._fixedListeners.length&&0===this._sceneGraphListeners.length},push:function(t){0===t._getFixedPriority()?this._sceneGraphListeners.push(t):this._fixedListeners.push(t)},clearSceneGraphListeners:function(){this._sceneGraphListeners.length=0},clearFixedListeners:function(){this._fixedListeners.length=0},clear:function(){this._sceneGraphListeners.length=0,this._fixedListeners.length=0},getFixedPriorityListeners:function(){return this._fixedListeners},getSceneGraphPriorityListeners:function(){return this._sceneGraphListeners}}),cc.__getListenerID=function(t){var e=cc.Event,i=t.getType();return i===e.ACCELERATION?cc._EventListenerAcceleration.LISTENER_ID:i===e.CUSTOM?t.getEventName():i===e.KEYBOARD?cc._EventListenerKeyboard.LISTENER_ID:i===e.MOUSE?cc._EventListenerMouse.LISTENER_ID:i===e.FOCUS?cc._EventListenerFocus.LISTENER_ID:(i===e.TOUCH&&cc.log(cc._LogInfos.__getListenerID),"")},cc.eventManager={DIRTY_NONE:0,DIRTY_FIXED_PRIORITY:1,DIRTY_SCENE_GRAPH_PRIORITY:2,DIRTY_ALL:3,_listenersMap:{},_priorityDirtyFlagMap:{},_nodeListenersMap:{},_nodePriorityMap:{},_globalZOrderNodeMap:{},_toAddedListeners:[],_dirtyNodes:[],_inDispatch:0,_isEnabled:!1,_nodePriorityIndex:0,_internalCustomListenerIDs:[cc.game.EVENT_HIDE,cc.game.EVENT_SHOW],_setDirtyForNode:function(t){null!=this._nodeListenersMap[t.__instanceId]&&this._dirtyNodes.push(t),t=t.getChildren();for(var e=0,i=t.length;i>e;e++)this._setDirtyForNode(t[e])},pauseTarget:function(t,e){var i,n,r=this._nodeListenersMap[t.__instanceId];if(r)for(i=0,n=r.length;n>i;i++)r[i]._setPaused(!0);if(!0===e)for(r=t.getChildren(),i=0,n=r.length;n>i;i++)this.pauseTarget(r[i],!0)},resumeTarget:function(t,e){var i,n,r=this._nodeListenersMap[t.__instanceId];if(r)for(i=0,n=r.length;n>i;i++)r[i]._setPaused(!1);if(this._setDirtyForNode(t),!0===e)for(r=t.getChildren(),i=0,n=r.length;n>i;i++)this.resumeTarget(r[i],!0)},_addListener:function(t){0===this._inDispatch?this._forceAddEventListener(t):this._toAddedListeners.push(t)},_forceAddEventListener:function(t){var e=t._getListenerID(),i=this._listenersMap[e];i||(i=new cc._EventListenerVector,this._listenersMap[e]=i),i.push(t),0===t._getFixedPriority()?(this._setDirty(e,this.DIRTY_SCENE_GRAPH_PRIORITY),e=t._getSceneGraphPriority(),null===e&&cc.log(cc._LogInfos.eventManager__forceAddEventListener),this._associateNodeAndEventListener(e,t),e.isRunning()&&this.resumeTarget(e)):this._setDirty(e,this.DIRTY_FIXED_PRIORITY)},_getListeners:function(t){return this._listenersMap[t]},_updateDirtyFlagForSceneGraph:function(){if(0!==this._dirtyNodes.length){for(var t,e,i=this._dirtyNodes,n=this._nodeListenersMap,r=0,o=i.length;o>r;r++)if(t=n[i[r].__instanceId])for(var s=0,c=t.length;c>s;s++)(e=t[s])&&this._setDirty(e._getListenerID(),this.DIRTY_SCENE_GRAPH_PRIORITY);this._dirtyNodes.length=0}},_removeAllListenersInVector:function(t){if(t)for(var e,i=0;i<t.length;)e=t[i],e._setRegistered(!1),null!=e._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(e._getSceneGraphPriority(),e),e._setSceneGraphPriority(null)),0===this._inDispatch?cc.arrayRemoveObject(t,e):++i},_removeListenersForListenerID:function(t){var e=this._listenersMap[t];if(e){var i=e.getFixedPriorityListeners(),n=e.getSceneGraphPriorityListeners();this._removeAllListenersInVector(n),this._removeAllListenersInVector(i),delete this._priorityDirtyFlagMap[t],this._inDispatch||(e.clear(),delete this._listenersMap[t])}for(i=this._toAddedListeners,e=0;e<i.length;)(n=i[e])&&n._getListenerID()===t?cc.arrayRemoveObject(i,n):++e},_sortEventListeners:function(t){var e=this.DIRTY_NONE,i=this._priorityDirtyFlagMap;i[t]&&(e=i[t]),e!==this.DIRTY_NONE&&(i[t]=this.DIRTY_NONE,e&this.DIRTY_FIXED_PRIORITY&&this._sortListenersOfFixedPriority(t),e&this.DIRTY_SCENE_GRAPH_PRIORITY&&((e=cc.director.getRunningScene())?this._sortListenersOfSceneGraphPriority(t,e):i[t]=this.DIRTY_SCENE_GRAPH_PRIORITY))},_sortListenersOfSceneGraphPriority:function(t,e){var i=this._getListeners(t);if(i){var n=i.getSceneGraphPriorityListeners();n&&0!==n.length&&(this._nodePriorityIndex=0,this._nodePriorityMap={},this._visitTarget(e,!0),i.getSceneGraphPriorityListeners().sort(this._sortEventListenersOfSceneGraphPriorityDes))}},_sortEventListenersOfSceneGraphPriorityDes:function(t,e){var i=cc.eventManager._nodePriorityMap,n=t._getSceneGraphPriority(),r=e._getSceneGraphPriority();return e&&r&&i[r.__instanceId]?t&&n&&i[n.__instanceId]?i[e._getSceneGraphPriority().__instanceId]-i[t._getSceneGraphPriority().__instanceId]:1:-1},_sortListenersOfFixedPriority:function(t){if(t=this._listenersMap[t]){var e=t.getFixedPriorityListeners();if(e&&0!==e.length){e.sort(this._sortListenersOfFixedPriorityAsc);for(var i=0,n=e.length;n>i&&!(0<=e[i]._getFixedPriority());)++i;t.gt0Index=i}}},_sortListenersOfFixedPriorityAsc:function(t,e){return t._getFixedPriority()-e._getFixedPriority()},_onUpdateListeners:function(t){if(t=this._listenersMap[t]){var e,i,n=t.getFixedPriorityListeners(),r=t.getSceneGraphPriorityListeners();if(r)for(e=0;e<r.length;)i=r[e],i._isRegistered()?++e:cc.arrayRemoveObject(r,i);if(n)for(e=0;e<n.length;)i=n[e],i._isRegistered()?++e:cc.arrayRemoveObject(n,i);r&&0===r.length&&t.clearSceneGraphListeners(),n&&0===n.length&&t.clearFixedListeners()}},_updateListeners:function(t){var e=this._inDispatch;if(cc.assert(e>0,cc._LogInfos.EventManager__updateListeners),!(e>1)){t.getType()===cc.Event.TOUCH?(this._onUpdateListeners(cc._EventListenerTouchOneByOne.LISTENER_ID),this._onUpdateListeners(cc._EventListenerTouchAllAtOnce.LISTENER_ID)):this._onUpdateListeners(cc.__getListenerID(t)),cc.assert(1===e,cc._LogInfos.EventManager__updateListeners_2),t=this._listenersMap;var i,e=this._priorityDirtyFlagMap;for(i in t)t[i].empty()&&(delete e[i],delete t[i]);if(i=this._toAddedListeners,0!==i.length){for(t=0,e=i.length;e>t;t++)this._forceAddEventListener(i[t]);this._toAddedListeners.length=0}}},_onTouchEventCallback:function(t,e){if(!t._isRegistered)return!1;var i=e.event,n=e.selTouch;i._setCurrentTarget(t._node);var r,o=!1,s=i.getEventCode(),c=cc.EventTouch.EventCode;return s===c.BEGAN?t.onTouchBegan&&(o=t.onTouchBegan(n,i))&&t._registered&&t._claimedTouches.push(n):0<t._claimedTouches.length&&-1!==(r=t._claimedTouches.indexOf(n))&&(o=!0,s===c.MOVED&&t.onTouchMoved?t.onTouchMoved(n,i):s===c.ENDED?(t.onTouchEnded&&t.onTouchEnded(n,i),t._registered&&t._claimedTouches.splice(r,1)):s===c.CANCELLED&&(t.onTouchCancelled&&t.onTouchCancelled(n,i),t._registered&&t._claimedTouches.splice(r,1))),i.isStopped()?(cc.eventManager._updateListeners(i),!0):o&&t._registered&&t.swallowTouches?(e.needsMutableSet&&e.touches.splice(n,1),!0):!1},_dispatchTouchEvent:function(t){this._sortEventListeners(cc._EventListenerTouchOneByOne.LISTENER_ID),this._sortEventListeners(cc._EventListenerTouchAllAtOnce.LISTENER_ID);var e=this._getListeners(cc._EventListenerTouchOneByOne.LISTENER_ID),i=this._getListeners(cc._EventListenerTouchAllAtOnce.LISTENER_ID);if(null!==e||null!==i){var n=t.getTouches(),r=cc.copyArray(n),o={event:t,needsMutableSet:e&&i,touches:r,selTouch:null};if(e)for(var s=0;s<n.length;s++)if(o.selTouch=n[s],this._dispatchEventToListeners(e,this._onTouchEventCallback,o),t.isStopped())return;if(i&&0<r.length&&(this._dispatchEventToListeners(i,this._onTouchesEventCallback,{event:t,touches:r}),t.isStopped()))return;this._updateListeners(t)}},_onTouchesEventCallback:function(t,e){if(!t._registered)return!1;var i=cc.EventTouch.EventCode,n=e.event,r=e.touches,o=n.getEventCode();return n._setCurrentTarget(t._node),o===i.BEGAN&&t.onTouchesBegan?t.onTouchesBegan(r,n):o===i.MOVED&&t.onTouchesMoved?t.onTouchesMoved(r,n):o===i.ENDED&&t.onTouchesEnded?t.onTouchesEnded(r,n):o===i.CANCELLED&&t.onTouchesCancelled&&t.onTouchesCancelled(r,n),n.isStopped()?(cc.eventManager._updateListeners(n),!0):!1},_associateNodeAndEventListener:function(t,e){var i=this._nodeListenersMap[t.__instanceId];i||(i=[],this._nodeListenersMap[t.__instanceId]=i),i.push(e)},_dissociateNodeAndEventListener:function(t,e){var i=this._nodeListenersMap[t.__instanceId];i&&(cc.arrayRemoveObject(i,e),0===i.length&&delete this._nodeListenersMap[t.__instanceId])},_dispatchEventToListeners:function(t,e,i){var n,r=!1,o=t.getFixedPriorityListeners(),s=t.getSceneGraphPriorityListeners(),c=0;if(o&&0!==o.length)for(;c<t.gt0Index;++c)if(n=o[c],n.isEnabled()&&!n._isPaused()&&n._isRegistered()&&e(n,i)){r=!0;break}if(s&&!r)for(t=0;t<s.length;t++)if(n=s[t],n.isEnabled()&&!n._isPaused()&&n._isRegistered()&&e(n,i)){r=!0;break}if(o&&!r)for(;c<o.length&&(n=o[c],!n.isEnabled()||n._isPaused()||!n._isRegistered()||!e(n,i));++c);},_setDirty:function(t,e){var i=this._priorityDirtyFlagMap;i[t]=null==i[t]?e:e|i[t]},_visitTarget:function(t,e){var i=t.getChildren(),n=0,r=i.length,o=this._globalZOrderNodeMap,s=this._nodeListenersMap;if(r>0){for(var c;r>n&&((c=i[n])&&0>c.getLocalZOrder());n++)this._visitTarget(c,!1);for(null!=s[t.__instanceId]&&(o[t.getGlobalZOrder()]||(o[t.getGlobalZOrder()]=[]),o[t.getGlobalZOrder()].push(t.__instanceId));r>n;n++)(c=i[n])&&this._visitTarget(c,!1)}else null!=s[t.__instanceId]&&(o[t.getGlobalZOrder()]||(o[t.getGlobalZOrder()]=[]),o[t.getGlobalZOrder()].push(t.__instanceId));if(e){var a,i=[];for(a in o)i.push(a);for(i.sort(this._sortNumberAsc),a=i.length,c=this._nodePriorityMap,n=0;a>n;n++)for(r=o[i[n]],s=0;s<r.length;s++)c[r[s]]=++this._nodePriorityIndex;this._globalZOrderNodeMap={}}},_sortNumberAsc:function(t,e){return t-e},addListener:function(t,e){if(cc.assert(t&&e,cc._LogInfos.eventManager_addListener_2),t instanceof cc.EventListener){if(t._isRegistered())return void cc.log(cc._LogInfos.eventManager_addListener_4)}else cc.assert(!cc.isNumber(e),cc._LogInfos.eventManager_addListener_3),t=cc.EventListener.create(t);if(t.checkAvailable()){if(cc.isNumber(e)){if(0===e)return void cc.log(cc._LogInfos.eventManager_addListener);t._setSceneGraphPriority(null),t._setFixedPriority(e),t._setRegistered(!0),t._setPaused(!1)}else t._setSceneGraphPriority(e),t._setFixedPriority(0),t._setRegistered(!0);return this._addListener(t),t}},addCustomListener:function(t,e){var i=new cc._EventListenerCustom(t,e);return this.addListener(i,1),i},removeListener:function(t){if(null!=t){var e,i,n=this._listenersMap;for(i in n){var r=n[i],o=r.getFixedPriorityListeners();if(e=r.getSceneGraphPriorityListeners(),(e=this._removeListenerInVector(e,t))?this._setDirty(t._getListenerID(),this.DIRTY_SCENE_GRAPH_PRIORITY):(e=this._removeListenerInVector(o,t))&&this._setDirty(t._getListenerID(),this.DIRTY_FIXED_PRIORITY),r.empty()&&(delete this._priorityDirtyFlagMap[t._getListenerID()],delete n[i]),e)break}if(!e)for(n=this._toAddedListeners,i=0,r=n.length;r>i;i++)if(o=n[i],o===t){cc.arrayRemoveObject(n,o),o._setRegistered(!1);break}}},_removeListenerInCallback:function(t,e){if(null==t)return!1;for(var i=0,n=t.length;n>i;i++){var r=t[i];if(r._onCustomEvent===e||r._onEvent===e)return r._setRegistered(!1),null!=r._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(r._getSceneGraphPriority(),r),r._setSceneGraphPriority(null)),0===this._inDispatch&&cc.arrayRemoveObject(t,r),!0}return!1},_removeListenerInVector:function(t,e){if(null==t)return!1;for(var i=0,n=t.length;n>i;i++){var r=t[i];if(r===e)return r._setRegistered(!1),null!=r._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(r._getSceneGraphPriority(),r),r._setSceneGraphPriority(null)),0===this._inDispatch&&cc.arrayRemoveObject(t,r),!0}return!1},removeListeners:function(t,e){if(t instanceof cc.Node){delete this._nodePriorityMap[t.__instanceId],cc.arrayRemoveObject(this._dirtyNodes,t);var i=this._nodeListenersMap[t.__instanceId];if(i){for(var n=cc.copyArray(i),i=0;i<n.length;i++)this.removeListener(n[i]);n.length=0}for(n=this._toAddedListeners,i=0;i<n.length;){var r=n[i];r._getSceneGraphPriority()===t?(r._setSceneGraphPriority(null),r._setRegistered(!1),n.splice(i,1)):++i}if(!0===e)for(n=t.getChildren(),i=0,r=n.length;r>i;i++)this.removeListeners(n[i],!0)}else t===cc.EventListener.TOUCH_ONE_BY_ONE?this._removeListenersForListenerID(cc._EventListenerTouchOneByOne.LISTENER_ID):t===cc.EventListener.TOUCH_ALL_AT_ONCE?this._removeListenersForListenerID(cc._EventListenerTouchAllAtOnce.LISTENER_ID):t===cc.EventListener.MOUSE?this._removeListenersForListenerID(cc._EventListenerMouse.LISTENER_ID):t===cc.EventListener.ACCELERATION?this._removeListenersForListenerID(cc._EventListenerAcceleration.LISTENER_ID):t===cc.EventListener.KEYBOARD?this._removeListenersForListenerID(cc._EventListenerKeyboard.LISTENER_ID):cc.log(cc._LogInfos.eventManager_removeListeners)},removeCustomListeners:function(t){this._removeListenersForListenerID(t)},removeAllListeners:function(){var t,e=this._listenersMap,i=this._internalCustomListenerIDs;for(t in e)-1===i.indexOf(t)&&this._removeListenersForListenerID(t)},setPriority:function(t,e){if(null!=t){var i,n=this._listenersMap;for(i in n){var r=n[i].getFixedPriorityListeners();if(r&&-1!==r.indexOf(t)){null!=t._getSceneGraphPriority()&&cc.log(cc._LogInfos.eventManager_setPriority),t._getFixedPriority()!==e&&(t._setFixedPriority(e),this._setDirty(t._getListenerID(),this.DIRTY_FIXED_PRIORITY));break}}}},setEnabled:function(t){this._isEnabled=t},isEnabled:function(){return this._isEnabled},dispatchEvent:function(t){if(this._isEnabled){if(this._updateDirtyFlagForSceneGraph(),this._inDispatch++,!t||!t.getType)throw"event is undefined";if(t.getType()===cc.Event.TOUCH)this._dispatchTouchEvent(t);else{var e=cc.__getListenerID(t);this._sortEventListeners(e),e=this._listenersMap[e],null!=e&&this._dispatchEventToListeners(e,this._onListenerCallback,t),this._updateListeners(t)}this._inDispatch--}},_onListenerCallback:function(t,e){return e._setCurrentTarget(t._getSceneGraphPriority()),t._onEvent(e),e.isStopped()},dispatchCustomEvent:function(t,e){var i=new cc.EventCustom(t);i.setUserData(e),this.dispatchEvent(i)}},cc.EventHelper=function(){},cc.EventHelper.prototype={constructor:cc.EventHelper,apply:function(t){t.addEventListener=cc.EventHelper.prototype.addEventListener,t.hasEventListener=cc.EventHelper.prototype.hasEventListener,t.removeEventListener=cc.EventHelper.prototype.removeEventListener,t.dispatchEvent=cc.EventHelper.prototype.dispatchEvent},addEventListener:function(t,e,i){if("load"===t&&this._textureLoaded)setTimeout(function(){e.call(i)},0);else{void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[t]&&(n[t]=[]),this.hasEventListener(t,e,i)||n[t].push({callback:e,eventTarget:i})}},hasEventListener:function(t,e,i){if(void 0===this._listeners)return!1;var n=this._listeners;if(void 0!==n[t]){t=0;for(var r=n.length;r>t;t++){var o=n[t];if(o.callback===e&&o.eventTarget===i)return!0}}return!1},removeEventListener:function(t,e){if(void 0!==this._listeners){var i=this._listeners[t];if(void 0!==i)for(var n=0;n<i.length;)i[n].eventTarget===e?i.splice(n,1):n++}},dispatchEvent:function(t,e){if(void 0!==this._listeners){null==e&&(e=!0);var i=this._listeners[t];if(void 0!==i){for(var n=[],r=i.length,o=0;r>o;o++)n[o]=i[o];for(o=0;r>o;o++)n[o].callback.call(n[o].eventTarget,this);e&&(i.length=0)}}}},cc.EventAcceleration=cc.Event.extend({_acc:null,ctor:function(t){cc.Event.prototype.ctor.call(this,cc.Event.ACCELERATION),this._acc=t}}),cc.EventKeyboard=cc.Event.extend({_keyCode:0,_isPressed:!1,ctor:function(t,e){cc.Event.prototype.ctor.call(this,cc.Event.KEYBOARD),this._keyCode=t,this._isPressed=e}}),cc._EventListenerAcceleration=cc.EventListener.extend({_onAccelerationEvent:null,ctor:function(t){this._onAccelerationEvent=t;var e=this;cc.EventListener.prototype.ctor.call(this,cc.EventListener.ACCELERATION,cc._EventListenerAcceleration.LISTENER_ID,function(t){e._onAccelerationEvent(t._acc,t)})},checkAvailable:function(){return cc.assert(this._onAccelerationEvent,cc._LogInfos._EventListenerAcceleration_checkAvailable),!0},clone:function(){return new cc._EventListenerAcceleration(this._onAccelerationEvent)}}),cc._EventListenerAcceleration.LISTENER_ID="__cc_acceleration",cc._EventListenerAcceleration.create=function(t){return new cc._EventListenerAcceleration(t)},cc._EventListenerKeyboard=cc.EventListener.extend({onKeyPressed:null,onKeyReleased:null,ctor:function(){var t=this;cc.EventListener.prototype.ctor.call(this,cc.EventListener.KEYBOARD,cc._EventListenerKeyboard.LISTENER_ID,function(e){e._isPressed?t.onKeyPressed&&t.onKeyPressed(e._keyCode,e):t.onKeyReleased&&t.onKeyReleased(e._keyCode,e)})},clone:function(){var t=new cc._EventListenerKeyboard;return t.onKeyPressed=this.onKeyPressed,t.onKeyReleased=this.onKeyReleased,t},checkAvailable:function(){return null===this.onKeyPressed&&null===this.onKeyReleased?(cc.log(cc._LogInfos._EventListenerKeyboard_checkAvailable),!1):!0}}),cc._EventListenerKeyboard.LISTENER_ID="__cc_keyboard",cc._EventListenerKeyboard.create=function(){return new cc._EventListenerKeyboard},cc.rendererCanvas={childrenOrderDirty:!0,_transformNodePool:[],_renderCmds:[],_isCacheToCanvasOn:!1,_cacheToCanvasCmds:{},_cacheInstanceIds:[],_currentID:0,getRenderCmd:function(t){return t._createRenderCmd()},rendering:function(t){var e,i=this._renderCmds,n=cc.view.getScaleX(),r=cc.view.getScaleY(),o=t||cc._renderContext;for(o.computeRealOffsetY(),t=0,e=i.length;e>t;t++)i[t].rendering(o,n,r)},_renderingToCacheCanvas:function(t,e,i,n){t||cc.log("The context of RenderTexture is invalid."),i=cc.isUndefined(i)?1:i,n=cc.isUndefined(n)?1:n,e=e||this._currentID;var r,o,s=this._cacheToCanvasCmds[e];for(t.computeRealOffsetY(),r=0,o=s.length;o>r;r++)s[r].rendering(t,i,n);s.length=0,t=this._cacheInstanceIds,delete this._cacheToCanvasCmds[e],cc.arrayRemoveObject(t,e),0===t.length?this._isCacheToCanvasOn=!1:this._currentID=t[t.length-1]},_turnToCacheMode:function(t){this._isCacheToCanvasOn=!0,t=t||0,this._cacheToCanvasCmds[t]=[],-1===this._cacheInstanceIds.indexOf(t)&&this._cacheInstanceIds.push(t),this._currentID=t},_turnToNormalMode:function(){this._isCacheToCanvasOn=!1},resetFlag:function(){this.childrenOrderDirty=!1,this._transformNodePool.length=0},transform:function(){var t=this._transformNodePool;t.sort(this._sortNodeByLevelAsc);for(var e=0,i=t.length;i>e;e++)0!==t[e]._dirtyFlag&&t[e].updateStatus();t.length=0},transformDirty:function(){return 0<this._transformNodePool.length},_sortNodeByLevelAsc:function(t,e){return t._curLevel-e._curLevel},pushDirtyNode:function(t){this._transformNodePool.push(t)},clearRenderCommands:function(){this._renderCmds.length=0},pushRenderCommand:function(t){if(t._needDraw)if(this._isCacheToCanvasOn){var e=this._cacheToCanvasCmds[this._currentID];-1===e.indexOf(t)&&e.push(t)}else-1===this._renderCmds.indexOf(t)&&this._renderCmds.push(t)}},cc._renderType===cc._RENDER_TYPE_CANVAS&&(cc.renderer=cc.rendererCanvas),function(){cc.CanvasContextWrapper=function(t){this._context=t,this._saveCount=0,this._currentAlpha=t.globalAlpha,this._currentCompositeOperation=t.globalCompositeOperation,this._currentFillStyle=t.fillStyle,this._currentStrokeStyle=t.strokeStyle,this._offsetY=this._offsetX=0,this._realOffsetY=this.height,this._armatureMode=0};var t=cc.CanvasContextWrapper.prototype;t.resetCache=function(){var t=this._context;this._currentAlpha=t.globalAlpha,this._currentCompositeOperation=t.globalCompositeOperation,this._currentFillStyle=t.fillStyle,this._currentStrokeStyle=t.strokeStyle,this._realOffsetY=this._context.canvas.height+this._offsetY},t.setOffset=function(t,e){this._offsetX=t,this._offsetY=e,this._realOffsetY=this._context.canvas.height+this._offsetY},t.computeRealOffsetY=function(){this._realOffsetY=this._context.canvas.height+this._offsetY},t.setViewScale=function(t,e){this._scaleX=t,this._scaleY=e},t.getContext=function(){return this._context},t.save=function(){this._context.save(),this._saveCount++},t.restore=function(){this._context.restore(),this._saveCount--},t.setGlobalAlpha=function(t){0<this._saveCount?this._context.globalAlpha=t:this._currentAlpha!==t&&(this._currentAlpha=t,this._context.globalAlpha=t)},t.setCompositeOperation=function(t){0<this._saveCount?this._context.globalCompositeOperation=t:this._currentCompositeOperation!==t&&(this._currentCompositeOperation=t,this._context.globalCompositeOperation=t)},t.setFillStyle=function(t){0<this._saveCount?this._context.fillStyle=t:this._currentFillStyle!==t&&(this._currentFillStyle=t,this._context.fillStyle=t)},t.setStrokeStyle=function(t){0<this._saveCount?this._context.strokeStyle=t:this._currentStrokeStyle!==t&&(this._currentStrokeStyle=t,this._context.strokeStyle=t)},t.setTransform=function(t,e,i){0<this._armatureMode?(this.restore(),this.save(),this._context.transform(t.a,-t.b,-t.c,t.d,t.tx*e,-(t.ty*i))):this._context.setTransform(t.a,-t.b,-t.c,t.d,this._offsetX+t.tx*e,this._realOffsetY-t.ty*i)},t._switchToArmatureMode=function(t,e,i,n){t?(this._armatureMode++,this._context.setTransform(e.a,e.c,e.b,e.d,this._offsetX+e.tx*i,this._realOffsetY-e.ty*n),this.save()):(this._armatureMode--,this.restore())}}(),cc.rendererWebGL={childrenOrderDirty:!0,_transformNodePool:[],_renderCmds:[],_isCacheToBufferOn:!1,_cacheToBufferCmds:{},_cacheInstanceIds:[],_currentID:0,getRenderCmd:function(t){return t._createRenderCmd()},rendering:function(t){var e,i=this._renderCmds,n=t||cc._renderContext;for(t=0,e=i.length;e>t;t++)i[t].rendering(n)},_turnToCacheMode:function(t){this._isCacheToBufferOn=!0,t=t||0,this._cacheToBufferCmds[t]=[],this._cacheInstanceIds.push(t),this._currentID=t},_turnToNormalMode:function(){this._isCacheToBufferOn=!1},_renderingToBuffer:function(t){t=t||this._currentID;var e,i,n=this._cacheToBufferCmds[t],r=cc._renderContext,o=this._cacheInstanceIds;for(e=0,i=n.length;i>e;e++)n[e].rendering(r);n.length=0,delete this._cacheToBufferCmds[t],cc.arrayRemoveObject(o,t),0===o.length?this._isCacheToBufferOn=!1:this._currentID=o[o.length-1]},resetFlag:function(){this.childrenOrderDirty=!1,this._transformNodePool.length=0},transform:function(){var t=this._transformNodePool;t.sort(this._sortNodeByLevelAsc);for(var e=0,i=t.length;i>e;e++)t[e].updateStatus();t.length=0},transformDirty:function(){return 0<this._transformNodePool.length},_sortNodeByLevelAsc:function(t,e){return t._curLevel-e._curLevel},pushDirtyNode:function(t){this._transformNodePool.push(t)},clearRenderCommands:function(){this._renderCmds.length=0},pushRenderCommand:function(t){if(t._needDraw)if(this._isCacheToBufferOn){var e=this._cacheToBufferCmds[this._currentID];-1===e.indexOf(t)&&e.push(t)}else-1===this._renderCmds.indexOf(t)&&this._renderCmds.push(t)}},cc._renderType===cc._RENDER_TYPE_WEBGL&&(cc.renderer=cc.rendererWebGL),cc._tmp.PrototypeCCNode=function(){var t=cc.Node.prototype;cc.defineGetterSetter(t,"x",t.getPositionX,t.setPositionX),cc.defineGetterSetter(t,"y",t.getPositionY,t.setPositionY),cc.defineGetterSetter(t,"width",t._getWidth,t._setWidth),cc.defineGetterSetter(t,"height",t._getHeight,t._setHeight),cc.defineGetterSetter(t,"anchorX",t._getAnchorX,t._setAnchorX),cc.defineGetterSetter(t,"anchorY",t._getAnchorY,t._setAnchorY),cc.defineGetterSetter(t,"skewX",t.getSkewX,t.setSkewX),cc.defineGetterSetter(t,"skewY",t.getSkewY,t.setSkewY),cc.defineGetterSetter(t,"zIndex",t.getLocalZOrder,t.setLocalZOrder),cc.defineGetterSetter(t,"vertexZ",t.getVertexZ,t.setVertexZ),cc.defineGetterSetter(t,"rotation",t.getRotation,t.setRotation),cc.defineGetterSetter(t,"rotationX",t.getRotationX,t.setRotationX),cc.defineGetterSetter(t,"rotationY",t.getRotationY,t.setRotationY),cc.defineGetterSetter(t,"scale",t.getScale,t.setScale),cc.defineGetterSetter(t,"scaleX",t.getScaleX,t.setScaleX),cc.defineGetterSetter(t,"scaleY",t.getScaleY,t.setScaleY),cc.defineGetterSetter(t,"children",t.getChildren),cc.defineGetterSetter(t,"childrenCount",t.getChildrenCount),cc.defineGetterSetter(t,"parent",t.getParent,t.setParent),cc.defineGetterSetter(t,"visible",t.isVisible,t.setVisible),cc.defineGetterSetter(t,"running",t.isRunning),cc.defineGetterSetter(t,"ignoreAnchor",t.isIgnoreAnchorPointForPosition,t.ignoreAnchorPointForPosition),cc.defineGetterSetter(t,"actionManager",t.getActionManager,t.setActionManager),cc.defineGetterSetter(t,"scheduler",t.getScheduler,t.setScheduler),cc.defineGetterSetter(t,"shaderProgram",t.getShaderProgram,t.setShaderProgram),cc.defineGetterSetter(t,"opacity",t.getOpacity,t.setOpacity),cc.defineGetterSetter(t,"opacityModifyRGB",t.isOpacityModifyRGB),cc.defineGetterSetter(t,"cascadeOpacity",t.isCascadeOpacityEnabled,t.setCascadeOpacityEnabled),cc.defineGetterSetter(t,"color",t.getColor,t.setColor),cc.defineGetterSetter(t,"cascadeColor",t.isCascadeColorEnabled,t.setCascadeColorEnabled)},cc.NODE_TAG_INVALID=-1,cc.s_globalOrderOfArrival=1,cc.Node=cc.Class.extend({_localZOrder:0,_globalZOrder:0,_vertexZ:0,_rotationX:0,_rotationY:0,_scaleX:1,_scaleY:1,_position:null,_normalizedPosition:null,_usingNormalizedPosition:!1,_normalizedPositionDirty:!1,_skewX:0,_skewY:0,_children:null,_visible:!0,_anchorPoint:null,_contentSize:null,_running:!1,_parent:null,_ignoreAnchorPointForPosition:!1,tag:cc.NODE_TAG_INVALID,userData:null,userObject:null,_reorderChildDirty:!1,_shaderProgram:null,arrivalOrder:0,_actionManager:null,_scheduler:null,_eventDispatcher:null,_additionalTransformDirty:!1,_additionalTransform:null,_componentContainer:null,_isTransitionFinished:!1,_className:"Node",_showNode:!1,_name:"",_realOpacity:255,_realColor:null,_cascadeColorEnabled:!1,_cascadeOpacityEnabled:!1,_renderCmd:null,_camera:null,ctor:function(){this._initNode(),this._initRendererCmd()},_initNode:function(){this._anchorPoint=cc.p(0,0),this._contentSize=cc.size(0,0),this._position=cc.p(0,0),this._normalizedPosition=cc.p(0,0),this._children=[];var t=cc.director;this._actionManager=t.getActionManager(),this._scheduler=t.getScheduler(),this._additionalTransform=cc.affineTransformMakeIdentity(),cc.ComponentContainer&&(this._componentContainer=new cc.ComponentContainer(this)),this._realOpacity=255,this._realColor=cc.color(255,255,255,255),this._cascadeOpacityEnabled=this._cascadeColorEnabled=!1},init:function(){return!0},_arrayMakeObjectsPerformSelector:function(t,e){if(t&&0!==t.length){var i,n,r=t.length;switch(i=cc.Node._stateCallbackType,e){case i.onEnter:for(i=0;r>i;i++)(n=t[i])&&n.onEnter();
break;case i.onExit:for(i=0;r>i;i++)(n=t[i])&&n.onExit();break;case i.onEnterTransitionDidFinish:for(i=0;r>i;i++)(n=t[i])&&n.onEnterTransitionDidFinish();break;case i.cleanup:for(i=0;r>i;i++)(n=t[i])&&n.cleanup();break;case i.updateTransform:for(i=0;r>i;i++)(n=t[i])&&n.updateTransform();break;case i.onExitTransitionDidStart:for(i=0;r>i;i++)(n=t[i])&&n.onExitTransitionDidStart();break;case i.sortAllChildren:for(i=0;r>i;i++)(n=t[i])&&n.sortAllChildren();break;default:cc.assert(0,cc._LogInfos.Node__arrayMakeObjectsPerformSelector)}}},attr:function(t){for(var e in t)this[e]=t[e]},getSkewX:function(){return this._skewX},setSkewX:function(t){this._skewX=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getSkewY:function(){return this._skewY},setSkewY:function(t){this._skewY=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},setLocalZOrder:function(t){this._localZOrder=t,this._parent&&this._parent.reorderChild(this,t),cc.eventManager._setDirtyForNode(this)},_setLocalZOrder:function(t){this._localZOrder=t},getLocalZOrder:function(){return this._localZOrder},getZOrder:function(){return cc.log(cc._LogInfos.Node_getZOrder),this.getLocalZOrder()},setZOrder:function(t){cc.log(cc._LogInfos.Node_setZOrder),this.setLocalZOrder(t)},setGlobalZOrder:function(t){this._globalZOrder!==t&&(this._globalZOrder=t,cc.eventManager._setDirtyForNode(this))},getGlobalZOrder:function(){return this._globalZOrder},getVertexZ:function(){return this._vertexZ},setVertexZ:function(t){this._vertexZ=t},getRotation:function(){return this._rotationX!==this._rotationY&&cc.log(cc._LogInfos.Node_getRotation),this._rotationX},setRotation:function(t){this._rotationX=this._rotationY=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getRotationX:function(){return this._rotationX},setRotationX:function(t){this._rotationX=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getRotationY:function(){return this._rotationY},setRotationY:function(t){this._rotationY=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getScale:function(){return this._scaleX!==this._scaleY&&cc.log(cc._LogInfos.Node_getScale),this._scaleX},setScale:function(t,e){this._scaleX=t,this._scaleY=e||0===e?e:t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getScaleX:function(){return this._scaleX},setScaleX:function(t){this._scaleX=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getScaleY:function(){return this._scaleY},setScaleY:function(t){this._scaleY=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},setPosition:function(t,e){var i=this._position;if(void 0===e){if(i.x===t.x&&i.y===t.y)return;i.x=t.x,i.y=t.y}else{if(i.x===t&&i.y===e)return;i.x=t,i.y=e}this._usingNormalizedPosition=!1,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},setNormalizedPosition:function(t,e){var i=this._normalizedPosition;void 0===e?(i.x=t.x,i.y=t.y):(i.x=t,i.y=e),this._normalizedPositionDirty=this._usingNormalizedPosition=!0,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getPosition:function(){return cc.p(this._position)},getNormalizedPosition:function(){return cc.p(this._normalizedPosition)},getPositionX:function(){return this._position.x},setPositionX:function(t){this._position.x=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getPositionY:function(){return this._position.y},setPositionY:function(t){this._position.y=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getChildrenCount:function(){return this._children.length},getChildren:function(){return this._children},isVisible:function(){return this._visible},setVisible:function(t){this._visible!==t&&(this._visible=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty),cc.renderer.childrenOrderDirty=!0)},getAnchorPoint:function(){return cc.p(this._anchorPoint)},setAnchorPoint:function(t,e){var i=this._anchorPoint;if(void 0===e){if(t.x===i.x&&t.y===i.y)return;i.x=t.x,i.y=t.y}else{if(t===i.x&&e===i.y)return;i.x=t,i.y=e}this._renderCmd._updateAnchorPointInPoint()},_getAnchorX:function(){return this._anchorPoint.x},_setAnchorX:function(t){this._anchorPoint.x!==t&&(this._anchorPoint.x=t,this._renderCmd._updateAnchorPointInPoint())},_getAnchorY:function(){return this._anchorPoint.y},_setAnchorY:function(t){this._anchorPoint.y!==t&&(this._anchorPoint.y=t,this._renderCmd._updateAnchorPointInPoint())},getAnchorPointInPoints:function(){return this._renderCmd.getAnchorPointInPoints()},_getWidth:function(){return this._contentSize.width},_setWidth:function(t){this._contentSize.width=t,this._renderCmd._updateAnchorPointInPoint()},_getHeight:function(){return this._contentSize.height},_setHeight:function(t){this._contentSize.height=t,this._renderCmd._updateAnchorPointInPoint()},getContentSize:function(){return cc.size(this._contentSize)},setContentSize:function(t,e){var i=this._contentSize;if(void 0===e){if(t.width===i.width&&t.height===i.height)return;i.width=t.width,i.height=t.height}else{if(t===i.width&&e===i.height)return;i.width=t,i.height=e}this._renderCmd._updateAnchorPointInPoint()},isRunning:function(){return this._running},getParent:function(){return this._parent},setParent:function(t){this._parent=t},isIgnoreAnchorPointForPosition:function(){return this._ignoreAnchorPointForPosition},ignoreAnchorPointForPosition:function(t){t!==this._ignoreAnchorPointForPosition&&(this._ignoreAnchorPointForPosition=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty))},getTag:function(){return this.tag},setTag:function(t){this.tag=t},setName:function(t){this._name=t},getName:function(){return this._name},getUserData:function(){return this.userData},setUserData:function(t){this.userData=t},getUserObject:function(){return this.userObject},setUserObject:function(t){this.userObject!==t&&(this.userObject=t)},getOrderOfArrival:function(){return this.arrivalOrder},setOrderOfArrival:function(t){this.arrivalOrder=t},getActionManager:function(){return this._actionManager||(this._actionManager=cc.director.getActionManager()),this._actionManager},setActionManager:function(t){this._actionManager!==t&&(this.stopAllActions(),this._actionManager=t)},getScheduler:function(){return this._scheduler||(this._scheduler=cc.director.getScheduler()),this._scheduler},setScheduler:function(t){this._scheduler!==t&&(this.unscheduleAllCallbacks(),this._scheduler=t)},boundingBox:function(){return cc.log(cc._LogInfos.Node_boundingBox),this.getBoundingBox()},getBoundingBox:function(){var t=cc.rect(0,0,this._contentSize.width,this._contentSize.height);return cc._rectApplyAffineTransformIn(t,this.getNodeToParentTransform())},cleanup:function(){this.stopAllActions(),this.unscheduleAllCallbacks(),cc.eventManager.removeListeners(this),this._arrayMakeObjectsPerformSelector(this._children,cc.Node._stateCallbackType.cleanup)},getChildByTag:function(t){var e=this._children;if(null!==e)for(var i=0;i<e.length;i++){var n=e[i];if(n&&n.tag===t)return n}return null},getChildByName:function(t){if(!t)return cc.log("Invalid name"),null;for(var e=this._children,i=0,n=e.length;n>i;i++)if(e[i]._name===t)return e[i];return null},addChild:function(t,e,i){e=void 0===e?t._localZOrder:e;var n,r=!1;cc.isUndefined(i)?(i=void 0,n=t._name):cc.isString(i)?(n=i,i=void 0):cc.isNumber(i)&&(r=!0,n=""),cc.assert(t,cc._LogInfos.Node_addChild_3),cc.assert(null===t._parent,"child already added. It can't be added again"),this._addChildHelper(t,e,i,n,r)},_addChildHelper:function(t,e,i,n,r){this._children||(this._children=[]),this._insertChild(t,e),r?t.setTag(i):t.setName(n),t.setParent(this),t.setOrderOfArrival(cc.s_globalOrderOfArrival++),this._running&&(t.onEnter(),this._isTransitionFinished)&&t.onEnterTransitionDidFinish(),this._cascadeColorEnabled&&t._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty),this._cascadeOpacityEnabled&&t._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty)},removeFromParent:function(t){this._parent&&(void 0===t&&(t=!0),this._parent.removeChild(this,t))},removeFromParentAndCleanup:function(t){cc.log(cc._LogInfos.Node_removeFromParentAndCleanup),this.removeFromParent(t)},removeChild:function(t,e){0!==this._children.length&&(void 0===e&&(e=!0),-1<this._children.indexOf(t)&&this._detachChild(t,e),cc.renderer.childrenOrderDirty=!0)},removeChildByTag:function(t,e){t===cc.NODE_TAG_INVALID&&cc.log(cc._LogInfos.Node_removeChildByTag);var i=this.getChildByTag(t);i?this.removeChild(i,e):cc.log(cc._LogInfos.Node_removeChildByTag_2,t)},removeAllChildrenWithCleanup:function(t){this.removeAllChildren(t)},removeAllChildren:function(t){var e=this._children;if(null!==e){void 0===t&&(t=!0);for(var i=0;i<e.length;i++){var n=e[i];n&&(this._running&&(n.onExitTransitionDidStart(),n.onExit()),t&&n.cleanup(),n.parent=null,n._renderCmd.detachFromParent())}this._children.length=0,cc.renderer.childrenOrderDirty=!0}},_detachChild:function(t,e){this._running&&(t.onExitTransitionDidStart(),t.onExit()),e&&t.cleanup(),t.parent=null,t._renderCmd.detachFromParent(),cc.arrayRemoveObject(this._children,t)},_insertChild:function(t,e){cc.renderer.childrenOrderDirty=this._reorderChildDirty=!0,this._children.push(t),t._setLocalZOrder(e)},setNodeDirty:function(){this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},reorderChild:function(t,e){cc.assert(t,cc._LogInfos.Node_reorderChild),cc.renderer.childrenOrderDirty=this._reorderChildDirty=!0,t.arrivalOrder=cc.s_globalOrderOfArrival,cc.s_globalOrderOfArrival++,t._setLocalZOrder(e)},sortAllChildren:function(){if(this._reorderChildDirty){var t,e,i,n=this._children,r=n.length;for(t=1;r>t;t++){for(i=n[t],e=t-1;e>=0;){if(i._localZOrder<n[e]._localZOrder)n[e+1]=n[e];else{if(!(i._localZOrder===n[e]._localZOrder&&i.arrivalOrder<n[e].arrivalOrder))break;n[e+1]=n[e]}e--}n[e+1]=i}this._reorderChildDirty=!1}},draw:function(){},transformAncestors:function(){null!==this._parent&&(this._parent.transformAncestors(),this._parent.transform())},onEnter:function(){this._isTransitionFinished=!1,this._running=!0,this._arrayMakeObjectsPerformSelector(this._children,cc.Node._stateCallbackType.onEnter),this.resume()},onEnterTransitionDidFinish:function(){this._isTransitionFinished=!0,this._arrayMakeObjectsPerformSelector(this._children,cc.Node._stateCallbackType.onEnterTransitionDidFinish)},onExitTransitionDidStart:function(){this._arrayMakeObjectsPerformSelector(this._children,cc.Node._stateCallbackType.onExitTransitionDidStart)},onExit:function(){this._running=!1,this.pause(),this._arrayMakeObjectsPerformSelector(this._children,cc.Node._stateCallbackType.onExit),this.removeAllComponents()},runAction:function(t){return cc.assert(t,cc._LogInfos.Node_runAction),this.actionManager.addAction(t,this,!this._running),t},stopAllActions:function(){this.actionManager&&this.actionManager.removeAllActionsFromTarget(this)},stopAction:function(t){this.actionManager.removeAction(t)},stopActionByTag:function(t){t===cc.ACTION_TAG_INVALID?cc.log(cc._LogInfos.Node_stopActionByTag):this.actionManager.removeActionByTag(t,this)},getActionByTag:function(t){return t===cc.ACTION_TAG_INVALID?(cc.log(cc._LogInfos.Node_getActionByTag),null):this.actionManager.getActionByTag(t,this)},getNumberOfRunningActions:function(){return this.actionManager.numberOfRunningActionsInTarget(this)},scheduleUpdate:function(){this.scheduleUpdateWithPriority(0)},scheduleUpdateWithPriority:function(t){this.scheduler.scheduleUpdate(this,t,!this._running)},unscheduleUpdate:function(){this.scheduler.unscheduleUpdate(this)},schedule:function(t,e,i,n,r){var o=arguments.length;"function"==typeof t?1===o?(e=0,i=cc.REPEAT_FOREVER,n=0,r=this.__instanceId):2===o?"number"==typeof e?(i=cc.REPEAT_FOREVER,n=0,r=this.__instanceId):(r=e,e=0,i=cc.REPEAT_FOREVER,n=0):3===o?("string"==typeof i?(r=i,i=cc.REPEAT_FOREVER):r=this.__instanceId,n=0):4===o&&(r=this.__instanceId):1===o?(e=0,i=cc.REPEAT_FOREVER,n=0):2===o&&(i=cc.REPEAT_FOREVER,n=0),cc.assert(t,cc._LogInfos.Node_schedule),cc.assert(e>=0,cc._LogInfos.Node_schedule_2),i=null==i?cc.REPEAT_FOREVER:i,this.scheduler.schedule(t,this,e||0,i,n||0,!this._running,r)},scheduleOnce:function(t,e,i){void 0===i&&(i=this.__instanceId),this.schedule(t,0,0,e,i)},unschedule:function(t){t&&this.scheduler.unschedule(t,this)},unscheduleAllCallbacks:function(){this.scheduler.unscheduleAllForTarget(this)},resumeSchedulerAndActions:function(){cc.log(cc._LogInfos.Node_resumeSchedulerAndActions),this.resume()},resume:function(){this.scheduler.resumeTarget(this),this.actionManager&&this.actionManager.resumeTarget(this),cc.eventManager.resumeTarget(this)},pauseSchedulerAndActions:function(){cc.log(cc._LogInfos.Node_pauseSchedulerAndActions),this.pause()},pause:function(){this.scheduler.pauseTarget(this),this.actionManager&&this.actionManager.pauseTarget(this),cc.eventManager.pauseTarget(this)},setAdditionalTransform:function(t){return void 0===t?this._additionalTransformDirty=!1:(this._additionalTransform=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty),void(this._additionalTransformDirty=!0))},getParentToNodeTransform:function(){this._renderCmd.getParentToNodeTransform()},parentToNodeTransform:function(){return this.getParentToNodeTransform()},getNodeToWorldTransform:function(){for(var t=this.getNodeToParentTransform(),e=this._parent;null!==e;e=e.parent)t=cc.affineTransformConcat(t,e.getNodeToParentTransform());return t},nodeToWorldTransform:function(){return this.getNodeToWorldTransform()},getWorldToNodeTransform:function(){return cc.affineTransformInvert(this.getNodeToWorldTransform())},worldToNodeTransform:function(){return this.getWorldToNodeTransform()},convertToNodeSpace:function(t){return cc.pointApplyAffineTransform(t,this.getWorldToNodeTransform())},convertToWorldSpace:function(t){return t=t||cc.p(0,0),cc.pointApplyAffineTransform(t,this.getNodeToWorldTransform())},convertToNodeSpaceAR:function(t){return cc.pSub(this.convertToNodeSpace(t),this._renderCmd.getAnchorPointInPoints())},convertToWorldSpaceAR:function(t){return t=t||cc.p(0,0),t=cc.pAdd(t,this._renderCmd.getAnchorPointInPoints()),this.convertToWorldSpace(t)},_convertToWindowSpace:function(t){return t=this.convertToWorldSpace(t),cc.director.convertToUI(t)},convertTouchToNodeSpace:function(t){return t=t.getLocation(),this.convertToNodeSpace(t)},convertTouchToNodeSpaceAR:function(t){return t=cc.director.convertToGL(t.getLocation()),this.convertToNodeSpaceAR(t)},update:function(t){this._componentContainer&&!this._componentContainer.isEmpty()&&this._componentContainer.visit(t)},updateTransform:function(){this._arrayMakeObjectsPerformSelector(this._children,cc.Node._stateCallbackType.updateTransform)},retain:function(){},release:function(){},getComponent:function(t){return this._componentContainer?this._componentContainer.getComponent(t):null},addComponent:function(t){this._componentContainer&&this._componentContainer.add(t)},removeComponent:function(t){return this._componentContainer?this._componentContainer.remove(t):!1},removeAllComponents:function(){this._componentContainer&&this._componentContainer.removeAll()},grid:null,visit:function(t){this._renderCmd.visit(t)},transform:function(t,e){this._renderCmd.transform(t,e)},nodeToParentTransform:function(){return this.getNodeToParentTransform()},getNodeToParentTransform:function(){return this._renderCmd.getNodeToParentTransform()},getCamera:function(){return this._camera||(this._camera=new cc.Camera),this._camera},getGrid:function(){return this.grid},setGrid:function(t){this.grid=t},getShaderProgram:function(){return this._renderCmd.getShaderProgram()},setShaderProgram:function(t){this._renderCmd.setShaderProgram(t)},getGLServerState:function(){return 0},setGLServerState:function(){},getBoundingBoxToWorld:function(){var t=cc.rect(0,0,this._contentSize.width,this._contentSize.height),e=this.getNodeToWorldTransform(),t=cc.rectApplyAffineTransform(t,e);if(!this._children)return t;for(var i=this._children,n=0;n<i.length;n++){var r=i[n];r&&r._visible&&(r=r._getBoundingBoxToCurrentNode(e))&&(t=cc.rectUnion(t,r))}return t},_getBoundingBoxToCurrentNode:function(t){var e=cc.rect(0,0,this._contentSize.width,this._contentSize.height);if(t=void 0===t?this.getNodeToParentTransform():cc.affineTransformConcat(this.getNodeToParentTransform(),t),e=cc.rectApplyAffineTransform(e,t),!this._children)return e;for(var i=this._children,n=0;n<i.length;n++){var r=i[n];r&&r._visible&&(r=r._getBoundingBoxToCurrentNode(t))&&(e=cc.rectUnion(e,r))}return e},getOpacity:function(){return this._realOpacity},getDisplayedOpacity:function(){return this._renderCmd.getDisplayedOpacity()},setOpacity:function(t){this._realOpacity=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty)},updateDisplayedOpacity:function(t){this._renderCmd._updateDisplayOpacity(t)},isCascadeOpacityEnabled:function(){return this._cascadeOpacityEnabled},setCascadeOpacityEnabled:function(t){this._cascadeOpacityEnabled!==t&&(this._cascadeOpacityEnabled=t,this._renderCmd.setCascadeOpacityEnabledDirty())},getColor:function(){var t=this._realColor;return cc.color(t.r,t.g,t.b,t.a)},getDisplayedColor:function(){return this._renderCmd.getDisplayedColor()},setColor:function(t){var e=this._realColor;e.r=t.r,e.g=t.g,e.b=t.b,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty)},updateDisplayedColor:function(t){this._renderCmd._updateDisplayColor(t)},isCascadeColorEnabled:function(){return this._cascadeColorEnabled},setCascadeColorEnabled:function(t){this._cascadeColorEnabled!==t&&(this._cascadeColorEnabled=t,this._renderCmd.setCascadeColorEnabledDirty())},setOpacityModifyRGB:function(){},isOpacityModifyRGB:function(){return!1},_initRendererCmd:function(){this._renderCmd=cc.renderer.getRenderCmd(this)},_createRenderCmd:function(){return cc._renderType===cc._RENDER_TYPE_CANVAS?new cc.Node.CanvasRenderCmd(this):new cc.Node.WebGLRenderCmd(this)},enumerateChildren:function(t,e){cc.assert(t&&0!=t.length,"Invalid name"),cc.assert(null!=e,"Invalid callback function");var i=t.length,n=0,r=i,o=!1;i>2&&"/"===t[0]&&"/"===t[1]&&(o=!0,n=2,r-=2);var s=!1;i>3&&"/"===t[i-3]&&"."===t[i-2]&&"."===t[i-1]&&(s=!0,r-=3),i=t.substr(n,r),s&&(i="[[:alnum:]]+/"+i),o?this.doEnumerateRecursive(this,i,e):this.doEnumerate(i,e)},doEnumerateRecursive:function(t,e,i){if(!t.doEnumerate(e,i))for(var n=t.getChildren(),r=n.length,o=0;r>o&&(t=n[o],!this.doEnumerateRecursive(t,e,i));o++);},doEnumerate:function(t,e){var i=t.indexOf("/"),n=t,r=!1;-1!==i&&(n=t.substr(0,i),r=!0);for(var o,i=!1,s=this._children,c=s.length,a=0;c>a;a++)if(o=s[a],-1!==o._name.indexOf(n))if(r){if(i=o.doEnumerate(t,e))break}else if(e(o)){i=!0;break}return i}}),cc.Node.create=function(){return new cc.Node},cc.Node._stateCallbackType={onEnter:1,onExit:2,cleanup:3,onEnterTransitionDidFinish:4,updateTransform:5,onExitTransitionDidStart:6,sortAllChildren:7},cc.assert(cc.isFunction(cc._tmp.PrototypeCCNode),cc._LogInfos.MissingFile,"BaseNodesPropertyDefine.js"),cc._tmp.PrototypeCCNode(),delete cc._tmp.PrototypeCCNode,cc.CustomRenderCmd=function(t,e){this._needDraw=!0,this._target=t,this._callback=e,this.rendering=function(t,e,i){this._callback&&this._callback.call(this._target,t,e,i)}},cc.Node._dirtyFlags={transformDirty:1,visibleDirty:2,colorDirty:4,opacityDirty:8,cacheDirty:16,orderDirty:32,textDirty:64,gradientDirty:128,all:255},cc.Node.RenderCmd=function(t){this._dirtyFlag=1,this._node=t,this._needDraw=!1,this._anchorPointInPoints=new cc.Point(0,0),this._transform={a:1,b:0,c:0,d:1,tx:0,ty:0},this._worldTransform={a:1,b:0,c:0,d:1,tx:0,ty:0},this._inverse={a:1,b:0,c:0,d:1,tx:0,ty:0},this._displayedOpacity=255,this._displayedColor=cc.color(255,255,255,255),this._cascadeOpacityEnabledDirty=this._cascadeColorEnabledDirty=!1,this._curLevel=-1},cc.Node.RenderCmd.prototype={constructor:cc.Node.RenderCmd,getAnchorPointInPoints:function(){return cc.p(this._anchorPointInPoints)},getDisplayedColor:function(){var t=this._displayedColor;return cc.color(t.r,t.g,t.b,t.a)},getDisplayedOpacity:function(){return this._displayedOpacity},setCascadeColorEnabledDirty:function(){this._cascadeColorEnabledDirty=!0,this.setDirtyFlag(cc.Node._dirtyFlags.colorDirty)},setCascadeOpacityEnabledDirty:function(){this._cascadeOpacityEnabledDirty=!0,this.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty)},getParentToNodeTransform:function(){return this._dirtyFlag&cc.Node._dirtyFlags.transformDirty&&(this._inverse=cc.affineTransformInvert(this.getNodeToParentTransform())),this._inverse},detachFromParent:function(){},_updateAnchorPointInPoint:function(){var t=this._anchorPointInPoints,e=this._node._contentSize,i=this._node._anchorPoint;t.x=e.width*i.x,t.y=e.height*i.y,this.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},setDirtyFlag:function(t){0===this._dirtyFlag&&0!==t&&cc.renderer.pushDirtyNode(this),this._dirtyFlag|=t},getParentRenderCmd:function(){return this._node&&this._node._parent&&this._node._parent._renderCmd?this._node._parent._renderCmd:null},_updateDisplayColor:function(t){var e,i=this._node,n=this._displayedColor,r=i._realColor;if(this._cascadeColorEnabledDirty&&!i._cascadeColorEnabled){for(n.r=r.r,n.g=r.g,n.b=r.b,n=new cc.Color(255,255,255,255),t=i._children,i=0,r=t.length;r>i;i++)(e=t[i])&&e._renderCmd&&e._renderCmd._updateDisplayColor(n);this._cascadeColorEnabledDirty=!1}else if(void 0===t&&(t=(t=i._parent)&&t._cascadeColorEnabled?t.getDisplayedColor():cc.color.WHITE),n.r=0|r.r*t.r/255,n.g=0|r.g*t.g/255,n.b=0|r.b*t.b/255,i._cascadeColorEnabled)for(t=i._children,i=0,r=t.length;r>i;i++)(e=t[i])&&e._renderCmd&&(e._renderCmd._updateDisplayColor(n),e._renderCmd._updateColor());this._dirtyFlag^=this._dirtyFlag&cc.Node._dirtyFlags.colorDirty},_updateDisplayOpacity:function(t){var e,i,n=this._node;if(this._cascadeOpacityEnabledDirty&&!n._cascadeOpacityEnabled){for(this._displayedOpacity=n._realOpacity,e=n._children,t=0,n=e.length;n>t;t++)(i=e[t])&&i._renderCmd&&i._renderCmd._updateDisplayOpacity(255);this._cascadeOpacityEnabledDirty=!1}else if(void 0===t&&(e=n._parent,t=255,e&&e._cascadeOpacityEnabled&&(t=e.getDisplayedOpacity())),this._displayedOpacity=n._realOpacity*t/255,n._cascadeOpacityEnabled)for(e=n._children,t=0,n=e.length;n>t;t++)(i=e[t])&&i._renderCmd&&(i._renderCmd._updateDisplayOpacity(this._displayedOpacity),i._renderCmd._updateColor());this._dirtyFlag^=this._dirtyFlag&cc.Node._dirtyFlags.opacityDirty},_syncDisplayColor:function(t){var e=this._node,i=this._displayedColor,n=e._realColor;void 0===t&&(t=(t=e._parent)&&t._cascadeColorEnabled?t.getDisplayedColor():cc.color.WHITE),i.r=0|n.r*t.r/255,i.g=0|n.g*t.g/255,i.b=0|n.b*t.b/255},_syncDisplayOpacity:function(t){var e=this._node;if(void 0===t){var i=e._parent;t=255,i&&i._cascadeOpacityEnabled&&(t=i.getDisplayedOpacity())}this._displayedOpacity=e._realOpacity*t/255},_updateColor:function(){},updateStatus:function(){var t=cc.Node._dirtyFlags,e=this._dirtyFlag,i=e&t.colorDirty,n=e&t.opacityDirty;i&&this._updateDisplayColor(),n&&this._updateDisplayOpacity(),(i||n)&&this._updateColor(),e&t.transformDirty&&(this.transform(this.getParentRenderCmd(),!0),this._dirtyFlag^=this._dirtyFlag&cc.Node._dirtyFlags.transformDirty)}},function(){cc.Node.CanvasRenderCmd=function(t){cc.Node.RenderCmd.call(this,t),this._cachedParent=null,this._cacheDirty=!1};var t=cc.Node.CanvasRenderCmd.prototype=Object.create(cc.Node.RenderCmd.prototype);t.constructor=cc.Node.CanvasRenderCmd,t.transform=function(t,e){var i=this.getNodeToParentTransform(),n=this._worldTransform;if(this._cacheDirty=!0,t){var r=t._worldTransform;n.a=i.a*r.a+i.b*r.c,n.b=i.a*r.b+i.b*r.d,n.c=i.c*r.a+i.d*r.c,n.d=i.c*r.b+i.d*r.d,n.tx=r.a*i.tx+r.c*i.ty+r.tx,n.ty=r.d*i.ty+r.ty+r.b*i.tx}else n.a=i.a,n.b=i.b,n.c=i.c,n.d=i.d,n.tx=i.tx,n.ty=i.ty;if(e&&(i=this._node._children)&&0!==i.length)for(n=0,r=i.length;r>n;n++)i[n]._renderCmd.transform(this,e)},t.getNodeToParentTransform=function(){var t=this._node,e=!1;if(t._usingNormalizedPosition&&t._parent&&(e=t._parent._contentSize,t._position.x=t._normalizedPosition.x*e.width,t._position.y=t._normalizedPosition.y*e.height,t._normalizedPositionDirty=!1,e=!0),e||this._dirtyFlag&cc.Node._dirtyFlags.transformDirty){e=this._transform,e.tx=t._position.x,e.ty=t._position.y;var i=1,n=0,r=0,o=1;t._rotationX&&(o=.017453292519943295*t._rotationX,r=Math.sin(o),o=Math.cos(o)),t._rotationY&&(n=.017453292519943295*t._rotationY,i=Math.cos(n),n=-Math.sin(n)),e.a=i,e.b=n,e.c=r,e.d=o;var s=t._scaleX,c=t._scaleY,a=this._anchorPointInPoints.x,l=this._anchorPointInPoints.y,h=1e-6>s&&s>-1e-6?1e-6:s,u=1e-6>c&&c>-1e-6?1e-6:c;(1!==s||1!==c)&&(i=e.a*=h,n=e.b*=h,r=e.c*=u,o=e.d*=u),(t._skewX||t._skewY)&&(s=Math.tan(-t._skewX*Math.PI/180),c=Math.tan(-t._skewY*Math.PI/180),1/0===s&&(s=99999999),1/0===c&&(c=99999999),h=l*s,u=a*c,e.a=i-r*c,e.b=n-o*c,e.c=r-i*s,e.d=o-n*s,e.tx+=i*h+r*u,e.ty+=n*h+o*u),e.tx-=i*a+r*l,e.ty-=n*a+o*l,t._ignoreAnchorPointForPosition&&(e.tx+=a,e.ty+=l),t._additionalTransformDirty&&(this._transform=cc.affineTransformConcat(e,t._additionalTransform))}return this._transform},t.visit=function(t){var e=this._node;if(e._visible){(t=t||this.getParentRenderCmd())&&(this._curLevel=t._curLevel+1);var i,n=e._children;if(this._syncStatus(t),t=n.length,t>0){for(e.sortAllChildren(),e=0;t>e&&(i=n[e],0>i._localZOrder);e++)i._renderCmd.visit(this);for(cc.renderer.pushRenderCommand(this);t>e;e++)n[e]._renderCmd.visit(this)}else cc.renderer.pushRenderCommand(this);this._dirtyFlag=0}},t._syncStatus=function(t){var e=cc.Node._dirtyFlags,i=this._dirtyFlag,n=t?t._node:null;n&&n._cascadeColorEnabled&&t._dirtyFlag&e.colorDirty&&(i|=e.colorDirty),n&&n._cascadeOpacityEnabled&&t._dirtyFlag&e.opacityDirty&&(i|=e.opacityDirty),t&&t._dirtyFlag&e.transformDirty&&(i|=e.transformDirty);var n=i&e.colorDirty,r=i&e.opacityDirty,e=i&e.transformDirty;this._dirtyFlag=i,n&&this._syncDisplayColor(),r&&this._syncDisplayOpacity(),n&&this._updateColor(),e&&this.transform(t)},t.setDirtyFlag=function(t){cc.Node.RenderCmd.prototype.setDirtyFlag.call(this,t),this._setCacheDirty(),this._cachedParent&&this._cachedParent.setDirtyFlag(t)},t._setCacheDirty=function(){if(!1===this._cacheDirty){this._cacheDirty=!0;var t=this._cachedParent;t&&t!==this&&t._setNodeDirtyForCache&&t._setNodeDirtyForCache()}},t._setCachedParent=function(t){if(this._cachedParent!==t){this._cachedParent=t;for(var e=this._node._children,i=0,n=e.length;n>i;i++)e[i]._renderCmd._setCachedParent(t)}},t.detachFromParent=function(){this._cachedParent=null;for(var t,e=this._node._children,i=0,n=e.length;n>i;i++)(t=e[i])&&t._renderCmd&&t._renderCmd.detachFromParent()},t.setShaderProgram=function(){},t.getShaderProgram=function(){return null},cc.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc=function(t){return t?t.src===cc.SRC_ALPHA&&t.dst===cc.ONE||t.src===cc.ONE&&t.dst===cc.ONE?"lighter":t.src===cc.ZERO&&t.dst===cc.SRC_ALPHA?"destination-in":t.src===cc.ZERO&&t.dst===cc.ONE_MINUS_SRC_ALPHA?"destination-out":"source-over":"source-over"}}(),function(){cc.Node.WebGLRenderCmd=function(t){cc.Node.RenderCmd.call(this,t),t=new cc.math.Matrix4;var e=t.mat;e[2]=e[3]=e[6]=e[7]=e[8]=e[9]=e[11]=e[14]=0,e[10]=e[15]=1,this._transform4x4=t,this._stackMatrix=new cc.math.Matrix4,this._camera=this._shaderProgram=null};var t=cc.Node.WebGLRenderCmd.prototype=Object.create(cc.Node.RenderCmd.prototype);t.constructor=cc.Node.WebGLRenderCmd,t.getNodeToParentTransform=function(){var t=this._node;if(t._usingNormalizedPosition&&t._parent){var e=t._parent._contentSize;t._position.x=t._normalizedPosition.x*e.width,t._position.y=t._normalizedPosition.y*e.height,t._normalizedPositionDirty=!1}if(this._dirtyFlag&cc.Node._dirtyFlags.transformDirty){var e=t._position.x,i=t._position.y,n=this._anchorPointInPoints.x,r=-n,o=this._anchorPointInPoints.y,s=-o,c=t._scaleX,a=t._scaleY,l=.017453292519943295*t._rotationX,h=.017453292519943295*t._rotationY;t._ignoreAnchorPointForPosition&&(e+=n,i+=o);var u=1,d=0,_=1,p=0;(0!==t._rotationX||0!==t._rotationY)&&(u=Math.cos(-l),d=Math.sin(-l),_=Math.cos(-h),p=Math.sin(-h)),l=t._skewX||t._skewY,l||0===n&&0===o||(e+=_*r*c+-d*s*a,i+=p*r*c+u*s*a),h=this._transform,h.a=_*c,h.b=p*c,h.c=-d*a,h.d=u*a,h.tx=e,h.ty=i,l&&(h=cc.affineTransformConcat({a:1,b:Math.tan(cc.degreesToRadians(t._skewY)),c:Math.tan(cc.degreesToRadians(t._skewX)),d:1,tx:0,ty:0},h),0!==n||0!==o)&&(h=cc.affineTransformTranslate(h,r,s)),t._additionalTransformDirty&&(h=cc.affineTransformConcat(h,t._additionalTransform),t._additionalTransformDirty=!1),this._transform=h}return this._transform},t._syncStatus=function(t){var e=cc.Node._dirtyFlags,i=this._dirtyFlag,n=t?t._node:null;n&&n._cascadeColorEnabled&&t._dirtyFlag&e.colorDirty&&(i|=e.colorDirty),n&&n._cascadeOpacityEnabled&&t._dirtyFlag&e.opacityDirty&&(i|=e.opacityDirty),t&&t._dirtyFlag&e.transformDirty&&(i|=e.transformDirty),n=i&e.colorDirty,e=i&e.opacityDirty,this._dirtyFlag=i,n&&this._syncDisplayColor(),e&&this._syncDisplayOpacity(),(n||e)&&this._updateColor(),this.transform(t)},t._updateColor=function(){},t.visit=function(t){var e=this._node;if(e._visible){t=t||this.getParentRenderCmd(),e._parent&&e._parent._renderCmd&&(this._curLevel=e._parent._renderCmd._curLevel+1);var i=cc.current_stack;if(i.stack.push(i.top),this._syncStatus(t),i.top=this._stackMatrix,(t=e._children)&&0<t.length){var n=t.length;for(e.sortAllChildren(),e=0;n>e&&(t[e]&&0>t[e]._localZOrder);e++)t[e]._renderCmd.visit(this);for(cc.renderer.pushRenderCommand(this);n>e;e++)t[e]&&t[e]._renderCmd.visit(this)}else cc.renderer.pushRenderCommand(this);this._dirtyFlag=0,i.top=i.stack.pop()}},t.transform=function(t,e){var i=this._transform4x4,n=this._stackMatrix,r=this._node,o=(t=t||this.getParentRenderCmd())?t._stackMatrix:cc.current_stack.top,s=this.getNodeToParentTransform();this._dirtyFlag^=this._dirtyFlag&cc.Node._dirtyFlags.transformDirty;var c=i.mat;if(c[0]=s.a,c[4]=s.c,c[12]=s.tx,c[1]=s.b,c[5]=s.d,c[13]=s.ty,c[14]=r._vertexZ,cc.kmMat4Multiply(n,o,i),null===r._camera||null!==r.grid&&r.grid.isActive()||(o=this._anchorPointInPoints.x,s=this._anchorPointInPoints.y,0!==o||0!==s?(cc.SPRITEBATCHNODE_RENDER_SUBPIXEL||(o|=0,s|=0),c=cc.math.Matrix4.createByTranslation(o,s,0,i),n.multiply(c),r._camera._locateForRenderer(n),c=cc.math.Matrix4.createByTranslation(-o,-s,0,c),n.multiply(c),i.identity()):r._camera._locateForRenderer(n)),e&&r._children&&0!==r._children.length)for(r=r._children,i=0,n=r.length;n>i;i++)r[i]._renderCmd.transform(this,e)},t.setShaderProgram=function(t){this._shaderProgram=t},t.getShaderProgram=function(){return this._shaderProgram}}(),cc.AtlasNode=cc.Node.extend({textureAtlas:null,quadsToDraw:0,_itemsPerRow:0,_itemsPerColumn:0,_itemWidth:0,_itemHeight:0,_opacityModifyRGB:!1,_blendFunc:null,_ignoreContentScaleFactor:!1,_className:"AtlasNode",_textureForCanvas:null,ctor:function(t,e,i,n){cc.Node.prototype.ctor.call(this),this._blendFunc={src:cc.BLEND_SRC,dst:cc.BLEND_DST},this._ignoreContentScaleFactor=!1,void 0!==n&&this.initWithTileFile(t,e,i,n)},_createRenderCmd:function(){this._renderCmd=cc._renderType===cc._RENDER_TYPE_CANVAS?new cc.AtlasNode.CanvasRenderCmd(this):new cc.AtlasNode.WebGLRenderCmd(this)},updateAtlasValues:function(){cc.log(cc._LogInfos.AtlasNode_updateAtlasValues)},getColor:function(){return this._opacityModifyRGB?this._renderCmd._colorUnmodified:cc.Node.prototype.getColor.call(this)},setOpacityModifyRGB:function(t){var e=this.color;this._opacityModifyRGB=t,this.setColor(e)},isOpacityModifyRGB:function(){return this._opacityModifyRGB},getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(t,e){this._blendFunc=void 0===e?t:{src:t,dst:e}},setTextureAtlas:function(t){this.textureAtlas=t},getTextureAtlas:function(){return this.textureAtlas},getQuadsToDraw:function(){return this.quadsToDraw},setQuadsToDraw:function(t){this.quadsToDraw=t},initWithTileFile:function(t,e,i,n){if(!t)throw"cc.AtlasNode.initWithTileFile(): title should not be null";return t=cc.textureCache.addImage(t),this.initWithTexture(t,e,i,n)},initWithTexture:function(t,e,i,n){return this._renderCmd.initWithTexture(t,e,i,n)},setColor:function(t){this._renderCmd.setColor(t)},setOpacity:function(t){this._renderCmd.setOpacity(t)
},getTexture:function(){return this._renderCmd.getTexture()},setTexture:function(t){this._renderCmd.setTexture(t)},_setIgnoreContentScaleFactor:function(t){this._ignoreContentScaleFactor=t}}),_p=cc.AtlasNode.prototype,cc.defineGetterSetter(_p,"opacity",_p.getOpacity,_p.setOpacity),cc.defineGetterSetter(_p,"color",_p.getColor,_p.setColor),cc.defineGetterSetter(_p,"texture",_p.getTexture,_p.setTexture),cc.EventHelper.prototype.apply(_p),cc.AtlasNode.create=function(t,e,i,n){return new cc.AtlasNode(t,e,i,n)},function(){cc.AtlasNode.CanvasRenderCmd=function(t){cc.Node.CanvasRenderCmd.call(this,t),this._needDraw=!1,this._colorUnmodified=cc.color.WHITE,this._texture=this._originalTexture=null};var t=cc.AtlasNode.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);t.constructor=cc.AtlasNode.CanvasRenderCmd,t.initWithTexture=function(t,e,i,n){var r=this._node;return r._itemWidth=e,r._itemHeight=i,r._opacityModifyRGB=!0,this._originalTexture=t,this._originalTexture?(this._texture=this._originalTexture,this._calculateMaxItems(),r.quadsToDraw=n,!0):(cc.log(cc._LogInfos.AtlasNode__initWithTexture),!1)},t.setColor=function(t){var e=this._node._realColor;(e.r!==t.r||e.g!==t.g||e.b!==t.b)&&(this._colorUnmodified=t,this._changeTextureColor())},t._changeTextureColor=cc.sys._supportCanvasNewBlendModes?function(){var t=this._node,e=t.getTexture();if(e&&this._originalTexture){var i=this._originalTexture.getHtmlElementObj();if(i){var n=e.getHtmlElementObj(),e=cc.rect(0,0,i.width,i.height);n instanceof HTMLCanvasElement?cc.Sprite.CanvasRenderCmd._generateTintImageWithMultiply(i,this._colorUnmodified,e,n):(n=cc.Sprite.CanvasRenderCmd._generateTintImageWithMultiply(i,this._colorUnmodified,e),e=new cc.Texture2D,e.initWithElement(n),e.handleLoadedTexture(),t.setTexture(e))}}}:function(){var t,e=this._node,i=e.getTexture();if(i&&this._originalTexture&&(t=i.getHtmlElementObj())){var n=this._originalTexture.getHtmlElementObj();(i=cc.textureCache.getTextureColors(n))&&(n=cc.rect(0,0,n.width,n.height),t instanceof HTMLCanvasElement?cc.Sprite.CanvasRenderCmd._generateTintImage(t,i,this._displayedColor,n,t):(t=cc.Sprite.CanvasRenderCmd._generateTintImage(t,i,this._displayedColor,n),i=new cc.Texture2D,i.initWithElement(t),i.handleLoadedTexture(),e.setTexture(i)))}},t.setOpacity=function(t){cc.Node.prototype.setOpacity.call(this._node,t)},t.getTexture=function(){return this._texture},t.setTexture=function(t){this._texture=t},t._calculateMaxItems=function(){var t=this._node,e=this._texture.getContentSize();t._itemsPerColumn=0|e.height/t._itemHeight,t._itemsPerRow=0|e.width/t._itemWidth}}(),function(){cc.AtlasNode.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._textureAtlas=null,this._colorUnmodified=cc.color.WHITE,this._uniformColor=this._colorF32Array=null,this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURE_UCOLOR),this._uniformColor=cc._renderContext.getUniformLocation(this._shaderProgram.getProgram(),"u_color")};var t=cc.AtlasNode.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);t.constructor=cc.AtlasNode.WebGLRenderCmd,t._updateBlendFunc=function(){var t=this._node;this._textureAtlas.texture.hasPremultipliedAlpha()||(t._blendFunc.src=cc.SRC_ALPHA,t._blendFunc.dst=cc.ONE_MINUS_SRC_ALPHA)},t._updateOpacityModifyRGB=function(){this._node._opacityModifyRGB=this._textureAtlas.texture.hasPremultipliedAlpha()},t.rendering=function(t){t=t||cc._renderContext;var e=this._node;this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix),cc.glBlendFunc(e._blendFunc.src,e._blendFunc.dst),this._uniformColor&&this._colorF32Array&&(t.uniform4fv(this._uniformColor,this._colorF32Array),this._textureAtlas.drawNumberOfQuads(e.quadsToDraw,0))},t.initWithTexture=function(t,e,i,n){var r=this._node;return r._itemWidth=e,r._itemHeight=i,this._colorUnmodified=cc.color.WHITE,r._opacityModifyRGB=!0,r._blendFunc.src=cc.BLEND_SRC,r._blendFunc.dst=cc.BLEND_DST,e=r._realColor,this._colorF32Array=new Float32Array([e.r/255,e.g/255,e.b/255,r._realOpacity/255]),this._textureAtlas=new cc.TextureAtlas,this._textureAtlas.initWithTexture(t,n),this._textureAtlas?(this._updateBlendFunc(),this._updateOpacityModifyRGB(),this._calculateMaxItems(),r.quadsToDraw=n,!0):(cc.log(cc._LogInfos.AtlasNode__initWithTexture),!1)},t.setColor=function(t){var e=cc.color(t.r,t.g,t.b),i=this._node;this._colorUnmodified=t,t=this._displayedOpacity,i._opacityModifyRGB&&(e.r=e.r*t/255,e.g=e.g*t/255,e.b=e.b*t/255),cc.Node.prototype.setColor.call(i,e)},t.setOpacity=function(t){var e=this._node;cc.Node.prototype.setOpacity.call(e,t),e._opacityModifyRGB&&(e.color=this._colorUnmodified)},t._updateColor=function(){var t=this._displayedColor;this._colorF32Array=new Float32Array([t.r/255,t.g/255,t.b/255,this._displayedOpacity/255])},t.getTexture=function(){return this._textureAtlas.texture},t.setTexture=function(t){this._textureAtlas.texture=t,this._updateBlendFunc(),this._updateOpacityModifyRGB()},t._calculateMaxItems=function(){var t=this._node,e=this._textureAtlas.texture,i=e.getContentSize();t._ignoreContentScaleFactor&&(i=e.getContentSizeInPixels()),t._itemsPerColumn=0|i.height/t._itemHeight,t._itemsPerRow=0|i.width/t._itemWidth}}(),cc._tmp.WebGLTexture2D=function(){cc.Texture2D=cc.Class.extend({_pVRHaveAlphaPremultiplied:!0,_pixelFormat:null,_pixelsWide:0,_pixelsHigh:0,_name:"",_contentSize:null,maxS:0,maxT:0,_hasPremultipliedAlpha:!1,_hasMipmaps:!1,shaderProgram:null,_textureLoaded:!1,_htmlElementObj:null,_webTextureObj:null,url:null,ctor:function(){this._contentSize=cc.size(0,0),this._pixelFormat=cc.Texture2D.defaultPixelFormat},releaseTexture:function(){this._webTextureObj&&cc._renderContext.deleteTexture(this._webTextureObj),cc.loader.release(this.url)},getPixelFormat:function(){return this._pixelFormat},getPixelsWide:function(){return this._pixelsWide},getPixelsHigh:function(){return this._pixelsHigh},getName:function(){return this._webTextureObj},getContentSize:function(){return cc.size(this._contentSize.width/cc.contentScaleFactor(),this._contentSize.height/cc.contentScaleFactor())},_getWidth:function(){return this._contentSize.width/cc.contentScaleFactor()},_getHeight:function(){return this._contentSize.height/cc.contentScaleFactor()},getContentSizeInPixels:function(){return this._contentSize},getMaxS:function(){return this.maxS},setMaxS:function(t){this.maxS=t},getMaxT:function(){return this.maxT},setMaxT:function(t){this.maxT=t},getShaderProgram:function(){return this.shaderProgram},setShaderProgram:function(t){this.shaderProgram=t},hasPremultipliedAlpha:function(){return this._hasPremultipliedAlpha},hasMipmaps:function(){return this._hasMipmaps},description:function(){return"<cc.Texture2D | Name = "+this._name+" | Dimensions = "+this._pixelsWide+" x "+this._pixelsHigh+" | Coordinates = ("+this.maxS+", "+this.maxT+")>"},releaseData:function(){},keepData:function(t){return t},initWithData:function(t,e,i,n,r){var o=cc.Texture2D,s=cc._renderContext,c=s.RGBA,a=s.UNSIGNED_BYTE,l=i*cc.Texture2D._B[e]/8;switch(0===l%8?s.pixelStorei(s.UNPACK_ALIGNMENT,8):0===l%4?s.pixelStorei(s.UNPACK_ALIGNMENT,4):0===l%2?s.pixelStorei(s.UNPACK_ALIGNMENT,2):s.pixelStorei(s.UNPACK_ALIGNMENT,1),this._webTextureObj=s.createTexture(),cc.glBindTexture2D(this),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),e){case o.PIXEL_FORMAT_RGBA8888:c=s.RGBA;break;case o.PIXEL_FORMAT_RGB888:c=s.RGB;break;case o.PIXEL_FORMAT_RGBA4444:a=s.UNSIGNED_SHORT_4_4_4_4;break;case o.PIXEL_FORMAT_RGB5A1:a=s.UNSIGNED_SHORT_5_5_5_1;break;case o.PIXEL_FORMAT_RGB565:a=s.UNSIGNED_SHORT_5_6_5;break;case o.PIXEL_FORMAT_AI88:c=s.LUMINANCE_ALPHA;break;case o.PIXEL_FORMAT_A8:c=s.ALPHA;break;case o.PIXEL_FORMAT_I8:c=s.LUMINANCE;break;default:cc.assert(0,cc._LogInfos.Texture2D_initWithData)}return s.texImage2D(s.TEXTURE_2D,0,c,i,n,0,c,a,t),this._contentSize.width=r.width,this._contentSize.height=r.height,this._pixelsWide=i,this._pixelsHigh=n,this._pixelFormat=e,this.maxS=r.width/i,this.maxT=r.height/n,this._hasMipmaps=this._hasPremultipliedAlpha=!1,this.shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURE),this._textureLoaded=!0},drawAtPoint:function(t){var e=[0,this.maxT,this.maxS,this.maxT,0,0,this.maxS,0],i=this._pixelsWide*this.maxS,n=this._pixelsHigh*this.maxT;t=[t.x,t.y,0,i+t.x,t.y,0,t.x,n+t.y,0,i+t.x,n+t.y,0],cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION|cc.VERTEX_ATTRIB_FLAG_TEX_COORDS),this._shaderProgram.use(),this._shaderProgram.setUniformsForBuiltins(),cc.glBindTexture2D(this),i=cc._renderContext,i.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,i.FLOAT,!1,0,t),i.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,i.FLOAT,!1,0,e),i.drawArrays(i.TRIANGLE_STRIP,0,4)},drawInRect:function(t){var e=[0,this.maxT,this.maxS,this.maxT,0,0,this.maxS,0];t=[t.x,t.y,t.x+t.width,t.y,t.x,t.y+t.height,t.x+t.width,t.y+t.height],cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION|cc.VERTEX_ATTRIB_FLAG_TEX_COORDS),this._shaderProgram.use(),this._shaderProgram.setUniformsForBuiltins(),cc.glBindTexture2D(this);var i=cc._renderContext;i.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,i.FLOAT,!1,0,t),i.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,i.FLOAT,!1,0,e),i.drawArrays(i.TRIANGLE_STRIP,0,4)},initWithImage:function(t){if(null==t)return cc.log(cc._LogInfos.Texture2D_initWithImage),!1;var e=t.getWidth(),i=t.getHeight(),n=cc.configuration.getMaxTextureSize();return e>n||i>n?(cc.log(cc._LogInfos.Texture2D_initWithImage_2,e,i,n,n),!1):(this._textureLoaded=!0,this._initPremultipliedATextureWithImage(t,e,i))},initWithElement:function(t){t&&(this._webTextureObj=cc._renderContext.createTexture(),this._htmlElementObj=t,this._textureLoaded=!0)},getHtmlElementObj:function(){return this._htmlElementObj},isLoaded:function(){return this._textureLoaded},handleLoadedTexture:function(t){if(t=void 0===t?!1:t,cc._rendererInitialized){if(!this._htmlElementObj){var e=cc.loader.getRes(this.url);if(!e)return;this.initWithElement(e)}this._htmlElementObj.width&&this._htmlElementObj.height&&(e=cc._renderContext,cc.glBindTexture2D(this),e.pixelStorei(e.UNPACK_ALIGNMENT,4),t&&e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this._htmlElementObj),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),this.shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURE),cc.glBindTexture2D(null),t&&e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),e=this._htmlElementObj.height,this._pixelsWide=this._contentSize.width=this._htmlElementObj.width,this._pixelsHigh=this._contentSize.height=e,this._pixelFormat=cc.Texture2D.PIXEL_FORMAT_RGBA8888,this.maxT=this.maxS=1,this._hasPremultipliedAlpha=t,this._hasMipmaps=!1,this.dispatchEvent("load"))}},initWithString:function(){return cc.log(cc._LogInfos.Texture2D_initWithString),null},initWithETCFile:function(){return cc.log(cc._LogInfos.Texture2D_initWithETCFile_2),!1},initWithPVRFile:function(){return cc.log(cc._LogInfos.Texture2D_initWithPVRFile_2),!1},initWithPVRTCData:function(){return cc.log(cc._LogInfos.Texture2D_initWithPVRTCData_2),!1},setTexParameters:function(t,e,i,n){var r=cc._renderContext;void 0!==e&&(t={minFilter:t,magFilter:e,wrapS:i,wrapT:n}),cc.assert(this._pixelsWide===cc.NextPOT(this._pixelsWide)&&this._pixelsHigh===cc.NextPOT(this._pixelsHigh)||t.wrapS===r.CLAMP_TO_EDGE&&t.wrapT===r.CLAMP_TO_EDGE,"WebGLRenderingContext.CLAMP_TO_EDGE should be used in NPOT textures"),cc.glBindTexture2D(this),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,t.minFilter),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,t.magFilter),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,t.wrapS),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,t.wrapT)},setAntiAliasTexParameters:function(){var t=cc._renderContext;cc.glBindTexture2D(this),this._hasMipmaps?t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_NEAREST):t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR)},setAliasTexParameters:function(){var t=cc._renderContext;cc.glBindTexture2D(this),this._hasMipmaps?t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST_MIPMAP_NEAREST):t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST)},generateMipmap:function(){cc.assert(this._pixelsWide===cc.NextPOT(this._pixelsWide)&&this._pixelsHigh===cc.NextPOT(this._pixelsHigh),"Mimpap texture only works in POT textures"),cc.glBindTexture2D(this),cc._renderContext.generateMipmap(cc._renderContext.TEXTURE_2D),this._hasMipmaps=!0},stringForFormat:function(){return cc.Texture2D._M[this._pixelFormat]},bitsPerPixelForFormat:function(t){t=t||this._pixelFormat;var e=cc.Texture2D._B[t];return null!=e?e:(cc.log(cc._LogInfos.Texture2D_bitsPerPixelForFormat,t),-1)},_initPremultipliedATextureWithImage:function(t,e,i){var n=cc.Texture2D,r=t.getData(),o=null,o=null,s=t.hasAlpha(),c=cc.size(t.getWidth(),t.getHeight()),a=n.defaultPixelFormat,l=t.getBitsPerComponent();s||(l>=8?a=n.PIXEL_FORMAT_RGB888:(cc.log(cc._LogInfos.Texture2D__initPremultipliedATextureWithImage),a=n.PIXEL_FORMAT_RGB565));var h=e*i;if(a===n.PIXEL_FORMAT_RGB565)if(s)for(r=new Uint16Array(e*i),o=t.getData(),l=0;h>l;++l)r[l]=(o[l]>>0&255)>>3<<11|(o[l]>>8&255)>>2<<5|(o[l]>>16&255)>>3<<0;else for(r=new Uint16Array(e*i),o=t.getData(),l=0;h>l;++l)r[l]=(255&o[l])>>3<<11|(255&o[l])>>2<<5|(255&o[l])>>3<<0;else if(a===n.PIXEL_FORMAT_RGBA4444)for(r=new Uint16Array(e*i),o=t.getData(),l=0;h>l;++l)r[l]=(o[l]>>0&255)>>4<<12|(o[l]>>8&255)>>4<<8|(o[l]>>16&255)>>4<<4|(o[l]>>24&255)>>4<<0;else if(a===n.PIXEL_FORMAT_RGB5A1)for(r=new Uint16Array(e*i),o=t.getData(),l=0;h>l;++l)r[l]=(o[l]>>0&255)>>3<<11|(o[l]>>8&255)>>3<<6|(o[l]>>16&255)>>3<<1|(o[l]>>24&255)>>7<<0;else if(a===n.PIXEL_FORMAT_A8)for(r=new Uint8Array(e*i),o=t.getData(),l=0;h>l;++l)r[l]=o>>24&255;if(s&&a===n.PIXEL_FORMAT_RGB888)for(o=t.getData(),r=new Uint8Array(e*i*3),l=0;h>l;++l)r[3*l]=o>>0&255,r[3*l+1]=o>>8&255,r[3*l+2]=o>>16&255;return this.initWithData(r,a,e,i,c),t.getData(),this._hasPremultipliedAlpha=t.isPremultipliedAlpha(),!0},addLoadedEventListener:function(t,e){this.addEventListener("load",t,e)},removeLoadedEventListener:function(t){this.removeEventListener("load",t)}})},cc._tmp.WebGLTextureAtlas=function(){var t=cc.TextureAtlas.prototype;t._setupVBO=function(){var t=cc._renderContext;this._buffersVBO[0]=t.createBuffer(),this._buffersVBO[1]=t.createBuffer(),this._quadsWebBuffer=t.createBuffer(),this._mapBuffers()},t._mapBuffers=function(){var t=cc._renderContext;t.bindBuffer(t.ARRAY_BUFFER,this._quadsWebBuffer),t.bufferData(t.ARRAY_BUFFER,this._quadsArrayBuffer,t.DYNAMIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._buffersVBO[1]),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this._indices,t.STATIC_DRAW)},t.drawNumberOfQuads=function(t,e){if(e=e||0,0!==t&&this.texture&&this.texture.isLoaded()){var i=cc._renderContext;cc.glBindTexture2D(this.texture),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX),i.bindBuffer(i.ARRAY_BUFFER,this._quadsWebBuffer),this.dirty&&(i.bufferData(i.ARRAY_BUFFER,this._quadsArrayBuffer,i.DYNAMIC_DRAW),this.dirty=!1),i.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,i.FLOAT,!1,24,0),i.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,i.UNSIGNED_BYTE,!0,24,12),i.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,i.FLOAT,!1,24,16),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this._buffersVBO[1]),cc.TEXTURE_ATLAS_USE_TRIANGLE_STRIP?i.drawElements(i.TRIANGLE_STRIP,6*t,i.UNSIGNED_SHORT,6*e*this._indices.BYTES_PER_ELEMENT):i.drawElements(i.TRIANGLES,6*t,i.UNSIGNED_SHORT,6*e*this._indices.BYTES_PER_ELEMENT),cc.g_NumberOfDraws++}}},cc._tmp.WebGLTextureCache=function(){var t=cc.textureCache;t.handleLoadedTexture=function(t){var e,i=this._textures;cc._rendererInitialized||(i=this._loadedTexturesBefore),e=i[t],e||(e=i[t]=new cc.Texture2D,e.url=t),".png"===cc.path.extname(t)?e.handleLoadedTexture(!0):e.handleLoadedTexture()},t.addImage=function(t,e,i){cc.assert(t,cc._LogInfos.Texture2D_addImage_2);var n=this._textures;cc._rendererInitialized||(n=this._loadedTexturesBefore);var r=n[t]||n[cc.loader._aliases[t]];return r?(r.isLoaded()?e&&e.call(i,r):r.addEventListener("load",function(){e&&e.call(i,r)},i),r):(r=n[t]=new cc.Texture2D,r.url=t,(cc.loader._checkIsImageURL(t)?cc.loader.load:cc.loader.loadImg).call(cc.loader,t,function(r){if(r)return e&&e.call(i,r);cc.textureCache.handleLoadedTexture(t);var o=n[t];e&&e.call(i,o)}),r)},t.addImageAsync=t.addImage,t=null},cc._tmp.PrototypeTexture2D=function(){var t=cc.Texture2D;t.PVRImagesHavePremultipliedAlpha=function(t){cc.PVRHaveAlphaPremultiplied_=t},t.PIXEL_FORMAT_RGBA8888=2,t.PIXEL_FORMAT_RGB888=3,t.PIXEL_FORMAT_RGB565=4,t.PIXEL_FORMAT_A8=5,t.PIXEL_FORMAT_I8=6,t.PIXEL_FORMAT_AI88=7,t.PIXEL_FORMAT_RGBA4444=8,t.PIXEL_FORMAT_RGB5A1=7,t.PIXEL_FORMAT_PVRTC4=9,t.PIXEL_FORMAT_PVRTC2=10,t.PIXEL_FORMAT_DEFAULT=t.PIXEL_FORMAT_RGBA8888,t.defaultPixelFormat=t.PIXEL_FORMAT_DEFAULT;var e=cc.Texture2D._M={};e[t.PIXEL_FORMAT_RGBA8888]="RGBA8888",e[t.PIXEL_FORMAT_RGB888]="RGB888",e[t.PIXEL_FORMAT_RGB565]="RGB565",e[t.PIXEL_FORMAT_A8]="A8",e[t.PIXEL_FORMAT_I8]="I8",e[t.PIXEL_FORMAT_AI88]="AI88",e[t.PIXEL_FORMAT_RGBA4444]="RGBA4444",e[t.PIXEL_FORMAT_RGB5A1]="RGB5A1",e[t.PIXEL_FORMAT_PVRTC4]="PVRTC4",e[t.PIXEL_FORMAT_PVRTC2]="PVRTC2",e=cc.Texture2D._B={},e[t.PIXEL_FORMAT_RGBA8888]=32,e[t.PIXEL_FORMAT_RGB888]=24,e[t.PIXEL_FORMAT_RGB565]=16,e[t.PIXEL_FORMAT_A8]=8,e[t.PIXEL_FORMAT_I8]=8,e[t.PIXEL_FORMAT_AI88]=16,e[t.PIXEL_FORMAT_RGBA4444]=16,e[t.PIXEL_FORMAT_RGB5A1]=16,e[t.PIXEL_FORMAT_PVRTC4]=4,e[t.PIXEL_FORMAT_PVRTC2]=3,t=cc.Texture2D.prototype,cc.defineGetterSetter(t,"name",t.getName),cc.defineGetterSetter(t,"pixelFormat",t.getPixelFormat),cc.defineGetterSetter(t,"pixelsWidth",t.getPixelsWide),cc.defineGetterSetter(t,"pixelsHeight",t.getPixelsHigh),cc.defineGetterSetter(t,"width",t._getWidth),cc.defineGetterSetter(t,"height",t._getHeight)},cc._tmp.PrototypeTextureAtlas=function(){var t=cc.TextureAtlas.prototype;cc.defineGetterSetter(t,"totalQuads",t.getTotalQuads),cc.defineGetterSetter(t,"capacity",t.getCapacity),cc.defineGetterSetter(t,"quads",t.getQuads,t.setQuads)},cc.ALIGN_CENTER=51,cc.ALIGN_TOP=19,cc.ALIGN_TOP_RIGHT=18,cc.ALIGN_RIGHT=50,cc.ALIGN_BOTTOM_RIGHT=34,cc.ALIGN_BOTTOM=35,cc.ALIGN_BOTTOM_LEFT=33,cc.ALIGN_LEFT=49,cc.ALIGN_TOP_LEFT=17,cc.PVRHaveAlphaPremultiplied_=!1,cc._renderType===cc._RENDER_TYPE_CANVAS?(cc.Texture2D=cc.Class.extend({_contentSize:null,_textureLoaded:!1,_htmlElementObj:null,url:null,_pattern:null,ctor:function(){this._contentSize=cc.size(0,0),this._textureLoaded=!1,this._htmlElementObj=null,this._pattern=""},getPixelsWide:function(){return this._contentSize.width},getPixelsHigh:function(){return this._contentSize.height},getContentSize:function(){var t=cc.contentScaleFactor();return cc.size(this._contentSize.width/t,this._contentSize.height/t)},_getWidth:function(){return this._contentSize.width/cc.contentScaleFactor()},_getHeight:function(){return this._contentSize.height/cc.contentScaleFactor()},getContentSizeInPixels:function(){return this._contentSize},initWithElement:function(t){t&&(this._htmlElementObj=t,this._contentSize.width=t.width,this._contentSize.height=t.height,this._textureLoaded=!0)},getHtmlElementObj:function(){return this._htmlElementObj},isLoaded:function(){return this._textureLoaded},handleLoadedTexture:function(){if(!this._textureLoaded){if(!this._htmlElementObj){var t=cc.loader.getRes(this.url);if(!t)return;this.initWithElement(t)}t=this._htmlElementObj,this._contentSize.width=t.width,this._contentSize.height=t.height,this.dispatchEvent("load")}},description:function(){return"<cc.Texture2D | width = "+this._contentSize.width+" height "+this._contentSize.height+">"},initWithData:function(){return!1},initWithImage:function(){return!1},initWithString:function(){return!1},releaseTexture:function(){cc.loader.release(this.url)},getName:function(){return null},getMaxS:function(){return 1},setMaxS:function(){},getMaxT:function(){return 1},setMaxT:function(){},getPixelFormat:function(){return null},getShaderProgram:function(){return null},setShaderProgram:function(){},hasPremultipliedAlpha:function(){return!1},hasMipmaps:function(){return!1},releaseData:function(){},keepData:function(t){return t},drawAtPoint:function(){},drawInRect:function(){},initWithETCFile:function(){return cc.log(cc._LogInfos.Texture2D_initWithETCFile),!1},initWithPVRFile:function(){return cc.log(cc._LogInfos.Texture2D_initWithPVRFile),!1},initWithPVRTCData:function(){return cc.log(cc._LogInfos.Texture2D_initWithPVRTCData),!1},setTexParameters:function(t,e,i,n){void 0!==e&&(t={minFilter:t,magFilter:e,wrapS:i,wrapT:n}),this._pattern=t.wrapS===cc.REPEAT&&t.wrapT===cc.REPEAT?"repeat":t.wrapS===cc.REPEAT?"repeat-x":t.wrapT===cc.REPEAT?"repeat-y":""},setAntiAliasTexParameters:function(){},setAliasTexParameters:function(){},generateMipmap:function(){},stringForFormat:function(){return""},bitsPerPixelForFormat:function(){return-1},addLoadedEventListener:function(t,e){this.addEventListener("load",t,e)},removeLoadedEventListener:function(t){this.removeEventListener("load",t)},_grayElementObj:null,_backupElement:null,_isGray:!1,_switchToGray:function(t){this._textureLoaded&&this._isGray!==t&&((this._isGray=t)?(this._backupElement=this._htmlElementObj,this._grayElementObj||(this._grayElementObj=cc.Texture2D._generateGrayTexture(this._htmlElementObj)),this._htmlElementObj=this._grayElementObj):null!==this._backupElement&&(this._htmlElementObj=this._backupElement))}}),cc.Texture2D._generateGrayTexture=function(t,e,i){if(null===t)return null;i=i||cc.newElement("canvas"),e=e||cc.rect(0,0,t.width,t.height),i.width=e.width,i.height=e.height;var n=i.getContext("2d");n.drawImage(t,e.x,e.y,e.width,e.height,0,0,e.width,e.height),t=n.getImageData(0,0,e.width,e.height),e=t.data;for(var r=0,o=e.length;o>r;r+=4)e[r]=e[r+1]=e[r+2]=.34*e[r]+.5*e[r+1]+.16*e[r+2];return n.putImageData(t,0,0),i}):(cc.assert(cc.isFunction(cc._tmp.WebGLTexture2D),cc._LogInfos.MissingFile,"TexturesWebGL.js"),cc._tmp.WebGLTexture2D(),delete cc._tmp.WebGLTexture2D),cc.EventHelper.prototype.apply(cc.Texture2D.prototype),cc.assert(cc.isFunction(cc._tmp.PrototypeTexture2D),cc._LogInfos.MissingFile,"TexturesPropertyDefine.js"),cc._tmp.PrototypeTexture2D(),delete cc._tmp.PrototypeTexture2D,cc.textureCache={_textures:{},_textureColorsCache:{},_textureKeySeq:0|1e3*Math.random(),_loadedTexturesBefore:{},_initializingRenderer:function(){var t,e=this._loadedTexturesBefore,i=this._textures;for(t in e){var n=e[t];n.handleLoadedTexture(),i[t]=n}this._loadedTexturesBefore={}},addPVRTCImage:function(){cc.log(cc._LogInfos.textureCache_addPVRTCImage)},addETCImage:function(){cc.log(cc._LogInfos.textureCache_addETCImage)},description:function(){return"<TextureCache | Number of textures = "+this._textures.length+">"},textureForKey:function(t){return cc.log(cc._LogInfos.textureCache_textureForKey),this.getTextureForKey(t)},getTextureForKey:function(t){return this._textures[t]||this._textures[cc.loader._aliases[t]]},getKeyByTexture:function(t){for(var e in this._textures)if(this._textures[e]===t)return e;return null},_generalTextureKey:function(){return this._textureKeySeq++,"_textureKey_"+this._textureKeySeq},getTextureColors:function(t){var e=this.getKeyByTexture(t);return e||(e=t instanceof HTMLImageElement?t.src:this._generalTextureKey()),this._textureColorsCache[e]||(this._textureColorsCache[e]=cc.Sprite.CanvasRenderCmd._generateTextureCacheForColor(t)),this._textureColorsCache[e]},addPVRImage:function(){cc.log(cc._LogInfos.textureCache_addPVRImage)},removeAllTextures:function(){var t,e=this._textures;for(t in e)e[t]&&e[t].releaseTexture();this._textures={}},removeTexture:function(t){if(t){var e,i=this._textures;for(e in i)i[e]===t&&(i[e].releaseTexture(),delete i[e])}},removeTextureForKey:function(t){null!=t&&this._textures[t]&&delete this._textures[t]},cacheImage:function(t,e){if(e instanceof cc.Texture2D)this._textures[t]=e;else{var i=new cc.Texture2D;i.initWithElement(e),i.handleLoadedTexture(),this._textures[t]=i}},addUIImage:function(t,e){if(cc.assert(t,cc._LogInfos.textureCache_addUIImage_2),e&&this._textures[e])return this._textures[e];var i=new cc.Texture2D;return i.initWithImage(t),null!=e?this._textures[e]=i:cc.log(cc._LogInfos.textureCache_addUIImage),i},dumpCachedTextureInfo:function(){var t,e=0,i=0,n=this._textures;for(t in n){var r=n[t];e++,r.getHtmlElementObj()instanceof HTMLImageElement?cc.log(cc._LogInfos.textureCache_dumpCachedTextureInfo,t,r.getHtmlElementObj().src,r.pixelsWidth,r.pixelsHeight):cc.log(cc._LogInfos.textureCache_dumpCachedTextureInfo_2,t,r.pixelsWidth,r.pixelsHeight),i+=r.pixelsWidth*r.pixelsHeight*4}n=this._textureColorsCache;for(t in n){var o,r=n[t];for(o in r){var s=r[o];e++,cc.log(cc._LogInfos.textureCache_dumpCachedTextureInfo_2,t,s.width,s.height),i+=s.width*s.height*4}}cc.log(cc._LogInfos.textureCache_dumpCachedTextureInfo_3,e,i/1024,(i/1048576).toFixed(2))},_clear:function(){this._textures={},this._textureColorsCache={},this._textureKeySeq=0|1e3*Math.random(),this._loadedTexturesBefore={}}},cc._renderType===cc._RENDER_TYPE_CANVAS?(_p=cc.textureCache,_p.handleLoadedTexture=function(t){var e=this._textures,i=e[t];i||(i=e[t]=new cc.Texture2D,i.url=t),i.handleLoadedTexture()},_p.addImage=function(t,e,i){cc.assert(t,cc._LogInfos.Texture2D_addImage);var n=this._textures,r=n[t]||n[cc.loader._aliases[t]];return r?(r.isLoaded()?e&&e.call(i,r):r.addEventListener("load",function(){e&&e.call(i,r)},i),r):(r=n[t]=new cc.Texture2D,r.url=t,(cc.loader._checkIsImageURL(t)?cc.loader.load:cc.loader.loadImg).call(cc.loader,t,function(r){if(r)return e&&e.call(i,r);cc.textureCache.handleLoadedTexture(t);var o=n[t];e&&e.call(i,o)}),r)},_p.addImageAsync=_p.addImage,_p=null):(cc.assert(cc.isFunction(cc._tmp.WebGLTextureCache),cc._LogInfos.MissingFile,"TexturesWebGL.js"),cc._tmp.WebGLTextureCache(),delete cc._tmp.WebGLTextureCache),cc.TextureAtlas=cc.Class.extend({dirty:!1,texture:null,_indices:null,_buffersVBO:null,_capacity:0,_quads:null,_quadsArrayBuffer:null,_quadsWebBuffer:null,_quadsReader:null,ctor:function(t,e){this._buffersVBO=[],cc.isString(t)?this.initWithFile(t,e):t instanceof cc.Texture2D&&this.initWithTexture(t,e)},getTotalQuads:function(){return this._totalQuads},getCapacity:function(){return this._capacity},getTexture:function(){return this.texture},setTexture:function(t){this.texture=t},setDirty:function(t){this.dirty=t},isDirty:function(){return this.dirty},getQuads:function(){return this._quads},setQuads:function(t){this._quads=t},_copyQuadsToTextureAtlas:function(t,e){if(t)for(var i=0;i<t.length;i++)this._setQuadToArray(t[i],e+i)},_setQuadToArray:function(t,e){var i=this._quads;i[e]?(i[e].bl=t.bl,i[e].br=t.br,i[e].tl=t.tl,i[e].tr=t.tr):i[e]=new cc.V3F_C4B_T2F_Quad(t.tl,t.bl,t.tr,t.br,this._quadsArrayBuffer,e*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT)},description:function(){return"<cc.TextureAtlas | totalQuads ="+this._totalQuads+">"},_setupIndices:function(){if(0!==this._capacity)for(var t=this._indices,e=this._capacity,i=0;e>i;i++)cc.TEXTURE_ATLAS_USE_TRIANGLE_STRIP?(t[6*i+0]=4*i+0,t[6*i+1]=4*i+0,t[6*i+2]=4*i+2,t[6*i+3]=4*i+1,t[6*i+4]=4*i+3,t[6*i+5]=4*i+3):(t[6*i+0]=4*i+0,t[6*i+1]=4*i+1,t[6*i+2]=4*i+2,t[6*i+3]=4*i+3,t[6*i+4]=4*i+2,t[6*i+5]=4*i+1)},_setupVBO:function(){var t=cc._renderContext;this._buffersVBO[0]=t.createBuffer(),this._buffersVBO[1]=t.createBuffer(),this._quadsWebBuffer=t.createBuffer(),this._mapBuffers()},_mapBuffers:function(){var t=cc._renderContext;t.bindBuffer(t.ARRAY_BUFFER,this._quadsWebBuffer),t.bufferData(t.ARRAY_BUFFER,this._quadsArrayBuffer,t.DYNAMIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._buffersVBO[1]),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this._indices,t.STATIC_DRAW)},initWithFile:function(t,e){var i=cc.textureCache.addImage(t);return i?this.initWithTexture(i,e):(cc.log(cc._LogInfos.TextureAtlas_initWithFile,t),!1)},initWithTexture:function(t,e){cc.assert(t,cc._LogInfos.TextureAtlas_initWithTexture),this._capacity=e|=0,this._totalQuads=0,this.texture=t,this._quads=[],this._indices=new Uint16Array(6*e);var i=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;if(this._quadsArrayBuffer=new ArrayBuffer(i*e),this._quadsReader=new Uint8Array(this._quadsArrayBuffer),(!this._quads||!this._indices)&&e>0)return!1;for(var n=this._quads,r=0;e>r;r++)n[r]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,r*i);return this._setupIndices(),this._setupVBO(),this.dirty=!0},updateQuad:function(t,e){cc.assert(t,cc._LogInfos.TextureAtlas_updateQuad),cc.assert(e>=0&&e<this._capacity,cc._LogInfos.TextureAtlas_updateQuad_2),this._totalQuads=Math.max(e+1,this._totalQuads),this._setQuadToArray(t,e),this.dirty=!0},insertQuad:function(t,e){if(cc.assert(e<this._capacity,cc._LogInfos.TextureAtlas_insertQuad_2),this._totalQuads++,this._totalQuads>this._capacity)cc.log(cc._LogInfos.TextureAtlas_insertQuad);else{var i=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,n=e*i,r=(this._totalQuads-1-e)*i;this._quads[this._totalQuads-1]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,(this._totalQuads-1)*i),this._quadsReader.set(this._quadsReader.subarray(n,n+r),n+i),this._setQuadToArray(t,e),this.dirty=!0}},insertQuads:function(t,e,i){i=i||t.length,cc.assert(e+i<=this._capacity,cc._LogInfos.TextureAtlas_insertQuads);var n=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;if(this._totalQuads+=i,this._totalQuads>this._capacity)cc.log(cc._LogInfos.TextureAtlas_insertQuad);else{var r,o=e*n,s=(this._totalQuads-1-e-i)*n,c=this._totalQuads-1-i;for(r=0;i>r;r++)this._quads[c+r]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,(this._totalQuads-1)*n);for(this._quadsReader.set(this._quadsReader.subarray(o,o+s),o+n*i),r=0;i>r;r++)this._setQuadToArray(t[r],e+r);this.dirty=!0}},insertQuadFromIndex:function(t,e){if(t!==e){cc.assert(e>=0||e<this._totalQuads,cc._LogInfos.TextureAtlas_insertQuadFromIndex),cc.assert(t>=0||t<this._totalQuads,cc._LogInfos.TextureAtlas_insertQuadFromIndex_2);var i,n=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,r=this._quadsReader,o=r.subarray(t*n,n);t>e?(i=e*n,r.set(r.subarray(i,i+(t-e)*n),i+n),r.set(o,i)):(i=(t+1)*n,r.set(r.subarray(i,i+(e-t)*n),i-n),r.set(o,e*n)),this.dirty=!0}},removeQuadAtIndex:function(t){cc.assert(t<this._totalQuads,cc._LogInfos.TextureAtlas_removeQuadAtIndex);var e=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;if(this._totalQuads--,this._quads.length=this._totalQuads,t!==this._totalQuads){var i=(t+1)*e;this._quadsReader.set(this._quadsReader.subarray(i,i+(this._totalQuads-t)*e),i-e)}this.dirty=!0},removeQuadsAtIndex:function(t,e){if(cc.assert(t+e<=this._totalQuads,cc._LogInfos.TextureAtlas_removeQuadsAtIndex),this._totalQuads-=e,t!==this._totalQuads){var i=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,n=(t+e)*i,r=t*i;this._quadsReader.set(this._quadsReader.subarray(n,n+(this._totalQuads-t)*i),r)}this.dirty=!0},removeAllQuads:function(){this._totalQuads=this._quads.length=0},_setDirty:function(t){this.dirty=t},resizeCapacity:function(t){if(t===this._capacity)return!0;var e=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,i=this._capacity;this._totalQuads=Math.min(this._totalQuads,t);var n=this._capacity=0|t,r=this._totalQuads;if(null===this._quads)for(this._quads=[],this._quadsArrayBuffer=new ArrayBuffer(e*n),this._quadsReader=new Uint8Array(this._quadsArrayBuffer),t=0;n>t;t++)this._quads=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,t*e);else{var o,s,c=this._quads;if(n>i){for(o=[],s=new ArrayBuffer(e*n),t=0;r>t;t++)o[t]=new cc.V3F_C4B_T2F_Quad(c[t].tl,c[t].bl,c[t].tr,c[t].br,s,t*e);for(;n>t;t++)o[t]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,s,t*e)
}else for(r=Math.max(r,n),o=[],s=new ArrayBuffer(e*n),t=0;r>t;t++)o[t]=new cc.V3F_C4B_T2F_Quad(c[t].tl,c[t].bl,c[t].tr,c[t].br,s,t*e);this._quadsReader=new Uint8Array(s),this._quads=o,this._quadsArrayBuffer=s}return null===this._indices?this._indices=new Uint16Array(6*n):n>i?(e=new Uint16Array(6*n),e.set(this._indices,0),this._indices=e):this._indices=this._indices.subarray(0,6*n),this._setupIndices(),this._mapBuffers(),this.dirty=!0},increaseTotalQuadsWith:function(t){this._totalQuads+=t},moveQuadsFromIndex:function(t,e,i){if(void 0===i){if(i=e,e=this._totalQuads-t,cc.assert(i+(this._totalQuads-t)<=this._capacity,cc._LogInfos.TextureAtlas_moveQuadsFromIndex),0===e)return}else if(cc.assert(i+e<=this._totalQuads,cc._LogInfos.TextureAtlas_moveQuadsFromIndex_2),cc.assert(t<this._totalQuads,cc._LogInfos.TextureAtlas_moveQuadsFromIndex_3),t===i)return;var n=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,r=t*n,o=e*n,s=this._quadsReader,c=s.subarray(r,r+o),a=i*n;t>i?(e=i*n,s.set(s.subarray(e,e+(t-i)*n),e+o)):(e=(t+e)*n,s.set(s.subarray(e,e+(i-t)*n),r)),s.set(c,a),this.dirty=!0},fillWithEmptyQuadsFromIndex:function(t,e){for(var i=e*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,n=new Uint8Array(this._quadsArrayBuffer,t*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,i),r=0;i>r;r++)n[r]=0},drawQuads:function(){this.drawNumberOfQuads(this._totalQuads,0)},_releaseBuffer:function(){var t=cc._renderContext;this._buffersVBO&&(this._buffersVBO[0]&&t.deleteBuffer(this._buffersVBO[0]),this._buffersVBO[1]&&t.deleteBuffer(this._buffersVBO[1])),this._quadsWebBuffer&&t.deleteBuffer(this._quadsWebBuffer)}}),_p=cc.TextureAtlas.prototype,cc.defineGetterSetter(_p,"totalQuads",_p.getTotalQuads),cc.defineGetterSetter(_p,"capacity",_p.getCapacity),cc.defineGetterSetter(_p,"quads",_p.getQuads,_p.setQuads),cc.TextureAtlas.create=function(t,e){return new cc.TextureAtlas(t,e)},cc.TextureAtlas.createWithTexture=cc.TextureAtlas.create,cc._renderType===cc._RENDER_TYPE_WEBGL&&(cc.assert(cc.isFunction(cc._tmp.WebGLTextureAtlas),cc._LogInfos.MissingFile,"TexturesWebGL.js"),cc._tmp.WebGLTextureAtlas(),delete cc._tmp.WebGLTextureAtlas),cc.assert(cc.isFunction(cc._tmp.PrototypeTextureAtlas),cc._LogInfos.MissingFile,"TexturesPropertyDefine.js"),cc._tmp.PrototypeTextureAtlas(),delete cc._tmp.PrototypeTextureAtlas,cc.Scene=cc.Node.extend({_className:"Scene",ctor:function(){cc.Node.prototype.ctor.call(this),this._ignoreAnchorPointForPosition=!0,this.setAnchorPoint(.5,.5),this.setContentSize(cc.director.getWinSize())}}),cc.Scene.create=function(){return new cc.Scene},cc.LoaderScene=cc.Scene.extend({_interval:null,_label:null,_className:"LoaderScene",cb:null,target:null,init:function(){var t=this,e=200,i=t._bgLayer=new cc.LayerColor(cc.color(32,32,32,255));t.addChild(i,0);var n=24,r=-e/2+100;return cc._loaderImage&&(cc.loader.loadImg(cc._loaderImage,{isCrossOrigin:!1},function(i,n){e=n.height,t._initStage(n,cc.visibleRect.center)}),n=14,r=-e/2-10),n=t._label=new cc.LabelTTF("Loading... 0%","Arial",n),n.setPosition(cc.pAdd(cc.visibleRect.center,cc.p(0,r))),n.setColor(cc.color(180,180,180)),i.addChild(this._label,10),!0},_initStage:function(t,e){var i=this._texture2d=new cc.Texture2D;i.initWithElement(t),i.handleLoadedTexture(),i=this._logo=new cc.Sprite(i),i.setScale(cc.contentScaleFactor()),i.x=e.x,i.y=e.y,this._bgLayer.addChild(i,10)},onEnter:function(){cc.Node.prototype.onEnter.call(this),this.schedule(this._startLoading,.3)},onExit:function(){cc.Node.prototype.onExit.call(this),this._label.setString("Loading... 0%")},initWithResources:function(t,e,i){cc.isString(t)&&(t=[t]),this.resources=t||[],this.cb=e,this.target=i},_startLoading:function(){var t=this;t.unschedule(t._startLoading),cc.loader.load(t.resources,function(e,i,n){e=Math.min(n/i*100|0,100),t._label.setString("Loading... "+e+"%")},function(){t.cb&&t.cb.call(t.target)})}}),cc.LoaderScene.preload=function(t,e,i){var n=cc;return n.loaderScene||(n.loaderScene=new cc.LoaderScene,n.loaderScene.init()),n.loaderScene.initWithResources(t,e,i),cc.director.runScene(n.loaderScene),n.loaderScene},cc.Layer=cc.Node.extend({_className:"Layer",ctor:function(){var t=cc.Node.prototype;t.ctor.call(this),this._ignoreAnchorPointForPosition=!0,t.setAnchorPoint.call(this,.5,.5),t.setContentSize.call(this,cc.winSize)},init:function(){return this._ignoreAnchorPointForPosition=!0,this.setAnchorPoint(.5,.5),this.setContentSize(cc.winSize),this._cascadeOpacityEnabled=this._cascadeColorEnabled=!1,!0},bake:function(){this._renderCmd.bake()},unbake:function(){this._renderCmd.unbake()},isBaked:function(){return this._renderCmd._isBaked},addChild:function(t,e,i){cc.Node.prototype.addChild.call(this,t,e,i),this._renderCmd._bakeForAddChild(t)},_createRenderCmd:function(){return cc._renderType===cc._RENDER_TYPE_CANVAS?new cc.Layer.CanvasRenderCmd(this):new cc.Layer.WebGLRenderCmd(this)}}),cc.Layer.create=function(){return new cc.Layer},cc.LayerColor=cc.Layer.extend({_blendFunc:null,_className:"LayerColor",getBlendFunc:function(){return this._blendFunc},changeWidthAndHeight:function(t,e){this.width=t,this.height=e},changeWidth:function(t){this.width=t},changeHeight:function(t){this.height=t},setOpacityModifyRGB:function(){},isOpacityModifyRGB:function(){return!1},ctor:function(t,e,i){cc.Layer.prototype.ctor.call(this),this._blendFunc=new cc.BlendFunc(cc.SRC_ALPHA,cc.ONE_MINUS_SRC_ALPHA),cc.LayerColor.prototype.init.call(this,t,e,i)},init:function(t,e,i){cc._renderType!==cc._RENDER_TYPE_CANVAS&&(this.shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_COLOR));var n=cc.director.getWinSize();return t=t||cc.color(0,0,0,255),e=void 0===e?n.width:e,i=void 0===i?n.height:i,n=this._realColor,n.r=t.r,n.g=t.g,n.b=t.b,this._realOpacity=t.a,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty|cc.Node._dirtyFlags.opacityDirty),cc.LayerColor.prototype.setContentSize.call(this,e,i),!0},setBlendFunc:function(t,e){var i=this._blendFunc;void 0===e?(i.src=t.src,i.dst=t.dst):(i.src=t,i.dst=e),this._renderCmd.updateBlendFunc(i)},_setWidth:function(t){cc.Node.prototype._setWidth.call(this,t),this._renderCmd._updateSquareVerticesWidth(t)},_setHeight:function(t){cc.Node.prototype._setHeight.call(this,t),this._renderCmd._updateSquareVerticesHeight(t)},setContentSize:function(t,e){cc.Layer.prototype.setContentSize.call(this,t,e),this._renderCmd._updateSquareVertices(t,e)},_createRenderCmd:function(){return cc._renderType===cc._RENDER_TYPE_CANVAS?new cc.LayerColor.CanvasRenderCmd(this):new cc.LayerColor.WebGLRenderCmd(this)}}),cc.LayerColor.create=function(t,e,i){return new cc.LayerColor(t,e,i)},function(){var t=cc.LayerColor.prototype;cc.defineGetterSetter(t,"width",t._getWidth,t._setWidth),cc.defineGetterSetter(t,"height",t._getHeight,t._setHeight)}(),cc.LayerGradient=cc.LayerColor.extend({_endColor:null,_startOpacity:255,_endOpacity:255,_alongVector:null,_compressedInterpolation:!1,_className:"LayerGradient",_colorStops:[],ctor:function(t,e,i,n){cc.LayerColor.prototype.ctor.call(this),this._endColor=cc.color(0,0,0,255),this._alongVector=cc.p(0,-1),this._endOpacity=this._startOpacity=255,n&&n instanceof Array?(this._colorStops=n,n.splice(0,0,{p:0,color:t||cc.color.BLACK}),n.push({p:1,color:e||cc.color.BLACK})):this._colorStops=[{p:0,color:t||cc.color.BLACK},{p:1,color:e||cc.color.BLACK}],cc.LayerGradient.prototype.init.call(this,t,e,i,n)},init:function(t,e,i,n){return t=t||cc.color(0,0,0,255),e=e||cc.color(0,0,0,255),i=i||cc.p(0,-1),n=this._endColor,this._startOpacity=t.a,n.r=e.r,n.g=e.g,n.b=e.b,this._endOpacity=e.a,this._alongVector=i,this._compressedInterpolation=!0,cc.LayerColor.prototype.init.call(this,cc.color(t.r,t.g,t.b,255)),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty|cc.Node._dirtyFlags.opacityDirty|cc.Node._dirtyFlags.gradientDirty),!0},setContentSize:function(t,e){cc.LayerColor.prototype.setContentSize.call(this,t,e),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.gradientDirty)},_setWidth:function(t){cc.LayerColor.prototype._setWidth.call(this,t),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.gradientDirty)},_setHeight:function(t){cc.LayerColor.prototype._setHeight.call(this,t),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.gradientDirty)},getStartColor:function(){return cc.color(this._realColor)},setStartColor:function(t){this.color=t;var e=this._colorStops;e&&0<e.length&&(e=e[0].color,e.r=t.r,e.g=t.g,e.b=t.b)},setEndColor:function(t){var e=this._endColor;e.r=t.r,e.g=t.g,e.b=t.b,(e=this._colorStops)&&0<e.length&&(e=e[e.length-1].color,e.r=t.r,e.g=t.g,e.b=t.b),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty)},getEndColor:function(){return cc.color(this._endColor)},setStartOpacity:function(t){this._startOpacity=t;var e=this._colorStops;e&&0<e.length&&(e[0].color.a=t),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty)},getStartOpacity:function(){return this._startOpacity},setEndOpacity:function(t){this._endOpacity=t;var e=this._colorStops;e&&0<e.length&&(e[e.length-1].color.a=t),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty)},getEndOpacity:function(){return this._endOpacity},setVector:function(t){this._alongVector.x=t.x,this._alongVector.y=t.y,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.gradientDirty)},getVector:function(){return cc.p(this._alongVector.x,this._alongVector.y)},isCompressedInterpolation:function(){return this._compressedInterpolation},setCompressedInterpolation:function(t){this._compressedInterpolation=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.gradientDirty)},getColorStops:function(){return this._colorStops},setColorStops:function(t){this._colorStops=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty|cc.Node._dirtyFlags.opacityDirty|cc.Node._dirtyFlags.gradientDirty)},_createRenderCmd:function(){return cc._renderType===cc._RENDER_TYPE_CANVAS?new cc.LayerGradient.CanvasRenderCmd(this):new cc.LayerGradient.WebGLRenderCmd(this)}}),cc.LayerGradient.create=function(t,e,i,n){return new cc.LayerGradient(t,e,i,n)},function(){var t=cc.LayerGradient.prototype;cc.defineGetterSetter(t,"startColor",t.getStartColor,t.setStartColor),cc.defineGetterSetter(t,"endColor",t.getEndColor,t.setEndColor),cc.defineGetterSetter(t,"startOpacity",t.getStartOpacity,t.setStartOpacity),cc.defineGetterSetter(t,"endOpacity",t.getEndOpacity,t.setEndOpacity),cc.defineGetterSetter(t,"vector",t.getVector,t.setVector),cc.defineGetterSetter(t,"colorStops",t.getColorStops,t.setColorStops)}(),cc.LayerMultiplex=cc.Layer.extend({_enabledLayer:0,_layers:null,_className:"LayerMultiplex",ctor:function(t){cc.Layer.prototype.ctor.call(this),t instanceof Array?cc.LayerMultiplex.prototype.initWithLayers.call(this,t):cc.LayerMultiplex.prototype.initWithLayers.call(this,Array.prototype.slice.call(arguments))},initWithLayers:function(t){return 0<t.length&&null==t[t.length-1]&&cc.log(cc._LogInfos.LayerMultiplex_initWithLayers),this._layers=t,this._enabledLayer=0,this.addChild(this._layers[this._enabledLayer]),!0},switchTo:function(t){t>=this._layers.length?cc.log(cc._LogInfos.LayerMultiplex_switchTo):(this.removeChild(this._layers[this._enabledLayer],!0),this._enabledLayer=t,this.addChild(this._layers[t]))},switchToAndReleaseMe:function(t){t>=this._layers.length?cc.log(cc._LogInfos.LayerMultiplex_switchToAndReleaseMe):(this.removeChild(this._layers[this._enabledLayer],!0),this._layers[this._enabledLayer]=null,this._enabledLayer=t,this.addChild(this._layers[t]))},addLayer:function(t){t?this._layers.push(t):cc.log(cc._LogInfos.LayerMultiplex_addLayer)}}),cc.LayerMultiplex.create=function(){return new cc.LayerMultiplex(Array.prototype.slice.call(arguments))},function(){cc.Layer.CanvasRenderCmd=function(t){cc.Node.CanvasRenderCmd.call(this,t),this._isBaked=!1,this._bakeSprite=null};var t=cc.Layer.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);t.constructor=cc.Layer.CanvasRenderCmd,t.bake=function(){if(!this._isBaked){this._needDraw=!0,this._isBaked=this._cacheDirty=cc.renderer.childrenOrderDirty=!0;for(var t=this._node._children,e=0,i=t.length;i>e;e++)t[e]._renderCmd._setCachedParent(this);this._bakeSprite||(this._bakeSprite=new cc.BakeSprite,this._bakeSprite.setAnchorPoint(0,0))}},t.unbake=function(){if(this._isBaked){cc.renderer.childrenOrderDirty=!0,this._isBaked=this._needDraw=!1,this._cacheDirty=!0;for(var t=this._node._children,e=0,i=t.length;i>e;e++)t[e]._renderCmd._setCachedParent(null)}},t.isBaked=function(){return this._isBaked},t.rendering=function(){if(this._cacheDirty){var t=this._node,e=t._children,i=this._bakeSprite;this.transform(this.getParentRenderCmd(),!0);var n=this._getBoundingBoxForBake();n.width=0|n.width+.5,n.height=0|n.height+.5;var r=i.getCacheContext(),o=r.getContext();for(i.resetCanvasSize(n.width,n.height),r.setOffset(0-n.x,o.canvas.height-n.height+n.y),i.setPosition(n.x,n.y),t.sortAllChildren(),cc.renderer._turnToCacheMode(this.__instanceId),t=0,n=e.length;n>t;t++)e[t].visit(this);cc.renderer._renderingToCacheCanvas(r,this.__instanceId),i.transform(),this._cacheDirty=!1}},t.visit=function(t){if(this._isBaked){var e=this._node,i=e._children.length;e._visible&&0!==i&&(this._syncStatus(t),cc.renderer.pushRenderCommand(this),this._cacheDirty=!0,this._bakeSprite.visit(this),this._dirtyFlag=0)}else cc.Node.CanvasRenderCmd.prototype.visit.call(this,t)},t._bakeForAddChild=function(t){t._parent===this._node&&this._isBaked&&t._renderCmd._setCachedParent(this)},t._getBoundingBoxForBake=function(){var t=null,e=this._node;if(!e._children||0===e._children.length)return cc.rect(0,0,10,10);for(var i=e.getNodeToWorldTransform(),e=e._children,n=0,r=e.length;r>n;n++){var o=e[n];o&&o._visible&&(t?(o=o._getBoundingBoxToCurrentNode(i))&&(t=cc.rectUnion(t,o)):t=o._getBoundingBoxToCurrentNode(i))}return t}}(),function(){cc.LayerColor.CanvasRenderCmd=function(t){cc.Layer.CanvasRenderCmd.call(this,t),this._needDraw=!0,this._blendFuncStr="source-over",this._bakeRenderCmd=new cc.CustomRenderCmd(this,this._bakeRendering)};var t=cc.LayerColor.CanvasRenderCmd.prototype=Object.create(cc.Layer.CanvasRenderCmd.prototype);t.constructor=cc.LayerColor.CanvasRenderCmd,t.unbake=function(){cc.Layer.CanvasRenderCmd.prototype.unbake.call(this),this._needDraw=!0},t.rendering=function(t,e,i){t=t||cc._renderContext;var n=t.getContext(),r=this._node,o=this._displayedColor,s=this._displayedOpacity/255,c=r._contentSize.width,r=r._contentSize.height;0!==s&&(t.setCompositeOperation(this._blendFuncStr),t.setGlobalAlpha(s),t.setFillStyle("rgba("+(0|o.r)+","+(0|o.g)+","+(0|o.b)+", 1)"),t.setTransform(this._worldTransform,e,i),n.fillRect(0,0,c*e,-r*i),cc.g_NumberOfDraws++)},t.updateBlendFunc=function(t){this._blendFuncStr=cc.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc(t)},t._updateSquareVertices=t._updateSquareVerticesWidth=t._updateSquareVerticesHeight=function(){},t._bakeRendering=function(){if(this._cacheDirty){var t=this._node,e=this._bakeSprite,i=t._children,n=i.length;this.transform(this.getParentRenderCmd(),!0);var r=this._getBoundingBoxForBake();r.width=0|r.width+.5,r.height=0|r.height+.5;var o=e.getCacheContext(),s=o.getContext();if(e.resetCanvasSize(r.width,r.height),s.fillStyle=o._currentFillStyle,o.setOffset(0-r.x,s.canvas.height-r.height+r.y),e.setPosition(r.x,r.y),cc.renderer._turnToCacheMode(this.__instanceId),n>0){for(t.sortAllChildren(),t=0;n>t&&(r=i[t],0>r._localZOrder);t++)r._renderCmd.visit(this);for(cc.renderer.pushRenderCommand(this);n>t;t++)i[t]._renderCmd.visit(this)}else cc.renderer.pushRenderCommand(this);cc.renderer._renderingToCacheCanvas(o,this.__instanceId),e.transform(),this._cacheDirty=!1}},t.visit=function(t){this._isBaked?this._node._visible&&(this._syncStatus(t),cc.renderer.pushRenderCommand(this._bakeRenderCmd),this._bakeSprite._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty),this._bakeSprite.visit(this),this._dirtyFlag=0):cc.Node.CanvasRenderCmd.prototype.visit.call(this)},t._getBoundingBoxForBake=function(){var t=this._node,e=cc.rect(0,0,t._contentSize.width,t._contentSize.height),i=t.getNodeToWorldTransform(),e=cc.rectApplyAffineTransform(e,t.getNodeToWorldTransform());if(!t._children||0===t._children.length)return e;for(var t=t._children,n=0;n<t.length;n++){var r=t[n];r&&r._visible&&(r=r._getBoundingBoxToCurrentNode(i),e=cc.rectUnion(e,r))}return e}}(),function(){cc.LayerGradient.RenderCmd={updateStatus:function(){var t=cc.Node._dirtyFlags,e=this._dirtyFlag,i=e&t.colorDirty,n=e&t.opacityDirty;i&&this._updateDisplayColor(),n&&this._updateDisplayOpacity(),e&t.transformDirty&&this.transform(null,!0),(i||n||e&t.gradientDirty)&&this._updateColor(),this._dirtyFlag=0}}}(),function(){cc.LayerGradient.CanvasRenderCmd=function(t){cc.LayerColor.CanvasRenderCmd.call(this,t),this._needDraw=!0,this._startPoint=cc.p(0,0),this._endPoint=cc.p(0,0),this._endStopStr=this._startStopStr=null};var t=cc.LayerGradient.CanvasRenderCmd.prototype=Object.create(cc.LayerColor.CanvasRenderCmd.prototype);cc.inject(cc.LayerGradient.RenderCmd,t),t.constructor=cc.LayerGradient.CanvasRenderCmd,t.rendering=function(t,e,i){t=t||cc._renderContext;var n=t.getContext(),r=this._node,o=this._displayedOpacity/255;if(0!==o){var s=r._contentSize.width,c=r._contentSize.height;if(t.setCompositeOperation(this._blendFuncStr),t.setGlobalAlpha(o),o=n.createLinearGradient(this._startPoint.x*e,this._startPoint.y*i,this._endPoint.x*e,this._endPoint.y*i),r._colorStops)for(var a=0;a<r._colorStops.length;a++)o.addColorStop(r._colorStops[a].p,this._colorStopsStr[a]);else o.addColorStop(0,this._startStopStr),o.addColorStop(1,this._endStopStr);t.setFillStyle(o),t.setTransform(this._worldTransform,e,i),n.fillRect(0,0,s*e,-c*i),cc.g_NumberOfDraws++}},t._syncStatus=function(t){var e=cc.Node._dirtyFlags,i=this._dirtyFlag,n=t?t._node:null;n&&n._cascadeColorEnabled&&t._dirtyFlag&e.colorDirty&&(i|=e.colorDirty),n&&n._cascadeOpacityEnabled&&t._dirtyFlag&e.opacityDirty&&(i|=e.opacityDirty),t&&t._dirtyFlag&e.transformDirty&&(i|=e.transformDirty);var n=i&e.colorDirty,r=i&e.opacityDirty;this._dirtyFlag=i,n&&this._syncDisplayColor(),r&&this._syncDisplayOpacity(),i&e.transformDirty&&this.transform(t),(n||r||i&e.gradientDirty)&&this._updateColor()},t._updateColor=function(){var t=this._node,e=t._contentSize,i=.5*e.width,e=.5*e.height;this._dirtyFlag^=this._dirtyFlag&cc.Node._dirtyFlags.gradientDirty;var n=cc.pAngleSigned(cc.p(0,-1),t._alongVector),n=cc.pRotateByAngle(cc.p(0,-1),cc.p(0,0),n),r=Math.min(Math.abs(1/n.x),Math.abs(1/n.y));if(this._startPoint.x=i*-n.x*r+i,this._startPoint.y=e*n.y*r-e,this._endPoint.x=i*n.x*r+i,this._endPoint.y=e*-n.y*r-e,i=this._displayedColor,e=t._endColor,n=t._startOpacity/255,r=t._endOpacity/255,this._startStopStr="rgba("+Math.round(i.r)+","+Math.round(i.g)+","+Math.round(i.b)+","+n.toFixed(4)+")",this._endStopStr="rgba("+Math.round(e.r)+","+Math.round(e.g)+","+Math.round(e.b)+","+r.toFixed(4)+")",t._colorStops)for(this._endOpacity=this._startOpacity=0,this._colorStopsStr=[],i=0;i<t._colorStops.length;i++)e=t._colorStops[i].color,n=null==e.a?1:e.a/255,this._colorStopsStr.push("rgba("+Math.round(e.r)+","+Math.round(e.g)+","+Math.round(e.b)+","+n.toFixed(4)+")")}}(),function(){cc.Layer.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t)};var t=cc.Layer.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);t.constructor=cc.Layer.WebGLRenderCmd,t.bake=function(){},t.unbake=function(){},t._bakeForAddChild=function(){}}(),function(){cc.LayerColor.WebGLRenderCmd=function(t){cc.Layer.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._squareVerticesAB=new ArrayBuffer(32),this._squareColorsAB=new ArrayBuffer(16),t=this._squareVerticesAB;var e=this._squareColorsAB,i=cc.Vertex2F.BYTES_PER_ELEMENT,n=cc.Color.BYTES_PER_ELEMENT;this._squareVertices=[new cc.Vertex2F(0,0,t,0),new cc.Vertex2F(0,0,t,i),new cc.Vertex2F(0,0,t,2*i),new cc.Vertex2F(0,0,t,3*i)],this._squareColors=[cc.color(0,0,0,255,e,0),cc.color(0,0,0,255,e,n),cc.color(0,0,0,255,e,2*n),cc.color(0,0,0,255,e,3*n)],this._verticesFloat32Buffer=cc._renderContext.createBuffer(),this._colorsUint8Buffer=cc._renderContext.createBuffer()};var t=cc.LayerColor.WebGLRenderCmd.prototype=Object.create(cc.Layer.WebGLRenderCmd.prototype);t.constructor=cc.LayerColor.WebGLRenderCmd,t.rendering=function(t){t=t||cc._renderContext;var e=this._node;this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION|cc.VERTEX_ATTRIB_FLAG_COLOR),cc.glBlendFunc(e._blendFunc.src,e._blendFunc.dst),t.bindBuffer(t.ARRAY_BUFFER,this._verticesFloat32Buffer),t.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,this._colorsUint8Buffer),t.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,t.UNSIGNED_BYTE,!0,0,0),t.drawArrays(t.TRIANGLE_STRIP,0,this._squareVertices.length)},t._updateSquareVertices=function(t,e){var i=this._squareVertices;void 0===e?(i[1].x=t.width,i[2].y=t.height,i[3].x=t.width,i[3].y=t.height):(i[1].x=t,i[2].y=e,i[3].x=t,i[3].y=e),this._bindLayerVerticesBufferData()},t._updateSquareVerticesWidth=function(t){var e=this._squareVertices;e[1].x=t,e[3].x=t,this._bindLayerVerticesBufferData()},t._updateSquareVerticesHeight=function(t){var e=this._squareVertices;e[2].y=t,e[3].y=t,this._bindLayerVerticesBufferData()},t._updateColor=function(){for(var t=this._displayedColor,e=this._displayedOpacity,i=this._squareColors,n=0;4>n;n++)i[n].r=t.r,i[n].g=t.g,i[n].b=t.b,i[n].a=e;this._bindLayerColorsBufferData()},t._bindLayerVerticesBufferData=function(){var t=cc._renderContext;t.bindBuffer(t.ARRAY_BUFFER,this._verticesFloat32Buffer),t.bufferData(t.ARRAY_BUFFER,this._squareVerticesAB,t.STATIC_DRAW)},t._bindLayerColorsBufferData=function(){var t=cc._renderContext;t.bindBuffer(t.ARRAY_BUFFER,this._colorsUint8Buffer),t.bufferData(t.ARRAY_BUFFER,this._squareColorsAB,t.STATIC_DRAW)},t.updateBlendFunc=function(){}}(),function(){cc.LayerGradient.WebGLRenderCmd=function(t){cc.LayerColor.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._clipRect=new cc.Rect,this._clippingRectDirty=!1};var t=cc.LayerGradient.WebGLRenderCmd.prototype=Object.create(cc.LayerColor.WebGLRenderCmd.prototype);cc.inject(cc.LayerGradient.RenderCmd,t),t.constructor=cc.LayerGradient.WebGLRenderCmd,t._syncStatus=function(t){var e=cc.Node._dirtyFlags,i=this._dirtyFlag,n=t?t._node:null;n&&n._cascadeColorEnabled&&t._dirtyFlag&e.colorDirty&&(i|=e.colorDirty),n&&n._cascadeOpacityEnabled&&t._dirtyFlag&e.opacityDirty&&(i|=e.opacityDirty),t&&t._dirtyFlag&e.transformDirty&&(i|=e.transformDirty);var n=i&e.colorDirty,r=i&e.opacityDirty;this._dirtyFlag=i,n&&this._syncDisplayColor(),r&&this._syncDisplayOpacity(),this.transform(t),(n||r||i&e.gradientDirty)&&this._updateColor()},t._updateColor=function(){this._dirtyFlag^=this._dirtyFlag&cc.Node._dirtyFlags.gradientDirty;var t=this._node,e=t._colorStops;if(e&&!(2>e.length)){this._clippingRectDirty=!0;var i,n=e.length,r=2*n,o=t._contentSize;this._squareVerticesAB=new ArrayBuffer(8*r),this._squareColorsAB=new ArrayBuffer(4*r);var s=this._squareVertices,c=this._squareColors;s.length=0,c.length=0;var a=this._squareVerticesAB,l=this._squareColorsAB,h=cc.Vertex2F.BYTES_PER_ELEMENT,u=cc.Color.BYTES_PER_ELEMENT;for(i=0;r>i;i++)s.push(new cc.Vertex2F(0,0,a,h*i)),c.push(cc.color(0,0,0,255,l,u*i));for(l=Math.PI+cc.pAngleSigned(cc.p(0,-1),t._alongVector),t=cc.p(o.width/2,o.height/2),i=Math.round(cc.radiansToDegrees(l)),r=cc.affineTransformMake(1,0,0,1,t.x,t.y),r=cc.affineTransformRotate(r,l),90>i?(h=cc.p(-t.x,t.y),i=cc.p(t.x,t.y)):180>i?(h=cc.p(t.x,t.y),i=cc.p(t.x,-t.y)):270>i?(h=cc.p(t.x,-t.y),i=cc.p(-t.x,-t.y)):(h=cc.p(-t.x,-t.y),i=cc.p(-t.x,t.y)),a=Math.sin(l),l=Math.cos(l),h=Math.abs((h.x*l-h.y*a)/t.x),i=Math.abs((i.x*a+i.y*l)/t.y),r=cc.affineTransformScale(r,h,i),i=0;n>i;i++)a=e[i].p*o.height,l=cc.pointApplyAffineTransform(-t.x,a-t.y,r),s[2*i].x=l.x,s[2*i].y=l.y,a=cc.pointApplyAffineTransform(o.width-t.x,a-t.y,r),s[2*i+1].x=a.x,s[2*i+1].y=a.y;for(o=this._displayedOpacity/255,i=0;n>i;i++)s=e[i].color,t=c[2*i],r=c[2*i+1],t.r=s.r,t.g=s.g,t.b=s.b,t.a=s.a*o,r.r=s.r,r.g=s.g,r.b=s.b,r.a=s.a*o;this._bindLayerVerticesBufferData(),this._bindLayerColorsBufferData()}},t.rendering=function(t){t=t||cc._renderContext;var e=this._node,i=this._getClippingRect();t.enable(t.SCISSOR_TEST),cc.view.setScissorInPoints(i.x,i.y,i.width,i.height),this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION|cc.VERTEX_ATTRIB_FLAG_COLOR),cc.glBlendFunc(e._blendFunc.src,e._blendFunc.dst),t.bindBuffer(t.ARRAY_BUFFER,this._verticesFloat32Buffer),t.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,this._colorsUint8Buffer),t.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,t.UNSIGNED_BYTE,!0,0,0),t.drawArrays(t.TRIANGLE_STRIP,0,this._squareVertices.length),t.disable(t.SCISSOR_TEST)},t._getClippingRect=function(){if(this._clippingRectDirty){var t=this._node,e=cc.rect(0,0,t._contentSize.width,t._contentSize.height),t=t.getNodeToWorldTransform();this._clipRect=cc._rectApplyAffineTransformIn(e,t)}return this._clipRect}}(),cc._tmp.PrototypeSprite=function(){var t=cc.Sprite.prototype;cc.defineGetterSetter(t,"opacityModifyRGB",t.isOpacityModifyRGB,t.setOpacityModifyRGB),cc.defineGetterSetter(t,"opacity",t.getOpacity,t.setOpacity),cc.defineGetterSetter(t,"color",t.getColor,t.setColor),cc.defineGetterSetter(t,"flippedX",t.isFlippedX,t.setFlippedX),cc.defineGetterSetter(t,"flippedY",t.isFlippedY,t.setFlippedY),cc.defineGetterSetter(t,"offsetX",t._getOffsetX),cc.defineGetterSetter(t,"offsetY",t._getOffsetY),cc.defineGetterSetter(t,"texture",t.getTexture,t.setTexture),cc.defineGetterSetter(t,"textureRectRotated",t.isTextureRectRotated),cc.defineGetterSetter(t,"batchNode",t.getBatchNode,t.setBatchNode),cc.defineGetterSetter(t,"quad",t.getQuad)},cc.Sprite=cc.Node.extend({dirty:!1,atlasIndex:0,textureAtlas:null,_batchNode:null,_recursiveDirty:null,_hasChildren:null,_shouldBeHidden:!1,_transformToBatch:null,_blendFunc:null,_texture:null,_rect:null,_rectRotated:!1,_offsetPosition:null,_unflippedOffsetPositionFromCenter:null,_opacityModifyRGB:!1,_flippedX:!1,_flippedY:!1,_textureLoaded:!1,_className:"Sprite",ctor:function(t,e,i){cc.Node.prototype.ctor.call(this),this._shouldBeHidden=!1,this._offsetPosition=cc.p(0,0),this._unflippedOffsetPositionFromCenter=cc.p(0,0),this._blendFunc={src:cc.BLEND_SRC,dst:cc.BLEND_DST},this._rect=cc.rect(0,0,0,0),this._softInit(t,e,i)},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(t,e){this.addEventListener("load",t,e)},isDirty:function(){return this.dirty},setDirty:function(t){this.dirty=t},isTextureRectRotated:function(){return this._rectRotated},getAtlasIndex:function(){return this.atlasIndex},setAtlasIndex:function(t){this.atlasIndex=t},getTextureRect:function(){return cc.rect(this._rect)},getTextureAtlas:function(){return this.textureAtlas},setTextureAtlas:function(t){this.textureAtlas=t},getOffsetPosition:function(){return cc.p(this._offsetPosition)},_getOffsetX:function(){return this._offsetPosition.x},_getOffsetY:function(){return this._offsetPosition.y},getBlendFunc:function(){return this._blendFunc},initWithSpriteFrame:function(t){cc.assert(t,cc._LogInfos.Sprite_initWithSpriteFrame),t.textureLoaded()||(this._textureLoaded=!1,t.addEventListener("load",this._renderCmd._spriteFrameLoadedCallback,this));var e=cc._renderType===cc._RENDER_TYPE_CANVAS?!1:t._rotated,e=this.initWithTexture(t.getTexture(),t.getRect(),e);return this.setSpriteFrame(t),e},initWithSpriteFrameName:function(t){cc.assert(t,cc._LogInfos.Sprite_initWithSpriteFrameName);var e=cc.spriteFrameCache.getSpriteFrame(t);return cc.assert(e,t+cc._LogInfos.Sprite_initWithSpriteFrameName1),this.initWithSpriteFrame(e)},useBatchNode:function(t){this.textureAtlas=t.getTextureAtlas(),this._batchNode=t},setVertexRect:function(t){var e=this._rect;e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height},sortAllChildren:function(){if(this._reorderChildDirty){var t,e,i,n=this._children,r=n.length;for(t=1;r>t;t++){for(i=n[t],e=t-1;e>=0;){if(i._localZOrder<n[e]._localZOrder)n[e+1]=n[e];else{if(!(i._localZOrder===n[e]._localZOrder&&i.arrivalOrder<n[e].arrivalOrder))break;n[e+1]=n[e]}e--}n[e+1]=i}this._batchNode&&this._arrayMakeObjectsPerformSelector(n,cc.Node._stateCallbackType.sortAllChildren),this._reorderChildDirty=!1}},reorderChild:function(t,e){cc.assert(t,cc._LogInfos.Sprite_reorderChild_2),-1===this._children.indexOf(t)?cc.log(cc._LogInfos.Sprite_reorderChild):e!==t.zIndex&&(this._batchNode&&!this._reorderChildDirty&&(this._setReorderChildDirtyRecursively(),this._batchNode.reorderBatch(!0)),cc.Node.prototype.reorderChild.call(this,t,e))},removeChild:function(t,e){this._batchNode&&this._batchNode.removeSpriteFromAtlas(t),cc.Node.prototype.removeChild.call(this,t,e)},setVisible:function(t){cc.Node.prototype.setVisible.call(this,t),this._renderCmd.setDirtyRecursively(!0)},removeAllChildren:function(t){var e=this._children,i=this._batchNode;if(i&&null!=e)for(var n=0,r=e.length;r>n;n++)i.removeSpriteFromAtlas(e[n]);cc.Node.prototype.removeAllChildren.call(this,t),this._hasChildren=!1},ignoreAnchorPointForPosition:function(t){this._batchNode?cc.log(cc._LogInfos.Sprite_ignoreAnchorPointForPosition):cc.Node.prototype.ignoreAnchorPointForPosition.call(this,t)},setFlippedX:function(t){this._flippedX!==t&&(this._flippedX=t,this.setTextureRect(this._rect,this._rectRotated,this._contentSize),this.setNodeDirty(!0))},setFlippedY:function(t){this._flippedY!==t&&(this._flippedY=t,this.setTextureRect(this._rect,this._rectRotated,this._contentSize),this.setNodeDirty(!0))},isFlippedX:function(){return this._flippedX},isFlippedY:function(){return this._flippedY},setOpacityModifyRGB:function(t){this._opacityModifyRGB!==t&&(this._opacityModifyRGB=t,this._renderCmd._setColorDirty())},isOpacityModifyRGB:function(){return this._opacityModifyRGB},setDisplayFrameWithAnimationName:function(t,e){cc.assert(t,cc._LogInfos.Sprite_setDisplayFrameWithAnimationName_3);var i=cc.animationCache.getAnimation(t);i?(i=i.getFrames()[e])?this.setSpriteFrame(i.getSpriteFrame()):cc.log(cc._LogInfos.Sprite_setDisplayFrameWithAnimationName_2):cc.log(cc._LogInfos.Sprite_setDisplayFrameWithAnimationName)},getBatchNode:function(){return this._batchNode},_setReorderChildDirtyRecursively:function(){if(!this._reorderChildDirty){this._reorderChildDirty=!0;for(var t=this._parent;t&&t!==this._batchNode;)t._setReorderChildDirtyRecursively(),t=t.parent}},getTexture:function(){return this._texture},_softInit:function(t,e,i){void 0===t?cc.Sprite.prototype.init.call(this):cc.isString(t)?"#"===t[0]?(e=t.substr(1,t.length-1),(e=cc.spriteFrameCache.getSpriteFrame(e))?this.initWithSpriteFrame(e):cc.log("%s does not exist",t)):cc.Sprite.prototype.init.call(this,t,e):"object"==typeof t&&(t instanceof cc.Texture2D?this.initWithTexture(t,e,i):t instanceof cc.SpriteFrame?this.initWithSpriteFrame(t):(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement)&&(e=new cc.Texture2D,e.initWithElement(t),e.handleLoadedTexture(),this.initWithTexture(e)))},getQuad:function(){return this._renderCmd.getQuad()},setBlendFunc:function(t,e){var i=this._blendFunc;void 0===e?(i.src=t.src,i.dst=t.dst):(i.src=t,i.dst=e),this._renderCmd.updateBlendFunc(i)},init:function(){return 0<arguments.length?this.initWithFile(arguments[0],arguments[1]):(cc.Node.prototype.init.call(this),this.dirty=this._recursiveDirty=!1,this._blendFunc.src=cc.BLEND_SRC,this._blendFunc.dst=cc.BLEND_DST,this.texture=null,this._flippedX=this._flippedY=!1,this.anchorY=this.anchorX=.5,this._offsetPosition.x=0,this._offsetPosition.y=0,this._hasChildren=!1,this._renderCmd._init(),this.setTextureRect(cc.rect(0,0,0,0),!1,cc.size(0,0)),!0)},initWithFile:function(t,e){cc.assert(t,cc._LogInfos.Sprite_initWithFile);var i=cc.textureCache.getTextureForKey(t);if(i){if(!e){var n=i.getContentSize();e=cc.rect(0,0,n.width,n.height)}return this.initWithTexture(i,e)}return i=cc.textureCache.addImage(t),this.initWithTexture(i,e||cc.rect(0,0,i._contentSize.width,i._contentSize.height))
},initWithTexture:function(t,e,i,n){if(cc.assert(0!==arguments.length,cc._LogInfos.CCSpriteBatchNode_initWithTexture),i=i||!1,t=this._renderCmd._handleTextureForRotatedTexture(t,e,i,n),!cc.Node.prototype.init.call(this))return!1;this._batchNode=null,this.dirty=this._recursiveDirty=!1,this._opacityModifyRGB=!0,this._blendFunc.src=cc.BLEND_SRC,this._blendFunc.dst=cc.BLEND_DST,this._flippedX=this._flippedY=!1,this.setAnchorPoint(.5,.5),this._offsetPosition.x=0,this._offsetPosition.y=0,this._hasChildren=!1,this._renderCmd._init();var r=t.isLoaded();return this._textureLoaded=r,r?(e||(e=cc.rect(0,0,t.width,t.height)),this._renderCmd._checkTextureBoundary(t,e,i),this.setTexture(t),this.setTextureRect(e,i),this.setBatchNode(null),!0):(this._rectRotated=i,e&&(this._rect.x=e.x,this._rect.y=e.y,this._rect.width=e.width,this._rect.height=e.height),this.texture&&this.texture.removeEventListener("load",this),t.addEventListener("load",this._renderCmd._textureLoadedCallback,this),this.texture=t,!0)},setTextureRect:function(t,e,i,n){this._rectRotated=e||!1,this.setContentSize(i||t),this.setVertexRect(t),this._renderCmd._setTextureCoords(t,n),t=this._unflippedOffsetPositionFromCenter.x,e=this._unflippedOffsetPositionFromCenter.y,this._flippedX&&(t=-t),this._flippedY&&(e=-e),i=this._rect,this._offsetPosition.x=t+(this._contentSize.width-i.width)/2,this._offsetPosition.y=e+(this._contentSize.height-i.height)/2,this._batchNode?this.dirty=!0:this._renderCmd._resetForBatchNode()},updateTransform:function(){this._renderCmd.updateTransform()},addChild:function(t,e,i){cc.assert(t,cc._LogInfos.CCSpriteBatchNode_addChild_2),null==e&&(e=t._localZOrder),null==i&&(i=t.tag),this._renderCmd._setBatchNodeForAddChild(t)&&(cc.Node.prototype.addChild.call(this,t,e,i),this._hasChildren=!0)},setSpriteFrame:function(t){var e=this;cc.isString(t)&&(t=cc.spriteFrameCache.getSpriteFrame(t),cc.assert(t,cc._LogInfos.Sprite_setSpriteFrame)),this.setNodeDirty(!0);var i=t.getOffset();e._unflippedOffsetPositionFromCenter.x=i.x,e._unflippedOffsetPositionFromCenter.y=i.y,i=t.getTexture(),t.textureLoaded()?(i!==e._texture&&(e.texture=i),e.setTextureRect(t.getRect(),t.isRotated(),t.getOriginalSize())):(e._textureLoaded=!1,t.addEventListener("load",function(t){e._textureLoaded=!0;var i=t.getTexture();i!==e._texture&&(e.texture=i),e.setTextureRect(t.getRect(),t.isRotated(),t.getOriginalSize()),e.dispatchEvent("load"),e.setColor(e.color)},e)),this._renderCmd._updateForSetSpriteFrame(i)},setDisplayFrame:function(t){cc.log(cc._LogInfos.Sprite_setDisplayFrame),this.setSpriteFrame(t)},isFrameDisplayed:function(t){return this._renderCmd.isFrameDisplayed(t)},displayFrame:function(){return this.getSpriteFrame()},getSpriteFrame:function(){return new cc.SpriteFrame(this._texture,cc.rectPointsToPixels(this._rect),this._rectRotated,cc.pointPointsToPixels(this._unflippedOffsetPositionFromCenter),cc.sizePointsToPixels(this._contentSize))},setBatchNode:function(t){(this._batchNode=t)?(this._transformToBatch=cc.affineTransformIdentity(),this.textureAtlas=this._batchNode.getTextureAtlas()):(this.atlasIndex=cc.Sprite.INDEX_NOT_INITIALIZED,this.textureAtlas=null,this.dirty=this._recursiveDirty=!1,this._renderCmd._resetForBatchNode())},setTexture:function(t){if(!t)return this._renderCmd._setTexture(null);var e=this._texture;cc.isString(t)?(t=cc.textureCache.addImage(t),t._textureLoaded?(this._renderCmd._setTexture(t),this._changeRectWithTexture(t,e),this.setColor(this._realColor),this._textureLoaded=!0):t.addEventListener("load",function(){this._renderCmd._setTexture(t),this._changeRectWithTexture(t,e),this.setColor(this._realColor),this._textureLoaded=!0},this)):(cc.assert(t instanceof cc.Texture2D,cc._LogInfos.Sprite_setTexture_2),this._changeRectWithTexture(t,e),this._renderCmd._setTexture(t))},_changeRectWithTexture:function(t,e){var i=cc.rect(0,0,t._contentSize.width,t._contentSize.height),n=e?e._contentSize:cc.size(),r=this._contentSize,o=i.width,s=i.height,c=n.width,n=n.height,a=r.width,r=r.height;if(i&&(o||s)){var l=this._rect;(0===a||0===r||a===c||r===n||c!==o||n!==s||0===l.height&&0===l.width)&&(i.x=i.x||0,i.y=i.y||0,i.width=i.width||0,i.height=i.height||0,this.setTextureRect(i))}},_createRenderCmd:function(){return cc._renderType===cc._RENDER_TYPE_CANVAS?new cc.Sprite.CanvasRenderCmd(this):new cc.Sprite.WebGLRenderCmd(this)}}),cc.Sprite.create=function(t,e,i){return new cc.Sprite(t,e,i)},cc.Sprite.createWithTexture=cc.Sprite.create,cc.Sprite.createWithSpriteFrameName=cc.Sprite.create,cc.Sprite.createWithSpriteFrame=cc.Sprite.create,cc.Sprite.INDEX_NOT_INITIALIZED=-1,cc.EventHelper.prototype.apply(cc.Sprite.prototype),cc.assert(cc.isFunction(cc._tmp.PrototypeSprite),cc._LogInfos.MissingFile,"SpritesPropertyDefine.js"),cc._tmp.PrototypeSprite(),delete cc._tmp.PrototypeSprite,function(){cc.Sprite.CanvasRenderCmd=function(t){cc.Node.CanvasRenderCmd.call(this,t),this._needDraw=!0,this._textureCoord={renderX:0,renderY:0,x:0,y:0,width:0,height:0,validRect:!1},this._blendFuncStr="source-over",this._colorized=!1,this._originalTexture=null};var t=cc.Sprite.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);t.constructor=cc.Sprite.CanvasRenderCmd,t._init=function(){},t.setDirtyRecursively=function(){},t._resetForBatchNode=function(){},t._setTexture=function(t){var e=this._node;e._texture!==t&&(t?(t.getHtmlElementObj()instanceof HTMLImageElement&&(this._originalTexture=t),e._textureLoaded=t._textureLoaded):e._textureLoaded=!1,e._texture=t)},t._setColorDirty=function(){this.setDirtyFlag(cc.Node._dirtyFlags.colorDirty|cc.Node._dirtyFlags.opacityDirty)},t.isFrameDisplayed=function(t){var e=this._node;return t.getTexture()!==e._texture?!1:cc.rectEqualToRect(t.getRect(),e._rect)},t.updateBlendFunc=function(t){this._blendFuncStr=cc.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc(t)},t._setBatchNodeForAddChild=function(){return!0},t._handleTextureForRotatedTexture=function(t,e,i,n){return i&&t.isLoaded()&&(t=t.getHtmlElementObj(),t=cc.Sprite.CanvasRenderCmd._cutRotateImageToCanvas(t,e,n),n=new cc.Texture2D,n.initWithElement(t),n.handleLoadedTexture(),t=n,e.x=e.y=0,this._node._rect=cc.rect(0,0,e.width,e.height)),t},t._checkTextureBoundary=function(t,e,i){t&&t.url&&(i=e.y+e.height,e.x+e.width>t.width&&cc.error(cc._LogInfos.RectWidth,t.url),i>t.height&&cc.error(cc._LogInfos.RectHeight,t.url)),this._node._originalTexture=t},t.rendering=function(t,e,i){var n=this._node,r=this._textureCoord,o=this._displayedOpacity/255;if((!n._texture||0!==r.width&&0!==r.height&&n._texture._textureLoaded)&&0!==o){t=t||cc._renderContext;var s=t.getContext(),c=n._offsetPosition.x,a=n._rect.height,l=n._rect.width,h=-n._offsetPosition.y-a;t.setTransform(this._worldTransform,e,i),t.setCompositeOperation(this._blendFuncStr),t.setGlobalAlpha(o),(n._flippedX||n._flippedY)&&t.save(),n._flippedX&&(c=-c-l,s.scale(-1,1)),n._flippedY&&(h=n._offsetPosition.y,s.scale(1,-1)),n._texture?(o=n._texture._htmlElementObj,""!==n._texture._pattern?(t.setFillStyle(s.createPattern(o,n._texture._pattern)),s.fillRect(c*e,h*i,l*e,a*i)):this._colorized?s.drawImage(o,0,0,r.width,r.height,c*e,h*i,l*e,a*i):s.drawImage(o,r.renderX,r.renderY,r.width,r.height,c*e,h*i,l*e,a*i)):(o=n._contentSize,r.validRect&&(r=this._displayedColor,t.setFillStyle("rgba("+r.r+","+r.g+","+r.b+",1)"),s.fillRect(c*e,h*i,o.width*e,o.height*i))),(n._flippedX||n._flippedY)&&t.restore(),cc.g_NumberOfDraws++}},t._updateColor=cc.sys._supportCanvasNewBlendModes?function(){var t=this._node,e=this._displayedColor;if(255===e.r&&255===e.g&&255===e.b)this._setOriginalTexture();else{var i,n=t._texture,r=this._textureCoord;n&&r.validRect&&this._originalTexture&&(i=n.getHtmlElementObj())&&(this._colorized=!0,i instanceof HTMLCanvasElement&&!this._rectRotated&&!this._newTextureWhenChangeColor&&this._originalTexture._htmlElementObj!==i?cc.Sprite.CanvasRenderCmd._generateTintImageWithMultiply(this._originalTexture._htmlElementObj,e,r,i):(i=cc.Sprite.CanvasRenderCmd._generateTintImageWithMultiply(this._originalTexture._htmlElementObj,e,r),n=new cc.Texture2D,n.initWithElement(i),n.handleLoadedTexture(),t.setTexture(n)))}}:function(){var t=this._node,e=this._displayedColor;if(255===e.r&&255===e.g&&255===e.b)this._setOriginalTexture();else{var i,n=t._texture,r=this._textureCoord;n&&r.validRect&&this._originalTexture&&(i=n.getHtmlElementObj())&&(n=cc.textureCache.getTextureColors(this._originalTexture.getHtmlElementObj()))&&(this._colorized=!0,i instanceof HTMLCanvasElement&&!this._rectRotated&&!this._newTextureWhenChangeColor?cc.Sprite.CanvasRenderCmd._generateTintImage(i,n,e,r,i):(i=cc.Sprite.CanvasRenderCmd._generateTintImage(i,n,e,r),n=new cc.Texture2D,n.initWithElement(i),n.handleLoadedTexture(),t.texture=n))}},t._setOriginalTexture=function(){if(this._colorized){this._colorized=!1;var t=this._node,e=cc.rect(t._rect),i=cc.size(t._contentSize),n=t._rectRotated;t.setTexture(this._originalTexture),t.setTextureRect(e,n,i)}},t.getQuad=function(){return null},t._updateForSetSpriteFrame=function(t,e){if(this._originalTexture=t,this._colorized=!1,this._textureCoord.renderX=this._textureCoord.x,this._textureCoord.renderY=this._textureCoord.y,e=e||t._textureLoaded){var i=this._node.getColor();255===i.r&&255===i.g&&255===i.b||this._updateColor()}},t.updateTransform=function(){var t=this._node;if(t.dirty){var e=t._parent;!t._visible||e&&e!==t._batchNode&&e._shouldBeHidden?t._shouldBeHidden=!0:(t._shouldBeHidden=!1,t._transformToBatch=e&&e!==t._batchNode?cc.affineTransformConcat(this.getNodeToParentTransform(),e._transformToBatch):this.getNodeToParentTransform()),t._recursiveDirty=!1,t.dirty=!1}t._hasChildren&&t._arrayMakeObjectsPerformSelector(t._children,cc.Node._stateCallbackType.updateTransform)},t._updateDisplayColor=function(t){cc.Node.CanvasRenderCmd.prototype._updateDisplayColor.call(this,t)},t._spriteFrameLoadedCallback=function(t){this.setTextureRect(t.getRect(),t.isRotated(),t.getOriginalSize()),this._renderCmd._updateColor(),this.dispatchEvent("load")},t._textureLoadedCallback=function(t){if(!this._textureLoaded){this._textureLoaded=!0;var e=this._rect,i=this._renderCmd;e?cc._rectEqualToZero(e)&&(e.width=t.width,e.height=t.height):e=cc.rect(0,0,t.width,t.height),this.texture=i._originalTexture=t,this.setTextureRect(e,this._rectRotated),t=i._displayedColor,255===t.r&&255===t.g&&255===t.b||i._updateColor(),this.setBatchNode(this._batchNode),this.dispatchEvent("load")}},t._setTextureCoords=function(t,e){void 0===e&&(e=!0);var i=this._textureCoord,n=e?cc.contentScaleFactor():1;i.renderX=i.x=0|t.x*n,i.renderY=i.y=0|t.y*n,i.width=0|t.width*n,i.height=0|t.height*n,i.validRect=!(0===i.width||0===i.height||0>i.x||0>i.y)},cc.Sprite.CanvasRenderCmd._generateTintImageWithMultiply=function(t,e,i,n){n=n||cc.newElement("canvas"),i=i||cc.rect(0,0,t.width,t.height);var r=n.getContext("2d");return n.width!==i.width||n.height!==i.height?(n.width=i.width,n.height=i.height):r.globalCompositeOperation="source-over",r.fillStyle="rgb("+(0|e.r)+","+(0|e.g)+","+(0|e.b)+")",r.fillRect(0,0,i.width,i.height),r.globalCompositeOperation="multiply",r.drawImage(t,i.x,i.y,i.width,i.height,0,0,i.width,i.height),r.globalCompositeOperation="destination-atop",r.drawImage(t,i.x,i.y,i.width,i.height,0,0,i.width,i.height),n},cc.Sprite.CanvasRenderCmd._generateTintImage=function(t,e,i,n,r){n||(n=cc.rect(0,0,t.width,t.height)),t=i.r/255;var o=i.g/255;i=i.b/255;var s,c=Math.min(n.width,e[0].width),a=Math.min(n.height,e[0].height);r?(s=r.getContext("2d"),s.clearRect(0,0,c,a)):(r=cc.newElement("canvas"),r.width=c,r.height=a,s=r.getContext("2d")),s.save(),s.globalCompositeOperation="lighter";var l=s.globalAlpha;return t>0&&(s.globalAlpha=t*l,s.drawImage(e[0],n.x,n.y,c,a,0,0,c,a)),o>0&&(s.globalAlpha=o*l,s.drawImage(e[1],n.x,n.y,c,a,0,0,c,a)),i>0&&(s.globalAlpha=i*l,s.drawImage(e[2],n.x,n.y,c,a,0,0,c,a)),1>t+o+i&&(s.globalAlpha=l,s.drawImage(e[3],n.x,n.y,c,a,0,0,c,a)),s.restore(),r},cc.Sprite.CanvasRenderCmd._generateTextureCacheForColor=function(t){function e(){var e=cc.Sprite.CanvasRenderCmd._generateTextureCacheForColor,n=t.width,r=t.height;i[0].width=n,i[0].height=r,i[1].width=n,i[1].height=r,i[2].width=n,i[2].height=r,i[3].width=n,i[3].height=r,e.canvas.width=n,e.canvas.height=r;var o=e.canvas.getContext("2d");o.drawImage(t,0,0),e.tempCanvas.width=n,e.tempCanvas.height=r;for(var o=o.getImageData(0,0,n,r).data,s=0;4>s;s++){var c=i[s].getContext("2d");c.getImageData(0,0,n,r).data,e.tempCtx.drawImage(t,0,0);for(var a=e.tempCtx.getImageData(0,0,n,r),l=a.data,h=0;h<o.length;h+=4)l[h]=0===s?o[h]:0,l[h+1]=1===s?o[h+1]:0,l[h+2]=2===s?o[h+2]:0,l[h+3]=o[h+3];c.putImageData(a,0,0)}t.onload=null}if(t.channelCache)return t.channelCache;var i=[cc.newElement("canvas"),cc.newElement("canvas"),cc.newElement("canvas"),cc.newElement("canvas")];try{e()}catch(n){t.onload=e}return t.channelCache=i},cc.Sprite.CanvasRenderCmd._generateTextureCacheForColor.canvas=cc.newElement("canvas"),cc.Sprite.CanvasRenderCmd._generateTextureCacheForColor.tempCanvas=cc.newElement("canvas"),cc.Sprite.CanvasRenderCmd._generateTextureCacheForColor.tempCtx=cc.Sprite.CanvasRenderCmd._generateTextureCacheForColor.tempCanvas.getContext("2d"),cc.Sprite.CanvasRenderCmd._cutRotateImageToCanvas=function(t,e,i){if(!t)return null;if(!e)return t;i=null==i?!0:i;var n=cc.newElement("canvas");n.width=e.width,n.height=e.height;var r=n.getContext("2d");return r.translate(n.width/2,n.height/2),r.rotate(i?-1.5707963267948966:1.5707963267948966),r.drawImage(t,e.x,e.y,e.height,e.width,-e.height/2,-e.width/2,e.height,e.width),n}}(),function(){cc.Sprite.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._quad=new cc.V3F_C4B_T2F_Quad,this._quadWebBuffer=cc._renderContext.createBuffer(),this._quadDirty=!0,this._recursiveDirty=this._dirty=!1};var t=cc.Sprite.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);t.constructor=cc.Sprite.WebGLRenderCmd,t.updateBlendFunc=function(){},t.setDirtyFlag=function(t){cc.Node.WebGLRenderCmd.prototype.setDirtyFlag.call(this,t),this._dirty=!0},t.setDirtyRecursively=function(t){this._dirty=this._recursiveDirty=t;for(var e,i=this._node._children,n=i?i.length:0,r=0;n>r;r++)e=i[r],e instanceof cc.Sprite&&e._renderCmd.setDirtyRecursively(t)},t._setBatchNodeForAddChild=function(t){var e=this._node;if(e._batchNode){if(!(t instanceof cc.Sprite))return cc.log(cc._LogInfos.Sprite_addChild),!1;t.texture._webTextureObj!==e.textureAtlas.texture._webTextureObj&&cc.log(cc._LogInfos.Sprite_addChild_2),e._batchNode.appendChild(t),e._reorderChildDirty||e._setReorderChildDirtyRecursively()}return!0},t._handleTextureForRotatedTexture=function(t){return t},t.isFrameDisplayed=function(t){var e=this._node;return cc.rectEqualToRect(t.getRect(),e._rect)&&t.getTexture().getName()===e._texture.getName()&&cc.pointEqualToPoint(t.getOffset(),e._unflippedOffsetPositionFromCenter)},t._init=function(){var t={r:255,g:255,b:255,a:255},e=this._quad;e.bl.colors=t,e.br.colors=t,e.tl.colors=t,e.tr.colors=t,this._quadDirty=!0},t._resetForBatchNode=function(){var t=this._node,e=t._offsetPosition.x,i=t._offsetPosition.y,n=e+t._rect.width,t=i+t._rect.height,r=this._quad;r.bl.vertices={x:e,y:i,z:0},r.br.vertices={x:n,y:i,z:0},r.tl.vertices={x:e,y:t,z:0},r.tr.vertices={x:n,y:t,z:0},this._quadDirty=!0},t.getQuad=function(){return this._quad},t._updateForSetSpriteFrame=function(){},t._spriteFrameLoadedCallback=function(t){this.setTextureRect(t.getRect(),t.isRotated(),t.getOriginalSize()),this.dispatchEvent("load")},t._textureLoadedCallback=function(t){var e=this._renderCmd;if(!this._textureLoaded){this._textureLoaded=!0;var i=this._rect;i?cc._rectEqualToZero(i)&&(i.width=t.width,i.height=t.height):i=cc.rect(0,0,t.width,t.height),this.texture=t,this.setTextureRect(i,this._rectRotated),this.setBatchNode(this._batchNode),e._quadDirty=!0,this.dispatchEvent("load")}},t._setTextureCoords=function(t,e){void 0===e&&(e=!0),e&&(t=cc.rectPointsToPixels(t));var i=this._node,n=i._batchNode?i.textureAtlas.texture:i._texture;if(n){var r,o,s=n.pixelsWidth,c=n.pixelsHeight,a=this._quad;i._rectRotated?(cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(n=(2*t.x+1)/(2*s),s=n+(2*t.height-2)/(2*s),r=(2*t.y+1)/(2*c),c=r+(2*t.width-2)/(2*c)):(n=t.x/s,s=(t.x+t.height)/s,r=t.y/c,c=(t.y+t.width)/c),i._flippedX&&(o=r,r=c,c=o),i._flippedY&&(o=n,n=s,s=o),a.bl.texCoords.u=n,a.bl.texCoords.v=r,a.br.texCoords.u=n,a.br.texCoords.v=c,a.tl.texCoords.u=s,a.tl.texCoords.v=r,a.tr.texCoords.u=s,a.tr.texCoords.v=c):(cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(n=(2*t.x+1)/(2*s),s=n+(2*t.width-2)/(2*s),r=(2*t.y+1)/(2*c),c=r+(2*t.height-2)/(2*c)):(n=t.x/s,s=(t.x+t.width)/s,r=t.y/c,c=(t.y+t.height)/c),i._flippedX&&(o=n,n=s,s=o),i._flippedY&&(o=r,r=c,c=o),a.bl.texCoords.u=n,a.bl.texCoords.v=c,a.br.texCoords.u=s,a.br.texCoords.v=c,a.tl.texCoords.u=n,a.tl.texCoords.v=r,a.tr.texCoords.u=s,a.tr.texCoords.v=r),this._quadDirty=!0}},t.transform=function(t,e){cc.Node.WebGLRenderCmd.prototype.transform.call(this,t,e),this._dirty=!0},t._setColorDirty=function(){},t._updateColor=function(){var t=this._displayedColor,e=this._displayedOpacity,i=this._node,t={r:t.r,g:t.g,b:t.b,a:e};i._opacityModifyRGB&&(t.r*=e/255,t.g*=e/255,t.b*=e/255),e=this._quad,e.bl.colors=t,e.br.colors=t,e.tl.colors=t,e.tr.colors=t,i._batchNode&&(i.atlasIndex!==cc.Sprite.INDEX_NOT_INITIALIZED?i.textureAtlas.updateQuad(e,i.atlasIndex):this._dirty=!0),this._quadDirty=!0},t._updateBlendFunc=function(){if(this._batchNode)cc.log(cc._LogInfos.Sprite__updateBlendFunc);else{var t=this._node;t._texture&&t._texture.hasPremultipliedAlpha()?(t._blendFunc.src=cc.BLEND_SRC,t._blendFunc.dst=cc.BLEND_DST,t.opacityModifyRGB=!0):(t._blendFunc.src=cc.SRC_ALPHA,t._blendFunc.dst=cc.ONE_MINUS_SRC_ALPHA,t.opacityModifyRGB=!1)}},t._setTexture=function(t){var e=this._node;if(e._batchNode){if(e._batchNode.texture!==t)return void cc.log(cc._LogInfos.Sprite_setTexture)}else e._texture!==t&&(e._textureLoaded=t?t._textureLoaded:!1,e._texture=t,this._updateBlendFunc());this._shaderProgram=cc.shaderCache.programForKey(t?cc.SHADER_POSITION_TEXTURECOLOR:cc.SHADER_POSITION_COLOR)},t.updateTransform=function(){var t=this._node;if(this._dirty){var e=this._quad,i=t._parent;if(!t._visible||i&&i!==t._batchNode&&i._shouldBeHidden)e.br.vertices=e.tl.vertices=e.tr.vertices=e.bl.vertices={x:0,y:0,z:0},t._shouldBeHidden=!0;else{t._shouldBeHidden=!1,0!==this._dirtyFlag&&(this.updateStatus(),this._dirtyFlag=0),t._transformToBatch=i&&i!==t._batchNode?cc.affineTransformConcat(this.getNodeToParentTransform(),i._transformToBatch):this.getNodeToParentTransform();var n=t._transformToBatch,r=t._rect,i=t._offsetPosition.x,o=t._offsetPosition.y,s=i+r.width,c=o+r.height,a=n.tx,l=n.ty,h=n.a,u=n.b,d=n.d,_=-n.c,n=i*h-o*_+a,r=i*u+o*d+l,p=s*h-o*_+a,o=s*u+o*d+l,f=s*h-c*_+a,s=s*u+c*d+l,a=i*h-c*_+a,i=i*u+c*d+l,c=t._vertexZ;cc.SPRITEBATCHNODE_RENDER_SUBPIXEL||(n|=0,r|=0,p|=0,o|=0,f|=0,s|=0,a|=0,i|=0),e.bl.vertices={x:n,y:r,z:c},e.br.vertices={x:p,y:o,z:c},e.tl.vertices={x:a,y:i,z:c},e.tr.vertices={x:f,y:s,z:c}}t.textureAtlas.updateQuad(e,t.atlasIndex),this._dirty=t._recursiveDirty=!1}t._hasChildren&&t._arrayMakeObjectsPerformSelector(t._children,cc.Node._stateCallbackType.updateTransform)},t._checkTextureBoundary=function(t,e,i){t&&t.url&&(i?(i=e.x+e.height,e=e.y+e.width):(i=e.x+e.width,e=e.y+e.height),i>t.width&&cc.error(cc._LogInfos.RectWidth,t.url),e>t.height&&cc.error(cc._LogInfos.RectHeight,t.url))},t.rendering=function(t){var e=this._node,i=e._texture;i&&!i._textureLoaded||0===this._displayedOpacity||(t=t||cc._renderContext,i?i._textureLoaded&&(this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix),cc.glBlendFunc(e._blendFunc.src,e._blendFunc.dst),cc.glBindTexture2DN(0,i),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX),t.bindBuffer(t.ARRAY_BUFFER,this._quadWebBuffer),this._quadDirty&&(t.bufferData(t.ARRAY_BUFFER,this._quad.arrayBuffer,t.DYNAMIC_DRAW),this._quadDirty=!1),t.vertexAttribPointer(0,3,t.FLOAT,!1,24,0),t.vertexAttribPointer(1,4,t.UNSIGNED_BYTE,!0,24,12),t.vertexAttribPointer(2,2,t.FLOAT,!1,24,16),t.drawArrays(t.TRIANGLE_STRIP,0,4)):(this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix),cc.glBlendFunc(e._blendFunc.src,e._blendFunc.dst),cc.glBindTexture2D(null),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION|cc.VERTEX_ATTRIB_FLAG_COLOR),t.bindBuffer(t.ARRAY_BUFFER,this._quadWebBuffer),this._quadDirty&&(t.bufferData(t.ARRAY_BUFFER,this._quad.arrayBuffer,t.STATIC_DRAW),this._quadDirty=!1),t.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,t.FLOAT,!1,24,0),t.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,t.UNSIGNED_BYTE,!0,24,12),t.drawArrays(t.TRIANGLE_STRIP,0,4)),cc.g_NumberOfDraws++,0===cc.SPRITE_DEBUG_DRAW&&!e._showNode)||(cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW),cc.current_stack.stack.push(cc.current_stack.top),cc.current_stack.top=this._stackMatrix,1===cc.SPRITE_DEBUG_DRAW||e._showNode?(e=this._quad,e=[cc.p(e.tl.vertices.x,e.tl.vertices.y),cc.p(e.bl.vertices.x,e.bl.vertices.y),cc.p(e.br.vertices.x,e.br.vertices.y),cc.p(e.tr.vertices.x,e.tr.vertices.y)],cc._drawingUtil.drawPoly(e,4,!0)):2===cc.SPRITE_DEBUG_DRAW&&(i=e.getTextureRect(),e=e.getOffsetPosition(),e=[cc.p(e.x,e.y),cc.p(e.x+i.width,e.y),cc.p(e.x+i.width,e.y+i.height),cc.p(e.x,e.y+i.height)],cc._drawingUtil.drawPoly(e,4,!0)),cc.current_stack.top=cc.current_stack.stack.pop())}}(),cc.SpriteBatchNode=cc.Node.extend({_blendFunc:null,_descendants:null,_className:"SpriteBatchNode",ctor:function(t,e){cc.Node.prototype.ctor.call(this),this._descendants=[],this._blendFunc=new cc.BlendFunc(cc.BLEND_SRC,cc.BLEND_DST);var i;e=e||cc.SpriteBatchNode.DEFAULT_CAPACITY,cc.isString(t)?(i=cc.textureCache.getTextureForKey(t))||(i=cc.textureCache.addImage(t)):t instanceof cc.Texture2D&&(i=t),i&&this.initWithTexture(i,e)},addSpriteWithoutQuad:function(t,e,i){if(cc.assert(t,cc._LogInfos.SpriteBatchNode_addSpriteWithoutQuad_2),!(t instanceof cc.Sprite))return cc.log(cc._LogInfos.SpriteBatchNode_addSpriteWithoutQuad),null;t.atlasIndex=e;var n,r=0,o=this._descendants;if(o&&0<o.length)for(r=0,n=o.length;n>r;r++){var s=o[r];if(s&&s.atlasIndex>=e)break}return o.splice(r,0,t),cc.Node.prototype.addChild.call(this,t,e,i),this.reorderBatch(!1),this},getTextureAtlas:function(){return this._renderCmd.getTextureAtlas()},setTextureAtlas:function(t){this._renderCmd.getTextureAtlas(t)},getDescendants:function(){return this._descendants},initWithFile:function(t,e){var i=cc.textureCache.getTextureForKey(t);return i||(i=cc.textureCache.addImage(t)),this.initWithTexture(i,e)},_setNodeDirtyForCache:function(){this._renderCmd&&this._renderCmd._setNodeDirtyForCache&&this._renderCmd._setNodeDirtyForCache()},init:function(t,e){var i=cc.textureCache.getTextureForKey(t);return i||(i=cc.textureCache.addImage(t)),this.initWithTexture(i,e)},increaseAtlasCapacity:function(){this._renderCmd.increaseAtlasCapacity()},removeChildAtIndex:function(t,e){this.removeChild(this._children[t],e)},rebuildIndexInOrder:function(t,e){var i=t.children;if(i&&0<i.length)for(var n=0;n<i.length;n++){var r=i[n];r&&0>r.zIndex&&(e=this.rebuildIndexInOrder(r,e))}if(!t===this&&(t.atlasIndex=e,e++),i&&0<i.length)for(n=0;n<i.length;n++)(r=i[n])&&0<=r.zIndex&&(e=this.rebuildIndexInOrder(r,e));return e},highestAtlasIndexInChild:function(t){var e=t.children;return e&&0!==e.length?this.highestAtlasIndexInChild(e[e.length-1]):t.atlasIndex},lowestAtlasIndexInChild:function(t){var e=t.children;return e&&0!==e.length?this.lowestAtlasIndexInChild(e[e.length-1]):t.atlasIndex},atlasIndexForChild:function(t,e){var i=t.parent,n=i.children,r=n.indexOf(t),o=null;return r>0&&r<cc.UINT_MAX&&(o=n[r-1]),i===this?0===r?0:this.highestAtlasIndexInChild(o)+1:0===r?0>e?i.atlasIndex:i.atlasIndex+1:0>o.zIndex&&0>e||0<=o.zIndex&&e>=0?this.highestAtlasIndexInChild(o)+1:i.atlasIndex+1},reorderBatch:function(t){this._reorderChildDirty=t},setBlendFunc:function(t,e){this._blendFunc=void 0===e?t:{src:t,dst:e}},getBlendFunc:function(){return new cc.BlendFunc(this._blendFunc.src,this._blendFunc.dst)},reorderChild:function(t,e){cc.assert(t,cc._LogInfos.SpriteBatchNode_reorderChild_2),-1===this._children.indexOf(t)?cc.log(cc._LogInfos.SpriteBatchNode_reorderChild):e!==t.zIndex&&cc.Node.prototype.reorderChild.call(this,t,e)},removeChild:function(t,e){null!=t&&(-1===this._children.indexOf(t)?cc.log(cc._LogInfos.SpriteBatchNode_removeChild):(this.removeSpriteFromAtlas(t),cc.Node.prototype.removeChild.call(this,t,e)))},updateQuadFromSprite:function(t,e){cc.assert(t,cc._LogInfos.CCSpriteBatchNode_updateQuadFromSprite_2),t instanceof cc.Sprite?(this._renderCmd.checkAtlasCapacity(),t.batchNode=this,t.atlasIndex=e,t.dirty=!0,t.updateTransform()):cc.log(cc._LogInfos.CCSpriteBatchNode_updateQuadFromSprite)},insertQuadFromSprite:function(t,e){cc.assert(t,cc._LogInfos.CCSpriteBatchNode_insertQuadFromSprite_2),t instanceof cc.Sprite?(this._renderCmd.insertQuad(t,e),t.batchNode=this,t.atlasIndex=e,t.dirty=!0,t.updateTransform(),this._renderCmd.cutting(t,e)):cc.log(cc._LogInfos.CCSpriteBatchNode_insertQuadFromSprite)},initWithTexture:function(t,e){return this._children.length=0,this._descendants.length=0,e=e||cc.SpriteBatchNode.DEFAULT_CAPACITY,this._renderCmd.initWithTexture(t,e),!0},insertChild:function(t,e){t.batchNode=this,t.atlasIndex=e,t.dirty=!0,this._renderCmd.insertQuad(t,e),this._descendants.splice(e,0,t);var i=e+1,n=this._descendants;if(n&&0<n.length)for(;i<n.length;i++)n[i].atlasIndex++;var r,o,n=t.children;if(n)for(i=0,o=n.length||0;o>i;i++)if(r=n[i]){var s=this.atlasIndexForChild(r,r.zIndex);this.insertChild(r,s)}},appendChild:function(t){this._reorderChildDirty=!0,t.batchNode=this,t.dirty=!0,this._descendants.push(t);var e=this._descendants.length-1;t.atlasIndex=e,this._renderCmd.insertQuad(t,e),t=t.children;for(var e=0,i=t.length||0;i>e;e++)this.appendChild(t[e])},removeSpriteFromAtlas:function(t){this._renderCmd.removeQuadAtIndex(t.atlasIndex),t.batchNode=null;var e=this._descendants,i=e.indexOf(t);if(-1!==i){e.splice(i,1);for(var n=e.length;n>i;++i)e[i].atlasIndex--}if(t=t.children)for(e=0,i=t.length||0;i>e;e++)t[e]&&this.removeSpriteFromAtlas(t[e])},getTexture:function(){return this._renderCmd.getTexture()},setTexture:function(t){this._renderCmd.setTexture(t)},addChild:function(t,e,i){cc.assert(null!=t,cc._LogInfos.CCSpriteBatchNode_addChild_3),this._renderCmd.isValidChild(t)&&(e=null==e?t.zIndex:e,i=null==i?t.tag:i,cc.Node.prototype.addChild.call(this,t,e,i),this.appendChild(t))},removeAllChildren:function(t){var e=this._descendants;if(e&&0<e.length)for(var i=0,n=e.length;n>i;i++)e[i]&&(e[i].batchNode=null);cc.Node.prototype.removeAllChildren.call(this,t),this._descendants.length=0,this._renderCmd.removeAllQuads()},sortAllChildren:function(){if(this._reorderChildDirty){var t,e,i=this._children,n=0,r=i.length;for(t=1;r>t;t++){var o=i[t],n=t-1;for(e=i[n];n>=0&&(o._localZOrder<e._localZOrder||o._localZOrder===e._localZOrder&&o.arrivalOrder<e.arrivalOrder);)i[n+1]=e,n-=1,e=i[n];i[n+1]=o}0<i.length&&(this._arrayMakeObjectsPerformSelector(i,cc.Node._stateCallbackType.sortAllChildren),this._renderCmd.updateChildrenAtlasIndex(i)),this._reorderChildDirty=!1}},_createRenderCmd:function(){return cc._renderType===cc._RENDER_TYPE_CANVAS?new cc.SpriteBatchNode.CanvasRenderCmd(this):new cc.SpriteBatchNode.WebGLRenderCmd(this)}}),_p=cc.SpriteBatchNode.prototype,cc.defineGetterSetter(_p,"texture",_p.getTexture,_p.setTexture),cc.defineGetterSetter(_p,"textureAtlas",_p.getTextureAtlas,_p.setTextureAtlas),cc.defineGetterSetter(_p,"descendants",_p.getDescendants),cc.SpriteBatchNode.DEFAULT_CAPACITY=29,cc.SpriteBatchNode.create=function(t,e){return new cc.SpriteBatchNode(t,e)},cc.SpriteBatchNode.createWithTexture=cc.SpriteBatchNode.create,function(){cc.SpriteBatchNode.CanvasRenderCmd=function(t){cc.Node.CanvasRenderCmd.call(this,t),this._originalTexture=this._texture=null};var t=cc.SpriteBatchNode.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);t.constructor=cc.SpriteBatchNode.CanvasRenderCmd,t.checkAtlasCapacity=function(){},t.isValidChild=function(t){return t instanceof cc.Sprite?!0:(cc.log(cc._LogInfos.Sprite_addChild_4),!1)},t.initWithTexture=function(t){this._texture=this._originalTexture=t},t.insertQuad=function(){},t.increaseAtlasCapacity=function(){},t.removeQuadAtIndex=function(){},t.removeAllQuads=function(){},t.getTexture=function(){return this._texture},t.setTexture=function(t){this._texture=t;for(var e=this._node._children,i=0;i<e.length;i++)e[i].setTexture(t)},t.updateChildrenAtlasIndex=function(t){for(var e=this._node._descendants.length=0,i=t.length;i>e;e++)this._updateAtlasIndex(t[e])},t._updateAtlasIndex=function(t){var e,i=this._node._descendants,n=t.children,r=n.length;for(e=0;r>e&&0>n[e]._localZOrder;e++)i.push(n[e]);for(i.push(t);r>e;e++)i.push(n[e])},t.getTextureAtlas=function(){},t.setTextureAtlas=function(){},t.cutting=function(t,e){this._node._children.splice(e,0,t)}}(),function(){cc.SpriteBatchNode.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._textureAtlas=null};var t=cc.SpriteBatchNode.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);t.constructor=cc.SpriteBatchNode.WebGLRenderCmd,t.isValidChild=function(t){return t instanceof cc.Sprite?t.texture!=this.getTexture()?(cc.log(cc._LogInfos.Sprite_addChild_5),!1):!0:(cc.log(cc._LogInfos.Sprite_addChild_4),!1)},t.rendering=function(){var t=this._node;0!==this._textureAtlas.totalQuads&&(this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix),t._arrayMakeObjectsPerformSelector(t._children,cc.Node._stateCallbackType.updateTransform),cc.glBlendFunc(t._blendFunc.src,t._blendFunc.dst),this._textureAtlas.drawQuads())},t.visit=function(t){var e=this._node;if(e._visible){e._parent&&e._parent._renderCmd&&(this._curLevel=e._parent._renderCmd._curLevel+1);var i=cc.current_stack;i.stack.push(i.top),this._dirtyFlag&cc.Node._dirtyFlags.transformDirty||this.transform(t),this.updateStatus(t),i.top=this._stackMatrix,e.sortAllChildren(),cc.renderer.pushRenderCommand(this),this._dirtyFlag=0,i.top=i.stack.pop()}},t.checkAtlasCapacity=function(t){for(var e=this._textureAtlas;t>=e.capacity||e.capacity===e.totalQuads;)this.increaseAtlasCapacity()},t.increaseAtlasCapacity=function(){var t=this._textureAtlas.capacity,e=Math.floor(4*(t+1)/3);cc.log(cc._LogInfos.SpriteBatchNode_increaseAtlasCapacity,t,e),this._textureAtlas.resizeCapacity(e)||cc.log(cc._LogInfos.SpriteBatchNode_increaseAtlasCapacity_2)},t.initWithTexture=function(t,e){this._textureAtlas=new cc.TextureAtlas,this._textureAtlas.initWithTexture(t,e),this._updateBlendFunc(),this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURECOLOR)},t.insertQuad=function(t,e){var i=this._textureAtlas;i.totalQuads>=i.capacity&&this.increaseAtlasCapacity(),i.insertQuad(t.quad,e)},t.removeQuadAtIndex=function(t){this._textureAtlas.removeQuadAtIndex(t)},t.getTexture=function(){return this._textureAtlas.texture},t.setTexture=function(t){this._textureAtlas.setTexture(t),t&&this._updateBlendFunc()},t.removeAllQuads=function(){this._textureAtlas.removeAllQuads()},t._swap=function(t,e){var i=this._node._descendants,n=this._textureAtlas,r=n.quads,o=i[t],s=cc.V3F_C4B_T2F_QuadCopy(r[t]);i[e].atlasIndex=t,i[t]=i[e],n.updateQuad(r[e],t),i[e]=o,n.updateQuad(s,e)},t._updateAtlasIndex=function(t,e){var i=0,n=t.children;n&&(i=n.length);var r=0;if(0===i)r=t.atlasIndex,t.atlasIndex=e,t.arrivalOrder=0,r!==e&&this._swap(r,e),e++;else{for(r=!0,0<=n[0].zIndex&&(r=t.atlasIndex,t.atlasIndex=e,t.arrivalOrder=0,r!==e&&this._swap(r,e),e++,r=!1),i=0;i<n.length;i++){var o=n[i];r&&0<=o.zIndex&&(r=t.atlasIndex,t.atlasIndex=e,t.arrivalOrder=0,r!==e&&this._swap(r,e),e++,r=!1),e=this._updateAtlasIndex(o,e)}r&&(r=t.atlasIndex,t.atlasIndex=e,t.arrivalOrder=0,r!==e&&this._swap(r,e),e++)}return e},t.updateChildrenAtlasIndex=function(t){for(var e=0,i=0;i<t.length;i++)e=this._updateAtlasIndex(t[i],e)},t._updateBlendFunc=function(){if(!this._textureAtlas.texture.hasPremultipliedAlpha()){var t=this._node._blendFunc;
t.src=cc.SRC_ALPHA,t.dst=cc.ONE_MINUS_SRC_ALPHA}},t.getTextureAtlas=function(){return this._textureAtlas},t.setTextureAtlas=function(t){t!==this._textureAtlas&&(this._textureAtlas=t)},t.cutting=function(){}}(),cc.BakeSprite=cc.Sprite.extend({_cacheCanvas:null,_cacheContext:null,ctor:function(){cc.Sprite.prototype.ctor.call(this);var t=document.createElement("canvas");t.width=t.height=10,this._cacheCanvas=t,this._cacheContext=new cc.CanvasContextWrapper(t.getContext("2d"));var e=new cc.Texture2D;e.initWithElement(t),e.handleLoadedTexture(),this.setTexture(e)},getCacheContext:function(){return this._cacheContext},getCacheCanvas:function(){return this._cacheCanvas},resetCanvasSize:function(t,e){var i=this._cacheCanvas,n=this._cacheContext,r=n._context.strokeStyle,o=n._context.fillStyle;void 0===e&&(e=t.height,t=t.width),i.width=t,i.height=e,r!==n._context.strokeStyle&&(n._context.strokeStyle=r),o!==n._context.fillStyle&&(n._context.fillStyle=o),this.getTexture().handleLoadedTexture(),this.setTextureRect(cc.rect(0,0,t,e),!1)}}),cc.AnimationFrame=cc.Class.extend({_spriteFrame:null,_delayPerUnit:0,_userInfo:null,ctor:function(t,e,i){this._spriteFrame=t||null,this._delayPerUnit=e||0,this._userInfo=i||null},clone:function(){var t=new cc.AnimationFrame;return t.initWithSpriteFrame(this._spriteFrame.clone(),this._delayPerUnit,this._userInfo),t},copyWithZone:function(){return cc.clone(this)},copy:function(t){return t=new cc.AnimationFrame,t.initWithSpriteFrame(this._spriteFrame.clone(),this._delayPerUnit,this._userInfo),t},initWithSpriteFrame:function(t,e,i){return this._spriteFrame=t,this._delayPerUnit=e,this._userInfo=i,!0},getSpriteFrame:function(){return this._spriteFrame},setSpriteFrame:function(t){this._spriteFrame=t},getDelayUnits:function(){return this._delayPerUnit},setDelayUnits:function(t){this._delayPerUnit=t},getUserInfo:function(){return this._userInfo},setUserInfo:function(t){this._userInfo=t}}),cc.AnimationFrame.create=function(t,e,i){return new cc.AnimationFrame(t,e,i)},cc.Animation=cc.Class.extend({_frames:null,_loops:0,_restoreOriginalFrame:!1,_duration:0,_delayPerUnit:0,_totalDelayUnits:0,ctor:function(t,e,i){if(this._frames=[],void 0===t)this.initWithSpriteFrames(null,0);else{var n=t[0];n&&(n instanceof cc.SpriteFrame?this.initWithSpriteFrames(t,e,i):n instanceof cc.AnimationFrame&&this.initWithAnimationFrames(t,e,i))}},getFrames:function(){return this._frames},setFrames:function(t){this._frames=t},addSpriteFrame:function(t){var e=new cc.AnimationFrame;e.initWithSpriteFrame(t,1,null),this._frames.push(e),this._totalDelayUnits++},addSpriteFrameWithFile:function(t){t=cc.textureCache.addImage(t);var e=cc.rect(0,0,0,0);e.width=t.width,e.height=t.height,t=new cc.SpriteFrame(t,e),this.addSpriteFrame(t)},addSpriteFrameWithTexture:function(t,e){var i=new cc.SpriteFrame(t,e);this.addSpriteFrame(i)},initWithAnimationFrames:function(t,e,i){for(cc.arrayVerifyType(t,cc.AnimationFrame),this._delayPerUnit=e,this._loops=void 0===i?1:i,this._totalDelayUnits=0,e=this._frames,i=e.length=0;i<t.length;i++){var n=t[i];e.push(n),this._totalDelayUnits+=n.getDelayUnits()}return!0},clone:function(){var t=new cc.Animation;return t.initWithAnimationFrames(this._copyFrames(),this._delayPerUnit,this._loops),t.setRestoreOriginalFrame(this._restoreOriginalFrame),t},copyWithZone:function(t){return t=new cc.Animation,t.initWithAnimationFrames(this._copyFrames(),this._delayPerUnit,this._loops),t.setRestoreOriginalFrame(this._restoreOriginalFrame),t},_copyFrames:function(){for(var t=[],e=0;e<this._frames.length;e++)t.push(this._frames[e].clone());return t},copy:function(){return this.copyWithZone(null)},getLoops:function(){return this._loops},setLoops:function(t){this._loops=t},setRestoreOriginalFrame:function(t){this._restoreOriginalFrame=t},getRestoreOriginalFrame:function(){return this._restoreOriginalFrame},getDuration:function(){return this._totalDelayUnits*this._delayPerUnit},getDelayPerUnit:function(){return this._delayPerUnit},setDelayPerUnit:function(t){this._delayPerUnit=t},getTotalDelayUnits:function(){return this._totalDelayUnits},initWithSpriteFrames:function(t,e,i){if(cc.arrayVerifyType(t,cc.SpriteFrame),this._loops=void 0===i?1:i,this._delayPerUnit=e||0,this._totalDelayUnits=0,e=this._frames,e.length=0,t){for(i=0;i<t.length;i++){var n=t[i],r=new cc.AnimationFrame;r.initWithSpriteFrame(n,1,null),e.push(r)}this._totalDelayUnits+=t.length}return!0},retain:function(){},release:function(){}}),cc.Animation.create=function(t,e,i){return new cc.Animation(t,e,i)},cc.Animation.createWithAnimationFrames=cc.Animation.create,cc.animationCache={_animations:{},addAnimation:function(t,e){this._animations[e]=t},removeAnimation:function(t){t&&this._animations[t]&&delete this._animations[t]},getAnimation:function(t){return this._animations[t]?this._animations[t]:null},_addAnimationsWithDictionary:function(t,e){var i=t.animations;if(i){var n=1,r=t.properties;if(r)for(var n=null!=r.format?parseInt(r.format):n,r=r.spritesheets,o=cc.spriteFrameCache,s=cc.path,c=0;c<r.length;c++)o.addSpriteFrames(s.changeBasename(e,r[c]));switch(n){case 1:this._parseVersion1(i);break;case 2:this._parseVersion2(i);break;default:cc.log(cc._LogInfos.animationCache__addAnimationsWithDictionary_2)}}else cc.log(cc._LogInfos.animationCache__addAnimationsWithDictionary)},addAnimations:function(t){cc.assert(t,cc._LogInfos.animationCache_addAnimations_2);var e=cc.loader.getRes(t);e?this._addAnimationsWithDictionary(e,t):cc.log(cc._LogInfos.animationCache_addAnimations)},_parseVersion1:function(t){var e,i=cc.spriteFrameCache;for(e in t){var n=t[e],r=n.frames,n=parseFloat(n.delay)||0,o=null;if(r){for(var o=[],s=0;s<r.length;s++){var c=i.getSpriteFrame(r[s]);if(c){var a=new cc.AnimationFrame;a.initWithSpriteFrame(c,1,null),o.push(a)}else cc.log(cc._LogInfos.animationCache__parseVersion1_2,e,r[s])}0===o.length?cc.log(cc._LogInfos.animationCache__parseVersion1_3,e):(o.length!==r.length&&cc.log(cc._LogInfos.animationCache__parseVersion1_4,e),o=new cc.Animation(o,n,1),cc.animationCache.addAnimation(o,e))}else cc.log(cc._LogInfos.animationCache__parseVersion1,e)}},_parseVersion2:function(t){var e,i=cc.spriteFrameCache;for(e in t){var n=t[e],r=n.loop,o=parseInt(n.loops),r=r?cc.REPEAT_FOREVER:isNaN(o)?1:o,o=n.restoreOriginalFrame&&1==n.restoreOriginalFrame?!0:!1,s=n.frames;if(s){for(var c=[],a=0;a<s.length;a++){var l=s[a],h=l.spriteframe,u=i.getSpriteFrame(h);if(u){var h=parseFloat(l.delayUnits)||0,l=l.notification,d=new cc.AnimationFrame;d.initWithSpriteFrame(u,h,l),c.push(d)}else cc.log(cc._LogInfos.animationCache__parseVersion2_2,e,h)}n=parseFloat(n.delayPerUnit)||0,s=new cc.Animation,s.initWithAnimationFrames(c,n,r),s.setRestoreOriginalFrame(o),cc.animationCache.addAnimation(s,e)}else cc.log(cc._LogInfos.animationCache__parseVersion2,e)}},_clear:function(){this._animations={}}},cc.SpriteFrame=cc.Class.extend({_offset:null,_originalSize:null,_rectInPixels:null,_rotated:!1,_rect:null,_offsetInPixels:null,_originalSizeInPixels:null,_texture:null,_textureFilename:"",_textureLoaded:!1,ctor:function(t,e,i,n,r){this._offset=cc.p(0,0),this._offsetInPixels=cc.p(0,0),this._originalSize=cc.size(0,0),this._rotated=!1,this._originalSizeInPixels=cc.size(0,0),this._textureFilename="",this._texture=null,this._textureLoaded=!1,void 0!==t&&void 0!==e&&(void 0===i||void 0===n||void 0===r?this.initWithTexture(t,e):this.initWithTexture(t,e,i,n,r))},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(t,e){this.addEventListener("load",t,e)},getRectInPixels:function(){var t=this._rectInPixels;return cc.rect(t.x,t.y,t.width,t.height)},setRectInPixels:function(t){this._rectInPixels||(this._rectInPixels=cc.rect(0,0,0,0)),this._rectInPixels.x=t.x,this._rectInPixels.y=t.y,this._rectInPixels.width=t.width,this._rectInPixels.height=t.height,this._rect=cc.rectPixelsToPoints(t)},isRotated:function(){return this._rotated},setRotated:function(t){this._rotated=t},getRect:function(){var t=this._rect;return cc.rect(t.x,t.y,t.width,t.height)},setRect:function(t){this._rect||(this._rect=cc.rect(0,0,0,0)),this._rect.x=t.x,this._rect.y=t.y,this._rect.width=t.width,this._rect.height=t.height,this._rectInPixels=cc.rectPointsToPixels(this._rect)},getOffsetInPixels:function(){return cc.p(this._offsetInPixels)},setOffsetInPixels:function(t){this._offsetInPixels.x=t.x,this._offsetInPixels.y=t.y,cc._pointPixelsToPointsOut(this._offsetInPixels,this._offset)},getOriginalSizeInPixels:function(){return cc.size(this._originalSizeInPixels)},setOriginalSizeInPixels:function(t){this._originalSizeInPixels.width=t.width,this._originalSizeInPixels.height=t.height},getOriginalSize:function(){return cc.size(this._originalSize)},setOriginalSize:function(t){this._originalSize.width=t.width,this._originalSize.height=t.height},getTexture:function(){if(this._texture)return this._texture;if(""!==this._textureFilename){var t=cc.textureCache.addImage(this._textureFilename);return t&&(this._textureLoaded=t.isLoaded()),t}return null},setTexture:function(t){if(this._texture!==t){var e=t.isLoaded();this._textureLoaded=e,this._texture=t,e||t.addEventListener("load",function(t){if(this._textureLoaded=!0,this._rotated&&cc._renderType===cc._RENDER_TYPE_CANVAS){var e=t.getHtmlElementObj(),e=cc.Sprite.CanvasRenderCmd._cutRotateImageToCanvas(e,this.getRect()),i=new cc.Texture2D;i.initWithElement(e),i.handleLoadedTexture(),this.setTexture(i),e=this.getRect(),this.setRect(cc.rect(0,0,e.width,e.height))}e=this._rect,0===e.width&&0===e.height&&(e=t.width,t=t.height,this._rect.width=e,this._rect.height=t,this._rectInPixels=cc.rectPointsToPixels(this._rect),this._originalSizeInPixels.width=this._rectInPixels.width,this._originalSizeInPixels.height=this._rectInPixels.height,this._originalSize.width=e,this._originalSize.height=t),this.dispatchEvent("load")},this)}},getOffset:function(){return cc.p(this._offset)},setOffset:function(t){this._offset.x=t.x,this._offset.y=t.y},clone:function(){var t=new cc.SpriteFrame;return t.initWithTexture(this._textureFilename,this._rectInPixels,this._rotated,this._offsetInPixels,this._originalSizeInPixels),t.setTexture(this._texture),t},copyWithZone:function(){var t=new cc.SpriteFrame;return t.initWithTexture(this._textureFilename,this._rectInPixels,this._rotated,this._offsetInPixels,this._originalSizeInPixels),t.setTexture(this._texture),t},copy:function(){return this.copyWithZone()},initWithTexture:function(t,e,i,n,r){if(2===arguments.length&&(e=cc.rectPointsToPixels(e)),n=n||cc.p(0,0),r=r||e,i=i||!1,cc.isString(t)?(this._texture=null,this._textureFilename=t):t instanceof cc.Texture2D&&this.setTexture(t),t=this.getTexture(),this._rectInPixels=e,e=this._rect=cc.rectPixelsToPoints(e),t&&t.url&&t.isLoaded()){var o,s;i?(o=e.x+e.height,s=e.y+e.width):(o=e.x+e.width,s=e.y+e.height),o>t.getPixelsWide()&&cc.error(cc._LogInfos.RectWidth,t.url),s>t.getPixelsHigh()&&cc.error(cc._LogInfos.RectHeight,t.url)}return this._offsetInPixels.x=n.x,this._offsetInPixels.y=n.y,cc._pointPixelsToPointsOut(n,this._offset),this._originalSizeInPixels.width=r.width,this._originalSizeInPixels.height=r.height,cc._sizePixelsToPointsOut(r,this._originalSize),this._rotated=i,!0}}),cc.EventHelper.prototype.apply(cc.SpriteFrame.prototype),cc.SpriteFrame.create=function(t,e,i,n,r){return new cc.SpriteFrame(t,e,i,n,r)},cc.SpriteFrame.createWithTexture=cc.SpriteFrame.create,cc.SpriteFrame._frameWithTextureForCanvas=function(t,e,i,n,r){var o=new cc.SpriteFrame;return o._texture=t,o._rectInPixels=e,o._rect=cc.rectPixelsToPoints(e),o._offsetInPixels.x=n.x,o._offsetInPixels.y=n.y,cc._pointPixelsToPointsOut(o._offsetInPixels,o._offset),o._originalSizeInPixels.width=r.width,o._originalSizeInPixels.height=r.height,cc._sizePixelsToPointsOut(o._originalSizeInPixels,o._originalSize),o._rotated=i,o},cc.spriteFrameCache={_CCNS_REG1:/^\s*\{\s*([\-]?\d+[.]?\d*)\s*,\s*([\-]?\d+[.]?\d*)\s*\}\s*$/,_CCNS_REG2:/^\s*\{\s*\{\s*([\-]?\d+[.]?\d*)\s*,\s*([\-]?\d+[.]?\d*)\s*\}\s*,\s*\{\s*([\-]?\d+[.]?\d*)\s*,\s*([\-]?\d+[.]?\d*)\s*\}\s*\}\s*$/,_spriteFrames:{},_spriteFramesAliases:{},_frameConfigCache:{},_rectFromString:function(t){return(t=this._CCNS_REG2.exec(t))?cc.rect(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3]),parseFloat(t[4])):cc.rect(0,0,0,0)},_pointFromString:function(t){return(t=this._CCNS_REG1.exec(t))?cc.p(parseFloat(t[1]),parseFloat(t[2])):cc.p(0,0)},_sizeFromString:function(t){return(t=this._CCNS_REG1.exec(t))?cc.size(parseFloat(t[1]),parseFloat(t[2])):cc.size(0,0)},_getFrameConfig:function(t){var e=cc.loader.getRes(t);return cc.assert(e,cc._LogInfos.spriteFrameCache__getFrameConfig_2,t),cc.loader.release(t),e._inited?this._frameConfigCache[t]=e:(this._frameConfigCache[t]=this._parseFrameConfig(e),this._frameConfigCache[t])},_getFrameConfigByJsonObject:function(t,e){return cc.assert(e,cc._LogInfos.spriteFrameCache__getFrameConfig_2,t),this._frameConfigCache[t]=this._parseFrameConfig(e),this._frameConfigCache[t]},_parseFrameConfig:function(t){var e=t.frames,i=t.metadata||t.meta;t={};var n={},r=0;i&&(r=i.format,r=1>=r.length?parseInt(r):r,n.image=i.textureFileName||i.textureFileName||i.image);for(var o in e){var s=e[o];if(s){if(i={},0==r){i.rect=cc.rect(s.x,s.y,s.width,s.height),i.rotated=!1,i.offset=cc.p(s.offsetX,s.offsetY);var c=s.originalWidth,s=s.originalHeight;c&&s||cc.log(cc._LogInfos.spriteFrameCache__getFrameConfig),c=Math.abs(c),s=Math.abs(s),i.size=cc.size(c,s)}else if(1==r||2==r)i.rect=this._rectFromString(s.frame),i.rotated=s.rotated||!1,i.offset=this._pointFromString(s.offset),i.size=this._sizeFromString(s.sourceSize);else if(3==r){var c=this._sizeFromString(s.spriteSize),a=this._rectFromString(s.textureRect);c&&(a=cc.rect(a.x,a.y,c.width,c.height)),i.rect=a,i.rotated=s.textureRotated||!1,i.offset=this._pointFromString(s.spriteOffset),i.size=this._sizeFromString(s.spriteSourceSize),i.aliases=s.aliases}else c=s.frame,a=s.sourceSize,o=s.filename||o,i.rect=cc.rect(c.x,c.y,c.w,c.h),i.rotated=s.rotated||!1,i.offset=cc.p(0,0),i.size=cc.size(a.w,a.h);t[o]=i}}return{_inited:!0,frames:t,meta:n}},_addSpriteFramesByObject:function(t,e,i){cc.assert(t,cc._LogInfos.spriteFrameCache_addSpriteFrames_2),e&&e.frames&&(e=this._frameConfigCache[t]||this._getFrameConfigByJsonObject(t,e),this._createSpriteFrames(t,e,i))},_createSpriteFrames:function(t,e,i){var n=e.frames;e=e.meta,i?i instanceof cc.Texture2D||(cc.isString(i)?i=cc.textureCache.addImage(i):cc.assert(0,cc._LogInfos.spriteFrameCache_addSpriteFrames_3)):(i=cc.path.changeBasename(t,e.image||".png"),i=cc.textureCache.addImage(i)),t=this._spriteFramesAliases,e=this._spriteFrames;for(var r in n){var o=n[r],s=e[r];if(!s){if(s=new cc.SpriteFrame(i,o.rect,o.rotated,o.offset,o.size),o=o.aliases)for(var c=0,a=o.length;a>c;c++){var l=o[c];t[l]&&cc.log(cc._LogInfos.spriteFrameCache_addSpriteFrames,l),t[l]=r}cc._renderType===cc._RENDER_TYPE_CANVAS&&s.isRotated()&&s.getTexture().isLoaded()&&(o=s.getTexture().getHtmlElementObj(),o=cc.Sprite.CanvasRenderCmd._cutRotateImageToCanvas(o,s.getRectInPixels()),c=new cc.Texture2D,c.initWithElement(o),c.handleLoadedTexture(),s.setTexture(c),o=s._rect,s.setRect(cc.rect(0,0,o.width,o.height))),e[r]=s}}},addSpriteFrames:function(t,e){cc.assert(t,cc._LogInfos.spriteFrameCache_addSpriteFrames_2);var i=this._frameConfigCache[t]||cc.loader.getRes(t);i&&i.frames&&(i=this._frameConfigCache[t]||this._getFrameConfig(t),this._createSpriteFrames(t,i,e))},_checkConflict:function(t){t=t.frames;for(var e in t)this._spriteFrames[e]&&cc.log(cc._LogInfos.spriteFrameCache__checkConflict,e)},addSpriteFrame:function(t,e){this._spriteFrames[e]=t},removeSpriteFrames:function(){this._spriteFrames={},this._spriteFramesAliases={}},removeSpriteFrameByName:function(t){t&&(this._spriteFramesAliases[t]&&delete this._spriteFramesAliases[t],this._spriteFrames[t]&&delete this._spriteFrames[t])},removeSpriteFramesFromFile:function(t){var e=this._spriteFrames,i=this._spriteFramesAliases;if(t=this._frameConfigCache[t]){t=t.frames;for(var n in t)if(e[n]){delete e[n];for(var r in i)i[r]===n&&delete i[r]}}},removeSpriteFramesFromTexture:function(t){var e,i=this._spriteFrames,n=this._spriteFramesAliases;for(e in i){var r=i[e];if(r&&r.getTexture()===t){delete i[e];for(var o in n)n[o]===e&&delete n[o]}}},getSpriteFrame:function(t){var e=this._spriteFrames[t];if(!e){var i=this._spriteFramesAliases[t];i&&((e=this._spriteFrames[i.toString()])||delete this._spriteFramesAliases[t])}return e},_clear:function(){this._spriteFrames={},this._spriteFramesAliases={},this._frameConfigCache={}}},cc.configuration={ERROR:0,STRING:1,INT:2,DOUBLE:3,BOOLEAN:4,_maxTextureSize:0,_maxModelviewStackDepth:0,_supportsPVRTC:!1,_supportsNPOT:!1,_supportsBGRA8888:!1,_supportsDiscardFramebuffer:!1,_supportsShareableVAO:!1,_maxSamplesAllowed:0,_maxTextureUnits:0,_GlExtensions:"",_valueDict:{},_inited:!1,_init:function(){var t=this._valueDict;t["cocos2d.x.version"]=cc.ENGINE_VERSION,t["cocos2d.x.compiled_with_profiler"]=!1,t["cocos2d.x.compiled_with_gl_state_cache"]=cc.ENABLE_GL_STATE_CACHE,this._inited=!0},getMaxTextureSize:function(){return this._maxTextureSize},getMaxModelviewStackDepth:function(){return this._maxModelviewStackDepth},getMaxTextureUnits:function(){return this._maxTextureUnits},supportsNPOT:function(){return this._supportsNPOT},supportsPVRTC:function(){return this._supportsPVRTC},supportsETC:function(){return!1},supportsS3TC:function(){return!1},supportsATITC:function(){return!1},supportsBGRA8888:function(){return this._supportsBGRA8888},supportsDiscardFramebuffer:function(){return this._supportsDiscardFramebuffer},supportsShareableVAO:function(){return this._supportsShareableVAO},checkForGLExtension:function(t){return-1<this._GlExtensions.indexOf(t)},getValue:function(t,e){this._inited||this._init();var i=this._valueDict;return i[t]?i[t]:e},setValue:function(t,e){this._valueDict[t]=e},dumpInfo:function(){0===cc.ENABLE_GL_STATE_CACHE&&(cc.log(""),cc.log(cc._LogInfos.configuration_dumpInfo),cc.log(""))},gatherGPUInfo:function(){if(cc._renderType!==cc._RENDER_TYPE_CANVAS){this._inited||this._init();var t=cc._renderContext,e=this._valueDict;e["gl.vendor"]=t.getParameter(t.VENDOR),e["gl.renderer"]=t.getParameter(t.RENDERER),e["gl.version"]=t.getParameter(t.VERSION),this._GlExtensions="";for(var i=t.getSupportedExtensions(),n=0;n<i.length;n++)this._GlExtensions+=i[n]+" ";this._maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),e["gl.max_texture_size"]=this._maxTextureSize,this._maxTextureUnits=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS),e["gl.max_texture_units"]=this._maxTextureUnits,this._supportsPVRTC=this.checkForGLExtension("GL_IMG_texture_compression_pvrtc"),e["gl.supports_PVRTC"]=this._supportsPVRTC,this._supportsNPOT=!1,e["gl.supports_NPOT"]=this._supportsNPOT,this._supportsBGRA8888=this.checkForGLExtension("GL_IMG_texture_format_BGRA888"),e["gl.supports_BGRA8888"]=this._supportsBGRA8888,this._supportsDiscardFramebuffer=this.checkForGLExtension("GL_EXT_discard_framebuffer"),e["gl.supports_discard_framebuffer"]=this._supportsDiscardFramebuffer,this._supportsShareableVAO=this.checkForGLExtension("vertex_array_object"),e["gl.supports_vertex_array_object"]=this._supportsShareableVAO,cc.checkGLErrorDebug()}},loadConfigFile:function(t){this._inited||this._init();var e=cc.loader.getRes(t);if(!e)throw"Please load the resource first : "+t;if(cc.assert(e,cc._LogInfos.configuration_loadConfigFile_2,t),e=e.data)for(var i in e)this._valueDict[i]=e[i];else cc.log(cc._LogInfos.configuration_loadConfigFile,t)}},cc.g_NumberOfDraws=0,cc.GLToClipTransform=function(t){cc.kmGLGetMatrix(cc.KM_GL_PROJECTION,t);var e=new cc.math.Matrix4;cc.kmGLGetMatrix(cc.KM_GL_MODELVIEW,e),t.multiply(e)},cc.Director=cc.Class.extend({_landscape:!1,_nextDeltaTimeZero:!1,_paused:!1,_purgeDirectorInNextLoop:!1,_sendCleanupToScene:!1,_animationInterval:0,_oldAnimationInterval:0,_projection:0,_accumDt:0,_contentScaleFactor:1,_displayStats:!1,_deltaTime:0,_frameRate:0,_FPSLabel:null,_SPFLabel:null,_drawsLabel:null,_winSizeInPoints:null,_lastUpdate:null,_nextScene:null,_notificationNode:null,_openGLView:null,_scenesStack:null,_projectionDelegate:null,_runningScene:null,_frames:0,_totalFrames:0,_secondsPerFrame:0,_dirtyRegion:null,_scheduler:null,_actionManager:null,_eventProjectionChanged:null,_eventAfterDraw:null,_eventAfterVisit:null,_eventAfterUpdate:null,ctor:function(){var t=this;t._lastUpdate=Date.now(),cc.eventManager.addCustomListener(cc.game.EVENT_SHOW,function(){t._lastUpdate=Date.now()})},init:function(){return this._oldAnimationInterval=this._animationInterval=1/cc.defaultFPS,this._scenesStack=[],this._projection=cc.Director.PROJECTION_DEFAULT,this._projectionDelegate=null,this._frameRate=this._accumDt=0,this._displayStats=!1,this._totalFrames=this._frames=0,this._lastUpdate=Date.now(),this._purgeDirectorInNextLoop=this._paused=!1,this._winSizeInPoints=cc.size(0,0),this._openGLView=null,this._contentScaleFactor=1,this._scheduler=new cc.Scheduler,cc.ActionManager?(this._actionManager=new cc.ActionManager,this._scheduler.scheduleUpdate(this._actionManager,cc.Scheduler.PRIORITY_SYSTEM,!1)):this._actionManager=null,this._eventAfterDraw=new cc.EventCustom(cc.Director.EVENT_AFTER_DRAW),this._eventAfterDraw.setUserData(this),this._eventAfterVisit=new cc.EventCustom(cc.Director.EVENT_AFTER_VISIT),this._eventAfterVisit.setUserData(this),this._eventAfterUpdate=new cc.EventCustom(cc.Director.EVENT_AFTER_UPDATE),this._eventAfterUpdate.setUserData(this),this._eventProjectionChanged=new cc.EventCustom(cc.Director.EVENT_PROJECTION_CHANGED),this._eventProjectionChanged.setUserData(this),!0},calculateDeltaTime:function(){var t=Date.now();this._nextDeltaTimeZero?(this._deltaTime=0,this._nextDeltaTimeZero=!1):this._deltaTime=(t-this._lastUpdate)/1e3,0<cc.game.config[cc.game.CONFIG_KEY.debugMode]&&.2<this._deltaTime&&(this._deltaTime=1/60),this._lastUpdate=t},convertToGL:null,convertToUI:null,drawScene:function(){var t=cc.renderer;this.calculateDeltaTime(),this._paused||(this._scheduler.update(this._deltaTime),cc.eventManager.dispatchEvent(this._eventAfterUpdate)),this._clear(),this._nextScene&&this.setNextScene(),this._beforeVisitScene&&this._beforeVisitScene(),this._runningScene&&(!0===t.childrenOrderDirty?(cc.renderer.clearRenderCommands(),this._runningScene._renderCmd._curLevel=0,this._runningScene.visit(),t.resetFlag()):!0===t.transformDirty()&&t.transform(),cc.eventManager.dispatchEvent(this._eventAfterVisit)),this._notificationNode&&this._notificationNode.visit(),this._displayStats&&this._showStats(),this._afterVisitScene&&this._afterVisitScene(),t.rendering(cc._renderContext),cc.eventManager.dispatchEvent(this._eventAfterDraw),this._totalFrames++,this._displayStats&&this._calculateMPF()},_beforeVisitScene:null,_afterVisitScene:null,end:function(){this._purgeDirectorInNextLoop=!0},getContentScaleFactor:function(){return this._contentScaleFactor},getNotificationNode:function(){return this._notificationNode},getWinSize:function(){return cc.size(this._winSizeInPoints)},getWinSizeInPixels:function(){return cc.size(this._winSizeInPoints.width*this._contentScaleFactor,this._winSizeInPoints.height*this._contentScaleFactor)},getVisibleSize:null,getVisibleOrigin:null,getZEye:null,pause:function(){this._paused||(this._oldAnimationInterval=this._animationInterval,this.setAnimationInterval(.25),this._paused=!0)},popScene:function(){cc.assert(this._runningScene,cc._LogInfos.Director_popScene),this._scenesStack.pop();var t=this._scenesStack.length;0===t?this.end():(this._sendCleanupToScene=!0,this._nextScene=this._scenesStack[t-1])},purgeCachedData:function(){cc.animationCache._clear(),cc.spriteFrameCache._clear(),cc.textureCache._clear()},purgeDirector:function(){this.getScheduler().unscheduleAll(),cc.eventManager&&cc.eventManager.setEnabled(!1),this._runningScene&&(this._runningScene.onExitTransitionDidStart(),this._runningScene.onExit(),this._runningScene.cleanup()),this._nextScene=this._runningScene=null,this._scenesStack.length=0,this.stopAnimation(),this.purgeCachedData(),cc.checkGLErrorDebug()},pushScene:function(t){cc.assert(t,cc._LogInfos.Director_pushScene),this._sendCleanupToScene=!1,this._scenesStack.push(t),this._nextScene=t},runScene:function(t){if(cc.assert(t,cc._LogInfos.Director_pushScene),this._runningScene){var e=this._scenesStack.length;0===e?(this._sendCleanupToScene=!0,this._scenesStack[e]=t):(this._sendCleanupToScene=!0,this._scenesStack[e-1]=t),this._nextScene=t}else this.pushScene(t),this.startAnimation()},resume:function(){this._paused&&(this.setAnimationInterval(this._oldAnimationInterval),(this._lastUpdate=Date.now())||cc.log(cc._LogInfos.Director_resume),this._paused=!1,this._deltaTime=0)},setContentScaleFactor:function(t){t!==this._contentScaleFactor&&(this._contentScaleFactor=t,this._createStatsLabel())},setDepthTest:null,setDefaultValues:function(){},setNextDeltaTimeZero:function(t){this._nextDeltaTimeZero=t},setNextScene:function(){var t=!1,e=!1;cc.TransitionScene&&(t=this._runningScene?this._runningScene instanceof cc.TransitionScene:!1,e=this._nextScene?this._nextScene instanceof cc.TransitionScene:!1),e||((e=this._runningScene)&&(e.onExitTransitionDidStart(),e.onExit()),this._sendCleanupToScene&&e&&e.cleanup()),this._runningScene=this._nextScene,cc.renderer.childrenOrderDirty=!0,this._nextScene=null,t||null===this._runningScene||(this._runningScene.onEnter(),this._runningScene.onEnterTransitionDidFinish())},setNotificationNode:function(t){this._notificationNode=t},getDelegate:function(){return this._projectionDelegate},setDelegate:function(t){this._projectionDelegate=t},setOpenGLView:null,setProjection:null,setViewport:null,getOpenGLView:null,getProjection:null,setAlphaBlending:null,_showStats:function(){this._frames++,this._accumDt+=this._deltaTime,this._FPSLabel&&this._SPFLabel&&this._drawsLabel?(this._accumDt>cc.DIRECTOR_FPS_INTERVAL&&(this._SPFLabel.string=this._secondsPerFrame.toFixed(3),this._frameRate=this._frames/this._accumDt,this._accumDt=this._frames=0,this._FPSLabel.string=this._frameRate.toFixed(1),this._drawsLabel.string=(0|cc.g_NumberOfDraws).toString()),this._FPSLabel.visit(),this._SPFLabel.visit(),this._drawsLabel.visit()):this._createStatsLabel(),cc.g_NumberOfDraws=0},isSendCleanupToScene:function(){return this._sendCleanupToScene},getRunningScene:function(){return this._runningScene},getAnimationInterval:function(){return this._animationInterval},isDisplayStats:function(){return this._displayStats},setDisplayStats:function(t){this._displayStats=t},getSecondsPerFrame:function(){return this._secondsPerFrame},isNextDeltaTimeZero:function(){return this._nextDeltaTimeZero},isPaused:function(){return this._paused},getTotalFrames:function(){return this._totalFrames},popToRootScene:function(){this.popToSceneStackLevel(1)},popToSceneStackLevel:function(t){cc.assert(this._runningScene,cc._LogInfos.Director_popToSceneStackLevel_2);var e=this._scenesStack,i=e.length;if(0===i)this.end();else if(!(t>i)){for(;i>t;){var n=e.pop();n.running&&(n.onExitTransitionDidStart(),n.onExit()),n.cleanup(),i--}this._nextScene=e[e.length-1],this._sendCleanupToScene=!1}},getScheduler:function(){return this._scheduler},setScheduler:function(t){this._scheduler!==t&&(this._scheduler=t)},getActionManager:function(){return this._actionManager},setActionManager:function(t){this._actionManager!==t&&(this._actionManager=t)},getDeltaTime:function(){return this._deltaTime},_createStatsLabel:null,_calculateMPF:function(){this._secondsPerFrame=(Date.now()-this._lastUpdate)/1e3}}),cc.Director.EVENT_PROJECTION_CHANGED="director_projection_changed",cc.Director.EVENT_AFTER_DRAW="director_after_draw",cc.Director.EVENT_AFTER_VISIT="director_after_visit",cc.Director.EVENT_AFTER_UPDATE="director_after_update",cc.DisplayLinkDirector=cc.Director.extend({invalid:!1,startAnimation:function(){this._nextDeltaTimeZero=!0,this.invalid=!1},mainLoop:function(){this._purgeDirectorInNextLoop?(this._purgeDirectorInNextLoop=!1,this.purgeDirector()):this.invalid||this.drawScene()},stopAnimation:function(){this.invalid=!0},setAnimationInterval:function(t){this._animationInterval=t,this.invalid||(this.stopAnimation(),this.startAnimation())}}),cc.Director.sharedDirector=null,cc.Director.firstUseDirector=!0,cc.Director._getInstance=function(){return cc.Director.firstUseDirector&&(cc.Director.firstUseDirector=!1,cc.Director.sharedDirector=new cc.DisplayLinkDirector,cc.Director.sharedDirector.init()),cc.Director.sharedDirector},cc.defaultFPS=60,cc.Director.PROJECTION_2D=0,cc.Director.PROJECTION_3D=1,cc.Director.PROJECTION_CUSTOM=3,cc.Director.PROJECTION_DEFAULT=cc.Director.PROJECTION_3D,cc._renderType===cc._RENDER_TYPE_CANVAS?(_p=cc.Director.prototype,_p.setProjection=function(t){this._projection=t,cc.eventManager.dispatchEvent(this._eventProjectionChanged)},_p.setDepthTest=function(){},_p.setOpenGLView=function(t){this._winSizeInPoints.width=cc._canvas.width,this._winSizeInPoints.height=cc._canvas.height,this._openGLView=t||cc.view,cc.eventManager&&cc.eventManager.setEnabled(!0)},_p._clear=function(){var t=this._openGLView.getViewPortRect(),e=cc._renderContext.getContext();e.setTransform(1,0,0,1,0,0),e.clearRect(-t.x,t.y,t.width,t.height)},_p._createStatsLabel=function(){var t=0,t=this._winSizeInPoints.width>this._winSizeInPoints.height?0|this._winSizeInPoints.height/320*24:0|this._winSizeInPoints.width/320*24;this._FPSLabel=new cc.LabelTTF("000.0","Arial",t),this._SPFLabel=new cc.LabelTTF("0.000","Arial",t),this._drawsLabel=new cc.LabelTTF("0000","Arial",t),t=cc.DIRECTOR_STATS_POSITION,this._drawsLabel.setPosition(this._drawsLabel.width/2+t.x,5*this._drawsLabel.height/2+t.y),this._SPFLabel.setPosition(this._SPFLabel.width/2+t.x,3*this._SPFLabel.height/2+t.y),this._FPSLabel.setPosition(this._FPSLabel.width/2+t.x,this._FPSLabel.height/2+t.y)},_p.getVisibleSize=function(){return this.getWinSize()},_p.getVisibleOrigin=function(){return cc.p(0,0)}):(cc.Director._fpsImage=new Image,cc._addEventListener(cc.Director._fpsImage,"load",function(){cc.Director._fpsImageLoaded=!0}),cc._fpsImage&&(cc.Director._fpsImage.src=cc._fpsImage)),cc._renderType===cc._RENDER_TYPE_WEBGL&&function(){cc.DirectorDelegate=cc.Class.extend({updateProjection:function(){}});var t=cc.Director.prototype;t.setProjection=function(t){var e=this._winSizeInPoints;this.setViewport();var i=this._openGLView,n=i._viewPortRect.x/i._scaleX,r=i._viewPortRect.y/i._scaleY;switch(t){case cc.Director.PROJECTION_2D:cc.kmGLMatrixMode(cc.KM_GL_PROJECTION),cc.kmGLLoadIdentity(),i=cc.math.Matrix4.createOrthographicProjection(-n,e.width-n,-r,e.height-r,-1024,1024),cc.kmGLMultMatrix(i),cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW),cc.kmGLLoadIdentity();break;case cc.Director.PROJECTION_3D:var o=this.getZEye(),s=new cc.math.Matrix4,i=new cc.math.Matrix4;cc.kmGLMatrixMode(cc.KM_GL_PROJECTION),cc.kmGLLoadIdentity(),s=cc.math.Matrix4.createPerspectiveProjection(60,e.width/e.height,.1,2*o),cc.kmGLMultMatrix(s),cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW),cc.kmGLLoadIdentity(),o=new cc.math.Vec3(-n+e.width/2,-r+e.height/2,o),e=new cc.math.Vec3(-n+e.width/2,-r+e.height/2,0),n=new cc.math.Vec3(0,1,0),i.lookAt(o,e,n),cc.kmGLMultMatrix(i);break;case cc.Director.PROJECTION_CUSTOM:this._projectionDelegate&&this._projectionDelegate.updateProjection();break;default:cc.log(cc._LogInfos.Director_setProjection)}this._projection=t,cc.eventManager.dispatchEvent(this._eventProjectionChanged),cc.setProjectionMatrixDirty(),cc.renderer.childrenOrderDirty=!0},t.setDepthTest=function(t){var e=cc._renderContext;t?(e.clearDepth(1),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL)):e.disable(e.DEPTH_TEST)},t.setOpenGLView=function(t){this._winSizeInPoints.width=cc._canvas.width,this._winSizeInPoints.height=cc._canvas.height,this._openGLView=t||cc.view,t=cc.configuration,t.gatherGPUInfo(),t.dumpInfo(),this._createStatsLabel(),this.setGLDefaultValues(),cc.eventManager&&cc.eventManager.setEnabled(!0)},t._clear=function(){var t=cc._renderContext;t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)},t._beforeVisitScene=function(){cc.kmGLPushMatrix()},t._afterVisitScene=function(){cc.kmGLPopMatrix()
},t._createStatsLabel=function(){if(cc.LabelAtlas){if(null!=cc.Director._fpsImageLoaded&&!1!==cc.Director._fpsImageLoaded){var t=new cc.Texture2D;t.initWithElement(cc.Director._fpsImage),t.handleLoadedTexture();var e=cc.view.getDesignResolutionSize().height/320;0===e&&(e=this._winSizeInPoints.height/320);var i=new cc.LabelAtlas;i._setIgnoreContentScaleFactor(!0),i.initWithString("00.0",t,12,32,"."),i.scale=e,this._FPSLabel=i,i=new cc.LabelAtlas,i._setIgnoreContentScaleFactor(!0),i.initWithString("0.000",t,12,32,"."),i.scale=e,this._SPFLabel=i,i=new cc.LabelAtlas,i._setIgnoreContentScaleFactor(!0),i.initWithString("000",t,12,32,"."),i.scale=e,this._drawsLabel=i,t=cc.DIRECTOR_STATS_POSITION,this._drawsLabel.setPosition(t.x,34*e+t.y),this._SPFLabel.setPosition(t.x,17*e+t.y),this._FPSLabel.setPosition(t)}}else this._createStatsLabelForCanvas()},t._createStatsLabelForCanvas=function(){var t=0,t=this._winSizeInPoints.width>this._winSizeInPoints.height?0|this._winSizeInPoints.height/320*24:0|this._winSizeInPoints.width/320*24;this._FPSLabel=new cc.LabelTTF("000.0","Arial",t),this._SPFLabel=new cc.LabelTTF("0.000","Arial",t),this._drawsLabel=new cc.LabelTTF("0000","Arial",t),t=cc.DIRECTOR_STATS_POSITION,this._drawsLabel.setPosition(this._drawsLabel.width/2+t.x,5*this._drawsLabel.height/2+t.y),this._SPFLabel.setPosition(this._SPFLabel.width/2+t.x,3*this._SPFLabel.height/2+t.y),this._FPSLabel.setPosition(this._FPSLabel.width/2+t.x,this._FPSLabel.height/2+t.y)},t.convertToGL=function(t){var e=new cc.math.Matrix4;cc.GLToClipTransform(e);var i=e.inverse(),e=e.mat[14]/e.mat[15],n=this._openGLView.getDesignResolutionSize();return t=new cc.math.Vec3(2*t.x/n.width-1,1-2*t.y/n.height,e),t.transformCoord(i),cc.p(t.x,t.y)},t.convertToUI=function(t){var e=new cc.math.Matrix4;return cc.GLToClipTransform(e),t=new cc.math.Vec3(t.x,t.y,0),t.transformCoord(e),e=this._openGLView.getDesignResolutionSize(),cc.p(e.width*(.5*t.x+.5),e.height*(.5*-t.y+.5))},t.getVisibleSize=function(){return this._openGLView.getVisibleSize()},t.getVisibleOrigin=function(){return this._openGLView.getVisibleOrigin()},t.getZEye=function(){return this._winSizeInPoints.height/1.1566},t.setViewport=function(){var t=this._openGLView;if(t){var e=this._winSizeInPoints;t.setViewPortInPoints(-t._viewPortRect.x/t._scaleX,-t._viewPortRect.y/t._scaleY,e.width,e.height)}},t.getOpenGLView=function(){return this._openGLView},t.getProjection=function(){return this._projection},t.setAlphaBlending=function(t){t?cc.glBlendFunc(cc.BLEND_SRC,cc.BLEND_DST):cc.glBlendFunc(cc._renderContext.ONE,cc._renderContext.ZERO)},t.setGLDefaultValues=function(){this.setAlphaBlending(!0),this.setDepthTest(!1),this.setProjection(this._projection),cc._renderContext.clearColor(0,0,0,1)}}(),cc.Camera=cc.Class.extend({_eyeX:null,_eyeY:null,_eyeZ:null,_centerX:null,_centerY:null,_centerZ:null,_upX:null,_upY:null,_upZ:null,_dirty:!1,_lookupMatrix:null,ctor:function(){this._lookupMatrix=new cc.math.Matrix4,this.restore()},description:function(){return"<CCCamera | center =("+this._centerX+","+this._centerY+","+this._centerZ+")>"},setDirty:function(t){this._dirty=t},isDirty:function(){return this._dirty},restore:function(){this._eyeX=this._eyeY=0,this._eyeZ=cc.Camera.getZEye(),this._upX=this._centerX=this._centerY=this._centerZ=0,this._upY=1,this._upZ=0,this._lookupMatrix.identity(),this._dirty=!1},locate:function(){if(this._dirty){var t=new cc.math.Vec3(this._eyeX,this._eyeY,this._eyeZ),e=new cc.math.Vec3(this._centerX,this._centerY,this._centerZ),i=new cc.math.Vec3(this._upX,this._upY,this._upZ);this._lookupMatrix.lookAt(t,e,i),this._dirty=!1}cc.kmGLMultMatrix(this._lookupMatrix)},_locateForRenderer:function(t){if(this._dirty){var e=new cc.math.Vec3(this._eyeX,this._eyeY,this._eyeZ),i=new cc.math.Vec3(this._centerX,this._centerY,this._centerZ),n=new cc.math.Vec3(this._upX,this._upY,this._upZ);this._lookupMatrix.lookAt(e,i,n),this._dirty=!1}t.multiply(this._lookupMatrix)},setEyeXYZ:function(t,e,i){this.setEye(t,e,i)},setEye:function(t,e,i){this._eyeX=t,this._eyeY=e,this._eyeZ=i,this._dirty=!0},setCenterXYZ:function(t,e,i){this.setCenter(t,e,i)},setCenter:function(t,e,i){this._centerX=t,this._centerY=e,this._centerZ=i,this._dirty=!0},setUpXYZ:function(t,e,i){this.setUp(t,e,i)},setUp:function(t,e,i){this._upX=t,this._upY=e,this._upZ=i,this._dirty=!0},getEyeXYZ:function(){return{x:this._eyeX,y:this._eyeY,z:this._eyeZ}},getEye:function(){return{x:this._eyeX,y:this._eyeY,z:this._eyeZ}},getCenterXYZ:function(){return{x:this._centerX,y:this._centerY,z:this._centerZ}},getCenter:function(){return{x:this._centerX,y:this._centerY,z:this._centerZ}},getUpXYZ:function(){return{x:this._upX,y:this._upY,z:this._upZ}},getUp:function(){return{x:this._upX,y:this._upY,z:this._upZ}},_DISALLOW_COPY_AND_ASSIGN:function(){}}),cc.Camera.getZEye=function(){return cc.FLT_EPSILON},cc.PRIORITY_NON_SYSTEM=cc.PRIORITY_SYSTEM+1,cc.ListEntry=function(t,e,i,n,r,o,s){this.prev=t,this.next=e,this.callback=i,this.target=n,this.priority=r,this.paused=o,this.markedForDeletion=s},cc.HashUpdateEntry=function(t,e,i,n,r){this.list=t,this.entry=e,this.target=i,this.callback=n,this.hh=r},cc.HashTimerEntry=cc.hashSelectorEntry=function(t,e,i,n,r,o,s){this.timers=t,this.target=e,this.timerIndex=i,this.currentTimer=n,this.currentTimerSalvaged=r,this.paused=o,this.hh=s},cc.Timer=cc.Class.extend({_scheduler:null,_elapsed:0,_runForever:!1,_useDelay:!1,_timesExecuted:0,_repeat:0,_delay:0,_interval:0,getInterval:function(){return this._interval},setInterval:function(t){this._interval=t},setupTimerWithInterval:function(t,e,i){this._elapsed=-1,this._interval=t,this._delay=i,this._useDelay=0<this._delay,this._repeat=e,this._runForever=this._repeat===cc.REPEAT_FOREVER},trigger:function(){return 0},cancel:function(){return 0},ctor:function(){this._scheduler=null,this._elapsed=-1,this._useDelay=this._runForever=!1,this._interval=this._delay=this._repeat=this._timesExecuted=0},update:function(t){-1===this._elapsed?this._timesExecuted=this._elapsed=0:(this._elapsed+=t,this._runForever&&!this._useDelay?this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0):(this._useDelay?this._elapsed>=this._delay&&(this.trigger(),this._elapsed-=this._delay,this._timesExecuted+=1,this._useDelay=!1):this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0,this._timesExecuted+=1),!this._runForever&&this._timesExecuted>this._repeat&&this.cancel()))}}),cc.TimerTargetSelector=cc.Timer.extend({_target:null,_selector:null,ctor:function(){this._selector=this._target=null},initWithSelector:function(t,e,i,n,r,o){return this._scheduler=t,this._target=i,this._selector=e,this.setupTimerWithInterval(n,r,o),!0},getSelector:function(){return this._selector},trigger:function(){this._target&&this._selector&&this._target.call(this._selector,this._elapsed)},cancel:function(){this._scheduler.unschedule(this._selector,this._target)}}),cc.TimerTargetCallback=cc.Timer.extend({_target:null,_callback:null,_key:null,ctor:function(){this._callback=this._target=null},initWithCallback:function(t,e,i,n,r,o,s){return this._scheduler=t,this._target=i,this._callback=e,this._key=n,this.setupTimerWithInterval(r,o,s),!0},getCallback:function(){return this._callback},getKey:function(){return this._key},trigger:function(){this._callback&&this._callback.call(this._target,this._elapsed)},cancel:function(){this._scheduler.unschedule(this._callback,this._target)}}),cc.Scheduler=cc.Class.extend({_timeScale:1,_updatesNegList:null,_updates0List:null,_updatesPosList:null,_hashForTimers:null,_arrayForTimers:null,_hashForUpdates:null,_currentTarget:null,_currentTargetSalvaged:!1,_updateHashLocked:!1,ctor:function(){this._timeScale=1,this._updatesNegList=[],this._updates0List=[],this._updatesPosList=[],this._hashForUpdates={},this._hashForTimers={},this._currentTarget=null,this._updateHashLocked=this._currentTargetSalvaged=!1,this._arrayForTimers=[]},_schedulePerFrame:function(t,e,i,n){var r=this._hashForUpdates[e.__instanceId];if(r&&r.entry){if(r.entry.priority===i)return r.entry.markedForDeletion=!1,void(r.entry.paused=n);if(this._updateHashLocked)return cc.log("warning: you CANNOT change update priority in scheduled function"),r.entry.markedForDeletion=!1,void(r.entry.paused=n);this.unscheduleUpdate(e)}0===i?this._appendIn(this._updates0List,t,e,n):0>i?this._priorityIn(this._updatesNegList,t,e,i,n):this._priorityIn(this._updatesPosList,t,e,i,n)},_removeHashElement:function(t){delete this._hashForTimers[t.target.__instanceId],cc.arrayRemoveObject(this._arrayForTimers,t),t.Timer=null,t.target=null},_removeUpdateFromHash:function(t){(t=this._hashForUpdates[t.target.__instanceId])&&(cc.arrayRemoveObject(t.list,t.entry),delete this._hashForUpdates[t.target.__instanceId],t.entry=null,t.target=null)},_priorityIn:function(t,e,i,n,r){if(e=new cc.ListEntry(null,null,e,i,n,r,!1),t){r=t.length-1;for(var o=0;r>=o&&!(n<t[o].priority);o++);t.splice(o,0,e)}else t=[],t.push(e);return this._hashForUpdates[i.__instanceId]=new cc.HashUpdateEntry(t,e,i,null),t},_appendIn:function(t,e,i,n){e=new cc.ListEntry(null,null,e,i,0,n,!1),t.push(e),this._hashForUpdates[i.__instanceId]=new cc.HashUpdateEntry(t,e,i,null,null)},setTimeScale:function(t){this._timeScale=t},getTimeScale:function(){return this._timeScale},update:function(t){this._updateHashLocked=!0,1!==this._timeScale&&(t*=this._timeScale);var e,i,n,r;for(e=0,i=this._updatesNegList,n=i.length;n>e;e++)r=i[e],r.paused||r.markedForDeletion||r.callback(t);for(e=0,i=this._updates0List,n=i.length;n>e;e++)r=i[e],r.paused||r.markedForDeletion||r.callback(t);for(e=0,i=this._updatesPosList,n=i.length;n>e;e++)r=i[e],r.paused||r.markedForDeletion||r.callback(t);for(n=this._arrayForTimers,e=0;e<n.length;e++){if(this._currentTarget=i=n[e],this._currentTargetSalvaged=!1,!i.paused)for(i.timerIndex=0;i.timerIndex<i.timers.length;++i.timerIndex)i.currentTimer=i.timers[i.timerIndex],i.currentTimerSalvaged=!1,i.currentTimer.update(t),i.currentTimer=null;this._currentTargetSalvaged&&0===this._currentTarget.timers.length&&this._removeHashElement(this._currentTarget)}for(e=0,i=this._updatesNegList;e<i.length;)r=i[e],r.markedForDeletion?this._removeUpdateFromHash(r):e++;for(e=0,i=this._updates0List;e<i.length;)r=i[e],r.markedForDeletion?this._removeUpdateFromHash(r):e++;for(e=0,i=this._updatesPosList;e<i.length;)r=i[e],r.markedForDeletion?this._removeUpdateFromHash(r):e++;this._updateHashLocked=!1,this._currentTarget=null},scheduleCallbackForTarget:function(t,e,i,n,r,o){this.schedule(e,t,i,n,r,o,t.__instanceId+"")},schedule:function(t,e,i,n,r,o,s){var c=!1;if("function"!=typeof t)var a=t,c=!0;!1===c?5===arguments.length&&(s=r,o=n,r=0,n=cc.REPEAT_FOREVER):4===arguments.length&&(o=n,n=cc.REPEAT_FOREVER,r=0),cc.assert(e,cc._LogInfos.Scheduler_scheduleCallbackForTarget_3),!1===c&&cc.assert(s,"key should not be empty!");var l=this._hashForTimers[e.__instanceId];l?cc.assert(l.paused===o,""):(l=new cc.HashTimerEntry(null,e,0,null,null,o,null),this._arrayForTimers.push(l),this._hashForTimers[e.__instanceId]=l);var h,u;if(null==l.timers)l.timers=[];else if(!1===c){for(u=0;u<l.timers.length;u++)if(h=l.timers[u],t===h._callback)return cc.log(cc._LogInfos.Scheduler_scheduleCallbackForTarget,h.getInterval().toFixed(4),i.toFixed(4)),void(h._interval=i)}else for(u=0;u<l.timers.length;++u)if((h=l.timers[u])&&a===h.getSelector())return cc.log("CCScheduler#scheduleSelector. Selector already scheduled. Updating interval from: %.4f to %.4f",h.getInterval(),i),void h.setInterval(i);!1===c?(h=new cc.TimerTargetCallback,h.initWithCallback(this,t,e,s,i,n,r)):(h=new cc.TimerTargetSelector,h.initWithSelector(this,a,e,i,n,r)),l.timers.push(h)},scheduleUpdate:function(t,e,i){this._schedulePerFrame(function(e){t.update(e)},t,e,i)},_getUnscheduleMark:function(t,e){switch(typeof t){case"number":case"string":return t===e.getKey();case"function":return t===e._callback;default:return t===e.getSelector()}},unschedule:function(t,e){if(e&&t){var i=this._hashForTimers[e.__instanceId];if(i)for(var n=i.timers,r=0,o=n.length;o>r;r++){var s=n[r];if(this._getUnscheduleMark(t,s)){s!==i.currentTimer||i.currentTimerSalvaged||(i.currentTimerSalvaged=!0),n.splice(r,1),i.timerIndex>=r&&i.timerIndex--,0===n.length&&(this._currentTarget===i?this._currentTargetSalvaged=!0:this._removeHashElement(i));break}}}},unscheduleUpdate:function(t){null!=t&&(t=this._hashForUpdates[t.__instanceId])&&(this._updateHashLocked?t.entry.markedForDeletion=!0:this._removeUpdateFromHash(t.entry))},unscheduleAllForTarget:function(t){if(null!=t){var e=this._hashForTimers[t.__instanceId];e&&(-1<e.timers.indexOf(e.currentTimer)&&!e.currentTimerSalvaged&&(e.currentTimerSalvaged=!0),e.timers.length=0,this._currentTarget===e?this._currentTargetSalvaged=!0:this._removeHashElement(e)),this.unscheduleUpdate(t)}},unscheduleAll:function(){this.unscheduleAllWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},unscheduleAllWithMinPriority:function(t){var e,i,n=this._arrayForTimers;for(e=n.length-1;e>=0;e--)i=n[e],this.unscheduleAllForTarget(i.target);if(n=0,0>t)for(e=0;e<this._updatesNegList.length;)n=this._updatesNegList.length,(i=this._updatesNegList[e])&&i.priority>=t&&this.unscheduleUpdate(i.target),n==this._updatesNegList.length&&e++;if(0>=t)for(e=0;e<this._updates0List.length;)n=this._updates0List.length,(i=this._updates0List[e])&&this.unscheduleUpdate(i.target),n==this._updates0List.length&&e++;for(e=0;e<this._updatesPosList.length;)n=this._updatesPosList.length,(i=this._updatesPosList[e])&&i.priority>=t&&this.unscheduleUpdate(i.target),n==this._updatesPosList.length&&e++},isScheduled:function(t,e){cc.assert(t,"Argument key must not be empty"),cc.assert(e,"Argument target must be non-nullptr");var i=this._hashForUpdates[e.__instanceId];if(!i)return!1;if(null!=i.timers)for(var i=i.timers,n=0;n<i.length;++n)if(t===i[n].getKey())return!0;return!1},pauseAllTargets:function(){return this.pauseAllTargetsWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},pauseAllTargetsWithMinPriority:function(t){var e,i,n,r=[],o=this._arrayForTimers;for(i=0,n=o.length;n>i;i++)(e=o[i])&&(e.paused=!0,r.push(e.target));if(0>t)for(i=0;i<this._updatesNegList.length;i++)(e=this._updatesNegList[i])&&e.priority>=t&&(e.paused=!0,r.push(e.target));if(0>=t)for(i=0;i<this._updates0List.length;i++)(e=this._updates0List[i])&&(e.paused=!0,r.push(e.target));for(i=0;i<this._updatesPosList.length;i++)(e=this._updatesPosList[i])&&e.priority>=t&&(e.paused=!0,r.push(e.target));return r},resumeTargets:function(t){if(t)for(var e=0;e<t.length;e++)this.resumeTarget(t[e])},pauseTarget:function(t){cc.assert(t,cc._LogInfos.Scheduler_pauseTarget);var e=this._hashForTimers[t.__instanceId];e&&(e.paused=!0),(t=this._hashForUpdates[t.__instanceId])&&(t.entry.paused=!0)},resumeTarget:function(t){cc.assert(t,cc._LogInfos.Scheduler_resumeTarget);var e=this._hashForTimers[t.__instanceId];e&&(e.paused=!1),(t=this._hashForUpdates[t.__instanceId])&&(t.entry.paused=!1)},isTargetPaused:function(t){cc.assert(t,cc._LogInfos.Scheduler_isTargetPaused);var e=this._hashForTimers[t.__instanceId];return e?e.paused:(t=this._hashForUpdates[t.__instanceId])?t.entry.paused:!1},scheduleUpdateForTarget:function(t,e,i){this.scheduleUpdate(t,e,i)},unscheduleCallbackForTarget:function(t,e){this.unschedule(e,t)},unscheduleUpdateForTarget:function(t){this.unscheduleUpdate(t)},unscheduleAllCallbacksForTarget:function(t){this.unschedule(t.__instanceId+"",t)},unscheduleAllCallbacks:function(){this.unscheduleAllWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},unscheduleAllCallbacksWithMinPriority:function(t){this.unscheduleAllWithMinPriority(t)}}),cc.Scheduler.PRIORITY_SYSTEM=-2147483648,cc.PI2=2*Math.PI,cc.DrawingPrimitiveCanvas=cc.Class.extend({_cacheArray:[],_renderContext:null,ctor:function(t){this._renderContext=t},drawPoint:function(t,e){e||(e=1);var i=cc.view.getScaleX(),n=cc.view.getScaleY(),n=cc.p(t.x*i,t.y*n),r=this._renderContext.getContext();r.beginPath(),r.arc(n.x,-n.y,e*i,0,2*Math.PI,!1),r.closePath(),r.fill()},drawPoints:function(t,e,i){if(null!=t){i||(i=1),e=this._renderContext.getContext();var n=cc.view.getScaleX(),r=cc.view.getScaleY();e.beginPath();for(var o=0,s=t.length;s>o;o++)e.arc(t[o].x*n,-t[o].y*r,i*n,0,2*Math.PI,!1);e.closePath(),e.fill()}},drawLine:function(t,e){var i=this._renderContext.getContext(),n=cc.view.getScaleX(),r=cc.view.getScaleY();i.beginPath(),i.moveTo(t.x*n,-t.y*r),i.lineTo(e.x*n,-e.y*r),i.closePath(),i.stroke()},drawRect:function(t,e){this.drawLine(cc.p(t.x,t.y),cc.p(e.x,t.y)),this.drawLine(cc.p(e.x,t.y),cc.p(e.x,e.y)),this.drawLine(cc.p(e.x,e.y),cc.p(t.x,e.y)),this.drawLine(cc.p(t.x,e.y),cc.p(t.x,t.y))},drawSolidRect:function(t,e,i){t=[t,cc.p(e.x,t.y),e,cc.p(t.x,e.y)],this.drawSolidPoly(t,4,i)},drawPoly:function(t,e,i,n){if(n=n||!1,null!=t){if(3>t.length)throw Error("Polygon's point must greater than 2");var r=t[0];e=this._renderContext.getContext();var o=cc.view.getScaleX(),s=cc.view.getScaleY();e.beginPath(),e.moveTo(r.x*o,-r.y*s);for(var r=1,c=t.length;c>r;r++)e.lineTo(t[r].x*o,-t[r].y*s);i&&e.closePath(),n?e.fill():e.stroke()}},drawSolidPoly:function(t,e,i){this.setDrawColor(i.r,i.g,i.b,i.a),this.drawPoly(t,e,!0,!0)},drawCircle:function(t,e,i,n,r){r=r||!1,n=this._renderContext.getContext();var o=cc.view.getScaleX(),s=cc.view.getScaleY();n.beginPath(),n.arc(0|t.x*o,0|-(t.y*s),e*o,-i,-(i-2*Math.PI),!1),r&&n.lineTo(0|t.x*o,0|-(t.y*s)),n.stroke()},drawQuadBezier:function(t,e,i,n){for(var r=this._cacheArray,o=r.length=0,s=0;n>s;s++){var c=Math.pow(1-o,2)*t.x+2*(1-o)*o*e.x+o*o*i.x,a=Math.pow(1-o,2)*t.y+2*(1-o)*o*e.y+o*o*i.y;r.push(cc.p(c,a)),o+=1/n}r.push(cc.p(i.x,i.y)),this.drawPoly(r,n+1,!1,!1)},drawCubicBezier:function(t,e,i,n,r){for(var o=this._cacheArray,s=o.length=0,c=0;r>c;c++){var a=Math.pow(1-s,3)*t.x+3*Math.pow(1-s,2)*s*e.x+3*(1-s)*s*s*i.x+s*s*s*n.x,l=Math.pow(1-s,3)*t.y+3*Math.pow(1-s,2)*s*e.y+3*(1-s)*s*s*i.y+s*s*s*n.y;o.push(cc.p(a,l)),s+=1/r}o.push(cc.p(n.x,n.y)),this.drawPoly(o,r+1,!1,!1)},drawCatmullRom:function(t,e){this.drawCardinalSpline(t,.5,e)},drawCardinalSpline:function(t,e,i){cc._renderContext.setStrokeStyle("rgba(255,255,255,1)");var n=this._cacheArray;n.length=0;for(var r,o,s=1/t.length,c=0;i+1>c;c++)o=c/i,1===o?(r=t.length-1,o=1):(r=0|o/s,o=(o-s*r)/s),r=cc.CardinalSplineAt(cc.getControlPointAt(t,r-1),cc.getControlPointAt(t,r-0),cc.getControlPointAt(t,r+1),cc.getControlPointAt(t,r+2),e,o),n.push(r);this.drawPoly(n,i+1,!1,!1)},drawImage:function(t,e,i,n,r){var o=arguments.length,s=this._renderContext.getContext();switch(o){case 2:s.drawImage(t,e.x,-(e.y+t.height));break;case 3:s.drawImage(t,e.x,-(e.y+i.height),i.width,i.height);break;case 5:s.drawImage(t,e.x,e.y,i.width,i.height,n.x,-(n.y+r.height),r.width,r.height);break;default:throw Error("Argument must be non-nil")}},drawStar:function(t,e,i){t=t||this._renderContext;var n=t.getContext();e*=cc.view.getScaleX(),i="rgba("+(0|i.r)+","+(0|i.g)+","+(0|i.b),t.setFillStyle(i+",1)");var r=e/10;n.beginPath(),n.moveTo(-e,e),n.lineTo(0,r),n.lineTo(e,e),n.lineTo(r,0),n.lineTo(e,-e),n.lineTo(0,-r),n.lineTo(-e,-e),n.lineTo(-r,0),n.lineTo(-e,e),n.closePath(),n.fill();var o=n.createRadialGradient(0,0,r,0,0,e);o.addColorStop(0,i+", 1)"),o.addColorStop(.3,i+", 0.8)"),o.addColorStop(1,i+", 0.0)"),t.setFillStyle(o),n.beginPath(),n.arc(0,0,e-r,0,cc.PI2,!1),n.closePath(),n.fill()},drawColorBall:function(t,e,i){t=t||this._renderContext;var n=t.getContext();e*=cc.view.getScaleX(),i="rgba("+(0|i.r)+","+(0|i.g)+","+(0|i.b);var r=n.createRadialGradient(0,0,e/10,0,0,e);r.addColorStop(0,i+", 1)"),r.addColorStop(.3,i+", 0.8)"),r.addColorStop(.6,i+", 0.4)"),r.addColorStop(1,i+", 0.0)"),t.setFillStyle(r),n.beginPath(),n.arc(0,0,e,0,cc.PI2,!1),n.closePath(),n.fill()},fillText:function(t,e,i){this._renderContext.getContext().fillText(t,e,-i)},setDrawColor:function(t,e,i,n){this._renderContext.setFillStyle("rgba("+t+","+e+","+i+","+n/255+")"),this._renderContext.setStrokeStyle("rgba("+t+","+e+","+i+","+n/255+")")},setPointSize:function(){},setLineWidth:function(t){this._renderContext.getContext().lineWidth=t*cc.view.getScaleX()}}),cc.DrawingPrimitiveWebGL=cc.Class.extend({_renderContext:null,_initialized:!1,_shader:null,_colorLocation:-1,_colorArray:null,_pointSizeLocation:-1,_pointSize:-1,ctor:function(t){if(null==t&&(t=cc._renderContext),!t instanceof WebGLRenderingContext)throw"Can't initialise DrawingPrimitiveWebGL. context need is WebGLRenderingContext";this._renderContext=t,this._colorArray=new Float32Array([1,1,1,1])},lazy_init:function(){this._initialized||(this._shader=cc.shaderCache.programForKey(cc.SHADER_POSITION_UCOLOR),this._colorLocation=this._renderContext.getUniformLocation(this._shader.getProgram(),"u_color"),this._pointSizeLocation=this._renderContext.getUniformLocation(this._shader.getProgram(),"u_pointSize"),this._initialized=!0)},drawInit:function(){this._initialized=!1},drawPoint:function(t){this.lazy_init();var e=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION),e.uniform4fv(this._colorLocation,this._colorArray),this._shader.setUniformLocationWith1f(this._pointSizeLocation,this._pointSize);var i=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,new Float32Array([t.x,t.y]),e.STATIC_DRAW),e.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,e.FLOAT,!1,0,0),e.drawArrays(e.POINTS,0,1),e.deleteBuffer(i),cc.incrementGLDraws(1)},drawPoints:function(t){if(t&&0!==t.length){this.lazy_init();var e=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION),e.uniform4fv(this._colorLocation,this._colorArray),this._shader.setUniformLocationWith1f(this._pointSizeLocation,this._pointSize);var i=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,this._pointsToTypeArray(t),e.STATIC_DRAW),e.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,e.FLOAT,!1,0,0),e.drawArrays(e.POINTS,0,t.length),e.deleteBuffer(i),cc.incrementGLDraws(1)}},_pointsToTypeArray:function(t){for(var e=new Float32Array(2*t.length),i=0;i<t.length;i++)e[2*i]=t[i].x,e[2*i+1]=t[i].y;return e},drawLine:function(t,e){this.lazy_init();var i=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION),i.uniform4fv(this._colorLocation,this._colorArray);var n=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,n),i.bufferData(i.ARRAY_BUFFER,this._pointsToTypeArray([t,e]),i.STATIC_DRAW),i.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,i.FLOAT,!1,0,0),i.drawArrays(i.LINES,0,2),i.deleteBuffer(n),cc.incrementGLDraws(1)},drawRect:function(t,e){this.drawLine(cc.p(t.x,t.y),cc.p(e.x,t.y)),this.drawLine(cc.p(e.x,t.y),cc.p(e.x,e.y)),this.drawLine(cc.p(e.x,e.y),cc.p(t.x,e.y)),this.drawLine(cc.p(t.x,e.y),cc.p(t.x,t.y))},drawSolidRect:function(t,e,i){t=[t,cc.p(e.x,t.y),e,cc.p(t.x,e.y)],this.drawSolidPoly(t,4,i)},drawPoly:function(t,e,i){this.lazy_init(),e=this._renderContext,this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION),e.uniform4fv(this._colorLocation,this._colorArray);var n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,this._pointsToTypeArray(t),e.STATIC_DRAW),e.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,e.FLOAT,!1,0,0),i?e.drawArrays(e.LINE_LOOP,0,t.length):e.drawArrays(e.LINE_STRIP,0,t.length),e.deleteBuffer(n),cc.incrementGLDraws(1)},drawSolidPoly:function(t,e,i){this.lazy_init(),i&&this.setDrawColor(i.r,i.g,i.b,i.a),e=this._renderContext,this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION),e.uniform4fv(this._colorLocation,this._colorArray),i=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,this._pointsToTypeArray(t),e.STATIC_DRAW),e.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,e.FLOAT,!1,0,0),e.drawArrays(e.TRIANGLE_FAN,0,t.length),e.deleteBuffer(i),cc.incrementGLDraws(1)},drawCircle:function(t,e,i,n,r){this.lazy_init();var o=1;r&&o++;var s=2*Math.PI/n;if(r=new Float32Array(2*(n+2))){for(var c=0;n>=c;c++){var a=c*s,l=e*Math.cos(a+i)+t.x,a=e*Math.sin(a+i)+t.y;r[2*c]=l,r[2*c+1]=a}r[2*(n+1)]=t.x,r[2*(n+1)+1]=t.y,t=this._renderContext,this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION),t.uniform4fv(this._colorLocation,this._colorArray),e=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,e),t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW),t.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,t.FLOAT,!1,0,0),t.drawArrays(t.LINE_STRIP,0,n+o),t.deleteBuffer(e),cc.incrementGLDraws(1)}},drawQuadBezier:function(t,e,i,n){this.lazy_init();for(var r=new Float32Array(2*(n+1)),o=0,s=0;n>s;s++)r[2*s]=Math.pow(1-o,2)*t.x+2*(1-o)*o*e.x+o*o*i.x,r[2*s+1]=Math.pow(1-o,2)*t.y+2*(1-o)*o*e.y+o*o*i.y,o+=1/n;r[2*n]=i.x,r[2*n+1]=i.y,t=this._renderContext,this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION),t.uniform4fv(this._colorLocation,this._colorArray),e=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,e),t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW),t.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,t.FLOAT,!1,0,0),t.drawArrays(t.LINE_STRIP,0,n+1),t.deleteBuffer(e),cc.incrementGLDraws(1)},drawCubicBezier:function(t,e,i,n,r){this.lazy_init();for(var o=new Float32Array(2*(r+1)),s=0,c=0;r>c;c++)o[2*c]=Math.pow(1-s,3)*t.x+3*Math.pow(1-s,2)*s*e.x+3*(1-s)*s*s*i.x+s*s*s*n.x,o[2*c+1]=Math.pow(1-s,3)*t.y+3*Math.pow(1-s,2)*s*e.y+3*(1-s)*s*s*i.y+s*s*s*n.y,s+=1/r;o[2*r]=n.x,o[2*r+1]=n.y,t=this._renderContext,this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION),t.uniform4fv(this._colorLocation,this._colorArray),e=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,e),t.bufferData(t.ARRAY_BUFFER,o,t.STATIC_DRAW),t.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,t.FLOAT,!1,0,0),t.drawArrays(t.LINE_STRIP,0,r+1),t.deleteBuffer(e),cc.incrementGLDraws(1)},drawCatmullRom:function(t,e){this.drawCardinalSpline(t,.5,e)},drawCardinalSpline:function(t,e,i){this.lazy_init();for(var n,r,o=new Float32Array(2*(i+1)),s=1/t.length,c=0;i+1>c;c++)r=c/i,1===r?(n=t.length-1,r=1):(n=0|r/s,r=(r-s*n)/s),n=cc.cardinalSplineAt(cc.getControlPointAt(t,n-1),cc.getControlPointAt(t,n),cc.getControlPointAt(t,n+1),cc.getControlPointAt(t,n+2),e,r),o[2*c]=n.x,o[2*c+1]=n.y;t=this._renderContext,this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION),t.uniform4fv(this._colorLocation,this._colorArray),e=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,e),t.bufferData(t.ARRAY_BUFFER,o,t.STATIC_DRAW),t.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,t.FLOAT,!1,0,0),t.drawArrays(t.LINE_STRIP,0,i+1),t.deleteBuffer(e),cc.incrementGLDraws(1)},setDrawColor:function(t,e,i,n){this._colorArray[0]=t/255,this._colorArray[1]=e/255,this._colorArray[2]=i/255,this._colorArray[3]=n/255},setPointSize:function(t){this._pointSize=t*cc.contentScaleFactor()},setLineWidth:function(t){this._renderContext.lineWidth&&this._renderContext.lineWidth(t)}}),cc._tmp.PrototypeLabelTTF=function(){var t=cc.LabelTTF.prototype;cc.defineGetterSetter(t,"color",t.getColor,t.setColor),cc.defineGetterSetter(t,"opacity",t.getOpacity,t.setOpacity),cc.defineGetterSetter(t,"string",t.getString,t.setString),cc.defineGetterSetter(t,"textAlign",t.getHorizontalAlignment,t.setHorizontalAlignment),cc.defineGetterSetter(t,"verticalAlign",t.getVerticalAlignment,t.setVerticalAlignment),cc.defineGetterSetter(t,"fontSize",t.getFontSize,t.setFontSize),cc.defineGetterSetter(t,"fontName",t.getFontName,t.setFontName),cc.defineGetterSetter(t,"font",t._getFont,t._setFont),cc.defineGetterSetter(t,"boundingWidth",t._getBoundingWidth,t._setBoundingWidth),cc.defineGetterSetter(t,"boundingHeight",t._getBoundingHeight,t._setBoundingHeight),cc.defineGetterSetter(t,"fillStyle",t._getFillStyle,t.setFontFillColor),cc.defineGetterSetter(t,"strokeStyle",t._getStrokeStyle,t._setStrokeStyle),cc.defineGetterSetter(t,"lineWidth",t._getLineWidth,t._setLineWidth),cc.defineGetterSetter(t,"shadowOffsetX",t._getShadowOffsetX,t._setShadowOffsetX),cc.defineGetterSetter(t,"shadowOffsetY",t._getShadowOffsetY,t._setShadowOffsetY),cc.defineGetterSetter(t,"shadowOpacity",t._getShadowOpacity,t._setShadowOpacity),cc.defineGetterSetter(t,"shadowBlur",t._getShadowBlur,t._setShadowBlur)},cc.LabelTTF=cc.Sprite.extend({_dimensions:null,_hAlignment:cc.TEXT_ALIGNMENT_CENTER,_vAlignment:cc.VERTICAL_TEXT_ALIGNMENT_TOP,_fontName:null,_fontSize:0,_string:"",_originalText:null,_shadowEnabled:!1,_shadowOffset:null,_shadowOpacity:0,_shadowBlur:0,_shadowColor:null,_strokeEnabled:!1,_strokeColor:null,_strokeSize:0,_textFillColor:null,_strokeShadowOffsetX:0,_strokeShadowOffsetY:0,_needUpdateTexture:!1,_lineWidths:null,_className:"LabelTTF",_fontStyle:"normal",_fontWeight:"normal",_lineHeight:"normal",initWithString:function(t,e,i,n,r,o){return t=t?t+"":"",i=i||16,n=n||cc.size(0,0),r=r||cc.TEXT_ALIGNMENT_LEFT,o=o||cc.VERTICAL_TEXT_ALIGNMENT_TOP,this._opacityModifyRGB=!1,this._dimensions=cc.size(n.width,n.height),this._fontName=e||"Arial",this._hAlignment=r,this._vAlignment=o,this._fontSize=i,this._renderCmd._setFontStyle(this._fontName,i,this._fontStyle,this._fontWeight),this.string=t,this._renderCmd._setColorsString(),this._renderCmd._updateTexture(),this._setUpdateTextureDirty(),!0},_setUpdateTextureDirty:function(){this._needUpdateTexture=!0,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.textDirty)},ctor:function(t,e,i,n,r,o){cc.Sprite.prototype.ctor.call(this),this._dimensions=cc.size(0,0),this._hAlignment=cc.TEXT_ALIGNMENT_LEFT,this._vAlignment=cc.VERTICAL_TEXT_ALIGNMENT_TOP,this._opacityModifyRGB=!1,this._fontName="Arial",this._shadowEnabled=!1,this._shadowOffset=cc.p(0,0),this._shadowBlur=this._shadowOpacity=0,this._strokeEnabled=!1,this._strokeColor=cc.color(255,255,255,255),this._strokeSize=0,this._textFillColor=cc.color(255,255,255,255),this._strokeShadowOffsetY=this._strokeShadowOffsetX=0,this._needUpdateTexture=!1,this._lineWidths=[],this._renderCmd._setColorsString(),this._textureLoaded=!0,e&&e instanceof cc.FontDefinition?this.initWithStringAndTextDefinition(t,e):cc.LabelTTF.prototype.initWithString.call(this,t,e,i,n,r,o)},init:function(){return this.initWithString(" ",this._fontName,this._fontSize)},description:function(){return"<cc.LabelTTF | FontName ="+this._fontName+" FontSize = "+this._fontSize.toFixed(1)+">"},getLineHeight:function(){return!this._lineHeight||this._lineHeight.charAt?this._renderCmd._getFontClientHeight():this._lineHeight||this._renderCmd._getFontClientHeight()},setLineHeight:function(t){this._lineHeight=t},getString:function(){return this._string},getHorizontalAlignment:function(){return this._hAlignment},getVerticalAlignment:function(){return this._vAlignment},getDimensions:function(){return cc.size(this._dimensions)},getFontSize:function(){return this._fontSize},getFontName:function(){return this._fontName},initWithStringAndTextDefinition:function(t,e){return this._updateWithTextDefinition(e,!1),this.string=t,!0},setTextDefinition:function(t){t&&this._updateWithTextDefinition(t,!0)},getTextDefinition:function(){return this._prepareTextDefinition(!1)},enableShadow:function(t,e,i,n){null!=t.r&&null!=t.g&&null!=t.b&&null!=t.a?this._enableShadow(t,e,i):this._enableShadowNoneColor(t,e,i,n)},_enableShadowNoneColor:function(t,e,i,n){i=i||.5,!1===this._shadowEnabled&&(this._shadowEnabled=!0);var r=this._shadowOffset;(r&&r.x!==t||r._y!==e)&&(r.x=t,r.y=e),this._shadowOpacity!==i&&(this._shadowOpacity=i),this._renderCmd._setColorsString(),this._shadowBlur!==n&&(this._shadowBlur=n),this._setUpdateTextureDirty()},_enableShadow:function(t,e,i){this._shadowColor||(this._shadowColor=cc.color(255,255,255,128)),this._shadowColor.r=t.r,this._shadowColor.g=t.g,this._shadowColor.b=t.b,this._enableShadowNoneColor(e.width||e.x||0,e.height||e.y||0,null!=t.a?t.a/255:.5,i)
},_getShadowOffsetX:function(){return this._shadowOffset.x},_setShadowOffsetX:function(t){!1===this._shadowEnabled&&(this._shadowEnabled=!0),this._shadowOffset.x!==t&&(this._shadowOffset.x=t,this._setUpdateTextureDirty())},_getShadowOffsetY:function(){return this._shadowOffset._y},_setShadowOffsetY:function(t){!1===this._shadowEnabled&&(this._shadowEnabled=!0),this._shadowOffset._y!==t&&(this._shadowOffset._y=t,this._setUpdateTextureDirty())},_getShadowOffset:function(){return cc.p(this._shadowOffset.x,this._shadowOffset.y)},_setShadowOffset:function(t){!1===this._shadowEnabled&&(this._shadowEnabled=!0),(this._shadowOffset.x!==t.x||this._shadowOffset.y!==t.y)&&(this._shadowOffset.x=t.x,this._shadowOffset.y=t.y,this._setUpdateTextureDirty())},_getShadowOpacity:function(){return this._shadowOpacity},_setShadowOpacity:function(t){!1===this._shadowEnabled&&(this._shadowEnabled=!0),this._shadowOpacity!==t&&(this._shadowOpacity=t,this._renderCmd._setColorsString(),this._setUpdateTextureDirty())},_getShadowBlur:function(){return this._shadowBlur},_setShadowBlur:function(t){!1===this._shadowEnabled&&(this._shadowEnabled=!0),this._shadowBlur!==t&&(this._shadowBlur=t,this._setUpdateTextureDirty())},disableShadow:function(){this._shadowEnabled&&(this._shadowEnabled=!1,this._setUpdateTextureDirty())},enableStroke:function(t,e){!1===this._strokeEnabled&&(this._strokeEnabled=!0);var i=this._strokeColor;(i.r!==t.r||i.g!==t.g||i.b!==t.b)&&(i.r=t.r,i.g=t.g,i.b=t.b,this._renderCmd._setColorsString()),this._strokeSize!==e&&(this._strokeSize=e||0),this._setUpdateTextureDirty()},_getStrokeStyle:function(){return this._strokeColor},_setStrokeStyle:function(t){!1===this._strokeEnabled&&(this._strokeEnabled=!0);var e=this._strokeColor;(e.r!==t.r||e.g!==t.g||e.b!==t.b)&&(e.r=t.r,e.g=t.g,e.b=t.b,this._renderCmd._setColorsString(),this._setUpdateTextureDirty())},_getLineWidth:function(){return this._strokeSize},_setLineWidth:function(t){!1===this._strokeEnabled&&(this._strokeEnabled=!0),this._strokeSize!==t&&(this._strokeSize=t||0,this._setUpdateTextureDirty())},disableStroke:function(){this._strokeEnabled&&(this._strokeEnabled=!1,this._setUpdateTextureDirty())},setFontFillColor:function(t){var e=this._textFillColor;(e.r!==t.r||e.g!==t.g||e.b!==t.b)&&(e.r=t.r,e.g=t.g,e.b=t.b,this._renderCmd._setColorsString(),this._needUpdateTexture=!0)},_getFillStyle:function(){return this._textFillColor},_updateWithTextDefinition:function(t,e){t.fontDimensions?(this._dimensions.width=t.boundingWidth,this._dimensions.height=t.boundingHeight):(this._dimensions.width=0,this._dimensions.height=0),this._hAlignment=t.textAlign,this._vAlignment=t.verticalAlign,this._fontName=t.fontName,this._fontSize=t.fontSize||12,this._lineHeight=t.lineHeight?t.lineHeight:this._fontSize,this._renderCmd._setFontStyle(t),t.shadowEnabled&&this.enableShadow(t.shadowOffsetX,t.shadowOffsetY,t.shadowOpacity,t.shadowBlur),t.strokeEnabled&&this.enableStroke(t.strokeStyle,t.lineWidth),this.setFontFillColor(t.fillStyle),e&&this._renderCmd._updateTexture();var i=cc.Node._dirtyFlags;this._renderCmd.setDirtyFlag(i.colorDirty|i.opacityDirty|i.textDirty)},_prepareTextDefinition:function(t){var e=new cc.FontDefinition;if(t?(e.fontSize=this._fontSize,e.boundingWidth=cc.contentScaleFactor()*this._dimensions.width,e.boundingHeight=cc.contentScaleFactor()*this._dimensions.height):(e.fontSize=this._fontSize,e.boundingWidth=this._dimensions.width,e.boundingHeight=this._dimensions.height),e.fontName=this._fontName,e.textAlign=this._hAlignment,e.verticalAlign=this._vAlignment,this._strokeEnabled){e.strokeEnabled=!0;var i=this._strokeColor;e.strokeStyle=cc.color(i.r,i.g,i.b),e.lineWidth=this._strokeSize}else e.strokeEnabled=!1;return this._shadowEnabled?(e.shadowEnabled=!0,e.shadowBlur=this._shadowBlur,e.shadowOpacity=this._shadowOpacity,e.shadowOffsetX=(t?cc.contentScaleFactor():1)*this._shadowOffset.x,e.shadowOffsetY=(t?cc.contentScaleFactor():1)*this._shadowOffset.y):e._shadowEnabled=!1,t=this._textFillColor,e.fillStyle=cc.color(t.r,t.g,t.b),e},setString:function(t){t=String(t),this._originalText!==t&&(this._originalText=t+"",this._updateString(),this._setUpdateTextureDirty(),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty))},_updateString:function(){this._string&&""!==this._string||this._string===this._originalText||(cc.renderer.childrenOrderDirty=!0),this._string=this._originalText},setHorizontalAlignment:function(t){t!==this._hAlignment&&(this._hAlignment=t,this._setUpdateTextureDirty())},setVerticalAlignment:function(t){t!==this._vAlignment&&(this._vAlignment=t,this._setUpdateTextureDirty())},setDimensions:function(t,e){var i;void 0===e?(i=t.width,e=t.height):i=t,(i!==this._dimensions.width||e!==this._dimensions.height)&&(this._dimensions.width=i,this._dimensions.height=e,this._updateString(),this._setUpdateTextureDirty())},_getBoundingWidth:function(){return this._dimensions.width},_setBoundingWidth:function(t){t!==this._dimensions.width&&(this._dimensions.width=t,this._updateString(),this._setUpdateTextureDirty())},_getBoundingHeight:function(){return this._dimensions.height},_setBoundingHeight:function(t){t!==this._dimensions.height&&(this._dimensions.height=t,this._updateString(),this._setUpdateTextureDirty())},setFontSize:function(t){this._fontSize!==t&&(this._fontSize=t,this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight),this._setUpdateTextureDirty())},setFontName:function(t){this._fontName&&this._fontName!==t&&(this._fontName=t,this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight),this._setUpdateTextureDirty())},_getFont:function(){return this._renderCmd._getFontStyle()},_setFont:function(t){(t=cc.LabelTTF._fontStyleRE.exec(t))&&(this._fontSize=parseInt(t[1]),this._fontName=t[2],this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight),this._setUpdateTextureDirty())},getContentSize:function(){return this._needUpdateTexture&&this._renderCmd._updateTTF(),cc.Sprite.prototype.getContentSize.call(this)},_getWidth:function(){return this._needUpdateTexture&&this._renderCmd._updateTTF(),cc.Sprite.prototype._getWidth.call(this)},_getHeight:function(){return this._needUpdateTexture&&this._renderCmd._updateTTF(),cc.Sprite.prototype._getHeight.call(this)},setTextureRect:function(t,e,i){cc.Sprite.prototype.setTextureRect.call(this,t,e,i,!1)},_createRenderCmd:function(){return cc._renderType===cc._RENDER_TYPE_CANVAS?new cc.LabelTTF.CanvasRenderCmd(this):new cc.LabelTTF.WebGLRenderCmd(this)},_setFontStyle:function(t){this._fontStyle!==t&&(this._fontStyle=t,this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight),this._setUpdateTextureDirty())},_getFontStyle:function(){return this._fontStyle},_setFontWeight:function(t){this._fontWeight!==t&&(this._fontWeight=t,this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight),this._setUpdateTextureDirty())},_getFontWeight:function(){return this._fontWeight}}),cc.assert(cc.isFunction(cc._tmp.PrototypeLabelTTF),cc._LogInfos.MissingFile,"LabelTTFPropertyDefine.js"),cc._tmp.PrototypeLabelTTF(),delete cc._tmp.PrototypeLabelTTF,cc.LabelTTF._fontStyleRE=/^(\d+)px\s+['"]?([\w\s\d]+)['"]?$/,cc.LabelTTF.create=function(t,e,i,n,r,o){return new cc.LabelTTF(t,e,i,n,r,o)},cc.LabelTTF.createWithFontDefinition=cc.LabelTTF.create,cc.LabelTTF._SHADER_PROGRAM=cc.USE_LA88_LABELS?cc.SHADER_POSITION_TEXTURECOLOR:cc.SHADER_POSITION_TEXTUREA8COLOR,cc.LabelTTF.__labelHeightDiv=cc.newElement("div"),cc.LabelTTF.__labelHeightDiv.style.fontFamily="Arial",cc.LabelTTF.__labelHeightDiv.style.position="absolute",cc.LabelTTF.__labelHeightDiv.style.left="-100px",cc.LabelTTF.__labelHeightDiv.style.top="-100px",cc.LabelTTF.__labelHeightDiv.style.lineHeight="normal",document.body?document.body.appendChild(cc.LabelTTF.__labelHeightDiv):cc._addEventListener(window,"load",function(){this.removeEventListener("load",arguments.callee,!1),document.body.appendChild(cc.LabelTTF.__labelHeightDiv)},!1),cc.LabelTTF.__getFontHeightByDiv=function(t,e){if(t instanceof cc.FontDefinition){var i=cc.LabelTTF.__fontHeightCache[t._getCanvasFontStr()];if(i>0)return i;var n=cc.LabelTTF.__labelHeightDiv;return n.innerHTML="ajghl~!",n.style.fontFamily=t.fontName,n.style.fontSize=t.fontSize+"px",n.style.fontStyle=t.fontStyle,n.style.fontWeight=t.fontWeight,i=n.clientHeight,cc.LabelTTF.__fontHeightCache[t._getCanvasFontStr()]=i,n.innerHTML="",i}return i=cc.LabelTTF.__fontHeightCache[t+"."+e],i>0?i:(n=cc.LabelTTF.__labelHeightDiv,n.innerHTML="ajghl~!",n.style.fontFamily=t,n.style.fontSize=e+"px",i=n.clientHeight,cc.LabelTTF.__fontHeightCache[t+"."+e]=i,n.innerHTML="",i)},cc.LabelTTF.__fontHeightCache={},cc.LabelTTF._textAlign=["left","center","right"],cc.LabelTTF._textBaseline=["top","middle","bottom"],cc.LabelTTF.wrapInspection=!0,cc.LabelTTF._wordRex=/([a-zA-Z0-9\u00c4\u00d6\u00dc\u00e4\u00f6\u00fc\u00df\u00e9\u00e8\u00e7\u00e0\u00f9\u00ea\u00e2\u00ee\u00f4\u00fb]+|\S)/,cc.LabelTTF._symbolRex=/^[!,.:;}\]%\?>\u3001\u2018\u201c\u300b\uff1f\u3002\uff0c\uff01]/,cc.LabelTTF._lastWordRex=/([a-zA-Z0-9\u00c4\u00d6\u00dc\u00e4\u00f6\u00fc\u00df\u00e9\u00e8\u00e7\u00e0\u00f9\u00ea\u00e2\u00ee\u00f4\u00fb]+|\S)$/,cc.LabelTTF._lastEnglish=/[a-zA-Z0-9\u00c4\u00d6\u00dc\u00e4\u00f6\u00fc\u00df\u00e9\u00e8\u00e7\u00e0\u00f9\u00ea\u00e2\u00ee\u00f4\u00fb]+$/,cc.LabelTTF._firsrEnglish=/^[a-zA-Z0-9\u00c4\u00d6\u00dc\u00e4\u00f6\u00fc\u00df\u00e9\u00e8\u00e7\u00e0\u00f9\u00ea\u00e2\u00ee\u00f4\u00fb]/,function(){cc.LabelTTF.RenderCmd=function(){this._fontClientHeight=18,this._fontStyleStr="",this._shadowColorStr="rgba(128, 128, 128, 0.5)",this._strokeColorStr="",this._fillColorStr="rgba(255,255,255,1)",this._labelContext=this._labelCanvas=null,this._lineWidths=[],this._strings=[],this._isMultiLine=!1};var t=cc.LabelTTF.RenderCmd.prototype;t.constructor=cc.LabelTTF.RenderCmd,t._getLabelContext=function(){if(this._labelContext)return this._labelContext;var t=this._node;if(!this._labelCanvas){var e=cc.newElement("canvas");e.width=1,e.height=1;var i=new cc.Texture2D;i.initWithElement(e),t.setTexture(i),this._labelCanvas=e}return this._labelContext=this._labelCanvas.getContext("2d")},t._setFontStyle=function(t,e,i,n){t instanceof cc.FontDefinition?(this._fontStyleStr=t._getCanvasFontStr(),this._fontClientHeight=cc.LabelTTF.__getFontHeightByDiv(t)):(this._fontStyleStr=i+" "+n+" "+e+"px '"+t+"'",this._fontClientHeight=cc.LabelTTF.__getFontHeightByDiv(t,e))},t._getFontStyle=function(){return this._fontStyleStr},t._getFontClientHeight=function(){return this._fontClientHeight},t._updateTexture=function(){this._dirtyFlag^=this._dirtyFlag&cc.Node._dirtyFlags.textDirty;var t=this._node,e=this._getLabelContext(),i=this._labelCanvas,n=t._contentSize;if(0===t._string.length)return i.width=1,i.height=n.height||1,t._texture&&t._texture.handleLoadedTexture(),t.setTextureRect(cc.rect(0,0,1,n.height)),!0;e.font=this._fontStyleStr,this._updateTTF();var r=n.width,n=n.height,o=i.width===r&&i.height===n;return i.width=r,i.height=n,o&&e.clearRect(0,0,r,n),this._drawTTFInCanvas(e),t._texture&&t._texture.handleLoadedTexture(),t.setTextureRect(cc.rect(0,0,r,n)),!0},t._measureConfig=function(){this._getLabelContext().font=this._fontStyleStr},t._measure=function(t){return this._getLabelContext().measureText(t).width},t._updateTTF=function(){var t,e,i=this._node,n=i._dimensions.width,r=this._lineWidths;if(r.length=0,this._isMultiLine=!1,this._measureConfig(),0!==n)for(this._strings=i._string.split("\n"),t=0;t<this._strings.length;t++)this._checkWarp(this._strings,t,n);else for(this._strings=i._string.split("\n"),t=0,e=this._strings.length;e>t;t++)r.push(this._measure(this._strings[t]));if(1<this._strings.length&&(this._isMultiLine=!0),e=t=0,i._strokeEnabled&&(t=e=2*i._strokeSize),i._shadowEnabled){var o=i._shadowOffset;t+=2*Math.abs(o.x),e+=2*Math.abs(o.y)}n=0===n?this._isMultiLine?cc.size(Math.ceil(Math.max.apply(Math,r)+t),Math.ceil(this._fontClientHeight*this._strings.length+e)):cc.size(Math.ceil(this._measure(i._string)+t),Math.ceil(this._fontClientHeight+e)):0===i._dimensions.height?this._isMultiLine?cc.size(Math.ceil(n+t),Math.ceil(i.getLineHeight()*this._strings.length+e)):cc.size(Math.ceil(n+t),Math.ceil(i.getLineHeight()+e)):cc.size(Math.ceil(n+t),Math.ceil(i._dimensions.height+e)),"normal"!==i._getFontStyle()&&(n.width=Math.ceil(n.width+.3*i._fontSize)),i.setContentSize(n),i._strokeShadowOffsetX=t,i._strokeShadowOffsetY=e,i=i._anchorPoint,this._anchorPointInPoints.x=.5*t+(n.width-t)*i.x,this._anchorPointInPoints.y=.5*e+(n.height-e)*i.y},t._drawTTFInCanvas=function(t){if(t){var e=this._node,i=e._strokeShadowOffsetX,n=e._strokeShadowOffsetY,r=e._contentSize.height-n,o=e._vAlignment,s=e._hAlignment,c=e._strokeSize;t.setTransform(1,0,0,1,.5*i,r+.5*n),t.font!==this._fontStyleStr&&(t.font=this._fontStyleStr),t.fillStyle=this._fillColorStr;var a=n=0,l=e._strokeEnabled;l&&(t.lineWidth=2*c,t.strokeStyle=this._strokeColorStr),e._shadowEnabled&&(c=e._shadowOffset,t.shadowColor=this._shadowColorStr,t.shadowOffsetX=c.x,t.shadowOffsetY=-c.y,t.shadowBlur=e._shadowBlur),t.textBaseline=cc.LabelTTF._textBaseline[o],t.textAlign=cc.LabelTTF._textAlign[s];var h=e._contentSize.width-i,i=e.getLineHeight(),c=(i-this._fontClientHeight)/2,n=s===cc.TEXT_ALIGNMENT_RIGHT?n+h:s===cc.TEXT_ALIGNMENT_CENTER?n+h/2:n+0;if(this._isMultiLine)for(e=this._strings.length,o===cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM?a=i-2*c+r-i*e:o===cc.VERTICAL_TEXT_ALIGNMENT_CENTER&&(a=(i-2*c)/2+(r-i*e)/2),o=0;e>o;o++)s=this._strings[o],h=-r+(i*o+c)+a,l&&t.strokeText(s,n,h),t.fillText(s,n,h);else o!==cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM&&(a=o===cc.VERTICAL_TEXT_ALIGNMENT_TOP?a-r:a-.5*r),l&&t.strokeText(e._string,n,a),t.fillText(e._string,n,a)}},t._checkWarp=function(t,e,i){var n=t[e],r=this._measure(n);if(r>i&&1<n.length){for(var o,s=i/r*n.length|0,c=n.substr(s),a=r-this._measure(c),l=0,h=0;a>i&&100>h++;)s*=i/a,s|=0,c=n.substr(s),a=r-this._measure(c);for(h=0;i>a&&100>h++;)c&&(l=(o=cc.LabelTTF._wordRex.exec(c))?o[0].length:1,o=c),s+=l,c=n.substr(s),a=r-this._measure(c);s-=l,0===s&&(s=1,o=o.substr(1)),i=n.substr(0,s),cc.LabelTTF.wrapInspection&&cc.LabelTTF._symbolRex.test(o||c)&&(r=cc.LabelTTF._lastWordRex.exec(i),s-=r?r[0].length:0,o=n.substr(s),i=n.substr(0,s)),cc.LabelTTF._firsrEnglish.test(o)&&(r=cc.LabelTTF._lastEnglish.exec(i))&&i!==r[0]&&(s-=r[0].length,o=n.substr(s),i=n.substr(0,s)),t[e]=o||c,t.splice(e,0,i)}}}(),function(){cc.LabelTTF.CanvasRenderCmd=function(t){cc.Sprite.CanvasRenderCmd.call(this,t),cc.LabelTTF.RenderCmd.call(this)},cc.LabelTTF.CanvasRenderCmd.prototype=Object.create(cc.Sprite.CanvasRenderCmd.prototype),cc.inject(cc.LabelTTF.RenderCmd.prototype,cc.LabelTTF.CanvasRenderCmd.prototype);var t=cc.LabelTTF.CanvasRenderCmd.prototype;t.constructor=cc.LabelTTF.CanvasRenderCmd,t.updateStatus=function(){var t=cc.Node._dirtyFlags,e=this._dirtyFlag,i=e&t.colorDirty,n=e&t.opacityDirty;i&&this._updateDisplayColor(),n&&this._updateDisplayOpacity(),i?this._updateColor():e&t.textDirty&&this._updateTexture(),this._dirtyFlag&t.transformDirty&&(this.transform(this.getParentRenderCmd(),!0),this._dirtyFlag^=this._dirtyFlag&cc.Node._dirtyFlags.transformDirty)},t._syncStatus=function(t){var e=cc.Node._dirtyFlags,i=this._dirtyFlag,n=t?t._node:null;n&&n._cascadeColorEnabled&&t._dirtyFlag&e.colorDirty&&(i|=e.colorDirty),n&&n._cascadeOpacityEnabled&&t._dirtyFlag&e.opacityDirty&&(i|=e.opacityDirty),t&&t._dirtyFlag&e.transformDirty&&(i|=e.transformDirty);var n=i&e.colorDirty,r=i&e.opacityDirty;this._dirtyFlag=i,n&&this._syncDisplayColor(),r&&this._syncDisplayOpacity(),n?this._updateColor():i&e.textDirty&&this._updateTexture(),i&e.transformDirty&&this.transform(t)},t._setColorsString=function(){var t=this._displayedColor,e=this._node,i=e._shadowColor||this._displayedColor,n=e._strokeColor,r=e._textFillColor,o=t.r/255,s=t.g/255,t=t.b/255;this._shadowColorStr="rgba("+(0|o*i.r)+","+(0|s*i.g)+","+(0|t*i.b)+","+e._shadowOpacity+")",this._fillColorStr="rgba("+(0|o*r.r)+","+(0|s*r.g)+","+(0|t*r.b)+", 1)",this._strokeColorStr="rgba("+(0|o*n.r)+","+(0|s*n.g)+","+(0|t*n.b)+", 1)"},t._updateColor=function(){this._setColorsString(),this._updateTexture()}}(),function(){cc.LabelTTF.WebGLRenderCmd=function(t){cc.Sprite.WebGLRenderCmd.call(this,t),cc.LabelTTF.RenderCmd.call(this),this.setShaderProgram(cc.shaderCache.programForKey(cc.LabelTTF._SHADER_PROGRAM))};var t=cc.LabelTTF.WebGLRenderCmd.prototype=Object.create(cc.Sprite.WebGLRenderCmd.prototype);cc.inject(cc.LabelTTF.RenderCmd.prototype,t),t.constructor=cc.LabelTTF.WebGLRenderCmd,t._setColorsString=function(){this.setDirtyFlag(cc.Node._dirtyFlags.textDirty);var t=this._node,e=t._strokeColor,i=t._textFillColor,n=t._shadowColor||this._displayedColor;this._shadowColorStr="rgba("+(0|n.r)+","+(0|n.g)+","+(0|n.b)+","+t._shadowOpacity+")",this._fillColorStr="rgba("+(0|i.r)+","+(0|i.g)+","+(0|i.b)+", 1)",this._strokeColorStr="rgba("+(0|e.r)+","+(0|e.g)+","+(0|e.b)+", 1)"},t.updateStatus=function(){var t=cc.Node._dirtyFlags,e=this._dirtyFlag,i=e&t.colorDirty,n=e&t.opacityDirty;i&&this._updateDisplayColor(),n&&this._updateDisplayOpacity(),i||n?(this._setColorsString(),this._updateColor(),this._updateTexture()):e&t.textDirty&&this._updateTexture(),this._dirtyFlag&t.transformDirty&&(this.transform(this.getParentRenderCmd(),!0),this._dirtyFlag^=this._dirtyFlag&cc.Node._dirtyFlags.transformDirty)},t._syncStatus=function(t){var e=cc.Node._dirtyFlags,i=this._dirtyFlag,n=t?t._node:null;n&&n._cascadeColorEnabled&&t._dirtyFlag&e.colorDirty&&(i|=e.colorDirty),n&&n._cascadeOpacityEnabled&&t._dirtyFlag&e.opacityDirty&&(i|=e.opacityDirty),t&&t._dirtyFlag&e.transformDirty&&(i|=e.transformDirty);var n=i&e.colorDirty,r=i&e.opacityDirty;this._dirtyFlag=i,n&&this._syncDisplayColor(),r&&this._syncDisplayOpacity(),n||r?(this._setColorsString(),this._updateColor(),this._updateTexture()):i&e.textDirty&&this._updateTexture(),this.transform(t)}}(),cc.HashElement=cc.Class.extend({actions:null,target:null,actionIndex:0,currentAction:null,currentActionSalvaged:!1,paused:!1,hh:null,ctor:function(){this.actions=[],this.target=null,this.actionIndex=0,this.currentAction=null,this.paused=this.currentActionSalvaged=!1,this.hh=null}}),cc.ActionManager=cc.Class.extend({_hashTargets:null,_arrayTargets:null,_currentTarget:null,_currentTargetSalvaged:!1,_searchElementByTarget:function(t,e){for(var i=0;i<t.length;i++)if(e===t[i].target)return t[i];return null},ctor:function(){this._hashTargets={},this._arrayTargets=[],this._currentTarget=null,this._currentTargetSalvaged=!1},addAction:function(t,e,i){if(!t)throw"cc.ActionManager.addAction(): action must be non-null";if(!e)throw"cc.ActionManager.addAction(): action must be non-null";var n=this._hashTargets[e.__instanceId];n||(n=new cc.HashElement,n.paused=i,n.target=e,this._hashTargets[e.__instanceId]=n,this._arrayTargets.push(n)),this._actionAllocWithHashElement(n),n.actions.push(t),t.startWithTarget(e)},removeAllActions:function(){for(var t=this._arrayTargets,e=0;e<t.length;e++){var i=t[e];i&&this.removeAllActionsFromTarget(i.target,!0)}},removeAllActionsFromTarget:function(t,e){if(null!=t){var i=this._hashTargets[t.__instanceId];i&&(-1===i.actions.indexOf(i.currentAction)||i.currentActionSalvaged||(i.currentActionSalvaged=!0),i.actions.length=0,this._currentTarget!==i||e?this._deleteHashElement(i):this._currentTargetSalvaged=!0)}},removeAction:function(t){if(null!=t){var e=t.getOriginalTarget();if(e=this._hashTargets[e.__instanceId]){for(var i=0;i<e.actions.length;i++)if(e.actions[i]===t){e.actions.splice(i,1);break}}else cc.log(cc._LogInfos.ActionManager_removeAction)}},removeActionByTag:function(t,e){t===cc.ACTION_TAG_INVALID&&cc.log(cc._LogInfos.ActionManager_addAction),cc.assert(e,cc._LogInfos.ActionManager_addAction);var i=this._hashTargets[e.__instanceId];if(i)for(var n=i.actions.length,r=0;n>r;++r){var o=i.actions[r];if(o&&o.getTag()===t&&o.getOriginalTarget()===e){this._removeActionAtIndex(r,i);break}}},getActionByTag:function(t,e){t===cc.ACTION_TAG_INVALID&&cc.log(cc._LogInfos.ActionManager_getActionByTag);var i=this._hashTargets[e.__instanceId];if(i){if(null!=i.actions)for(var n=0;n<i.actions.length;++n){var r=i.actions[n];if(r&&r.getTag()===t)return r}cc.log(cc._LogInfos.ActionManager_getActionByTag_2,t)}return null},numberOfRunningActionsInTarget:function(t){return(t=this._hashTargets[t.__instanceId])&&t.actions?t.actions.length:0},pauseTarget:function(t){(t=this._hashTargets[t.__instanceId])&&(t.paused=!0)},resumeTarget:function(t){(t=this._hashTargets[t.__instanceId])&&(t.paused=!1)},pauseAllRunningActions:function(){for(var t=[],e=this._arrayTargets,i=0;i<e.length;i++){var n=e[i];n&&!n.paused&&(n.paused=!0,t.push(n.target))}return t},resumeTargets:function(t){if(t)for(var e=0;e<t.length;e++)t[e]&&this.resumeTarget(t[e])},purgeSharedManager:function(){cc.director.getScheduler().unscheduleUpdate(this)},_removeActionAtIndex:function(t,e){e.actions[t]!==e.currentAction||e.currentActionSalvaged||(e.currentActionSalvaged=!0),e.actions.splice(t,1),e.actionIndex>=t&&e.actionIndex--,0===e.actions.length&&(this._currentTarget===e?this._currentTargetSalvaged=!0:this._deleteHashElement(e))},_deleteHashElement:function(t){var e=!1;return t&&(this._hashTargets[t.target.__instanceId]&&(delete this._hashTargets[t.target.__instanceId],cc.arrayRemoveObject(this._arrayTargets,t),e=!0),t.actions=null,t.target=null),e},_actionAllocWithHashElement:function(t){null==t.actions&&(t.actions=[])},update:function(t){for(var e,i=this._arrayTargets,n=0;n<i.length;n++){if(e=this._currentTarget=i[n],!e.paused)for(e.actionIndex=0;e.actionIndex<(e.actions?e.actions.length:0);e.actionIndex++)if(e.currentAction=e.actions[e.actionIndex],e.currentAction){if(e.currentActionSalvaged=!1,e.currentAction.step(t*(e.currentAction._speedMethod?e.currentAction._speed:1)),e.currentActionSalvaged)e.currentAction=null;else if(e.currentAction.isDone()){e.currentAction.stop();var r=e.currentAction;e.currentAction=null,this.removeAction(r)}e.currentAction=null}this._currentTargetSalvaged&&0===e.actions.length&&this._deleteHashElement(e)&&n--}}}),cc.math=cc.math||{},cc.math.EPSILON=.015625,cc.math.square=function(t){return t*t},cc.math.almostEqual=function(t,e){return t+cc.math.EPSILON>e&&t-cc.math.EPSILON<e},function(t){t.math.Vec2=function(t,e){void 0===e?(this.x=t.x,this.y=t.y):(this.x=t||0,this.y=e||0)};var e=t.math.Vec2.prototype;e.fill=function(t,e){this.x=t,this.y=e},e.length=function(){return Math.sqrt(t.math.square(this.x)+t.math.square(this.y))},e.lengthSq=function(){return t.math.square(this.x)+t.math.square(this.y)},e.normalize=function(){var t=1/this.length();return this.x*=t,this.y*=t,this},t.math.Vec2.add=function(t,e,i){return t.x=e.x+i.x,t.y=e.y+i.y,t},e.add=function(t){return this.x+=t.x,this.y+=t.y,this},e.dot=function(t){return this.x*t.x+this.y*t.y},t.math.Vec2.subtract=function(t,e,i){return t.x=e.x-i.x,t.y=e.y-i.y,t},e.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},e.transform=function(t){var e=this.x,i=this.y;return this.x=e*t.mat[0]+i*t.mat[3]+t.mat[6],this.y=e*t.mat[1]+i*t.mat[4]+t.mat[7],this},t.math.Vec2.scale=function(t,e,i){return t.x=e.x*i,t.y=e.y*i,t},e.scale=function(t){return this.x*=t,this.y*=t,this},e.equals=function(e){return this.x<e.x+t.math.EPSILON&&this.x>e.x-t.math.EPSILON&&this.y<e.y+t.math.EPSILON&&this.y>e.y-t.math.EPSILON}}(cc),function(t){t.kmVec3=t.math.Vec3=function(t,e,i){t&&void 0===e?(this.x=t.x,this.y=t.y,this.z=t.z):(this.x=t||0,this.y=e||0,this.z=i||0)},t.math.vec3=function(e,i,n){return new t.math.Vec3(e,i,n)};var e=t.math.Vec3.prototype;e.fill=function(t,e,i){return t&&void 0===e?(this.x=t.x,this.y=t.y,this.z=t.z):(this.x=t,this.y=e,this.z=i),this},e.length=function(){return Math.sqrt(t.math.square(this.x)+t.math.square(this.y)+t.math.square(this.z))},e.lengthSq=function(){return t.math.square(this.x)+t.math.square(this.y)+t.math.square(this.z)},e.normalize=function(){var t=1/this.length();return this.x*=t,this.y*=t,this.z*=t,this},e.cross=function(t){var e=this.x,i=this.y,n=this.z;return this.x=i*t.z-n*t.y,this.y=n*t.x-e*t.z,this.z=e*t.y-i*t.x,this},e.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},e.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},e.subtract=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},e.transform=function(t){var e=this.x,i=this.y,n=this.z;return t=t.mat,this.x=e*t[0]+i*t[4]+n*t[8]+t[12],this.y=e*t[1]+i*t[5]+n*t[9]+t[13],this.z=e*t[2]+i*t[6]+n*t[10]+t[14],this},e.transformNormal=function(t){var e=this.x,i=this.y,n=this.z;return t=t.mat,this.x=e*t[0]+i*t[4]+n*t[8],this.y=e*t[1]+i*t[5]+n*t[9],this.z=e*t[2]+i*t[6]+n*t[10],this},e.transformCoord=function(e){var i=new t.math.Vec4(this.x,this.y,this.z,1);return i.transform(e),this.x=i.x/i.w,this.y=i.y/i.w,this.z=i.z/i.w,this},e.scale=function(t){return this.x*=t,this.y*=t,this.z*=t,this},e.equals=function(e){var i=t.math.EPSILON;return this.x<e.x+i&&this.x>e.x-i&&this.y<e.y+i&&this.y>e.y-i&&this.z<e.z+i&&this.z>e.z-i},e.inverseTransform=function(e){e=e.mat;var i=new t.math.Vec3(this.x-e[12],this.y-e[13],this.z-e[14]);return this.x=i.x*e[0]+i.y*e[1]+i.z*e[2],this.y=i.x*e[4]+i.y*e[5]+i.z*e[6],this.z=i.x*e[8]+i.y*e[9]+i.z*e[10],this},e.inverseTransformNormal=function(t){var e=this.x,i=this.y,n=this.z;return t=t.mat,this.x=e*t[0]+i*t[1]+n*t[2],this.y=e*t[4]+i*t[5]+n*t[6],this.z=e*t[8]+i*t[9]+n*t[10],this},e.assignFrom=function(t){return t?(this.x=t.x,this.y=t.y,this.z=t.z,this):this},t.math.Vec3.zero=function(t){return t.x=t.y=t.z=0,t},e.toTypeArray=function(){var t=new Float32Array(3);return t[0]=this.x,t[1]=this.y,t[2]=this.z,t}}(cc),function(t){t.math.Vec4=function(t,e,i,n){t&&void 0===e?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t||0,this.y=e||0,this.z=i||0,this.w=n||0)},t.kmVec4=t.math.Vec4;var e=t.math.Vec4.prototype;e.fill=function(t,e,i,n){t&&void 0===e?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t,this.y=e,this.z=i,this.w=n)},e.add=function(t){return t?(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this):this},e.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},e.length=function(){return Math.sqrt(t.math.square(this.x)+t.math.square(this.y)+t.math.square(this.z)+t.math.square(this.w))},e.lengthSq=function(){return t.math.square(this.x)+t.math.square(this.y)+t.math.square(this.z)+t.math.square(this.w)},e.lerp=function(){return this},e.normalize=function(){var t=1/this.length();return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},e.scale=function(t){return this.normalize(),this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},e.subtract=function(t){this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w},e.transform=function(t){var e=this.x,i=this.y,n=this.z,r=this.w;return t=t.mat,this.x=e*t[0]+i*t[4]+n*t[8]+r*t[12],this.y=e*t[1]+i*t[5]+n*t[9]+r*t[13],this.z=e*t[2]+i*t[6]+n*t[10]+r*t[14],this.w=e*t[3]+i*t[7]+n*t[11]+r*t[15],this},t.math.Vec4.transformArray=function(e,i){for(var n=[],r=0;r<e.length;r++){var o=new t.math.Vec4(e[r]);o.transform(i),n.push(o)}return n},e.equals=function(e){var i=t.math.EPSILON;return this.x<e.x+i&&this.x>e.x-i&&this.y<e.y+i&&this.y>e.y-i&&this.z<e.z+i&&this.z>e.z-i&&this.w<e.w+i&&this.w>e.w-i},e.assignFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},e.toTypeArray=function(){var t=new Float32Array(4);return t[0]=this.x,t[1]=this.y,t[2]=this.z,t[3]=this.w,t}}(cc),function(t){function e(e,i,n){i=new t.math.Vec2(i),i.subtract(e),n.x=-i.y,n.y=i.x,n.normalize()}t.math.Ray2=function(e,i){this.start=e||new t.math.Vec2,this.dir=i||new t.math.Vec2},t.math.Ray2.prototype.fill=function(t,e,i,n){this.start.x=t,this.start.y=e,this.dir.x=i,this.dir.y=n},t.math.Ray2.prototype.intersectLineSegment=function(e,i,n){var r=this.start.x,o=this.start.y,s=this.start.x+this.dir.x,c=this.start.y+this.dir.y,a=e.x,l=e.y,h=i.x,u=i.y,d=(u-l)*(s-r)-(h-a)*(c-o);return d>-t.math.EPSILON&&d<t.math.EPSILON?!1:(l=((h-a)*(o-l)-(u-l)*(r-a))/d,a=r+l*(s-r),l=o+l*(c-o),a<Math.min(e.x,i.x)-t.math.EPSILON||a>Math.max(e.x,i.x)+t.math.EPSILON||l<Math.min(e.y,i.y)-t.math.EPSILON||l>Math.max(e.y,i.y)+t.math.EPSILON||a<Math.min(r,s)-t.math.EPSILON||a>Math.max(r,s)+t.math.EPSILON||l<Math.min(o,c)-t.math.EPSILON||l>Math.max(o,c)+t.math.EPSILON?!1:(n.x=a,n.y=l,!0))},t.math.Ray2.prototype.intersectTriangle=function(i,n,r,o,s){var c,a=new t.math.Vec2,l=new t.math.Vec2,h=new t.math.Vec2,u=1e4,d=!1;return this.intersectLineSegment(i,n,a)&&(d=!0,c=a.subtract(this.start).length(),u>c&&(l.x=a.x,l.y=a.y,u=c,e(i,n,h))),this.intersectLineSegment(n,r,a)&&(d=!0,c=a.subtract(this.start).length(),u>c&&(l.x=a.x,l.y=a.y,u=c,e(n,r,h))),this.intersectLineSegment(r,i,a)&&(d=!0,c=a.subtract(this.start).length(),u>c&&(l.x=a.x,l.y=a.y,e(r,i,h))),d&&(o.x=l.x,o.y=l.y,s&&(s.x=h.x,s.y=h.y)),d}}(cc),window.Uint16Array=window.Uint16Array||window.Array,window.Float32Array=window.Float32Array||window.Array,function(t){t.math.Matrix3=function(t){this.mat=new Float32Array(t&&t.mat?t.mat:9)},t.kmMat3=t.math.Matrix3;var e=t.math.Matrix3.prototype;e.fill=function(t){var e=this.mat;return t=t.mat,e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],this},e.adjugate=function(){var t=this.mat,e=t[0],i=t[1],n=t[2],r=t[3],o=t[4],s=t[5],c=t[6],a=t[7],l=t[8];return t[0]=o*l-s*a,t[1]=n*a-i*l,t[2]=i*s-n*o,t[3]=s*c-r*l,t[4]=e*l-n*c,t[5]=n*r-e*s,t[6]=r*a-o*c,t[8]=e*o-i*r,this},e.identity=function(){var t=this.mat;return t[1]=t[2]=t[3]=t[5]=t[6]=t[7]=0,t[0]=t[4]=t[8]=1,this};var i=new t.math.Matrix3;e.inverse=function(t){return 0===t?this:(i.assignFrom(this),t=1/t,this.adjugate(),this.multiplyScalar(t),this)},e.isIdentity=function(){var t=this.mat;return 1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&1===t[4]&&0===t[5]&&0===t[6]&&0===t[7]&&1===t[8]},e.transpose=function(){var t=this.mat,e=t[1],i=t[2],n=t[5],r=t[6],o=t[7];return t[1]=t[3],t[2]=r,t[3]=e,t[5]=o,t[6]=i,t[7]=n,this},e.determinant=function(){var t=this.mat,e=t[0]*t[4]*t[8]+t[1]*t[5]*t[6]+t[2]*t[3]*t[7];return e-=t[2]*t[4]*t[6]+t[0]*t[5]*t[7]+t[1]*t[3]*t[8]},e.multiply=function(t){var e=this.mat,i=t.mat;t=e[0];var n=e[1],r=e[2],o=e[3],s=e[4],c=e[5],a=e[6],l=e[7],h=e[8],u=i[0],d=i[1],_=i[2],p=i[3],f=i[4],m=i[5],g=i[6],y=i[7],i=i[8];return e[0]=t*u+o*d+a*_,e[1]=n*u+s*d+l*_,e[2]=r*u+c*d+h*_,e[3]=r*u+c*d+h*_,e[4]=n*p+s*f+l*m,e[5]=r*p+c*f+h*m,e[6]=t*g+o*y+a*i,e[7]=n*g+s*y+l*i,e[8]=r*g+c*y+h*i,this},e.multiplyScalar=function(t){var e=this.mat;return e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,e[4]*=t,e[5]*=t,e[6]*=t,e[7]*=t,e[8]*=t,this},t.math.Matrix3.rotationAxisAngle=function(e,i){var n=Math.cos(i),r=Math.sin(i),o=new t.math.Matrix3,s=o.mat;return s[0]=n+e.x*e.x*(1-n),s[1]=e.z*r+e.y*e.x*(1-n),s[2]=-e.y*r+e.z*e.x*(1-n),s[3]=-e.z*r+e.x*e.y*(1-n),s[4]=n+e.y*e.y*(1-n),s[5]=e.x*r+e.z*e.y*(1-n),s[6]=e.y*r+e.x*e.z*(1-n),s[7]=-e.x*r+e.y*e.z*(1-n),s[8]=n+e.z*e.z*(1-n),o},e.assignFrom=function(e){if(this===e)return t.log("cc.math.Matrix3.assign(): current matrix equals matIn"),this;var i=this.mat;return e=e.mat,i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],this},e.equals=function(e){if(this===e)return!0;var i=t.math.EPSILON,n=this.mat;e=e.mat;for(var r=0;9>r;++r)if(!(n[r]+i>e[r]&&n[r]-i<e[r]))return!1;return!0},t.math.Matrix3.createByRotationX=function(e){var i=new t.math.Matrix3,n=i.mat;return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=Math.cos(e),n[5]=Math.sin(e),n[6]=0,n[7]=-Math.sin(e),n[8]=Math.cos(e),i},t.math.Matrix3.createByRotationY=function(e){var i=new t.math.Matrix3,n=i.mat;return n[0]=Math.cos(e),n[1]=0,n[2]=-Math.sin(e),n[3]=0,n[4]=1,n[5]=0,n[6]=Math.sin(e),n[7]=0,n[8]=Math.cos(e),i},t.math.Matrix3.createByRotationZ=function(e){var i=new t.math.Matrix3,n=i.mat;return n[0]=Math.cos(e),n[1]=-Math.sin(e),n[2]=0,n[3]=Math.sin(e),n[4]=Math.cos(e),n[5]=0,n[6]=0,n[7]=0,n[8]=1,i},t.math.Matrix3.createByRotation=function(e){var i=new t.math.Matrix3,n=i.mat;return n[0]=Math.cos(e),n[1]=Math.sin(e),n[2]=0,n[3]=-Math.sin(e),n[4]=Math.cos(e),n[5]=0,n[6]=0,n[7]=0,n[8]=1,i
},t.math.Matrix3.createByScale=function(e,i){var n=new t.math.Matrix3;return n.identity(),n.mat[0]=e,n.mat[4]=i,n},t.math.Matrix3.createByTranslation=function(e,i){var n=new t.math.Matrix3;return n.identity(),n.mat[6]=e,n.mat[7]=i,n},t.math.Matrix3.createByQuaternion=function(e){if(!e)return null;var i=new t.math.Matrix3,n=i.mat;return n[0]=1-2*(e.y*e.y+e.z*e.z),n[1]=2*(e.x*e.y-e.w*e.z),n[2]=2*(e.x*e.z+e.w*e.y),n[3]=2*(e.x*e.y+e.w*e.z),n[4]=1-2*(e.x*e.x+e.z*e.z),n[5]=2*(e.y*e.z-e.w*e.x),n[6]=2*(e.x*e.z-e.w*e.y),n[7]=2*(e.y*e.z+e.w*e.x),n[8]=1-2*(e.x*e.x+e.y*e.y),i},e.rotationToAxisAngle=function(){return t.math.Quaternion.rotationMatrix(this).toAxisAndAngle()}}(cc),function(t){t.math.Matrix4=function(t){this.mat=new Float32Array(t&&t.mat?t.mat:16)},t.kmMat4=t.math.Matrix4;var e=t.math.Matrix4.prototype;e.fill=function(t){for(var e=this.mat,i=0;16>i;i++)e[i]=t[i];return this},t.kmMat4Identity=function(t){var e=t.mat;return e[1]=e[2]=e[3]=e[4]=e[6]=e[7]=e[8]=e[9]=e[11]=e[12]=e[13]=e[14]=0,e[0]=e[5]=e[10]=e[15]=1,t},e.identity=function(){var t=this.mat;return t[1]=t[2]=t[3]=t[4]=t[6]=t[7]=t[8]=t[9]=t[11]=t[12]=t[13]=t[14]=0,t[0]=t[5]=t[10]=t[15]=1,this},e.get=function(t,e){return this.mat[t+4*e]},e.set=function(t,e,i){this.mat[t+4*e]=i},e.swap=function(t,e,i,n){var r=this.mat,o=r[t+4*e];r[t+4*e]=r[i+4*n],r[i+4*n]=o},t.math.Matrix4._gaussj=function(t,e){var i,n,r,o,s,c=0,a=0,l=[0,0,0,0],h=[0,0,0,0],u=[0,0,0,0];for(i=0;4>i;i++){for(n=s=0;4>n;n++)if(1!==u[n])for(r=0;4>r;r++)0===u[r]&&(o=Math.abs(t.get(n,r)),o>=s&&(s=o,a=n,c=r));if(++u[c],a!==c){for(n=0;4>n;n++)t.swap(a,n,c,n);for(n=0;4>n;n++)e.swap(a,n,c,n)}if(h[i]=a,l[i]=c,0===t.get(c,c))return!1;for(r=1/t.get(c,c),t.set(c,c,1),n=0;4>n;n++)t.set(c,n,t.get(c,n)*r);for(n=0;4>n;n++)e.set(c,n,e.get(c,n)*r);for(r=0;4>r;r++)if(r!==c){for(o=t.get(r,c),t.set(r,c,0),n=0;4>n;n++)t.set(r,n,t.get(r,n)-t.get(c,n)*o);for(n=0;4>n;n++)e.set(r,n,t.get(r,n)-e.get(c,n)*o)}}for(n=3;n>=0;n--)if(h[n]!==l[n])for(r=0;4>r;r++)t.swap(r,h[n],r,l[n]);return!0};var i=(new t.math.Matrix4).identity();t.kmMat4Inverse=function(e,n){var r=new t.math.Matrix4(n),o=new t.math.Matrix4(i);return!1===t.math.Matrix4._gaussj(r,o)?null:(e.assignFrom(r),e)},e.inverse=function(){var e=new t.math.Matrix4(this),n=new t.math.Matrix4(i);return!1===t.math.Matrix4._gaussj(e,n)?null:e},e.isIdentity=function(){var t=this.mat;return 1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&0===t[4]&&1===t[5]&&0===t[6]&&0===t[7]&&0===t[8]&&0===t[9]&&1===t[10]&&0===t[11]&&0===t[12]&&0===t[13]&&0===t[14]&&1===t[15]},e.transpose=function(){var t=this.mat,e=t[1],i=t[2],n=t[3],r=t[6],o=t[7],s=t[8],c=t[9],a=t[11],l=t[12],h=t[13],u=t[14];return t[1]=t[4],t[2]=s,t[3]=l,t[4]=e,t[6]=c,t[7]=h,t[8]=i,t[9]=r,t[11]=u,t[12]=n,t[13]=o,t[14]=a,this},t.kmMat4Multiply=function(t,e,i){var n=t.mat,r=e.mat,o=i.mat;i=r[0],e=r[1];var s=r[2],c=r[3],a=r[4],l=r[5],h=r[6],u=r[7],d=r[8],_=r[9],p=r[10],f=r[11],m=r[12],g=r[13],y=r[14],r=r[15],T=o[0],S=o[1],C=o[2],v=o[3],x=o[4],E=o[5],b=o[6],A=o[7],R=o[8],P=o[9],I=o[10],w=o[11],L=o[12],D=o[13],O=o[14],o=o[15];return n[0]=T*i+S*a+C*d+v*m,n[1]=T*e+S*l+C*_+v*g,n[2]=T*s+S*h+C*p+v*y,n[3]=T*c+S*u+C*f+v*r,n[4]=x*i+E*a+b*d+A*m,n[5]=x*e+E*l+b*_+A*g,n[6]=x*s+E*h+b*p+A*y,n[7]=x*c+E*u+b*f+A*r,n[8]=R*i+P*a+I*d+w*m,n[9]=R*e+P*l+I*_+w*g,n[10]=R*s+P*h+I*p+w*y,n[11]=R*c+P*u+I*f+w*r,n[12]=L*i+D*a+O*d+o*m,n[13]=L*e+D*l+O*_+o*g,n[14]=L*s+D*h+O*p+o*y,n[15]=L*c+D*u+O*f+o*r,t},e.multiply=function(t){var e=this.mat,i=t.mat;t=e[0];var n=e[1],r=e[2],o=e[3],s=e[4],c=e[5],a=e[6],l=e[7],h=e[8],u=e[9],d=e[10],_=e[11],p=e[12],f=e[13],m=e[14],g=e[15],y=i[0],T=i[1],S=i[2],C=i[3],v=i[4],x=i[5],E=i[6],b=i[7],A=i[8],R=i[9],P=i[10],I=i[11],w=i[12],L=i[13],D=i[14],i=i[15];return e[0]=y*t+T*s+S*h+C*p,e[1]=y*n+T*c+S*u+C*f,e[2]=y*r+T*a+S*d+C*m,e[3]=y*o+T*l+S*_+C*g,e[4]=v*t+x*s+E*h+b*p,e[5]=v*n+x*c+E*u+b*f,e[6]=v*r+x*a+E*d+b*m,e[7]=v*o+x*l+E*_+b*g,e[8]=A*t+R*s+P*h+I*p,e[9]=A*n+R*c+P*u+I*f,e[10]=A*r+R*a+P*d+I*m,e[11]=A*o+R*l+P*_+I*g,e[12]=w*t+L*s+D*h+i*p,e[13]=w*n+L*c+D*u+i*f,e[14]=w*r+L*a+D*d+i*m,e[15]=w*o+L*l+D*_+i*g,this},t.getMat4MultiplyValue=function(t,e){var i=t.mat,n=e.mat,r=new Float32Array(16);return r[0]=i[0]*n[0]+i[4]*n[1]+i[8]*n[2]+i[12]*n[3],r[1]=i[1]*n[0]+i[5]*n[1]+i[9]*n[2]+i[13]*n[3],r[2]=i[2]*n[0]+i[6]*n[1]+i[10]*n[2]+i[14]*n[3],r[3]=i[3]*n[0]+i[7]*n[1]+i[11]*n[2]+i[15]*n[3],r[4]=i[0]*n[4]+i[4]*n[5]+i[8]*n[6]+i[12]*n[7],r[5]=i[1]*n[4]+i[5]*n[5]+i[9]*n[6]+i[13]*n[7],r[6]=i[2]*n[4]+i[6]*n[5]+i[10]*n[6]+i[14]*n[7],r[7]=i[3]*n[4]+i[7]*n[5]+i[11]*n[6]+i[15]*n[7],r[8]=i[0]*n[8]+i[4]*n[9]+i[8]*n[10]+i[12]*n[11],r[9]=i[1]*n[8]+i[5]*n[9]+i[9]*n[10]+i[13]*n[11],r[10]=i[2]*n[8]+i[6]*n[9]+i[10]*n[10]+i[14]*n[11],r[11]=i[3]*n[8]+i[7]*n[9]+i[11]*n[10]+i[15]*n[11],r[12]=i[0]*n[12]+i[4]*n[13]+i[8]*n[14]+i[12]*n[15],r[13]=i[1]*n[12]+i[5]*n[13]+i[9]*n[14]+i[13]*n[15],r[14]=i[2]*n[12]+i[6]*n[13]+i[10]*n[14]+i[14]*n[15],r[15]=i[3]*n[12]+i[7]*n[13]+i[11]*n[14]+i[15]*n[15],r},t.kmMat4Assign=function(e,i){if(e===i)return t.log("cc.kmMat4Assign(): pOut equals pIn"),e;var n=e.mat,r=i.mat;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],n[9]=r[9],n[10]=r[10],n[11]=r[11],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15],e},e.assignFrom=function(e){if(this===e)return t.log("cc.mat.Matrix4.assignFrom(): mat4 equals current matrix"),this;var i=this.mat;return e=e.mat,i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],this},e.equals=function(e){if(this===e)return t.log("cc.kmMat4AreEqual(): pMat1 and pMat2 are same object."),!0;var i=this.mat;e=e.mat;for(var n=t.math.EPSILON,r=0;16>r;r++)if(!(i[r]+n>e[r]&&i[r]-n<e[r]))return!1;return!0},t.math.Matrix4.createByRotationX=function(e,i){i=i||new t.math.Matrix4;var n=i.mat;return n[0]=1,n[3]=n[2]=n[1]=0,n[4]=0,n[5]=Math.cos(e),n[6]=Math.sin(e),n[7]=0,n[8]=0,n[9]=-Math.sin(e),n[10]=Math.cos(e),n[11]=0,n[14]=n[13]=n[12]=0,n[15]=1,i},t.math.Matrix4.createByRotationY=function(e,i){i=i||new t.math.Matrix4;var n=i.mat;return n[0]=Math.cos(e),n[1]=0,n[2]=-Math.sin(e),n[3]=0,n[7]=n[6]=n[4]=0,n[5]=1,n[8]=Math.sin(e),n[9]=0,n[10]=Math.cos(e),n[11]=0,n[14]=n[13]=n[12]=0,n[15]=1,i},t.math.Matrix4.createByRotationZ=function(e,i){i=i||new t.math.Matrix4;var n=i.mat;return n[0]=Math.cos(e),n[1]=Math.sin(e),n[3]=n[2]=0,n[4]=-Math.sin(e),n[5]=Math.cos(e),n[7]=n[6]=0,n[11]=n[9]=n[8]=0,n[10]=1,n[14]=n[13]=n[12]=0,n[15]=1,i},t.math.Matrix4.createByPitchYawRoll=function(e,i,n,r){r=r||new t.math.Matrix4;var o=Math.cos(e);e=Math.sin(e);var s=Math.cos(i);i=Math.sin(i);var c=Math.cos(n);n=Math.sin(n);var a=e*i,l=o*i,h=r.mat;return h[0]=s*c,h[4]=s*n,h[8]=-i,h[1]=a*c-o*n,h[5]=a*n+o*c,h[9]=e*s,h[2]=l*c+e*n,h[6]=l*n-e*c,h[10]=o*s,h[3]=h[7]=h[11]=0,h[15]=1,r},t.math.Matrix4.createByQuaternion=function(e,i){i=i||new t.math.Matrix4;var n=i.mat;return n[0]=1-2*(e.y*e.y+e.z*e.z),n[1]=2*(e.x*e.y+e.z*e.w),n[2]=2*(e.x*e.z-e.y*e.w),n[3]=0,n[4]=2*(e.x*e.y-e.z*e.w),n[5]=1-2*(e.x*e.x+e.z*e.z),n[6]=2*(e.z*e.y+e.x*e.w),n[7]=0,n[8]=2*(e.x*e.z+e.y*e.w),n[9]=2*(e.y*e.z-e.x*e.w),n[10]=1-2*(e.x*e.x+e.y*e.y),n[11]=0,n[14]=n[13]=n[12]=0,n[15]=1,i},t.math.Matrix4.createByRotationTranslation=function(e,i,n){n=n||new t.math.Matrix4;var r=n.mat;return e=e.mat,r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=0,r[4]=e[3],r[5]=e[4],r[6]=e[5],r[7]=0,r[8]=e[6],r[9]=e[7],r[10]=e[8],r[11]=0,r[12]=i.x,r[13]=i.y,r[14]=i.z,r[15]=1,n},t.math.Matrix4.createByScale=function(e,i,n,r){r=r||new t.math.Matrix4;var o=r.mat;return o[0]=e,o[5]=i,o[10]=n,o[15]=1,o[1]=o[2]=o[3]=o[4]=o[6]=o[7]=o[8]=o[9]=o[11]=o[12]=o[13]=o[14]=0,r},t.kmMat4Translation=function(t,e,i,n){return t.mat[0]=t.mat[5]=t.mat[10]=t.mat[15]=1,t.mat[1]=t.mat[2]=t.mat[3]=t.mat[4]=t.mat[6]=t.mat[7]=t.mat[8]=t.mat[9]=t.mat[11]=0,t.mat[12]=e,t.mat[13]=i,t.mat[14]=n,t},t.math.Matrix4.createByTranslation=function(e,i,n,r){return r=r||new t.math.Matrix4,r.identity(),r.mat[12]=e,r.mat[13]=i,r.mat[14]=n,r},e.getUpVec3=function(){var e=this.mat;return new t.math.Vec3(e[4],e[5],e[6]).normalize()},e.getRightVec3=function(){var e=this.mat;return new t.math.Vec3(e[0],e[1],e[2]).normalize()},e.getForwardVec3=function(){var e=this.mat;return new t.math.Vec3(e[8],e[9],e[10]).normalize()},t.kmMat4PerspectiveProjection=function(e,i,n,r,o){var s=t.degreesToRadians(i/2);i=o-r;var c=Math.sin(s);return 0===i||0===c||0===n?null:(s=Math.cos(s)/c,e.identity(),e.mat[0]=s/n,e.mat[5]=s,e.mat[10]=-(o+r)/i,e.mat[11]=-1,e.mat[14]=-2*r*o/i,e.mat[15]=0,e)},t.math.Matrix4.createPerspectiveProjection=function(e,i,n,r){var o=t.degreesToRadians(e/2);e=r-n;var s=Math.sin(o);if(0===e||0===s||0===i)return null;var o=Math.cos(o)/s,s=new t.math.Matrix4,c=s.mat;return s.identity(),c[0]=o/i,c[5]=o,c[10]=-(r+n)/e,c[11]=-1,c[14]=-2*n*r/e,c[15]=0,s},t.kmMat4OrthographicProjection=function(t,e,i,n,r,o,s){return t.identity(),t.mat[0]=2/(i-e),t.mat[5]=2/(r-n),t.mat[10]=-2/(s-o),t.mat[12]=-((i+e)/(i-e)),t.mat[13]=-((r+n)/(r-n)),t.mat[14]=-((s+o)/(s-o)),t},t.math.Matrix4.createOrthographicProjection=function(e,i,n,r,o,s){var c=new t.math.Matrix4,a=c.mat;return c.identity(),a[0]=2/(i-e),a[5]=2/(r-n),a[10]=-2/(s-o),a[12]=-((i+e)/(i-e)),a[13]=-((r+n)/(r-n)),a[14]=-((s+o)/(s-o)),c},t.kmMat4LookAt=function(e,i,n,r){n=new t.math.Vec3(n);var o=new t.math.Vec3(r);return n.subtract(i),n.normalize(),o.normalize(),r=new t.math.Vec3(n),r.cross(o),r.normalize(),o=new t.math.Vec3(r),o.cross(n),r.normalize(),e.identity(),e.mat[0]=r.x,e.mat[4]=r.y,e.mat[8]=r.z,e.mat[1]=o.x,e.mat[5]=o.y,e.mat[9]=o.z,e.mat[2]=-n.x,e.mat[6]=-n.y,e.mat[10]=-n.z,i=t.math.Matrix4.createByTranslation(-i.x,-i.y,-i.z),e.multiply(i),e};var n=new t.math.Matrix4;e.lookAt=function(e,i,r){i=new t.math.Vec3(i);var o=new t.math.Vec3(r);r=this.mat,i.subtract(e),i.normalize(),o.normalize();var s=new t.math.Vec3(i);return s.cross(o),s.normalize(),o=new t.math.Vec3(s),o.cross(i),s.normalize(),this.identity(),r[0]=s.x,r[4]=s.y,r[8]=s.z,r[1]=o.x,r[5]=o.y,r[9]=o.z,r[2]=-i.x,r[6]=-i.y,r[10]=-i.z,n=t.math.Matrix4.createByTranslation(-e.x,-e.y,-e.z,n),this.multiply(n),this},t.kmMat4RotationAxisAngle=function(e,i,n){var r=Math.cos(n);return n=Math.sin(n),i=new t.math.Vec3(i),i.normalize(),e.mat[0]=r+i.x*i.x*(1-r),e.mat[1]=i.z*n+i.y*i.x*(1-r),e.mat[2]=-i.y*n+i.z*i.x*(1-r),e.mat[3]=0,e.mat[4]=-i.z*n+i.x*i.y*(1-r),e.mat[5]=r+i.y*i.y*(1-r),e.mat[6]=i.x*n+i.z*i.y*(1-r),e.mat[7]=0,e.mat[8]=i.y*n+i.x*i.z*(1-r),e.mat[9]=-i.x*n+i.y*i.z*(1-r),e.mat[10]=r+i.z*i.z*(1-r),e.mat[11]=0,e.mat[12]=0,e.mat[13]=0,e.mat[14]=0,e.mat[15]=1,e},t.math.Matrix4.createByAxisAndAngle=function(e,i,n){n=n||new t.math.Matrix4;var r=this.mat,o=Math.cos(i);return i=Math.sin(i),e=new t.math.Vec3(e),e.normalize(),r[0]=o+e.x*e.x*(1-o),r[1]=e.z*i+e.y*e.x*(1-o),r[2]=-e.y*i+e.z*e.x*(1-o),r[3]=0,r[4]=-e.z*i+e.x*e.y*(1-o),r[5]=o+e.y*e.y*(1-o),r[6]=e.x*i+e.z*e.y*(1-o),r[7]=0,r[8]=e.y*i+e.x*e.z*(1-o),r[9]=-e.x*i+e.y*e.z*(1-o),r[10]=o+e.z*e.z*(1-o),r[11]=0,r[12]=r[13]=r[14]=0,r[15]=1,n},e.extractRotation=function(){var e=new t.math.Matrix3,i=this.mat,n=e.mat;return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[4],n[4]=i[5],n[5]=i[6],n[6]=i[8],n[7]=i[9],n[8]=i[10],e},e.extractPlane=function(e){var i=new t.math.Plane,n=this.mat;switch(e){case t.math.Plane.RIGHT:i.a=n[3]-n[0],i.b=n[7]-n[4],i.c=n[11]-n[8],i.d=n[15]-n[12];break;case t.math.Plane.LEFT:i.a=n[3]+n[0],i.b=n[7]+n[4],i.c=n[11]+n[8],i.d=n[15]+n[12];break;case t.math.Plane.BOTTOM:i.a=n[3]+n[1],i.b=n[7]+n[5],i.c=n[11]+n[9],i.d=n[15]+n[13];break;case t.math.Plane.TOP:i.a=n[3]-n[1],i.b=n[7]-n[5],i.c=n[11]-n[9],i.d=n[15]-n[13];break;case t.math.Plane.FAR:i.a=n[3]-n[2],i.b=n[7]-n[6],i.c=n[11]-n[10],i.d=n[15]-n[14];break;case t.math.Plane.NEAR:i.a=n[3]+n[2],i.b=n[7]+n[6],i.c=n[11]+n[10],i.d=n[15]+n[14];break;default:t.log("cc.math.Matrix4.extractPlane: Invalid plane index")}return e=Math.sqrt(i.a*i.a+i.b*i.b+i.c*i.c),i.a/=e,i.b/=e,i.c/=e,i.d/=e,i},e.toAxisAndAngle=function(){var e=this.extractRotation();return t.math.Quaternion.rotationMatrix(e).toAxisAndAngle()}}(cc),function(t){t.math.Plane=function(t,e,i,n){t&&void 0===e?(this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d):(this.a=t||0,this.b=e||0,this.c=i||0,this.d=n||0)},t.kmPlane=t.math.Plane;var e=t.math.Plane.prototype;t.math.Plane.LEFT=0,t.math.Plane.RIGHT=1,t.math.Plane.BOTTOM=2,t.math.Plane.TOP=3,t.math.Plane.NEAR=4,t.math.Plane.FAR=5,t.math.Plane.POINT_INFRONT_OF_PLANE=0,t.math.Plane.POINT_BEHIND_PLANE=1,t.math.Plane.POINT_ON_PLANE=2,e.dot=function(t){return this.a*t.x+this.b*t.y+this.c*t.z+this.d*t.w},e.dotCoord=function(t){return this.a*t.x+this.b*t.y+this.c*t.z+this.d},e.dotNormal=function(t){return this.a*t.x+this.b*t.y+this.c*t.z},t.math.Plane.fromPointNormal=function(e,i){return new t.math.Plane(i.x,i.y,i.z,-i.dot(e))},t.math.Plane.fromPoints=function(e,i,n){i=new t.math.Vec3(i),n=new t.math.Vec3(n);var r=new t.math.Plane;return i.subtract(e),n.subtract(e),i.cross(n),i.normalize(),r.a=i.x,r.b=i.y,r.c=i.z,r.d=i.scale(-1).dot(e),r},e.normalize=function(){var e=new t.math.Vec3(this.a,this.b,this.c),i=1/e.length();return e.normalize(),this.a=e.x,this.b=e.y,this.c=e.z,this.d*=i,this},e.classifyPoint=function(e){return e=this.a*e.x+this.b*e.y+this.c*e.z+this.d,e>.001?t.math.Plane.POINT_INFRONT_OF_PLANE:-.001>e?t.math.Plane.POINT_BEHIND_PLANE:t.math.Plane.POINT_ON_PLANE}}(cc),function(t){t.math.Quaternion=function(t,e,i,n){t&&void 0===e?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t||0,this.y=e||0,this.z=i||0,this.w=n||0)},t.kmQuaternion=t.math.Quaternion;var e=t.math.Quaternion.prototype;e.conjugate=function(t){return this.x=-t.x,this.y=-t.y,this.z=-t.z,this.w=t.w,this},e.dot=function(t){return this.w*t.w+this.x*t.x+this.y*t.y+this.z*t.z},e.exponential=function(){return this},e.identity=function(){return this.z=this.y=this.x=0,this.w=1,this},e.inverse=function(){var e=this.length();return Math.abs(e)>t.math.EPSILON?(this.w=this.z=this.y=this.x=0,this):(this.conjugate(this).scale(1/e),this)},e.isIdentity=function(){return 0===this.x&&0===this.y&&0===this.z&&1===this.w},e.length=function(){return Math.sqrt(this.lengthSq())},e.lengthSq=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},e.multiply=function(t){var e=this.x,i=this.y,n=this.z,r=this.w;return this.w=r*t.w-e*t.x-i*t.y-n*t.z,this.x=r*t.x+e*t.w+i*t.z-n*t.y,this.y=r*t.y+i*t.w+n*t.x-e*t.z,this.z=r*t.z+n*t.w+e*t.y-i*t.x,this},e.normalize=function(){var e=this.length();if(Math.abs(e)<=t.math.EPSILON)throw"current quaternion is an invalid value";return this.scale(1/e),this},e.rotationAxis=function(t,e){var i=.5*e,n=Math.sin(i);return this.w=Math.cos(i),this.x=t.x*n,this.y=t.y*n,this.z=t.z*n,this},t.math.Quaternion.rotationMatrix=function(e){if(!e)return null;var i,n,r;i=[],n=e.mat,e=0,i[0]=n[0],i[1]=n[3],i[2]=n[6],i[4]=n[1],i[5]=n[4],i[6]=n[7],i[8]=n[2],i[9]=n[5],i[10]=n[8],i[15]=1;var o=i[0];return e=o[0]+o[5]+o[10]+1,e>t.math.EPSILON?(e=2*Math.sqrt(e),i=(o[9]-o[6])/e,n=(o[2]-o[8])/e,r=(o[4]-o[1])/e,e*=.25):o[0]>o[5]&&o[0]>o[10]?(e=2*Math.sqrt(1+o[0]-o[5]-o[10]),i=.25*e,n=(o[4]+o[1])/e,r=(o[2]+o[8])/e,e=(o[9]-o[6])/e):o[5]>o[10]?(e=2*Math.sqrt(1+o[5]-o[0]-o[10]),i=(o[4]+o[1])/e,n=.25*e,r=(o[9]+o[6])/e,e=(o[2]-o[8])/e):(e=2*Math.sqrt(1+o[10]-o[0]-o[5]),i=(o[2]+o[8])/e,n=(o[9]+o[6])/e,r=.25*e,e=(o[4]-o[1])/e),new t.math.Quaternion(i,n,r,e)},t.math.Quaternion.rotationYawPitchRoll=function(e,i,n){var r,o,s,c,a;r=t.degreesToRadians(i)/2,o=t.degreesToRadians(e)/2,s=t.degreesToRadians(n)/2,n=Math.cos(r),e=Math.cos(o),i=Math.cos(s),r=Math.sin(r),o=Math.sin(o),s=Math.sin(s),c=e*i,a=o*s;var l=new t.math.Quaternion;return l.w=n*c+r*a,l.x=r*c-n*a,l.y=n*o*i+r*e*s,l.z=n*e*s-r*o*i,l.normalize(),l},e.slerp=function(e,i){if(this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w)return this;var n=this.dot(e),r=Math.acos(n),o=Math.sqrt(1-t.math.square(n)),n=Math.sin(i*r)/o,r=Math.sin((1-i)*r)/o,o=new t.math.Quaternion(e);return this.scale(r),o.scale(n),this.add(o),this},e.toAxisAndAngle=function(){var e,i,n=new t.math.Vec3;return e=Math.acos(this.w),i=Math.sqrt(t.math.square(this.x)+t.math.square(this.y)+t.math.square(this.z)),i>-t.math.EPSILON&&i<t.math.EPSILON||i<2*Math.PI+t.math.EPSILON&&i>2*Math.PI-t.math.EPSILON?(e=0,n.x=0,n.y=0,n.z=1):(e*=2,n.x=this.x/i,n.y=this.y/i,n.z=this.z/i,n.normalize()),{axis:n,angle:e}},e.scale=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},e.assignFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},e.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},t.math.Quaternion.rotationBetweenVec3=function(e,i,n){var r=new t.math.Vec3(e),o=new t.math.Vec3(i);r.normalize(),o.normalize();var s=r.dot(o);return i=new t.math.Quaternion,s>=1?(i.identity(),i):(-.999999>s?Math.abs(n.lengthSq())<t.math.EPSILON?i.rotationAxis(n,Math.PI):(r=new t.math.Vec3(1,0,0),r.cross(e),Math.abs(r.lengthSq())<t.math.EPSILON&&(r.fill(0,1,0),r.cross(e)),r.normalize(),i.rotationAxis(r,Math.PI)):(e=Math.sqrt(2*(1+s)),n=1/e,r.cross(o),i.x=r.x*n,i.y=r.y*n,i.z=r.z*n,i.w=.5*e,i.normalize()),i)},e.multiplyVec3=function(e){var i=this.x,n=this.y,r=this.z,o=new t.math.Vec3(e),s=new t.math.Vec3(i,n,r),i=new t.math.Vec3(i,n,r);return s.cross(e),i.cross(s),s.scale(2*q.w),i.scale(2),o.add(s),o.add(i),o}}(cc),cc.math.AABB=function(t,e){this.min=t||new cc.math.Vec3,this.max=e||new cc.math.Vec3},cc.math.AABB.prototype.containsPoint=function(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z},cc.math.AABB.containsPoint=function(t,e){return t.x>=e.min.x&&t.x<=e.max.x&&t.y>=e.min.y&&t.y<=e.max.y&&t.z>=e.min.z&&t.z<=e.max.z},cc.math.AABB.prototype.assignFrom=function(t){this.min.assignFrom(t.min),this.max.assignFrom(t.max)},cc.math.AABB.assign=function(t,e){return t.min.assignFrom(e.min),t.max.assignFrom(e.max),t},function(t){t.math.Matrix4Stack=function(t,e){this.top=t,this.stack=e||[]},t.km_mat4_stack=t.math.Matrix4Stack;var e=t.math.Matrix4Stack.prototype;e.initialize=function(){this.stack.length=0,this.top=null},t.km_mat4_stack_push=function(e,i){e.stack.push(e.top),e.top=new t.math.Matrix4(i)},t.km_mat4_stack_pop=function(t){t.top=t.stack.pop()},t.km_mat4_stack_release=function(t){t.stack=null,t.top=null},e.push=function(e){e=e||this.top,this.stack.push(this.top),this.top=new t.math.Matrix4(e)},e.pop=function(){this.top=this.stack.pop()},e.release=function(){this._matrixPool=this.top=this.stack=null},e._getFromPool=function(e){var i=this._matrixPool;return 0===i.length?new t.math.Matrix4(e):(i=i.pop(),i.assignFrom(e),i)},e._putInPool=function(t){this._matrixPool.push(t)}}(cc),function(t){t.KM_GL_MODELVIEW=5888,t.KM_GL_PROJECTION=5889,t.KM_GL_TEXTURE=5890,t.modelview_matrix_stack=new t.math.Matrix4Stack,t.projection_matrix_stack=new t.math.Matrix4Stack,t.texture_matrix_stack=new t.math.Matrix4Stack,t.current_stack=null,t.lazyInitialize=function(){var e=new t.math.Matrix4;t.modelview_matrix_stack.initialize(),t.projection_matrix_stack.initialize(),t.texture_matrix_stack.initialize(),t.current_stack=t.modelview_matrix_stack,t.initialized=!0,e.identity(),t.modelview_matrix_stack.push(e),t.projection_matrix_stack.push(e),t.texture_matrix_stack.push(e)},t.lazyInitialize(),t.kmGLFreeAll=function(){t.modelview_matrix_stack.release(),t.modelview_matrix_stack=null,t.projection_matrix_stack.release(),t.projection_matrix_stack=null,t.texture_matrix_stack.release(),t.texture_matrix_stack=null,t.initialized=!1,t.current_stack=null},t.kmGLPushMatrix=function(){t.current_stack.push(t.current_stack.top)},t.kmGLPushMatrixWitMat4=function(e){t.current_stack.stack.push(t.current_stack.top),e.assignFrom(t.current_stack.top),t.current_stack.top=e},t.kmGLPopMatrix=function(){t.current_stack.top=t.current_stack.stack.pop()},t.kmGLMatrixMode=function(e){switch(e){case t.KM_GL_MODELVIEW:t.current_stack=t.modelview_matrix_stack;break;case t.KM_GL_PROJECTION:t.current_stack=t.projection_matrix_stack;break;case t.KM_GL_TEXTURE:t.current_stack=t.texture_matrix_stack;break;default:throw"Invalid matrix mode specified"}},t.kmGLLoadIdentity=function(){t.current_stack.top.identity()},t.kmGLLoadMatrix=function(e){t.current_stack.top.assignFrom(e)},t.kmGLMultMatrix=function(e){t.current_stack.top.multiply(e)};var e=new t.math.Matrix4;t.kmGLTranslatef=function(i,n,r){i=t.math.Matrix4.createByTranslation(i,n,r,e),t.current_stack.top.multiply(i)};var i=new t.math.Vec3;t.kmGLRotatef=function(n,r,o,s){i.fill(r,o,s),n=t.math.Matrix4.createByAxisAndAngle(i,t.degreesToRadians(n),e),t.current_stack.top.multiply(n)},t.kmGLScalef=function(i,n,r){i=t.math.Matrix4.createByScale(i,n,r,e),t.current_stack.top.multiply(i)},t.kmGLGetMatrix=function(e,i){switch(e){case t.KM_GL_MODELVIEW:i.assignFrom(t.modelview_matrix_stack.top);break;case t.KM_GL_PROJECTION:i.assignFrom(t.projection_matrix_stack.top);break;case t.KM_GL_TEXTURE:i.assignFrom(t.texture_matrix_stack.top);break;default:throw"Invalid matrix mode specified"}}}(cc),cc.SHADER_POSITION_UCOLOR_FRAG="precision lowp float;\nvarying vec4 v_fragmentColor;\nvoid main()                              \n{ \n    gl_FragColor = v_fragmentColor;      \n}\n",cc.SHADER_POSITION_UCOLOR_VERT="attribute vec4 a_position;\nuniform    vec4 u_color;\nuniform float u_pointSize;\nvarying lowp vec4 v_fragmentColor; \nvoid main(void)   \n{\n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n    gl_PointSize = u_pointSize;          \n    v_fragmentColor = u_color;           \n}",cc.SHADER_POSITION_COLOR_FRAG="precision lowp float; \nvarying vec4 v_fragmentColor; \nvoid main() \n{ \n     gl_FragColor = v_fragmentColor; \n} ",cc.SHADER_POSITION_COLOR_VERT="attribute vec4 a_position;\nattribute vec4 a_color;\nvarying lowp vec4 v_fragmentColor;\nvoid main()\n{\n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_fragmentColor = a_color;             \n}",cc.SHADER_POSITION_COLOR_LENGTH_TEXTURE_FRAG="// #extension GL_OES_standard_derivatives : enable\nvarying mediump vec4 v_color;\nvarying mediump vec2 v_texcoord;\nvoid main()	\n{ \n// #if defined GL_OES_standard_derivatives	\n// gl_FragColor = v_color*smoothstep(0.0, length(fwidth(v_texcoord)), 1.0 - length(v_texcoord)); \n// #else	\ngl_FragColor = v_color * step(0.0, 1.0 - length(v_texcoord)); \n// #endif \n}",cc.SHADER_POSITION_COLOR_LENGTH_TEXTURE_VERT="attribute mediump vec4 a_position; \nattribute mediump vec2 a_texcoord; \nattribute mediump vec4 a_color;	\nvarying mediump vec4 v_color; \nvarying mediump vec2 v_texcoord;	\nvoid main() \n{ \n     v_color = a_color;//vec4(a_color.rgb * a_color.a, a_color.a); \n     v_texcoord = a_texcoord; \n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n}",cc.SHADER_POSITION_TEXTURE_FRAG="precision lowp float;   \nvarying vec2 v_texCoord;  \nvoid main() \n{  \n    gl_FragColor =  texture2D(CC_Texture0, v_texCoord);   \n}",cc.SHADER_POSITION_TEXTURE_VERT="attribute vec4 a_position; \nattribute vec2 a_texCoord; \nvarying mediump vec2 v_texCoord; \nvoid main() \n{ \n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_texCoord = a_texCoord;               \n}",cc.SHADER_POSITION_TEXTURE_UCOLOR_FRAG="precision lowp float;  \nuniform vec4 u_color; \nvarying vec2 v_texCoord; \nvoid main() \n{  \n    gl_FragColor =  texture2D(CC_Texture0, v_texCoord) * u_color;    \n}",cc.SHADER_POSITION_TEXTURE_UCOLOR_VERT="attribute vec4 a_position;\nattribute vec2 a_texCoord; \nvarying mediump vec2 v_texCoord; \nvoid main() \n{ \n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_texCoord = a_texCoord;                 \n}",cc.SHADER_POSITION_TEXTURE_A8COLOR_FRAG="precision lowp float;  \nvarying vec4 v_fragmentColor; \nvarying vec2 v_texCoord; \nvoid main() \n{ \n    gl_FragColor = vec4( v_fragmentColor.rgb,         \n        v_fragmentColor.a * texture2D(CC_Texture0, v_texCoord).a   \n    ); \n}",cc.SHADER_POSITION_TEXTURE_A8COLOR_VERT="attribute vec4 a_position; \nattribute vec2 a_texCoord; \nattribute vec4 a_color;  \nvarying lowp vec4 v_fragmentColor; \nvarying mediump vec2 v_texCoord; \nvoid main() \n{ \n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_fragmentColor = a_color; \n    v_texCoord = a_texCoord; \n}",cc.SHADER_POSITION_TEXTURE_COLOR_FRAG="precision lowp float;\nvarying vec4 v_fragmentColor; \nvarying vec2 v_texCoord; \nvoid main() \n{ \n    gl_FragColor = v_fragmentColor * texture2D(CC_Texture0, v_texCoord); \n}",cc.SHADER_POSITION_TEXTURE_COLOR_VERT="attribute vec4 a_position; \nattribute vec2 a_texCoord; \nattribute vec4 a_color;  \nvarying lowp vec4 v_fragmentColor; \nvarying mediump vec2 v_texCoord; \nvoid main() \n{ \n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_fragmentColor = a_color; \n    v_texCoord = a_texCoord; \n}",cc.SHADER_POSITION_TEXTURE_COLOR_ALPHATEST_FRAG="precision lowp float;   \nvarying vec4 v_fragmentColor; \nvarying vec2 v_texCoord;   \nuniform float CC_alpha_value; \nvoid main() \n{  \n    vec4 texColor = texture2D(CC_Texture0, v_texCoord);  \n    if ( texColor.a <= CC_alpha_value )          \n        discard; \n    gl_FragColor = texColor * v_fragmentColor;  \n}",cc.SHADEREX_SWITCHMASK_FRAG="precision lowp float; \nvarying vec4 v_fragmentColor; \nvarying vec2 v_texCoord; \nuniform sampler2D u_texture;  \nuniform sampler2D   u_mask;   \nvoid main()  \n{  \n    vec4 texColor   = texture2D(u_texture, v_texCoord);  \n    vec4 maskColor  = texture2D(u_mask, v_texCoord); \n    vec4 finalColor = vec4(texColor.r, texColor.g, texColor.b, maskColor.a * texColor.a);        \n    gl_FragColor    = v_fragmentColor * finalColor; \n}",cc.shaderCache={TYPE_POSITION_TEXTURECOLOR:0,TYPE_POSITION_TEXTURECOLOR_ALPHATEST:1,TYPE_POSITION_COLOR:2,TYPE_POSITION_TEXTURE:3,TYPE_POSITION_TEXTURE_UCOLOR:4,TYPE_POSITION_TEXTURE_A8COLOR:5,TYPE_POSITION_UCOLOR:6,TYPE_POSITION_LENGTH_TEXTURECOLOR:7,TYPE_MAX:8,_programs:{},_init:function(){return this.loadDefaultShaders(),!0},_loadDefaultShader:function(t,e){switch(e){case this.TYPE_POSITION_TEXTURECOLOR:t.initWithVertexShaderByteArray(cc.SHADER_POSITION_TEXTURE_COLOR_VERT,cc.SHADER_POSITION_TEXTURE_COLOR_FRAG),t.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),t.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR),t.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_POSITION_TEXTURECOLOR_ALPHATEST:t.initWithVertexShaderByteArray(cc.SHADER_POSITION_TEXTURE_COLOR_VERT,cc.SHADER_POSITION_TEXTURE_COLOR_ALPHATEST_FRAG),t.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),t.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR),t.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_POSITION_COLOR:t.initWithVertexShaderByteArray(cc.SHADER_POSITION_COLOR_VERT,cc.SHADER_POSITION_COLOR_FRAG),t.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),t.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR);break;case this.TYPE_POSITION_TEXTURE:t.initWithVertexShaderByteArray(cc.SHADER_POSITION_TEXTURE_VERT,cc.SHADER_POSITION_TEXTURE_FRAG),t.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),t.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_POSITION_TEXTURE_UCOLOR:t.initWithVertexShaderByteArray(cc.SHADER_POSITION_TEXTURE_UCOLOR_VERT,cc.SHADER_POSITION_TEXTURE_UCOLOR_FRAG),t.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),t.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_POSITION_TEXTURE_A8COLOR:t.initWithVertexShaderByteArray(cc.SHADER_POSITION_TEXTURE_A8COLOR_VERT,cc.SHADER_POSITION_TEXTURE_A8COLOR_FRAG),t.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),t.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR),t.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_POSITION_UCOLOR:t.initWithVertexShaderByteArray(cc.SHADER_POSITION_UCOLOR_VERT,cc.SHADER_POSITION_UCOLOR_FRAG),t.addAttribute("aVertex",cc.VERTEX_ATTRIB_POSITION);break;case this.TYPE_POSITION_LENGTH_TEXTURECOLOR:t.initWithVertexShaderByteArray(cc.SHADER_POSITION_COLOR_LENGTH_TEXTURE_VERT,cc.SHADER_POSITION_COLOR_LENGTH_TEXTURE_FRAG),t.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),t.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS),t.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR);break;default:return void cc.log("cocos2d: cc.shaderCache._loadDefaultShader, error shader type")}t.link(),t.updateUniforms()},loadDefaultShaders:function(){var t=new cc.GLProgram;this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURECOLOR),this._programs[cc.SHADER_POSITION_TEXTURECOLOR]=t,this._programs.ShaderPositionTextureColor=t,t=new cc.GLProgram,this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURECOLOR_ALPHATEST),this._programs[cc.SHADER_POSITION_TEXTURECOLORALPHATEST]=t,this._programs.ShaderPositionTextureColorAlphaTest=t,t=new cc.GLProgram,this._loadDefaultShader(t,this.TYPE_POSITION_COLOR),this._programs[cc.SHADER_POSITION_COLOR]=t,this._programs.ShaderPositionColor=t,t=new cc.GLProgram,this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURE),this._programs[cc.SHADER_POSITION_TEXTURE]=t,this._programs.ShaderPositionTexture=t,t=new cc.GLProgram,this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURE_UCOLOR),this._programs[cc.SHADER_POSITION_TEXTURE_UCOLOR]=t,this._programs.ShaderPositionTextureUColor=t,t=new cc.GLProgram,this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURE_A8COLOR),this._programs[cc.SHADER_POSITION_TEXTUREA8COLOR]=t,this._programs.ShaderPositionTextureA8Color=t,t=new cc.GLProgram,this._loadDefaultShader(t,this.TYPE_POSITION_UCOLOR),this._programs[cc.SHADER_POSITION_UCOLOR]=t,this._programs.ShaderPositionUColor=t,t=new cc.GLProgram,this._loadDefaultShader(t,this.TYPE_POSITION_LENGTH_TEXTURECOLOR),this._programs[cc.SHADER_POSITION_LENGTHTEXTURECOLOR]=t,this._programs.ShaderPositionLengthTextureColor=t},reloadDefaultShaders:function(){var t=this.programForKey(cc.SHADER_POSITION_TEXTURECOLOR);t.reset(),this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURECOLOR),t=this.programForKey(cc.SHADER_POSITION_TEXTURECOLORALPHATEST),t.reset(),this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURECOLOR_ALPHATEST),t=this.programForKey(cc.SHADER_POSITION_COLOR),t.reset(),this._loadDefaultShader(t,this.TYPE_POSITION_COLOR),t=this.programForKey(cc.SHADER_POSITION_TEXTURE),t.reset(),this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURE),t=this.programForKey(cc.SHADER_POSITION_TEXTURE_UCOLOR),t.reset(),this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURE_UCOLOR),t=this.programForKey(cc.SHADER_POSITION_TEXTUREA8COLOR),t.reset(),this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURE_A8COLOR),t=this.programForKey(cc.SHADER_POSITION_UCOLOR),t.reset(),this._loadDefaultShader(t,this.TYPE_POSITION_UCOLOR)},programForKey:function(t){return this._programs[t]},getProgram:function(t){return this._programs[t]},addProgram:function(t,e){this._programs[e]=t}},cc.HashUniformEntry=function(t,e,i){this.value=t,this.location=e,this.hh=i||{}},cc.GLProgram=cc.Class.extend({_glContext:null,_programObj:null,_vertShader:null,_fragShader:null,_uniforms:null,_hashForUniforms:null,_usesTime:!1,_updateUniformLocation:function(t,e,i){if(null==t)return!1;i=!0;for(var n=null,r=0;r<this._hashForUniforms.length;r++)this._hashForUniforms[r].location==t&&(n=this._hashForUniforms[r]);return n?n.value==e?i=!1:n.value=e:(n=new cc.HashUniformEntry,n.location=t,n.value=e,this._hashForUniforms.push(n)),i},_description:function(){return"<CCGLProgram = "+this.toString()+" | Program = "+this._programObj.toString()+", VertexShader = "+this._vertShader.toString()+", FragmentShader = "+this._fragShader.toString()+">"},_compileShader:function(t,e,i){return i&&t?(i=(cc.GLProgram._isHighpSupported()?"precision highp float;\n":"precision mediump float;\n")+"uniform mat4 CC_PMatrix;         \nuniform mat4 CC_MVMatrix;        \nuniform mat4 CC_MVPMatrix;       \nuniform vec4 CC_Time;            \nuniform vec4 CC_SinTime;         \nuniform vec4 CC_CosTime;         \nuniform vec4 CC_Random01;        \nuniform sampler2D CC_Texture0;   \n//CC INCLUDES END                \n"+i,this._glContext.shaderSource(t,i),this._glContext.compileShader(t),i=this._glContext.getShaderParameter(t,this._glContext.COMPILE_STATUS),i||(cc.log("cocos2d: ERROR: Failed to compile shader:\n"+this._glContext.getShaderSource(t)),cc.log(e===this._glContext.VERTEX_SHADER?"cocos2d: \n"+this.vertexShaderLog():"cocos2d: \n"+this.fragmentShaderLog())),!0===i):!1
},ctor:function(t,e,i){this._uniforms=[],this._hashForUniforms=[],this._glContext=i||cc._renderContext,t&&e&&this.init(t,e)},destroyProgram:function(){this._hashForUniforms=this._uniforms=this._fragShader=this._vertShader=null,this._glContext.deleteProgram(this._programObj)},initWithVertexShaderByteArray:function(t,e){var i=this._glContext;return this._programObj=i.createProgram(),this._fragShader=this._vertShader=null,t&&(this._vertShader=i.createShader(i.VERTEX_SHADER),this._compileShader(this._vertShader,i.VERTEX_SHADER,t)||cc.log("cocos2d: ERROR: Failed to compile vertex shader")),e&&(this._fragShader=i.createShader(i.FRAGMENT_SHADER),this._compileShader(this._fragShader,i.FRAGMENT_SHADER,e)||cc.log("cocos2d: ERROR: Failed to compile fragment shader")),this._vertShader&&i.attachShader(this._programObj,this._vertShader),cc.checkGLErrorDebug(),this._fragShader&&i.attachShader(this._programObj,this._fragShader),this._hashForUniforms.length=0,cc.checkGLErrorDebug(),!0},initWithString:function(t,e){return this.initWithVertexShaderByteArray(t,e)},initWithVertexShaderFilename:function(t,e){var i=cc.loader.getRes(t);if(!i)throw"Please load the resource firset : "+t;var n=cc.loader.getRes(e);if(!n)throw"Please load the resource firset : "+e;return this.initWithVertexShaderByteArray(i,n)},init:function(t,e){return this.initWithVertexShaderFilename(t,e)},addAttribute:function(t,e){this._glContext.bindAttribLocation(this._programObj,e,t)},link:function(){return this._programObj?(this._glContext.linkProgram(this._programObj),this._vertShader&&this._glContext.deleteShader(this._vertShader),this._fragShader&&this._glContext.deleteShader(this._fragShader),this._fragShader=this._vertShader=null,cc.game.config[cc.game.CONFIG_KEY.debugMode]&&!this._glContext.getProgramParameter(this._programObj,this._glContext.LINK_STATUS)?(cc.log("cocos2d: ERROR: Failed to link program: "+this._glContext.getProgramInfoLog(this._programObj)),cc.glDeleteProgram(this._programObj),this._programObj=null,!1):!0):(cc.log("cc.GLProgram.link(): Cannot link invalid program"),!1)},use:function(){cc.glUseProgram(this._programObj)},updateUniforms:function(){this._uniforms[cc.UNIFORM_PMATRIX]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_PMATRIX_S),this._uniforms[cc.UNIFORM_MVMATRIX]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_MVMATRIX_S),this._uniforms[cc.UNIFORM_MVPMATRIX]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_MVPMATRIX_S),this._uniforms[cc.UNIFORM_TIME]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_TIME_S),this._uniforms[cc.UNIFORM_SINTIME]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_SINTIME_S),this._uniforms[cc.UNIFORM_COSTIME]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_COSTIME_S),this._usesTime=null!=this._uniforms[cc.UNIFORM_TIME]||null!=this._uniforms[cc.UNIFORM_SINTIME]||null!=this._uniforms[cc.UNIFORM_COSTIME],this._uniforms[cc.UNIFORM_RANDOM01]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_RANDOM01_S),this._uniforms[cc.UNIFORM_SAMPLER]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_SAMPLER_S),this.use(),this.setUniformLocationWith1i(this._uniforms[cc.UNIFORM_SAMPLER],0)},getUniformLocationForName:function(t){if(!t)throw"cc.GLProgram.getUniformLocationForName(): uniform name should be non-null";if(!this._programObj)throw"cc.GLProgram.getUniformLocationForName(): Invalid operation. Cannot get uniform location when program is not initialized";return this._glContext.getUniformLocation(this._programObj,t)},getUniformMVPMatrix:function(){return this._uniforms[cc.UNIFORM_MVPMATRIX]},getUniformSampler:function(){return this._uniforms[cc.UNIFORM_SAMPLER]},setUniformLocationWith1i:function(t,e){this._updateUniformLocation(t,e)&&this._glContext.uniform1i(t,e)},setUniformLocationWith2i:function(t,e,i){this._updateUniformLocation(t,[e,i])&&this._glContext.uniform2i(t,e,i)},setUniformLocationWith3i:function(t,e,i,n){this._updateUniformLocation(t,[e,i,n])&&this._glContext.uniform3i(t,e,i,n)},setUniformLocationWith4i:function(t,e,i,n,r){this._updateUniformLocation(t,[e,i,n,r])&&this._glContext.uniform4i(t,e,i,n,r)},setUniformLocationWith2iv:function(t,e){this._updateUniformLocation(t,e)&&this._glContext.uniform2iv(t,e)},setUniformLocationWith3iv:function(t,e){this._updateUniformLocation(t,e)&&this._glContext.uniform3iv(t,e)},setUniformLocationWith4iv:function(t,e){this._updateUniformLocation(t,e)&&this._glContext.uniform4iv(t,e)},setUniformLocationI32:function(t,e){this.setUniformLocationWith1i(t,e)},setUniformLocationWith1f:function(t,e){this._updateUniformLocation(t,e)&&this._glContext.uniform1f(t,e)},setUniformLocationWith2f:function(t,e,i){this._updateUniformLocation(t,[e,i])&&this._glContext.uniform2f(t,e,i)},setUniformLocationWith3f:function(t,e,i,n){this._updateUniformLocation(t,[e,i,n])&&this._glContext.uniform3f(t,e,i,n)},setUniformLocationWith4f:function(t,e,i,n,r){this._updateUniformLocation(t,[e,i,n,r])&&this._glContext.uniform4f(t,e,i,n,r)},setUniformLocationWith2fv:function(t,e){this._updateUniformLocation(t,e)&&this._glContext.uniform2fv(t,e)},setUniformLocationWith3fv:function(t,e){this._updateUniformLocation(t,e)&&this._glContext.uniform3fv(t,e)},setUniformLocationWith4fv:function(t,e){this._updateUniformLocation(t,e)&&this._glContext.uniform4fv(t,e)},setUniformLocationWithMatrix4fv:function(t,e){this._updateUniformLocation(t,e)&&this._glContext.uniformMatrix4fv(t,!1,e)},setUniformLocationF32:function(){if(!(2>arguments.length))switch(arguments.length){case 2:this.setUniformLocationWith1f(arguments[0],arguments[1]);break;case 3:this.setUniformLocationWith2f(arguments[0],arguments[1],arguments[2]);break;case 4:this.setUniformLocationWith3f(arguments[0],arguments[1],arguments[2],arguments[3]);break;case 5:this.setUniformLocationWith4f(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4])}},setUniformsForBuiltins:function(){var t=new cc.math.Matrix4,e=new cc.math.Matrix4,i=new cc.math.Matrix4;cc.kmGLGetMatrix(cc.KM_GL_PROJECTION,t),cc.kmGLGetMatrix(cc.KM_GL_MODELVIEW,e),cc.kmMat4Multiply(i,t,e),this.setUniformLocationWithMatrix4fv(this._uniforms[cc.UNIFORM_PMATRIX],t.mat,1),this.setUniformLocationWithMatrix4fv(this._uniforms[cc.UNIFORM_MVMATRIX],e.mat,1),this.setUniformLocationWithMatrix4fv(this._uniforms[cc.UNIFORM_MVPMATRIX],i.mat,1),this._usesTime&&(t=cc.director,t=t.getTotalFrames()*t.getAnimationInterval(),this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_TIME],t/10,t,2*t,4*t),this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_SINTIME],t/8,t/4,t/2,Math.sin(t)),this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_COSTIME],t/8,t/4,t/2,Math.cos(t))),-1!==this._uniforms[cc.UNIFORM_RANDOM01]&&this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_RANDOM01],Math.random(),Math.random(),Math.random(),Math.random())},_setUniformsForBuiltinsForRenderer:function(t){if(t&&t._renderCmd){var e=new cc.math.Matrix4,i=new cc.math.Matrix4;cc.kmGLGetMatrix(cc.KM_GL_PROJECTION,e),cc.kmMat4Multiply(i,e,t._renderCmd._stackMatrix),this.setUniformLocationWithMatrix4fv(this._uniforms[cc.UNIFORM_PMATRIX],e.mat,1),this.setUniformLocationWithMatrix4fv(this._uniforms[cc.UNIFORM_MVMATRIX],t._renderCmd._stackMatrix.mat,1),this.setUniformLocationWithMatrix4fv(this._uniforms[cc.UNIFORM_MVPMATRIX],i.mat,1),this._usesTime&&(t=cc.director,t=t.getTotalFrames()*t.getAnimationInterval(),this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_TIME],t/10,t,2*t,4*t),this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_SINTIME],t/8,t/4,t/2,Math.sin(t)),this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_COSTIME],t/8,t/4,t/2,Math.cos(t))),-1!==this._uniforms[cc.UNIFORM_RANDOM01]&&this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_RANDOM01],Math.random(),Math.random(),Math.random(),Math.random())}},setUniformForModelViewProjectionMatrix:function(){this._glContext.uniformMatrix4fv(this._uniforms[cc.UNIFORM_MVPMATRIX],!1,cc.getMat4MultiplyValue(cc.projection_matrix_stack.top,cc.modelview_matrix_stack.top))},setUniformForModelViewProjectionMatrixWithMat4:function(t){cc.kmMat4Multiply(t,cc.projection_matrix_stack.top,cc.modelview_matrix_stack.top),this._glContext.uniformMatrix4fv(this._uniforms[cc.UNIFORM_MVPMATRIX],!1,t.mat)},setUniformForModelViewAndProjectionMatrixWithMat4:function(){this._glContext.uniformMatrix4fv(this._uniforms[cc.UNIFORM_MVMATRIX],!1,cc.modelview_matrix_stack.top.mat),this._glContext.uniformMatrix4fv(this._uniforms[cc.UNIFORM_PMATRIX],!1,cc.projection_matrix_stack.top.mat)},_setUniformForMVPMatrixWithMat4:function(t){if(!t)throw"modelView matrix is undefined.";this._glContext.uniformMatrix4fv(this._uniforms[cc.UNIFORM_MVMATRIX],!1,t.mat),this._glContext.uniformMatrix4fv(this._uniforms[cc.UNIFORM_PMATRIX],!1,cc.projection_matrix_stack.top.mat)},vertexShaderLog:function(){return this._glContext.getShaderInfoLog(this._vertShader)},getVertexShaderLog:function(){return this._glContext.getShaderInfoLog(this._vertShader)},getFragmentShaderLog:function(){return this._glContext.getShaderInfoLog(this._vertShader)},fragmentShaderLog:function(){return this._glContext.getShaderInfoLog(this._fragShader)},programLog:function(){return this._glContext.getProgramInfoLog(this._programObj)},getProgramLog:function(){return this._glContext.getProgramInfoLog(this._programObj)},reset:function(){this._fragShader=this._vertShader=null,this._uniforms.length=0,this._glContext.deleteProgram(this._programObj),this._programObj=null;for(var t=0;t<this._hashForUniforms.length;t++)this._hashForUniforms[t].value=null,this._hashForUniforms[t]=null;this._hashForUniforms.length=0},getProgram:function(){return this._programObj},retain:function(){},release:function(){}}),cc.GLProgram.create=function(t,e){return new cc.GLProgram(t,e)},cc.GLProgram._highpSupported=null,cc.GLProgram._isHighpSupported=function(){if(null==cc.GLProgram._highpSupported){var t=cc._renderContext,t=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT);cc.GLProgram._highpSupported=0!==t.precision}return cc.GLProgram._highpSupported},cc.setProgram=function(t,e){t.shaderProgram=e;var i=t.children;if(i)for(var n=0;n<i.length;n++)cc.setProgram(i[n],e)},cc._currentProjectionMatrix=-1,cc._vertexAttribPosition=!1,cc._vertexAttribColor=!1,cc._vertexAttribTexCoords=!1,cc.ENABLE_GL_STATE_CACHE&&(cc.MAX_ACTIVETEXTURE=16,cc._currentShaderProgram=-1,cc._currentBoundTexture=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],cc._blendingSource=-1,cc._blendingDest=-1,cc._GLServerState=0,cc.TEXTURE_ATLAS_USE_VAO&&(cc._uVAO=0)),cc.glInvalidateStateCache=function(){if(cc.kmGLFreeAll(),cc._currentProjectionMatrix=-1,cc._vertexAttribPosition=!1,cc._vertexAttribColor=!1,cc._vertexAttribTexCoords=!1,cc.ENABLE_GL_STATE_CACHE){cc._currentShaderProgram=-1;for(var t=0;t<cc.MAX_ACTIVETEXTURE;t++)cc._currentBoundTexture[t]=-1;cc._blendingSource=-1,cc._blendingDest=-1,cc._GLServerState=0}},cc.glUseProgram=function(t){t!==cc._currentShaderProgram&&(cc._currentShaderProgram=t,cc._renderContext.useProgram(t))},cc.ENABLE_GL_STATE_CACHE||(cc.glUseProgram=function(t){cc._renderContext.useProgram(t)}),cc.glDeleteProgram=function(t){cc.ENABLE_GL_STATE_CACHE&&t===cc._currentShaderProgram&&(cc._currentShaderProgram=-1),gl.deleteProgram(t)},cc.glBlendFunc=function(t,e){(t!==cc._blendingSource||e!==cc._blendingDest)&&(cc._blendingSource=t,cc._blendingDest=e,cc.setBlending(t,e))},cc.setBlending=function(t,e){var i=cc._renderContext;t===i.ONE&&e===i.ZERO?i.disable(i.BLEND):(i.enable(i.BLEND),cc._renderContext.blendFunc(t,e))},cc.glBlendFuncForParticle=function(t,e){if(t!==cc._blendingSource||e!==cc._blendingDest){cc._blendingSource=t,cc._blendingDest=e;var i=cc._renderContext;t===i.ONE&&e===i.ZERO?i.disable(i.BLEND):(i.enable(i.BLEND),i.blendFuncSeparate(i.SRC_ALPHA,e,t,e))}},cc.ENABLE_GL_STATE_CACHE||(cc.glBlendFunc=cc.setBlending),cc.glBlendResetToCache=function(){var t=cc._renderContext;t.blendEquation(t.FUNC_ADD),cc.ENABLE_GL_STATE_CACHE?cc.setBlending(cc._blendingSource,cc._blendingDest):cc.setBlending(t.BLEND_SRC,t.BLEND_DST)},cc.setProjectionMatrixDirty=function(){cc._currentProjectionMatrix=-1},cc.glEnableVertexAttribs=function(t){var e=cc._renderContext,i=t&cc.VERTEX_ATTRIB_FLAG_POSITION;i!==cc._vertexAttribPosition&&(i?e.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION):e.disableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),cc._vertexAttribPosition=i),i=t&cc.VERTEX_ATTRIB_FLAG_COLOR,i!==cc._vertexAttribColor&&(i?e.enableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR):e.disableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR),cc._vertexAttribColor=i),t&=cc.VERTEX_ATTRIB_FLAG_TEX_COORDS,t!==cc._vertexAttribTexCoords&&(t?e.enableVertexAttribArray(cc.VERTEX_ATTRIB_TEX_COORDS):e.disableVertexAttribArray(cc.VERTEX_ATTRIB_TEX_COORDS),cc._vertexAttribTexCoords=t)},cc.glBindTexture2D=function(t){cc.glBindTexture2DN(0,t)},cc.glBindTexture2DN=function(t,e){if(cc._currentBoundTexture[t]!==e){cc._currentBoundTexture[t]=e;var i=cc._renderContext;i.activeTexture(i.TEXTURE0+t),e?i.bindTexture(i.TEXTURE_2D,e._webTextureObj):i.bindTexture(i.TEXTURE_2D,null)}},cc.ENABLE_GL_STATE_CACHE||(cc.glBindTexture2DN=function(t,e){var i=cc._renderContext;i.activeTexture(i.TEXTURE0+t),e?i.bindTexture(i.TEXTURE_2D,e._webTextureObj):i.bindTexture(i.TEXTURE_2D,null)}),cc.glDeleteTexture=function(t){cc.glDeleteTextureN(0,t)},cc.glDeleteTextureN=function(t,e){cc.ENABLE_GL_STATE_CACHE&&e===cc._currentBoundTexture[t]&&(cc._currentBoundTexture[t]=-1),cc._renderContext.deleteTexture(e)},cc.glBindVAO=function(t){cc.TEXTURE_ATLAS_USE_VAO&&cc.ENABLE_GL_STATE_CACHE&&cc._uVAO!==t&&(cc._uVAO=t)},cc.glEnable=function(){},cc.IMAGE_FORMAT_JPEG=0,cc.IMAGE_FORMAT_PNG=1,cc.IMAGE_FORMAT_RAWDATA=9,cc.NextPOT=function(t){return t-=1,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,(t|t>>16)+1},cc.RenderTexture=cc.Node.extend({sprite:null,clearFlags:0,clearDepthVal:0,autoDraw:!1,_texture:null,_pixelFormat:cc.Texture2D.PIXEL_FORMAT_RGBA8888,clearStencilVal:0,_clearColor:null,_className:"RenderTexture",ctor:function(t,e,i,n){cc.Node.prototype.ctor.call(this),this._cascadeOpacityEnabled=this._cascadeColorEnabled=!0,this._clearColor=new cc.Color(0,0,0,255),void 0!==t&&void 0!==e&&(i=i||cc.Texture2D.PIXEL_FORMAT_RGBA8888,this.initWithWidthAndHeight(t,e,i,n||0)),this.setAnchorPoint(0,0)},_createRenderCmd:function(){return cc._renderType===cc._RENDER_TYPE_CANVAS?new cc.RenderTexture.CanvasRenderCmd(this):new cc.RenderTexture.WebGLRenderCmd(this)},cleanup:function(){cc.Node.prototype.onExit.call(this),this._renderCmd.cleanup()},getSprite:function(){return this.sprite},setSprite:function(t){this.sprite=t},setVirtualViewport:function(t,e,i){this._renderCmd.setVirtualViewport(t,e,i)},initWithWidthAndHeight:function(t,e,i,n){return this._renderCmd.initWithWidthAndHeight(t,e,i,n)},begin:function(){cc.renderer._turnToCacheMode(this.__instanceId),this._renderCmd.begin()},beginWithClear:function(t,e,i,n,r,o){var s=cc._renderContext;r=r||s.COLOR_BUFFER_BIT,o=o||s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT,this._beginWithClear(t,e,i,n,r,o,s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT|s.STENCIL_BUFFER_BIT)},_beginWithClear:function(t,e,i,n,r,o,s){this.begin(),this._renderCmd._beginWithClear(t,e,i,n,r,o,s)},end:function(){this._renderCmd.end()},clear:function(t,e,i,n){this.beginWithClear(t,e,i,n),this.end()},clearRect:function(t,e,i,n){this._renderCmd.clearRect(t,e,i,n)},clearDepth:function(t){this._renderCmd.clearDepth(t)},clearStencil:function(t){this._renderCmd.clearStencil(t)},getClearFlags:function(){return this.clearFlags},setClearFlags:function(t){this.clearFlags=t},getClearColor:function(){return this._clearColor},setClearColor:function(t){var e=this._clearColor;e.r=t.r,e.g=t.g,e.b=t.b,e.a=t.a,this._renderCmd.updateClearColor(t)},getClearDepth:function(){return this.clearDepthVal},setClearDepth:function(t){this.clearDepthVal=t},getClearStencil:function(){return this.clearStencilVal},setClearStencil:function(t){this.clearStencilVal=t},isAutoDraw:function(){return this.autoDraw},setAutoDraw:function(t){this.autoDraw=t},saveToFile:function(){cc.log("saveToFile isn't supported on Cocos2d-Html5")},newCCImage:function(){return cc.log("saveToFile isn't supported on cocos2d-html5"),null},listenToBackground:function(){},listenToForeground:function(){}}),_p=cc.RenderTexture.prototype,cc.defineGetterSetter(_p,"clearColorVal",_p.getClearColor,_p.setClearColor),cc.RenderTexture.create=function(t,e,i,n){return new cc.RenderTexture(t,e,i,n)},function(){cc.RenderTexture.CanvasRenderCmd=function(t){cc.Node.CanvasRenderCmd.call(this,t),this._needDraw=!0,this._clearColorStr="rgba(255,255,255,1)",this._cacheCanvas=cc.newElement("canvas"),this._cacheContext=new cc.CanvasContextWrapper(this._cacheCanvas.getContext("2d"))};var t=cc.RenderTexture.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);t.constructor=cc.RenderTexture.CanvasRenderCmd,t.cleanup=function(){this._cacheCanvas=this._cacheContext=null},t.clearStencil=function(){},t.setVirtualViewport=function(){},t.updateClearColor=function(t){this._clearColorStr="rgba("+(0|t.r)+","+(0|t.g)+","+(0|t.b)+","+t.a/255+")"},t.initWithWidthAndHeight=function(t,e,i,n){i=this._node,n=this._cacheCanvas;var r=cc.contentScaleFactor();return n.width=0|t*r,n.height=0|e*r,t=new cc.Texture2D,t.initWithElement(n),t.handleLoadedTexture(),t=i.sprite=new cc.Sprite(t),t.setBlendFunc(cc.ONE,cc.ONE_MINUS_SRC_ALPHA),i.autoDraw=!1,i.addChild(t),!0},t.begin=function(){},t._beginWithClear=function(t,e,i,n,r,o){t=t||0,e=e||0,i=i||0,n=isNaN(n)?255:n,r=this._cacheContext.getContext(),o=this._cacheCanvas,r.setTransform(1,0,0,1,0,0),this._cacheContext.setFillStyle("rgba("+(0|t)+","+(0|e)+","+(0|i)+","+n/255+")"),r.clearRect(0,0,o.width,o.height),r.fillRect(0,0,o.width,o.height)},t.end=function(){var t=this._node,e=cc.contentScaleFactor();cc.renderer._renderingToCacheCanvas(this._cacheContext,t.__instanceId,e,e)},t.clearRect=function(t,e,i,n){this._cacheContext.clearRect(t,e,i,-n)},t.clearDepth=function(){cc.log("clearDepth isn't supported on Cocos2d-Html5")},t.visit=function(t){var e=this._node;this._syncStatus(t),e.sprite.visit(this),this._dirtyFlag=0}}(),function(){cc.RenderTexture.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._depthRenderBuffer=this._textureCopy=this._oldFBO=this._fBO=null,this._rtTextureRect=new cc.Rect,this._fullRect=new cc.Rect,this._fullViewport=new cc.Rect};var t=cc.RenderTexture.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);t.constructor=cc.RenderTexture.WebGLRenderCmd,t.setVirtualViewport=function(t,e,i){this._rtTextureRect.x=t.x,this._rtTextureRect.y=t.y,this._fullRect=e,this._fullViewport=i},t.rendering=function(t){var e=t||cc._renderContext;if(t=this._node,t.autoDraw){t.begin();var i=t.clearFlags;if(i){var n=[0,0,0,0],r=0,o=0;i&e.COLOR_BUFFER_BIT&&(n=e.getParameter(e.COLOR_CLEAR_VALUE),e.clearColor(t._clearColor.r/255,t._clearColor.g/255,t._clearColor.b/255,t._clearColor.a/255)),i&e.DEPTH_BUFFER_BIT&&(r=e.getParameter(e.DEPTH_CLEAR_VALUE),e.clearDepth(t.clearDepthVal)),i&e.STENCIL_BUFFER_BIT&&(o=e.getParameter(e.STENCIL_CLEAR_VALUE),e.clearStencil(t.clearStencilVal)),e.clear(i),i&e.COLOR_BUFFER_BIT&&e.clearColor(n[0],n[1],n[2],n[3]),i&e.DEPTH_BUFFER_BIT&&e.clearDepth(r),i&e.STENCIL_BUFFER_BIT&&e.clearStencil(o)}for(t.sortAllChildren(),e=t._children,i=0;i<e.length;i++)n=e[i],n!==t.sprite&&n._renderCmd.visit(t.sprite._renderCmd);t.end()}},t.clearStencil=function(t){var e=cc._renderContext,i=e.getParameter(e.STENCIL_CLEAR_VALUE);e.clearStencil(t),e.clear(e.STENCIL_BUFFER_BIT),e.clearStencil(i)},t.cleanup=function(){this._textureCopy=null;var t=cc._renderContext;t.deleteFramebuffer(this._fBO),this._depthRenderBuffer&&t.deleteRenderbuffer(this._depthRenderBuffer)},t.updateClearColor=function(){},t.initWithWidthAndHeight=function(t,e,i,n){var r=this._node;i===cc.Texture2D.PIXEL_FORMAT_A8&&cc.log("cc.RenderTexture._initWithWidthAndHeightForWebGL() : only RGB and RGBA formats are valid for a render texture;");var o=cc._renderContext,s=cc.contentScaleFactor();this._fullRect=new cc.Rect(0,0,t,e),this._fullViewport=new cc.Rect(0,0,t,e),t=0|t*s,e=0|e*s,this._oldFBO=o.getParameter(o.FRAMEBUFFER_BINDING);var c;cc.configuration.supportsNPOT()?(s=t,c=e):(s=cc.NextPOT(t),c=cc.NextPOT(e));for(var a=new Uint8Array(s*c*4),l=0;s*c*4>l;l++)a[l]=0;if(this._pixelFormat=i,l=r._texture=new cc.Texture2D,!r._texture)return!1;if(l.initWithData(a,r._pixelFormat,s,c,cc.size(t,e)),i=o.getParameter(o.RENDERBUFFER_BINDING),cc.configuration.checkForGLExtension("GL_QCOM")){if(this._textureCopy=new cc.Texture2D,!this._textureCopy)return!1;this._textureCopy.initWithData(a,r._pixelFormat,s,c,cc.size(t,e))}return this._fBO=o.createFramebuffer(),o.bindFramebuffer(o.FRAMEBUFFER,this._fBO),o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,l._webTextureObj,0),0!==n&&(this._depthRenderBuffer=o.createRenderbuffer(),o.bindRenderbuffer(o.RENDERBUFFER,this._depthRenderBuffer),o.renderbufferStorage(o.RENDERBUFFER,n,s,c),n===o.DEPTH_STENCIL?o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,this._depthRenderBuffer):n===o.STENCIL_INDEX||n===o.STENCIL_INDEX8?o.framebufferRenderbuffer(o.FRAMEBUFFER,o.STENCIL_ATTACHMENT,o.RENDERBUFFER,this._depthRenderBuffer):n===o.DEPTH_COMPONENT16&&o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,this._depthRenderBuffer)),o.checkFramebufferStatus(o.FRAMEBUFFER)!==o.FRAMEBUFFER_COMPLETE&&cc.log("Could not attach texture to the framebuffer"),l.setAliasTexParameters(),t=r.sprite=new cc.Sprite(l),t.scaleY=-1,t.setBlendFunc(o.ONE,o.ONE_MINUS_SRC_ALPHA),o.bindRenderbuffer(o.RENDERBUFFER,i),o.bindFramebuffer(o.FRAMEBUFFER,this._oldFBO),r.autoDraw=!1,r.addChild(t),!0},t.begin=function(){var t=this._node;cc.kmGLMatrixMode(cc.KM_GL_PROJECTION),cc.kmGLPushMatrix(),cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW),cc.kmGLPushMatrix();var e=cc._renderContext,i=cc.director;i.setProjection(i.getProjection());var n=t._texture.getContentSizeInPixels(),r=cc.director.getWinSizeInPixels(),i=r.width/n.width,n=r.height/n.height,i=cc.math.Matrix4.createOrthographicProjection(-1/i,1/i,-1/n,1/n,-1,1);cc.kmGLMultMatrix(i),i=new cc.Rect(0,0,0,0),i.width=this._fullViewport.width,i.height=this._fullViewport.height,n=i.height/this._fullRect.height,i.x=i.width/this._fullRect.width*(this._fullRect.x-this._rtTextureRect.x),i.y=(this._fullRect.y-this._rtTextureRect.y)*n,e.viewport(i.x,i.y,i.width,i.height),this._oldFBO=e.getParameter(e.FRAMEBUFFER_BINDING),e.bindFramebuffer(e.FRAMEBUFFER,this._fBO),cc.configuration.checkForGLExtension("GL_QCOM")&&(e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this._textureCopy._webTextureObj,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t._texture._webTextureObj,0))},t._beginWithClear=function(t,e,i,n,r,o,s){t/=255,e/=255,i/=255,n/=255;var c=cc._renderContext,a=[0,0,0,0],l=0,h=0;s&c.COLOR_BUFFER_BIT&&(a=c.getParameter(c.COLOR_CLEAR_VALUE),c.clearColor(t,e,i,n)),s&c.DEPTH_BUFFER_BIT&&(l=c.getParameter(c.DEPTH_CLEAR_VALUE),c.clearDepth(r)),s&c.STENCIL_BUFFER_BIT&&(h=c.getParameter(c.STENCIL_CLEAR_VALUE),c.clearStencil(o)),c.clear(s),s&c.COLOR_BUFFER_BIT&&c.clearColor(a[0],a[1],a[2],a[3]),s&c.DEPTH_BUFFER_BIT&&c.clearDepth(l),s&c.STENCIL_BUFFER_BIT&&c.clearStencil(h)},t.end=function(){cc.renderer._renderingToBuffer(this._node.__instanceId);var t=cc._renderContext,e=cc.director;t.bindFramebuffer(t.FRAMEBUFFER,this._oldFBO),e.setViewport(),cc.kmGLMatrixMode(cc.KM_GL_PROJECTION),cc.kmGLPopMatrix(),cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW),cc.kmGLPopMatrix()},t.clearRect=function(){},t.clearDepth=function(t){var e=this._node;e.begin();var i=cc._renderContext,n=i.getParameter(i.DEPTH_CLEAR_VALUE);i.clearDepth(t),i.clear(i.DEPTH_BUFFER_BIT),i.clearDepth(n),e.end()},t.visit=function(t){var e=this._node;e._visible&&(cc.kmGLPushMatrix(),this._syncStatus(t),cc.renderer.pushRenderCommand(this),e.sprite.visit(this),this._dirtyFlag=0,cc.kmGLPopMatrix())}}(),cc.LabelAtlas=cc.AtlasNode.extend({_string:null,_mapStartChar:null,_textureLoaded:!1,_className:"LabelAtlas",ctor:function(t,e,i,n,r){cc.AtlasNode.prototype.ctor.call(this),this._renderCmd.setCascade(),e&&cc.LabelAtlas.prototype.initWithString.call(this,t,e,i,n,r)},_createRenderCmd:function(){return cc._renderType===cc._RENDER_TYPE_WEBGL?new cc.LabelAtlas.WebGLRenderCmd(this):new cc.LabelAtlas.CanvasRenderCmd(this)},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(t,e){this.addEventListener("load",t,e)},initWithString:function(t,e,i,n,r){var o,s,c=t+"";if(void 0===i){if(i=cc.loader.getRes(e),1!==parseInt(i.version,10))return cc.log("cc.LabelAtlas.initWithString(): Unsupported version. Upgrade cocos2d version"),!1;e=cc.path.changeBasename(e,i.textureFilename),n=cc.contentScaleFactor(),o=parseInt(i.itemWidth,10)/n,s=parseInt(i.itemHeight,10)/n,i=String.fromCharCode(parseInt(i.firstChar,10))}else o=i||0,s=n||0,i=r||" ";var a=null,a=e instanceof cc.Texture2D?e:cc.textureCache.addImage(e);return this._textureLoaded=e=a.isLoaded(),e||(this._string=c,a.addEventListener("load",function(){this.initWithTexture(a,o,s,c.length),this.string=this._string,this.setColor(this._renderCmd._displayedColor),this.dispatchEvent("load")},this)),this.initWithTexture(a,o,s,c.length)?(this._mapStartChar=i,this.string=c,!0):!1},setColor:function(t){cc.AtlasNode.prototype.setColor.call(this,t),this._renderCmd.updateAtlasValues()},getString:function(){return this._string},addChild:function(t,e,i){this._renderCmd._addChild(t),cc.Node.prototype.addChild.call(this,t,e,i)},updateAtlasValues:function(){this._renderCmd.updateAtlasValues()},setString:function(t){t=String(t);var e=t.length;this._string=t,this.setContentSize(e*this._itemWidth,this._itemHeight),this._renderCmd.setString(t),this._renderCmd.updateAtlasValues(),this.quadsToDraw=e}}),function(){var t=cc.LabelAtlas.prototype;cc.defineGetterSetter(t,"opacity",t.getOpacity,t.setOpacity),cc.defineGetterSetter(t,"color",t.getColor,t.setColor),cc.defineGetterSetter(t,"string",t.getString,t.setString)}(),cc.LabelAtlas.create=function(t,e,i,n,r){return new cc.LabelAtlas(t,e,i,n,r)},function(){cc.LabelAtlas.CanvasRenderCmd=function(t){cc.AtlasNode.CanvasRenderCmd.call(this,t),this._needDraw=!1};var t=cc.LabelAtlas.CanvasRenderCmd.prototype=Object.create(cc.AtlasNode.CanvasRenderCmd.prototype);t.constructor=cc.LabelAtlas.CanvasRenderCmd,t.setCascade=function(){var t=this._node;t._cascadeOpacityEnabled=!0,t._cascadeColorEnabled=!1},t.updateAtlasValues=function(){for(var t=this._node,e=t._string||"",i=e.length,n=this._texture,r=t._itemWidth,o=t._itemHeight,s=0,c=-1;i>s;s++){var a=e.charCodeAt(s)-t._mapStartChar.charCodeAt(0),l=parseInt(a%t._itemsPerRow,10),a=parseInt(a/t._itemsPerRow,10);if(!(0>l||0>a)){c++;var l=cc.rect(l*r,a*o,r,o),a=e.charCodeAt(s),h=t.getChildByTag(s);h?32===a?(h.init(),h.setTextureRect(cc.rect(0,0,10,10),!1,cc.size(0,0))):(h.initWithTexture(n,l),h.visible=!0):(h=new cc.Sprite,32===a?(h.init(),h.setTextureRect(cc.rect(0,0,10,10),!1,cc.size(0,0))):h.initWithTexture(n,l),cc.Node.prototype.addChild.call(t,h,0,s)),h.setPosition(c*r+r/2,o/2)}}},t.setString=function(t){if(t=this._node,t._children){t=t._children;for(var e=t.length,i=0;e>i;i++){var n=t[i];n&&!n._lateChild&&(n.visible=!1)}}},t._addChild=function(){child._lateChild=!0}}(),function(){cc.LabelAtlas.WebGLRenderCmd=function(t){cc.AtlasNode.WebGLRenderCmd.call(this,t),this._needDraw=!0};var t=cc.LabelAtlas.WebGLRenderCmd.prototype=Object.create(cc.AtlasNode.WebGLRenderCmd.prototype);t.constructor=cc.LabelAtlas.WebGLRenderCmd,t.setCascade=function(){var t=this._node;t._cascadeOpacityEnabled=!0,t._cascadeColorEnabled=!0},t.rendering=function(t){cc.AtlasNode.WebGLRenderCmd.prototype.rendering.call(this,t),cc.LABELATLAS_DEBUG_DRAW&&(t=this._node.getContentSize(),t=[cc.p(0,0),cc.p(t.width,0),cc.p(t.width,t.height),cc.p(0,t.height)],cc._drawingUtil.drawPoly(t,4,!0))},t.updateAtlasValues=function(){var t=this._node,e=t._string,i=e.length,n=this._textureAtlas,r=n.texture,o=r.pixelsWidth,r=r.pixelsHeight,s=t._itemWidth,c=t._itemHeight;t._ignoreContentScaleFactor||(s=t._itemWidth*cc.contentScaleFactor(),c=t._itemHeight*cc.contentScaleFactor()),i>n.getCapacity()&&cc.log("cc.LabelAtlas._updateAtlasValues(): Invalid String length");for(var a=n.quads,l=this._displayedColor,l={r:l.r,g:l.g,b:l.b,a:t._displayedOpacity},h=t._itemWidth,u=0,d=-1;i>u;u++){var _=e.charCodeAt(u)-t._mapStartChar.charCodeAt(0),p=_%t._itemsPerRow,f=0|_/t._itemsPerRow;if(!(0>p||0>f)){d++;var m;cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(p=(2*p*s+1)/(2*o),_=p+(2*s-2)/(2*o),f=(2*f*c+1)/(2*r),m=f+(2*c-2)/(2*r)):(p=p*s/o,_=p+s/o,f=f*c/r,m=f+c/r);var g=a[u],y=g.tl,T=g.tr,S=g.bl,g=g.br;y.texCoords.u=p,y.texCoords.v=f,T.texCoords.u=_,T.texCoords.v=f,S.texCoords.u=p,S.texCoords.v=m,g.texCoords.u=_,g.texCoords.v=m,S.vertices.x=d*h,S.vertices.y=0,S.vertices.z=0,g.vertices.x=d*h+h,g.vertices.y=0,g.vertices.z=0,y.vertices.x=d*h,y.vertices.y=t._itemHeight,y.vertices.z=0,T.vertices.x=d*h+h,T.vertices.y=t._itemHeight,T.vertices.z=0,y.colors=l,T.colors=l,S.colors=l,g.colors=l}}i>0&&(n.dirty=!0,t=n.totalQuads,i>t&&n.increaseTotalQuadsWith(i-t))},t.setString=function(t){t=t.length,t>this._textureAtlas.totalQuads&&this._textureAtlas.resizeCapacity(t)},t._addChild=function(){}}(),cc.LABEL_AUTOMATIC_WIDTH=-1,cc.LabelBMFont=cc.SpriteBatchNode.extend({_opacityModifyRGB:!1,_string:"",_config:null,_fntFile:"",_initialString:"",_alignment:cc.TEXT_ALIGNMENT_CENTER,_width:-1,_lineBreakWithoutSpaces:!1,_imageOffset:null,_reusedChar:null,_textureLoaded:!1,_className:"LabelBMFont",_createRenderCmd:function(){return cc._renderType===cc._RENDER_TYPE_WEBGL?new cc.LabelBMFont.WebGLRenderCmd(this):new cc.LabelBMFont.CanvasRenderCmd(this)},_setString:function(t,e){e?this._initialString=t:this._string=t;var i=this._children;if(i)for(var n=0;n<i.length;n++){var r=i[n];r&&r.setVisible(!1)}this._textureLoaded&&(this.createFontChars(),e&&this.updateLabel())},ctor:function(t,e,i,n,r){cc.SpriteBatchNode.prototype.ctor.call(this),this._imageOffset=cc.p(0,0),this._reusedChar=[],this._cascadeOpacityEnabled=this._cascadeColorEnabled=!0,this.initWithString(t,e,i,n,r)},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(t,e){this.addEventListener("load",t,e)},isOpacityModifyRGB:function(){return this._opacityModifyRGB},setOpacityModifyRGB:function(t){if(this._opacityModifyRGB=t,t=this._children)for(var e=0;e<t.length;e++){var i=t[e];i&&(i.opacityModifyRGB=this._opacityModifyRGB)}},_changeTextureColor:function(){this._renderCmd._changeTextureColor()},init:function(){return this.initWithString(null,null,null,null,null)},initWithString:function(t,e,i,n,r){if(t=t||"",this._config&&cc.log("cc.LabelBMFont.initWithString(): re-init is no longer supported"),e){var o=cc.loader.getRes(e);if(!o)return cc.log("cc.LabelBMFont.initWithString(): Impossible to create font. Please check file"),!1;this._config=o,this._fntFile=e,e=cc.textureCache.addImage(o.atlasName),(this._textureLoaded=o=e.isLoaded())||e.addEventListener("load",function(t){this._textureLoaded=!0,this.initWithTexture(t,this._initialString.length),this.setString(this._initialString,!0),this.dispatchEvent("load")},this)}else e=new cc.Texture2D,o=new Image,e.initWithElement(o),this._textureLoaded=!1;return this.initWithTexture(e,t.length)?(this._alignment=n||cc.TEXT_ALIGNMENT_LEFT,this._imageOffset=r||cc.p(0,0),this._width=null==i?-1:i,this._realOpacity=255,this._realColor=cc.color(255,255,255,255),this._contentSize.width=0,this._contentSize.height=0,this.setAnchorPoint(.5,.5),this._renderCmd._initBatchTexture(),this.setString(t,!0),!0):!1},createFontChars:function(){var t=this._renderCmd._texture||this.textureAtlas.texture,e=0,i=cc.size(0,0),n=0,r=1,o=this._string,s=o?o.length:0;if(0!==s){var c,a=this._config,l=a.kerningDict,h=a.commonHeight,u=a.fontDefDictionary;for(c=0;s-1>c;c++)10===o.charCodeAt(c)&&r++;
var d=h*r,r=-(h-h*r),_=-1;for(c=0;s>c;c++)if(h=o.charCodeAt(c),0!==h)if(10===h)e=0,r-=a.commonHeight;else{var _=l[_<<16|65535&h]||0,p=u[h];p||(cc.log("cocos2d: LabelBMFont: character not found "+o[c]),p={rect:{x:0,y:0,width:0,height:0},xOffset:0,yOffset:0,xAdvance:0});var f=cc.rect(p.rect.x,p.rect.y,p.rect.width,p.rect.height),f=cc.rectPixelsToPoints(f);f.x+=this._imageOffset.x,f.y+=this._imageOffset.y;var m=this.getChildByTag(c);m?this._renderCmd._updateCharTexture(m,f,h):(m=new cc.Sprite,m.initWithTexture(t,f,!1),m._newTextureWhenChangeColor=!0,this.addChild(m,0,c)),m.opacityModifyRGB=this._opacityModifyRGB,this._renderCmd._updateCharColorAndOpacity(m),f=cc.p(e+p.xOffset+.5*p.rect.width+_,r+(a.commonHeight-p.yOffset)-.5*f.height*cc.contentScaleFactor()),m.setPosition(cc.pointPixelsToPoints(f)),e+=p.xAdvance+_,_=h,e>n&&(n=e)}i.width=p&&p.xAdvance<p.rect.width?n-p.xAdvance+p.rect.width:n,i.height=d,this.setContentSize(cc.sizePixelsToPoints(i))}},updateString:function(t){var e=this._children;if(e)for(var i=0,n=e.length;n>i;i++){var r=e[i];r&&(r.visible=!1)}this._config&&this.createFontChars(),t||this.updateLabel()},getString:function(){return this._initialString},setString:function(t,e){t=String(t),null==e&&(e=!0),null!=t&&cc.isString(t)||(t+=""),this._initialString=t,this._setString(t,e)},_setStringForSetter:function(t){this.setString(t,!1)},setCString:function(t){this.setString(t,!0)},_getCharsWidth:function(t,e){if(0>=e)return 0;var i=this.getChildByTag(t),n=this.getChildByTag(t+e);return this._getLetterPosXLeft(n)-this._getLetterPosXLeft(i)},_checkWarp:function(t,e,i,n){for(var r=t[e],o=0,s=0;e>s;s++)o+=t[s].length;var o=o+e-n,c=this._getCharsWidth(o,t[e].length-1);if(c>i&&1<r.length){n=i/c*r.length|0;for(var a,s=r.substr(n),l=c-this._getCharsWidth(o+n,s.length-1),h=0,u=0;l>i&&100>u++;)n*=i/l,n|=0,s=r.substr(n),l=c-this._getCharsWidth(o+n,s.length-1);for(u=0;i>l&&100>u++;)s&&(h=(a=cc.LabelTTF._wordRex.exec(s))?a[0].length:1,a=s),this._lineBreakWithoutSpaces&&(h=0),n+=h,s=r.substr(n),l=c-this._getCharsWidth(o+n,s.length-1);n-=h,0===n&&(n=1,a=a.substr(1)),i=r.substr(0,n),cc.LabelTTF.wrapInspection&&cc.LabelTTF._symbolRex.test(a||s)&&(h=(o=cc.LabelTTF._lastWordRex.exec(i))?o[0].length:0,this._lineBreakWithoutSpaces&&(h=0),n-=h,a=r.substr(n),i=r.substr(0,n)),cc.LabelTTF._firsrEnglish.test(a)&&(o=cc.LabelTTF._lastEnglish.exec(i))&&i!==o[0]&&(h=o[0].length,this._lineBreakWithoutSpaces&&(h=0),n-=h,a=r.substr(n),i=r.substr(0,n)),t[e]=a||s,t.splice(e,0,i)}},updateLabel:function(){this.string=this._initialString;var t,e,i;if(0<this._width){var n=this.string.split("\n"),r="",o=0,s=0;for(t=0;t<n.length;t++)s=n.length,this._checkWarp(n,t,this._width*this._scaleX,o),s<n.length&&o++,t>0&&(r+="\n"),r+=n[t];r+=String.fromCharCode(0),this._setString(r,!1)}if(this._alignment!==cc.TEXT_ALIGNMENT_LEFT)for(n=t=0,r=this._string.length,o=[],s=0;r>s;s++)if(10===this._string[s].charCodeAt(0)||0===this._string[s].charCodeAt(0)){e=0;var c=o.length;if(0===c)n++;else if(i=t+c-1+n,!(0>i)){var a=this.getChildByTag(i);if(null!=a){switch(e=a.getPositionX()+a._getWidth()/2,a=0,this._alignment){case cc.TEXT_ALIGNMENT_CENTER:a=this.width/2-e/2;break;case cc.TEXT_ALIGNMENT_RIGHT:a=this.width-e}if(0!==a)for(e=0;c>e;e++)i=t+e+n,0>i||(i=this.getChildByTag(i))&&(i.x+=a);t+=c,n++,o.length=0}}}else o.push(this._string[t])},setAlignment:function(t){this._alignment=t,this.updateLabel()},_getAlignment:function(){return this._alignment},setBoundingWidth:function(t){this._width=t,this.updateLabel()},_getBoundingWidth:function(){return this._width},setLineBreakWithoutSpace:function(t){this._lineBreakWithoutSpaces=t,this.updateLabel()},setScale:function(t,e){cc.Node.prototype.setScale.call(this,t,e),this.updateLabel()},setScaleX:function(t){cc.Node.prototype.setScaleX.call(this,t),this.updateLabel()},setScaleY:function(t){cc.Node.prototype.setScaleY.call(this,t),this.updateLabel()},setFntFile:function(t){if(null!=t&&t!==this._fntFile){var e=cc.loader.getRes(t);e?(this._fntFile=t,this._config=e,t=cc.textureCache.addImage(e.atlasName),this._textureLoaded=e=t.isLoaded(),this.texture=t,this._renderCmd._updateFntFileTexture(),e?this.createFontChars():t.addEventListener("load",function(t){this._textureLoaded=!0,this.texture=t,this.createFontChars(),this._changeTextureColor(),this.updateLabel(),this.dispatchEvent("load")},this)):cc.log("cc.LabelBMFont.setFntFile() : Impossible to create font. Please check file")}},getFntFile:function(){return this._fntFile},setTexture:function(t){this._renderCmd.setTexture(t)},setAnchorPoint:function(t,e){cc.Node.prototype.setAnchorPoint.call(this,t,e),this.updateLabel()},_setAnchorX:function(t){cc.Node.prototype._setAnchorX.call(this,t),this.updateLabel()},_setAnchorY:function(t){cc.Node.prototype._setAnchorY.call(this,t),this.updateLabel()},_atlasNameFromFntFile:function(){},_kerningAmountForFirst:function(t,e){var i=0;if(this._configuration.kerningDictionary){var n=this._configuration.kerningDictionary[(t<<16|65535&e).toString()];n&&(i=n.amount)}return i},_getLetterPosXLeft:function(t){return t.getPositionX()*this._scaleX-t._getWidth()*this._scaleX*t._getAnchorX()},_getLetterPosXRight:function(t){return t.getPositionX()*this._scaleX+t._getWidth()*this._scaleX*t._getAnchorX()},_isspace_unicode:function(t){return t=t.charCodeAt(0),t>=9&&13>=t||32===t||133===t||160===t||5760===t||t>=8192&&8202>=t||8232===t||8233===t||8239===t||8287===t||12288===t},_utf8_trim_ws:function(t){var e=t.length;if(!(0>=e)&&(e-=1,this._isspace_unicode(t[e]))){for(var i=e-1;i>=0&&this._isspace_unicode(t[i]);--i)e=i;this._utf8_trim_from(t,e)}},_utf8_trim_from:function(t,e){var i=t.length;e>=i||0>e||t.splice(e,i)}}),function(){var t=cc.LabelBMFont.prototype;cc.EventHelper.prototype.apply(t),cc.defineGetterSetter(t,"string",t.getString,t._setStringForSetter),cc.defineGetterSetter(t,"boundingWidth",t._getBoundingWidth,t.setBoundingWidth),cc.defineGetterSetter(t,"textAlign",t._getAlignment,t.setAlignment)}(),cc.LabelBMFont.create=function(t,e,i,n,r){return new cc.LabelBMFont(t,e,i,n,r)},cc._fntLoader={INFO_EXP:/info [^\n]*(\n|$)/gi,COMMON_EXP:/common [^\n]*(\n|$)/gi,PAGE_EXP:/page [^\n]*(\n|$)/gi,CHAR_EXP:/char [^\n]*(\n|$)/gi,KERNING_EXP:/kerning [^\n]*(\n|$)/gi,ITEM_EXP:/\w+=[^ \r\n]+/gi,INT_EXP:/^[\-]?\d+$/,_parseStrToObj:function(t){t=t.match(this.ITEM_EXP);var e={};if(t)for(var i=0,n=t.length;n>i;i++){var r=t[i],o=r.indexOf("="),s=r.substring(0,o),r=r.substring(o+1);r.match(this.INT_EXP)?r=parseInt(r):'"'===r[0]&&(r=r.substring(1,r.length-1)),e[s]=r}return e},parseFnt:function(t,e){var i={},n=this._parseStrToObj(t.match(this.INFO_EXP)[0]).padding.split(",");if(parseInt(n[0]),parseInt(n[1]),parseInt(n[2]),parseInt(n[3]),n=this._parseStrToObj(t.match(this.COMMON_EXP)[0]),i.commonHeight=n.lineHeight,cc._renderType===cc._RENDER_TYPE_WEBGL){var r=cc.configuration.getMaxTextureSize();(n.scaleW>r.width||n.scaleH>r.height)&&cc.log("cc.LabelBMFont._parseCommonArguments(): page can't be larger than supported")}1!==n.pages&&cc.log("cc.LabelBMFont._parseCommonArguments(): only supports 1 page"),n=this._parseStrToObj(t.match(this.PAGE_EXP)[0]),0!==n.id&&cc.log("cc.LabelBMFont._parseImageFileName() : file could not be found"),i.atlasName=cc.path.changeBasename(e,n.file);for(var o=t.match(this.CHAR_EXP),s=i.fontDefDictionary={},n=0,r=o.length;r>n;n++){var c=this._parseStrToObj(o[n]);s[c.id]={rect:{x:c.x,y:c.y,width:c.width,height:c.height},xOffset:c.xoffset,yOffset:c.yoffset,xAdvance:c.xadvance}}if(o=i.kerningDict={},s=t.match(this.KERNING_EXP))for(n=0,r=s.length;r>n;n++)c=this._parseStrToObj(s[n]),o[c.first<<16|65535&c.second]=c.amount;return i},load:function(t,e,i,n){var r=this;cc.loader.loadTxt(t,function(t,i){return t?n(t):void n(null,r.parseFnt(i,e))})}},cc.loader.register(["fnt"],cc._fntLoader),function(){cc.LabelBMFont.CanvasRenderCmd=function(t){cc.SpriteBatchNode.CanvasRenderCmd.call(this,t),this._needDraw=!0};var t=cc.LabelBMFont.CanvasRenderCmd.prototype=Object.create(cc.SpriteBatchNode.CanvasRenderCmd.prototype);t.constructor=cc.LabelBMFont.CanvasRenderCmd,t.rendering=function(){},t._updateCharTexture=function(t,e,i){32===i?t.setTextureRect(e,!1,cc.size(0,0)):(t.setTextureRect(e,!1),t.visible=!0)},t._updateCharColorAndOpacity=function(t){t._displayedColor=this._displayedColor,t._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty),t._displayedOpacity=this._displayedOpacity,t._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty)},t._updateFntFileTexture=function(){var t=this._node;t._originalTexture=t.texture},t.setTexture=function(t){for(var e=this._node._children,i=this._displayedColor,n=0;n<e.length;n++){var r=e[n],o=r._renderCmd,s=o._displayedColor;(this._texture===o._texture||s.r===i.r&&s.g===i.g&&s.b===i.b)&&(r.texture=t)}this._texture=t},t._changeTextureColor=cc.sys._supportCanvasNewBlendModes?function(){var t=this._node,e=t.getTexture();if(e&&0<e.getContentSize().width){var i=this._originalTexture.getHtmlElementObj();if(i){var n=e.getHtmlElementObj(),r=cc.rect(0,0,i.width,i.height);n instanceof HTMLCanvasElement&&!t._rectRotated?cc.Sprite.CanvasRenderCmd._generateTintImageWithMultiply(i,this._displayedColor,r,n):(n=cc.Sprite.CanvasRenderCmd._generateTintImageWithMultiply(i,this._displayedColor,r),e=new cc.Texture2D,e.initWithElement(n),e.handleLoadedTexture()),t.setTexture(e)}}}:function(){var t,e=this._node,i=e.getTexture();if(i&&0<i.getContentSize().width&&(t=i.getHtmlElementObj())){var n=cc.textureCache.getTextureColors(this._originalTexture.getHtmlElementObj());n&&(t instanceof HTMLCanvasElement&&!this._rectRotated?(cc.Sprite.CanvasRenderCmd._generateTintImage(t,n,this._displayedColor,null,t),this.setTexture(i)):(t=cc.Sprite.CanvasRenderCmd._generateTintImage(t,n,this._displayedColor),i=new cc.Texture2D,i.initWithElement(t),i.handleLoadedTexture(),e.setTexture(i)))}},t._updateChildrenDisplayedOpacity=function(t){cc.Node.prototype.updateDisplayedOpacity.call(t,this._displayedOpacity)},t._updateChildrenDisplayedColor=function(t){cc.Node.prototype.updateDisplayedColor.call(t,this._displayedColor)},t._initBatchTexture=function(){}}(),function(){cc.LabelBMFont.WebGLRenderCmd=function(t){cc.SpriteBatchNode.WebGLRenderCmd.call(this,t),this._needDraw=!0};var t=cc.LabelBMFont.WebGLRenderCmd.prototype=Object.create(cc.SpriteBatchNode.WebGLRenderCmd.prototype);t.constructor=cc.LabelBMFont.WebGLRenderCmd,t._updateCharTexture=function(t,e){t.setTextureRect(e,!1),t.visible=!0},t._updateFntFileTexture=function(){},t._changeTextureColor=function(){},t._updateChildrenDisplayedOpacity=function(t){t.updateDisplayedOpacity(this._displayedOpacity)},t._updateChildrenDisplayedColor=function(t){t.updateDisplayedColor(this._displayedColor)},t._initBatchTexture=function(){var t=this._node,e=t.textureAtlas.texture;t._opacityModifyRGB=e.hasPremultipliedAlpha();var i=t._reusedChar=new cc.Sprite;i.initWithTexture(e,cc.rect(0,0,0,0),!1),i.batchNode=t},t.rendering=function(t){if(cc.SpriteBatchNode.WebGLRenderCmd.prototype.rendering.call(this,t),t=this._node,cc.LABELBMFONT_DEBUG_DRAW){t=t.getContentSize();var e=cc.p(0|-this._anchorPointInPoints.x,0|-this._anchorPointInPoints.y);t=[cc.p(e.x,e.y),cc.p(e.x+t.width,e.y),cc.p(e.x+t.width,e.y+t.height),cc.p(e.x,e.y+t.height)],cc._drawingUtil.setDrawColor(0,255,0,255),cc._drawingUtil.drawPoly(t,4,!0)}},t._updateCharColorAndOpacity=function(){}}(),cc.MotionStreak=cc.Node.extend({texture:null,fastMode:!1,startingPositionInitialized:!1,_blendFunc:null,_stroke:0,_fadeDelta:0,_minSeg:0,_maxPoints:0,_nuPoints:0,_previousNuPoints:0,_pointVertexes:null,_pointState:null,_vertices:null,_colorPointer:null,_texCoords:null,_verticesBuffer:null,_colorPointerBuffer:null,_texCoordsBuffer:null,_className:"MotionStreak",ctor:function(t,e,i,n,r){cc.Node.prototype.ctor.call(this),this._positionR=cc.p(0,0),this._blendFunc=new cc.BlendFunc(cc.SRC_ALPHA,cc.ONE_MINUS_SRC_ALPHA),this.startingPositionInitialized=this.fastMode=!1,this.texture=null,this._previousNuPoints=this._nuPoints=this._maxPoints=this._minSeg=this._fadeDelta=this._stroke=0,this._texCoordsBuffer=this._colorPointerBuffer=this._verticesBuffer=this._texCoords=this._colorPointer=this._vertices=this._pointState=this._pointVertexes=null,void 0!==r&&this.initWithFade(t,e,i,n,r)},getTexture:function(){return this.texture},setTexture:function(t){this.texture!==t&&(this.texture=t)},getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(t,e){void 0===e?this._blendFunc=t:(this._blendFunc.src=t,this._blendFunc.dst=e)},getOpacity:function(){return cc.log("cc.MotionStreak.getOpacity has not been supported."),0},setOpacity:function(){cc.log("cc.MotionStreak.setOpacity has not been supported.")},setOpacityModifyRGB:function(){},isOpacityModifyRGB:function(){return!1},isFastMode:function(){return this.fastMode},setFastMode:function(t){this.fastMode=t},isStartingPositionInitialized:function(){return this.startingPositionInitialized},setStartingPositionInitialized:function(t){this.startingPositionInitialized=t},getStroke:function(){return this._stroke},setStroke:function(t){this._stroke=t},initWithFade:function(t,e,i,n,r){if(!r)throw"cc.MotionStreak.initWithFade(): Invalid filename or texture";return cc.isString(r)&&(r=cc.textureCache.addImage(r)),cc.Node.prototype.setPosition.call(this,cc.p(0,0)),this.anchorY=this.anchorX=0,this.ignoreAnchor=!0,this.startingPositionInitialized=!1,this.fastMode=!0,this._minSeg=-1===e?i/5:e,this._minSeg*=this._minSeg,this._stroke=i,this._fadeDelta=1/t,this._maxPoints=t=(0|60*t)+2,this._nuPoints=0,this._pointState=new Float32Array(t),this._pointVertexes=new Float32Array(2*t),this._vertices=new Float32Array(4*t),this._texCoords=new Float32Array(4*t),this._colorPointer=new Uint8Array(8*t),this._verticesBuffer=gl.createBuffer(),this._texCoordsBuffer=gl.createBuffer(),this._colorPointerBuffer=gl.createBuffer(),this._blendFunc.src=gl.SRC_ALPHA,this._blendFunc.dst=gl.ONE_MINUS_SRC_ALPHA,this.texture=r,this.color=n,this.scheduleUpdate(),gl.bindBuffer(gl.ARRAY_BUFFER,this._verticesBuffer),gl.bufferData(gl.ARRAY_BUFFER,this._vertices,gl.DYNAMIC_DRAW),gl.bindBuffer(gl.ARRAY_BUFFER,this._texCoordsBuffer),gl.bufferData(gl.ARRAY_BUFFER,this._texCoords,gl.DYNAMIC_DRAW),gl.bindBuffer(gl.ARRAY_BUFFER,this._colorPointerBuffer),gl.bufferData(gl.ARRAY_BUFFER,this._colorPointer,gl.DYNAMIC_DRAW),!0},tintWithColor:function(t){this.color=t;for(var e=this._colorPointer,i=0,n=2*this._nuPoints;n>i;i++)e[4*i]=t.r,e[4*i+1]=t.g,e[4*i+2]=t.b},reset:function(){this._nuPoints=0},setPosition:function(t,e){this.startingPositionInitialized=!0,void 0===e?(this._positionR.x=t.x,this._positionR.y=t.y):(this._positionR.x=t,this._positionR.y=e)},getPositionX:function(){return this._positionR.x},setPositionX:function(t){this._positionR.x=t,this.startingPositionInitialized||(this.startingPositionInitialized=!0)},getPositionY:function(){return this._positionR.y},setPositionY:function(t){this._positionR.y=t,this.startingPositionInitialized||(this.startingPositionInitialized=!0)},update:function(t){if(this.startingPositionInitialized){this._renderCmd._updateDisplayColor(),t*=this._fadeDelta;var e,i,n,r,o=0,s=this._nuPoints,c=this._pointState,a=this._pointVertexes,l=this._vertices,h=this._colorPointer;for(n=0;s>n;n++)c[n]-=t,0>=c[n]?o++:(e=n-o,o>0?(c[e]=c[n],a[2*e]=a[2*n],a[2*e+1]=a[2*n+1],r=2*n,i=2*e,l[2*i]=l[2*r],l[2*i+1]=l[2*r+1],l[2*(i+1)]=l[2*(r+1)],l[2*(i+1)+1]=l[2*(r+1)+1],r*=4,i*=4,h[i+0]=h[r+0],h[i+1]=h[r+1],h[i+2]=h[r+2],h[i+4]=h[r+4],h[i+5]=h[r+5],h[i+6]=h[r+6]):i=8*e,e=255*c[e],h[i+3]=e,h[i+7]=e);if(s-=o,n=!0,s>=this._maxPoints?n=!1:s>0&&(t=cc.pDistanceSQ(cc.p(a[2*(s-1)],a[2*(s-1)+1]),this._positionR)<this._minSeg,i=1===s?!1:cc.pDistanceSQ(cc.p(a[2*(s-2)],a[2*(s-2)+1]),this._positionR)<2*this._minSeg,t||i)&&(n=!1),n&&(a[2*s]=this._positionR.x,a[2*s+1]=this._positionR.y,c[s]=1,c=8*s,n=this.getDisplayedColor(),h[c]=n.r,h[c+1]=n.g,h[c+2]=n.b,h[c+4]=n.r,h[c+5]=n.g,h[c+6]=n.b,h[c+3]=255,h[c+7]=255,s>0&&this.fastMode&&(s>1?cc.vertexLineToPolygon(a,this._stroke,this._vertices,s,1):cc.vertexLineToPolygon(a,this._stroke,this._vertices,0,2)),s++),this.fastMode||cc.vertexLineToPolygon(a,this._stroke,this._vertices,0,s),s&&this._previousNuPoints!==s){for(a=1/s,h=this._texCoords,n=0;s>n;n++)h[4*n]=0,h[4*n+1]=a*n,h[2*(2*n+1)]=1,h[2*(2*n+1)+1]=a*n;this._previousNuPoints=s}this._nuPoints=s}},_createRenderCmd:function(){return cc._renderType===cc._RENDER_TYPE_WEBGL?new cc.MotionStreak.WebGLRenderCmd(this):null}}),cc.MotionStreak.create=function(t,e,i,n,r){return new cc.MotionStreak(t,e,i,n,r)},cc.MotionStreak.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURECOLOR)},cc.MotionStreak.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype),cc.MotionStreak.WebGLRenderCmd.prototype.constructor=cc.Sprite.WebGLRenderCmd,cc.MotionStreak.WebGLRenderCmd.prototype.rendering=function(t){var e=this._node;1>=e._nuPoints||!e.texture||!e.texture.isLoaded()||(t=t||cc._renderContext,this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX),cc.glBlendFunc(e._blendFunc.src,e._blendFunc.dst),cc.glBindTexture2D(e.texture),t.bindBuffer(t.ARRAY_BUFFER,e._verticesBuffer),t.bufferData(t.ARRAY_BUFFER,e._vertices,t.DYNAMIC_DRAW),t.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,e._texCoordsBuffer),t.bufferData(t.ARRAY_BUFFER,e._texCoords,t.DYNAMIC_DRAW),t.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,e._colorPointerBuffer),t.bufferData(t.ARRAY_BUFFER,e._colorPointer,t.DYNAMIC_DRAW),t.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,t.UNSIGNED_BYTE,!0,0,0),t.drawArrays(t.TRIANGLE_STRIP,0,2*e._nuPoints),cc.g_NumberOfDraws++)},cc.NodeGrid=cc.Node.extend({grid:null,_target:null,getGrid:function(){return this.grid},setGrid:function(t){this.grid=t},setTarget:function(t){this._target=t},_transformForWebGL:function(){var t=this._transform4x4,e=cc.current_stack.top,i=this.getNodeToParentTransform(),n=t.mat;n[0]=i.a,n[4]=i.c,n[12]=i.tx,n[1]=i.b,n[5]=i.d,n[13]=i.ty,n[14]=this._vertexZ,e.multiply(t),null===this._camera||this.grid&&this.grid.isActive()||(e=this._renderCmd._anchorPointInPoints,t=e.x,e=e.y,0!==t||0!==e?(cc.SPRITEBATCHNODE_RENDER_SUBPIXEL||(t|=0,e|=0),cc.kmGLTranslatef(t,e,0),this._camera.locate(),cc.kmGLTranslatef(-t,-e,0)):this._camera.locate())},_createRenderCmd:function(){return cc._renderType===cc._RENDER_TYPE_WEBGL?new cc.NodeGrid.WebGLRenderCmd(this):new cc.Node.CanvasRenderCmd(this)}}),_p=cc.NodeGrid.prototype,cc.defineGetterSetter(_p,"target",null,_p.setTarget),cc.NodeGrid.create=function(){return new cc.NodeGrid},function(){cc.NodeGrid.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t),this._needDraw=!1,this._gridBeginCommand=new cc.CustomRenderCmd(this,this.onGridBeginDraw),this._gridEndCommand=new cc.CustomRenderCmd(this,this.onGridEndDraw)};var t=cc.NodeGrid.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);t.constructor=cc.NodeGrid.WebGLRenderCmd,t.visit=function(t){var e=this._node;if(e._visible){t=t||this.getParentRenderCmd(),e._parent&&e._parent._renderCmd&&(this._curLevel=e._parent._renderCmd._curLevel+1);var i=cc.current_stack;if(i.stack.push(i.top),this._syncStatus(t),i.top=this._stackMatrix,cc.renderer.pushRenderCommand(this._gridBeginCommand),e._target&&e._target.visit(),(t=e._children)&&0<t.length){var n=t.length;for(e.sortAllChildren(),e=0;n>e;e++){var r=t[e];r&&r.visit()}}cc.renderer.pushRenderCommand(this._gridEndCommand),this._dirtyFlag=0,i.top=i.stack.pop()}},t.onGridBeginDraw=function(){var t=this._node.grid;t&&t._active&&t.beforeDraw()},t.onGridEndDraw=function(){var t=this._node.grid;t&&t._active&&t.afterDraw(this._node)}}(),cc.v2fzero=function(){return{x:0,y:0}},cc.v2f=function(t,e){return{x:t,y:e}},cc.v2fadd=function(t,e){return cc.v2f(t.x+e.x,t.y+e.y)},cc.v2fsub=function(t,e){return cc.v2f(t.x-e.x,t.y-e.y)},cc.v2fmult=function(t,e){return cc.v2f(t.x*e,t.y*e)},cc.v2fperp=function(t){return cc.v2f(-t.y,t.x)},cc.v2fneg=function(t){return cc.v2f(-t.x,-t.y)},cc.v2fdot=function(t,e){return t.x*e.x+t.y*e.y},cc.v2fforangle=function(t){return cc.v2f(Math.cos(t),Math.sin(t))},cc.v2fnormalize=function(t){return t=cc.pNormalize(cc.p(t.x,t.y)),cc.v2f(t.x,t.y)},cc.__v2f=function(t){return cc.v2f(t.x,t.y)},cc.__t=function(t){return{u:t.x,v:t.y}},cc.DrawNodeCanvas=cc.Node.extend({_buffer:null,_blendFunc:null,_lineWidth:1,_drawColor:null,_className:"DrawNodeCanvas",ctor:function(){cc.Node.prototype.ctor.call(this);var t=this._renderCmd;t._buffer=this._buffer=[],t._drawColor=this._drawColor=cc.color(255,255,255,255),t._blendFunc=this._blendFunc=new cc.BlendFunc(cc.SRC_ALPHA,cc.ONE_MINUS_SRC_ALPHA),this.init()},getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(t,e){void 0===e?(this._blendFunc.src=t.src,this._blendFunc.dst=t.dst):(this._blendFunc.src=t,this._blendFunc.dst=e)},setLineWidth:function(t){this._lineWidth=t},getLineWidth:function(){return this._lineWidth},setDrawColor:function(t){var e=this._drawColor;e.r=t.r,e.g=t.g,e.b=t.b,e.a=null==t.a?255:t.a},getDrawColor:function(){return cc.color(this._drawColor.r,this._drawColor.g,this._drawColor.b,this._drawColor.a)},drawRect:function(t,e,i,n,r){n=null==n?this._lineWidth:n,r=r||this.getDrawColor(),null==r.a&&(r.a=255),t=[t,cc.p(e.x,t.y),e,cc.p(t.x,e.y)],e=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY),e.verts=t,e.lineWidth=n,e.lineColor=r,e.isClosePolygon=!0,e.isStroke=!0,e.lineCap="butt",(e.fillColor=i)&&(null==i.a&&(i.a=255),e.isFill=!0),this._buffer.push(e)},drawCircle:function(t,e,i,n,r,o,s){o=o||this._lineWidth,s=s||this.getDrawColor(),null==s.a&&(s.a=255);for(var c=2*Math.PI/n,a=[],l=0;n>=l;l++){var h=l*c,u=e*Math.cos(h+i)+t.x,h=e*Math.sin(h+i)+t.y;a.push(cc.p(u,h))}r&&a.push(cc.p(t.x,t.y)),t=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY),t.verts=a,t.lineWidth=o,t.lineColor=s,t.isClosePolygon=!0,t.isStroke=!0,this._buffer.push(t)},drawQuadBezier:function(t,e,i,n,r,o){r=r||this._lineWidth,o=o||this.getDrawColor(),null==o.a&&(o.a=255);for(var s=[],c=0,a=0;n>a;a++){var l=Math.pow(1-c,2)*t.x+2*(1-c)*c*e.x+c*c*i.x,h=Math.pow(1-c,2)*t.y+2*(1-c)*c*e.y+c*c*i.y;s.push(cc.p(l,h)),c+=1/n}s.push(cc.p(i.x,i.y)),t=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY),t.verts=s,t.lineWidth=r,t.lineColor=o,t.isStroke=!0,t.lineCap="round",this._buffer.push(t)},drawCubicBezier:function(t,e,i,n,r,o,s){o=o||this._lineWidth,s=s||this.getDrawColor(),null==s.a&&(s.a=255);for(var c=[],a=0,l=0;r>l;l++){var h=Math.pow(1-a,3)*t.x+3*Math.pow(1-a,2)*a*e.x+3*(1-a)*a*a*i.x+a*a*a*n.x,u=Math.pow(1-a,3)*t.y+3*Math.pow(1-a,2)*a*e.y+3*(1-a)*a*a*i.y+a*a*a*n.y;c.push(cc.p(h,u)),a+=1/r}c.push(cc.p(n.x,n.y)),t=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY),t.verts=c,t.lineWidth=o,t.lineColor=s,t.isStroke=!0,t.lineCap="round",this._buffer.push(t)},drawCatmullRom:function(t,e,i,n){this.drawCardinalSpline(t,.5,e,i,n)},drawCardinalSpline:function(t,e,i,n,r){n=n||this._lineWidth,r=r||this.getDrawColor(),null==r.a&&(r.a=255);for(var o,s,c=[],a=1/t.length,l=0;i+1>l;l++)s=l/i,1===s?(o=t.length-1,s=1):(o=0|s/a,s=(s-a*o)/a),o=cc.cardinalSplineAt(cc.getControlPointAt(t,o-1),cc.getControlPointAt(t,o-0),cc.getControlPointAt(t,o+1),cc.getControlPointAt(t,o+2),e,s),c.push(o);t=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY),t.verts=c,t.lineWidth=n,t.lineColor=r,t.isStroke=!0,t.lineCap="round",this._buffer.push(t)},drawDot:function(t,e,i){i=i||this.getDrawColor(),null==i.a&&(i.a=255);var n=new cc._DrawNodeElement(cc.DrawNode.TYPE_DOT);n.verts=[t],n.lineWidth=e,n.fillColor=i,this._buffer.push(n)},drawDots:function(t,e,i){if(t&&0!=t.length){i=i||this.getDrawColor(),null==i.a&&(i.a=255);for(var n=0,r=t.length;r>n;n++)this.drawDot(t[n],e,i)}},drawSegment:function(t,e,i,n){i=i||this._lineWidth,n=n||this.getDrawColor(),null==n.a&&(n.a=255);var r=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);r.verts=[t,e],r.lineWidth=2*i,r.lineColor=n,r.isStroke=!0,r.lineCap="round",this._buffer.push(r)},drawPoly_:function(t,e,i,n){i=null==i?this._lineWidth:i,n=n||this.getDrawColor(),null==n.a&&(n.a=255);var r=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);r.verts=t,r.fillColor=e,r.lineWidth=i,r.lineColor=n,r.isClosePolygon=!0,r.isStroke=!0,r.lineCap="round",e&&(r.isFill=!0),this._buffer.push(r)},drawPoly:function(t,e,i,n){for(var r=[],o=0;o<t.length;o++)r.push(cc.p(t[o].x,t[o].y));return this.drawPoly_(r,e,i,n)},clear:function(){this._buffer.length=0},_createRenderCmd:function(){return new cc.DrawNode.CanvasRenderCmd(this)}}),cc.DrawNodeWebGL=cc.Node.extend({_bufferCapacity:0,_buffer:null,_trianglesArrayBuffer:null,_trianglesWebBuffer:null,_trianglesReader:null,_lineWidth:1,_drawColor:null,_blendFunc:null,_dirty:!1,_className:"DrawNodeWebGL",getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(t,e){void 0===e?(this._blendFunc.src=t.src,this._blendFunc.dst=t.dst):(this._blendFunc.src=t,this._blendFunc.dst=e)},ctor:function(){cc.Node.prototype.ctor.call(this),this._buffer=[],this._blendFunc=new cc.BlendFunc(cc.SRC_ALPHA,cc.ONE_MINUS_SRC_ALPHA),this._drawColor=cc.color(255,255,255,255),this.init()},init:function(){return cc.Node.prototype.init.call(this)?(this.shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_LENGTHTEXTURECOLOR),this._ensureCapacity(64),this._trianglesWebBuffer=cc._renderContext.createBuffer(),this._dirty=!0):!1},setLineWidth:function(t){this._lineWidth=t},getLineWidth:function(){return this._lineWidth},setDrawColor:function(t){var e=this._drawColor;e.r=t.r,e.g=t.g,e.b=t.b,e.a=t.a},getDrawColor:function(){return cc.color(this._drawColor.r,this._drawColor.g,this._drawColor.b,this._drawColor.a)},drawRect:function(t,e,i,n,r){n=null==n?this._lineWidth:n,r=r||this.getDrawColor(),null==r.a&&(r.a=255),t=[t,cc.p(e.x,t.y),e,cc.p(t.x,e.y)],null==i?this._drawSegments(t,n,r,!0):this.drawPoly(t,i,n,r)},drawCircle:function(t,e,i,n,r,o,s){o=o||this._lineWidth,s=s||this.getDrawColor(),null==s.a&&(s.a=255);var c,a=2*Math.PI/n,l=[];for(c=0;n>=c;c++){var h=c*a,u=e*Math.cos(h+i)+t.x,h=e*Math.sin(h+i)+t.y;l.push(cc.p(u,h))}for(r&&l.push(cc.p(t.x,t.y)),o*=.5,c=0,t=l.length;t-1>c;c++)this.drawSegment(l[c],l[c+1],o,s)},drawQuadBezier:function(t,e,i,n,r,o){r=r||this._lineWidth,o=o||this.getDrawColor(),null==o.a&&(o.a=255);for(var s=[],c=0,a=0;n>a;a++){var l=Math.pow(1-c,2)*t.x+2*(1-c)*c*e.x+c*c*i.x,h=Math.pow(1-c,2)*t.y+2*(1-c)*c*e.y+c*c*i.y;s.push(cc.p(l,h)),c+=1/n}s.push(cc.p(i.x,i.y)),this._drawSegments(s,r,o,!1)},drawCubicBezier:function(t,e,i,n,r,o,s){o=o||this._lineWidth,s=s||this.getDrawColor(),null==s.a&&(s.a=255);for(var c=[],a=0,l=0;r>l;l++){var h=Math.pow(1-a,3)*t.x+3*Math.pow(1-a,2)*a*e.x+3*(1-a)*a*a*i.x+a*a*a*n.x,u=Math.pow(1-a,3)*t.y+3*Math.pow(1-a,2)*a*e.y+3*(1-a)*a*a*i.y+a*a*a*n.y;c.push(cc.p(h,u)),a+=1/r}c.push(cc.p(n.x,n.y)),this._drawSegments(c,o,s,!1)},drawCatmullRom:function(t,e,i,n){this.drawCardinalSpline(t,.5,e,i,n)},drawCardinalSpline:function(t,e,i,n,r){n=n||this._lineWidth,r=r||this.getDrawColor(),null==r.a&&(r.a=255);for(var o,s,c=[],a=1/t.length,l=0;i+1>l;l++)s=l/i,1===s?(o=t.length-1,s=1):(o=0|s/a,s=(s-a*o)/a),o=cc.cardinalSplineAt(cc.getControlPointAt(t,o-1),cc.getControlPointAt(t,o-0),cc.getControlPointAt(t,o+1),cc.getControlPointAt(t,o+2),e,s),c.push(o);for(n*=.5,t=0,e=c.length;e-1>t;t++)this.drawSegment(c[t],c[t+1],n,r)},_render:function(){var t=cc._renderContext;cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX),t.bindBuffer(t.ARRAY_BUFFER,this._trianglesWebBuffer),this._dirty&&(t.bufferData(t.ARRAY_BUFFER,this._trianglesArrayBuffer,t.STREAM_DRAW),this._dirty=!1);var e=cc.V2F_C4B_T2F.BYTES_PER_ELEMENT;t.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,t.FLOAT,!1,e,0),t.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,t.UNSIGNED_BYTE,!0,e,8),t.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,t.FLOAT,!1,e,12),t.drawArrays(t.TRIANGLES,0,3*this._buffer.length),cc.incrementGLDraws(1)},_ensureCapacity:function(t){var e=this._buffer;if(e.length+t>this._bufferCapacity){var i=cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT;if(this._bufferCapacity+=Math.max(this._bufferCapacity,t),null==e||0===e.length)this._buffer=[],this._trianglesArrayBuffer=new ArrayBuffer(i*this._bufferCapacity),this._trianglesReader=new Uint8Array(this._trianglesArrayBuffer);else{t=[];for(var n=new ArrayBuffer(i*this._bufferCapacity),r=0;r<e.length;r++)t[r]=new cc.V2F_C4B_T2F_Triangle(e[r].a,e[r].b,e[r].c,n,r*i);this._trianglesReader=new Uint8Array(n),this._trianglesArrayBuffer=n,this._buffer=t}}},drawDot:function(t,e,i){i=i||this.getDrawColor(),null==i.a&&(i.a=255);var n={r:0|i.r,g:0|i.g,b:0|i.b,a:0|i.a};i={vertices:{x:t.x-e,y:t.y-e},colors:n,texCoords:{u:-1,v:-1}};var r={vertices:{x:t.x-e,y:t.y+e},colors:n,texCoords:{u:-1,v:1}},o={vertices:{x:t.x+e,y:t.y+e},colors:n,texCoords:{u:1,v:1}};t={vertices:{x:t.x+e,y:t.y-e},colors:n,texCoords:{u:1,v:-1}},this._ensureCapacity(6),this._buffer.push(new cc.V2F_C4B_T2F_Triangle(i,r,o,this._trianglesArrayBuffer,this._buffer.length*cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT)),this._buffer.push(new cc.V2F_C4B_T2F_Triangle(i,o,t,this._trianglesArrayBuffer,this._buffer.length*cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT)),this._dirty=!0},drawDots:function(t,e,i){if(t&&0!==t.length){i=i||this.getDrawColor(),null==i.a&&(i.a=255);for(var n=0,r=t.length;r>n;n++)this.drawDot(t[n],e,i)}},drawSegment:function(t,e,i,n){n=n||this.getDrawColor(),null==n.a&&(n.a=255),i=i||.5*this._lineWidth,this._ensureCapacity(18),n={r:0|n.r,g:0|n.g,b:0|n.b,a:0|n.a};var r=cc.__v2f(t),o=cc.__v2f(e);e=cc.v2fnormalize(cc.v2fperp(cc.v2fsub(o,r))),t=cc.v2fperp(e);var s=cc.v2fmult(e,i),c=cc.v2fmult(t,i);i=cc.v2fsub(o,cc.v2fadd(s,c));var a=cc.v2fadd(o,cc.v2fsub(s,c)),l=cc.v2fsub(o,s),o=cc.v2fadd(o,s),h=cc.v2fsub(r,s),u=cc.v2fadd(r,s),d=cc.v2fsub(r,cc.v2fsub(s,c)),r=cc.v2fadd(r,cc.v2fadd(s,c)),s=cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT,c=this._trianglesArrayBuffer,_=this._buffer;_.push(new cc.V2F_C4B_T2F_Triangle({vertices:i,colors:n,texCoords:cc.__t(cc.v2fneg(cc.v2fadd(e,t)))},{vertices:a,colors:n,texCoords:cc.__t(cc.v2fsub(e,t))},{vertices:l,colors:n,texCoords:cc.__t(cc.v2fneg(e))},c,_.length*s)),_.push(new cc.V2F_C4B_T2F_Triangle({vertices:o,colors:n,texCoords:cc.__t(e)},{vertices:a,colors:n,texCoords:cc.__t(cc.v2fsub(e,t))},{vertices:l,colors:n,texCoords:cc.__t(cc.v2fneg(e))},c,_.length*s)),_.push(new cc.V2F_C4B_T2F_Triangle({vertices:o,colors:n,texCoords:cc.__t(e)},{vertices:h,colors:n,texCoords:cc.__t(cc.v2fneg(e))},{vertices:l,colors:n,texCoords:cc.__t(cc.v2fneg(e))},c,_.length*s)),_.push(new cc.V2F_C4B_T2F_Triangle({vertices:o,colors:n,texCoords:cc.__t(e)},{vertices:h,colors:n,texCoords:cc.__t(cc.v2fneg(e))},{vertices:u,colors:n,texCoords:cc.__t(e)},c,_.length*s)),_.push(new cc.V2F_C4B_T2F_Triangle({vertices:d,colors:n,texCoords:cc.__t(cc.v2fsub(t,e))},{vertices:h,colors:n,texCoords:cc.__t(cc.v2fneg(e))},{vertices:u,colors:n,texCoords:cc.__t(e)},c,_.length*s)),_.push(new cc.V2F_C4B_T2F_Triangle({vertices:d,colors:n,texCoords:cc.__t(cc.v2fsub(t,e))},{vertices:r,colors:n,texCoords:cc.__t(cc.v2fadd(e,t))},{vertices:u,colors:n,texCoords:cc.__t(e)},c,_.length*s)),this._dirty=!0},drawPoly:function(t,e,i,n){if(null==e)this._drawSegments(t,i,n,!0);else{null==e.a&&(e.a=255),null==n.a&&(n.a=255),i=null==i?this._lineWidth:i,i*=.5,e={r:0|e.r,g:0|e.g,b:0|e.b,a:0|e.a},n={r:0|n.r,g:0|n.g,b:0|n.b,a:0|n.a};var r,o,s,c,a=[],l=t.length;for(r=0;l>r;r++){o=cc.__v2f(t[(r-1+l)%l]),s=cc.__v2f(t[r]),c=cc.__v2f(t[(r+1)%l]);var h=cc.v2fnormalize(cc.v2fperp(cc.v2fsub(s,o)));s=cc.v2fnormalize(cc.v2fperp(cc.v2fsub(c,s))),h=cc.v2fmult(cc.v2fadd(h,s),1/(cc.v2fdot(h,s)+1)),a[r]={offset:h,n:s}}h=i>0,this._ensureCapacity(3*(3*l-2));var u=cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT,d=this._trianglesArrayBuffer,_=this._buffer,p=0==h?.5:0;for(r=0;l-2>r;r++)o=cc.v2fsub(cc.__v2f(t[0]),cc.v2fmult(a[0].offset,p)),s=cc.v2fsub(cc.__v2f(t[r+1]),cc.v2fmult(a[r+1].offset,p)),c=cc.v2fsub(cc.__v2f(t[r+2]),cc.v2fmult(a[r+2].offset,p)),_.push(new cc.V2F_C4B_T2F_Triangle({vertices:o,colors:e,texCoords:cc.__t(cc.v2fzero())},{vertices:s,colors:e,texCoords:cc.__t(cc.v2fzero())},{vertices:c,colors:e,texCoords:cc.__t(cc.v2fzero())},d,_.length*u));
for(r=0;l>r;r++){p=(r+1)%l,o=cc.__v2f(t[r]),s=cc.__v2f(t[p]),c=a[r].n;var f=a[r].offset,m=a[p].offset,p=h?cc.v2fsub(o,cc.v2fmult(f,i)):cc.v2fsub(o,cc.v2fmult(f,.5)),g=h?cc.v2fsub(s,cc.v2fmult(m,i)):cc.v2fsub(s,cc.v2fmult(m,.5));o=h?cc.v2fadd(o,cc.v2fmult(f,i)):cc.v2fadd(o,cc.v2fmult(f,.5)),s=h?cc.v2fadd(s,cc.v2fmult(m,i)):cc.v2fadd(s,cc.v2fmult(m,.5)),h?(_.push(new cc.V2F_C4B_T2F_Triangle({vertices:p,colors:n,texCoords:cc.__t(cc.v2fneg(c))},{vertices:g,colors:n,texCoords:cc.__t(cc.v2fneg(c))},{vertices:s,colors:n,texCoords:cc.__t(c)},d,_.length*u)),_.push(new cc.V2F_C4B_T2F_Triangle({vertices:p,colors:n,texCoords:cc.__t(cc.v2fneg(c))},{vertices:o,colors:n,texCoords:cc.__t(c)},{vertices:s,colors:n,texCoords:cc.__t(c)},d,_.length*u))):(_.push(new cc.V2F_C4B_T2F_Triangle({vertices:p,colors:e,texCoords:cc.__t(cc.v2fzero())},{vertices:g,colors:e,texCoords:cc.__t(cc.v2fzero())},{vertices:s,colors:e,texCoords:cc.__t(c)},d,_.length*u)),_.push(new cc.V2F_C4B_T2F_Triangle({vertices:p,colors:e,texCoords:cc.__t(cc.v2fzero())},{vertices:o,colors:e,texCoords:cc.__t(c)},{vertices:s,colors:e,texCoords:cc.__t(c)},d,_.length*u)))}this._dirty=!0}},_drawSegments:function(t,e,i,n){if(e=null==e?this._lineWidth:e,i=i||this._drawColor,null==i.a&&(i.a=255),e*=.5,!(0>=e)){i={r:0|i.r,g:0|i.g,b:0|i.b,a:0|i.a};var r,o,s,c,a=[],l=t.length;for(r=0;l>r;r++){o=cc.__v2f(t[(r-1+l)%l]),s=cc.__v2f(t[r]),c=cc.__v2f(t[(r+1)%l]);var h=cc.v2fnormalize(cc.v2fperp(cc.v2fsub(s,o)));s=cc.v2fnormalize(cc.v2fperp(cc.v2fsub(c,s))),c=cc.v2fmult(cc.v2fadd(h,s),1/(cc.v2fdot(h,s)+1)),a[r]={offset:c,n:s}}this._ensureCapacity(3*(3*l-2)),c=cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT;var h=this._trianglesArrayBuffer,u=this._buffer;for(n=n?l:l-1,r=0;n>r;r++){var d=(r+1)%l;o=cc.__v2f(t[r]),s=cc.__v2f(t[d]);var _=a[r].n,p=a[r].offset,f=a[d].offset,d=cc.v2fsub(o,cc.v2fmult(p,e)),m=cc.v2fsub(s,cc.v2fmult(f,e));o=cc.v2fadd(o,cc.v2fmult(p,e)),s=cc.v2fadd(s,cc.v2fmult(f,e)),u.push(new cc.V2F_C4B_T2F_Triangle({vertices:d,colors:i,texCoords:cc.__t(cc.v2fneg(_))},{vertices:m,colors:i,texCoords:cc.__t(cc.v2fneg(_))},{vertices:s,colors:i,texCoords:cc.__t(_)},h,u.length*c)),u.push(new cc.V2F_C4B_T2F_Triangle({vertices:d,colors:i,texCoords:cc.__t(cc.v2fneg(_))},{vertices:o,colors:i,texCoords:cc.__t(_)},{vertices:s,colors:i,texCoords:cc.__t(_)},h,u.length*c))}this._dirty=!0}},clear:function(){this._buffer.length=0,this._dirty=!0},_createRenderCmd:function(){return new cc.DrawNode.WebGLRenderCmd(this)}}),cc.DrawNode=cc._renderType===cc._RENDER_TYPE_WEBGL?cc.DrawNodeWebGL:cc.DrawNodeCanvas,cc.DrawNode.create=function(){return new cc.DrawNode},cc._DrawNodeElement=function(t,e,i,n,r,o,s,c,a){this.type=t,this.verts=e||null,this.fillColor=i||null,this.lineWidth=n||0,this.lineColor=r||null,this.lineCap=o||"butt",this.isClosePolygon=s||!1,this.isFill=c||!1,this.isStroke=a||!1},cc.DrawNode.TYPE_DOT=0,cc.DrawNode.TYPE_SEGMENT=1,cc.DrawNode.TYPE_POLY=2,function(){cc.DrawNode.CanvasRenderCmd=function(t){cc.Node.CanvasRenderCmd.call(this,t),this._needDraw=!0,this._blendFunc=this._drawColor=this._buffer=null},cc.DrawNode.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype),cc.DrawNode.CanvasRenderCmd.prototype.constructor=cc.DrawNode.CanvasRenderCmd,cc.DrawNode.CanvasRenderCmd.prototype.rendering=function(t,e,i){t=t||cc._renderContext,t.getContext();var n=this._node._displayedOpacity/255;if(0!==n){t.setTransform(this._worldTransform,e,i),t.setGlobalAlpha(n),this._blendFunc&&this._blendFunc.src===cc.SRC_ALPHA&&this._blendFunc.dst===cc.ONE&&t.setCompositeOperation("lighter");for(var n=this._buffer,r=0,o=n.length;o>r;r++){var s=n[r];switch(s.type){case cc.DrawNode.TYPE_DOT:this._drawDot(t,s,e,i);break;case cc.DrawNode.TYPE_SEGMENT:this._drawSegment(t,s,e,i);break;case cc.DrawNode.TYPE_POLY:this._drawPoly(t,s,e,i)}}}},cc.DrawNode.CanvasRenderCmd.prototype._drawDot=function(t,e,i,n){var r=e.fillColor,o=e.verts[0];e=e.lineWidth;var s=t.getContext();t.setFillStyle("rgba("+(0|r.r)+","+(0|r.g)+","+(0|r.b)+","+r.a/255+")"),s.beginPath(),s.arc(o.x*i,-o.y*n,e*i,0,2*Math.PI,!1),s.closePath(),s.fill()},cc.DrawNode.CanvasRenderCmd.prototype._drawSegment=function(t,e,i,n){var r=e.lineColor,o=e.verts[0],s=e.verts[1],c=e.lineWidth;e=e.lineCap;var a=t.getContext();t.setStrokeStyle("rgba("+(0|r.r)+","+(0|r.g)+","+(0|r.b)+","+r.a/255+")"),a.lineWidth=c*i,a.beginPath(),a.lineCap=e,a.moveTo(o.x*i,-o.y*n),a.lineTo(s.x*i,-s.y*n),a.stroke()},cc.DrawNode.CanvasRenderCmd.prototype._drawPoly=function(t,e,i,n){var r=e.verts,o=e.lineCap;if(null!=r){var s=e.fillColor,c=e.lineWidth,a=e.lineColor,l=e.isClosePolygon,h=e.isFill;e=e.isStroke;var u=t.getContext(),d=r[0];for(u.lineCap=o,s&&t.setFillStyle("rgba("+(0|s.r)+","+(0|s.g)+","+(0|s.b)+","+s.a/255+")"),c&&(u.lineWidth=c*i),a&&t.setStrokeStyle("rgba("+(0|a.r)+","+(0|a.g)+","+(0|a.b)+","+a.a/255+")"),u.beginPath(),u.moveTo(d.x*i,-d.y*n),t=1,o=r.length;o>t;t++)u.lineTo(r[t].x*i,-r[t].y*n);l&&u.closePath(),h&&u.fill(),e&&u.stroke()}}}(),function(){cc.DrawNode.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0},cc.DrawNode.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype),cc.DrawNode.WebGLRenderCmd.prototype.constructor=cc.DrawNode.WebGLRenderCmd,cc.DrawNode.WebGLRenderCmd.prototype.rendering=function(t){t=this._node,cc.glBlendFunc(t._blendFunc.src,t._blendFunc.dst),this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix),t._render()}}(),cc.stencilBits=-1,cc.ClippingNode=cc.Node.extend({alphaThreshold:0,inverted:!1,_stencil:null,_className:"ClippingNode",ctor:function(t){t=t||null,cc.Node.prototype.ctor.call(this),this._stencil=t,this.alphaThreshold=1,this.inverted=!1,this._renderCmd.initStencilBits()},init:function(t){return this._stencil=t,this.alphaThreshold=1,this.inverted=!1,this._renderCmd.initStencilBits(),!0},onEnter:function(){cc.Node.prototype.onEnter.call(this),this._stencil.onEnter()},onEnterTransitionDidFinish:function(){cc.Node.prototype.onEnterTransitionDidFinish.call(this),this._stencil.onEnterTransitionDidFinish()},onExitTransitionDidStart:function(){this._stencil.onExitTransitionDidStart(),cc.Node.prototype.onExitTransitionDidStart.call(this)},onExit:function(){this._stencil.onExit(),cc.Node.prototype.onExit.call(this)},getAlphaThreshold:function(){return this.alphaThreshold},setAlphaThreshold:function(t){this.alphaThreshold=t},isInverted:function(){return this.inverted},setInverted:function(t){this.inverted=t},getStencil:function(){return this._stencil},setStencil:function(t){this._stencil!==t&&this._renderCmd.setStencil(t)},_createRenderCmd:function(){return cc._renderType===cc._RENDER_TYPE_CANVAS?new cc.ClippingNode.CanvasRenderCmd(this):new cc.ClippingNode.WebGLRenderCmd(this)}}),_p=cc.ClippingNode.prototype,cc.defineGetterSetter(_p,"stencil",_p.getStencil,_p.setStencil),cc.ClippingNode.create=function(t){return new cc.ClippingNode(t)},function(){cc.ClippingNode.CanvasRenderCmd=function(t){cc.Node.CanvasRenderCmd.call(this,t),this._clipElemType=this._godhelpme=this._needDraw=!1,this._rendererSaveCmd=new cc.CustomRenderCmd(this,this._saveCmdCallback),this._rendererClipCmd=new cc.CustomRenderCmd(this,this._clipCmdCallback),this._rendererRestoreCmd=new cc.CustomRenderCmd(this,this._restoreCmdCallback)};var t=cc.ClippingNode.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);t.constructor=cc.ClippingNode.CanvasRenderCmd,t.initStencilBits=function(){},t.setStencil=function(t){if(null!=t)if(this._node._stencil=t,t instanceof cc.DrawNode){if(t._buffer)for(var e=0;e<t._buffer.length;e++)t._buffer[e].isFill=!1,t._buffer[e].isStroke=!1;t._renderCmd.rendering=function(e,i,n){i=i||cc.view.getScaleX(),n=n||cc.view.getScaleY(),e=(e||cc._renderContext).getContext();var r=this._transform;for(e.transform(r.a,r.b,r.c,r.d,r.tx*i,-r.ty*n),r=0;r<t._buffer.length;r++){var o=t._buffer[r].verts,s=o[0];for(e.moveTo(s.x*i,-s.y*n),s=o.length-1;s>0;s--)e.lineTo(o[s].x*i,-o[s].y*n)}}}else t._parent=this._node},t._saveCmdCallback=function(t,e,i){var n=t||cc._renderContext;t=n.getContext(),this._clipElemType?(e=cc.ClippingNode.CanvasRenderCmd._getSharedCache(),i=t.canvas,e.width=i.width,e.height=i.height,e.getContext("2d").drawImage(i,0,0)):(n.save(),t.beginPath(),n.setTransform(this._worldTransform,e,i),this._node.inverted&&(t.rect(0,0,t.canvas.width,-t.canvas.height),t.clip()))},t._setStencilCompositionOperation=function(t){if(t){var e=this._node;if(t._renderCmd&&t._renderCmd._blendFuncStr&&(t._renderCmd._blendFuncStr=e.inverted?"destination-out":"destination-in"),t._children){t=t._children;for(var e=0,i=t.length;i>e;e++)this._setStencilCompositionOperation(t[e])}}},t._clipCmdCallback=function(t){var e=this._node;t=(t||cc._renderContext).getContext(),this._clipElemType?this._setStencilCompositionOperation(e._stencil):t.clip()},t._restoreCmdCallback=function(t){var e=cc.ClippingNode.CanvasRenderCmd._getSharedCache();t=t||cc._renderContext;var i=t.getContext();this._clipElemType?(i.save(),i.setTransform(1,0,0,1,0,0),i.globalCompositeOperation="destination-over",i.drawImage(e,0,0),i.restore(),this._dirtyFlag=0):t.restore()},t.transform=function(t,e){cc.Node.CanvasRenderCmd.prototype.transform.call(this,t,e);var i=this._node;i._stencil&&i._stencil._renderCmd&&i._stencil._renderCmd.transform(this,e)},t._cangodhelpme=function(t){return(!0===t||!1===t)&&(cc.ClippingNode.CanvasRenderCmd.prototype._godhelpme=t),cc.ClippingNode.CanvasRenderCmd.prototype._godhelpme},t.visit=function(t){var e=this._node;if(e._visible)if((t=t||this.getParentRenderCmd())&&(this._curLevel=t._curLevel+1),this._clipElemType=!(!this._cangodhelpme()&&e._stencil instanceof cc.DrawNode),e._stencil&&e._stencil.visible){if(this._syncStatus(t),cc.renderer.pushRenderCommand(this._rendererSaveCmd),this._clipElemType?cc.Node.CanvasRenderCmd.prototype.visit.call(this,t):e._stencil.visit(this),cc.renderer.pushRenderCommand(this._rendererClipCmd),this._clipElemType)e._stencil.visit(this);else{t=e._children,this._cangodhelpme(!0);var i=t.length;if(i>0)for(e.sortAllChildren(),e=0;i>e;e++)t[e]._renderCmd.visit(this);this._cangodhelpme(!1)}cc.renderer.pushRenderCommand(this._rendererRestoreCmd),this._dirtyFlag=0}else this.inverted&&cc.Node.CanvasRenderCmd.prototype.visit.call(this,t)},cc.ClippingNode.CanvasRenderCmd._sharedCache=null,cc.ClippingNode.CanvasRenderCmd._getSharedCache=function(){return cc.ClippingNode.CanvasRenderCmd._sharedCache||(cc.ClippingNode.CanvasRenderCmd._sharedCache=document.createElement("canvas"))}}(),function(){cc.ClippingNode.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t),this._needDraw=!1,this._beforeVisitCmd=new cc.CustomRenderCmd(this,this._onBeforeVisit),this._afterDrawStencilCmd=new cc.CustomRenderCmd(this,this._onAfterDrawStencil),this._afterVisitCmd=new cc.CustomRenderCmd(this,this._onAfterVisit),this._mask_layer_le=this._currentDepthWriteMask=this._currentStencilEnabled=this._currentStencilWriteMask=this._currentStencilPassDepthPass=this._currentStencilPassDepthFail=this._currentStencilFail=this._currentStencilValueMask=this._currentStencilRef=this._currentStencilFunc=null};var t=cc.ClippingNode.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);t.constructor=cc.ClippingNode.WebGLRenderCmd,cc.ClippingNode.WebGLRenderCmd._init_once=null,cc.ClippingNode.WebGLRenderCmd._visit_once=null,cc.ClippingNode.WebGLRenderCmd._layer=-1,t.initStencilBits=function(){cc.ClippingNode.WebGLRenderCmd._init_once=!0,cc.ClippingNode.WebGLRenderCmd._init_once&&(cc.stencilBits=cc._renderContext.getParameter(cc._renderContext.STENCIL_BITS),0>=cc.stencilBits&&cc.log("Stencil buffer is not enabled."),cc.ClippingNode.WebGLRenderCmd._init_once=!1)},t.transform=function(t,e){var i=this._node;cc.Node.WebGLRenderCmd.prototype.transform.call(this,t,e),i._stencil&&i._stencil._renderCmd.transform(this,e)},t.visit=function(t){var e=this._node;if(e._visible)if(e._parent&&e._parent._renderCmd&&(this._curLevel=e._parent._renderCmd._curLevel+1),1>cc.stencilBits)cc.Node.WebGLRenderCmd.prototype.visit.call(this,t);else if(e._stencil&&e._stencil.visible)if(cc.ClippingNode.WebGLRenderCmd._layer+1===cc.stencilBits)cc.ClippingNode.WebGLRenderCmd._visit_once=!0,cc.ClippingNode.WebGLRenderCmd._visit_once&&(cc.log("Nesting more than "+cc.stencilBits+"stencils is not supported. Everything will be drawn without stencil for this node and its children."),cc.ClippingNode.WebGLRenderCmd._visit_once=!1),cc.Node.WebGLRenderCmd.prototype.visit.call(this,t);else{cc.renderer.pushRenderCommand(this._beforeVisitCmd);var i=cc.current_stack;if(i.stack.push(i.top),this._syncStatus(t),i.top=this._stackMatrix,e._stencil._renderCmd.visit(this),cc.renderer.pushRenderCommand(this._afterDrawStencilCmd),(t=e._children)&&0<t.length){var n=t.length;for(e.sortAllChildren(),e=0;n>e;e++)t[e]._renderCmd.visit(this)}cc.renderer.pushRenderCommand(this._afterVisitCmd),this._dirtyFlag=0,i.top=i.stack.pop()}else e.inverted&&cc.Node.WebGLRenderCmd.prototype.visit.call(this,t)},t.setStencil=function(t){var e=this._node;e._stencil&&(e._stencil._parent=null),e._stencil=t,e._stencil&&(e._stencil._parent=e)},t._drawFullScreenQuadClearStencil=function(){var t=cc.projection_matrix_stack;t.push(),t.top.identity();var e=cc.modelview_matrix_stack;e.push(),e.top.identity(),cc._drawingUtil.drawSolidRect(cc.p(-1,-1),cc.p(1,1),cc.color(255,255,255,255)),t.pop(),e.pop()},t._onBeforeVisit=function(t){var e=t||cc._renderContext;t=this._node,cc.ClippingNode.WebGLRenderCmd._layer++;var i=1<<cc.ClippingNode.WebGLRenderCmd._layer;this._mask_layer_le=i|i-1,this._currentStencilEnabled=e.isEnabled(e.STENCIL_TEST),this._currentStencilWriteMask=e.getParameter(e.STENCIL_WRITEMASK),this._currentStencilFunc=e.getParameter(e.STENCIL_FUNC),this._currentStencilRef=e.getParameter(e.STENCIL_REF),this._currentStencilValueMask=e.getParameter(e.STENCIL_VALUE_MASK),this._currentStencilFail=e.getParameter(e.STENCIL_FAIL),this._currentStencilPassDepthFail=e.getParameter(e.STENCIL_PASS_DEPTH_FAIL),this._currentStencilPassDepthPass=e.getParameter(e.STENCIL_PASS_DEPTH_PASS),e.enable(e.STENCIL_TEST),e.stencilMask(i),this._currentDepthWriteMask=e.getParameter(e.DEPTH_WRITEMASK),e.depthMask(!1),e.stencilFunc(e.NEVER,i,i),e.stencilOp(t.inverted?e.REPLACE:e.ZERO,e.KEEP,e.KEEP),this._drawFullScreenQuadClearStencil(),e.stencilFunc(e.NEVER,i,i),e.stencilOp(t.inverted?e.ZERO:e.REPLACE,e.KEEP,e.KEEP),1>t.alphaThreshold&&(i=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURECOLORALPHATEST),e=e.getUniformLocation(i.getProgram(),cc.UNIFORM_ALPHA_TEST_VALUE_S),cc.glUseProgram(i.getProgram()),i.setUniformLocationWith1f(e,t.alphaThreshold),cc.setProgram(t._stencil,i))},t._onAfterDrawStencil=function(t){t=t||cc._renderContext,t.depthMask(this._currentDepthWriteMask),t.stencilFunc(t.EQUAL,this._mask_layer_le,this._mask_layer_le),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)},t._onAfterVisit=function(t){t=t||cc._renderContext,t.stencilFunc(this._currentStencilFunc,this._currentStencilRef,this._currentStencilValueMask),t.stencilOp(this._currentStencilFail,this._currentStencilPassDepthFail,this._currentStencilPassDepthPass),t.stencilMask(this._currentStencilWriteMask),this._currentStencilEnabled||t.disable(t.STENCIL_TEST),cc.ClippingNode.WebGLRenderCmd._layer--}}(),cc.GridBase=cc.Class.extend({_active:!1,_reuseGrid:0,_gridSize:null,_texture:null,_step:null,_grabber:null,_isTextureFlipped:!1,_shaderProgram:null,_directorProjection:0,_dirty:!1,ctor:function(t,e,i){cc._checkWebGLRenderMode(),this._active=!1,this._reuseGrid=0,this._texture=this._gridSize=null,this._step=cc.p(0,0),this._grabber=null,this._isTextureFlipped=!1,this._shaderProgram=null,this._directorProjection=0,this._dirty=!1,void 0!==t&&this.initWithSize(t,e,i)},isActive:function(){return this._active},setActive:function(t){if(this._active=t,!t){t=cc.director;var e=t.getProjection();t.setProjection(e)}},getReuseGrid:function(){return this._reuseGrid},setReuseGrid:function(t){this._reuseGrid=t},getGridSize:function(){return cc.size(this._gridSize.width,this._gridSize.height)},setGridSize:function(t){this._gridSize.width=parseInt(t.width),this._gridSize.height=parseInt(t.height)},getStep:function(){return cc.p(this._step.x,this._step.y)},setStep:function(t){this._step.x=t.x,this._step.y=t.y},isTextureFlipped:function(){return this._isTextureFlipped},setTextureFlipped:function(t){this._isTextureFlipped!==t&&(this._isTextureFlipped=t,this.calculateVertexPoints())},initWithSize:function(t,e,i){if(!e){var n=cc.director.getWinSizeInPixels(),r=cc.NextPOT(n.width),o=cc.NextPOT(n.height),s=new Uint8Array(r*o*4);if(!s)return cc.log("cocos2d: CCGrid: not enough memory."),!1;if(e=new cc.Texture2D,e.initWithData(s,cc.Texture2D.PIXEL_FORMAT_RGBA8888,r,o,n),!e)return cc.log("cocos2d: CCGrid: error creating texture"),!1}return this._active=!1,this._reuseGrid=0,this._gridSize=t,this._texture=e,this._isTextureFlipped=i||!1,this._step.x=this._texture.width/t.width,this._step.y=this._texture.height/t.height,this._grabber=new cc.Grabber,this._grabber?(this._grabber.grab(this._texture),this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURE),this.calculateVertexPoints(),!0):!1},beforeDraw:function(){this._directorProjection=cc.director.getProjection(),this._grabber.beforeRender(this._texture)},afterDraw:function(t){if(this._grabber.afterRender(this._texture),t&&t.getCamera().isDirty()){var e=t.getAnchorPointInPoints(),i=t._renderCmd._stackMatrix,n=cc.math.Matrix4.createByTranslation(e.x,e.y,0);i.multiply(n),t._camera._locateForRenderer(i),n=cc.math.Matrix4.createByTranslation(-e.x,-e.y,0,n),i.multiply(n)}cc.glBindTexture2D(this._texture),this.beforeBlit(),this.blit(t),this.afterBlit()},beforeBlit:function(){},afterBlit:function(){},blit:function(){cc.log("cc.GridBase.blit(): Shall be overridden in subclass.")},reuse:function(){cc.log("cc.GridBase.reuse(): Shall be overridden in subclass.")},calculateVertexPoints:function(){cc.log("cc.GridBase.calculateVertexPoints(): Shall be overridden in subclass.")},set2DProjection:function(){var t=cc.director.getWinSizeInPixels();cc._renderContext.viewport(0,0,t.width,t.height),cc.kmGLMatrixMode(cc.KM_GL_PROJECTION),cc.kmGLLoadIdentity(),t=cc.math.Matrix4.createOrthographicProjection(0,t.width,0,t.height,-1,1),cc.kmGLMultMatrix(t),cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW),cc.kmGLLoadIdentity(),cc.setProjectionMatrixDirty()}}),cc.GridBase.create=function(t,e,i){return new cc.GridBase(t,e,i)},cc.Grid3D=cc.GridBase.extend({_texCoordinates:null,_vertices:null,_originalVertices:null,_indices:null,_texCoordinateBuffer:null,_verticesBuffer:null,_indicesBuffer:null,_needDepthTestForBlit:!1,_oldDepthTestValue:!1,_oldDepthWriteValue:!1,ctor:function(t,e,i){cc.GridBase.prototype.ctor.call(this),this._indicesBuffer=this._verticesBuffer=this._texCoordinateBuffer=this._indices=this._originalVertices=this._vertices=this._texCoordinates=null,void 0!==t&&this.initWithSize(t,e,i)},vertex:function(t){return this.getVertex(t)},getVertex:function(t){t.x===(0|t.x)&&t.y===(0|t.y)||cc.log("cc.Grid3D.vertex() : Numbers must be integers"),t=0|3*(t.x*(this._gridSize.height+1)+t.y);var e=this._vertices;return new cc.Vertex3F(e[t],e[t+1],e[t+2])},originalVertex:function(t){return this.getOriginalVertex(t)},getOriginalVertex:function(t){t.x===(0|t.x)&&t.y===(0|t.y)||cc.log("cc.Grid3D.originalVertex() : Numbers must be integers"),t=0|3*(t.x*(this._gridSize.height+1)+t.y);var e=this._originalVertices;return new cc.Vertex3F(e[t],e[t+1],e[t+2])},setVertex:function(t,e){t.x===(0|t.x)&&t.y===(0|t.y)||cc.log("cc.Grid3D.setVertex() : Numbers must be integers");var i=0|3*(t.x*(this._gridSize.height+1)+t.y),n=this._vertices;n[i]=e.x,n[i+1]=e.y,n[i+2]=e.z,this._dirty=!0},beforeBlit:function(){if(this._needDepthTestForBlit){var t=cc._renderContext;this._oldDepthTestValue=t.isEnabled(t.DEPTH_TEST),this._oldDepthWriteValue=t.getParameter(t.DEPTH_WRITEMASK),t.enable(t.DEPTH_TEST),t.depthMask(!0)}},afterBlit:function(){if(this._needDepthTestForBlit){var t=cc._renderContext;this._oldDepthTestValue?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),t.depthMask(this._oldDepthWriteValue)}},blit:function(t){var e=this._gridSize.width*this._gridSize.height;cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION|cc.VERTEX_ATTRIB_FLAG_TEX_COORDS),this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(t._renderCmd._stackMatrix),t=cc._renderContext;var i=this._dirty;t.bindBuffer(t.ARRAY_BUFFER,this._verticesBuffer),i&&t.bufferData(t.ARRAY_BUFFER,this._vertices,t.DYNAMIC_DRAW),t.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,this._texCoordinateBuffer),i&&t.bufferData(t.ARRAY_BUFFER,this._texCoordinates,t.DYNAMIC_DRAW),t.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,t.FLOAT,!1,0,0),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._indicesBuffer),i&&t.bufferData(t.ELEMENT_ARRAY_BUFFER,this._indices,t.STATIC_DRAW),t.drawElements(t.TRIANGLES,6*e,t.UNSIGNED_SHORT,0),i&&(this._dirty=!1),cc.incrementGLDraws(1)},reuse:function(){if(0<this._reuseGrid){for(var t=this._originalVertices,e=this._vertices,i=0,n=this._vertices.length;n>i;i++)t[i]=e[i];--this._reuseGrid}},calculateVertexPoints:function(){var t=cc._renderContext,e=this._texture.pixelsWidth,i=this._texture.pixelsHeight,n=this._texture.getContentSizeInPixels().height,r=this._gridSize,o=(r.width+1)*(r.height+1);this._vertices=new Float32Array(3*o),this._texCoordinates=new Float32Array(2*o),this._indices=new Uint16Array(r.width*r.height*6),this._verticesBuffer&&t.deleteBuffer(this._verticesBuffer),this._verticesBuffer=t.createBuffer(),this._texCoordinateBuffer&&t.deleteBuffer(this._texCoordinateBuffer),this._texCoordinateBuffer=t.createBuffer(),this._indicesBuffer&&t.deleteBuffer(this._indicesBuffer),this._indicesBuffer=t.createBuffer();for(var s,c,a=this._indices,l=this._texCoordinates,h=this._isTextureFlipped,u=this._vertices,o=0;o<r.width;++o)for(s=0;s<r.height;++s){var d=s*r.width+o;c=o*this._step.x;var _=c+this._step.x,p=s*this._step.y,f=p+this._step.y,m=o*(r.height+1)+s,g=(o+1)*(r.height+1)+s,y=(o+1)*(r.height+1)+(s+1),T=o*(r.height+1)+(s+1);a[6*d]=m,a[6*d+1]=g,a[6*d+2]=T,a[6*d+3]=g,a[6*d+4]=y,a[6*d+5]=T;var d=[3*m,3*g,3*y,3*T],S=[{x:c,y:p,z:0},{x:_,y:p,z:0},{x:_,y:f,z:0},{x:c,y:f,z:0}],m=[2*m,2*g,2*y,2*T],_=[cc.p(c,p),cc.p(_,p),cc.p(_,f),cc.p(c,f)];for(c=0;4>c;++c)u[d[c]]=S[c].x,u[d[c]+1]=S[c].y,u[d[c]+2]=S[c].z,l[m[c]]=_[c].x/e,l[m[c]+1]=h?(n-_[c].y)/i:_[c].y/i}this._originalVertices=new Float32Array(this._vertices),t.bindBuffer(t.ARRAY_BUFFER,this._verticesBuffer),t.bufferData(t.ARRAY_BUFFER,this._vertices,t.DYNAMIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this._texCoordinateBuffer),t.bufferData(t.ARRAY_BUFFER,this._texCoordinates,t.DYNAMIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._indicesBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this._indices,t.STATIC_DRAW),this._dirty=!0},setNeedDepthTestForBlit:function(t){this._needDepthTestForBlit=t},getNeedDepthTestForBlit:function(){return this._needDepthTestForBlit}}),cc.Grid3D.create=function(t,e,i){return new cc.Grid3D(t,e,i)},cc.TiledGrid3D=cc.GridBase.extend({_texCoordinates:null,_vertices:null,_originalVertices:null,_indices:null,_texCoordinateBuffer:null,_verticesBuffer:null,_indicesBuffer:null,ctor:function(t,e,i){cc.GridBase.prototype.ctor.call(this),this._indicesBuffer=this._verticesBuffer=this._texCoordinateBuffer=this._indices=this._originalVertices=this._vertices=this._texCoordinates=null,void 0!==t&&this.initWithSize(t,e,i)},tile:function(t){return this.getTile(t)},getTile:function(t){t.x===(0|t.x)&&t.y===(0|t.y)||cc.log("cc.TiledGrid3D.tile() : Numbers must be integers"),t=12*(this._gridSize.height*t.x+t.y);var e=this._vertices;return new cc.Quad3(new cc.Vertex3F(e[t],e[t+1],e[t+2]),new cc.Vertex3F(e[t+3],e[t+4],e[t+5]),new cc.Vertex3F(e[t+6],e[t+7],e[t+8]),new cc.Vertex3F(e[t+9],e[t+10],e[t+11]))},getOriginalTile:function(t){t.x===(0|t.x)&&t.y===(0|t.y)||cc.log("cc.TiledGrid3D.originalTile() : Numbers must be integers"),t=12*(this._gridSize.height*t.x+t.y);var e=this._originalVertices;return new cc.Quad3(new cc.Vertex3F(e[t],e[t+1],e[t+2]),new cc.Vertex3F(e[t+3],e[t+4],e[t+5]),new cc.Vertex3F(e[t+6],e[t+7],e[t+8]),new cc.Vertex3F(e[t+9],e[t+10],e[t+11]))},originalTile:function(t){return this.getOriginalTile(t)},setTile:function(t,e){t.x===(0|t.x)&&t.y===(0|t.y)||cc.log("cc.TiledGrid3D.setTile() : Numbers must be integers");var i=12*(this._gridSize.height*t.x+t.y),n=this._vertices;n[i]=e.bl.x,n[i+1]=e.bl.y,n[i+2]=e.bl.z,n[i+3]=e.br.x,n[i+4]=e.br.y,n[i+5]=e.br.z,n[i+6]=e.tl.x,n[i+7]=e.tl.y,n[i+8]=e.tl.z,n[i+9]=e.tr.x,n[i+10]=e.tr.y,n[i+11]=e.tr.z,this._dirty=!0},blit:function(t){var e=this._gridSize.width*this._gridSize.height;this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(t._renderCmd._stackMatrix),t=cc._renderContext;var i=this._dirty;cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION|cc.VERTEX_ATTRIB_FLAG_TEX_COORDS),t.bindBuffer(t.ARRAY_BUFFER,this._verticesBuffer),i&&t.bufferData(t.ARRAY_BUFFER,this._vertices,t.DYNAMIC_DRAW),t.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,t.FLOAT,!1,0,this._vertices),t.bindBuffer(t.ARRAY_BUFFER,this._texCoordinateBuffer),i&&t.bufferData(t.ARRAY_BUFFER,this._texCoordinates,t.DYNAMIC_DRAW),t.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,t.FLOAT,!1,0,this._texCoordinates),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._indicesBuffer),i&&t.bufferData(t.ELEMENT_ARRAY_BUFFER,this._indices,t.STATIC_DRAW),t.drawElements(t.TRIANGLES,6*e,t.UNSIGNED_SHORT,0),i&&(this._dirty=!1),cc.incrementGLDraws(1)},reuse:function(){if(0<this._reuseGrid){for(var t=this._vertices,e=this._originalVertices,i=0;i<t.length;i++)e[i]=t[i];--this._reuseGrid}},calculateVertexPoints:function(){var t=this._texture.pixelsWidth,e=this._texture.pixelsHeight,i=this._texture.getContentSizeInPixels().height,n=this._gridSize,r=n.width*n.height;this._vertices=new Float32Array(12*r),this._texCoordinates=new Float32Array(8*r),this._indices=new Uint16Array(6*r);var o=cc._renderContext;this._verticesBuffer&&o.deleteBuffer(this._verticesBuffer),this._verticesBuffer=o.createBuffer(),this._texCoordinateBuffer&&o.deleteBuffer(this._texCoordinateBuffer),this._texCoordinateBuffer=o.createBuffer(),this._indicesBuffer&&o.deleteBuffer(this._indicesBuffer),this._indicesBuffer=o.createBuffer();var s,c,a=0,l=this._step,h=this._vertices,u=this._texCoordinates,d=this._isTextureFlipped;for(s=0;s<n.width;s++)for(c=0;c<n.height;c++){var _=s*l.x,p=_+l.x,f=c*l.y,m=f+l.y;h[12*a]=_,h[12*a+1]=f,h[12*a+2]=0,h[12*a+3]=p,h[12*a+4]=f,h[12*a+5]=0,h[12*a+6]=_,h[12*a+7]=m,h[12*a+8]=0,h[12*a+9]=p,h[12*a+10]=m,h[12*a+11]=0;var g=f,y=m;d&&(g=i-f,y=i-m),u[8*a]=_/t,u[8*a+1]=g/e,u[8*a+2]=p/t,u[8*a+3]=g/e,u[8*a+4]=_/t,u[8*a+5]=y/e,u[8*a+6]=p/t,u[8*a+7]=y/e,a++}for(t=this._indices,s=0;r>s;s++)t[6*s+0]=4*s+0,t[6*s+1]=4*s+1,t[6*s+2]=4*s+2,t[6*s+3]=4*s+1,t[6*s+4]=4*s+2,t[6*s+5]=4*s+3;this._originalVertices=new Float32Array(this._vertices),o.bindBuffer(o.ARRAY_BUFFER,this._verticesBuffer),o.bufferData(o.ARRAY_BUFFER,this._vertices,o.DYNAMIC_DRAW),o.bindBuffer(o.ARRAY_BUFFER,this._texCoordinateBuffer),o.bufferData(o.ARRAY_BUFFER,this._texCoordinates,o.DYNAMIC_DRAW),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,this._indicesBuffer),o.bufferData(o.ELEMENT_ARRAY_BUFFER,this._indices,o.DYNAMIC_DRAW),this._dirty=!0}}),cc.TiledGrid3D.create=function(t,e,i){return new cc.TiledGrid3D(t,e,i)},cc.Grabber=cc.Class.extend({_FBO:null,_oldFBO:null,_oldClearColor:null,_gl:null,ctor:function(){cc._checkWebGLRenderMode(),this._gl=cc._renderContext,this._oldClearColor=[0,0,0,0],this._oldFBO=null,this._FBO=this._gl.createFramebuffer()},grab:function(t){var e=this._gl;this._oldFBO=e.getParameter(e.FRAMEBUFFER_BINDING),e.bindFramebuffer(e.FRAMEBUFFER,this._FBO),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t._webTextureObj,0),e.checkFramebufferStatus(e.FRAMEBUFFER)!==e.FRAMEBUFFER_COMPLETE&&cc.log("Frame Grabber: could not attach texture to frmaebuffer"),e.bindFramebuffer(e.FRAMEBUFFER,this._oldFBO)},beforeRender:function(t){t=this._gl,this._oldFBO=t.getParameter(t.FRAMEBUFFER_BINDING),t.bindFramebuffer(t.FRAMEBUFFER,this._FBO),this._oldClearColor=t.getParameter(t.COLOR_CLEAR_VALUE),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)},afterRender:function(t){t=this._gl,t.bindFramebuffer(t.FRAMEBUFFER,this._oldFBO),t.colorMask(!0,!0,!0,!0)},destroy:function(){this._gl.deleteFramebuffer(this._FBO)}}),cc.ACTION_TAG_INVALID=-1,cc.Action=cc.Class.extend({originalTarget:null,target:null,tag:cc.ACTION_TAG_INVALID,ctor:function(){this.target=this.originalTarget=null,this.tag=cc.ACTION_TAG_INVALID},copy:function(){return cc.log("copy is deprecated. Please use clone instead."),this.clone()},clone:function(){var t=new cc.Action;return t.originalTarget=null,t.target=null,t.tag=this.tag,t},isDone:function(){return!0},startWithTarget:function(t){this.target=this.originalTarget=t},stop:function(){this.target=null},step:function(){cc.log("[Action step]. override me")},update:function(){cc.log("[Action update]. override me")},getTarget:function(){return this.target},setTarget:function(t){this.target=t},getOriginalTarget:function(){return this.originalTarget},setOriginalTarget:function(t){this.originalTarget=t},getTag:function(){return this.tag},setTag:function(t){this.tag=t},retain:function(){},release:function(){}}),cc.action=function(){return new cc.Action},cc.Action.create=cc.action,cc.FiniteTimeAction=cc.Action.extend({_duration:0,ctor:function(){cc.Action.prototype.ctor.call(this),this._duration=0},getDuration:function(){return this._duration*(this._timesForRepeat||1)},setDuration:function(t){this._duration=t},reverse:function(){return cc.log("cocos2d: FiniteTimeAction#reverse: Implement me"),null},clone:function(){return new cc.FiniteTimeAction}}),cc.Speed=cc.Action.extend({_speed:0,_innerAction:null,ctor:function(t,e){cc.Action.prototype.ctor.call(this),this._speed=0,this._innerAction=null,t&&this.initWithAction(t,e)},getSpeed:function(){return this._speed},setSpeed:function(t){this._speed=t},initWithAction:function(t,e){if(!t)throw"cc.Speed.initWithAction(): action must be non nil";return this._innerAction=t,this._speed=e,!0},clone:function(){var t=new cc.Speed;return t.initWithAction(this._innerAction.clone(),this._speed),t},startWithTarget:function(t){cc.Action.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},stop:function(){this._innerAction.stop(),cc.Action.prototype.stop.call(this)},step:function(t){this._innerAction.step(t*this._speed)},isDone:function(){return this._innerAction.isDone()},reverse:function(){return new cc.Speed(this._innerAction.reverse(),this._speed)},setInnerAction:function(t){this._innerAction!==t&&(this._innerAction=t)},getInnerAction:function(){return this._innerAction}}),cc.speed=function(t,e){return new cc.Speed(t,e)},cc.Speed.create=cc.speed,cc.Follow=cc.Action.extend({_followedNode:null,_boundarySet:!1,_boundaryFullyCovered:!1,_halfScreenSize:null,_fullScreenSize:null,_worldRect:null,leftBoundary:0,rightBoundary:0,topBoundary:0,bottomBoundary:0,ctor:function(t,e){cc.Action.prototype.ctor.call(this),this._followedNode=null,this._boundaryFullyCovered=this._boundarySet=!1,this._fullScreenSize=this._halfScreenSize=null,this.bottomBoundary=this.topBoundary=this.rightBoundary=this.leftBoundary=0,this._worldRect=cc.rect(0,0,0,0),t&&(e?this.initWithTarget(t,e):this.initWithTarget(t))},clone:function(){var t=new cc.Follow,e=this._worldRect,e=new cc.Rect(e.x,e.y,e.width,e.height);return t.initWithTarget(this._followedNode,e),t},isBoundarySet:function(){return this._boundarySet},setBoudarySet:function(t){this._boundarySet=t},initWithTarget:function(t,e){if(!t)throw"cc.Follow.initWithAction(): followedNode must be non nil";e=e||cc.rect(0,0,0,0),this._followedNode=t,this._worldRect=e,this._boundarySet=!cc._rectEqualToZero(e),this._boundaryFullyCovered=!1;var i=cc.director.getWinSize();return this._fullScreenSize=cc.p(i.width,i.height),this._halfScreenSize=cc.pMult(this._fullScreenSize,.5),this._boundarySet&&(this.leftBoundary=-(e.x+e.width-this._fullScreenSize.x),this.rightBoundary=-e.x,this.topBoundary=-e.y,this.bottomBoundary=-(e.y+e.height-this._fullScreenSize.y),this.rightBoundary<this.leftBoundary&&(this.rightBoundary=this.leftBoundary=(this.leftBoundary+this.rightBoundary)/2),this.topBoundary<this.bottomBoundary&&(this.topBoundary=this.bottomBoundary=(this.topBoundary+this.bottomBoundary)/2),this.topBoundary===this.bottomBoundary&&this.leftBoundary===this.rightBoundary&&(this._boundaryFullyCovered=!0)),!0
},step:function(t){t=this._followedNode.x;var e=this._followedNode.y;t=this._halfScreenSize.x-t,e=this._halfScreenSize.y-e,this.target._renderCmd._dirtyFlag=0,this._boundarySet?this._boundaryFullyCovered||this.target.setPosition(cc.clampf(t,this.leftBoundary,this.rightBoundary),cc.clampf(e,this.bottomBoundary,this.topBoundary)):this.target.setPosition(t,e)},isDone:function(){return!this._followedNode.running},stop:function(){this.target=null,cc.Action.prototype.stop.call(this)}}),cc.follow=function(t,e){return new cc.Follow(t,e)},cc.Follow.create=cc.follow,cc.ActionInterval=cc.FiniteTimeAction.extend({_elapsed:0,_firstTick:!1,_easeList:null,_timesForRepeat:1,_repeatForever:!1,_repeatMethod:!1,_speed:1,_speedMethod:!1,ctor:function(t){this._timesForRepeat=this._speed=1,this._repeatForever=!1,this.MAX_VALUE=2,this._speedMethod=this._repeatMethod=!1,cc.FiniteTimeAction.prototype.ctor.call(this),void 0!==t&&this.initWithDuration(t)},getElapsed:function(){return this._elapsed},initWithDuration:function(t){return this._duration=0===t?cc.FLT_EPSILON:t,this._elapsed=0,this._firstTick=!0},isDone:function(){return this._elapsed>=this._duration},_cloneDecoration:function(t){t._repeatForever=this._repeatForever,t._speed=this._speed,t._timesForRepeat=this._timesForRepeat,t._easeList=this._easeList,t._speedMethod=this._speedMethod,t._repeatMethod=this._repeatMethod},_reverseEaseList:function(t){if(this._easeList){t._easeList=[];for(var e=0;e<this._easeList.length;e++)t._easeList.push(this._easeList[e].reverse())}},clone:function(){var t=new cc.ActionInterval(this._duration);return this._cloneDecoration(t),t},easing:function(){this._easeList?this._easeList.length=0:this._easeList=[];for(var t=0;t<arguments.length;t++)this._easeList.push(arguments[t]);return this},_computeEaseTime:function(t){var e=this._easeList;if(!e||0===e.length)return t;for(var i=0,n=e.length;n>i;i++)t=e[i].easing(t);return t},step:function(t){this._firstTick?(this._firstTick=!1,this._elapsed=0):this._elapsed+=t,t=this._elapsed/(1.192092896e-7<this._duration?this._duration:1.192092896e-7),t=1>t?t:1,this.update(t>0?t:0),this._repeatMethod&&1<this._timesForRepeat&&this.isDone()&&(this._repeatForever||this._timesForRepeat--,this.startWithTarget(this.target),this.step(this._elapsed-this._duration))},startWithTarget:function(t){cc.Action.prototype.startWithTarget.call(this,t),this._elapsed=0,this._firstTick=!0},reverse:function(){return cc.log("cc.IntervalAction: reverse not implemented."),null},setAmplitudeRate:function(){cc.log("cc.ActionInterval.setAmplitudeRate(): it should be overridden in subclass.")},getAmplitudeRate:function(){return cc.log("cc.ActionInterval.getAmplitudeRate(): it should be overridden in subclass."),0},speed:function(t){return 0>=t?(cc.log("The speed parameter error"),this):(this._speedMethod=!0,this._speed*=t,this)},getSpeed:function(){return this._speed},setSpeed:function(t){return this._speed=t,this},repeat:function(t){return t=Math.round(t),isNaN(t)||1>t?(cc.log("The repeat parameter error"),this):(this._repeatMethod=!0,this._timesForRepeat*=t,this)},repeatForever:function(){return this._repeatMethod=!0,this._timesForRepeat=this.MAX_VALUE,this._repeatForever=!0,this}}),cc.actionInterval=function(t){return new cc.ActionInterval(t)},cc.ActionInterval.create=cc.actionInterval,cc.Sequence=cc.ActionInterval.extend({_actions:null,_split:null,_last:0,ctor:function(t){cc.ActionInterval.prototype.ctor.call(this),this._actions=[];var e=t instanceof Array?t:arguments,i=e.length-1;if(i>=0&&null==e[i]&&cc.log("parameters should not be ending with null in Javascript"),i>=0){for(var n=e[0],r=1;i>r;r++)e[r]&&(n=cc.Sequence._actionOneTwo(n,e[r]));this.initWithTwoActions(n,e[i])}},initWithTwoActions:function(t,e){if(!t||!e)throw"cc.Sequence.initWithTwoActions(): arguments must all be non nil";return this.initWithDuration(t._duration+e._duration),this._actions[0]=t,this._actions[1]=e,!0},clone:function(){var t=new cc.Sequence;return this._cloneDecoration(t),t.initWithTwoActions(this._actions[0].clone(),this._actions[1].clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._split=this._actions[0]._duration/this._duration,this._last=-1},stop:function(){-1!==this._last&&this._actions[this._last].stop(),cc.Action.prototype.stop.call(this)},update:function(t){var e=0,i=this._split,n=this._actions,r=this._last;t=this._computeEaseTime(t),i>t?(t=0!==i?t/i:1,0===e&&1===r&&(n[1].update(0),n[1].stop())):(e=1,t=1===i?1:(t-i)/(1-i),-1===r&&(n[0].startWithTarget(this.target),n[0].update(1),n[0].stop()),r||(n[0].update(1),n[0].stop())),n=n[e],r===e&&n.isDone()||(r!==e&&n.startWithTarget(this.target),t*=n._timesForRepeat,n.update(t>1?t%1:t),this._last=e)},reverse:function(){var t=cc.Sequence._actionOneTwo(this._actions[1].reverse(),this._actions[0].reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.sequence=function(t){var e=t instanceof Array?t:arguments;0<e.length&&null==e[e.length-1]&&cc.log("parameters should not be ending with null in Javascript");for(var i,n,r,o;e&&0<e.length;)for(n=Array.prototype.shift.call(e),o=n._timesForRepeat||1,n._repeatMethod=!1,n._timesForRepeat=1,r=0,i||(i=n,r=1),r;o>r;r++)i=cc.Sequence._actionOneTwo(i,n);return i},cc.Sequence.create=cc.sequence,cc.Sequence._actionOneTwo=function(t,e){var i=new cc.Sequence;return i.initWithTwoActions(t,e),i},cc.Repeat=cc.ActionInterval.extend({_times:0,_total:0,_nextDt:0,_actionInstant:!1,_innerAction:null,ctor:function(t,e){cc.ActionInterval.prototype.ctor.call(this),void 0!==e&&this.initWithAction(t,e)},initWithAction:function(t,e){return this.initWithDuration(t._duration*e)?(this._times=e,this._innerAction=t,t instanceof cc.ActionInstant&&(this._actionInstant=!0,this._times-=1),this._total=0,!0):!1},clone:function(){var t=new cc.Repeat;return this._cloneDecoration(t),t.initWithAction(this._innerAction.clone(),this._times),t},startWithTarget:function(t){this._total=0,this._nextDt=this._innerAction._duration/this._duration,cc.ActionInterval.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},stop:function(){this._innerAction.stop(),cc.Action.prototype.stop.call(this)},update:function(t){t=this._computeEaseTime(t);var e=this._innerAction,i=this._duration,n=this._times,r=this._nextDt;if(t>=r){for(;t>r&&this._total<n;)e.update(1),this._total++,e.stop(),e.startWithTarget(this.target),this._nextDt=r+=e._duration/i;t>=1&&this._total<n&&this._total++,this._actionInstant||(this._total===n?(e.update(1),e.stop()):e.update(t-(r-e._duration/i)))}else e.update(t*n%1)},isDone:function(){return this._total===this._times},reverse:function(){var t=new cc.Repeat(this._innerAction.reverse(),this._times);return this._cloneDecoration(t),this._reverseEaseList(t),t},setInnerAction:function(t){this._innerAction!==t&&(this._innerAction=t)},getInnerAction:function(){return this._innerAction}}),cc.repeat=function(t,e){return new cc.Repeat(t,e)},cc.Repeat.create=cc.repeat,cc.RepeatForever=cc.ActionInterval.extend({_innerAction:null,ctor:function(t){cc.ActionInterval.prototype.ctor.call(this),this._innerAction=null,t&&this.initWithAction(t)},initWithAction:function(t){if(!t)throw"cc.RepeatForever.initWithAction(): action must be non null";return this._innerAction=t,!0},clone:function(){var t=new cc.RepeatForever;return this._cloneDecoration(t),t.initWithAction(this._innerAction.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},step:function(t){var e=this._innerAction;e.step(t),e.isDone()&&(e.startWithTarget(this.target),e.step(e.getElapsed()-e._duration))},isDone:function(){return!1},reverse:function(){var t=new cc.RepeatForever(this._innerAction.reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t},setInnerAction:function(t){this._innerAction!==t&&(this._innerAction=t)},getInnerAction:function(){return this._innerAction}}),cc.repeatForever=function(t){return new cc.RepeatForever(t)},cc.RepeatForever.create=cc.repeatForever,cc.Spawn=cc.ActionInterval.extend({_one:null,_two:null,ctor:function(t){cc.ActionInterval.prototype.ctor.call(this),this._two=this._one=null;var e=t instanceof Array?t:arguments,i=e.length-1;if(i>=0&&null==e[i]&&cc.log("parameters should not be ending with null in Javascript"),i>=0){for(var n=e[0],r=1;i>r;r++)e[r]&&(n=cc.Spawn._actionOneTwo(n,e[r]));this.initWithTwoActions(n,e[i])}},initWithTwoActions:function(t,e){if(!t||!e)throw"cc.Spawn.initWithTwoActions(): arguments must all be non null";var i=!1,n=t._duration,r=e._duration;return this.initWithDuration(Math.max(n,r))&&(this._one=t,this._two=e,n>r?this._two=cc.Sequence._actionOneTwo(e,cc.delayTime(n-r)):r>n&&(this._one=cc.Sequence._actionOneTwo(t,cc.delayTime(r-n))),i=!0),i},clone:function(){var t=new cc.Spawn;return this._cloneDecoration(t),t.initWithTwoActions(this._one.clone(),this._two.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._one.startWithTarget(t),this._two.startWithTarget(t)},stop:function(){this._one.stop(),this._two.stop(),cc.Action.prototype.stop.call(this)},update:function(t){t=this._computeEaseTime(t),this._one&&this._one.update(t),this._two&&this._two.update(t)},reverse:function(){var t=cc.Spawn._actionOneTwo(this._one.reverse(),this._two.reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.spawn=function(t){var e=t instanceof Array?t:arguments;0<e.length&&null==e[e.length-1]&&cc.log("parameters should not be ending with null in Javascript");for(var i=e[0],n=1;n<e.length;n++)null!=e[n]&&(i=cc.Spawn._actionOneTwo(i,e[n]));return i},cc.Spawn.create=cc.spawn,cc.Spawn._actionOneTwo=function(t,e){var i=new cc.Spawn;return i.initWithTwoActions(t,e),i},cc.RotateTo=cc.ActionInterval.extend({_dstAngleX:0,_startAngleX:0,_diffAngleX:0,_dstAngleY:0,_startAngleY:0,_diffAngleY:0,ctor:function(t,e,i){cc.ActionInterval.prototype.ctor.call(this),void 0!==e&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){return cc.ActionInterval.prototype.initWithDuration.call(this,t)?(this._dstAngleX=e||0,this._dstAngleY=i||this._dstAngleX,!0):!1},clone:function(){var t=new cc.RotateTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._dstAngleX,this._dstAngleY),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.rotationX%360,i=this._dstAngleX-e;i>180&&(i-=360),-180>i&&(i+=360),this._startAngleX=e,this._diffAngleX=i,this._startAngleY=t.rotationY%360,t=this._dstAngleY-this._startAngleY,t>180&&(t-=360),-180>t&&(t+=360),this._diffAngleY=t},reverse:function(){cc.log("cc.RotateTo.reverse(): it should be overridden in subclass.")},update:function(t){t=this._computeEaseTime(t),this.target&&(this.target.rotationX=this._startAngleX+this._diffAngleX*t,this.target.rotationY=this._startAngleY+this._diffAngleY*t)}}),cc.rotateTo=function(t,e,i){return new cc.RotateTo(t,e,i)},cc.RotateTo.create=cc.rotateTo,cc.RotateBy=cc.ActionInterval.extend({_angleX:0,_startAngleX:0,_angleY:0,_startAngleY:0,ctor:function(t,e,i){cc.ActionInterval.prototype.ctor.call(this),void 0!==e&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){return cc.ActionInterval.prototype.initWithDuration.call(this,t)?(this._angleX=e||0,this._angleY=i||this._angleX,!0):!1},clone:function(){var t=new cc.RotateBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._angleX,this._angleY),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._startAngleX=t.rotationX,this._startAngleY=t.rotationY},update:function(t){t=this._computeEaseTime(t),this.target&&(this.target.rotationX=this._startAngleX+this._angleX*t,this.target.rotationY=this._startAngleY+this._angleY*t)},reverse:function(){var t=new cc.RotateBy(this._duration,-this._angleX,-this._angleY);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.rotateBy=function(t,e,i){return new cc.RotateBy(t,e,i)},cc.RotateBy.create=cc.rotateBy,cc.MoveBy=cc.ActionInterval.extend({_positionDelta:null,_startPosition:null,_previousPosition:null,ctor:function(t,e,i){cc.ActionInterval.prototype.ctor.call(this),this._positionDelta=cc.p(0,0),this._startPosition=cc.p(0,0),this._previousPosition=cc.p(0,0),void 0!==e&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){return cc.ActionInterval.prototype.initWithDuration.call(this,t)?(void 0!==e.x&&(i=e.y,e=e.x),this._positionDelta.x=e,this._positionDelta.y=i,!0):!1},clone:function(){var t=new cc.MoveBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._positionDelta),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.getPositionX();t=t.getPositionY(),this._previousPosition.x=e,this._previousPosition.y=t,this._startPosition.x=e,this._startPosition.y=t},update:function(t){if(t=this._computeEaseTime(t),this.target){var e=this._positionDelta.x*t;t*=this._positionDelta.y;var i=this._startPosition;if(cc.ENABLE_STACKABLE_ACTIONS){var n=this.target.getPositionX(),r=this.target.getPositionY(),o=this._previousPosition;i.x=i.x+n-o.x,i.y=i.y+r-o.y,e+=i.x,t+=i.y,o.x=e,o.y=t,this.target.setPosition(e,t)}else this.target.setPosition(i.x+e,i.y+t)}},reverse:function(){var t=new cc.MoveBy(this._duration,cc.p(-this._positionDelta.x,-this._positionDelta.y));return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.moveBy=function(t,e,i){return new cc.MoveBy(t,e,i)},cc.MoveBy.create=cc.moveBy,cc.MoveTo=cc.MoveBy.extend({_endPosition:null,ctor:function(t,e,i){cc.MoveBy.prototype.ctor.call(this),this._endPosition=cc.p(0,0),void 0!==e&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){return cc.MoveBy.prototype.initWithDuration.call(this,t,e,i)?(void 0!==e.x&&(i=e.y,e=e.x),this._endPosition.x=e,this._endPosition.y=i,!0):!1},clone:function(){var t=new cc.MoveTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endPosition),t},startWithTarget:function(t){cc.MoveBy.prototype.startWithTarget.call(this,t),this._positionDelta.x=this._endPosition.x-t.getPositionX(),this._positionDelta.y=this._endPosition.y-t.getPositionY()}}),cc.moveTo=function(t,e,i){return new cc.MoveTo(t,e,i)},cc.MoveTo.create=cc.moveTo,cc.SkewTo=cc.ActionInterval.extend({_skewX:0,_skewY:0,_startSkewX:0,_startSkewY:0,_endSkewX:0,_endSkewY:0,_deltaX:0,_deltaY:0,ctor:function(t,e,i){cc.ActionInterval.prototype.ctor.call(this),void 0!==i&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){var n=!1;return cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._endSkewX=e,this._endSkewY=i,n=!0),n},clone:function(){var t=new cc.SkewTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endSkewX,this._endSkewY),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._startSkewX=t.skewX%180,this._deltaX=this._endSkewX-this._startSkewX,180<this._deltaX&&(this._deltaX-=360),-180>this._deltaX&&(this._deltaX+=360),this._startSkewY=t.skewY%360,this._deltaY=this._endSkewY-this._startSkewY,180<this._deltaY&&(this._deltaY-=360),-180>this._deltaY&&(this._deltaY+=360)},update:function(t){t=this._computeEaseTime(t),this.target.skewX=this._startSkewX+this._deltaX*t,this.target.skewY=this._startSkewY+this._deltaY*t}}),cc.skewTo=function(t,e,i){return new cc.SkewTo(t,e,i)},cc.SkewTo.create=cc.skewTo,cc.SkewBy=cc.SkewTo.extend({ctor:function(t,e,i){cc.SkewTo.prototype.ctor.call(this),void 0!==i&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){var n=!1;return cc.SkewTo.prototype.initWithDuration.call(this,t,e,i)&&(this._skewX=e,this._skewY=i,n=!0),n},clone:function(){var t=new cc.SkewBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._skewX,this._skewY),t},startWithTarget:function(t){cc.SkewTo.prototype.startWithTarget.call(this,t),this._deltaX=this._skewX,this._deltaY=this._skewY,this._endSkewX=this._startSkewX+this._deltaX,this._endSkewY=this._startSkewY+this._deltaY},reverse:function(){var t=new cc.SkewBy(this._duration,-this._skewX,-this._skewY);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.skewBy=function(t,e,i){return new cc.SkewBy(t,e,i)},cc.SkewBy.create=cc.skewBy,cc.JumpBy=cc.ActionInterval.extend({_startPosition:null,_delta:null,_height:0,_jumps:0,_previousPosition:null,ctor:function(t,e,i,n,r){cc.ActionInterval.prototype.ctor.call(this),this._startPosition=cc.p(0,0),this._previousPosition=cc.p(0,0),this._delta=cc.p(0,0),void 0!==n&&this.initWithDuration(t,e,i,n,r)},initWithDuration:function(t,e,i,n,r){return cc.ActionInterval.prototype.initWithDuration.call(this,t)?(void 0===r&&(r=n,n=i,i=e.y,e=e.x),this._delta.x=e,this._delta.y=i,this._height=n,this._jumps=r,!0):!1},clone:function(){var t=new cc.JumpBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._delta,this._height,this._jumps),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.getPositionX();t=t.getPositionY(),this._previousPosition.x=e,this._previousPosition.y=t,this._startPosition.x=e,this._startPosition.y=t},update:function(t){if(t=this._computeEaseTime(t),this.target){var e=t*this._jumps%1,e=4*this._height*e*(1-e),e=e+this._delta.y*t;t*=this._delta.x;var i=this._startPosition;if(cc.ENABLE_STACKABLE_ACTIONS){var n=this.target.getPositionX(),r=this.target.getPositionY(),o=this._previousPosition;i.x=i.x+n-o.x,i.y=i.y+r-o.y,t+=i.x,e+=i.y,o.x=t,o.y=e,this.target.setPosition(t,e)}else this.target.setPosition(i.x+t,i.y+e)}},reverse:function(){var t=new cc.JumpBy(this._duration,cc.p(-this._delta.x,-this._delta.y),this._height,this._jumps);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.jumpBy=function(t,e,i,n,r){return new cc.JumpBy(t,e,i,n,r)},cc.JumpBy.create=cc.jumpBy,cc.JumpTo=cc.JumpBy.extend({_endPosition:null,ctor:function(t,e,i,n,r){cc.JumpBy.prototype.ctor.call(this),this._endPosition=cc.p(0,0),void 0!==n&&this.initWithDuration(t,e,i,n,r)},initWithDuration:function(t,e,i,n,r){return cc.JumpBy.prototype.initWithDuration.call(this,t,e,i,n,r)?(void 0===r&&(i=e.y,e=e.x),this._endPosition.x=e,this._endPosition.y=i,!0):!1},startWithTarget:function(t){cc.JumpBy.prototype.startWithTarget.call(this,t),this._delta.x=this._endPosition.x-this._startPosition.x,this._delta.y=this._endPosition.y-this._startPosition.y},clone:function(){var t=new cc.JumpTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endPosition,this._height,this._jumps),t}}),cc.jumpTo=function(t,e,i,n,r){return new cc.JumpTo(t,e,i,n,r)},cc.JumpTo.create=cc.jumpTo,cc.bezierAt=function(t,e,i,n,r){return Math.pow(1-r,3)*t+3*r*Math.pow(1-r,2)*e+3*Math.pow(r,2)*(1-r)*i+Math.pow(r,3)*n},cc.BezierBy=cc.ActionInterval.extend({_config:null,_startPosition:null,_previousPosition:null,ctor:function(t,e){cc.ActionInterval.prototype.ctor.call(this),this._config=[],this._startPosition=cc.p(0,0),this._previousPosition=cc.p(0,0),e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return cc.ActionInterval.prototype.initWithDuration.call(this,t)?(this._config=e,!0):!1},clone:function(){var t=new cc.BezierBy;this._cloneDecoration(t);for(var e=[],i=0;i<this._config.length;i++){var n=this._config[i];e.push(cc.p(n.x,n.y))}return t.initWithDuration(this._duration,e),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.getPositionX();t=t.getPositionY(),this._previousPosition.x=e,this._previousPosition.y=t,this._startPosition.x=e,this._startPosition.y=t},update:function(t){if(t=this._computeEaseTime(t),this.target){var e=this._config,i=e[0].y,n=e[1].y,r=e[2].y,e=cc.bezierAt(0,e[0].x,e[1].x,e[2].x,t);if(t=cc.bezierAt(0,i,n,r,t),i=this._startPosition,cc.ENABLE_STACKABLE_ACTIONS){var n=this.target.getPositionX(),r=this.target.getPositionY(),o=this._previousPosition;i.x=i.x+n-o.x,i.y=i.y+r-o.y,e+=i.x,t+=i.y,o.x=e,o.y=t,this.target.setPosition(e,t)}else this.target.setPosition(i.x+e,i.y+t)}},reverse:function(){var t=this._config,t=[cc.pAdd(t[1],cc.pNeg(t[2])),cc.pAdd(t[0],cc.pNeg(t[2])),cc.pNeg(t[2])],t=new cc.BezierBy(this._duration,t);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.bezierBy=function(t,e){return new cc.BezierBy(t,e)},cc.BezierBy.create=cc.bezierBy,cc.BezierTo=cc.BezierBy.extend({_toConfig:null,ctor:function(t,e){cc.BezierBy.prototype.ctor.call(this),this._toConfig=[],e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return cc.ActionInterval.prototype.initWithDuration.call(this,t)?(this._toConfig=e,!0):!1},clone:function(){var t=new cc.BezierTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toConfig),t},startWithTarget:function(t){cc.BezierBy.prototype.startWithTarget.call(this,t),t=this._startPosition;var e=this._toConfig,i=this._config;i[0]=cc.pSub(e[0],t),i[1]=cc.pSub(e[1],t),i[2]=cc.pSub(e[2],t)}}),cc.bezierTo=function(t,e){return new cc.BezierTo(t,e)},cc.BezierTo.create=cc.bezierTo,cc.ScaleTo=cc.ActionInterval.extend({_scaleX:1,_scaleY:1,_startScaleX:1,_startScaleY:1,_endScaleX:0,_endScaleY:0,_deltaX:0,_deltaY:0,ctor:function(t,e,i){cc.ActionInterval.prototype.ctor.call(this),void 0!==e&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){return cc.ActionInterval.prototype.initWithDuration.call(this,t)?(this._endScaleX=e,this._endScaleY=null!=i?i:e,!0):!1},clone:function(){var t=new cc.ScaleTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endScaleX,this._endScaleY),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._startScaleX=t.scaleX,this._startScaleY=t.scaleY,this._deltaX=this._endScaleX-this._startScaleX,this._deltaY=this._endScaleY-this._startScaleY},update:function(t){t=this._computeEaseTime(t),this.target&&(this.target.scaleX=this._startScaleX+this._deltaX*t,this.target.scaleY=this._startScaleY+this._deltaY*t)}}),cc.scaleTo=function(t,e,i){return new cc.ScaleTo(t,e,i)},cc.ScaleTo.create=cc.scaleTo,cc.ScaleBy=cc.ScaleTo.extend({startWithTarget:function(t){cc.ScaleTo.prototype.startWithTarget.call(this,t),this._deltaX=this._startScaleX*this._endScaleX-this._startScaleX,this._deltaY=this._startScaleY*this._endScaleY-this._startScaleY},reverse:function(){var t=new cc.ScaleBy(this._duration,1/this._endScaleX,1/this._endScaleY);return this._cloneDecoration(t),this._reverseEaseList(t),t},clone:function(){var t=new cc.ScaleBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endScaleX,this._endScaleY),t}}),cc.scaleBy=function(t,e,i){return new cc.ScaleBy(t,e,i)},cc.ScaleBy.create=cc.scaleBy,cc.Blink=cc.ActionInterval.extend({_times:0,_originalState:!1,ctor:function(t,e){cc.ActionInterval.prototype.ctor.call(this),void 0!==e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return cc.ActionInterval.prototype.initWithDuration.call(this,t)?(this._times=e,!0):!1},clone:function(){var t=new cc.Blink;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._times),t},update:function(t){if(t=this._computeEaseTime(t),this.target&&!this.isDone()){var e=1/this._times;this.target.visible=t%e>e/2}},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._originalState=t.visible},stop:function(){this.target.visible=this._originalState,cc.ActionInterval.prototype.stop.call(this)},reverse:function(){var t=new cc.Blink(this._duration,this._times);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.blink=function(t,e){return new cc.Blink(t,e)},cc.Blink.create=cc.blink,cc.FadeTo=cc.ActionInterval.extend({_toOpacity:0,_fromOpacity:0,ctor:function(t,e){cc.ActionInterval.prototype.ctor.call(this),void 0!==e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return cc.ActionInterval.prototype.initWithDuration.call(this,t)?(this._toOpacity=e,!0):!1},clone:function(){var t=new cc.FadeTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toOpacity),t},update:function(t){t=this._computeEaseTime(t);var e=void 0!==this._fromOpacity?this._fromOpacity:255;this.target.opacity=e+(this._toOpacity-e)*t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._fromOpacity=t.opacity}}),cc.fadeTo=function(t,e){return new cc.FadeTo(t,e)},cc.FadeTo.create=cc.fadeTo,cc.FadeIn=cc.FadeTo.extend({_reverseAction:null,ctor:function(t){cc.FadeTo.prototype.ctor.call(this),null==t&&(t=0),this.initWithDuration(t,255)},reverse:function(){var t=new cc.FadeOut;return t.initWithDuration(this._duration,0),this._cloneDecoration(t),this._reverseEaseList(t),t},clone:function(){var t=new cc.FadeIn;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toOpacity),t},startWithTarget:function(t){this._reverseAction&&(this._toOpacity=this._reverseAction._fromOpacity),cc.FadeTo.prototype.startWithTarget.call(this,t)}}),cc.fadeIn=function(t){return new cc.FadeIn(t)},cc.FadeIn.create=cc.fadeIn,cc.FadeOut=cc.FadeTo.extend({ctor:function(t){cc.FadeTo.prototype.ctor.call(this),null==t&&(t=0),this.initWithDuration(t,0)},reverse:function(){var t=new cc.FadeIn;return t._reverseAction=this,t.initWithDuration(this._duration,255),this._cloneDecoration(t),this._reverseEaseList(t),t},clone:function(){var t=new cc.FadeOut;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toOpacity),t}}),cc.fadeOut=function(t){return new cc.FadeOut(t)},cc.FadeOut.create=cc.fadeOut,cc.TintTo=cc.ActionInterval.extend({_to:null,_from:null,ctor:function(t,e,i,n){cc.ActionInterval.prototype.ctor.call(this),this._to=cc.color(0,0,0),this._from=cc.color(0,0,0),void 0!==n&&this.initWithDuration(t,e,i,n)},initWithDuration:function(t,e,i,n){return cc.ActionInterval.prototype.initWithDuration.call(this,t)?(this._to=cc.color(e,i,n),!0):!1},clone:function(){var t=new cc.TintTo;this._cloneDecoration(t);var e=this._to;return t.initWithDuration(this._duration,e.r,e.g,e.b),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._from=this.target.color},update:function(t){t=this._computeEaseTime(t);var e=this._from,i=this._to;e&&this.target.setColor(cc.color(e.r+(i.r-e.r)*t,e.g+(i.g-e.g)*t,e.b+(i.b-e.b)*t))}}),cc.tintTo=function(t,e,i,n){return new cc.TintTo(t,e,i,n)},cc.TintTo.create=cc.tintTo,cc.TintBy=cc.ActionInterval.extend({_deltaR:0,_deltaG:0,_deltaB:0,_fromR:0,_fromG:0,_fromB:0,ctor:function(t,e,i,n){cc.ActionInterval.prototype.ctor.call(this),void 0!==n&&this.initWithDuration(t,e,i,n)},initWithDuration:function(t,e,i,n){return cc.ActionInterval.prototype.initWithDuration.call(this,t)?(this._deltaR=e,this._deltaG=i,this._deltaB=n,!0):!1},clone:function(){var t=new cc.TintBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._deltaR,this._deltaG,this._deltaB),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),t=t.color,this._fromR=t.r,this._fromG=t.g,this._fromB=t.b},update:function(t){t=this._computeEaseTime(t),this.target.color=cc.color(this._fromR+this._deltaR*t,this._fromG+this._deltaG*t,this._fromB+this._deltaB*t)},reverse:function(){var t=new cc.TintBy(this._duration,-this._deltaR,-this._deltaG,-this._deltaB);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.tintBy=function(t,e,i,n){return new cc.TintBy(t,e,i,n)},cc.TintBy.create=cc.tintBy,cc.DelayTime=cc.ActionInterval.extend({update:function(){},reverse:function(){var t=new cc.DelayTime(this._duration);return this._cloneDecoration(t),this._reverseEaseList(t),t},clone:function(){var t=new cc.DelayTime;return this._cloneDecoration(t),t.initWithDuration(this._duration),t}}),cc.delayTime=function(t){return new cc.DelayTime(t)},cc.DelayTime.create=cc.delayTime,cc.ReverseTime=cc.ActionInterval.extend({_other:null,ctor:function(t){cc.ActionInterval.prototype.ctor.call(this),this._other=null,t&&this.initWithAction(t)},initWithAction:function(t){if(!t)throw"cc.ReverseTime.initWithAction(): action must be non null";if(t===this._other)throw"cc.ReverseTime.initWithAction(): the action was already passed in.";return cc.ActionInterval.prototype.initWithDuration.call(this,t._duration)?(this._other=t,!0):!1},clone:function(){var t=new cc.ReverseTime;return this._cloneDecoration(t),t.initWithAction(this._other.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._other.startWithTarget(t)},update:function(t){t=this._computeEaseTime(t),this._other&&this._other.update(1-t)},reverse:function(){return this._other.clone()},stop:function(){this._other.stop(),cc.Action.prototype.stop.call(this)}}),cc.reverseTime=function(t){return new cc.ReverseTime(t)},cc.ReverseTime.create=cc.reverseTime,cc.Animate=cc.ActionInterval.extend({_animation:null,_nextFrame:0,_origFrame:null,_executedLoops:0,_splitTimes:null,ctor:function(t){cc.ActionInterval.prototype.ctor.call(this),this._splitTimes=[],t&&this.initWithAnimation(t)},getAnimation:function(){return this._animation},setAnimation:function(t){this._animation=t},initWithAnimation:function(t){if(!t)throw"cc.Animate.initWithAnimation(): animation must be non-NULL";var e=t.getDuration();if(this.initWithDuration(e*t.getLoops())){this._nextFrame=0,this.setAnimation(t),this._origFrame=null,this._executedLoops=0;var i=this._splitTimes,n=i.length=0,r=e/t.getTotalDelayUnits();t=t.getFrames(),cc.arrayVerifyType(t,cc.AnimationFrame);for(var o=0;o<t.length;o++){var s=n*r/e,n=n+t[o].getDelayUnits();i.push(s)}return!0}return!1},clone:function(){var t=new cc.Animate;return this._cloneDecoration(t),t.initWithAnimation(this._animation.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._animation.getRestoreOriginalFrame()&&(this._origFrame=t.displayFrame()),this._executedLoops=this._nextFrame=0},update:function(t){t=this._computeEaseTime(t),1>t&&(t*=this._animation.getLoops(),(0|t)>this._executedLoops&&(this._nextFrame=0,this._executedLoops++),t%=1);for(var e=this._animation.getFrames(),i=e.length,n=this._splitTimes,r=this._nextFrame;i>r&&n[r]<=t;r++)this.target.setSpriteFrame(e[r].getSpriteFrame()),this._nextFrame=r+1},reverse:function(){var t=this._animation,e=t.getFrames(),i=[];if(cc.arrayVerifyType(e,cc.AnimationFrame),0<e.length)for(var n=e.length-1;n>=0;n--){var r=e[n];if(!r)break;i.push(r.clone())}return e=new cc.Animation(i,t.getDelayPerUnit(),t.getLoops()),e.setRestoreOriginalFrame(t.getRestoreOriginalFrame()),t=new cc.Animate(e),this._cloneDecoration(t),this._reverseEaseList(t),t},stop:function(){this._animation.getRestoreOriginalFrame()&&this.target&&this.target.setSpriteFrame(this._origFrame),cc.Action.prototype.stop.call(this)}}),cc.animate=function(t){return new cc.Animate(t)},cc.Animate.create=cc.animate,cc.TargetedAction=cc.ActionInterval.extend({_action:null,_forcedTarget:null,ctor:function(t,e){cc.ActionInterval.prototype.ctor.call(this),e&&this.initWithTarget(t,e)},initWithTarget:function(t,e){return this.initWithDuration(e._duration)?(this._forcedTarget=t,this._action=e,!0):!1},clone:function(){var t=new cc.TargetedAction;return this._cloneDecoration(t),t.initWithTarget(this._forcedTarget,this._action.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._action.startWithTarget(this._forcedTarget)},stop:function(){this._action.stop()},update:function(t){t=this._computeEaseTime(t),this._action.update(t)},getForcedTarget:function(){return this._forcedTarget},setForcedTarget:function(t){this._forcedTarget!==t&&(this._forcedTarget=t)}}),cc.targetedAction=function(t,e){return new cc.TargetedAction(t,e)},cc.TargetedAction.create=cc.targetedAction,cc.ActionInstant=cc.FiniteTimeAction.extend({isDone:function(){return!0},step:function(){this.update(1)},update:function(){},reverse:function(){return this.clone()},clone:function(){return new cc.ActionInstant}}),cc.Show=cc.ActionInstant.extend({update:function(){this.target.visible=!0},reverse:function(){return new cc.Hide},clone:function(){return new cc.Show
}}),cc.show=function(){return new cc.Show},cc.Show.create=cc.show,cc.Hide=cc.ActionInstant.extend({update:function(){this.target.visible=!1},reverse:function(){return new cc.Show},clone:function(){return new cc.Hide}}),cc.hide=function(){return new cc.Hide},cc.Hide.create=cc.hide,cc.ToggleVisibility=cc.ActionInstant.extend({update:function(){this.target.visible=!this.target.visible},reverse:function(){return new cc.ToggleVisibility},clone:function(){return new cc.ToggleVisibility}}),cc.toggleVisibility=function(){return new cc.ToggleVisibility},cc.ToggleVisibility.create=cc.toggleVisibility,cc.RemoveSelf=cc.ActionInstant.extend({_isNeedCleanUp:!0,ctor:function(t){cc.FiniteTimeAction.prototype.ctor.call(this),void 0!==t&&this.init(t)},update:function(){this.target.removeFromParent(this._isNeedCleanUp)},init:function(t){return this._isNeedCleanUp=t,!0},reverse:function(){return new cc.RemoveSelf(this._isNeedCleanUp)},clone:function(){return new cc.RemoveSelf(this._isNeedCleanUp)}}),cc.removeSelf=function(t){return new cc.RemoveSelf(t)},cc.RemoveSelf.create=cc.removeSelf,cc.FlipX=cc.ActionInstant.extend({_flippedX:!1,ctor:function(t){cc.FiniteTimeAction.prototype.ctor.call(this),this._flippedX=!1,void 0!==t&&this.initWithFlipX(t)},initWithFlipX:function(t){return this._flippedX=t,!0},update:function(){this.target.flippedX=this._flippedX},reverse:function(){return new cc.FlipX(!this._flippedX)},clone:function(){var t=new cc.FlipX;return t.initWithFlipX(this._flippedX),t}}),cc.flipX=function(t){return new cc.FlipX(t)},cc.FlipX.create=cc.flipX,cc.FlipY=cc.ActionInstant.extend({_flippedY:!1,ctor:function(t){cc.FiniteTimeAction.prototype.ctor.call(this),this._flippedY=!1,void 0!==t&&this.initWithFlipY(t)},initWithFlipY:function(t){return this._flippedY=t,!0},update:function(){this.target.flippedY=this._flippedY},reverse:function(){return new cc.FlipY(!this._flippedY)},clone:function(){var t=new cc.FlipY;return t.initWithFlipY(this._flippedY),t}}),cc.flipY=function(t){return new cc.FlipY(t)},cc.FlipY.create=cc.flipY,cc.Place=cc.ActionInstant.extend({_x:0,_y:0,ctor:function(t,e){cc.FiniteTimeAction.prototype.ctor.call(this),this._y=this._x=0,void 0!==t&&(void 0!==t.x&&(e=t.y,t=t.x),this.initWithPosition(t,e))},initWithPosition:function(t,e){return this._x=t,this._y=e,!0},update:function(){this.target.setPosition(this._x,this._y)},clone:function(){var t=new cc.Place;return t.initWithPosition(this._x,this._y),t}}),cc.place=function(t,e){return new cc.Place(t,e)},cc.Place.create=cc.place,cc.CallFunc=cc.ActionInstant.extend({_selectorTarget:null,_callFunc:null,_function:null,_data:null,ctor:function(t,e,i){cc.FiniteTimeAction.prototype.ctor.call(this),void 0!==t&&(void 0===e?this.initWithFunction(t):this.initWithFunction(t,e,i))},initWithFunction:function(t,e,i){return e?(this._data=i,this._callFunc=t,this._selectorTarget=e):t&&(this._function=t),!0},execute:function(){null!=this._callFunc?this._callFunc.call(this._selectorTarget,this.target,this._data):this._function&&this._function.call(null,this.target)},update:function(){this.execute()},getTargetCallback:function(){return this._selectorTarget},setTargetCallback:function(t){t!==this._selectorTarget&&(this._selectorTarget&&(this._selectorTarget=null),this._selectorTarget=t)},clone:function(){var t=new cc.CallFunc;return this._selectorTarget?t.initWithFunction(this._callFunc,this._selectorTarget,this._data):this._function&&t.initWithFunction(this._function),t}}),cc.callFunc=function(t,e,i){return new cc.CallFunc(t,e,i)},cc.CallFunc.create=cc.callFunc,cc.ActionCamera=cc.ActionInterval.extend({_centerXOrig:0,_centerYOrig:0,_centerZOrig:0,_eyeXOrig:0,_eyeYOrig:0,_eyeZOrig:0,_upXOrig:0,_upYOrig:0,_upZOrig:0,ctor:function(){cc.ActionInterval.prototype.ctor.call(this),this._upZOrig=this._upYOrig=this._upXOrig=this._eyeZOrig=this._eyeYOrig=this._eyeXOrig=this._centerZOrig=this._centerYOrig=this._centerXOrig=0},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),t=t.getCamera();var e=t.getCenter();this._centerXOrig=e.x,this._centerYOrig=e.y,this._centerZOrig=e.z,e=t.getEye(),this._eyeXOrig=e.x,this._eyeYOrig=e.y,this._eyeZOrig=e.z,t=t.getUp(),this._upXOrig=t.x,this._upYOrig=t.y,this._upZOrig=t.z},clone:function(){return new cc.ActionCamera},reverse:function(){return new cc.ReverseTime(this)}}),cc.OrbitCamera=cc.ActionCamera.extend({_radius:0,_deltaRadius:0,_angleZ:0,_deltaAngleZ:0,_angleX:0,_deltaAngleX:0,_radZ:0,_radDeltaZ:0,_radX:0,_radDeltaX:0,ctor:function(t,e,i,n,r,o,s){cc.ActionCamera.prototype.ctor.call(this),void 0!==s&&this.initWithDuration(t,e,i,n,r,o,s)},initWithDuration:function(t,e,i,n,r,o,s){return cc.ActionInterval.prototype.initWithDuration.call(this,t)?(this._radius=e,this._deltaRadius=i,this._angleZ=n,this._deltaAngleZ=r,this._angleX=o,this._deltaAngleX=s,this._radDeltaZ=cc.degreesToRadians(r),this._radDeltaX=cc.degreesToRadians(s),!0):!1},sphericalRadius:function(){var t,e;e=this.target.getCamera();var i=e.getEye();t=e.getCenter(),e=i.x-t.x;var n=i.y-t.y;t=i.z-t.z;var i=Math.sqrt(Math.pow(e,2)+Math.pow(n,2)+Math.pow(t,2)),r=Math.sqrt(Math.pow(e,2)+Math.pow(n,2));return 0===r&&(r=cc.FLT_EPSILON),0===i&&(i=cc.FLT_EPSILON),t=Math.acos(t/i),e=0>e?Math.PI-Math.asin(n/r):Math.asin(n/r),{newRadius:i/cc.Camera.getZEye(),zenith:t,azimuth:e}},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),t=this.sphericalRadius(),isNaN(this._radius)&&(this._radius=t.newRadius),isNaN(this._angleZ)&&(this._angleZ=cc.radiansToDegrees(t.zenith)),isNaN(this._angleX)&&(this._angleX=cc.radiansToDegrees(t.azimuth)),this._radZ=cc.degreesToRadians(this._angleZ),this._radX=cc.degreesToRadians(this._angleX)},clone:function(){var t=new cc.OrbitCamera;return t.initWithDuration(this._duration,this._radius,this._deltaRadius,this._angleZ,this._deltaAngleZ,this._angleX,this._deltaAngleX),t},update:function(t){t=this._computeEaseTime(t);var e=(this._radius+this._deltaRadius*t)*cc.Camera.getZEye(),i=this._radZ+this._radDeltaZ*t,n=this._radX+this._radDeltaX*t;t=Math.sin(i)*Math.cos(n)*e+this._centerXOrig,n=Math.sin(i)*Math.sin(n)*e+this._centerYOrig,e=Math.cos(i)*e+this._centerZOrig,this.target.getCamera().setEye(t,n,e),this.target.setNodeDirty()}}),cc.orbitCamera=function(t,e,i,n,r,o,s){return new cc.OrbitCamera(t,e,i,n,r,o,s)},cc.OrbitCamera.create=cc.orbitCamera,cc.ActionEase=cc.ActionInterval.extend({_inner:null,ctor:function(t){cc.ActionInterval.prototype.ctor.call(this),t&&this.initWithAction(t)},initWithAction:function(t){if(!t)throw"cc.ActionEase.initWithAction(): action must be non nil";return this.initWithDuration(t.getDuration())?(this._inner=t,!0):!1},clone:function(){var t=new cc.ActionEase;return t.initWithAction(this._inner.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._inner.startWithTarget(this.target)},stop:function(){this._inner.stop(),cc.ActionInterval.prototype.stop.call(this)},update:function(t){this._inner.update(t)},reverse:function(){return new cc.ActionEase(this._inner.reverse())},getInnerAction:function(){return this._inner}}),cc.actionEase=function(t){return new cc.ActionEase(t)},cc.ActionEase.create=cc.actionEase,cc.EaseRateAction=cc.ActionEase.extend({_rate:0,ctor:function(t,e){cc.ActionEase.prototype.ctor.call(this),void 0!==e&&this.initWithAction(t,e)},setRate:function(t){this._rate=t},getRate:function(){return this._rate},initWithAction:function(t,e){return cc.ActionEase.prototype.initWithAction.call(this,t)?(this._rate=e,!0):!1},clone:function(){var t=new cc.EaseRateAction;return t.initWithAction(this._inner.clone(),this._rate),t},reverse:function(){return new cc.EaseRateAction(this._inner.reverse(),1/this._rate)}}),cc.easeRateAction=function(t,e){return new cc.EaseRateAction(t,e)},cc.EaseRateAction.create=cc.easeRateAction,cc.EaseIn=cc.EaseRateAction.extend({update:function(t){this._inner.update(Math.pow(t,this._rate))},reverse:function(){return new cc.EaseIn(this._inner.reverse(),1/this._rate)},clone:function(){var t=new cc.EaseIn;return t.initWithAction(this._inner.clone(),this._rate),t}}),cc.EaseIn.create=function(t,e){return new cc.EaseIn(t,e)},cc.easeIn=function(t){return{_rate:t,easing:function(t){return Math.pow(t,this._rate)},reverse:function(){return cc.easeIn(1/this._rate)}}},cc.EaseOut=cc.EaseRateAction.extend({update:function(t){this._inner.update(Math.pow(t,1/this._rate))},reverse:function(){return new cc.EaseOut(this._inner.reverse(),1/this._rate)},clone:function(){var t=new cc.EaseOut;return t.initWithAction(this._inner.clone(),this._rate),t}}),cc.EaseOut.create=function(t,e){return new cc.EaseOut(t,e)},cc.easeOut=function(t){return{_rate:t,easing:function(t){return Math.pow(t,1/this._rate)},reverse:function(){return cc.easeOut(1/this._rate)}}},cc.EaseInOut=cc.EaseRateAction.extend({update:function(t){t*=2,this._inner.update(1>t?.5*Math.pow(t,this._rate):1-.5*Math.pow(2-t,this._rate))},clone:function(){var t=new cc.EaseInOut;return t.initWithAction(this._inner.clone(),this._rate),t},reverse:function(){return new cc.EaseInOut(this._inner.reverse(),this._rate)}}),cc.EaseInOut.create=function(t,e){return new cc.EaseInOut(t,e)},cc.easeInOut=function(t){return{_rate:t,easing:function(t){return t*=2,1>t?.5*Math.pow(t,this._rate):1-.5*Math.pow(2-t,this._rate)},reverse:function(){return cc.easeInOut(this._rate)}}},cc.EaseExponentialIn=cc.ActionEase.extend({update:function(t){this._inner.update(0===t?0:Math.pow(2,10*(t-1)))},reverse:function(){return new cc.EaseExponentialOut(this._inner.reverse())},clone:function(){var t=new cc.EaseExponentialIn;return t.initWithAction(this._inner.clone()),t}}),cc.EaseExponentialIn.create=function(t){return new cc.EaseExponentialIn(t)},cc._easeExponentialInObj={easing:function(t){return 0===t?0:Math.pow(2,10*(t-1))},reverse:function(){return cc._easeExponentialOutObj}},cc.easeExponentialIn=function(){return cc._easeExponentialInObj},cc.EaseExponentialOut=cc.ActionEase.extend({update:function(t){this._inner.update(1===t?1:-Math.pow(2,-10*t)+1)},reverse:function(){return new cc.EaseExponentialIn(this._inner.reverse())},clone:function(){var t=new cc.EaseExponentialOut;return t.initWithAction(this._inner.clone()),t}}),cc.EaseExponentialOut.create=function(t){return new cc.EaseExponentialOut(t)},cc._easeExponentialOutObj={easing:function(t){return 1===t?1:-Math.pow(2,-10*t)+1},reverse:function(){return cc._easeExponentialInObj}},cc.easeExponentialOut=function(){return cc._easeExponentialOutObj},cc.EaseExponentialInOut=cc.ActionEase.extend({update:function(t){1!==t&&0!==t&&(t*=2,t=1>t?.5*Math.pow(2,10*(t-1)):.5*(-Math.pow(2,-10*(t-1))+2)),this._inner.update(t)},reverse:function(){return new cc.EaseExponentialInOut(this._inner.reverse())},clone:function(){var t=new cc.EaseExponentialInOut;return t.initWithAction(this._inner.clone()),t}}),cc.EaseExponentialInOut.create=function(t){return new cc.EaseExponentialInOut(t)},cc._easeExponentialInOutObj={easing:function(t){return 1!==t&&0!==t?(t*=2,1>t?.5*Math.pow(2,10*(t-1)):.5*(-Math.pow(2,-10*(t-1))+2)):t},reverse:function(){return cc._easeExponentialInOutObj}},cc.easeExponentialInOut=function(){return cc._easeExponentialInOutObj},cc.EaseSineIn=cc.ActionEase.extend({update:function(t){t=0===t||1===t?t:-1*Math.cos(t*Math.PI/2)+1,this._inner.update(t)},reverse:function(){return new cc.EaseSineOut(this._inner.reverse())},clone:function(){var t=new cc.EaseSineIn;return t.initWithAction(this._inner.clone()),t}}),cc.EaseSineIn.create=function(t){return new cc.EaseSineIn(t)},cc._easeSineInObj={easing:function(t){return 0===t||1===t?t:-1*Math.cos(t*Math.PI/2)+1},reverse:function(){return cc._easeSineOutObj}},cc.easeSineIn=function(){return cc._easeSineInObj},cc.EaseSineOut=cc.ActionEase.extend({update:function(t){t=0===t||1===t?t:Math.sin(t*Math.PI/2),this._inner.update(t)},reverse:function(){return new cc.EaseSineIn(this._inner.reverse())},clone:function(){var t=new cc.EaseSineOut;return t.initWithAction(this._inner.clone()),t}}),cc.EaseSineOut.create=function(t){return new cc.EaseSineOut(t)},cc._easeSineOutObj={easing:function(t){return 0===t||1===t?t:Math.sin(t*Math.PI/2)},reverse:function(){return cc._easeSineInObj}},cc.easeSineOut=function(){return cc._easeSineOutObj},cc.EaseSineInOut=cc.ActionEase.extend({update:function(t){t=0===t||1===t?t:-.5*(Math.cos(Math.PI*t)-1),this._inner.update(t)},clone:function(){var t=new cc.EaseSineInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseSineInOut(this._inner.reverse())}}),cc.EaseSineInOut.create=function(t){return new cc.EaseSineInOut(t)},cc._easeSineInOutObj={easing:function(t){return 0===t||1===t?t:-.5*(Math.cos(Math.PI*t)-1)},reverse:function(){return cc._easeSineInOutObj}},cc.easeSineInOut=function(){return cc._easeSineInOutObj},cc.EaseElastic=cc.ActionEase.extend({_period:.3,ctor:function(t,e){cc.ActionEase.prototype.ctor.call(this),t&&this.initWithAction(t,e)},getPeriod:function(){return this._period},setPeriod:function(t){this._period=t},initWithAction:function(t,e){return cc.ActionEase.prototype.initWithAction.call(this,t),this._period=null==e?.3:e,!0},reverse:function(){return cc.log("cc.EaseElastic.reverse(): it should be overridden in subclass."),null},clone:function(){var t=new cc.EaseElastic;return t.initWithAction(this._inner.clone(),this._period),t}}),cc.EaseElastic.create=function(t,e){return new cc.EaseElastic(t,e)},cc.EaseElasticIn=cc.EaseElastic.extend({update:function(t){var e=0;0===t||1===t?e=t:(e=this._period/4,t-=1,e=-Math.pow(2,10*t)*Math.sin((t-e)*Math.PI*2/this._period)),this._inner.update(e)},reverse:function(){return new cc.EaseElasticOut(this._inner.reverse(),this._period)},clone:function(){var t=new cc.EaseElasticIn;return t.initWithAction(this._inner.clone(),this._period),t}}),cc.EaseElasticIn.create=function(t,e){return new cc.EaseElasticIn(t,e)},cc._easeElasticInObj={easing:function(t){return 0===t||1===t?t:(t-=1,-Math.pow(2,10*t)*Math.sin((t-.075)*Math.PI*2/.3))},reverse:function(){return cc._easeElasticOutObj}},cc.easeElasticIn=function(t){return t&&.3!==t?{_period:t,easing:function(t){return 0===t||1===t?t:(t-=1,-Math.pow(2,10*t)*Math.sin((t-this._period/4)*Math.PI*2/this._period))},reverse:function(){return cc.easeElasticOut(this._period)}}:cc._easeElasticInObj},cc.EaseElasticOut=cc.EaseElastic.extend({update:function(t){var e=0;0===t||1===t?e=t:(e=this._period/4,e=Math.pow(2,-10*t)*Math.sin((t-e)*Math.PI*2/this._period)+1),this._inner.update(e)},reverse:function(){return new cc.EaseElasticIn(this._inner.reverse(),this._period)},clone:function(){var t=new cc.EaseElasticOut;return t.initWithAction(this._inner.clone(),this._period),t}}),cc.EaseElasticOut.create=function(t,e){return new cc.EaseElasticOut(t,e)},cc._easeElasticOutObj={easing:function(t){return 0===t||1===t?t:Math.pow(2,-10*t)*Math.sin((t-.075)*Math.PI*2/.3)+1},reverse:function(){return cc._easeElasticInObj}},cc.easeElasticOut=function(t){return t&&.3!==t?{_period:t,easing:function(t){return 0===t||1===t?t:Math.pow(2,-10*t)*Math.sin((t-this._period/4)*Math.PI*2/this._period)+1},reverse:function(){return cc.easeElasticIn(this._period)}}:cc._easeElasticOutObj},cc.EaseElasticInOut=cc.EaseElastic.extend({update:function(t){var e=0,e=this._period;if(0===t||1===t)e=t;else{e||(e=this._period=.3*1.5);var i=e/4;t=2*t-1,e=0>t?-.5*Math.pow(2,10*t)*Math.sin((t-i)*Math.PI*2/e):Math.pow(2,-10*t)*Math.sin((t-i)*Math.PI*2/e)*.5+1}this._inner.update(e)},reverse:function(){return new cc.EaseElasticInOut(this._inner.reverse(),this._period)},clone:function(){var t=new cc.EaseElasticInOut;return t.initWithAction(this._inner.clone(),this._period),t}}),cc.EaseElasticInOut.create=function(t,e){return new cc.EaseElasticInOut(t,e)},cc.easeElasticInOut=function(t){return{_period:t||.3,easing:function(t){var e=0,e=this._period;if(0===t||1===t)e=t;else{e||(e=this._period=.3*1.5);var i=e/4;t=2*t-1,e=0>t?-.5*Math.pow(2,10*t)*Math.sin((t-i)*Math.PI*2/e):Math.pow(2,-10*t)*Math.sin((t-i)*Math.PI*2/e)*.5+1}return e},reverse:function(){return cc.easeElasticInOut(this._period)}}},cc.EaseBounce=cc.ActionEase.extend({bounceTime:function(t){return 1/2.75>t?7.5625*t*t:2/2.75>t?(t-=1.5/2.75,7.5625*t*t+.75):2.5/2.75>t?(t-=2.25/2.75,7.5625*t*t+.9375):(t-=2.625/2.75,7.5625*t*t+.984375)},clone:function(){var t=new cc.EaseBounce;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseBounce(this._inner.reverse())}}),cc.EaseBounce.create=function(t){return new cc.EaseBounce(t)},cc.EaseBounceIn=cc.EaseBounce.extend({update:function(t){t=1-this.bounceTime(1-t),this._inner.update(t)},reverse:function(){return new cc.EaseBounceOut(this._inner.reverse())},clone:function(){var t=new cc.EaseBounceIn;return t.initWithAction(this._inner.clone()),t}}),cc.EaseBounceIn.create=function(t){return new cc.EaseBounceIn(t)},cc._bounceTime=function(t){return 1/2.75>t?7.5625*t*t:2/2.75>t?(t-=1.5/2.75,7.5625*t*t+.75):2.5/2.75>t?(t-=2.25/2.75,7.5625*t*t+.9375):(t-=2.625/2.75,7.5625*t*t+.984375)},cc._easeBounceInObj={easing:function(t){return 1-cc._bounceTime(1-t)},reverse:function(){return cc._easeBounceOutObj}},cc.easeBounceIn=function(){return cc._easeBounceInObj},cc.EaseBounceOut=cc.EaseBounce.extend({update:function(t){t=this.bounceTime(t),this._inner.update(t)},reverse:function(){return new cc.EaseBounceIn(this._inner.reverse())},clone:function(){var t=new cc.EaseBounceOut;return t.initWithAction(this._inner.clone()),t}}),cc.EaseBounceOut.create=function(t){return new cc.EaseBounceOut(t)},cc._easeBounceOutObj={easing:function(t){return cc._bounceTime(t)},reverse:function(){return cc._easeBounceInObj}},cc.easeBounceOut=function(){return cc._easeBounceOutObj},cc.EaseBounceInOut=cc.EaseBounce.extend({update:function(t){var e=0,e=.5>t?.5*(1-this.bounceTime(1-2*t)):.5*this.bounceTime(2*t-1)+.5;this._inner.update(e)},clone:function(){var t=new cc.EaseBounceInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseBounceInOut(this._inner.reverse())}}),cc.EaseBounceInOut.create=function(t){return new cc.EaseBounceInOut(t)},cc._easeBounceInOutObj={easing:function(t){return t=.5>t?.5*(1-cc._bounceTime(1-2*t)):.5*cc._bounceTime(2*t-1)+.5},reverse:function(){return cc._easeBounceInOutObj}},cc.easeBounceInOut=function(){return cc._easeBounceInOutObj},cc.EaseBackIn=cc.ActionEase.extend({update:function(t){this._inner.update(0===t||1===t?t:t*t*(2.70158*t-1.70158))},reverse:function(){return new cc.EaseBackOut(this._inner.reverse())},clone:function(){var t=new cc.EaseBackIn;return t.initWithAction(this._inner.clone()),t}}),cc.EaseBackIn.create=function(t){return new cc.EaseBackIn(t)},cc._easeBackInObj={easing:function(t){return 0===t||1===t?t:t*t*(2.70158*t-1.70158)},reverse:function(){return cc._easeBackOutObj}},cc.easeBackIn=function(){return cc._easeBackInObj},cc.EaseBackOut=cc.ActionEase.extend({update:function(t){t-=1,this._inner.update(t*t*(2.70158*t+1.70158)+1)},reverse:function(){return new cc.EaseBackIn(this._inner.reverse())},clone:function(){var t=new cc.EaseBackOut;return t.initWithAction(this._inner.clone()),t}}),cc.EaseBackOut.create=function(t){return new cc.EaseBackOut(t)},cc._easeBackOutObj={easing:function(t){return t-=1,t*t*(2.70158*t+1.70158)+1},reverse:function(){return cc._easeBackInObj}},cc.easeBackOut=function(){return cc._easeBackOutObj},cc.EaseBackInOut=cc.ActionEase.extend({update:function(t){t*=2,1>t?this._inner.update(t*t*(3.5949095*t-2.5949095)/2):(t-=2,this._inner.update(t*t*(3.5949095*t+2.5949095)/2+1))},clone:function(){var t=new cc.EaseBackInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseBackInOut(this._inner.reverse())}}),cc.EaseBackInOut.create=function(t){return new cc.EaseBackInOut(t)},cc._easeBackInOutObj={easing:function(t){return t*=2,1>t?t*t*(3.5949095*t-2.5949095)/2:(t-=2,t*t*(3.5949095*t+2.5949095)/2+1)},reverse:function(){return cc._easeBackInOutObj}},cc.easeBackInOut=function(){return cc._easeBackInOutObj},cc.EaseBezierAction=cc.ActionEase.extend({_p0:null,_p1:null,_p2:null,_p3:null,ctor:function(t){cc.ActionEase.prototype.ctor.call(this,t)},_updateTime:function(t,e,i,n,r){return Math.pow(1-r,3)*t+3*r*Math.pow(1-r,2)*e+3*Math.pow(r,2)*(1-r)*i+Math.pow(r,3)*n},update:function(t){t=this._updateTime(this._p0,this._p1,this._p2,this._p3,t),this._inner.update(t)},clone:function(){var t=new cc.EaseBezierAction;return t.initWithAction(this._inner.clone()),t.setBezierParamer(this._p0,this._p1,this._p2,this._p3),t},reverse:function(){var t=new cc.EaseBezierAction(this._inner.reverse());return t.setBezierParamer(this._p3,this._p2,this._p1,this._p0),t},setBezierParamer:function(t,e,i,n){this._p0=t||0,this._p1=e||0,this._p2=i||0,this._p3=n||0}}),cc.EaseBezierAction.create=function(t){return new cc.EaseBezierAction(t)},cc.easeBezierAction=function(t,e,i,n){return{easing:function(r){return cc.EaseBezierAction.prototype._updateTime(t,e,i,n,r)},reverse:function(){return cc.easeBezierAction(n,i,e,t)}}},cc.EaseQuadraticActionIn=cc.ActionEase.extend({_updateTime:function(t){return Math.pow(t,2)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuadraticActionIn;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuadraticActionIn(this._inner.reverse())}}),cc.EaseQuadraticActionIn.create=function(t){return new cc.EaseQuadraticActionIn(t)},cc._easeQuadraticActionIn={easing:cc.EaseQuadraticActionIn.prototype._updateTime,reverse:function(){return cc._easeQuadraticActionIn}},cc.easeQuadraticActionIn=function(){return cc._easeQuadraticActionIn},cc.EaseQuadraticActionOut=cc.ActionEase.extend({_updateTime:function(t){return-t*(t-2)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuadraticActionOut;return t.initWithAction(),t},reverse:function(){return new cc.EaseQuadraticActionOut(this._inner.reverse())}}),cc.EaseQuadraticActionOut.create=function(t){return new cc.EaseQuadraticActionOut(t)},cc._easeQuadraticActionOut={easing:cc.EaseQuadraticActionOut.prototype._updateTime,reverse:function(){return cc._easeQuadraticActionOut}},cc.easeQuadraticActionOut=function(){return cc._easeQuadraticActionOut},cc.EaseQuadraticActionInOut=cc.ActionEase.extend({_updateTime:function(t){var e=t;return t*=2,1>t?e=t*t*.5:(--t,e=-.5*(t*(t-2)-1)),e},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuadraticActionInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuadraticActionInOut(this._inner.reverse())}}),cc.EaseQuadraticActionInOut.create=function(t){return new cc.EaseQuadraticActionInOut(t)},cc._easeQuadraticActionInOut={easing:cc.EaseQuadraticActionInOut.prototype._updateTime,reverse:function(){return cc._easeQuadraticActionInOut}},cc.easeQuadraticActionInOut=function(){return cc._easeQuadraticActionInOut},cc.EaseQuarticActionIn=cc.ActionEase.extend({_updateTime:function(t){return t*t*t*t},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuarticActionIn;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuarticActionIn(this._inner.reverse())}}),cc.EaseQuarticActionIn.create=function(t){return new cc.EaseQuarticActionIn(t)},cc._easeQuarticActionIn={easing:cc.EaseQuarticActionIn.prototype._updateTime,reverse:function(){return cc._easeQuarticActionIn}},cc.easeQuarticActionIn=function(){return cc._easeQuarticActionIn},cc.EaseQuarticActionOut=cc.ActionEase.extend({_updateTime:function(t){return t-=1,-(t*t*t*t-1)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuarticActionOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuarticActionOut(this._inner.reverse())}}),cc.EaseQuarticActionOut.create=function(t){return new cc.EaseQuarticActionOut(t)},cc._easeQuarticActionOut={easing:cc.EaseQuarticActionOut.prototype._updateTime,reverse:function(){return cc._easeQuarticActionOut}},cc.easeQuarticActionOut=function(){return cc._easeQuarticActionOut},cc.EaseQuarticActionInOut=cc.ActionEase.extend({_updateTime:function(t){return t*=2,1>t?.5*t*t*t*t:(t-=2,-.5*(t*t*t*t-2))},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuarticActionInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuarticActionInOut(this._inner.reverse())}}),cc.EaseQuarticActionInOut.create=function(t){return new cc.EaseQuarticActionInOut(t)},cc._easeQuarticActionInOut={easing:cc.EaseQuarticActionInOut.prototype._updateTime,reverse:function(){return cc._easeQuarticActionInOut}},cc.easeQuarticActionInOut=function(){return cc._easeQuarticActionInOut},cc.EaseQuinticActionIn=cc.ActionEase.extend({_updateTime:function(t){return t*t*t*t*t},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuinticActionIn;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuinticActionIn(this._inner.reverse())}}),cc.EaseQuinticActionIn.create=function(t){return new cc.EaseQuinticActionIn(t)},cc._easeQuinticActionIn={easing:cc.EaseQuinticActionIn.prototype._updateTime,reverse:function(){return cc._easeQuinticActionIn}},cc.easeQuinticActionIn=function(){return cc._easeQuinticActionIn},cc.EaseQuinticActionOut=cc.ActionEase.extend({_updateTime:function(t){return t-=1,t*t*t*t*t+1},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuinticActionOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuinticActionOut(this._inner.reverse())}}),cc.EaseQuinticActionOut.create=function(t){return new cc.EaseQuinticActionOut(t)},cc._easeQuinticActionOut={easing:cc.EaseQuinticActionOut.prototype._updateTime,reverse:function(){return cc._easeQuinticActionOut}},cc.easeQuinticActionOut=function(){return cc._easeQuinticActionOut},cc.EaseQuinticActionInOut=cc.ActionEase.extend({_updateTime:function(t){return t*=2,1>t?.5*t*t*t*t*t:(t-=2,.5*(t*t*t*t*t+2))},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuinticActionInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuinticActionInOut(this._inner.reverse())}}),cc.EaseQuinticActionInOut.create=function(t){return new cc.EaseQuinticActionInOut(t)},cc._easeQuinticActionInOut={easing:cc.EaseQuinticActionInOut.prototype._updateTime,reverse:function(){return cc._easeQuinticActionInOut}},cc.easeQuinticActionInOut=function(){return cc._easeQuinticActionInOut},cc.EaseCircleActionIn=cc.ActionEase.extend({_updateTime:function(t){return-1*(Math.sqrt(1-t*t)-1)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseCircleActionIn;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseCircleActionIn(this._inner.reverse())}}),cc.EaseCircleActionIn.create=function(t){return new cc.EaseCircleActionIn(t)},cc._easeCircleActionIn={easing:cc.EaseCircleActionIn.prototype._updateTime,reverse:function(){return cc._easeCircleActionIn}},cc.easeCircleActionIn=function(){return cc._easeCircleActionIn},cc.EaseCircleActionOut=cc.ActionEase.extend({_updateTime:function(t){return t-=1,Math.sqrt(1-t*t)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseCircleActionOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseCircleActionOut(this._inner.reverse())}}),cc.EaseCircleActionOut.create=function(t){return new cc.EaseCircleActionOut(t)},cc._easeCircleActionOut={easing:cc.EaseCircleActionOut.prototype._updateTime,reverse:function(){return cc._easeCircleActionOut}},cc.easeCircleActionOut=function(){return cc._easeCircleActionOut},cc.EaseCircleActionInOut=cc.ActionEase.extend({_updateTime:function(t){return t*=2,1>t?-.5*(Math.sqrt(1-t*t)-1):(t-=2,.5*(Math.sqrt(1-t*t)+1))},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseCircleActionInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseCircleActionInOut(this._inner.reverse())}}),cc.EaseCircleActionInOut.create=function(t){return new cc.EaseCircleActionInOut(t)},cc._easeCircleActionInOut={easing:cc.EaseCircleActionInOut.prototype._updateTime,reverse:function(){return cc._easeCircleActionInOut}},cc.easeCircleActionInOut=function(){return cc._easeCircleActionInOut},cc.EaseCubicActionIn=cc.ActionEase.extend({_updateTime:function(t){return t*t*t},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseCubicActionIn;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseCubicActionIn(this._inner.reverse())}}),cc.EaseCubicActionIn.create=function(t){return new cc.EaseCubicActionIn(t)},cc._easeCubicActionIn={easing:cc.EaseCubicActionIn.prototype._updateTime,reverse:function(){return cc._easeCubicActionIn}},cc.easeCubicActionIn=function(){return cc._easeCubicActionIn},cc.EaseCubicActionOut=cc.ActionEase.extend({_updateTime:function(t){return t-=1,t*t*t+1},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseCubicActionOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseCubicActionOut(this._inner.reverse())}}),cc.EaseCubicActionOut.create=function(t){return new cc.EaseCubicActionOut(t)},cc._easeCubicActionOut={easing:cc.EaseCubicActionOut.prototype._updateTime,reverse:function(){return cc._easeCubicActionOut}},cc.easeCubicActionOut=function(){return cc._easeCubicActionOut},cc.EaseCubicActionInOut=cc.ActionEase.extend({_updateTime:function(t){return t*=2,1>t?.5*t*t*t:(t-=2,.5*(t*t*t+2))},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseCubicActionInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseCubicActionInOut(this._inner.reverse())}}),cc.EaseCubicActionInOut.create=function(t){return new cc.EaseCubicActionInOut(t)},cc._easeCubicActionInOut={easing:cc.EaseCubicActionInOut.prototype._updateTime,reverse:function(){return cc._easeCubicActionInOut}},cc.easeCubicActionInOut=function(){return cc._easeCubicActionInOut},cc.cardinalSplineAt=function(t,e,i,n,r,o){var s=o*o,c=s*o,a=(1-r)/2;r=a*(-c+2*s-o);var l=a*(-c+s)+(2*c-3*s+1);return o=a*(c-2*s+o)+(-2*c+3*s),s=a*(c-s),cc.p(t.x*r+e.x*l+i.x*o+n.x*s,t.y*r+e.y*l+i.y*o+n.y*s)},cc.reverseControlPoints=function(t){for(var e=[],i=t.length-1;i>=0;i--)e.push(cc.p(t[i].x,t[i].y));return e},cc.cloneControlPoints=function(t){for(var e=[],i=0;i<t.length;i++)e.push(cc.p(t[i].x,t[i].y));return e},cc.copyControlPoints=cc.cloneControlPoints,cc.getControlPointAt=function(t,e){var i=Math.min(t.length-1,Math.max(e,0));return t[i]},cc.reverseControlPointsInline=function(t){for(var e=t.length,i=0|e/2,n=0;i>n;++n){var r=t[n];t[n]=t[e-n-1],t[e-n-1]=r}},cc.CardinalSplineTo=cc.ActionInterval.extend({_points:null,_deltaT:0,_tension:0,_previousPosition:null,_accumulatedDiff:null,ctor:function(t,e,i){cc.ActionInterval.prototype.ctor.call(this),this._points=[],void 0!==i&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){if(!e||0===e.length)throw"Invalid configuration. It must at least have one control point";return cc.ActionInterval.prototype.initWithDuration.call(this,t)?(this.setPoints(e),this._tension=i,!0):!1},clone:function(){var t=new cc.CardinalSplineTo;return t.initWithDuration(this._duration,cc.copyControlPoints(this._points),this._tension),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._deltaT=1/(this._points.length-1),this._previousPosition=cc.p(this.target.getPositionX(),this.target.getPositionY()),this._accumulatedDiff=cc.p(0,0)},update:function(t){t=this._computeEaseTime(t);var e,i=this._points;if(1===t)e=i.length-1,t=1;else{var n=this._deltaT;e=0|t/n,t=(t-n*e)/n
}e=cc.cardinalSplineAt(cc.getControlPointAt(i,e-1),cc.getControlPointAt(i,e-0),cc.getControlPointAt(i,e+1),cc.getControlPointAt(i,e+2),this._tension,t),cc.ENABLE_STACKABLE_ACTIONS&&(i=this.target.getPositionX()-this._previousPosition.x,t=this.target.getPositionY()-this._previousPosition.y,0!==i||0!==t)&&(n=this._accumulatedDiff,i=n.x+i,t=n.y+t,n.x=i,n.y=t,e.x+=i,e.y+=t),this.updatePosition(e)},reverse:function(){var t=cc.reverseControlPoints(this._points);return cc.cardinalSplineTo(this._duration,t,this._tension)},updatePosition:function(t){this.target.setPosition(t),this._previousPosition=t},getPoints:function(){return this._points},setPoints:function(t){this._points=t}}),cc.cardinalSplineTo=function(t,e,i){return new cc.CardinalSplineTo(t,e,i)},cc.CardinalSplineTo.create=cc.cardinalSplineTo,cc.CardinalSplineBy=cc.CardinalSplineTo.extend({_startPosition:null,ctor:function(t,e,i){cc.CardinalSplineTo.prototype.ctor.call(this),this._startPosition=cc.p(0,0),void 0!==i&&this.initWithDuration(t,e,i)},startWithTarget:function(t){cc.CardinalSplineTo.prototype.startWithTarget.call(this,t),this._startPosition.x=t.getPositionX(),this._startPosition.y=t.getPositionY()},reverse:function(){for(var t,e=this._points.slice(),i=e[0],n=1;n<e.length;++n)t=e[n],e[n]=cc.pSub(t,i),i=t;for(e=cc.reverseControlPoints(e),i=e[e.length-1],e.pop(),i.x=-i.x,i.y=-i.y,e.unshift(i),n=1;n<e.length;++n)t=e[n],t.x=-t.x,t.y=-t.y,t.x+=i.x,t.y+=i.y,i=e[n]=t;return cc.cardinalSplineBy(this._duration,e,this._tension)},updatePosition:function(t){var e=this._startPosition,i=t.x+e.x;t=t.y+e.y,this._previousPosition.x=i,this._previousPosition.y=t,this.target.setPosition(i,t)},clone:function(){var t=new cc.CardinalSplineBy;return t.initWithDuration(this._duration,cc.copyControlPoints(this._points),this._tension),t}}),cc.cardinalSplineBy=function(t,e,i){return new cc.CardinalSplineBy(t,e,i)},cc.CardinalSplineBy.create=cc.cardinalSplineBy,cc.CatmullRomTo=cc.CardinalSplineTo.extend({ctor:function(t,e){e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return cc.CardinalSplineTo.prototype.initWithDuration.call(this,t,e,.5)},clone:function(){var t=new cc.CatmullRomTo;return t.initWithDuration(this._duration,cc.copyControlPoints(this._points)),t}}),cc.catmullRomTo=function(t,e){return new cc.CatmullRomTo(t,e)},cc.CatmullRomTo.create=cc.catmullRomTo,cc.CatmullRomBy=cc.CardinalSplineBy.extend({ctor:function(t,e){cc.CardinalSplineBy.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return cc.CardinalSplineTo.prototype.initWithDuration.call(this,t,e,.5)},clone:function(){var t=new cc.CatmullRomBy;return t.initWithDuration(this._duration,cc.copyControlPoints(this._points)),t}}),cc.catmullRomBy=function(t,e){return new cc.CatmullRomBy(t,e)},cc.CatmullRomBy.create=cc.catmullRomBy,cc.ActionTweenDelegate=cc.Class.extend({updateTweenAction:function(){}}),cc.ActionTween=cc.ActionInterval.extend({key:"",from:0,to:0,delta:0,ctor:function(t,e,i,n){cc.ActionInterval.prototype.ctor.call(this),this.key="",void 0!==n&&this.initWithDuration(t,e,i,n)},initWithDuration:function(t,e,i,n){return cc.ActionInterval.prototype.initWithDuration.call(this,t)?(this.key=e,this.to=n,this.from=i,!0):!1},startWithTarget:function(t){if(!t||!t.updateTweenAction)throw"cc.ActionTween.startWithTarget(): target must be non-null, and target must implement updateTweenAction function";cc.ActionInterval.prototype.startWithTarget.call(this,t),this.delta=this.to-this.from},update:function(t){this.target.updateTweenAction(this.to-this.delta*(1-t),this.key)},reverse:function(){return new cc.ActionTween(this.duration,this.key,this.to,this.from)},clone:function(){var t=new cc.ActionTween;return t.initWithDuration(this._duration,this.key,this.from,this.to),t}}),cc.actionTween=function(t,e,i,n){return new cc.ActionTween(t,e,i,n)},cc.ActionTween.create=cc.actionTween,cc.GridAction=cc.ActionInterval.extend({_gridSize:null,_gridNodeTarget:null,ctor:function(t,e){cc._checkWebGLRenderMode(),cc.ActionInterval.prototype.ctor.call(this),this._gridSize=cc.size(0,0),e&&this.initWithDuration(t,e)},_cacheTargetAsGridNode:function(){},clone:function(){var t=new cc.GridAction,e=this._gridSize;return t.initWithDuration(this._duration,cc.size(e.width,e.height)),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),cc.renderer.childrenOrderDirty=!0;var e=this.getGrid(),i=this.target;(t=i.grid)&&0<t.getReuseGrid()?(e=t.getGridSize(),t.isActive()&&e.width===this._gridSize.width&&e.height===this._gridSize.height&&t.reuse()):(t&&t.isActive()&&t.setActive(!1),i.grid=e,i.grid.setActive(!0))},reverse:function(){return new cc.ReverseTime(this)},initWithDuration:function(t,e){return cc.ActionInterval.prototype.initWithDuration.call(this,t)?(this._gridSize.width=e.width,this._gridSize.height=e.height,!0):!1},getGrid:function(){cc.log("cc.GridAction.getGrid(): it should be overridden in subclass.")}}),cc.gridAction=function(t,e){return new cc.GridAction(t,e)},cc.GridAction.create=cc.gridAction,cc.Grid3DAction=cc.GridAction.extend({getGrid:function(){return new cc.Grid3D(this._gridSize)},vertex:function(t){return this.getVertex(t)},getVertex:function(t){return this.target.grid.getVertex(t)},originalVertex:function(t){return this.getOriginalVertex(t)},getOriginalVertex:function(t){return this.target.grid.originalVertex(t)},setVertex:function(t,e){this.target.grid.setVertex(t,e)}}),cc.grid3DAction=function(t,e){return new cc.Grid3DAction(t,e)},cc.Grid3DAction.create=cc.grid3DAction,cc.TiledGrid3DAction=cc.GridAction.extend({tile:function(t){return this.getTile(t)},getTile:function(t){return this.target.grid.tile(t)},originalTile:function(t){return this.getOriginalTile(t)},getOriginalTile:function(t){return this.target.grid.originalTile(t)},setTile:function(t,e){this.target.grid.setTile(t,e)},getGrid:function(){return new cc.TiledGrid3D(this._gridSize)}}),cc.tiledGrid3DAction=function(t,e){return new cc.TiledGrid3DAction(t,e)},cc.TiledGrid3DAction.create=cc.tiledGrid3DAction,cc.StopGrid=cc.ActionInstant.extend({startWithTarget:function(t){cc.ActionInstant.prototype.startWithTarget.call(this,t),cc.renderer.childrenOrderDirty=!0,(t=this.target.grid)&&t.isActive()&&t.setActive(!1)}}),cc.stopGrid=function(){return new cc.StopGrid},cc.StopGrid.create=cc.stopGrid,cc.ReuseGrid=cc.ActionInstant.extend({_times:null,ctor:function(t){cc.ActionInstant.prototype.ctor.call(this),void 0!==t&&this.initWithTimes(t)},initWithTimes:function(t){return this._times=t,!0},startWithTarget:function(t){cc.ActionInstant.prototype.startWithTarget.call(this,t),cc.renderer.childrenOrderDirty=!0,this.target.grid&&this.target.grid.isActive()&&this.target.grid.setReuseGrid(this.target.grid.getReuseGrid()+this._times)}}),cc.reuseGrid=function(t){return new cc.ReuseGrid(t)},cc.ReuseGrid.create=cc.reuseGrid,cc.Waves3D=cc.Grid3DAction.extend({_waves:0,_amplitude:0,_amplitudeRate:0,ctor:function(t,e,i,n){cc.GridAction.prototype.ctor.call(this),void 0!==n&&this.initWithDuration(t,e,i,n)},getAmplitude:function(){return this._amplitude},setAmplitude:function(t){this._amplitude=t},getAmplitudeRate:function(){return this._amplitudeRate},setAmplitudeRate:function(t){this._amplitudeRate=t},initWithDuration:function(t,e,i,n){return cc.Grid3DAction.prototype.initWithDuration.call(this,t,e)?(this._waves=i,this._amplitude=n,this._amplitudeRate=1,!0):!1},update:function(t){for(var e=this._gridSize,i=this._amplitude,n=cc.p(0,0),r=this._amplitudeRate,o=this._waves,s=0;s<e.width+1;++s)for(var c=0;c<e.height+1;++c){n.x=s,n.y=c;var a=this.originalVertex(n);a.z+=Math.sin(Math.PI*t*o*2+.01*(a.y+a.x))*i*r,this.setVertex(n,a)}}}),cc.waves3D=function(t,e,i,n){return new cc.Waves3D(t,e,i,n)},cc.Waves3D.create=cc.waves3D,cc.FlipX3D=cc.Grid3DAction.extend({ctor:function(t){void 0!==t?cc.GridAction.prototype.ctor.call(this,t,cc.size(1,1)):cc.GridAction.prototype.ctor.call(this)},initWithDuration:function(t){return cc.Grid3DAction.prototype.initWithDuration.call(this,t,cc.size(1,1))},initWithSize:function(t,e){return 1!==t.width||1!==t.height?(cc.log("Grid size must be (1,1)"),!1):cc.Grid3DAction.prototype.initWithDuration.call(this,e,t)},update:function(t){var e=Math.PI*t;t=Math.sin(e);var i=Math.cos(e/2),e=new cc.Vertex3F,n=cc.p(0,0);n.x=n.y=1;var r=this.originalVertex(n);n.x=n.y=0;var o,s,n=this.originalVertex(n),c=r.x,a=n.x;c>a?(r=cc.p(0,0),n=cc.p(0,1),o=cc.p(1,0),s=cc.p(1,1)):(o=cc.p(0,0),s=cc.p(0,1),r=cc.p(1,0),n=cc.p(1,1),c=a),e.x=c-c*i,e.z=Math.abs(parseFloat(c*t/4)),t=this.originalVertex(r),t.x=e.x,t.z+=e.z,this.setVertex(r,t),t=this.originalVertex(n),t.x=e.x,t.z+=e.z,this.setVertex(n,t),t=this.originalVertex(o),t.x-=e.x,t.z-=e.z,this.setVertex(o,t),t=this.originalVertex(s),t.x-=e.x,t.z-=e.z,this.setVertex(s,t)}}),cc.flipX3D=function(t){return new cc.FlipX3D(t)},cc.FlipX3D.create=cc.flipX3D,cc.FlipY3D=cc.FlipX3D.extend({ctor:function(t){void 0!==t?cc.GridAction.prototype.ctor.call(this,t,cc.size(1,1)):cc.GridAction.prototype.ctor.call(this)},update:function(t){var e=Math.PI*t;t=Math.sin(e);var i=Math.cos(e/2),e=new cc.Vertex3F,n=cc.p(0,0);n.x=n.y=1;var r=this.originalVertex(n);n.x=n.y=0;var o,s,n=this.originalVertex(n),c=r.y,a=n.y;c>a?(r=cc.p(0,0),n=cc.p(0,1),o=cc.p(1,0),s=cc.p(1,1)):(n=cc.p(0,0),r=cc.p(0,1),s=cc.p(1,0),o=cc.p(1,1),c=a),e.y=c-c*i,e.z=Math.abs(parseFloat(c*t)/4),t=this.originalVertex(r),t.y=e.y,t.z+=e.z,this.setVertex(r,t),t=this.originalVertex(n),t.y-=e.y,t.z-=e.z,this.setVertex(n,t),t=this.originalVertex(o),t.y=e.y,t.z+=e.z,this.setVertex(o,t),t=this.originalVertex(s),t.y-=e.y,t.z-=e.z,this.setVertex(s,t)}}),cc.flipY3D=function(t){return new cc.FlipY3D(t)},cc.FlipY3D.create=cc.flipY3D,cc.Lens3D=cc.Grid3DAction.extend({_position:null,_radius:0,_lensEffect:0,_concave:!1,_dirty:!1,ctor:function(t,e,i,n){cc.GridAction.prototype.ctor.call(this),this._position=cc.p(0,0),void 0!==n&&this.initWithDuration(t,e,i,n)},getLensEffect:function(){return this._lensEffect},setLensEffect:function(t){this._lensEffect=t},setConcave:function(t){this._concave=t},getPosition:function(){return this._position},setPosition:function(t){cc.pointEqualToPoint(t,this._position)||(this._position.x=t.x,this._position.y=t.y,this._dirty=!0)},initWithDuration:function(t,e,i,n){return cc.Grid3DAction.prototype.initWithDuration.call(this,t,e)?(this.setPosition(i),this._radius=n,this._lensEffect=.7,this._dirty=!0):!1},update:function(t){if(this._dirty){t=this._gridSize.width;for(var e,i,n,r=this._gridSize.height,o=this._radius,s=this._lensEffect,c=cc.p(0,0),a=cc.p(0,0),l=0;t+1>l;++l)for(var h=0;r+1>h;++h)c.x=l,c.y=h,e=this.originalVertex(c),a.x=this._position.x-e.x,a.y=this._position.y-e.y,i=cc.pLength(a),o>i&&(i=o-i,i/=o,0===i&&(i=.001),i=Math.log(i)*s,n=Math.exp(i)*o,i=cc.pLength(a),i>0&&(a.x/=i,a.y/=i,a.x*=n,a.y*=n,e.z+=cc.pLength(a)*s)),this.setVertex(c,e);this._dirty=!1}}}),cc.lens3D=function(t,e,i,n){return new cc.Lens3D(t,e,i,n)},cc.Lens3D.create=cc.lens3D,cc.Ripple3D=cc.Grid3DAction.extend({_position:null,_radius:0,_waves:0,_amplitude:0,_amplitudeRate:0,ctor:function(t,e,i,n,r,o){cc.GridAction.prototype.ctor.call(this),this._position=cc.p(0,0),void 0!==o&&this.initWithDuration(t,e,i,n,r,o)},getPosition:function(){return this._position},setPosition:function(t){this._position.x=t.x,this._position.y=t.y},getAmplitude:function(){return this._amplitude},setAmplitude:function(t){this._amplitude=t},getAmplitudeRate:function(){return this._amplitudeRate},setAmplitudeRate:function(t){this._amplitudeRate=t},initWithDuration:function(t,e,i,n,r,o){return cc.Grid3DAction.prototype.initWithDuration.call(this,t,e)?(this.setPosition(i),this._radius=n,this._waves=r,this._amplitude=o,this._amplitudeRate=1,!0):!1},update:function(t){for(var e,i,n=this._gridSize.width,r=this._gridSize.height,o=cc.p(0,0),s=this._radius,c=this._waves,a=this._amplitude,l=this._amplitudeRate,h=cc.p(0,0),u=0;n+1>u;++u)for(var d=0;r+1>d;++d){if(o.x=u,o.y=d,e=this.originalVertex(o),h.x=this._position.x-e.x,h.y=this._position.y-e.y,i=cc.pLength(h),s>i){i=s-i;var _=Math.pow(i/s,2);e.z+=Math.sin(t*Math.PI*c*2+.1*i)*a*l*_}this.setVertex(o,e)}}}),cc.ripple3D=function(t,e,i,n,r,o){return new cc.Ripple3D(t,e,i,n,r,o)},cc.Ripple3D.create=cc.ripple3D,cc.Shaky3D=cc.Grid3DAction.extend({_randRange:0,_shakeZ:!1,ctor:function(t,e,i,n){cc.GridAction.prototype.ctor.call(this),void 0!==n&&this.initWithDuration(t,e,i,n)},initWithDuration:function(t,e,i,n){return cc.Grid3DAction.prototype.initWithDuration.call(this,t,e)?(this._randRange=i,this._shakeZ=n,!0):!1},update:function(t){t=this._gridSize.width;for(var e,i=this._gridSize.height,n=this._randRange,r=this._shakeZ,o=cc.p(0,0),s=0;t+1>s;++s)for(var c=0;i+1>c;++c)o.x=s,o.y=c,e=this.originalVertex(o),e.x+=cc.rand()%(2*n)-n,e.y+=cc.rand()%(2*n)-n,r&&(e.z+=cc.rand()%(2*n)-n),this.setVertex(o,e)}}),cc.shaky3D=function(t,e,i,n){return new cc.Shaky3D(t,e,i,n)},cc.Shaky3D.create=cc.shaky3D,cc.Liquid=cc.Grid3DAction.extend({_waves:0,_amplitude:0,_amplitudeRate:0,ctor:function(t,e,i,n){cc.GridAction.prototype.ctor.call(this),void 0!==n&&this.initWithDuration(t,e,i,n)},getAmplitude:function(){return this._amplitude},setAmplitude:function(t){this._amplitude=t},getAmplitudeRate:function(){return this._amplitudeRate},setAmplitudeRate:function(t){this._amplitudeRate=t},initWithDuration:function(t,e,i,n){return cc.Grid3DAction.prototype.initWithDuration.call(this,t,e)?(this._waves=i,this._amplitude=n,this._amplitudeRate=1,!0):!1},update:function(t){for(var e,i=this._gridSize.width,n=this._gridSize.height,r=cc.p(0,0),o=this._waves,s=this._amplitude,c=this._amplitudeRate,a=1;i>a;++a)for(var l=1;n>l;++l)r.x=a,r.y=l,e=this.originalVertex(r),e.x+=Math.sin(t*Math.PI*o*2+.01*e.x)*s*c,e.y+=Math.sin(t*Math.PI*o*2+.01*e.y)*s*c,this.setVertex(r,e)}}),cc.liquid=function(t,e,i,n){return new cc.Liquid(t,e,i,n)},cc.Liquid.create=cc.liquid,cc.Waves=cc.Grid3DAction.extend({_waves:0,_amplitude:0,_amplitudeRate:0,_vertical:!1,_horizontal:!1,ctor:function(t,e,i,n,r,o){cc.GridAction.prototype.ctor.call(this),void 0!==o&&this.initWithDuration(t,e,i,n,r,o)},getAmplitude:function(){return this._amplitude},setAmplitude:function(t){this._amplitude=t},getAmplitudeRate:function(){return this._amplitudeRate},setAmplitudeRate:function(t){this._amplitudeRate=t},initWithDuration:function(t,e,i,n,r,o){return cc.Grid3DAction.prototype.initWithDuration.call(this,t,e)?(this._waves=i,this._amplitude=n,this._amplitudeRate=1,this._horizontal=r,this._vertical=o,!0):!1},update:function(t){for(var e,i=this._gridSize.width,n=this._gridSize.height,r=cc.p(0,0),o=this._vertical,s=this._horizontal,c=this._waves,a=this._amplitude,l=this._amplitudeRate,h=0;i+1>h;++h)for(var u=0;n+1>u;++u)r.x=h,r.y=u,e=this.originalVertex(r),o&&(e.x+=Math.sin(t*Math.PI*c*2+.01*e.y)*a*l),s&&(e.y+=Math.sin(t*Math.PI*c*2+.01*e.x)*a*l),this.setVertex(r,e)}}),cc.waves=function(t,e,i,n,r,o){return new cc.Waves(t,e,i,n,r,o)},cc.Waves.create=cc.waves,cc.Twirl=cc.Grid3DAction.extend({_position:null,_twirls:0,_amplitude:0,_amplitudeRate:0,ctor:function(t,e,i,n,r){cc.GridAction.prototype.ctor.call(this),this._position=cc.p(0,0),void 0!==r&&this.initWithDuration(t,e,i,n,r)},getPosition:function(){return this._position},setPosition:function(t){this._position.x=t.x,this._position.y=t.y},getAmplitude:function(){return this._amplitude},setAmplitude:function(t){this._amplitude=t},getAmplitudeRate:function(){return this._amplitudeRate},setAmplitudeRate:function(t){this._amplitudeRate=t},initWithDuration:function(t,e,i,n,r){return cc.Grid3DAction.prototype.initWithDuration.call(this,t,e)?(this.setPosition(i),this._twirls=n,this._amplitude=r,this._amplitudeRate=1,!0):!1},update:function(t){for(var e,i,n,r=this._position,o=this._gridSize.width,s=this._gridSize.height,c=cc.p(0,0),a=.1*this._amplitude*this._amplitudeRate,l=this._twirls,h=cc.p(0,0),u=0;o+1>u;++u)for(var d=0;s+1>d;++d)c.x=u,c.y=d,e=this.originalVertex(c),h.x=u-o/2,h.y=d-s/2,i=cc.pLength(h)*Math.cos(Math.PI/2+t*Math.PI*l*2)*a,n=Math.sin(i)*(e.y-r.y)+Math.cos(i)*(e.x-r.x),i=Math.cos(i)*(e.y-r.y)-Math.sin(i)*(e.x-r.x),e.x=r.x+n,e.y=r.y+i,this.setVertex(c,e)}}),cc.twirl=function(t,e,i,n,r){return new cc.Twirl(t,e,i,n,r)},cc.Twirl.create=cc.twirl,cc.ShakyTiles3D=cc.TiledGrid3DAction.extend({_randRange:0,_shakeZ:!1,ctor:function(t,e,i,n){cc.GridAction.prototype.ctor.call(this),void 0!==n&&this.initWithDuration(t,e,i,n)},initWithDuration:function(t,e,i,n){return cc.TiledGrid3DAction.prototype.initWithDuration.call(this,t,e)?(this._randRange=i,this._shakeZ=n,!0):!1},update:function(t){t=this._gridSize;for(var e=this._randRange,i=cc.p(0,0),n=0;n<t.width;++n)for(var r=0;r<t.height;++r){i.x=n,i.y=r;var o=this.originalTile(i);o.bl.x+=cc.rand()%(2*e)-e,o.br.x+=cc.rand()%(2*e)-e,o.tl.x+=cc.rand()%(2*e)-e,o.tr.x+=cc.rand()%(2*e)-e,o.bl.y+=cc.rand()%(2*e)-e,o.br.y+=cc.rand()%(2*e)-e,o.tl.y+=cc.rand()%(2*e)-e,o.tr.y+=cc.rand()%(2*e)-e,this._shakeZ&&(o.bl.z+=cc.rand()%(2*e)-e,o.br.z+=cc.rand()%(2*e)-e,o.tl.z+=cc.rand()%(2*e)-e,o.tr.z+=cc.rand()%(2*e)-e),this.setTile(i,o)}}}),cc.shakyTiles3D=function(t,e,i,n){return new cc.ShakyTiles3D(t,e,i,n)},cc.ShakyTiles3D.create=cc.shakyTiles3D,cc.ShatteredTiles3D=cc.TiledGrid3DAction.extend({_randRange:0,_once:!1,_shatterZ:!1,ctor:function(t,e,i,n){cc.GridAction.prototype.ctor.call(this),void 0!==n&&this.initWithDuration(t,e,i,n)},initWithDuration:function(t,e,i,n){return cc.TiledGrid3DAction.prototype.initWithDuration.call(this,t,e)?(this._once=!1,this._randRange=i,this._shatterZ=n,!0):!1},update:function(t){if(!1===this._once){t=this._gridSize;for(var e,i=this._randRange,n=cc.p(0,0),r=0;r<t.width;++r)for(var o=0;o<t.height;++o)n.x=r,n.y=o,e=this.originalTile(n),e.bl.x+=cc.rand()%(2*i)-i,e.br.x+=cc.rand()%(2*i)-i,e.tl.x+=cc.rand()%(2*i)-i,e.tr.x+=cc.rand()%(2*i)-i,e.bl.y+=cc.rand()%(2*i)-i,e.br.y+=cc.rand()%(2*i)-i,e.tl.y+=cc.rand()%(2*i)-i,e.tr.y+=cc.rand()%(2*i)-i,this._shatterZ&&(e.bl.z+=cc.rand()%(2*i)-i,e.br.z+=cc.rand()%(2*i)-i,e.tl.z+=cc.rand()%(2*i)-i,e.tr.z+=cc.rand()%(2*i)-i),this.setTile(n,e);this._once=!0}}}),cc.shatteredTiles3D=function(t,e,i,n){return new cc.ShatteredTiles3D(t,e,i,n)},cc.ShatteredTiles3D.create=cc.shatteredTiles3D,cc.Tile=function(t,e,i){this.position=t||cc.p(0,0),this.startPosition=e||cc.p(0,0),this.delta=i||cc.p(0,0)},cc.ShuffleTiles=cc.TiledGrid3DAction.extend({_seed:0,_tilesCount:0,_tilesOrder:null,_tiles:null,ctor:function(t,e,i){cc.GridAction.prototype.ctor.call(this),this._tilesOrder=[],this._tiles=[],void 0!==i&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){return cc.TiledGrid3DAction.prototype.initWithDuration.call(this,t,e)?(this._seed=i,this._tilesOrder.length=0,this._tiles.length=0,!0):!1},shuffle:function(t,e){for(var i=e-1;i>=0;i--){var n=0|cc.rand()%(i+1),r=t[i];t[i]=t[n],t[n]=r}},getDelta:function(t){var e=this._gridSize,i=t.width*e.height+t.height;return cc.size(this._tilesOrder[i]/e.height-t.width,this._tilesOrder[i]%e.height-t.height)},placeTile:function(t,e){var i=this.originalTile(t),n=this.target.grid.getStep(),r=e.position;i.bl.x+=r.x*n.x,i.bl.y+=r.y*n.y,i.br.x+=r.x*n.x,i.br.y+=r.y*n.y,i.tl.x+=r.x*n.x,i.tl.y+=r.y*n.y,i.tr.x+=r.x*n.x,i.tr.y+=r.y*n.y,this.setTile(t,i)},startWithTarget:function(t){cc.TiledGrid3DAction.prototype.startWithTarget.call(this,t),t=this._gridSize,this._tilesCount=t.width*t.height;for(var e=this._tilesOrder,i=e.length=0;i<this._tilesCount;++i)e[i]=i;this.shuffle(e,this._tilesCount);for(var e=this._tiles,i=e.length=0,n=cc.size(0,0),r=0;r<t.width;++r)for(var o=0;o<t.height;++o)e[i]=new cc.Tile,e[i].position=cc.p(r,o),e[i].startPosition=cc.p(r,o),n.width=r,n.height=o,e[i].delta=this.getDelta(n),++i},update:function(t){for(var e,i=0,n=this._gridSize,r=this._tiles,o=cc.p(0,0),s=0;s<n.width;++s)for(var c=0;c<n.height;++c)o.x=s,o.y=c,e=r[i],e.position.x=e.delta.width*t,e.position.y=e.delta.height*t,this.placeTile(o,e),++i}}),cc.shuffleTiles=function(t,e,i){return new cc.ShuffleTiles(t,e,i)},cc.ShuffleTiles.create=cc.shuffleTiles,cc.FadeOutTRTiles=cc.TiledGrid3DAction.extend({testFunc:function(t,e){var i=this._gridSize.width*e,n=this._gridSize.height*e;return 0===i+n?1:Math.pow((t.width+t.height)/(i+n),6)},turnOnTile:function(t){this.setTile(t,this.originalTile(t))},turnOffTile:function(t){this.setTile(t,new cc.Quad3)},transformTile:function(t,e){var i=this.originalTile(t),n=this.target.grid.getStep();i.bl.x+=n.x/2*(1-e),i.bl.y+=n.y/2*(1-e),i.br.x-=n.x/2*(1-e),i.br.y+=n.y/2*(1-e),i.tl.x+=n.x/2*(1-e),i.tl.y-=n.y/2*(1-e),i.tr.x-=n.x/2*(1-e),i.tr.y-=n.y/2*(1-e),this.setTile(t,i)},update:function(t){for(var e,i=this._gridSize,n=cc.p(0,0),r=cc.size(0,0),o=0;o<i.width;++o)for(var s=0;s<i.height;++s)n.x=o,n.y=s,r.width=o,r.height=s,e=this.testFunc(r,t),0===e?this.turnOffTile(n):1>e?this.transformTile(n,e):this.turnOnTile(n)}}),cc.fadeOutTRTiles=function(t,e){return new cc.FadeOutTRTiles(t,e)},cc.FadeOutTRTiles.create=cc.fadeOutTRTiles,cc.FadeOutBLTiles=cc.FadeOutTRTiles.extend({testFunc:function(t,e){return 0===t.width+t.height?1:Math.pow((this._gridSize.width*(1-e)+this._gridSize.height*(1-e))/(t.width+t.height),6)}}),cc.fadeOutBLTiles=function(t,e){return new cc.FadeOutBLTiles(t,e)},cc.FadeOutBLTiles.create=cc.fadeOutBLTiles,cc.FadeOutUpTiles=cc.FadeOutTRTiles.extend({testFunc:function(t,e){var i=this._gridSize.height*e;return 0===i?1:Math.pow(t.height/i,6)},transformTile:function(t,e){var i=this.originalTile(t),n=this.target.grid.getStep();i.bl.y+=n.y/2*(1-e),i.br.y+=n.y/2*(1-e),i.tl.y-=n.y/2*(1-e),i.tr.y-=n.y/2*(1-e),this.setTile(t,i)}}),cc.fadeOutUpTiles=function(t,e){return new cc.FadeOutUpTiles(t,e)},cc.FadeOutUpTiles.create=cc.fadeOutUpTiles,cc.FadeOutDownTiles=cc.FadeOutUpTiles.extend({testFunc:function(t,e){return 0===t.height?1:Math.pow(this._gridSize.height*(1-e)/t.height,6)}}),cc.fadeOutDownTiles=function(t,e){return new cc.FadeOutDownTiles(t,e)},cc.FadeOutDownTiles.create=cc.fadeOutDownTiles,cc.TurnOffTiles=cc.TiledGrid3DAction.extend({_seed:null,_tilesCount:0,_tilesOrder:null,ctor:function(t,e,i){cc.GridAction.prototype.ctor.call(this),this._tilesOrder=[],void 0!==e&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){return cc.TiledGrid3DAction.prototype.initWithDuration.call(this,t,e)?(this._seed=i||0,this._tilesOrder.length=0,!0):!1},shuffle:function(t,e){for(var i=e-1;i>=0;i--){var n=0|cc.rand()%(i+1),r=t[i];t[i]=t[n],t[n]=r}},turnOnTile:function(t){this.setTile(t,this.originalTile(t))},turnOffTile:function(t){this.setTile(t,new cc.Quad3)},startWithTarget:function(t){cc.TiledGrid3DAction.prototype.startWithTarget.call(this,t),this._tilesCount=this._gridSize.width*this._gridSize.height,t=this._tilesOrder;for(var e=t.length=0;e<this._tilesCount;++e)t[e]=e;this.shuffle(t,this._tilesCount)},update:function(t){t=0|t*this._tilesCount;for(var e,i=this._gridSize,n=cc.p(0,0),r=this._tilesOrder,o=0;o<this._tilesCount;o++)e=r[o],n.x=0|e/i.height,n.y=e%(0|i.height),t>o?this.turnOffTile(n):this.turnOnTile(n)}}),cc.turnOffTiles=function(t,e,i){return new cc.TurnOffTiles(t,e,i)},cc.TurnOffTiles.create=cc.turnOffTiles,cc.WavesTiles3D=cc.TiledGrid3DAction.extend({_waves:0,_amplitude:0,_amplitudeRate:0,ctor:function(t,e,i,n){cc.GridAction.prototype.ctor.call(this),void 0!==n&&this.initWithDuration(t,e,i,n)},getAmplitude:function(){return this._amplitude},setAmplitude:function(t){this._amplitude=t},getAmplitudeRate:function(){return this._amplitudeRate},setAmplitudeRate:function(t){this._amplitudeRate=t},initWithDuration:function(t,e,i,n){return cc.TiledGrid3DAction.prototype.initWithDuration.call(this,t,e)?(this._waves=i,this._amplitude=n,this._amplitudeRate=1,!0):!1},update:function(t){for(var e,i=this._gridSize,n=this._waves,r=this._amplitude,o=this._amplitudeRate,s=cc.p(0,0),c=0;c<i.width;c++)for(var a=0;a<i.height;a++)s.x=c,s.y=a,e=this.originalTile(s),e.bl.z=Math.sin(t*Math.PI*n*2+.01*(e.bl.y+e.bl.x))*r*o,e.br.z=e.bl.z,e.tl.z=e.bl.z,e.tr.z=e.bl.z,this.setTile(s,e)}}),cc.wavesTiles3D=function(t,e,i,n){return new cc.WavesTiles3D(t,e,i,n)},cc.WavesTiles3D.create=cc.wavesTiles3D,cc.JumpTiles3D=cc.TiledGrid3DAction.extend({_jumps:0,_amplitude:0,_amplitudeRate:0,ctor:function(t,e,i,n){cc.GridAction.prototype.ctor.call(this),void 0!==n&&this.initWithDuration(t,e,i,n)},getAmplitude:function(){return this._amplitude},setAmplitude:function(t){this._amplitude=t},getAmplitudeRate:function(){return this._amplitudeRate},setAmplitudeRate:function(t){this._amplitudeRate=t},initWithDuration:function(t,e,i,n){return cc.TiledGrid3DAction.prototype.initWithDuration.call(this,t,e)?(this._jumps=i,this._amplitude=n,this._amplitudeRate=1,!0):!1},update:function(t){var e=Math.sin(Math.PI*t*this._jumps*2)*this._amplitude*this._amplitudeRate;t=Math.sin(Math.PI*(t*this._jumps*2+1))*this._amplitude*this._amplitudeRate;for(var i,n=this._gridSize,r=this.target.grid,o=cc.p(0,0),s=0;s<n.width;s++)for(var c=0;c<n.height;c++)o.x=s,o.y=c,i=r.originalTile(o),0===(s+c)%2?(i.bl.z+=e,i.br.z+=e,i.tl.z+=e,i.tr.z+=e):(i.bl.z+=t,i.br.z+=t,i.tl.z+=t,i.tr.z+=t),r.setTile(o,i)}}),cc.jumpTiles3D=function(t,e,i,n){return new cc.JumpTiles3D(t,e,i,n)},cc.JumpTiles3D.create=cc.jumpTiles3D,cc.SplitRows=cc.TiledGrid3DAction.extend({_rows:0,_winSize:null,ctor:function(t,e){cc.GridAction.prototype.ctor.call(this),void 0!==e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return this._rows=e,cc.TiledGrid3DAction.prototype.initWithDuration.call(this,t,cc.size(1,e))},update:function(t){for(var e,i,n=this._gridSize,r=this._winSize.width,o=cc.p(0,0),s=0;s<n.height;++s)o.y=s,e=this.originalTile(o),i=1,0===s%2&&(i=-1),e.bl.x+=i*r*t,e.br.x+=i*r*t,e.tl.x+=i*r*t,e.tr.x+=i*r*t,this.setTile(o,e)},startWithTarget:function(t){cc.TiledGrid3DAction.prototype.startWithTarget.call(this,t),this._winSize=cc.director.getWinSizeInPixels()}}),cc.splitRows=function(t,e){return new cc.SplitRows(t,e)},cc.SplitRows.create=cc.splitRows,cc.SplitCols=cc.TiledGrid3DAction.extend({_cols:0,_winSize:null,ctor:function(t,e){cc.GridAction.prototype.ctor.call(this),void 0!==e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return this._cols=e,cc.TiledGrid3DAction.prototype.initWithDuration.call(this,t,cc.size(e,1))},update:function(t){for(var e,i,n=this._gridSize.width,r=this._winSize.height,o=cc.p(0,0),s=0;n>s;++s)o.x=s,e=this.originalTile(o),i=1,0===s%2&&(i=-1),e.bl.y+=i*r*t,e.br.y+=i*r*t,e.tl.y+=i*r*t,e.tr.y+=i*r*t,this.setTile(o,e);cc.renderer.childrenOrderDirty=!0},startWithTarget:function(t){cc.TiledGrid3DAction.prototype.startWithTarget.call(this,t),this._winSize=cc.director.getWinSizeInPixels()}}),cc.splitCols=function(t,e){return new cc.SplitCols(t,e)},cc.SplitCols.create=cc.splitCols,cc.PageTurn3D=cc.Grid3DAction.extend({getGrid:function(){var t=new cc.Grid3D(this._gridSize);return t.setNeedDepthTestForBlit(!0),t},clone:function(){var t=new cc.PageTurn3D;return t.initWithDuration(this._duration,this._gridSize),t},update:function(t){var e=Math.max(0,t-.25),e=-100-e*e*500;t=-Math.PI/2*Math.sqrt(t);var i=+Math.PI/2+t;t=Math.sin(i);for(var i=Math.cos(i),n=this._gridSize,r=cc.p(0,0),o=0;o<=n.width;++o)for(var s=0;s<=n.height;++s){r.x=o,r.y=s;var c=this.getOriginalVertex(r),a=Math.sqrt(c.x*c.x+(c.y-e)*(c.y-e)),l=a*t,h=Math.asin(c.x/a)/t,u=Math.cos(h);c.x=h<=Math.PI?l*Math.sin(h):0,c.y=a+e-l*(1-u)*t,c.z=l*(1-u)*i/7,.5>c.z&&(c.z=.5),this.setVertex(r,c)}}}),cc.pageTurn3D=function(t,e){return new cc.PageTurn3D(t,e)},cc.PageTurn3D.create=cc.pageTurn3D,cc.ProgressTimer=cc.Node.extend({_type:null,_percentage:0,_sprite:null,_midPoint:null,_barChangeRate:null,_reverseDirection:!1,_className:"ProgressTimer",ctor:function(t){cc.Node.prototype.ctor.call(this),this._type=cc.ProgressTimer.TYPE_RADIAL,this._percentage=0,this._midPoint=cc.p(0,0),this._barChangeRate=cc.p(0,0),this._reverseDirection=!1,this._sprite=null,t&&this.initWithSprite(t)},getMidpoint:function(){return cc.p(this._midPoint.x,this._midPoint.y)},setMidpoint:function(t){this._midPoint=cc.pClamp(t,cc.p(0,0),cc.p(1,1))},getBarChangeRate:function(){return cc.p(this._barChangeRate.x,this._barChangeRate.y)},setBarChangeRate:function(t){this._barChangeRate=cc.pClamp(t,cc.p(0,0),cc.p(1,1))},getType:function(){return this._type},getPercentage:function(){return this._percentage},getSprite:function(){return this._sprite},setPercentage:function(t){this._percentage!==t&&(this._percentage=cc.clampf(t,0,100),this._renderCmd._updateProgress())},setOpacityModifyRGB:function(){},isOpacityModifyRGB:function(){return!1},isReverseDirection:function(){return this._reverseDirection},setColor:function(t){this._sprite.color=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty)},setOpacity:function(t){this._sprite.opacity=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty)},getColor:function(){return this._sprite.color},getOpacity:function(){return this._sprite.opacity},setReverseProgress:function(t){this._reverseDirection!==t&&(this._reverseDirection=t,this._renderCmd.releaseData())},setSprite:function(t){this._sprite!==t&&((this._sprite=t)?this.setContentSize(t.width,t.height):this.setContentSize(0,0),this._renderCmd.releaseData())},setType:function(t){t!==this._type&&(this._type=t,this._renderCmd.releaseData())},setReverseDirection:function(t){this._reverseDirection!==t&&(this._reverseDirection=t,this._renderCmd.releaseData())},initWithSprite:function(t){return this.percentage=0,this.setAnchorPoint(.5,.5),this._type=cc.ProgressTimer.TYPE_RADIAL,this._reverseDirection=!1,this.midPoint=cc.p(.5,.5),this.barChangeRate=cc.p(1,1),this.setSprite(t),this._renderCmd.initCmd(),!0},_createRenderCmd:function(){return cc._renderType===cc._RENDER_TYPE_CANVAS?new cc.ProgressTimer.CanvasRenderCmd(this):new cc.ProgressTimer.WebGLRenderCmd(this)}}),_p=cc.ProgressTimer.prototype,cc.defineGetterSetter(_p,"midPoint",_p.getMidpoint,_p.setMidpoint),cc.defineGetterSetter(_p,"barChangeRate",_p.getBarChangeRate,_p.setBarChangeRate),cc.defineGetterSetter(_p,"type",_p.getType,_p.setType),cc.defineGetterSetter(_p,"percentage",_p.getPercentage,_p.setPercentage),cc.defineGetterSetter(_p,"sprite",_p.getSprite,_p.setSprite),cc.defineGetterSetter(_p,"reverseDir",_p.isReverseDirection,_p.setReverseDirection),cc.ProgressTimer.create=function(t){return new cc.ProgressTimer(t)},cc.ProgressTimer.TEXTURE_COORDS_COUNT=4,cc.ProgressTimer.TEXTURE_COORDS=75,cc.ProgressTimer.TYPE_RADIAL=0,cc.ProgressTimer.TYPE_BAR=1,cc.ProgressTo=cc.ActionInterval.extend({_to:0,_from:0,ctor:function(t,e){cc.ActionInterval.prototype.ctor.call(this),this._from=this._to=0,void 0!==e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return cc.ActionInterval.prototype.initWithDuration.call(this,t)?(this._to=e,!0):!1},clone:function(){var t=new cc.ProgressTo;return t.initWithDuration(this._duration,this._to),t},reverse:function(){return cc.log("cc.ProgressTo.reverse(): reverse hasn't been supported."),null},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._from=t.percentage},update:function(t){this.target instanceof cc.ProgressTimer&&(this.target.percentage=this._from+(this._to-this._from)*t)}}),cc.progressTo=function(t,e){return new cc.ProgressTo(t,e)},cc.ProgressTo.create=cc.progressTo,cc.ProgressFromTo=cc.ActionInterval.extend({_to:0,_from:0,ctor:function(t,e,i){cc.ActionInterval.prototype.ctor.call(this),this._from=this._to=0,void 0!==i&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){return cc.ActionInterval.prototype.initWithDuration.call(this,t)?(this._to=i,this._from=e,!0):!1},clone:function(){var t=new cc.ProgressFromTo;return t.initWithDuration(this._duration,this._from,this._to),t},reverse:function(){return cc.progressFromTo(this._duration,this._to,this._from)},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t)},update:function(t){this.target instanceof cc.ProgressTimer&&(this.target.percentage=this._from+(this._to-this._from)*t)}}),cc.progressFromTo=function(t,e,i){return new cc.ProgressFromTo(t,e,i)},cc.ProgressFromTo.create=cc.progressFromTo,function(){cc.ProgressTimer.CanvasRenderCmd=function(t){cc.Node.CanvasRenderCmd.call(this,t),this._needDraw=!0,this._PI180=Math.PI/180,this._barRect=cc.rect(0,0,0,0),this._origin=cc.p(0,0),this._radius=0,this._endAngle=this._startAngle=270,this._counterClockWise=!1
};var t=cc.ProgressTimer.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);t.constructor=cc.ProgressTimer.CanvasRenderCmd,t.rendering=function(t,e,i){t=t||cc._renderContext;var n=t.getContext(),r=this._node,o=r._sprite,s=o._renderCmd._textureCoord,c=o._renderCmd._displayedOpacity/255;if(0!==s.width&&0!==s.height&&o._texture&&s.validRect&&0!==c){t.setTransform(this._worldTransform,e,i),t.setCompositeOperation(o._blendFuncStr),t.setGlobalAlpha(c);var a=o._rect,l=o._offsetPosition,c=l.x,h=-l.y-a.height,u=a.width,a=a.height;t.save(),o._flippedX&&(c=-c-u,n.scale(-1,1)),o._flippedY&&(h=l.y,n.scale(1,-1)),r._type===cc.ProgressTimer.TYPE_BAR?(r=this._barRect,n.beginPath(),n.rect(r.x*e,r.y*i,r.width*e,r.height*i),n.clip(),n.closePath()):r._type===cc.ProgressTimer.TYPE_RADIAL&&(r=this._origin.x*e,l=this._origin.y*i,n.beginPath(),n.arc(r,l,this._radius*i,this._PI180*this._startAngle,this._PI180*this._endAngle,this._counterClockWise),n.lineTo(r,l),n.clip(),n.closePath()),r=o._texture.getHtmlElementObj(),o._renderCmd._colorized?n.drawImage(r,0,0,s.width,s.height,c*e,h*i,u*e,a*i):n.drawImage(r,s.renderX,s.renderY,s.width,s.height,c*e,h*i,u*e,a*i),t.restore(),cc.g_NumberOfDraws++}},t.releaseData=function(){},t.initCmd=function(){},t._updateProgress=function(){var t=this._node,e=t._sprite,i=e.width,n=e.height,r=t._midPoint;if(t._type===cc.ProgressTimer.TYPE_RADIAL){this._radius=Math.round(Math.sqrt(i*i+n*n));var o,s=!1,c=this._origin;c.x=i*r.x,c.y=-n*r.y,t._reverseDirection?(o=270,r=270-3.6*t._percentage):(r=-90,o=-90+3.6*t._percentage),e._flippedX&&(c.x-=2*i*t._midPoint.x,r=-r-180,o=-o-180,s=!s),e._flippedY&&(c.y+=2*n*t._midPoint.y,s=!s,r=-r,o=-o),this._startAngle=r,this._endAngle=o,this._counterClockWise=s}else s=t._barChangeRate,c=t._percentage/100,t=this._barRect,s=cc.size(i*(1-s.x),n*(1-s.y)),c=cc.size((i-s.width)*c,(n-s.height)*c),s=cc.size(s.width+c.width,s.height+c.height),o=cc.p(i*r.x,n*r.y),c=o.x-s.width/2,.5<r.x&&s.width/2>=i-o.x&&(c=i-s.width),i=o.y-s.height/2,.5<r.y&&s.height/2>=n-o.y&&(i=n-s.height),t.x=0,n=1,e._flippedX&&(t.x-=s.width,n=-1),c>0&&(t.x+=c*n),t.y=0,n=1,e._flippedY&&(t.y+=s.height,n=-1),i>0&&(t.y-=i*n),t.width=s.width,t.height=-s.height},t._updateColor=function(){},t._syncStatus=function(t){var e=this._node;if(e._sprite){var i=cc.Node._dirtyFlags,n=this._dirtyFlag,r=t?t._node:null;r&&r._cascadeColorEnabled&&t._dirtyFlag&i.colorDirty&&(n|=i.colorDirty),r&&r._cascadeOpacityEnabled&&t._dirtyFlag&i.opacityDirty&&(n|=i.opacityDirty),t&&t._dirtyFlag&i.transformDirty&&(n|=i.transformDirty),this._dirtyFlag=n;var e=e._sprite._renderCmd,o=e._dirtyFlag,r=o&i.colorDirty,o=o&i.opacityDirty;r&&e._syncDisplayColor(),o&&e._syncDisplayOpacity(),(r||o)&&e._updateColor(),n&i.transformDirty&&this.transform(t)}},t.updateStatus=function(){var t=this._node;if(t._sprite){var e=cc.Node._dirtyFlags,i=this._dirtyFlag,t=t._sprite._renderCmd,n=t._dirtyFlag,r=n&e.colorDirty,n=n&e.opacityDirty;r&&t._updateDisplayColor(),n&&t._updateDisplayOpacity(),(r||n)&&t._updateColor(),i&e.transformDirty&&this.transform(this.getParentRenderCmd(),!0),this._dirtyFlag=0}}}(),function(){cc.ProgressTimer.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._vertexWebGLBuffer=cc._renderContext.createBuffer(),this._vertexDataCount=0,this._vertexArrayBuffer=this._vertexData=null,this._vertexDataDirty=!1};var t=cc.ProgressTimer.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);t.constructor=cc.ProgressTimer.WebGLRenderCmd,t.rendering=function(t){var e=this._node;if(t=t||cc._renderContext,this._vertexData&&e._sprite){this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix);var i=e._sprite._blendFunc;cc.glBlendFunc(i.src,i.dst),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX),cc.glBindTexture2D(e._sprite.texture),t.bindBuffer(t.ARRAY_BUFFER,this._vertexWebGLBuffer),this._vertexDataDirty&&(t.bufferData(t.ARRAY_BUFFER,this._vertexArrayBuffer,t.DYNAMIC_DRAW),this._vertexDataDirty=!1),i=cc.V2F_C4B_T2F.BYTES_PER_ELEMENT,t.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,t.FLOAT,!1,i,0),t.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,t.UNSIGNED_BYTE,!0,i,8),t.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,t.FLOAT,!1,i,12),e._type===cc.ProgressTimer.TYPE_RADIAL?t.drawArrays(t.TRIANGLE_FAN,0,this._vertexDataCount):e._type===cc.ProgressTimer.TYPE_BAR&&(e._reverseDirection?(t.drawArrays(t.TRIANGLE_STRIP,0,this._vertexDataCount/2),t.drawArrays(t.TRIANGLE_STRIP,4,this._vertexDataCount/2),cc.g_NumberOfDraws++):t.drawArrays(t.TRIANGLE_STRIP,0,this._vertexDataCount)),cc.g_NumberOfDraws++}},t._syncStatus=function(t){var e=this._node;if(e._sprite){var i=cc.Node._dirtyFlags,n=this._dirtyFlag,r=t?t._node:null;r&&r._cascadeColorEnabled&&t._dirtyFlag&i.colorDirty&&(n|=i.colorDirty),r&&r._cascadeOpacityEnabled&&t._dirtyFlag&i.opacityDirty&&(n|=i.opacityDirty),t&&t._dirtyFlag&i.transformDirty&&(n|=i.transformDirty),this._dirtyFlag=n,e=e._sprite._renderCmd,r=e._dirtyFlag,n=r&i.colorDirty,i=r&i.opacityDirty,n&&e._syncDisplayColor(),i&&e._syncDisplayOpacity(),(n||i)&&(e._updateColor(),this._updateColor()),this.transform(t),e._dirtyFlag=0}},t.updateStatus=function(){var t=this._node;if(t._sprite){var e=cc.Node._dirtyFlags,i=this._dirtyFlag,t=t._sprite._renderCmd,n=t._dirtyFlag,r=n&e.colorDirty,n=n&e.opacityDirty;r&&(t._updateDisplayColor(),this._dirtyFlag^=this._dirtyFlag&e.colorDirty),n&&(t._updateDisplayOpacity(),this._dirtyFlag^=this._dirtyFlag&e.opacityDirty),(r||n)&&(t._updateColor(),this._updateColor()),i&e.transformDirty&&this.transform(this.getParentRenderCmd(),!0)}},t.releaseData=function(){this._vertexData&&(this._vertexArrayBuffer=this._vertexData=null,this._vertexDataCount=0)},t.initCmd=function(){this._vertexArrayBuffer=this._vertexData=null,this._vertexDataCount=0,this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURECOLOR)},t._updateProgress=function(){var t=this._node._type;t===cc.ProgressTimer.TYPE_RADIAL?this._updateRadial():t===cc.ProgressTimer.TYPE_BAR&&this._updateBar(),this._vertexDataDirty=!0},t._updateBar=function(){var t=this._node;if(t._sprite){var e,i=t._percentage/100;if(e=t._barChangeRate,e=cc.pMult(cc.p(1-e.x+i*e.x,1-e.y+i*e.y),.5),i=cc.pSub(t._midPoint,e),t=cc.pAdd(t._midPoint,e),0>i.x&&(t.x+=-i.x,i.x=0),1<t.x&&(i.x-=t.x-1,t.x=1),0>i.y&&(t.y+=-i.y,i.y=0),1<t.y&&(i.y-=t.y-1,t.y=1),this._reverseDirection){if(!this._vertexData){this._vertexDataCount=8;var n=cc.V2F_C4B_T2F.BYTES_PER_ELEMENT;this._vertexArrayBuffer=new ArrayBuffer(8*n);var r=[];for(e=0;8>e;e++)r[e]=new cc.V2F_C4B_T2F(null,null,null,this._vertexArrayBuffer,e*n);r[0].texCoords=this._textureCoordFromAlphaPoint(cc.p(0,1)),r[0].vertices=this._vertexFromAlphaPoint(cc.p(0,1)),r[1].texCoords=this._textureCoordFromAlphaPoint(cc.p(0,0)),r[1].vertices=this._vertexFromAlphaPoint(cc.p(0,0)),r[6].texCoords=this._textureCoordFromAlphaPoint(cc.p(1,1)),r[6].vertices=this._vertexFromAlphaPoint(cc.p(1,1)),r[7].texCoords=this._textureCoordFromAlphaPoint(cc.p(1,0)),r[7].vertices=this._vertexFromAlphaPoint(cc.p(1,0)),this._vertexData=r}e=this._vertexData,e[2].texCoords=this._textureCoordFromAlphaPoint(cc.p(i.x,t.y)),e[2].vertices=this._vertexFromAlphaPoint(cc.p(i.x,t.y)),e[3].texCoords=this._textureCoordFromAlphaPoint(cc.p(i.x,i.y)),e[3].vertices=this._vertexFromAlphaPoint(cc.p(i.x,i.y)),e[4].texCoords=this._textureCoordFromAlphaPoint(cc.p(t.x,t.y)),e[4].vertices=this._vertexFromAlphaPoint(cc.p(t.x,t.y)),e[5].texCoords=this._textureCoordFromAlphaPoint(cc.p(t.x,i.y)),e[5].vertices=this._vertexFromAlphaPoint(cc.p(t.x,i.y))}else{if(!this._vertexData)for(this._vertexDataCount=4,n=cc.V2F_C4B_T2F.BYTES_PER_ELEMENT,this._vertexArrayBuffer=new ArrayBuffer(4*n),this._vertexData=[],e=0;4>e;e++)this._vertexData[e]=new cc.V2F_C4B_T2F(null,null,null,this._vertexArrayBuffer,e*n);e=this._vertexData,e[0].texCoords=this._textureCoordFromAlphaPoint(cc.p(i.x,t.y)),e[0].vertices=this._vertexFromAlphaPoint(cc.p(i.x,t.y)),e[1].texCoords=this._textureCoordFromAlphaPoint(cc.p(i.x,i.y)),e[1].vertices=this._vertexFromAlphaPoint(cc.p(i.x,i.y)),e[2].texCoords=this._textureCoordFromAlphaPoint(cc.p(t.x,t.y)),e[2].vertices=this._vertexFromAlphaPoint(cc.p(t.x,t.y)),e[3].texCoords=this._textureCoordFromAlphaPoint(cc.p(t.x,i.y)),e[3].vertices=this._vertexFromAlphaPoint(cc.p(t.x,i.y))}this._updateColor()}},t._updateRadial=function(){var t=this._node;if(t._sprite){var e,i=t._midPoint;e=t._percentage/100;var n=2*cc.PI*(t._reverseDirection?e:1-e),t=cc.p(i.x,1),r=cc.pRotateByAngle(t,i,n),n=0;if(0===e)r=t,n=0;else if(1===e)r=t,n=4;else{var o=cc.FLT_MAX,s=cc.ProgressTimer.TEXTURE_COORDS_COUNT;for(e=0;s>=e;++e){var c=(e+(s-1))%s,a=this._boundaryTexCoord(e%s),c=this._boundaryTexCoord(c);0===e?c=cc.pLerp(a,c,1-i.x):4===e&&(a=cc.pLerp(a,c,1-i.x));var l=cc.p(0,0);cc.pLineIntersect(a,c,i,r,l)&&(0!==e&&4!==e||0<=l.x&&1>=l.x)&&0<=l.y&&l.y<o&&(o=l.y,n=e)}r=cc.pAdd(i,cc.pMult(cc.pSub(r,i),o))}if(o=!0,this._vertexDataCount!==n+3&&(o=!1,this._vertexArrayBuffer=this._vertexData=null,this._vertexDataCount=0),!this._vertexData){for(s=this._vertexDataCount=n+3,a=cc.V2F_C4B_T2F.BYTES_PER_ELEMENT,this._vertexArrayBuffer=new ArrayBuffer(s*a),c=[],e=0;s>e;e++)c[e]=new cc.V2F_C4B_T2F(null,null,null,this._vertexArrayBuffer,e*a);if(this._vertexData=c,!this._vertexData)return void cc.log("cc.ProgressTimer._updateRadial() : Not enough memory")}if(this._updateColor(),s=this._vertexData,!o)for(s[0].texCoords=this._textureCoordFromAlphaPoint(i),s[0].vertices=this._vertexFromAlphaPoint(i),s[1].texCoords=this._textureCoordFromAlphaPoint(t),s[1].vertices=this._vertexFromAlphaPoint(t),e=0;n>e;e++)i=this._boundaryTexCoord(e),s[e+2].texCoords=this._textureCoordFromAlphaPoint(i),s[e+2].vertices=this._vertexFromAlphaPoint(i);s[this._vertexDataCount-1].texCoords=this._textureCoordFromAlphaPoint(r),s[this._vertexDataCount-1].vertices=this._vertexFromAlphaPoint(r)}},t._boundaryTexCoord=function(t){if(t<cc.ProgressTimer.TEXTURE_COORDS_COUNT){var e=cc.ProgressTimer.TEXTURE_COORDS;return this._node._reverseDirection?cc.p(e>>7-(t<<1)&1,e>>7-((t<<1)+1)&1):cc.p(e>>(t<<1)+1&1,e>>(t<<1)&1)}return cc.p(0,0)},t._textureCoordFromAlphaPoint=function(t){var e=this._node._sprite;if(!e)return{u:0,v:0};var i=e.quad,n=cc.p(i.bl.texCoords.u,i.bl.texCoords.v),i=cc.p(i.tr.texCoords.u,i.tr.texCoords.v);return e.textureRectRotated&&(e=t.x,t.x=t.y,t.y=e),{u:n.x*(1-t.x)+i.x*t.x,v:n.y*(1-t.y)+i.y*t.y}},t._vertexFromAlphaPoint=function(t){var e=this._node._sprite;if(!e)return{x:0,y:0};var i=e.quad,e=cc.p(i.bl.vertices.x,i.bl.vertices.y),i=cc.p(i.tr.vertices.x,i.tr.vertices.y);return{x:e.x*(1-t.x)+i.x*t.x,y:e.y*(1-t.y)+i.y*t.y}},t._updateColor=function(){var t=this._node;if(t._sprite&&this._vertexData){for(var t=t._sprite.quad.tl.colors,e=this._vertexData,i=0,n=this._vertexDataCount;n>i;++i)e[i].colors=t;this._vertexDataDirty=!0}}}(),cc.SCENE_FADE=4208917214,cc.TRANSITION_ORIENTATION_LEFT_OVER=0,cc.TRANSITION_ORIENTATION_RIGHT_OVER=1,cc.TRANSITION_ORIENTATION_UP_OVER=0,cc.TRANSITION_ORIENTATION_DOWN_OVER=1,cc.TransitionScene=cc.Scene.extend({_inScene:null,_outScene:null,_duration:null,_isInSceneOnTop:!1,_isSendCleanupToScene:!1,_className:"TransitionScene",ctor:function(t,e){cc.Scene.prototype.ctor.call(this),void 0!==t&&void 0!==e&&this.initWithDuration(t,e)},_setNewScene:function(t){this.unschedule(this._setNewScene),t=cc.director,this._isSendCleanupToScene=t.isSendCleanupToScene(),t.runScene(this._inScene),cc.eventManager.setEnabled(!0),this._outScene.visible=!0},_sceneOrder:function(){this._isInSceneOnTop=!0},visit:function(){this._isInSceneOnTop?(this._outScene.visit(),this._inScene.visit()):(this._inScene.visit(),this._outScene.visit()),cc.Node.prototype.visit.call(this)},onEnter:function(){cc.Node.prototype.onEnter.call(this),cc.eventManager.setEnabled(!1),this._outScene.onExitTransitionDidStart(),this._inScene.onEnter()},onExit:function(){cc.Node.prototype.onExit.call(this),cc.eventManager.setEnabled(!0),this._outScene.onExit(),this._inScene.onEnterTransitionDidFinish()},cleanup:function(){cc.Node.prototype.cleanup.call(this),this._isSendCleanupToScene&&this._outScene.cleanup()},initWithDuration:function(t,e){if(!e)throw"cc.TransitionScene.initWithDuration(): Argument scene must be non-nil";if(this.init()){if(this._duration=t,this.attr({x:0,y:0,anchorX:0,anchorY:0}),this._inScene=e,this._outScene=cc.director.getRunningScene(),this._outScene||(this._outScene=new cc.Scene,this._outScene.init()),this._inScene===this._outScene)throw"cc.TransitionScene.initWithDuration(): Incoming scene must be different from the outgoing scene";return this._sceneOrder(),!0}return!1},finish:function(){this._inScene.attr({visible:!0,x:0,y:0,scale:1,rotation:0}),cc._renderType===cc._RENDER_TYPE_WEBGL&&this._inScene.getCamera().restore(),this._outScene.attr({visible:!1,x:0,y:0,scale:1,rotation:0}),cc._renderType===cc._RENDER_TYPE_WEBGL&&this._outScene.getCamera().restore(),this.schedule(this._setNewScene,0)},hideOutShowIn:function(){this._inScene.visible=!0,this._outScene.visible=!1}}),cc.TransitionScene.create=function(t,e){return new cc.TransitionScene(t,e)},cc.TransitionSceneOriented=cc.TransitionScene.extend({_orientation:0,ctor:function(t,e,i){cc.TransitionScene.prototype.ctor.call(this),void 0!=i&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){return cc.TransitionScene.prototype.initWithDuration.call(this,t,e)&&(this._orientation=i),!0}}),cc.TransitionSceneOriented.create=function(t,e,i){return new cc.TransitionSceneOriented(t,e,i)},cc.TransitionRotoZoom=cc.TransitionScene.extend({ctor:function(t,e){cc.TransitionScene.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this),this._inScene.attr({scale:.001,anchorX:.5,anchorY:.5}),this._outScene.attr({scale:1,anchorX:.5,anchorY:.5});var t=cc.sequence(cc.spawn(cc.scaleBy(this._duration/2,.001),cc.rotateBy(this._duration/2,720)),cc.delayTime(this._duration/2));this._outScene.runAction(t),this._inScene.runAction(cc.sequence(t.reverse(),cc.callFunc(this.finish,this)))}}),cc.TransitionRotoZoom.create=function(t,e){return new cc.TransitionRotoZoom(t,e)},cc.TransitionJumpZoom=cc.TransitionScene.extend({ctor:function(t,e){cc.TransitionScene.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);var t=cc.director.getWinSize();this._inScene.attr({scale:.5,x:t.width,y:0,anchorX:.5,anchorY:.5}),this._outScene.anchorX=.5,this._outScene.anchorY=.5;var e=cc.jumpBy(this._duration/4,cc.p(-t.width,0),t.width/4,2),i=cc.scaleTo(this._duration/4,1),t=cc.scaleTo(this._duration/4,.5),t=cc.sequence(t,e),e=cc.sequence(e,i),i=cc.delayTime(this._duration/2);this._outScene.runAction(t),this._inScene.runAction(cc.sequence(i,e,cc.callFunc(this.finish,this)))}}),cc.TransitionJumpZoom.create=function(t,e){return new cc.TransitionJumpZoom(t,e)},cc.TransitionMoveInL=cc.TransitionScene.extend({ctor:function(t,e){cc.TransitionScene.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this),this.initScenes();var t=this.action();this._inScene.runAction(cc.sequence(this.easeActionWithAction(t),cc.callFunc(this.finish,this)))},initScenes:function(){this._inScene.setPosition(-cc.director.getWinSize().width,0)},action:function(){return cc.moveTo(this._duration,cc.p(0,0))},easeActionWithAction:function(t){return new cc.EaseOut(t,2)}}),cc.TransitionMoveInL.create=function(t,e){return new cc.TransitionMoveInL(t,e)},cc.TransitionMoveInR=cc.TransitionMoveInL.extend({ctor:function(t,e){cc.TransitionMoveInL.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},initScenes:function(){this._inScene.setPosition(cc.director.getWinSize().width,0)}}),cc.TransitionMoveInR.create=function(t,e){return new cc.TransitionMoveInR(t,e)},cc.TransitionMoveInT=cc.TransitionMoveInL.extend({ctor:function(t,e){cc.TransitionMoveInL.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},initScenes:function(){this._inScene.setPosition(0,cc.director.getWinSize().height)}}),cc.TransitionMoveInT.create=function(t,e){return new cc.TransitionMoveInT(t,e)},cc.TransitionMoveInB=cc.TransitionMoveInL.extend({ctor:function(t,e){cc.TransitionMoveInL.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},initScenes:function(){this._inScene.setPosition(0,-cc.director.getWinSize().height)}}),cc.TransitionMoveInB.create=function(t,e){return new cc.TransitionMoveInB(t,e)},cc.ADJUST_FACTOR=.5,cc.TransitionSlideInL=cc.TransitionScene.extend({ctor:function(t,e){cc.TransitionScene.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},_sceneOrder:function(){this._isInSceneOnTop=!1},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this),this.initScenes();var t=this.action(),e=this.action(),t=cc.sequence(this.easeActionWithAction(t),cc.callFunc(this.finish,this)),e=this.easeActionWithAction(e);this._inScene.runAction(t),this._outScene.runAction(e)},initScenes:function(){this._inScene.setPosition(-cc.director.getWinSize().width+cc.ADJUST_FACTOR,0)},action:function(){return cc.moveBy(this._duration,cc.p(cc.director.getWinSize().width-cc.ADJUST_FACTOR,0))},easeActionWithAction:function(t){return new cc.EaseInOut(t,2)}}),cc.TransitionSlideInL.create=function(t,e){return new cc.TransitionSlideInL(t,e)},cc.TransitionSlideInR=cc.TransitionSlideInL.extend({ctor:function(t,e){cc.TransitionSlideInL.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},_sceneOrder:function(){this._isInSceneOnTop=!0},initScenes:function(){this._inScene.setPosition(cc.director.getWinSize().width-cc.ADJUST_FACTOR,0)},action:function(){return cc.moveBy(this._duration,cc.p(-(cc.director.getWinSize().width-cc.ADJUST_FACTOR),0))}}),cc.TransitionSlideInR.create=function(t,e){return new cc.TransitionSlideInR(t,e)},cc.TransitionSlideInB=cc.TransitionSlideInL.extend({ctor:function(t,e){cc.TransitionSlideInL.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},_sceneOrder:function(){this._isInSceneOnTop=!1},initScenes:function(){this._inScene.setPosition(0,-(cc.director.getWinSize().height-cc.ADJUST_FACTOR))},action:function(){return cc.moveBy(this._duration,cc.p(0,cc.director.getWinSize().height-cc.ADJUST_FACTOR))}}),cc.TransitionSlideInB.create=function(t,e){return new cc.TransitionSlideInB(t,e)},cc.TransitionSlideInT=cc.TransitionSlideInL.extend({ctor:function(t,e){cc.TransitionSlideInL.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},_sceneOrder:function(){this._isInSceneOnTop=!0},initScenes:function(){this._inScene.setPosition(0,cc.director.getWinSize().height-cc.ADJUST_FACTOR)},action:function(){return cc.moveBy(this._duration,cc.p(0,-(cc.director.getWinSize().height-cc.ADJUST_FACTOR)))}}),cc.TransitionSlideInT.create=function(t,e){return new cc.TransitionSlideInT(t,e)},cc.TransitionShrinkGrow=cc.TransitionScene.extend({ctor:function(t,e){cc.TransitionScene.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this),this._inScene.attr({scale:.001,anchorX:2/3,anchorY:.5}),this._outScene.attr({scale:1,anchorX:1/3,anchorY:.5});var t=cc.scaleTo(this._duration,.01),e=cc.scaleTo(this._duration,1);this._inScene.runAction(cc.sequence(this.easeActionWithAction(e),cc.callFunc(this.finish,this))),this._outScene.runAction(this.easeActionWithAction(t))},easeActionWithAction:function(t){return new cc.EaseOut(t,2)}}),cc.TransitionShrinkGrow.create=function(t,e){return new cc.TransitionShrinkGrow(t,e)},cc.TransitionFlipX=cc.TransitionSceneOriented.extend({ctor:function(t,e,i){cc.TransitionSceneOriented.prototype.ctor.call(this),null==i&&(i=cc.TRANSITION_ORIENTATION_RIGHT_OVER),e&&this.initWithDuration(t,e,i)},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);var t,e;this._inScene.visible=!1;var i;this._orientation===cc.TRANSITION_ORIENTATION_RIGHT_OVER?(t=90,i=270,e=90):(t=-90,i=90,e=-90),t=cc.sequence(cc.delayTime(this._duration/2),cc.show(),cc.orbitCamera(this._duration/2,1,0,i,t,0,0),cc.callFunc(this.finish,this)),e=cc.sequence(cc.orbitCamera(this._duration/2,1,0,0,e,0,0),cc.hide(),cc.delayTime(this._duration/2)),this._inScene.runAction(t),this._outScene.runAction(e)}}),cc.TransitionFlipX.create=function(t,e,i){return new cc.TransitionFlipX(t,e,i)},cc.TransitionFlipY=cc.TransitionSceneOriented.extend({ctor:function(t,e,i){cc.TransitionSceneOriented.prototype.ctor.call(this),null==i&&(i=cc.TRANSITION_ORIENTATION_UP_OVER),e&&this.initWithDuration(t,e,i)},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);var t,e;this._inScene.visible=!1;var i;this._orientation===cc.TRANSITION_ORIENTATION_UP_OVER?(t=90,i=270,e=90):(t=-90,i=90,e=-90),t=cc.sequence(cc.delayTime(this._duration/2),cc.show(),cc.orbitCamera(this._duration/2,1,0,i,t,90,0),cc.callFunc(this.finish,this)),e=cc.sequence(cc.orbitCamera(this._duration/2,1,0,0,e,90,0),cc.hide(),cc.delayTime(this._duration/2)),this._inScene.runAction(t),this._outScene.runAction(e)}}),cc.TransitionFlipY.create=function(t,e,i){return new cc.TransitionFlipY(t,e,i)},cc.TransitionFlipAngular=cc.TransitionSceneOriented.extend({ctor:function(t,e,i){cc.TransitionSceneOriented.prototype.ctor.call(this),null==i&&(i=cc.TRANSITION_ORIENTATION_RIGHT_OVER),e&&this.initWithDuration(t,e,i)},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);var t,e;this._inScene.visible=!1;var i;this._orientation===cc.TRANSITION_ORIENTATION_RIGHT_OVER?(t=90,i=270,e=90):(t=-90,i=90,e=-90),t=cc.sequence(cc.delayTime(this._duration/2),cc.show(),cc.orbitCamera(this._duration/2,1,0,i,t,-45,0),cc.callFunc(this.finish,this)),e=cc.sequence(cc.orbitCamera(this._duration/2,1,0,0,e,45,0),cc.hide(),cc.delayTime(this._duration/2)),this._inScene.runAction(t),this._outScene.runAction(e)}}),cc.TransitionFlipAngular.create=function(t,e,i){return new cc.TransitionFlipAngular(t,e,i)},cc.TransitionZoomFlipX=cc.TransitionSceneOriented.extend({ctor:function(t,e,i){cc.TransitionSceneOriented.prototype.ctor.call(this),null==i&&(i=cc.TRANSITION_ORIENTATION_RIGHT_OVER),e&&this.initWithDuration(t,e,i)},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);var t,e;this._inScene.visible=!1;var i;this._orientation===cc.TRANSITION_ORIENTATION_RIGHT_OVER?(t=90,i=270,e=90):(t=-90,i=90,e=-90),t=cc.sequence(cc.delayTime(this._duration/2),cc.spawn(cc.orbitCamera(this._duration/2,1,0,i,t,0,0),cc.scaleTo(this._duration/2,1),cc.show()),cc.callFunc(this.finish,this)),e=cc.sequence(cc.spawn(cc.orbitCamera(this._duration/2,1,0,0,e,0,0),cc.scaleTo(this._duration/2,.5)),cc.hide(),cc.delayTime(this._duration/2)),this._inScene.scale=.5,this._inScene.runAction(t),this._outScene.runAction(e)}}),cc.TransitionZoomFlipX.create=function(t,e,i){return new cc.TransitionZoomFlipX(t,e,i)},cc.TransitionZoomFlipY=cc.TransitionSceneOriented.extend({ctor:function(t,e,i){cc.TransitionSceneOriented.prototype.ctor.call(this),null==i&&(i=cc.TRANSITION_ORIENTATION_UP_OVER),e&&this.initWithDuration(t,e,i)},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);var t,e;this._inScene.visible=!1;var i;this._orientation===cc.TRANSITION_ORIENTATION_UP_OVER?(t=90,i=270,e=90):(t=-90,i=90,e=-90),t=cc.sequence(cc.delayTime(this._duration/2),cc.spawn(cc.orbitCamera(this._duration/2,1,0,i,t,90,0),cc.scaleTo(this._duration/2,1),cc.show()),cc.callFunc(this.finish,this)),e=cc.sequence(cc.spawn(cc.orbitCamera(this._duration/2,1,0,0,e,90,0),cc.scaleTo(this._duration/2,.5)),cc.hide(),cc.delayTime(this._duration/2)),this._inScene.scale=.5,this._inScene.runAction(t),this._outScene.runAction(e)}}),cc.TransitionZoomFlipY.create=function(t,e,i){return new cc.TransitionZoomFlipY(t,e,i)},cc.TransitionZoomFlipAngular=cc.TransitionSceneOriented.extend({ctor:function(t,e,i){cc.TransitionSceneOriented.prototype.ctor.call(this),null==i&&(i=cc.TRANSITION_ORIENTATION_RIGHT_OVER),e&&this.initWithDuration(t,e,i)},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);var t,e;this._inScene.visible=!1;var i;this._orientation===cc.TRANSITION_ORIENTATION_RIGHT_OVER?(t=90,i=270,e=90):(t=-90,i=90,e=-90),t=cc.sequence(cc.delayTime(this._duration/2),cc.spawn(cc.orbitCamera(this._duration/2,1,0,i,t,-45,0),cc.scaleTo(this._duration/2,1),cc.show()),cc.show(),cc.callFunc(this.finish,this)),e=cc.sequence(cc.spawn(cc.orbitCamera(this._duration/2,1,0,0,e,45,0),cc.scaleTo(this._duration/2,.5)),cc.hide(),cc.delayTime(this._duration/2)),this._inScene.scale=.5,this._inScene.runAction(t),this._outScene.runAction(e)}}),cc.TransitionZoomFlipAngular.create=function(t,e,i){return new cc.TransitionZoomFlipAngular(t,e,i)},cc.TransitionFade=cc.TransitionScene.extend({_color:null,ctor:function(t,e,i){cc.TransitionScene.prototype.ctor.call(this),this._color=cc.color(),e&&this.initWithDuration(t,e,i)},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);var t=new cc.LayerColor(this._color);this._inScene.visible=!1,this.addChild(t,2,cc.SCENE_FADE);var t=this.getChildByTag(cc.SCENE_FADE),e=cc.sequence(cc.fadeIn(this._duration/2),cc.callFunc(this.hideOutShowIn,this),cc.fadeOut(this._duration/2),cc.callFunc(this.finish,this));t.runAction(e)},onExit:function(){cc.TransitionScene.prototype.onExit.call(this),this.removeChildByTag(cc.SCENE_FADE,!1)},initWithDuration:function(t,e,i){return i=i||cc.color.BLACK,cc.TransitionScene.prototype.initWithDuration.call(this,t,e)&&(this._color.r=i.r,this._color.g=i.g,this._color.b=i.b,this._color.a=0),!0}}),cc.TransitionFade.create=function(t,e,i){return new cc.TransitionFade(t,e,i)},cc.TransitionCrossFade=cc.TransitionScene.extend({ctor:function(t,e){cc.TransitionScene.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);var t=cc.color(0,0,0,0),e=cc.director.getWinSize(),t=new cc.LayerColor(t),i=new cc.RenderTexture(e.width,e.height);i.sprite.anchorX=.5,i.sprite.anchorY=.5,i.attr({x:e.width/2,y:e.height/2,anchorX:.5,anchorY:.5}),i.begin(),this._inScene.visit(),i.end();var n=new cc.RenderTexture(e.width,e.height);n.setPosition(e.width/2,e.height/2),n.sprite.anchorX=n.anchorX=.5,n.sprite.anchorY=n.anchorY=.5,n.begin(),this._outScene.visit(),n.end(),i.sprite.setBlendFunc(cc.ONE,cc.ONE),n.sprite.setBlendFunc(cc.SRC_ALPHA,cc.ONE_MINUS_SRC_ALPHA),t.addChild(i),t.addChild(n),i.sprite.opacity=255,n.sprite.opacity=255,e=cc.sequence(cc.fadeTo(this._duration,0),cc.callFunc(this.hideOutShowIn,this),cc.callFunc(this.finish,this)),n.sprite.runAction(e),this.addChild(t,2,cc.SCENE_FADE)},onExit:function(){this.removeChildByTag(cc.SCENE_FADE,!1),cc.TransitionScene.prototype.onExit.call(this)},visit:function(){cc.Node.prototype.visit.call(this)},draw:function(){}}),cc.TransitionCrossFade.create=function(t,e){return new cc.TransitionCrossFade(t,e)},cc.TransitionTurnOffTiles=cc.TransitionScene.extend({_gridProxy:null,ctor:function(t,e){cc.TransitionScene.prototype.ctor.call(this),this._gridProxy=new cc.NodeGrid,e&&this.initWithDuration(t,e)},_sceneOrder:function(){this._isInSceneOnTop=!1},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this),this._gridProxy.setTarget(this._outScene),this._gridProxy.onEnter();var t=cc.director.getWinSize(),t=cc.turnOffTiles(this._duration,cc.size(0|t.width/t.height*12,12)),t=this.easeActionWithAction(t);this._gridProxy.runAction(cc.sequence(t,cc.callFunc(this.finish,this),cc.stopGrid()))},visit:function(){this._inScene.visit(),this._gridProxy.visit()},easeActionWithAction:function(t){return t}}),cc.TransitionTurnOffTiles.create=function(t,e){return new cc.TransitionTurnOffTiles(t,e)},cc.TransitionSplitCols=cc.TransitionScene.extend({_gridProxy:null,_switchTargetToInscene:function(){this._gridProxy.setTarget(this._inScene)},ctor:function(t,e){cc.TransitionScene.prototype.ctor.call(this),this._gridProxy=new cc.NodeGrid,e&&this.initWithDuration(t,e)},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this),this._gridProxy.setTarget(this._outScene),this._gridProxy.onEnter();var t=this.action(),t=cc.sequence(t,cc.callFunc(this._switchTargetToInscene,this),t.reverse());this._gridProxy.runAction(cc.sequence(this.easeActionWithAction(t),cc.callFunc(this.finish,this),cc.stopGrid()))},onExit:function(){this._gridProxy.setTarget(null),this._gridProxy.onExit(),cc.TransitionScene.prototype.onExit.call(this)},visit:function(){this._gridProxy.visit()},easeActionWithAction:function(t){return new cc.EaseInOut(t,3)},action:function(){return cc.splitCols(this._duration/2,3)}}),cc.TransitionSplitCols.create=function(t,e){return new cc.TransitionSplitCols(t,e)},cc.TransitionSplitRows=cc.TransitionSplitCols.extend({ctor:function(t,e){cc.TransitionSplitCols.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},action:function(){return cc.splitRows(this._duration/2,3)}}),cc.TransitionSplitRows.create=function(t,e){return new cc.TransitionSplitRows(t,e)},cc.TransitionFadeTR=cc.TransitionScene.extend({_gridProxy:null,ctor:function(t,e){cc.TransitionScene.prototype.ctor.call(this),this._gridProxy=new cc.NodeGrid,e&&this.initWithDuration(t,e)},_sceneOrder:function(){this._isInSceneOnTop=!1},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this),this._gridProxy.setTarget(this._outScene),this._gridProxy.onEnter();var t=cc.director.getWinSize(),t=this.actionWithSize(cc.size(0|t.width/t.height*12,12));this._gridProxy.runAction(cc.sequence(this.easeActionWithAction(t),cc.callFunc(this.finish,this),cc.stopGrid()))},visit:function(){this._inScene.visit(),this._gridProxy.visit()},easeActionWithAction:function(t){return t},actionWithSize:function(t){return cc.fadeOutTRTiles(this._duration,t)}}),cc.TransitionFadeTR.create=function(t,e){return new cc.TransitionFadeTR(t,e)},cc.TransitionFadeBL=cc.TransitionFadeTR.extend({ctor:function(t,e){cc.TransitionFadeTR.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},actionWithSize:function(t){return cc.fadeOutBLTiles(this._duration,t)}}),cc.TransitionFadeBL.create=function(t,e){return new cc.TransitionFadeBL(t,e)},cc.TransitionFadeUp=cc.TransitionFadeTR.extend({ctor:function(t,e){cc.TransitionFadeTR.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},actionWithSize:function(t){return new cc.FadeOutUpTiles(this._duration,t)}}),cc.TransitionFadeUp.create=function(t,e){return new cc.TransitionFadeUp(t,e)},cc.TransitionFadeDown=cc.TransitionFadeTR.extend({ctor:function(t,e){cc.TransitionFadeTR.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},actionWithSize:function(t){return cc.fadeOutDownTiles(this._duration,t)}}),cc.TransitionFadeDown.create=function(t,e){return new cc.TransitionFadeDown(t,e)},cc.SCENE_RADIAL=49153,cc.TransitionProgress=cc.TransitionScene.extend({_to:0,_from:0,_sceneToBeModified:null,_className:"TransitionProgress",ctor:function(t,e){cc.TransitionScene.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},_setAttrs:function(t,e,i){t.attr({x:e,y:i,anchorX:.5,anchorY:.5})},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this),this._setupTransition();var t=cc.director.getWinSize(),e=new cc.RenderTexture(t.width,t.height);e.sprite.anchorX=.5,e.sprite.anchorY=.5,this._setAttrs(e,t.width/2,t.height/2),e.clear(0,0,0,1),e.begin(),this._sceneToBeModified.visit(),e.end(),this._sceneToBeModified===this._outScene&&this.hideOutShowIn(),t=this._progressTimerNodeWithRenderTexture(e),e=cc.sequence(cc.progressFromTo(this._duration,this._from,this._to),cc.callFunc(this.finish,this)),t.runAction(e),this.addChild(t,2,cc.SCENE_RADIAL)},onExit:function(){this.removeChildByTag(cc.SCENE_RADIAL,!0),cc.TransitionScene.prototype.onExit.call(this)},_setupTransition:function(){this._sceneToBeModified=this._outScene,this._from=100,this._to=0},_progressTimerNodeWithRenderTexture:function(){return cc.log("cc.TransitionProgress._progressTimerNodeWithRenderTexture(): should be overridden in subclass"),null},_sceneOrder:function(){this._isInSceneOnTop=!1}}),cc.TransitionProgress.create=function(t,e){return new cc.TransitionProgress(t,e)},cc.TransitionProgressRadialCCW=cc.TransitionProgress.extend({ctor:function(t,e){cc.TransitionProgress.prototype.ctor.call(this),e&&this.initWithDuration(t,e)
},_progressTimerNodeWithRenderTexture:function(t){var e=cc.director.getWinSize();return t=new cc.ProgressTimer(t.sprite),cc._renderType===cc._RENDER_TYPE_WEBGL&&(t.sprite.flippedY=!0),t.type=cc.ProgressTimer.TYPE_RADIAL,t.reverseDir=!1,t.percentage=100,this._setAttrs(t,e.width/2,e.height/2),t}}),cc.TransitionProgressRadialCCW.create=function(t,e){return new cc.TransitionProgressRadialCCW(t,e)},cc.TransitionProgressRadialCW=cc.TransitionProgress.extend({ctor:function(t,e){cc.TransitionProgress.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},_progressTimerNodeWithRenderTexture:function(t){var e=cc.director.getWinSize();return t=new cc.ProgressTimer(t.sprite),cc._renderType===cc._RENDER_TYPE_WEBGL&&(t.sprite.flippedY=!0),t.type=cc.ProgressTimer.TYPE_RADIAL,t.reverseDir=!0,t.percentage=100,this._setAttrs(t,e.width/2,e.height/2),t}}),cc.TransitionProgressRadialCW.create=function(t,e){var i=new cc.TransitionProgressRadialCW;return null!==i&&i.initWithDuration(t,e)?i:new cc.TransitionProgressRadialCW(t,e)},cc.TransitionProgressHorizontal=cc.TransitionProgress.extend({ctor:function(t,e){cc.TransitionProgress.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},_progressTimerNodeWithRenderTexture:function(t){var e=cc.director.getWinSize();return t=new cc.ProgressTimer(t.sprite),cc._renderType===cc._RENDER_TYPE_WEBGL&&(t.sprite.flippedY=!0),t.type=cc.ProgressTimer.TYPE_BAR,t.midPoint=cc.p(1,0),t.barChangeRate=cc.p(1,0),t.percentage=100,this._setAttrs(t,e.width/2,e.height/2),t}}),cc.TransitionProgressHorizontal.create=function(t,e){return new cc.TransitionProgressHorizontal(t,e)},cc.TransitionProgressVertical=cc.TransitionProgress.extend({ctor:function(t,e){cc.TransitionProgress.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},_progressTimerNodeWithRenderTexture:function(t){var e=cc.director.getWinSize();return t=new cc.ProgressTimer(t.sprite),cc._renderType===cc._RENDER_TYPE_WEBGL&&(t.sprite.flippedY=!0),t.type=cc.ProgressTimer.TYPE_BAR,t.midPoint=cc.p(0,0),t.barChangeRate=cc.p(0,1),t.percentage=100,this._setAttrs(t,e.width/2,e.height/2),t}}),cc.TransitionProgressVertical.create=function(t,e){return new cc.TransitionProgressVertical(t,e)},cc.TransitionProgressInOut=cc.TransitionProgress.extend({ctor:function(t,e){cc.TransitionProgress.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},_progressTimerNodeWithRenderTexture:function(t){var e=cc.director.getWinSize();return t=new cc.ProgressTimer(t.sprite),cc._renderType===cc._RENDER_TYPE_WEBGL&&(t.sprite.flippedY=!0),t.type=cc.ProgressTimer.TYPE_BAR,t.midPoint=cc.p(.5,.5),t.barChangeRate=cc.p(1,1),t.percentage=0,this._setAttrs(t,e.width/2,e.height/2),t},_sceneOrder:function(){this._isInSceneOnTop=!1},_setupTransition:function(){this._sceneToBeModified=this._inScene,this._from=0,this._to=100}}),cc.TransitionProgressInOut.create=function(t,e){return new cc.TransitionProgressInOut(t,e)},cc.TransitionProgressOutIn=cc.TransitionProgress.extend({ctor:function(t,e){cc.TransitionProgress.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},_progressTimerNodeWithRenderTexture:function(t){var e=cc.director.getWinSize();return t=new cc.ProgressTimer(t.sprite),cc._renderType===cc._RENDER_TYPE_WEBGL&&(t.sprite.flippedY=!0),t.type=cc.ProgressTimer.TYPE_BAR,t.midPoint=cc.p(.5,.5),t.barChangeRate=cc.p(1,1),t.percentage=100,this._setAttrs(t,e.width/2,e.height/2),t}}),cc.TransitionProgressOutIn.create=function(t,e){return new cc.TransitionProgressOutIn(t,e)},cc.TransitionPageTurn=cc.TransitionScene.extend({ctor:function(t,e,i){cc.TransitionScene.prototype.ctor.call(this),this._gridProxy=new cc.NodeGrid,this.initWithDuration(t,e,i)},_back:!0,_gridProxy:null,_className:"TransitionPageTurn",initWithDuration:function(t,e,i){return this._back=i,cc.TransitionScene.prototype.initWithDuration.call(this,t,e),!0},actionWithSize:function(t){return this._back?cc.reverseTime(cc.pageTurn3D(this._duration,t)):cc.pageTurn3D(this._duration,t)},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);var t,e=cc.director.getWinSize();e.width>e.height?(e=16,t=12):(e=12,t=16),e=this.actionWithSize(cc.size(e,t)),t=this._gridProxy,this._back?(t.setTarget(this._inScene),t.onEnter(),this._inScene.visible=!1,t.runAction(cc.sequence(e,cc.callFunc(this.finish,this),cc.stopGrid())),this._inScene.runAction(cc.show())):(t.setTarget(this._outScene),t.onEnter(),t.runAction(cc.sequence(e,cc.callFunc(this.finish,this),cc.stopGrid())))},visit:function(){this._back?this._outScene.visit():this._inScene.visit(),this._gridProxy.visit()},_sceneOrder:function(){this._isInSceneOnTop=this._back}}),cc.TransitionPageTurn.create=function(t,e,i){return new cc.TransitionPageTurn(t,e,i)},cc.Codec={name:"Jacob__Codec"},cc.unzip=function(){return cc.Codec.GZip.gunzip.apply(cc.Codec.GZip,arguments)},cc.unzipBase64=function(){var t=cc.Codec.Base64.decode.apply(cc.Codec.Base64,arguments);return cc.Codec.GZip.gunzip.apply(cc.Codec.GZip,[t])},cc.unzipBase64AsArray=function(t,e){e=e||1;var i,n,r,o=this.unzipBase64(t),s=[];for(i=0,r=o.length/e;r>i;i++)for(s[i]=0,n=e-1;n>=0;--n)s[i]+=o.charCodeAt(i*e+n)<<8*n;return s},cc.unzipAsArray=function(t,e){e=e||1;var i,n,r,o=this.unzip(t),s=[];for(i=0,r=o.length/e;r>i;i++)for(s[i]=0,n=e-1;n>=0;--n)s[i]+=o.charCodeAt(i*e+n)<<8*n;return s},cc.StringToArray=function(t){t=t.split(",");var e,i=[];for(e=0;e<t.length;e++)i.push(parseInt(t[e]));return i},cc.Codec.Base64={name:"Jacob__Codec__Base64"},cc.Codec.Base64._keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",cc.Codec.Base64.decode=function(t){var e,i,n,r,o,s=[],c=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");c<t.length;)e=this._keyStr.indexOf(t.charAt(c++)),i=this._keyStr.indexOf(t.charAt(c++)),r=this._keyStr.indexOf(t.charAt(c++)),o=this._keyStr.indexOf(t.charAt(c++)),e=e<<2|i>>4,i=(15&i)<<4|r>>2,n=(3&r)<<6|o,s.push(String.fromCharCode(e)),64!==r&&s.push(String.fromCharCode(i)),64!==o&&s.push(String.fromCharCode(n));return s=s.join("")},cc.Codec.Base64.decodeAsArray=function(t,e){var i,n,r,o=this.decode(t),s=[];for(i=0,r=o.length/e;r>i;i++)for(s[i]=0,n=e-1;n>=0;--n)s[i]+=o.charCodeAt(i*e+n)<<8*n;return s},cc.uint8ArrayToUint32Array=function(t){if(0!==t.length%4)return null;for(var e=t.length/4,i=window.Uint32Array?new Uint32Array(e):[],n=0;e>n;n++){var r=4*n;i[n]=t[r]+256*t[r+1]+65536*t[r+2]+16777216*t[r+3]}return i},cc.Codec.GZip=function(t){this.data=t,this.debug=!1,this.gpflags=void 0,this.files=0,this.unzipped=[],this.buf32k=Array(32768),this.bIdx=0,this.modeZIP=!1,this.bytepos=0,this.bb=1,this.bits=0,this.nameBuf=[],this.fileout=void 0,this.literalTree=Array(cc.Codec.GZip.LITERALS),this.distanceTree=Array(32),this.treepos=0,this.Places=null,this.len=0,this.fpos=Array(17),this.fpos[0]=0,this.fmax=this.flens=void 0},cc.Codec.GZip.gunzip=function(t){return new cc.Codec.GZip(t).gunzip()[0][0]},cc.Codec.GZip.HufNode=function(){this.b1=this.b0=0,this.jump=null,this.jumppos=-1},cc.Codec.GZip.LITERALS=288,cc.Codec.GZip.NAMEMAX=256,cc.Codec.GZip.bitReverse=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254,1,129,65,193,33,161,97,225,17,145,81,209,49,177,113,241,9,137,73,201,41,169,105,233,25,153,89,217,57,185,121,249,5,133,69,197,37,165,101,229,21,149,85,213,53,181,117,245,13,141,77,205,45,173,109,237,29,157,93,221,61,189,125,253,3,131,67,195,35,163,99,227,19,147,83,211,51,179,115,243,11,139,75,203,43,171,107,235,27,155,91,219,59,187,123,251,7,135,71,199,39,167,103,231,23,151,87,215,55,183,119,247,15,143,79,207,47,175,111,239,31,159,95,223,63,191,127,255],cc.Codec.GZip.cplens=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],cc.Codec.GZip.cplext=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99],cc.Codec.GZip.cpdist=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],cc.Codec.GZip.cpdext=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],cc.Codec.GZip.border=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],cc.Codec.GZip.prototype.gunzip=function(){return this.outputArr=[],this.nextFile(),this.unzipped},cc.Codec.GZip.prototype.readByte=function(){return this.bits+=8,this.bytepos<this.data.length?this.data.charCodeAt(this.bytepos++):-1},cc.Codec.GZip.prototype.byteAlign=function(){this.bb=1},cc.Codec.GZip.prototype.readBit=function(){var t;return this.bits++,t=1&this.bb,this.bb>>=1,0===this.bb&&(this.bb=this.readByte(),t=1&this.bb,this.bb=this.bb>>1|128),t},cc.Codec.GZip.prototype.readBits=function(t){for(var e=0,i=t;i--;)e=e<<1|this.readBit();return t&&(e=cc.Codec.GZip.bitReverse[e]>>8-t),e},cc.Codec.GZip.prototype.flushBuffer=function(){this.bIdx=0},cc.Codec.GZip.prototype.addBuffer=function(t){this.buf32k[this.bIdx++]=t,this.outputArr.push(String.fromCharCode(t)),32768===this.bIdx&&(this.bIdx=0)},cc.Codec.GZip.prototype.IsPat=function(){for(;;){if(this.fpos[this.len]>=this.fmax)return-1;if(this.flens[this.fpos[this.len]]===this.len)return this.fpos[this.len]++;this.fpos[this.len]++}},cc.Codec.GZip.prototype.Rec=function(){var t,e=this.Places[this.treepos];if(17===this.len)return-1;if(this.treepos++,this.len++,t=this.IsPat(),t>=0)e.b0=t;else if(e.b0=32768,this.Rec())return-1;if(t=this.IsPat(),t>=0)e.b1=t,e.jump=null;else if(e.b1=32768,e.jump=this.Places[this.treepos],e.jumppos=this.treepos,this.Rec())return-1;return this.len--,0},cc.Codec.GZip.prototype.CreateTree=function(t,e,i){for(this.Places=t,this.treepos=0,this.flens=i,this.fmax=e,t=0;17>t;t++)this.fpos[t]=0;return this.len=0,this.Rec()?-1:0},cc.Codec.GZip.prototype.DecodeValue=function(t){for(var e,i,n=0,r=t[n];;)if(e=this.readBit()){if(!(32768&r.b1))return r.b1;for(r=r.jump,e=t.length,i=0;e>i;i++)if(t[i]===r){n=i;break}}else{if(!(32768&r.b0))return r.b0;n++,r=t[n]}return-1},cc.Codec.GZip.prototype.DeflateLoop=function(){var t,e,i,n,r;do if(t=this.readBit(),i=this.readBits(2),0===i)for(this.byteAlign(),i=this.readByte(),i|=this.readByte()<<8,e=this.readByte(),e|=this.readByte()<<8,65535&(i^~e)&&document.write("BlockLen checksum mismatch\n");i--;)e=this.readByte(),this.addBuffer(e);else if(1===i)for(;;)if(i=cc.Codec.GZip.bitReverse[this.readBits(7)]>>1,i>23?(i=i<<1|this.readBit(),i>199?(i-=128,i=i<<1|this.readBit()):(i-=48,i>143&&(i+=136))):i+=256,256>i)this.addBuffer(i);else{if(256===i)break;var o;for(i-=257,r=this.readBits(cc.Codec.GZip.cplext[i])+cc.Codec.GZip.cplens[i],i=cc.Codec.GZip.bitReverse[this.readBits(5)]>>3,8<cc.Codec.GZip.cpdext[i]?(o=this.readBits(8),o|=this.readBits(cc.Codec.GZip.cpdext[i]-8)<<8):o=this.readBits(cc.Codec.GZip.cpdext[i]),o+=cc.Codec.GZip.cpdist[i],i=0;r>i;i++)e=this.buf32k[this.bIdx-o&32767],this.addBuffer(e)}else if(2===i){var s=Array(320);for(e=257+this.readBits(5),o=1+this.readBits(5),n=4+this.readBits(4),i=0;19>i;i++)s[i]=0;for(i=0;n>i;i++)s[cc.Codec.GZip.border[i]]=this.readBits(3);for(r=this.distanceTree.length,n=0;r>n;n++)this.distanceTree[n]=new cc.Codec.GZip.HufNode;if(this.CreateTree(this.distanceTree,19,s,0))return this.flushBuffer(),1;r=e+o,n=0;for(var c=-1;r>n;)if(c++,i=this.DecodeValue(this.distanceTree),16>i)s[n++]=i;else if(16===i){var a;if(i=3+this.readBits(2),n+i>r)return this.flushBuffer(),1;for(a=n?s[n-1]:0;i--;)s[n++]=a}else{if(i=17===i?3+this.readBits(3):11+this.readBits(7),n+i>r)return this.flushBuffer(),1;for(;i--;)s[n++]=0}for(r=this.literalTree.length,n=0;r>n;n++)this.literalTree[n]=new cc.Codec.GZip.HufNode;if(this.CreateTree(this.literalTree,e,s,0))return this.flushBuffer(),1;for(r=this.literalTree.length,n=0;r>n;n++)this.distanceTree[n]=new cc.Codec.GZip.HufNode;for(i=[],n=e;n<s.length;n++)i[n-e]=s[n];if(this.CreateTree(this.distanceTree,o,i,0))return this.flushBuffer(),1;for(;;)if(i=this.DecodeValue(this.literalTree),i>=256){if(i-=256,0===i)break;for(i--,r=this.readBits(cc.Codec.GZip.cplext[i])+cc.Codec.GZip.cplens[i],i=this.DecodeValue(this.distanceTree),8<cc.Codec.GZip.cpdext[i]?(o=this.readBits(8),o|=this.readBits(cc.Codec.GZip.cpdext[i]-8)<<8):o=this.readBits(cc.Codec.GZip.cpdext[i]),o+=cc.Codec.GZip.cpdist[i];r--;)e=this.buf32k[this.bIdx-o&32767],this.addBuffer(e)}else this.addBuffer(i)}while(!t);return this.flushBuffer(),this.byteAlign(),0},cc.Codec.GZip.prototype.unzipFile=function(t){var e;for(this.gunzip(),e=0;e<this.unzipped.length;e++)if(this.unzipped[e][1]===t)return this.unzipped[e][0]},cc.Codec.GZip.prototype.nextFile=function(){this.outputArr=[],this.modeZIP=!1;var t=[];if(t[0]=this.readByte(),t[1]=this.readByte(),120===t[0]&&218===t[1]&&(this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),"geonext.gxt"],this.files++),31===t[0]&&139===t[1]&&(this.skipdir(),this.unzipped[this.files]=[this.outputArr.join(""),"file"],this.files++),80===t[0]&&75===t[1]&&(this.modeZIP=!0,t[2]=this.readByte(),t[3]=this.readByte(),3===t[2]&&4===t[3])){t[0]=this.readByte(),t[1]=this.readByte(),this.gpflags=this.readByte(),this.gpflags|=this.readByte()<<8,t=this.readByte(),t|=this.readByte()<<8,this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte();var e=this.readByte(),e=e|this.readByte()<<8,i=this.readByte(),i=i|this.readByte()<<8,n=0;for(this.nameBuf=[];e--;){var r=this.readByte();"/"===r|":"===r?n=0:n<cc.Codec.GZip.NAMEMAX-1&&(this.nameBuf[n++]=String.fromCharCode(r))}this.fileout||(this.fileout=this.nameBuf);for(var n=0;i>n;)this.readByte(),n++;8===t&&(this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),this.nameBuf.join("")],this.files++),this.skipdir()}},cc.Codec.GZip.prototype.skipdir=function(){var t,e=[];if(8&this.gpflags&&(e[0]=this.readByte(),e[1]=this.readByte(),e[2]=this.readByte(),e[3]=this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte()),this.modeZIP&&this.nextFile(),e[0]=this.readByte(),8!==e[0])return 0;if(this.gpflags=this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),4&this.gpflags)for(e[0]=this.readByte(),e[2]=this.readByte(),this.len=e[0]+256*e[1],e=0;e<this.len;e++)this.readByte();if(8&this.gpflags)for(e=0,this.nameBuf=[];t=this.readByte();)("7"===t||":"===t)&&(e=0),e<cc.Codec.GZip.NAMEMAX-1&&(this.nameBuf[e++]=t);if(16&this.gpflags)for(;this.readByte(););2&this.gpflags&&(this.readByte(),this.readByte()),this.DeflateLoop(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.modeZIP&&this.nextFile()},function(){function t(t){throw t}function e(t,e){var i=t.split("."),n=S;i[0]in n||!n.execScript||n.execScript("var "+i[0]);for(var r;i.length&&(r=i.shift());)i.length||e===y?n=n[r]?n[r]:n[r]={}:n[r]=e}function i(t){if("string"==typeof t){t=t.split("");var e,i;for(e=0,i=t.length;i>e;e++)t[e]=(255&t[e].charCodeAt(0))>>>0}e=1,i=0;for(var n,r=t.length,o=0;r>0;){n=r>1024?1024:r,r-=n;do e+=t[o++],i+=e;while(--n);e%=65521,i%=65521}return(i<<16|e)>>>0}function n(e,i){this.index="number"==typeof i?i:0,this.i=0,this.buffer=e instanceof(C?Uint8Array:Array)?e:new(C?Uint8Array:Array)(32768),2*this.buffer.length<=this.index&&t(Error("invalid index")),this.buffer.length<=this.index&&this.f()}function r(t){this.buffer=new(C?Uint16Array:Array)(2*t),this.length=0}function o(t){var e,i,n,r,o,s,c,a,l,h=t.length,u=0,d=Number.POSITIVE_INFINITY;for(a=0;h>a;++a)t[a]>u&&(u=t[a]),t[a]<d&&(d=t[a]);for(e=1<<u,i=new(C?Uint32Array:Array)(e),n=1,r=0,o=2;u>=n;){for(a=0;h>a;++a)if(t[a]===n){for(s=0,c=r,l=0;n>l;++l)s=s<<1|1&c,c>>=1;for(l=s;e>l;l+=o)i[l]=n<<16|a;++r}++n,r<<=1,o<<=1}return[i,u,d]}function s(t,e){this.h=P,this.w=0,this.input=t,this.b=0,e&&(e.lazy&&(this.w=e.lazy),"number"==typeof e.compressionType&&(this.h=e.compressionType),e.outputBuffer&&(this.a=C&&e.outputBuffer instanceof Array?new Uint8Array(e.outputBuffer):e.outputBuffer),"number"==typeof e.outputIndex&&(this.b=e.outputIndex)),this.a||(this.a=new(C?Uint8Array:Array)(32768))}function c(t,e){this.length=t,this.G=e}function a(){var e=w;switch(T){case 3===e:return[257,e-3,0];case 4===e:return[258,e-4,0];case 5===e:return[259,e-5,0];case 6===e:return[260,e-6,0];case 7===e:return[261,e-7,0];case 8===e:return[262,e-8,0];case 9===e:return[263,e-9,0];case 10===e:return[264,e-10,0];case 12>=e:return[265,e-11,1];case 14>=e:return[266,e-13,1];case 16>=e:return[267,e-15,1];case 18>=e:return[268,e-17,1];case 22>=e:return[269,e-19,2];case 26>=e:return[270,e-23,2];case 30>=e:return[271,e-27,2];case 34>=e:return[272,e-31,2];case 42>=e:return[273,e-35,3];case 50>=e:return[274,e-43,3];case 58>=e:return[275,e-51,3];case 66>=e:return[276,e-59,3];case 82>=e:return[277,e-67,4];case 98>=e:return[278,e-83,4];case 114>=e:return[279,e-99,4];case 130>=e:return[280,e-115,4];case 162>=e:return[281,e-131,5];case 194>=e:return[282,e-163,5];case 226>=e:return[283,e-195,5];case 257>=e:return[284,e-227,5];case 258===e:return[285,e-258,0];default:t("invalid length: "+e)}}function l(e,i){function n(e,i){var n,r=e.G,o=[],s=0;n=L[e.length],o[s++]=65535&n,o[s++]=n>>16&255,o[s++]=n>>24;var c;switch(T){case 1===r:c=[0,r-1,0];break;case 2===r:c=[1,r-2,0];break;case 3===r:c=[2,r-3,0];break;case 4===r:c=[3,r-4,0];break;case 6>=r:c=[4,r-5,1];break;case 8>=r:c=[5,r-7,1];break;case 12>=r:c=[6,r-9,2];break;case 16>=r:c=[7,r-13,2];break;case 24>=r:c=[8,r-17,3];break;case 32>=r:c=[9,r-25,3];break;case 48>=r:c=[10,r-33,4];break;case 64>=r:c=[11,r-49,4];break;case 96>=r:c=[12,r-65,5];break;case 128>=r:c=[13,r-97,5];break;case 192>=r:c=[14,r-129,6];break;case 256>=r:c=[15,r-193,6];break;case 384>=r:c=[16,r-257,7];break;case 512>=r:c=[17,r-385,7];break;case 768>=r:c=[18,r-513,8];break;case 1024>=r:c=[19,r-769,8];break;case 1536>=r:c=[20,r-1025,9];break;case 2048>=r:c=[21,r-1537,9];break;case 3072>=r:c=[22,r-2049,10];break;case 4096>=r:c=[23,r-3073,10];break;case 6144>=r:c=[24,r-4097,11];break;case 8192>=r:c=[25,r-6145,11];break;case 12288>=r:c=[26,r-8193,12];break;case 16384>=r:c=[27,r-12289,12];break;case 24576>=r:c=[28,r-16385,13];break;case 32768>=r:c=[29,r-24577,13];break;default:t("invalid distance")}for(n=c,o[s++]=n[0],o[s++]=n[1],o[s++]=n[2],r=0,s=o.length;s>r;++r)_[p++]=o[r];m[o[0]]++,g[o[3]]++,f=e.length+i-1,h=null}var r,o,s,a,l,h,u,d={},_=C?new Uint16Array(2*i.length):[],p=0,f=0,m=new(C?Uint32Array:Array)(286),g=new(C?Uint32Array:Array)(30),S=e.w;if(!C){for(s=0;285>=s;)m[s++]=0;for(s=0;29>=s;)g[s++]=0}for(m[256]=1,r=0,o=i.length;o>r;++r){for(s=l=0,a=3;a>s&&r+s!==o;++s)l=l<<8|i[r+s];if(d[l]===y&&(d[l]=[]),s=d[l],!(0<f--)){for(;0<s.length&&32768<r-s[0];)s.shift();if(r+3>=o){for(h&&n(h,-1),s=0,a=o-r;a>s;++s)u=i[r+s],_[p++]=u,++m[u];break}if(0<s.length){l=a=y;var v=0,x=y,E=y,b=x=y,A=i.length,E=0,b=s.length;t:for(;b>E;E++){if(a=s[b-E-1],x=3,v>3){for(x=v;x>3;x--)if(i[a+x-1]!==i[r+x-1])continue t;x=v}for(;258>x&&A>r+x&&i[a+x]===i[r+x];)++x;if(x>v&&(l=a,v=x),258===x)break}a=new c(v,r-l),h?h.length<a.length?(u=i[r-1],_[p++]=u,++m[u],n(a,0)):n(h,-1):a.length<S?h=a:n(a,0)}else h?n(h,-1):(u=i[r],_[p++]=u,++m[u])}s.push(r)}return _[p++]=256,m[256]++,e.L=m,e.K=g,C?_.subarray(0,p):_}function h(t,e){function i(t){var e=f[t][m[t]];e===h?(i(t+1),i(t+1)):--u[e],++m[t]}var n,o,s,c=t.length,a=new r(572),l=new(C?Uint8Array:Array)(c);if(!C)for(o=0;c>o;o++)l[o]=0;for(o=0;c>o;++o)0<t[o]&&a.push(o,t[o]);if(c=Array(a.length/2),n=new(C?Uint32Array:Array)(a.length/2),1===c.length)return l[a.pop().index]=1,l;for(o=0,s=a.length/2;s>o;++o)c[o]=a.pop(),n[o]=c[o].value;var h=n.length;o=new(C?Uint16Array:Array)(e);var a=new(C?Uint8Array:Array)(e),u=new(C?Uint8Array:Array)(h);s=Array(e);var d,_,p,f=Array(e),m=Array(e),g=(1<<e)-h,y=1<<e-1;for(o[e-1]=h,d=0;e>d;++d)y>g?a[d]=0:(a[d]=1,g-=y),g<<=1,o[e-2-d]=(o[e-1-d]/2|0)+h;for(o[0]=a[0],s[0]=Array(o[0]),f[0]=Array(o[0]),d=1;e>d;++d)o[d]>2*o[d-1]+a[d]&&(o[d]=2*o[d-1]+a[d]),s[d]=Array(o[d]),f[d]=Array(o[d]);for(g=0;h>g;++g)u[g]=e;for(y=0;y<o[e-1];++y)s[e-1][y]=n[y],f[e-1][y]=y;for(g=0;e>g;++g)m[g]=0;for(1===a[e-1]&&(--u[0],++m[e-1]),d=e-2;d>=0;--d){for(_=g=0,p=m[d+1],y=0;y<o[d];y++)_=s[d+1][p]+s[d+1][p+1],_>n[g]?(s[d][y]=_,f[d][y]=h,p+=2):(s[d][y]=n[g],f[d][y]=g,++g);m[d]=0,1===a[d]&&i(d)}for(n=u,o=0,s=c.length;s>o;++o)l[c[o].index]=n[o];return l}function u(e){var i,n,r,o=new(C?Uint16Array:Array)(e.length),s=[],c=[],a=0;for(i=0,n=e.length;n>i;i++)s[e[i]]=(0|s[e[i]])+1;for(i=1,n=16;n>=i;i++)c[i]=a,a+=0|s[i],a>1<<i&&t("overcommitted"),a<<=1;for(65536>a&&t("undercommitted"),i=0,n=e.length;n>i;i++)for(a=c[e[i]],c[e[i]]+=1,s=o[i]=0,r=e[i];r>s;s++)o[i]=o[i]<<1|1&a,a>>>=1;return o}function d(t,e){this.input=t,this.a=new(C?Uint8Array:Array)(32768),this.h=D.j;var i,n={};!e&&(e={})||"number"!=typeof e.compressionType||(this.h=e.compressionType);for(i in e)n[i]=e[i];n.outputBuffer=this.a,this.z=new s(this.input,n)}function _(e,i){switch(this.k=[],this.l=32768,this.e=this.g=this.c=this.q=0,this.input=C?new Uint8Array(e):e,this.s=!1,this.m=N,this.B=!1,(i||!(i={}))&&(i.index&&(this.c=i.index),i.bufferSize&&(this.l=i.bufferSize),i.bufferType&&(this.m=i.bufferType),i.resize&&(this.B=i.resize)),this.m){case O:this.b=32768,this.a=new(C?Uint8Array:Array)(32768+this.l+258);break;case N:this.b=0,this.a=new(C?Uint8Array:Array)(this.l),this.f=this.J,this.t=this.H,this.o=this.I;break;default:t(Error("invalid inflate mode"))}}function p(e,i){for(var n,r=e.g,o=e.e,s=e.input,c=e.c;i>o;)n=s[c++],n===y&&t(Error("input buffer is broken")),r|=n<<o,o+=8;return e.g=r>>>i,e.e=o-i,e.c=c,r&(1<<i)-1}function f(e,i){for(var n,r=e.g,o=e.e,s=e.input,c=e.c,a=i[0],l=i[1];l>o;)n=s[c++],n===y&&t(Error("input buffer is broken")),r|=n<<o,o+=8;return s=a[r&(1<<l)-1],a=s>>>16,e.g=r>>a,e.e=o-a,e.c=c,65535&s}function m(t){function e(t,e,i){var n,r,o,s;for(s=0;t>s;)switch(n=f(this,e)){case 16:for(o=3+p(this,2);o--;)i[s++]=r;break;case 17:for(o=3+p(this,3);o--;)i[s++]=0;r=0;break;case 18:for(o=11+p(this,7);o--;)i[s++]=0;r=0;break;default:r=i[s++]=n}return i}var i,n=p(t,5)+257,r=p(t,5)+1,s=p(t,4)+4,c=new(C?Uint8Array:Array)(B.length);for(i=0;s>i;++i)c[B[i]]=p(t,3);s=o(c),c=new(C?Uint8Array:Array)(n),i=new(C?Uint8Array:Array)(r),t.o(o(e.call(t,n,s,c)),o(e.call(t,r,s,i)))}function g(e,i){var n,r;switch(this.input=e,this.c=0,(i||!(i={}))&&(i.index&&(this.c=i.index),i.verify&&(this.M=i.verify)),n=e[this.c++],r=e[this.c++],15&n){case z:this.method=z;break;default:t(Error("unsupported compression method"))}0!==((n<<8)+r)%31&&t(Error("invalid fcheck flag:"+((n<<8)+r)%31)),32&r&&t(Error("fdict flag is not supported")),this.A=new _(e,{index:this.c,bufferSize:i.bufferSize,bufferType:i.bufferType,resize:i.resize})}var y=void 0,T=!0,S=this,C="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array;n.prototype.f=function(){var t,e=this.buffer,i=e.length,n=new(C?Uint8Array:Array)(i<<1);if(C)n.set(e);else for(t=0;i>t;++t)n[t]=e[t];return this.buffer=n},n.prototype.d=function(t,e,i){var n=this.buffer,r=this.index,o=this.i,s=n[r];if(i&&e>1&&(t=e>8?(R[255&t]<<24|R[t>>>8&255]<<16|R[t>>>16&255]<<8|R[t>>>24&255])>>32-e:R[t]>>8-e),8>e+o)s=s<<e|t,o+=e;else for(i=0;e>i;++i)s=s<<1|t>>e-i-1&1,8===++o&&(o=0,n[r++]=R[s],s=0,r===n.length&&(n=this.f()));n[r]=s,this.buffer=n,this.i=o,this.index=r},n.prototype.finish=function(){var t,e=this.buffer,i=this.index;return 0<this.i&&(e[i]<<=8-this.i,e[i]=R[e[i]],i++),C?t=e.subarray(0,i):(e.length=i,t=e),t};var v,x=new(C?Uint8Array:Array)(256);for(v=0;256>v;++v){for(var E=v,b=E,A=7,E=E>>>1;E;E>>>=1)b<<=1,b|=1&E,--A;x[v]=(b<<A&255)>>>0}var R=x,x=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];C&&new Uint32Array(x),r.prototype.getParent=function(t){return 2*((t-2)/4|0)},r.prototype.push=function(t,e){var i,n,r,o=this.buffer;for(i=this.length,o[this.length++]=e,o[this.length++]=t;i>0&&(n=this.getParent(i),o[i]>o[n]);)r=o[i],o[i]=o[n],o[n]=r,r=o[i+1],o[i+1]=o[n+1],o[n+1]=r,i=n;return this.length},r.prototype.pop=function(){var t,e,i,n,r,o=this.buffer;for(e=o[0],t=o[1],this.length-=2,o[0]=o[this.length],o[1]=o[this.length+1],r=0;(n=2*r+2,!(n>=this.length))&&(n+2<this.length&&o[n+2]>o[n]&&(n+=2),o[n]>o[r]);)i=o[r],o[r]=o[n],o[n]=i,i=o[r+1],o[r+1]=o[n+1],o[n+1]=i,r=n;return{index:t,value:e,length:this.length}};var P=2,x={NONE:0,r:1,j:P,N:3},I=[];for(v=0;288>v;v++)switch(T){case 143>=v:I.push([v+48,8]);break;case 255>=v:I.push([v-144+400,9]);break;case 279>=v:I.push([v-256+0,7]);break;case 287>=v:I.push([v-280+192,8]);break;default:t("invalid literal: "+v)}s.prototype.n=function(){var e,i,r,o,s=this.input;switch(this.h){case 0:for(r=0,o=s.length;o>r;){i=C?s.subarray(r,r+65535):s.slice(r,r+65535),r+=i.length;var c=r===o,a=y,d=a=y,d=a=y,_=this.a,p=this.b;if(C){for(_=new Uint8Array(this.a.buffer);_.length<=p+i.length+5;)_=new Uint8Array(_.length<<1);_.set(this.a)}if(a=c?1:0,_[p++]=0|a,a=i.length,d=~a+65536&65535,_[p++]=255&a,_[p++]=a>>>8&255,_[p++]=255&d,_[p++]=d>>>8&255,C)_.set(i,p),p+=i.length,_=_.subarray(0,p);else{for(a=0,d=i.length;d>a;++a)_[p++]=i[a];_.length=p}this.b=p,this.a=_}break;case 1:for(r=new n(new Uint8Array(this.a.buffer),this.b),r.d(1,1,T),r.d(1,2,T),s=l(this,s),i=0,c=s.length;c>i;i++)if(o=s[i],n.prototype.d.apply(r,I[o]),o>256)r.d(s[++i],s[++i],T),r.d(s[++i],5),r.d(s[++i],s[++i],T);else if(256===o)break;this.a=r.finish(),this.b=this.a.length;break;case P:o=new n(new Uint8Array(this.a),this.b);var f,m,g,S,v,x,E=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],a=Array(19),_=P;for(o.d(1,1,T),o.d(_,2,T),s=l(this,s),d=h(this.L,15),S=u(d),_=h(this.K,7),p=u(_),f=286;f>257&&0===d[f-1];f--);for(m=30;m>1&&0===_[m-1];m--);var b=f,A=m;e=new(C?Uint32Array:Array)(b+A);var R,w,L=new(C?Uint32Array:Array)(316);for(v=new(C?Uint8Array:Array)(19),x=g=0;b>x;x++)e[g++]=d[x];for(x=0;A>x;x++)e[g++]=_[x];if(!C)for(x=0,A=v.length;A>x;++x)v[x]=0;for(x=R=0,A=e.length;A>x;x+=g){for(g=1;A>x+g&&e[x+g]===e[x];++g);if(b=g,0===e[x])if(3>b)for(;0<b--;)L[R++]=0,v[0]++;else for(;b>0;)w=138>b?b:138,w>b-3&&b>w&&(w=b-3),10>=w?(L[R++]=17,L[R++]=w-3,v[17]++):(L[R++]=18,L[R++]=w-11,v[18]++),b-=w;else if(L[R++]=e[x],v[e[x]]++,b--,3>b)for(;0<b--;)L[R++]=e[x],v[e[x]]++;else for(;b>0;)w=6>b?b:6,w>b-3&&b>w&&(w=b-3),L[R++]=16,L[R++]=w-3,v[16]++,b-=w}for(e=C?L.subarray(0,R):L.slice(0,R),v=h(v,7),x=0;19>x;x++)a[x]=v[E[x]];for(g=19;g>4&&0===a[g-1];g--);for(E=u(v),o.d(f-257,5,T),o.d(m-1,5,T),o.d(g-4,4,T),x=0;g>x;x++)o.d(a[x],3,T);for(x=0,a=e.length;a>x;x++)if(i=e[x],o.d(E[i],v[i],T),i>=16){switch(x++,i){case 16:c=2;break;case 17:c=3;break;case 18:c=7;break;default:t("invalid code: "+i)}o.d(e[x],c,T)}for(c=[S,d],p=[p,_],i=c[0],c=c[1],_=p[0],S=p[1],p=0,a=s.length;a>p;++p)if(r=s[p],o.d(i[r],c[r],T),r>256)o.d(s[++p],s[++p],T),d=s[++p],o.d(_[d],S[d],T),o.d(s[++p],s[++p],T);else if(256===r)break;this.a=o.finish(),this.b=this.a.length;break;default:t("invalid compression type")}return this.a},v=[];var w;for(w=3;258>=w;w++)E=a(),v[w]=E[2]<<24|E[1]<<16|E[0];var L=C?new Uint32Array(v):v,D=x;d.prototype.n=function(){var e,n,r,o,s=0;switch(o=this.a,e=z){case z:n=Math.LOG2E*Math.log(32768)-8;break;default:t(Error("invalid compression method"))}switch(n=n<<4|e,o[s++]=n,e){case z:switch(this.h){case D.NONE:r=0;break;case D.r:r=1;break;case D.j:r=2;break;default:t(Error("unsupported compression type"))}break;default:t(Error("invalid compression method"))}return e=r<<6|0,o[s++]=e|31-(256*n+e)%31,e=i(this.input),this.z.b=s,o=this.z.n(),s=o.length,C&&(o=new Uint8Array(o.buffer),o.length<=s+4&&(this.a=new Uint8Array(o.length+4),this.a.set(o),o=this.a),o=o.subarray(0,s+4)),o[s++]=e>>24&255,o[s++]=e>>16&255,o[s++]=e>>8&255,o[s++]=255&e,o},e("Zlib.Deflate",d),e("Zlib.Deflate.compress",function(t,e){return new d(t,e).n()}),e("Zlib.Deflate.CompressionType",D),e("Zlib.Deflate.CompressionType.NONE",D.NONE),e("Zlib.Deflate.CompressionType.FIXED",D.r),e("Zlib.Deflate.CompressionType.DYNAMIC",D.j);var O=0,N=1,x={D:O,C:N};_.prototype.p=function(){for(;!this.s;){var e=p(this,3);switch(1&e&&(this.s=T),e>>>=1){case 0:var e=this.input,i=this.c,n=this.a,r=this.b,o=y,s=y,c=y,a=n.length,o=y;switch(this.e=this.g=0,o=e[i++],o===y&&t(Error("invalid uncompressed block header: LEN (first byte)")),s=o,o=e[i++],o===y&&t(Error("invalid uncompressed block header: LEN (second byte)")),s|=o<<8,o=e[i++],o===y&&t(Error("invalid uncompressed block header: NLEN (first byte)")),c=o,o=e[i++],o===y&&t(Error("invalid uncompressed block header: NLEN (second byte)")),c|=o<<8,s===~c&&t(Error("invalid uncompressed block header: length verify")),i+s>e.length&&t(Error("input buffer is broken")),this.m){case O:for(;r+s>n.length;){if(o=a-r,s-=o,C)n.set(e.subarray(i,i+o),r),r+=o,i+=o;else for(;o--;)n[r++]=e[i++];this.b=r,n=this.f(),r=this.b}break;case N:for(;r+s>n.length;)n=this.f({v:2});break;default:t(Error("invalid inflate mode"))}if(C)n.set(e.subarray(i,i+s),r),r+=s,i+=s;else for(;s--;)n[r++]=e[i++];this.c=i,this.b=r,this.a=n;break;case 1:this.o(W,G);break;case 2:m(this);break;default:t(Error("unknown BTYPE: "+e))}}return this.t()},v=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];var B=C?new Uint16Array(v):v;v=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258];
var F=C?new Uint16Array(v):v;v=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0];var M=C?new Uint8Array(v):v;v=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];var V=C?new Uint16Array(v):v;v=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];var k=C?new Uint8Array(v):v;for(v=new(C?Uint8Array:Array)(288),E=0,b=v.length;b>E;++E)v[E]=143>=E?8:255>=E?9:279>=E?7:8;var W=o(v);for(v=new(C?Uint8Array:Array)(30),E=0,b=v.length;b>E;++E)v[E]=5;var G=o(v);for(_.prototype.o=function(t,e){var i=this.a,n=this.b;this.u=t;for(var r,o,s,c=i.length-258;256!==(r=f(this,t));)if(256>r)n>=c&&(this.b=n,i=this.f(),n=this.b),i[n++]=r;else for(r-=257,s=F[r],0<M[r]&&(s+=p(this,M[r])),r=f(this,e),o=V[r],0<k[r]&&(o+=p(this,k[r])),n>=c&&(this.b=n,i=this.f(),n=this.b);s--;)i[n]=i[n++-o];for(;8<=this.e;)this.e-=8,this.c--;this.b=n},_.prototype.I=function(t,e){var i=this.a,n=this.b;this.u=t;for(var r,o,s,c=i.length;256!==(r=f(this,t));)if(256>r)n>=c&&(i=this.f(),c=i.length),i[n++]=r;else for(r-=257,s=F[r],0<M[r]&&(s+=p(this,M[r])),r=f(this,e),o=V[r],0<k[r]&&(o+=p(this,k[r])),n+s>c&&(i=this.f(),c=i.length);s--;)i[n]=i[n++-o];for(;8<=this.e;)this.e-=8,this.c--;this.b=n},_.prototype.f=function(){var t,e,i=new(C?Uint8Array:Array)(this.b-32768),n=this.b-32768,r=this.a;if(C)i.set(r.subarray(32768,i.length));else for(t=0,e=i.length;e>t;++t)i[t]=r[t+32768];if(this.k.push(i),this.q+=i.length,C)r.set(r.subarray(n,n+32768));else for(t=0;32768>t;++t)r[t]=r[n+t];return this.b=32768,r},_.prototype.J=function(t){var e,i,n,r,o=this.input.length/this.c+1|0,s=this.input,c=this.a;return t&&("number"==typeof t.v&&(o=t.v),"number"==typeof t.F&&(o+=t.F)),2>o?(i=(s.length-this.c)/this.u[2],r=i/2*258|0,n=r<c.length?c.length+r:c.length<<1):n=c.length*o,C?(e=new Uint8Array(n),e.set(c)):e=c,this.a=e},_.prototype.t=function(){var t,e,i,n,r,o=0,s=this.a,c=this.k,a=new(C?Uint8Array:Array)(this.q+(this.b-32768));if(0===c.length)return C?this.a.subarray(32768,this.b):this.a.slice(32768,this.b);for(e=0,i=c.length;i>e;++e)for(t=c[e],n=0,r=t.length;r>n;++n)a[o++]=t[n];for(e=32768,i=this.b;i>e;++e)a[o++]=s[e];return this.k=[],this.buffer=a},_.prototype.H=function(){var t,e=this.b;return C?this.B?(t=new Uint8Array(e),t.set(this.a.subarray(0,e))):t=this.a.subarray(0,e):(this.a.length>e&&(this.a.length=e),t=this.a),this.buffer=t},g.prototype.p=function(){var e,n,r=this.input;return e=this.A.p(),this.c=this.A.c,this.M&&(n=(r[this.c++]<<24|r[this.c++]<<16|r[this.c++]<<8|r[this.c++])>>>0,n!==i(e)&&t(Error("invalid adler-32 checksum"))),e},e("Zlib.Inflate",g),e("Zlib.Inflate.BufferType",x),x.ADAPTIVE=x.C,x.BLOCK=x.D,e("Zlib.Inflate.prototype.decompress",g.prototype.p),x=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],C&&new Uint16Array(x),x=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],C&&new Uint16Array(x),x=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],C&&new Uint8Array(x),x=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],C&&new Uint16Array(x),x=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],C&&new Uint8Array(x),x=new(C?Uint8Array:Array)(288),v=0,E=x.length;E>v;++v)x[v]=143>=v?8:255>=v?9:279>=v?7:8;for(o(x),x=new(C?Uint8Array:Array)(30),v=0,E=x.length;E>v;++v)x[v]=5;o(x);var z=8}.call(this),_p=window,_p=_p.Zlib=_p.Zlib,_p.Deflate=_p.Deflate,_p.Deflate.compress=_p.Deflate.compress,_p.Inflate=_p.Inflate,_p.Inflate.BufferType=_p.Inflate.BufferType,_p.Inflate.prototype.decompress=_p.Inflate.prototype.decompress,cc.PNGReader=cc.Class.extend({ctor:function(t){var e,i,n,r;for(this.data=t,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},n=null;;){for(e=this.readUInt32(),r=t=void 0,r=[],t=0;4>t;++t)r.push(String.fromCharCode(this.data[this.pos++]));switch(t=r.join("")){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(e);break;case"fcTL":n&&this.animation.frames.push(n),this.pos+=4,n={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},t=this.readUInt16(),e=this.readUInt16()||100,n.delay=1e3*t/e,n.disposeOp=this.data[this.pos++],n.blendOp=this.data[this.pos++],n.data=[];break;case"IDAT":case"fdAT":for("fdAT"===t&&(this.pos+=4,e-=4),t=(null!=n?n.data:void 0)||this.imgData,r=0;e>=0?e>r:r>e;e>=0?++r:--r)t.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(this.transparency.indexed=this.read(e),e=255-this.transparency.indexed.length,e>0)for(t=0;e>=0?e>t:t>e;e>=0?++t:--t)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(e)[0];break;case 2:this.transparency.rgb=this.read(e)}break;case"tEXt":r=this.read(e),e=r.indexOf(0),t=String.fromCharCode.apply(String,r.slice(0,e)),this.text[t]=String.fromCharCode.apply(String,r.slice(e+1));break;case"IEND":n&&this.animation.frames.push(n);t:{switch(this.colorType){case 0:case 3:case 4:n=1;break t;case 2:case 6:n=3;break t}n=void 0}this.colors=n,this.hasAlphaChannel=4===(i=this.colorType)||6===i,i=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*i;t:{switch(this.colors){case 1:i="DeviceGray";break t;case 3:i="DeviceRGB";break t}i=void 0}return this.colorSpace=i,void(Uint8Array!=Array&&(this.imgData=new Uint8Array(this.imgData)));default:this.pos+=e}if(this.pos+=4,this.pos>this.data.length)throw Error("Incomplete or corrupt PNG file")}},read:function(t){var e,i;for(i=[],e=0;t>=0?t>e:e>t;t>=0?++e:--e)i.push(this.data[this.pos++]);return i},readUInt32:function(){var t,e,i,n;return t=this.data[this.pos++]<<24,e=this.data[this.pos++]<<16,i=this.data[this.pos++]<<8,n=this.data[this.pos++],t|e|i|n},readUInt16:function(){var t,e;return t=this.data[this.pos++]<<8,e=this.data[this.pos++],t|e},decodePixels:function(t){var e,i,n,r,o,s,c,a,l,h,u,d,_,p,f;if(null==t&&(t=this.imgData),0===t.length)return new Uint8Array(0);for(t=new Zlib.Inflate(t,{index:0,verify:!1}).decompress(),a=this.pixelBitlength/8,d=a*this.width,l=new Uint8Array(d*this.height),s=t.length,i=h=u=0;s>h;){switch(t[h++]){case 0:for(e=0;d>e;e+=1)l[i++]=t[h++];break;case 1:for(r=_=0;d>_;r=_+=1)e=t[h++],o=a>r?0:l[i-a],l[i++]=(e+o)%256;break;case 2:for(r=o=0;d>o;r=o+=1)e=t[h++],n=(r-r%a)/a,_=u&&l[(u-1)*d+n*a+r%a],l[i++]=(_+e)%256;break;case 3:for(r=f=0;d>f;r=f+=1)e=t[h++],n=(r-r%a)/a,o=a>r?0:l[i-a],_=u&&l[(u-1)*d+n*a+r%a],l[i++]=(e+Math.floor((o+_)/2))%256;break;case 4:for(r=f=0;d>f;r=f+=1)e=t[h++],n=(r-r%a)/a,o=a>r?0:l[i-a],0===u?_=p=0:(_=l[(u-1)*d+n*a+r%a],p=n&&l[(u-1)*d+(n-1)*a+r%a]),c=o+_-p,r=Math.abs(c-o),n=Math.abs(c-_),c=Math.abs(c-p),o=n>=r&&c>=r?o:c>=n?_:p,l[i++]=(e+o)%256;break;default:throw Error("Invalid filter algorithm: "+t[h-1])}u++}return l},copyToImageData:function(t,e){var i,n,r,o,s,c,a,l;if(n=this.colors,l=null,i=this.hasAlphaChannel,this.palette.length&&(l=null!=(r=this._decodedPalette)?r:this._decodedPalette=this.decodePalette(),n=4,i=!0),r=t.data||t,a=r.length,s=l||e,o=c=0,1===n)for(;a>o;)n=l?4*e[o/4]:c,c=s[n++],r[o++]=c,r[o++]=c,r[o++]=c,r[o++]=i?s[n++]:255,c=n;else for(;a>o;)n=l?4*e[o/4]:c,r[o++]=s[n++],r[o++]=s[n++],r[o++]=s[n++],r[o++]=i?s[n++]:255,c=n},decodePalette:function(){var t,e,i,n,r,o,s,c,a;for(i=this.palette,o=this.transparency.indexed||[],r=new Uint8Array((o.length||0)+i.length),e=s=t=n=0,c=i.length;c>s;e=s+=3)r[n++]=i[e],r[n++]=i[e+1],r[n++]=i[e+2],r[n++]=null!=(a=o[t++])?a:255;return r},render:function(t){var e;return t.width=this.width,t.height=this.height,t=t.getContext("2d"),e=t.createImageData(this.width,this.height),this.copyToImageData(e,this.decodePixels()),t.putImageData(e,0,0)}}),cc.tiffReader={_littleEndian:!1,_tiffData:null,_fileDirectories:[],getUint8:function(t){return this._tiffData[t]},getUint16:function(t){return this._littleEndian?this._tiffData[t+1]<<8|this._tiffData[t]:this._tiffData[t]<<8|this._tiffData[t+1]},getUint32:function(t){var e=this._tiffData;return this._littleEndian?e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t]:e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]},checkLittleEndian:function(){var t=this.getUint16(0);if(18761===t)this.littleEndian=!0;else{if(19789!==t)throw console.log(t),TypeError("Invalid byte order value.");this.littleEndian=!1}return this.littleEndian},hasTowel:function(){if(42!==this.getUint16(2))throw RangeError("You forgot your towel!");return!0},getFieldTypeName:function(t){var e=this.fieldTypeNames;return t in e?e[t]:null},getFieldTagName:function(t){var e=this.fieldTagNames;return t in e?e[t]:(console.log("Unknown Field Tag:",t),"Tag"+t)},getFieldTypeLength:function(t){return-1!==["BYTE","ASCII","SBYTE","UNDEFINED"].indexOf(t)?1:-1!==["SHORT","SSHORT"].indexOf(t)?2:-1!==["LONG","SLONG","FLOAT"].indexOf(t)?4:-1!==["RATIONAL","SRATIONAL","DOUBLE"].indexOf(t)?8:null},getFieldValues:function(t,e,i,n){t=[];var r=this.getFieldTypeLength(e);if(4>=r*i)t.push(!1===this.littleEndian?n>>>8*(4-r):n);else for(var o=0;i>o;o++){var s=r*o;r>=8?-1!==["RATIONAL","SRATIONAL"].indexOf(e)?(t.push(this.getUint32(n+s)),t.push(this.getUint32(n+s+4))):cc.log("Can't handle this field type or size"):t.push(this.getBytes(r,n+s))}return"ASCII"===e&&t.forEach(function(t,e,i){i[e]=String.fromCharCode(t)}),t},getBytes:function(t,e){if(0>=t)cc.log("No bytes requested");else{if(1>=t)return this.getUint8(e);if(2>=t)return this.getUint16(e);if(3>=t)return this.getUint32(e)>>>8;if(4>=t)return this.getUint32(e);cc.log("Too many bytes requested")}},getBits:function(t,e,i){i=i||0,e+=Math.floor(i/8);var n=i+t;t=32-t;var r,o;return 0>=n?console.log("No bits requested"):8>=n?(r=24+i,o=this.getUint8(e)):16>=n?(r=16+i,o=this.getUint16(e)):32>=n?(r=i,o=this.getUint32(e)):console.log("Too many bits requested"),{bits:o<<r>>>t,byteOffset:e+Math.floor(n/8),bitOffset:n%8}},parseFileDirectory:function(t){var e=this.getUint16(t),i=[];t+=2;for(var n=0;e>n;t+=12,n++){var r=this.getUint16(t),o=this.getUint16(t+2),s=this.getUint32(t+4),c=this.getUint32(t+8),r=this.getFieldTagName(r),o=this.getFieldTypeName(o),s=this.getFieldValues(r,o,s,c);i[r]={type:o,values:s}}this._fileDirectories.push(i),e=this.getUint32(t),0!==e&&this.parseFileDirectory(e)},clampColorSample:function(t,e){var i=Math.pow(2,8-e);return Math.floor(t*i+(i-1))},parseTIFF:function(t,e){if(e=e||cc.newElement("canvas"),this._tiffData=t,this.canvas=e,this.checkLittleEndian(),this.hasTowel()){var i=this.getUint32(4);this._fileDirectories.length=0,this.parseFileDirectory(i);var n=this._fileDirectories[0],i=n.ImageWidth.values[0],r=n.ImageLength.values[0];this.canvas.width=i,this.canvas.height=r;var o=[],s=n.Compression?n.Compression.values[0]:1,c=n.SamplesPerPixel.values[0],a=[],l=0,h=!1;if(n.BitsPerSample.values.forEach(function(t,e){a[e]={bitsPerSample:t,hasBytesPerSample:!1,bytesPerSample:void 0},0===t%8&&(a[e].hasBytesPerSample=!0,a[e].bytesPerSample=t/8),l+=t},this),0===l%8)var h=!0,u=l/8;var d=n.StripOffsets.values,_=d.length;if(n.StripByteCounts)var p=n.StripByteCounts.values;else{if(cc.log("Missing StripByteCounts!"),1!==_)throw Error("Cannot recover from missing StripByteCounts");p=[Math.ceil(i*r*l/8)]}for(var f=0;_>f;f++){var m=d[f];o[f]=[];for(var g=p[f],y=0,T=0,S=1,C=!0,v=[],x=0,E=0,b=0;g>y;y+=S)switch(s){case 1:for(S=0,v=[];c>S;S++){if(!a[S].hasBytesPerSample){var A=this.getBits(a[S].bitsPerSample,m+y,T);throw v.push(A.bits),y=A.byteOffset-m,T=A.bitOffset,RangeError("Cannot handle sub-byte bits per sample")}v.push(this.getBytes(a[S].bytesPerSample,m+y+a[S].bytesPerSample*S))}if(o[f].push(v),!h)throw S=0,RangeError("Cannot handle sub-byte bits per pixel");S=u;break;case 32773:if(C){var C=!1,R=1,P=1,S=this.getInt8(m+y);S>=0&&127>=S?R=S+1:S>=-127&&-1>=S?P=-S+1:C=!0}else{for(var I=this.getUint8(m+y),S=0;P>S;S++){if(!a[E].hasBytesPerSample)throw RangeError("Cannot handle sub-byte bits per sample");b=b<<8*x|I,x++,x===a[E].bytesPerSample&&(v.push(b),b=x=0,E++),E===c&&(o[f].push(v),v=[],E=0)}R--,0===R&&(C=!0)}S=1}}if(e.getContext){if(u=this.canvas.getContext("2d"),u.fillStyle="rgba(255, 255, 255, 0)",f=n.RowsPerStrip?n.RowsPerStrip.values[0]:r,m=o.length,r%=f,r=0===r?f:r,y=f,s=0,v=n.PhotometricInterpretation.values[0],R=[],P=0,n.ExtraSamples&&(R=n.ExtraSamples.values,P=R.length),n.ColorMap)var A=n.ColorMap.values,w=Math.pow(2,a[0].bitsPerSample);for(f=0;m>f;f++){for(f+1===m&&(y=r),n=o[f].length,s*=f,h=c=0;n>h;c++)for(d=0;i>d;d++,h++){if(p=o[f][h],C=T=g=0,_=1,P>0)for(g=0;P>g;g++)if(1===R[g]||2===R[g]){_=p[3+g]/256;break}switch(v){case 0:if(a[0].hasBytesPerSample)var L=Math.pow(16,2*a[0].bytesPerSample);p.forEach(function(t,e,i){i[e]=L-t});case 1:g=T=C=this.clampColorSample(p[0],a[0].bitsPerSample);break;case 2:g=this.clampColorSample(p[0],a[0].bitsPerSample),T=this.clampColorSample(p[1],a[1].bitsPerSample),C=this.clampColorSample(p[2],a[2].bitsPerSample);break;case 3:if(void 0===A)throw Error("Palette image missing color map");p=p[0],g=this.clampColorSample(A[p],16),T=this.clampColorSample(A[w+p],16),C=this.clampColorSample(A[2*w+p],16);break;default:throw RangeError("Unknown Photometric Interpretation:",v)}u.fillStyle="rgba("+g+", "+T+", "+C+", "+_+")",u.fillRect(d,s+c,1,1)}s=y}}return this.canvas}},fieldTagNames:{315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop"},fieldTypeNames:{1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE"}},cc.Particle=function(t,e,i,n,r,o,s,c,a,l,h,u){this.pos=t?t:cc.p(0,0),this.startPos=e?e:cc.p(0,0),this.color=i?i:{r:0,g:0,b:0,a:255},this.deltaColor=n?n:{r:0,g:0,b:0,a:255},this.size=r||0,this.deltaSize=o||0,this.rotation=s||0,this.deltaRotation=c||0,this.timeToLive=a||0,this.atlasIndex=l||0,this.modeA=h?h:new cc.Particle.ModeA,this.modeB=u?u:new cc.Particle.ModeB,this.isChangeColor=!1,this.drawPos=cc.p(0,0)},cc.Particle.ModeA=function(t,e,i){this.dir=t?t:cc.p(0,0),this.radialAccel=e||0,this.tangentialAccel=i||0},cc.Particle.ModeB=function(t,e,i,n){this.angle=t||0,this.degreesPerSecond=e||0,this.radius=i||0,this.deltaRadius=n||0},cc.Particle.TemporaryPoints=[cc.p(),cc.p(),cc.p(),cc.p()],cc.ParticleSystem=cc.Node.extend({_className:"ParticleSystem",_plistFile:"",_elapsed:0,_dontTint:!1,modeA:null,modeB:null,_pointZeroForParticle:cc.p(0,0),_particles:null,_emitCounter:0,_particleIdx:0,_batchNode:null,atlasIndex:0,_transformSystemDirty:!1,_allocatedParticles:0,_isActive:!1,particleCount:0,duration:0,_sourcePosition:null,_posVar:null,life:0,lifeVar:0,angle:0,angleVar:0,startSize:0,startSizeVar:0,endSize:0,endSizeVar:0,_startColor:null,_startColorVar:null,_endColor:null,_endColorVar:null,startSpin:0,startSpinVar:0,endSpin:0,endSpinVar:0,emissionRate:0,_totalParticles:0,_texture:null,_blendFunc:null,_opacityModifyRGB:!1,positionType:null,autoRemoveOnFinish:!1,emitterMode:0,_textureLoaded:null,ctor:function(t){cc.Node.prototype.ctor.call(this),this.emitterMode=cc.ParticleSystem.MODE_GRAVITY,this.modeA=new cc.ParticleSystem.ModeA,this.modeB=new cc.ParticleSystem.ModeB,this._blendFunc={src:cc.BLEND_SRC,dst:cc.BLEND_DST},this._particles=[],this._sourcePosition=cc.p(0,0),this._posVar=cc.p(0,0),this._startColor=cc.color(255,255,255,255),this._startColorVar=cc.color(255,255,255,255),this._endColor=cc.color(255,255,255,255),this._endColorVar=cc.color(255,255,255,255),this._plistFile="",this._elapsed=0,this._dontTint=!1,this._pointZeroForParticle=cc.p(0,0),this._particleIdx=this._emitCounter=0,this._batchNode=null,this.atlasIndex=0,this._transformSystemDirty=!1,this._allocatedParticles=0,this._isActive=!1,this._totalParticles=this.emissionRate=this.endSpinVar=this.endSpin=this.startSpinVar=this.startSpin=this.endSizeVar=this.endSize=this.startSizeVar=this.startSize=this.angleVar=this.angle=this.lifeVar=this.life=this.duration=this.particleCount=0,this._texture=null,this._opacityModifyRGB=!1,this.positionType=cc.ParticleSystem.TYPE_FREE,this.autoRemoveOnFinish=!1,this._textureLoaded=!0,!t||cc.isNumber(t)?(t=t||100,this.setDrawMode(cc.ParticleSystem.TEXTURE_MODE),this.initWithTotalParticles(t)):cc.isString(t)?this.initWithFile(t):cc.isObject(t)&&this.initWithDictionary(t,"")},_createRenderCmd:function(){return cc._renderType===cc._RENDER_TYPE_CANVAS?new cc.ParticleSystem.CanvasRenderCmd(this):new cc.ParticleSystem.WebGLRenderCmd(this)},ignoreColor:function(t){this._dontTint=t},initTexCoordsWithRect:function(t){this._renderCmd.initTexCoordsWithRect(t)},getBatchNode:function(){return this._batchNode},setBatchNode:function(t){this._renderCmd.setBatchNode(t)},getAtlasIndex:function(){return this.atlasIndex},setAtlasIndex:function(t){this.atlasIndex=t},getDrawMode:function(){return this._renderCmd.getDrawMode()},setDrawMode:function(t){this._renderCmd.setDrawMode(t)},getShapeType:function(){return this._renderCmd.getShapeType()},setShapeType:function(t){this._renderCmd.setShapeType(t)},isActive:function(){return this._isActive},getParticleCount:function(){return this.particleCount},setParticleCount:function(t){this.particleCount=t},getDuration:function(){return this.duration},setDuration:function(t){this.duration=t},getSourcePosition:function(){return{x:this._sourcePosition.x,y:this._sourcePosition.y}},setSourcePosition:function(t){this._sourcePosition=t},getPosVar:function(){return{x:this._posVar.x,y:this._posVar.y}},setPosVar:function(t){this._posVar=t},getLife:function(){return this.life},setLife:function(t){this.life=t},getLifeVar:function(){return this.lifeVar},setLifeVar:function(t){this.lifeVar=t},getAngle:function(){return this.angle},setAngle:function(t){this.angle=t},getAngleVar:function(){return this.angleVar},setAngleVar:function(t){this.angleVar=t},getGravity:function(){this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.getGravity() : Particle Mode should be Gravity");var t=this.modeA.gravity;return cc.p(t.x,t.y)},setGravity:function(t){this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.setGravity() : Particle Mode should be Gravity"),this.modeA.gravity=t},getSpeed:function(){return this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.getSpeed() : Particle Mode should be Gravity"),this.modeA.speed},setSpeed:function(t){this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.setSpeed() : Particle Mode should be Gravity"),this.modeA.speed=t},getSpeedVar:function(){return this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.getSpeedVar() : Particle Mode should be Gravity"),this.modeA.speedVar},setSpeedVar:function(t){this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.setSpeedVar() : Particle Mode should be Gravity"),this.modeA.speedVar=t},getTangentialAccel:function(){return this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.getTangentialAccel() : Particle Mode should be Gravity"),this.modeA.tangentialAccel},setTangentialAccel:function(t){this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.setTangentialAccel() : Particle Mode should be Gravity"),this.modeA.tangentialAccel=t},getTangentialAccelVar:function(){return this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.getTangentialAccelVar() : Particle Mode should be Gravity"),this.modeA.tangentialAccelVar},setTangentialAccelVar:function(t){this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.setTangentialAccelVar() : Particle Mode should be Gravity"),this.modeA.tangentialAccelVar=t},getRadialAccel:function(){return this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.getRadialAccel() : Particle Mode should be Gravity"),this.modeA.radialAccel},setRadialAccel:function(t){this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.setRadialAccel() : Particle Mode should be Gravity"),this.modeA.radialAccel=t},getRadialAccelVar:function(){return this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.getRadialAccelVar() : Particle Mode should be Gravity"),this.modeA.radialAccelVar},setRadialAccelVar:function(t){this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.setRadialAccelVar() : Particle Mode should be Gravity"),this.modeA.radialAccelVar=t},getRotationIsDir:function(){return this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.getRotationIsDir() : Particle Mode should be Gravity"),this.modeA.rotationIsDir},setRotationIsDir:function(t){this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.setRotationIsDir() : Particle Mode should be Gravity"),this.modeA.rotationIsDir=t},getStartRadius:function(){return this.emitterMode!==cc.ParticleSystem.MODE_RADIUS&&cc.log("cc.ParticleBatchNode.getStartRadius() : Particle Mode should be Radius"),this.modeB.startRadius},setStartRadius:function(t){this.emitterMode!==cc.ParticleSystem.MODE_RADIUS&&cc.log("cc.ParticleBatchNode.setStartRadius() : Particle Mode should be Radius"),this.modeB.startRadius=t},getStartRadiusVar:function(){return this.emitterMode!==cc.ParticleSystem.MODE_RADIUS&&cc.log("cc.ParticleBatchNode.getStartRadiusVar() : Particle Mode should be Radius"),this.modeB.startRadiusVar},setStartRadiusVar:function(t){this.emitterMode!==cc.ParticleSystem.MODE_RADIUS&&cc.log("cc.ParticleBatchNode.setStartRadiusVar() : Particle Mode should be Radius"),this.modeB.startRadiusVar=t},getEndRadius:function(){return this.emitterMode!==cc.ParticleSystem.MODE_RADIUS&&cc.log("cc.ParticleBatchNode.getEndRadius() : Particle Mode should be Radius"),this.modeB.endRadius},setEndRadius:function(t){this.emitterMode!==cc.ParticleSystem.MODE_RADIUS&&cc.log("cc.ParticleBatchNode.setEndRadius() : Particle Mode should be Radius"),this.modeB.endRadius=t},getEndRadiusVar:function(){return this.emitterMode!==cc.ParticleSystem.MODE_RADIUS&&cc.log("cc.ParticleBatchNode.getEndRadiusVar() : Particle Mode should be Radius"),this.modeB.endRadiusVar},setEndRadiusVar:function(t){this.emitterMode!==cc.ParticleSystem.MODE_RADIUS&&cc.log("cc.ParticleBatchNode.setEndRadiusVar() : Particle Mode should be Radius"),this.modeB.endRadiusVar=t},getRotatePerSecond:function(){return this.emitterMode!==cc.ParticleSystem.MODE_RADIUS&&cc.log("cc.ParticleBatchNode.getRotatePerSecond() : Particle Mode should be Radius"),this.modeB.rotatePerSecond},setRotatePerSecond:function(t){this.emitterMode!==cc.ParticleSystem.MODE_RADIUS&&cc.log("cc.ParticleBatchNode.setRotatePerSecond() : Particle Mode should be Radius"),this.modeB.rotatePerSecond=t},getRotatePerSecondVar:function(){return this.emitterMode!==cc.ParticleSystem.MODE_RADIUS&&cc.log("cc.ParticleBatchNode.getRotatePerSecondVar() : Particle Mode should be Radius"),this.modeB.rotatePerSecondVar},setRotatePerSecondVar:function(t){this.emitterMode!==cc.ParticleSystem.MODE_RADIUS&&cc.log("cc.ParticleBatchNode.setRotatePerSecondVar() : Particle Mode should be Radius"),this.modeB.rotatePerSecondVar=t},setScale:function(t,e){this._transformSystemDirty=!0,cc.Node.prototype.setScale.call(this,t,e)},setRotation:function(t){this._transformSystemDirty=!0,cc.Node.prototype.setRotation.call(this,t)},setScaleX:function(t){this._transformSystemDirty=!0,cc.Node.prototype.setScaleX.call(this,t)},setScaleY:function(t){this._transformSystemDirty=!0,cc.Node.prototype.setScaleY.call(this,t)},getStartSize:function(){return this.startSize},setStartSize:function(t){this.startSize=t},getStartSizeVar:function(){return this.startSizeVar},setStartSizeVar:function(t){this.startSizeVar=t},getEndSize:function(){return this.endSize},setEndSize:function(t){this.endSize=t},getEndSizeVar:function(){return this.endSizeVar},setEndSizeVar:function(t){this.endSizeVar=t},getStartColor:function(){return cc.color(this._startColor.r,this._startColor.g,this._startColor.b,this._startColor.a)},setStartColor:function(t){this._startColor=cc.color(t)},getStartColorVar:function(){return cc.color(this._startColorVar.r,this._startColorVar.g,this._startColorVar.b,this._startColorVar.a)},setStartColorVar:function(t){this._startColorVar=cc.color(t)},getEndColor:function(){return cc.color(this._endColor.r,this._endColor.g,this._endColor.b,this._endColor.a)},setEndColor:function(t){this._endColor=cc.color(t)},getEndColorVar:function(){return cc.color(this._endColorVar.r,this._endColorVar.g,this._endColorVar.b,this._endColorVar.a)},setEndColorVar:function(t){this._endColorVar=cc.color(t)},getStartSpin:function(){return this.startSpin},setStartSpin:function(t){this.startSpin=t},getStartSpinVar:function(){return this.startSpinVar},setStartSpinVar:function(t){this.startSpinVar=t},getEndSpin:function(){return this.endSpin},setEndSpin:function(t){this.endSpin=t},getEndSpinVar:function(){return this.endSpinVar},setEndSpinVar:function(t){this.endSpinVar=t},getEmissionRate:function(){return this.emissionRate},setEmissionRate:function(t){this.emissionRate=t},getTotalParticles:function(){return this._totalParticles},setTotalParticles:function(t){this._renderCmd.setTotalParticles(t)},getTexture:function(){return this._texture},setTexture:function(t){t&&(t.isLoaded()?this.setTextureWithRect(t,cc.rect(0,0,t.width,t.height)):(this._textureLoaded=!1,t.addEventListener("load",function(t){this._textureLoaded=!0,this.setTextureWithRect(t,cc.rect(0,0,t.width,t.height))},this)))},getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(t,e){void 0===e?this._blendFunc!==t&&(this._blendFunc=t,this._updateBlendFunc()):(this._blendFunc.src!==t||this._blendFunc.dst!==e)&&(this._blendFunc={src:t,dst:e},this._updateBlendFunc())},isOpacityModifyRGB:function(){return this._opacityModifyRGB},setOpacityModifyRGB:function(t){this._opacityModifyRGB=t},isBlendAdditive:function(){return this._blendFunc.src===cc.SRC_ALPHA&&this._blendFunc.dst===cc.ONE||this._blendFunc.src===cc.ONE&&this._blendFunc.dst===cc.ONE},setBlendAdditive:function(t){var e=this._blendFunc;t?(e.src=cc.SRC_ALPHA,e.dst=cc.ONE):this._renderCmd._setBlendAdditive()},getPositionType:function(){return this.positionType},setPositionType:function(t){this.positionType=t},isAutoRemoveOnFinish:function(){return this.autoRemoveOnFinish},setAutoRemoveOnFinish:function(t){this.autoRemoveOnFinish=t},getEmitterMode:function(){return this.emitterMode},setEmitterMode:function(t){this.emitterMode=t},init:function(){return this.initWithTotalParticles(150)},initWithFile:function(t){return this._plistFile=t,t=cc.loader.getRes(t),t?this.initWithDictionary(t,""):(cc.log("cc.ParticleSystem.initWithFile(): Particles: file not found"),!1)},getBoundingBoxToWorld:function(){return cc.rect(0,0,cc._canvas.width,cc._canvas.height)},initWithDictionary:function(t){var e=!1,i=null,i=this._valueForKey,n=parseInt(i("maxParticles",t));if(this.initWithTotalParticles(n)){if(this.angle=parseFloat(i("angle",t)),this.angleVar=parseFloat(i("angleVariance",t)),this.duration=parseFloat(i("duration",t)),this._blendFunc.src=parseInt(i("blendFuncSource",t)),this._blendFunc.dst=parseInt(i("blendFuncDestination",t)),e=this._startColor,e.r=255*parseFloat(i("startColorRed",t)),e.g=255*parseFloat(i("startColorGreen",t)),e.b=255*parseFloat(i("startColorBlue",t)),e.a=255*parseFloat(i("startColorAlpha",t)),e=this._startColorVar,e.r=255*parseFloat(i("startColorVarianceRed",t)),e.g=255*parseFloat(i("startColorVarianceGreen",t)),e.b=255*parseFloat(i("startColorVarianceBlue",t)),e.a=255*parseFloat(i("startColorVarianceAlpha",t)),e=this._endColor,e.r=255*parseFloat(i("finishColorRed",t)),e.g=255*parseFloat(i("finishColorGreen",t)),e.b=255*parseFloat(i("finishColorBlue",t)),e.a=255*parseFloat(i("finishColorAlpha",t)),e=this._endColorVar,e.r=255*parseFloat(i("finishColorVarianceRed",t)),e.g=255*parseFloat(i("finishColorVarianceGreen",t)),e.b=255*parseFloat(i("finishColorVarianceBlue",t)),e.a=255*parseFloat(i("finishColorVarianceAlpha",t)),this.startSize=parseFloat(i("startParticleSize",t)),this.startSizeVar=parseFloat(i("startParticleSizeVariance",t)),this.endSize=parseFloat(i("finishParticleSize",t)),this.endSizeVar=parseFloat(i("finishParticleSizeVariance",t)),this.setPosition(parseFloat(i("sourcePositionx",t)),parseFloat(i("sourcePositiony",t))),this._posVar.x=parseFloat(i("sourcePositionVariancex",t)),this._posVar.y=parseFloat(i("sourcePositionVariancey",t)),this.startSpin=parseFloat(i("rotationStart",t)),this.startSpinVar=parseFloat(i("rotationStartVariance",t)),this.endSpin=parseFloat(i("rotationEnd",t)),this.endSpinVar=parseFloat(i("rotationEndVariance",t)),this.emitterMode=parseInt(i("emitterType",t)),this.emitterMode===cc.ParticleSystem.MODE_GRAVITY)e=this.modeA,e.gravity.x=parseFloat(i("gravityx",t)),e.gravity.y=parseFloat(i("gravityy",t)),e.speed=parseFloat(i("speed",t)),e.speedVar=parseFloat(i("speedVariance",t)),n=i("radialAcceleration",t),e.radialAccel=n?parseFloat(n):0,n=i("radialAccelVariance",t),e.radialAccelVar=n?parseFloat(n):0,n=i("tangentialAcceleration",t),e.tangentialAccel=n?parseFloat(n):0,n=i("tangentialAccelVariance",t),e.tangentialAccelVar=n?parseFloat(n):0,n=i("rotationIsDir",t).toLowerCase(),e.rotationIsDir=null!=n&&("true"===n||"1"===n);else{if(this.emitterMode!==cc.ParticleSystem.MODE_RADIUS)return cc.log("cc.ParticleSystem.initWithDictionary(): Invalid emitterType in config file"),!1;e=this.modeB,e.startRadius=parseFloat(i("maxRadius",t)),e.startRadiusVar=parseFloat(i("maxRadiusVariance",t)),e.endRadius=parseFloat(i("minRadius",t)),e.endRadiusVar=0,e.rotatePerSecond=parseFloat(i("rotatePerSecond",t)),e.rotatePerSecondVar=parseFloat(i("rotatePerSecondVariance",t))}if(this.life=parseFloat(i("particleLifespan",t)),this.lifeVar=parseFloat(i("particleLifespanVariance",t)),this.emissionRate=this._totalParticles/this.life,!this._batchNode)if(this._opacityModifyRGB=!1,e=i("textureFileName",t),e=cc.path.changeBasename(this._plistFile,e),n=cc.textureCache.getTextureForKey(e))this.setTexture(n);else if((i=i("textureImageData",t))&&0!==i.length){if(i=cc.unzipBase64AsArray(i,1),!i)return cc.log("cc.ParticleSystem: error decoding or ungzipping textureImageData"),!1;
if(n=cc.getImageFormatByData(i),n!==cc.FMT_TIFF&&n!==cc.FMT_PNG)return cc.log("cc.ParticleSystem: unknown image format with Data"),!1;var r=cc.newElement("canvas");n===cc.FMT_PNG?new cc.PNGReader(i).render(r):cc.tiffReader.parseTIFF(i,r),cc.textureCache.cacheImage(e,r),(i=cc.textureCache.getTextureForKey(e))||cc.log("cc.ParticleSystem.initWithDictionary() : error loading the texture"),this.setTexture(i)}else{if(n=cc.textureCache.addImage(e),!n)return!1;this.setTexture(n)}e=!0}return e},initWithTotalParticles:function(t){this._totalParticles=t;var e,i=this._particles;for(e=i.length=0;t>e;e++)i[e]=new cc.Particle;if(!i)return cc.log("Particle system: not enough memory"),!1;if(this._allocatedParticles=t,this._batchNode)for(e=0;e<this._totalParticles;e++)i[e].atlasIndex=e;return this._isActive=!0,this._blendFunc.src=cc.BLEND_SRC,this._blendFunc.dst=cc.BLEND_DST,this.positionType=cc.ParticleSystem.TYPE_FREE,this.emitterMode=cc.ParticleSystem.MODE_GRAVITY,this._transformSystemDirty=this.autoRemoveOnFinish=!1,this.scheduleUpdateWithPriority(1),this._renderCmd._initWithTotalParticles(t),!0},destroyParticleSystem:function(){this.unscheduleUpdate()},addParticle:function(){if(this.isFull())return!1;var t=this._renderCmd.addParticle();return this.initParticle(t),++this.particleCount,!0},initParticle:function(t){var e=cc.randomMinus1To1;t.timeToLive=this.life+this.lifeVar*e(),t.timeToLive=Math.max(0,t.timeToLive),t.pos.x=this._sourcePosition.x+this._posVar.x*e(),t.pos.y=this._sourcePosition.y+this._posVar.y*e();var i,n;i=this._startColor;var r=this._startColorVar,o=this._endColor;if(n=this._endColorVar,i={r:cc.clampf(i.r+r.r*e(),0,255),g:cc.clampf(i.g+r.g*e(),0,255),b:cc.clampf(i.b+r.b*e(),0,255),a:cc.clampf(i.a+r.a*e(),0,255)},n={r:cc.clampf(o.r+n.r*e(),0,255),g:cc.clampf(o.g+n.g*e(),0,255),b:cc.clampf(o.b+n.b*e(),0,255),a:cc.clampf(o.a+n.a*e(),0,255)},t.color=i,r=t.deltaColor,o=t.timeToLive,r.r=(n.r-i.r)/o,r.g=(n.g-i.g)/o,r.b=(n.b-i.b)/o,r.a=(n.a-i.a)/o,i=this.startSize+this.startSizeVar*e(),i=Math.max(0,i),t.size=i,this.endSize===cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE?t.deltaSize=0:(n=this.endSize+this.endSizeVar*e(),n=Math.max(0,n),t.deltaSize=(n-i)/o),i=this.startSpin+this.startSpinVar*e(),n=this.endSpin+this.endSpinVar*e(),t.rotation=i,t.deltaRotation=(n-i)/o,this.positionType===cc.ParticleSystem.TYPE_FREE?t.startPos=this.convertToWorldSpace(this._pointZeroForParticle):this.positionType===cc.ParticleSystem.TYPE_RELATIVE&&(t.startPos.x=this._position.x,t.startPos.y=this._position.y),i=cc.degreesToRadians(this.angle+this.angleVar*e()),this.emitterMode===cc.ParticleSystem.MODE_GRAVITY)o=this.modeA,n=t.modeA,r=o.speed+o.speedVar*e(),n.dir.x=Math.cos(i),n.dir.y=Math.sin(i),cc.pMultIn(n.dir,r),n.radialAccel=o.radialAccel+o.radialAccelVar*e(),n.tangentialAccel=o.tangentialAccel+o.tangentialAccelVar*e(),o.rotationIsDir&&(t.rotation=-cc.radiansToDegrees(cc.pToAngle(n.dir)));else{n=this.modeB,t=t.modeB;var r=n.startRadius+n.startRadiusVar*e(),s=n.endRadius+n.endRadiusVar*e();t.radius=r,t.deltaRadius=n.endRadius===cc.ParticleSystem.START_RADIUS_EQUAL_TO_END_RADIUS?0:(s-r)/o,t.angle=i,t.degreesPerSecond=cc.degreesToRadians(n.rotatePerSecond+n.rotatePerSecondVar*e())}},stopSystem:function(){this._isActive=!1,this._elapsed=this.duration,this._emitCounter=0},resetSystem:function(){this._isActive=!0,this._elapsed=0;var t=this._particles;for(this._particleIdx=0;this._particleIdx<this.particleCount;++this._particleIdx)t[this._particleIdx].timeToLive=0},isFull:function(){return this.particleCount>=this._totalParticles},updateQuadWithParticle:function(t,e){this._renderCmd.updateQuadWithParticle(t,e)},postStep:function(){this._renderCmd.postStep()},update:function(t){if(this._isActive&&this.emissionRate){var e=1/this.emissionRate;for(this.particleCount<this._totalParticles&&(this._emitCounter+=t);this.particleCount<this._totalParticles&&this._emitCounter>e;)this.addParticle(),this._emitCounter-=e;this._elapsed+=t,-1!==this.duration&&this.duration<this._elapsed&&this.stopSystem()}if(this._particleIdx=0,e=cc.Particle.TemporaryPoints[0],this.positionType===cc.ParticleSystem.TYPE_FREE?cc.pIn(e,this.convertToWorldSpace(this._pointZeroForParticle)):this.positionType===cc.ParticleSystem.TYPE_RELATIVE&&(e.x=this._position.x,e.y=this._position.y),this._visible){for(var i=cc.Particle.TemporaryPoints[1],n=cc.Particle.TemporaryPoints[2],r=cc.Particle.TemporaryPoints[3],o=this._particles;this._particleIdx<this.particleCount;){cc.pZeroIn(i),cc.pZeroIn(n),cc.pZeroIn(r);var s=o[this._particleIdx];if(s.timeToLive-=t,0<s.timeToLive){if(this.emitterMode===cc.ParticleSystem.MODE_GRAVITY){var c=r,a=i,l=n;s.pos.x||s.pos.y?(cc.pIn(a,s.pos),cc.pNormalizeIn(a)):cc.pZeroIn(a),cc.pIn(l,a),cc.pMultIn(a,s.modeA.radialAccel);var h=l.x;l.x=-l.y,l.y=h,cc.pMultIn(l,s.modeA.tangentialAccel),cc.pIn(c,a),cc.pAddIn(c,l),cc.pAddIn(c,this.modeA.gravity),cc.pMultIn(c,t),cc.pAddIn(s.modeA.dir,c),cc.pIn(c,s.modeA.dir),cc.pMultIn(c,t),cc.pAddIn(s.pos,c)}else c=s.modeB,c.angle+=c.degreesPerSecond*t,c.radius+=c.deltaRadius*t,s.pos.x=-Math.cos(c.angle)*c.radius,s.pos.y=-Math.sin(c.angle)*c.radius;this._renderCmd._updateDeltaColor(s,t),s.size+=s.deltaSize*t,s.size=Math.max(0,s.size),s.rotation+=s.deltaRotation*t,c=i,this.positionType===cc.ParticleSystem.TYPE_FREE||this.positionType===cc.ParticleSystem.TYPE_RELATIVE?(a=n,cc.pIn(a,e),cc.pSubIn(a,s.startPos),cc.pIn(c,s.pos),cc.pSubIn(c,a)):cc.pIn(c,s.pos),this._batchNode&&(c.x+=this._position.x,c.y+=this._position.y),this._renderCmd.updateParticlePosition(s,c),++this._particleIdx}else if(s=s.atlasIndex,this._particleIdx!==this.particleCount-1&&(c=o[this._particleIdx],o[this._particleIdx]=o[this.particleCount-1],o[this.particleCount-1]=c),this._batchNode&&(this._batchNode.disableParticle(this.atlasIndex+s),o[this.particleCount-1].atlasIndex=s),--this.particleCount,0===this.particleCount&&this.autoRemoveOnFinish)return this.unscheduleUpdate(),void this._parent.removeChild(this,!0)}this._transformSystemDirty=!1}this._batchNode||this.postStep()},updateWithNoTime:function(){this.update(0)},_valueForKey:function(t,e){if(e){var i=e[t];return null!=i?i:""}return""},_updateBlendFunc:function(){if(this._batchNode)cc.log("Can't change blending functions when the particle is being batched");else{var t=this._texture;if(t&&t instanceof cc.Texture2D){this._opacityModifyRGB=!1;var e=this._blendFunc;e.src===cc.BLEND_SRC&&e.dst===cc.BLEND_DST&&(t.hasPremultipliedAlpha()?this._opacityModifyRGB=!0:(e.src=cc.SRC_ALPHA,e.dst=cc.ONE_MINUS_SRC_ALPHA))}}},clone:function(){var t=new cc.ParticleSystem;if(t.initWithTotalParticles(this.getTotalParticles())){t.setAngle(this.getAngle()),t.setAngleVar(this.getAngleVar()),t.setDuration(this.getDuration());var e=this.getBlendFunc();if(t.setBlendFunc(e.src,e.dst),t.setStartColor(this.getStartColor()),t.setStartColorVar(this.getStartColorVar()),t.setEndColor(this.getEndColor()),t.setEndColorVar(this.getEndColorVar()),t.setStartSize(this.getStartSize()),t.setStartSizeVar(this.getStartSizeVar()),t.setEndSize(this.getEndSize()),t.setEndSizeVar(this.getEndSizeVar()),t.setPosition(cc.p(this.x,this.y)),t.setPosVar(cc.p(this.getPosVar().x,this.getPosVar().y)),t.setPositionType(this.getPositionType()),t.setStartSpin(this.getStartSpin()||0),t.setStartSpinVar(this.getStartSpinVar()||0),t.setEndSpin(this.getEndSpin()||0),t.setEndSpinVar(this.getEndSpinVar()||0),t.setEmitterMode(this.getEmitterMode()),this.getEmitterMode()===cc.ParticleSystem.MODE_GRAVITY?(e=this.getGravity(),t.setGravity(cc.p(e.x,e.y)),t.setSpeed(this.getSpeed()),t.setSpeedVar(this.getSpeedVar()),t.setRadialAccel(this.getRadialAccel()),t.setRadialAccelVar(this.getRadialAccelVar()),t.setTangentialAccel(this.getTangentialAccel()),t.setTangentialAccelVar(this.getTangentialAccelVar())):this.getEmitterMode()===cc.ParticleSystem.MODE_RADIUS&&(t.setStartRadius(this.getStartRadius()),t.setStartRadiusVar(this.getStartRadiusVar()),t.setEndRadius(this.getEndRadius()),t.setEndRadiusVar(this.getEndRadiusVar()),t.setRotatePerSecond(this.getRotatePerSecond()),t.setRotatePerSecondVar(this.getRotatePerSecondVar())),t.setLife(this.getLife()),t.setLifeVar(this.getLifeVar()),t.setEmissionRate(this.getEmissionRate()),!this.getBatchNode()&&(t.setOpacityModifyRGB(this.isOpacityModifyRGB()),e=this.getTexture())){var i=e.getContentSize();t.setTextureWithRect(e,cc.rect(0,0,i.width,i.height))}}return t},setDisplayFrame:function(t){if(t){var e=t.getOffsetInPixels();0===e.x&&0===e.y||cc.log("cc.ParticleSystem.setDisplayFrame(): QuadParticle only supports SpriteFrames with no offsets"),t=t.getTexture(),this._texture!==t&&this.setTexture(t)}},setTextureWithRect:function(t,e){this._texture!==t&&(this._texture=t,this._updateBlendFunc()),this.initTexCoordsWithRect(e)},listenBackToForeground:function(){}}),_p=cc.ParticleSystem.prototype,cc.defineGetterSetter(_p,"opacityModifyRGB",_p.isOpacityModifyRGB,_p.setOpacityModifyRGB),cc.defineGetterSetter(_p,"batchNode",_p.getBatchNode,_p.setBatchNode),cc.defineGetterSetter(_p,"drawMode",_p.getDrawMode,_p.setDrawMode),cc.defineGetterSetter(_p,"shapeType",_p.getShapeType,_p.setShapeType),cc.defineGetterSetter(_p,"active",_p.isActive),cc.defineGetterSetter(_p,"sourcePos",_p.getSourcePosition,_p.setSourcePosition),cc.defineGetterSetter(_p,"posVar",_p.getPosVar,_p.setPosVar),cc.defineGetterSetter(_p,"gravity",_p.getGravity,_p.setGravity),cc.defineGetterSetter(_p,"speed",_p.getSpeed,_p.setSpeed),cc.defineGetterSetter(_p,"speedVar",_p.getSpeedVar,_p.setSpeedVar),cc.defineGetterSetter(_p,"tangentialAccel",_p.getTangentialAccel,_p.setTangentialAccel),cc.defineGetterSetter(_p,"tangentialAccelVar",_p.getTangentialAccelVar,_p.setTangentialAccelVar),cc.defineGetterSetter(_p,"radialAccel",_p.getRadialAccel,_p.setRadialAccel),cc.defineGetterSetter(_p,"radialAccelVar",_p.getRadialAccelVar,_p.setRadialAccelVar),cc.defineGetterSetter(_p,"rotationIsDir",_p.getRotationIsDir,_p.setRotationIsDir),cc.defineGetterSetter(_p,"startRadius",_p.getStartRadius,_p.setStartRadius),cc.defineGetterSetter(_p,"startRadiusVar",_p.getStartRadiusVar,_p.setStartRadiusVar),cc.defineGetterSetter(_p,"endRadius",_p.getEndRadius,_p.setEndRadius),cc.defineGetterSetter(_p,"endRadiusVar",_p.getEndRadiusVar,_p.setEndRadiusVar),cc.defineGetterSetter(_p,"rotatePerS",_p.getRotatePerSecond,_p.setRotatePerSecond),cc.defineGetterSetter(_p,"rotatePerSVar",_p.getRotatePerSecondVar,_p.setRotatePerSecondVar),cc.defineGetterSetter(_p,"startColor",_p.getStartColor,_p.setStartColor),cc.defineGetterSetter(_p,"startColorVar",_p.getStartColorVar,_p.setStartColorVar),cc.defineGetterSetter(_p,"endColor",_p.getEndColor,_p.setEndColor),cc.defineGetterSetter(_p,"endColorVar",_p.getEndColorVar,_p.setEndColorVar),cc.defineGetterSetter(_p,"totalParticles",_p.getTotalParticles,_p.setTotalParticles),cc.defineGetterSetter(_p,"texture",_p.getTexture,_p.setTexture),cc.ParticleSystem.create=function(t){return new cc.ParticleSystem(t)},cc.ParticleSystem.createWithTotalParticles=cc.ParticleSystem.create,cc.ParticleSystem.ModeA=function(t,e,i,n,r,o,s,c){this.gravity=t?t:cc.p(0,0),this.speed=e||0,this.speedVar=i||0,this.tangentialAccel=n||0,this.tangentialAccelVar=r||0,this.radialAccel=o||0,this.radialAccelVar=s||0,this.rotationIsDir=c||!1},cc.ParticleSystem.ModeB=function(t,e,i,n,r,o){this.startRadius=t||0,this.startRadiusVar=e||0,this.endRadius=i||0,this.endRadiusVar=n||0,this.rotatePerSecond=r||0,this.rotatePerSecondVar=o||0},cc.ParticleSystem.SHAPE_MODE=0,cc.ParticleSystem.TEXTURE_MODE=1,cc.ParticleSystem.STAR_SHAPE=0,cc.ParticleSystem.BALL_SHAPE=1,cc.ParticleSystem.DURATION_INFINITY=-1,cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE=-1,cc.ParticleSystem.START_RADIUS_EQUAL_TO_END_RADIUS=-1,cc.ParticleSystem.MODE_GRAVITY=0,cc.ParticleSystem.MODE_RADIUS=1,cc.ParticleSystem.TYPE_FREE=0,cc.ParticleSystem.TYPE_RELATIVE=1,cc.ParticleSystem.TYPE_GROUPED=2,function(){cc.ParticleSystem.CanvasRenderCmd=function(t){cc.Node.CanvasRenderCmd.call(this,t),this._needDraw=!0,this._drawMode=cc.ParticleSystem.TEXTURE_MODE,this._shapeType=cc.ParticleSystem.BALL_SHAPE,this._pointRect=cc.rect(0,0,0,0)};var t=cc.ParticleSystem.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);t.constructor=cc.ParticleSystem.CanvasRenderCmd,t.getDrawMode=function(){return this._drawMode},t.setDrawMode=function(t){this._drawMode=t},t.getShapeType=function(){return this._shapeType},t.setShapeType=function(t){this._shapeType=t},t.setBatchNode=function(t){this._batchNode!==t&&(this._node._batchNode=t)},t.updateQuadWithParticle=function(){},t.updateParticlePosition=function(t,e){cc.pIn(t.drawPos,e)},t.rendering=function(t,e,i){t=t||cc._renderContext;var n=t.getContext(),r=this._node,o=this._pointRect;t.setTransform(this._worldTransform,e,i),t.save(),n.globalCompositeOperation=r.isBlendAdditive()?"lighter":"source-over";var s,c;i=this._node.particleCount;var a=this._node._particles;if(r.drawMode!==cc.ParticleSystem.SHAPE_MODE&&r._texture){if(!r._texture._textureLoaded)return void t.restore();if(r=r._texture.getHtmlElementObj(),!r.width||!r.height)return void t.restore();for(s=r,e=0;i>e;e++)if(s=a[e],c=s.color.a/255,0!==c){n.globalAlpha=c,n.save(),n.translate(0|s.drawPos.x,-(0|s.drawPos.y));var l=4*Math.floor(s.size/4);c=o.width;var h=o.height;n.scale(Math.max(1/c*l,1e-6),Math.max(1/h*l,1e-6)),s.rotation&&n.rotate(cc.degreesToRadians(s.rotation)),s=s.isChangeColor?this._changeTextureColor(r,s.color,this._pointRect):r,n.drawImage(s,-(0|c/2),-(0|h/2)),n.restore()}}else for(h=cc._drawingUtil,e=0;i>e;e++)s=a[e],o=0|.5*s.size,c=s.color.a/255,0!==c&&(n.globalAlpha=c,n.save(),n.translate(0|s.drawPos.x,-(0|s.drawPos.y)),r.shapeType===cc.ParticleSystem.STAR_SHAPE?(s.rotation&&n.rotate(cc.degreesToRadians(s.rotation)),h.drawStar(t,o,s.color)):h.drawColorBall(t,o,s.color),n.restore());t.restore(),cc.g_NumberOfDraws++},t._changeTextureColor=cc.sys._supportCanvasNewBlendModes?function(t,e,i){return t.tintCache||(t.tintCache=document.createElement("canvas"),t.tintCache.width=t.width,t.tintCache.height=t.height),cc.Sprite.CanvasRenderCmd._generateTintImageWithMultiply(t,e,i,t.tintCache)}:function(t,e,i){var n=cc.textureCache.getTextureColors(t);return n?(n.tintCache||(n.tintCache=document.createElement("canvas"),n.tintCache.width=t.width,n.tintCache.height=t.height),cc.Sprite.CanvasRenderCmd._generateTintImage(t,n,e,i,n.tintCache),n.tintCache):null},t.initTexCoordsWithRect=function(t){this._pointRect=t},t.setTotalParticles=function(t){this._node._totalParticles=200>t?t:200},t.addParticle=function(){var t=this._node,e=t._particles;return t.particleCount<e.length?t=e[t.particleCount]:(t=new cc.Particle,e.push(t)),t},t._setupVBO=function(){},t._allocMemory=function(){return!0},t.postStep=function(){},t._setBlendAdditive=function(){var t=this._node._blendFunc;t.src=cc.BLEND_SRC,t.dst=cc.BLEND_DST},t._initWithTotalParticles=function(){},t._updateDeltaColor=function(t,e){this._node._dontTint||(t.color.r+=t.deltaColor.r*e,t.color.g+=t.deltaColor.g*e,t.color.b+=t.deltaColor.b*e,t.color.a+=t.deltaColor.a*e,t.isChangeColor=!0)}}(),function(){cc.ParticleSystem.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._buffersVBO=[0,0],this._quads=[],this._indices=[],this._quadsArrayBuffer=null};var t=cc.ParticleSystem.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);t.constructor=cc.ParticleSystem.WebGLRenderCmd,t.getDrawMode=function(){},t.setDrawMode=function(){},t.getShapeType=function(){},t.setShapeType=function(){},t.setBatchNode=function(t){var e=this._node;if(e._batchNode!==t){var i=e._batchNode;if(e._batchNode=t)for(var n=e._particles,r=0;r<e._totalParticles;r++)n[r].atlasIndex=r;t?i||(e._batchNode.textureAtlas._copyQuadsToTextureAtlas(this._quads,e.atlasIndex),cc._renderContext.deleteBuffer(this._buffersVBO[1])):(this._allocMemory(),this.initIndices(e._totalParticles),e.setTexture(i.getTexture()),this._setupVBO())}},t.initIndices=function(t){for(var e=this._indices,i=0;t>i;++i){var n=6*i,r=4*i;e[n+0]=r+0,e[n+1]=r+1,e[n+2]=r+2,e[n+5]=r+1,e[n+4]=r+2,e[n+3]=r+3}},t.isDifferentTexture=function(t,e){return t===e},t.updateParticlePosition=function(t,e){this.updateQuadWithParticle(t,e)},t.updateQuadWithParticle=function(t,e){var i=null,n=this._node;n._batchNode?(i=n._batchNode.textureAtlas.quads[n.atlasIndex+t.atlasIndex],n._batchNode.textureAtlas.dirty=!0):i=this._quads[n._particleIdx];var r,o,s;n._opacityModifyRGB?(n=0|t.color.r*t.color.a/255,r=0|t.color.g*t.color.a/255,o=0|t.color.b*t.color.a/255):(n=0|t.color.r,r=0|t.color.g,o=0|t.color.b),s=0|t.color.a;var c=i.bl.colors,a=i.br.colors,l=i.tl.colors,h=i.tr.colors;c.r=a.r=l.r=h.r=n,c.g=a.g=l.g=h.g=r,c.b=a.b=l.b=h.b=o,c.a=a.a=l.a=h.a=s,n=t.size/2,t.rotation?(r=-n,o=-n,s=e.x,c=e.y,l=-cc.degreesToRadians(t.rotation),a=Math.cos(l),l=Math.sin(l),i.bl.vertices.x=r*a-o*l+s,i.bl.vertices.y=r*l+o*a+c,i.br.vertices.x=n*a-o*l+s,i.br.vertices.y=n*l+o*a+c,i.tl.vertices.x=r*a-n*l+s,i.tl.vertices.y=r*l+n*a+c,i.tr.vertices.x=n*a-n*l+s,i.tr.vertices.y=n*l+n*a+c):(i.bl.vertices.x=e.x-n,i.bl.vertices.y=e.y-n,i.br.vertices.x=e.x+n,i.br.vertices.y=e.y-n,i.tl.vertices.x=e.x-n,i.tl.vertices.y=e.y+n,i.tr.vertices.x=e.x+n,i.tr.vertices.y=e.y+n)},t.rendering=function(t){var e=this._node;e._texture&&(t=t||cc._renderContext,this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix),cc.glBindTexture2D(e._texture),cc.glBlendFuncForParticle(e._blendFunc.src,e._blendFunc.dst),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX),t.bindBuffer(t.ARRAY_BUFFER,this._buffersVBO[0]),t.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,t.FLOAT,!1,24,0),t.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,t.UNSIGNED_BYTE,!0,24,12),t.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,t.FLOAT,!1,24,16),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._buffersVBO[1]),t.drawElements(t.TRIANGLES,6*e._particleIdx,t.UNSIGNED_SHORT,0))},t.initTexCoordsWithRect=function(t){var e=this._node,i=e.texture,n=cc.contentScaleFactor(),r=cc.rect(t.x*n,t.y*n,t.width*n,t.height*n),n=t.width,o=t.height;i&&(n=i.pixelsWidth,o=i.pixelsHeight),cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(i=(2*r.x+1)/(2*n),t=(2*r.y+1)/(2*o),n=i+(2*r.width-2)/(2*n),r=t+(2*r.height-2)/(2*o)):(i=r.x/n,t=r.y/o,n=i+r.width/n,r=t+r.height/o),o=r,r=t,t=o;var s=0,c=0;for(e._batchNode?(o=e._batchNode.textureAtlas.quads,s=e.atlasIndex,c=e.atlasIndex+e._totalParticles):(o=this._quads,s=0,c=e._totalParticles),e=s;c>e;e++)o[e]||(o[e]=cc.V3F_C4B_T2F_QuadZero()),s=o[e],s.bl.texCoords.u=i,s.bl.texCoords.v=t,s.br.texCoords.u=n,s.br.texCoords.v=t,s.tl.texCoords.u=i,s.tl.texCoords.v=r,s.tr.texCoords.u=n,s.tr.texCoords.v=r},t.setTotalParticles=function(t){var e=this._node;if(t>e._allocatedParticles){var i=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;this._indices=new Uint16Array(6*t);var n=new ArrayBuffer(t*i),r=e._particles;r.length=0;for(var o=this._quads,s=o.length=0;t>s;s++)r[s]=new cc.Particle,o[s]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,n,s*i);if(e._allocatedParticles=t,e._totalParticles=t,e._batchNode)for(i=0;t>i;i++)r[i].atlasIndex=i;this._quadsArrayBuffer=n,this.initIndices(t),this._setupVBO(),e._texture&&this.initTexCoordsWithRect(cc.rect(0,0,e._texture.width,e._texture.height))}else e._totalParticles=t;e.resetSystem()},t.addParticle=function(){var t=this._node;return t._particles[t.particleCount]},t._setupVBO=function(){var t=cc._renderContext;this._buffersVBO[0]=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this._buffersVBO[0]),t.bufferData(t.ARRAY_BUFFER,this._quadsArrayBuffer,t.DYNAMIC_DRAW),this._buffersVBO[1]=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._buffersVBO[1]),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this._indices,t.STATIC_DRAW)},t._allocMemory=function(){var t=this._node;if(t._batchNode)return cc.log("cc.ParticleSystem._allocMemory(): Memory should not be allocated when not using batchNode"),!1;var e=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,t=t._totalParticles,i=this._quads;i.length=0,this._indices=new Uint16Array(6*t);for(var n=new ArrayBuffer(e*t),r=0;t>r;r++)i[r]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,n,r*e);return i&&this._indices?(this._quadsArrayBuffer=n,!0):(cc.log("cocos2d: Particle system: not enough memory"),!1)},t.postStep=function(){var t=cc._renderContext;t.bindBuffer(t.ARRAY_BUFFER,this._buffersVBO[0]),t.bufferData(t.ARRAY_BUFFER,this._quadsArrayBuffer,t.DYNAMIC_DRAW)},t._setBlendAdditive=function(){var t=this._node._blendFunc;this._texture&&!this._texture.hasPremultipliedAlpha()?(t.src=cc.SRC_ALPHA,t.dst=cc.ONE_MINUS_SRC_ALPHA):(t.src=cc.BLEND_SRC,t.dst=cc.BLEND_DST)},t._initWithTotalParticles=function(t){return this._allocMemory()?(this.initIndices(t),this._setupVBO(),void(this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURECOLOR))):!1},t._updateDeltaColor=function(t,e){t.color.r+=t.deltaColor.r*e,t.color.g+=t.deltaColor.g*e,t.color.b+=t.deltaColor.b*e,t.color.a+=t.deltaColor.a*e,t.isChangeColor=!0}}(),cc.ParticleFire=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc._RENDER_TYPE_WEBGL?300:150)},initWithTotalParticles:function(t){return cc.ParticleSystem.prototype.initWithTotalParticles.call(this,t)?(this.setDuration(cc.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY),this.setGravity(cc.p(0,0)),this.setRadialAccel(0),this.setRadialAccelVar(0),this.setSpeed(60),this.setSpeedVar(20),this.setAngle(90),this.setAngleVar(10),t=cc.director.getWinSize(),this.setPosition(t.width/2,60),this.setPosVar(cc.p(40,20)),this.setLife(3),this.setLifeVar(.25),this.setStartSize(54),this.setStartSizeVar(10),this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(cc.color(194,64,31,255)),this.setStartColorVar(cc.color(0,0,0,0)),this.setEndColor(cc.color(0,0,0,255)),this.setEndColorVar(cc.color(0,0,0,0)),this.setBlendAdditive(!0),!0):!1}}),cc.ParticleFire.create=function(){return new cc.ParticleFire},cc.ParticleFireworks=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc._RENDER_TYPE_WEBGL?1500:150)},initWithTotalParticles:function(t){return cc.ParticleSystem.prototype.initWithTotalParticles.call(this,t)?(this.setDuration(cc.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY),this.setGravity(cc.p(0,-90)),this.setRadialAccel(0),this.setRadialAccelVar(0),this.setSpeed(180),this.setSpeedVar(50),t=cc.director.getWinSize(),this.setPosition(t.width/2,t.height/2),this.setAngle(90),this.setAngleVar(20),this.setLife(3.5),this.setLifeVar(1),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(cc.color(128,128,128,255)),this.setStartColorVar(cc.color(128,128,128,255)),this.setEndColor(cc.color(26,26,26,51)),this.setEndColorVar(cc.color(26,26,26,51)),this.setStartSize(8),this.setStartSizeVar(2),this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setBlendAdditive(!1),!0):!1}}),cc.ParticleFireworks.create=function(){return new cc.ParticleFireworks},cc.ParticleSun=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc._RENDER_TYPE_WEBGL?350:150)},initWithTotalParticles:function(t){return cc.ParticleSystem.prototype.initWithTotalParticles.call(this,t)?(this.setBlendAdditive(!0),this.setDuration(cc.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY),this.setGravity(cc.p(0,0)),this.setRadialAccel(0),this.setRadialAccelVar(0),this.setSpeed(20),this.setSpeedVar(5),this.setAngle(90),this.setAngleVar(360),t=cc.director.getWinSize(),this.setPosition(t.width/2,t.height/2),this.setPosVar(cc.p(0,0)),this.setLife(1),this.setLifeVar(.5),this.setStartSize(30),this.setStartSizeVar(10),this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(cc.color(194,64,31,255)),this.setStartColorVar(cc.color(0,0,0,0)),this.setEndColor(cc.color(0,0,0,255)),this.setEndColorVar(cc.color(0,0,0,0)),!0):!1}}),cc.ParticleSun.create=function(){return new cc.ParticleSun},cc.ParticleGalaxy=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc._RENDER_TYPE_WEBGL?200:100)},initWithTotalParticles:function(t){return cc.ParticleSystem.prototype.initWithTotalParticles.call(this,t)?(this.setDuration(cc.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY),this.setGravity(cc.p(0,0)),this.setSpeed(60),this.setSpeedVar(10),this.setRadialAccel(-80),this.setRadialAccelVar(0),this.setTangentialAccel(80),this.setTangentialAccelVar(0),this.setAngle(90),this.setAngleVar(360),t=cc.director.getWinSize(),this.setPosition(t.width/2,t.height/2),this.setPosVar(cc.p(0,0)),this.setLife(4),this.setLifeVar(1),this.setStartSize(37),this.setStartSizeVar(10),this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(cc.color(31,64,194,255)),this.setStartColorVar(cc.color(0,0,0,0)),this.setEndColor(cc.color(0,0,0,255)),this.setEndColorVar(cc.color(0,0,0,0)),this.setBlendAdditive(!0),!0):!1}}),cc.ParticleGalaxy.create=function(){return new cc.ParticleGalaxy},cc.ParticleFlower=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc._RENDER_TYPE_WEBGL?250:100)},initWithTotalParticles:function(t){return cc.ParticleSystem.prototype.initWithTotalParticles.call(this,t)?(this.setDuration(cc.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY),this.setGravity(cc.p(0,0)),this.setSpeed(80),this.setSpeedVar(10),this.setRadialAccel(-60),this.setRadialAccelVar(0),this.setTangentialAccel(15),this.setTangentialAccelVar(0),this.setAngle(90),this.setAngleVar(360),t=cc.director.getWinSize(),this.setPosition(t.width/2,t.height/2),this.setPosVar(cc.p(0,0)),this.setLife(4),this.setLifeVar(1),this.setStartSize(30),this.setStartSizeVar(10),this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(cc.color(128,128,128,255)),this.setStartColorVar(cc.color(128,128,128,128)),this.setEndColor(cc.color(0,0,0,255)),this.setEndColorVar(cc.color(0,0,0,0)),this.setBlendAdditive(!0),!0):!1}}),cc.ParticleFlower.create=function(){return new cc.ParticleFlower},cc.ParticleMeteor=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc._RENDER_TYPE_WEBGL?150:100)},initWithTotalParticles:function(t){return cc.ParticleSystem.prototype.initWithTotalParticles.call(this,t)?(this.setDuration(cc.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY),this.setGravity(cc.p(-200,200)),this.setSpeed(15),this.setSpeedVar(5),this.setRadialAccel(0),this.setRadialAccelVar(0),this.setTangentialAccel(0),this.setTangentialAccelVar(0),this.setAngle(90),this.setAngleVar(360),t=cc.director.getWinSize(),this.setPosition(t.width/2,t.height/2),this.setPosVar(cc.p(0,0)),this.setLife(2),this.setLifeVar(1),this.setStartSize(60),this.setStartSizeVar(10),this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(cc.color(51,102,179)),this.setStartColorVar(cc.color(0,0,51,26)),this.setEndColor(cc.color(0,0,0,255)),this.setEndColorVar(cc.color(0,0,0,0)),this.setBlendAdditive(!0),!0):!1}}),cc.ParticleMeteor.create=function(){return new cc.ParticleMeteor},cc.ParticleSpiral=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc._RENDER_TYPE_WEBGL?500:100)},initWithTotalParticles:function(t){return cc.ParticleSystem.prototype.initWithTotalParticles.call(this,t)?(this.setDuration(cc.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY),this.setGravity(cc.p(0,0)),this.setSpeed(150),this.setSpeedVar(0),this.setRadialAccel(-380),this.setRadialAccelVar(0),this.setTangentialAccel(45),this.setTangentialAccelVar(0),this.setAngle(90),this.setAngleVar(0),t=cc.director.getWinSize(),this.setPosition(t.width/2,t.height/2),this.setPosVar(cc.p(0,0)),this.setLife(12),this.setLifeVar(0),this.setStartSize(20),this.setStartSizeVar(0),this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(cc.color(128,128,128,255)),this.setStartColorVar(cc.color(128,128,128,0)),this.setEndColor(cc.color(128,128,128,255)),this.setEndColorVar(cc.color(128,128,128,0)),this.setBlendAdditive(!1),!0):!1}}),cc.ParticleSpiral.create=function(){return new cc.ParticleSpiral},cc.ParticleExplosion=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc._RENDER_TYPE_WEBGL?700:300)},initWithTotalParticles:function(t){return cc.ParticleSystem.prototype.initWithTotalParticles.call(this,t)?(this.setDuration(.1),this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY),this.setGravity(cc.p(0,0)),this.setSpeed(70),this.setSpeedVar(40),this.setRadialAccel(0),this.setRadialAccelVar(0),this.setTangentialAccel(0),this.setTangentialAccelVar(0),this.setAngle(90),this.setAngleVar(360),t=cc.director.getWinSize(),this.setPosition(t.width/2,t.height/2),this.setPosVar(cc.p(0,0)),this.setLife(5),this.setLifeVar(2),this.setStartSize(15),this.setStartSizeVar(10),this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getDuration()),this.setStartColor(cc.color(179,26,51,255)),this.setStartColorVar(cc.color(128,128,128,0)),this.setEndColor(cc.color(128,128,128,0)),this.setEndColorVar(cc.color(128,128,128,0)),this.setBlendAdditive(!1),!0):!1}}),cc.ParticleExplosion.create=function(){return new cc.ParticleExplosion},cc.ParticleSmoke=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc._RENDER_TYPE_WEBGL?200:100)},initWithTotalParticles:function(t){return cc.ParticleSystem.prototype.initWithTotalParticles.call(this,t)?(this.setDuration(cc.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY),this.setGravity(cc.p(0,0)),this.setRadialAccel(0),this.setRadialAccelVar(0),this.setSpeed(25),this.setSpeedVar(10),this.setAngle(90),this.setAngleVar(5),t=cc.director.getWinSize(),this.setPosition(t.width/2,0),this.setPosVar(cc.p(20,0)),this.setLife(4),this.setLifeVar(1),this.setStartSize(60),this.setStartSizeVar(10),this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(cc.color(204,204,204,255)),this.setStartColorVar(cc.color(5,5,5,0)),this.setEndColor(cc.color(0,0,0,255)),this.setEndColorVar(cc.color(0,0,0,0)),this.setBlendAdditive(!1),!0):!1}}),cc.ParticleSmoke.create=function(){return new cc.ParticleSmoke},cc.ParticleSnow=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc._RENDER_TYPE_WEBGL?700:250)},initWithTotalParticles:function(t){return cc.ParticleSystem.prototype.initWithTotalParticles.call(this,t)?(this.setDuration(cc.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY),this.setGravity(cc.p(0,-1)),this.setSpeed(5),this.setSpeedVar(1),this.setRadialAccel(0),this.setRadialAccelVar(1),this.setTangentialAccel(0),this.setTangentialAccelVar(1),t=cc.director.getWinSize(),this.setPosition(t.width/2,t.height+10),this.setPosVar(cc.p(t.width/2,0)),this.setAngle(-90),this.setAngleVar(5),this.setLife(45),this.setLifeVar(15),this.setStartSize(10),this.setStartSizeVar(5),this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(10),this.setStartColor(cc.color(255,255,255,255)),this.setStartColorVar(cc.color(0,0,0,0)),this.setEndColor(cc.color(255,255,255,0)),this.setEndColorVar(cc.color(0,0,0,0)),this.setBlendAdditive(!1),!0):!1
}}),cc.ParticleSnow.create=function(){return new cc.ParticleSnow},cc.ParticleRain=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc._RENDER_TYPE_WEBGL?1e3:300)},initWithTotalParticles:function(t){return cc.ParticleSystem.prototype.initWithTotalParticles.call(this,t)?(this.setDuration(cc.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY),this.setGravity(cc.p(10,-10)),this.setRadialAccel(0),this.setRadialAccelVar(1),this.setTangentialAccel(0),this.setTangentialAccelVar(1),this.setSpeed(130),this.setSpeedVar(30),this.setAngle(-90),this.setAngleVar(5),t=cc.director.getWinSize(),this.setPosition(t.width/2,t.height),this.setPosVar(cc.p(t.width/2,0)),this.setLife(4.5),this.setLifeVar(0),this.setStartSize(4),this.setStartSizeVar(2),this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(20),this.setStartColor(cc.color(179,204,255,255)),this.setStartColorVar(cc.color(0,0,0,0)),this.setEndColor(cc.color(179,204,255,128)),this.setEndColorVar(cc.color(0,0,0,0)),this.setBlendAdditive(!1),!0):!1}}),cc.ParticleRain.create=function(){return new cc.ParticleRain},cc.PARTICLE_DEFAULT_CAPACITY=500,cc.ParticleBatchNode=cc.Node.extend({textureAtlas:null,_blendFunc:null,_className:"ParticleBatchNode",ctor:function(t,e){cc.Node.prototype.ctor.call(this),this._blendFunc={src:cc.BLEND_SRC,dst:cc.BLEND_DST},cc.isString(t)?this.init(t,e):t instanceof cc.Texture2D&&this.initWithTexture(t,e)},_createRenderCmd:function(){return cc._renderType===cc._RENDER_TYPE_CANVAS?new cc.ParticleBatchNode.CanvasRenderCmd(this):new cc.ParticleBatchNode.WebGLRenderCmd(this)},initWithTexture:function(t,e){return this.textureAtlas=new cc.TextureAtlas,this.textureAtlas.initWithTexture(t,e),this._children.length=0,this._renderCmd._initWithTexture(),!0},initWithFile:function(t,e){var i=cc.textureCache.addImage(t);return this.initWithTexture(i,e)},init:function(t,e){var i=cc.textureCache.addImage(t);return this.initWithTexture(i,e)},addChild:function(t,e,i){if(!t)throw"cc.ParticleBatchNode.addChild() : child should be non-null";if(!(t instanceof cc.ParticleSystem))throw"cc.ParticleBatchNode.addChild() : only supports cc.ParticleSystem as children";if(e=null==e?t.zIndex:e,i=null==i?t.tag:i,t.getTexture()!==this.textureAtlas.texture)throw"cc.ParticleSystem.addChild() : the child is not using the same texture id";var n=t.getBlendFunc();if(0===this._children.length)this.setBlendFunc(n);else if(n.src!==this._blendFunc.src||n.dst!==this._blendFunc.dst)return void cc.log("cc.ParticleSystem.addChild() : Can't add a ParticleSystem that uses a different blending function");e=this._addChildHelper(t,e,i),i=0,0!==e?(e=this._children[e-1],i=e.getAtlasIndex()+e.getTotalParticles()):i=0,this.insertChild(t,i),t.setBatchNode(this)},insertChild:function(t,e){var i=t.getTotalParticles(),n=this.textureAtlas,r=n.totalQuads;t.setAtlasIndex(e),r+i>n.getCapacity()&&(this._increaseAtlasCapacityTo(r+i),n.fillWithEmptyQuadsFromIndex(n.getCapacity()-i,i)),t.getAtlasIndex()+i!==r&&n.moveQuadsFromIndex(e,e+i),n.increaseTotalQuadsWith(i),this._updateAllAtlasIndexes()},removeChild:function(t,e){if(null!=t){if(!(t instanceof cc.ParticleSystem))throw"cc.ParticleBatchNode.removeChild(): only supports cc.ParticleSystem as children";if(-1===this._children.indexOf(t))cc.log("cc.ParticleBatchNode.removeChild(): doesn't contain the sprite. Can't remove it");else{cc.Node.prototype.removeChild.call(this,t,e);var i=this.textureAtlas;i.removeQuadsAtIndex(t.getAtlasIndex(),t.getTotalParticles()),i.fillWithEmptyQuadsFromIndex(i.totalQuads,t.getTotalParticles()),t.setBatchNode(null),this._updateAllAtlasIndexes()}}},reorderChild:function(t,e){if(!t)throw"cc.ParticleBatchNode.reorderChild(): child should be non-null";if(!(t instanceof cc.ParticleSystem))throw"cc.ParticleBatchNode.reorderChild(): only supports cc.QuadParticleSystems as children";if(-1===this._children.indexOf(t))cc.log("cc.ParticleBatchNode.reorderChild(): Child doesn't belong to batch");else if(e!==t.zIndex){if(1<this._children.length){var i=this._getCurrentIndex(t,e);if(i.oldIndex!==i.newIndex){this._children.splice(i.oldIndex,1),this._children.splice(i.newIndex,0,t),i=t.getAtlasIndex(),this._updateAllAtlasIndexes();for(var n=0,r=this._children,o=0;o<r.length;o++)if(r[o]===t){n=t.getAtlasIndex();break}this.textureAtlas.moveQuadsFromIndex(i,t.getTotalParticles(),n),t.updateWithNoTime()}}t._setLocalZOrder(e)}},removeChildAtIndex:function(t,e){this.removeChild(this._children[i],e)},removeAllChildren:function(t){for(var e=this._children,i=0;i<e.length;i++)e[i].setBatchNode(null);cc.Node.prototype.removeAllChildren.call(this,t),this.textureAtlas.removeAllQuads()},disableParticle:function(t){t=this.textureAtlas.quads[t],t.br.vertices.x=t.br.vertices.y=t.tr.vertices.x=t.tr.vertices.y=t.tl.vertices.x=t.tl.vertices.y=t.bl.vertices.x=t.bl.vertices.y=0,this.textureAtlas._setDirty(!0)},getTexture:function(){return this.textureAtlas.texture},setTexture:function(t){this.textureAtlas.texture=t;var e=this._blendFunc;t&&!t.hasPremultipliedAlpha()&&e.src===cc.BLEND_SRC&&e.dst===cc.BLEND_DST&&(e.src=cc.SRC_ALPHA,e.dst=cc.ONE_MINUS_SRC_ALPHA)},setBlendFunc:function(t,e){void 0===e?(this._blendFunc.src=t.src,this._blendFunc.dst=t.dst):(this._blendFunc.src=t,this._blendFunc.src=e)},getBlendFunc:function(){return new cc.BlendFunc(this._blendFunc.src,this._blendFunc.dst)},_updateAllAtlasIndexes:function(){for(var t=0,e=this._children,i=0;i<e.length;i++){var n=e[i];n.setAtlasIndex(t),t+=n.getTotalParticles()}},_increaseAtlasCapacityTo:function(t){cc.log("cocos2d: cc.ParticleBatchNode: resizing TextureAtlas capacity from ["+this.textureAtlas.getCapacity()+"] to ["+t+"]."),this.textureAtlas.resizeCapacity(t)||cc.log("cc.ParticleBatchNode._increaseAtlasCapacityTo() : WARNING: Not enough memory to resize the atlas")},_searchNewPositionInChildrenForZ:function(t){for(var e=this._children,i=e.length,n=0;i>n;n++)if(e[n].zIndex>t)return n;return i},_getCurrentIndex:function(t,e){for(var i=!1,n=!1,r=0,o=0,s=0,c=this._children,a=c.length,l=0;a>l;l++){var h=c[l];if(h.zIndex>e&&!n&&(r=l,n=!0,i&&n))break;if(t===h&&(o=l,i=!0,n||(s=-1),i&&n))break}return n||(r=a),{newIndex:r+s,oldIndex:o}},_addChildHelper:function(t,e,i){if(!t)throw"cc.ParticleBatchNode._addChildHelper(): child should be non-null";if(t.parent)return cc.log("cc.ParticleBatchNode._addChildHelper(): child already added. It can't be added again"),null;this._children||(this._children=[]);var n=this._searchNewPositionInChildrenForZ(e);return this._children.splice(n,0,t),t.tag=i,t._setLocalZOrder(e),t.parent=this,this._running&&(t.onEnter(),t.onEnterTransitionDidFinish()),n},_updateBlendFunc:function(){this.textureAtlas.texture.hasPremultipliedAlpha()||(this._blendFunc.src=cc.SRC_ALPHA,this._blendFunc.dst=cc.ONE_MINUS_SRC_ALPHA)},getTextureAtlas:function(){return this.textureAtlas},setTextureAtlas:function(t){this.textureAtlas=t}}),_p=cc.ParticleBatchNode.prototype,cc.defineGetterSetter(_p,"texture",_p.getTexture,_p.setTexture),cc.ParticleBatchNode.create=function(t,e){return new cc.ParticleBatchNode(t,e)},function(){cc.ParticleBatchNode.CanvasRenderCmd=function(t){cc.Node.CanvasRenderCmd.call(this,t),this._needDraw=!1};var t=cc.ParticleBatchNode.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);t.constructor=cc.ParticleBatchNode.CanvasRenderCmd,t._initWithTexture=function(){}}(),function(){cc.ParticleBatchNode.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0};var t=cc.ParticleBatchNode.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);t.constructor=cc.ParticleBatchNode.WebGLRenderCmd,t.rendering=function(t){t=this._node,0!==t.textureAtlas.totalQuads&&(this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix),cc.glBlendFuncForParticle(t._blendFunc.src,t._blendFunc.dst),t.textureAtlas.drawQuads())},t._initWithTexture=function(){this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURECOLOR)},t.visit=function(t){if(this._node._visible){var e=cc.current_stack;e.stack.push(e.top),this._syncStatus(t),e.top=this._stackMatrix,cc.renderer.pushRenderCommand(this),this._dirtyFlag=0,cc.kmGLPopMatrix()}}}(),cc.IMEKeyboardNotificationInfo=function(t,e,i){this.begin=t||cc.rect(0,0,0,0),this.end=e||cc.rect(0,0,0,0),this.duration=i||0},cc.IMEDelegate=cc.Class.extend({ctor:function(){cc.imeDispatcher.addDelegate(this)},removeDelegate:function(){cc.imeDispatcher.removeDelegate(this)},attachWithIME:function(){return cc.imeDispatcher.attachDelegateWithIME(this)},detachWithIME:function(){return cc.imeDispatcher.detachDelegateWithIME(this)},canAttachWithIME:function(){return!1},didAttachWithIME:function(){},canDetachWithIME:function(){return!1},didDetachWithIME:function(){},insertText:function(){},deleteBackward:function(){},getContentText:function(){return""},keyboardWillShow:function(){},keyboardDidShow:function(){},keyboardWillHide:function(){},keyboardDidHide:function(){}}),cc.IMEDispatcher=cc.Class.extend({_domInputControl:null,impl:null,_currentInputString:"",_lastClickPosition:null,ctor:function(){this.impl=new cc.IMEDispatcher.Impl,this._lastClickPosition=cc.p(0,0)},init:function(){if(!cc.sys.isMobile){this._domInputControl=cc.$("#imeDispatcherInput"),this._domInputControl||(this._domInputControl=cc.$new("input"),this._domInputControl.setAttribute("type","text"),this._domInputControl.setAttribute("id","imeDispatcherInput"),this._domInputControl.resize(0,0),this._domInputControl.translates(0,0),this._domInputControl.style.opacity="0",this._domInputControl.style.fontSize="1px",this._domInputControl.setAttribute("tabindex",2),this._domInputControl.style.position="absolute",this._domInputControl.style.top=0,this._domInputControl.style.left=0,document.body.appendChild(this._domInputControl));var t=this;cc._addEventListener(this._domInputControl,"input",function(){t._processDomInputString(t._domInputControl.value)},!1),cc._addEventListener(this._domInputControl,"keydown",function(e){e.keyCode===cc.KEY.tab?(e.stopPropagation(),e.preventDefault()):e.keyCode===cc.KEY.enter&&(t.dispatchInsertText("\n",1),e.stopPropagation(),e.preventDefault())},!1),/msie/i.test(navigator.userAgent)&&cc._addEventListener(this._domInputControl,"keyup",function(e){e.keyCode===cc.KEY.backspace&&t._processDomInputString(t._domInputControl.value)},!1),cc._addEventListener(window,"mousedown",function(e){var i=e.pageY||0;t._lastClickPosition.x=e.pageX||0,t._lastClickPosition.y=i},!1)}},_processDomInputString:function(t){var e,i;for(e=this._currentInputString.length<t.length?this._currentInputString.length:t.length,i=0;e>i&&t[i]===this._currentInputString[i];i++);var n=this._currentInputString.length-i,r=t.length-i;for(e=0;n>e;e++)this.dispatchDeleteBackward();for(e=0;r>e;e++)this.dispatchInsertText(t[i+e],1);this._currentInputString=t},dispatchInsertText:function(t,e){!this.impl||!t||0>=e||this.impl._delegateWithIme&&this.impl._delegateWithIme.insertText(t,e)},dispatchDeleteBackward:function(){this.impl&&this.impl._delegateWithIme&&this.impl._delegateWithIme.deleteBackward()},getContentText:function(){if(this.impl&&this.impl._delegateWithIme){var t=this.impl._delegateWithIme.getContentText();return t?t:""}return""},dispatchKeyboardWillShow:function(t){if(this.impl)for(var e=0;e<this.impl._delegateList.length;e++){var i=this.impl._delegateList[e];i&&i.keyboardWillShow(t)}},dispatchKeyboardDidShow:function(t){if(this.impl)for(var e=0;e<this.impl._delegateList.length;e++){var i=this.impl._delegateList[e];i&&i.keyboardDidShow(t)}},dispatchKeyboardWillHide:function(t){if(this.impl)for(var e=0;e<this.impl._delegateList.length;e++){var i=this.impl._delegateList[e];i&&i.keyboardWillHide(t)}},dispatchKeyboardDidHide:function(t){if(this.impl)for(var e=0;e<this.impl._delegateList.length;e++){var i=this.impl._delegateList[e];i&&i.keyboardDidHide(t)}},addDelegate:function(t){t&&this.impl&&(-1<this.impl._delegateList.indexOf(t)||this.impl._delegateList.splice(0,0,t))},attachDelegateWithIME:function(t){if(!this.impl||!t||-1===this.impl._delegateList.indexOf(t))return!1;if(this.impl._delegateWithIme){if(!this.impl._delegateWithIme.canDetachWithIME()||!t.canAttachWithIME())return!1;var e=this.impl._delegateWithIme;return this.impl._delegateWithIme=null,e.didDetachWithIME(),this._focusDomInput(t),!0}return t.canAttachWithIME()?(this._focusDomInput(t),!0):!1},_focusDomInput:function(t){cc.sys.isMobile?(this.impl._delegateWithIme=t,t.didAttachWithIME(),this._currentInputString=t.string||"",t=t.getTipMessage?t.getTipMessage():"please enter your word:",t=window.Window&&Window.prototype.prompt!=prompt?Window.prototype.prompt.call(window,t,this._currentInputString):prompt(t,this._currentInputString),null!=t&&this._processDomInputString(t),this.dispatchInsertText("\n",1)):(this.impl._delegateWithIme=t,this._currentInputString=t.string||"",t.didAttachWithIME(),this._domInputControl.focus(),this._domInputControl.value=this._currentInputString,this._domInputControlTranslate())},_domInputControlTranslate:function(){/msie/i.test(navigator.userAgent)?(this._domInputControl.style.left=this._lastClickPosition.x+"px",this._domInputControl.style.top=this._lastClickPosition.y+"px"):this._domInputControl.translates(this._lastClickPosition.x,this._lastClickPosition.y)},detachDelegateWithIME:function(t){return this.impl&&t&&this.impl._delegateWithIme===t&&t.canDetachWithIME()?(this.impl._delegateWithIme=null,t.didDetachWithIME(),cc._canvas.focus(),!0):!1},removeDelegate:function(t){this.impl&&t&&-1!==this.impl._delegateList.indexOf(t)&&(this.impl._delegateWithIme&&t===this.impl._delegateWithIme&&(this.impl._delegateWithIme=null),cc.arrayRemoveObject(this.impl._delegateList,t))},processKeycode:function(t){32>t?t===cc.KEY.backspace?this.dispatchDeleteBackward():t===cc.KEY.enter&&this.dispatchInsertText("\n",1):255>t&&this.dispatchInsertText(String.fromCharCode(t),1)}}),cc.IMEDispatcher.Impl=cc.Class.extend({_delegateWithIme:null,_delegateList:null,ctor:function(){this._delegateList=[]},findDelegate:function(t){for(var e=0;e<this._delegateList.length;e++)if(this._delegateList[e]===t)return e;return null}}),cc.imeDispatcher=new cc.IMEDispatcher,document.body?cc.imeDispatcher.init():cc._addEventListener(window,"load",function(){cc.imeDispatcher.init()},!1),cc.TextFieldDelegate=cc.Class.extend({onTextFieldAttachWithIME:function(){return!1},onTextFieldDetachWithIME:function(){return!1},onTextFieldInsertText:function(){return!1},onTextFieldDeleteBackward:function(){return!1},onDraw:function(){return!1}}),cc.TextFieldTTF=cc.LabelTTF.extend({delegate:null,colorSpaceHolder:null,_colorText:null,_lens:null,_inputText:"",_placeHolder:"",_charCount:0,_className:"TextFieldTTF",ctor:function(t,e,i,n,r){this.colorSpaceHolder=cc.color(127,127,127),this._colorText=cc.color(255,255,255,255),cc.LabelTTF.prototype.ctor.call(this),void 0!==r?(this.initWithPlaceHolder("",e,i,n,r),t&&this.setPlaceHolder(t)):void 0===n&&void 0!==i&&(this.initWithString("",e,i),t&&this.setPlaceHolder(t))},onEnter:function(){cc.LabelTTF.prototype.onEnter.call(this),cc.imeDispatcher.addDelegate(this)},onExit:function(){cc.LabelTTF.prototype.onExit.call(this),cc.imeDispatcher.removeDelegate(this)},getDelegate:function(){return this.delegate},setDelegate:function(t){this.delegate=t},getCharCount:function(){return this._charCount},getColorSpaceHolder:function(){return cc.color(this.colorSpaceHolder)},setColorSpaceHolder:function(t){this.colorSpaceHolder.r=t.r,this.colorSpaceHolder.g=t.g,this.colorSpaceHolder.b=t.b,this.colorSpaceHolder.a=cc.isUndefined(t.a)?255:t.a,this._inputText.length||this.setColor(this.colorSpaceHolder)},setTextColor:function(t){this._colorText.r=t.r,this._colorText.g=t.g,this._colorText.b=t.b,this._colorText.a=cc.isUndefined(t.a)?255:t.a,this._inputText.length&&this.setColor(this._colorText)},initWithPlaceHolder:function(t,e,i,n,r){switch(arguments.length){case 5:return t&&this.setPlaceHolder(t),this.initWithString(this._placeHolder,n,r,e,i);case 3:return t&&this.setPlaceHolder(t),this.initWithString(this._placeHolder,arguments[1],arguments[2]);default:throw"Argument must be non-nil "}},setString:function(t){this._inputText=(t=String(t))||"",this._inputText.length?(cc.LabelTTF.prototype.setString.call(this,this._inputText),this.setColor(this._colorText)):(cc.LabelTTF.prototype.setString.call(this,this._placeHolder),this.setColor(this.colorSpaceHolder)),cc._renderType===cc._RENDER_TYPE_CANVAS&&this._renderCmd._updateTexture(),this._charCount=this._inputText.length},getString:function(){return this._inputText},setPlaceHolder:function(t){this._placeHolder=t||"",this._inputText.length||(cc.LabelTTF.prototype.setString.call(this,this._placeHolder),this.setColor(this.colorSpaceHolder))},getPlaceHolder:function(){return this._placeHolder},draw:function(t){t=t||cc._renderContext,this.delegate&&this.delegate.onDraw(this)||cc.LabelTTF.prototype.draw.call(this,t)},visit:function(t){this._super(t)},attachWithIME:function(){return cc.imeDispatcher.attachDelegateWithIME(this)},detachWithIME:function(){return cc.imeDispatcher.detachDelegateWithIME(this)},canAttachWithIME:function(){return this.delegate?!this.delegate.onTextFieldAttachWithIME(this):!0},didAttachWithIME:function(){},canDetachWithIME:function(){return this.delegate?!this.delegate.onTextFieldDetachWithIME(this):!0},didDetachWithIME:function(){},deleteBackward:function(){var t=this._inputText.length;0===t||this.delegate&&this.delegate.onTextFieldDeleteBackward(this,this._inputText[t-1],1)||(1>=t?(this._inputText="",this._charCount=0,cc.LabelTTF.prototype.setString.call(this,this._placeHolder),this.setColor(this.colorSpaceHolder)):this.string=this._inputText.substring(0,t-1))},removeDelegate:function(){cc.imeDispatcher.removeDelegate(this)},_tipMessage:"please enter your word:",setTipMessage:function(t){null!=t&&(this._tipMessage=t)},getTipMessage:function(){return this._tipMessage},insertText:function(t){var e=t,i=e.indexOf("\n");if(i>-1&&(e=e.substring(0,i)),0<e.length){if(this.delegate&&this.delegate.onTextFieldInsertText(this,e,e.length))return;e=this._inputText+e,this._charCount=e.length,this.string=e}-1!==i&&(this.delegate&&this.delegate.onTextFieldInsertText(this,"\n",1)||this.detachWithIME())},getContentText:function(){return this._inputText},keyboardWillShow:function(){},keyboardDidShow:function(){},keyboardWillHide:function(){},keyboardDidHide:function(){}}),_p=cc.TextFieldTTF.prototype,cc.defineGetterSetter(_p,"charCount",_p.getCharCount),cc.defineGetterSetter(_p,"placeHolder",_p.getPlaceHolder,_p.setPlaceHolder),cc.TextFieldTTF.create=function(t,e,i,n,r){return new cc.TextFieldTTF(t,e,i,n,r)},cc._globalFontSize=cc.ITEM_SIZE,cc._globalFontName="Arial",cc._globalFontNameRelease=!1,cc.MenuItem=cc.Node.extend({_enabled:!1,_target:null,_callback:null,_isSelected:!1,_className:"MenuItem",ctor:function(t,e){var i=cc.Node.prototype;i.ctor.call(this),this._callback=this._target=null,this._enabled=this._isSelected=!1,i.setAnchorPoint.call(this,.5,.5),this._target=e||null,(this._callback=t||null)&&(this._enabled=!0)},isSelected:function(){return this._isSelected},setOpacityModifyRGB:function(){},isOpacityModifyRGB:function(){return!1},setTarget:function(t,e){this._target=e,this._callback=t},isEnabled:function(){return this._enabled},setEnabled:function(t){this._enabled=t},initWithCallback:function(t,e){return this.anchorY=this.anchorX=.5,this._target=e,this._callback=t,this._enabled=!0,this._isSelected=!1,!0},rect:function(){var t=this._position,e=this._contentSize,i=this._anchorPoint;return cc.rect(t.x-e.width*i.x,t.y-e.height*i.y,e.width,e.height)},selected:function(){this._isSelected=!0},unselected:function(){this._isSelected=!1},setCallback:function(t,e){this._target=e,this._callback=t},activate:function(){if(this._enabled){var t=this._target,e=this._callback;e&&(t&&cc.isString(e)?t[e](this):t&&cc.isFunction(e)?e.call(t,this):e(this))}}}),_p=cc.MenuItem.prototype,cc.defineGetterSetter(_p,"enabled",_p.isEnabled,_p.setEnabled),cc.MenuItem.create=function(t,e){return new cc.MenuItem(t,e)},cc.MenuItemLabel=cc.MenuItem.extend({_disabledColor:null,_label:null,_originalScale:0,_colorBackup:null,ctor:function(t,e,i){cc.MenuItem.prototype.ctor.call(this,e,i),this._colorBackup=this._label=this._disabledColor=null,t&&(this._originalScale=1,this._colorBackup=cc.color.WHITE,this._disabledColor=cc.color(126,126,126),this.setLabel(t),this.setCascadeColorEnabled(!0),this.setCascadeOpacityEnabled(!0))},getDisabledColor:function(){return this._disabledColor},setDisabledColor:function(t){this._disabledColor=t},getLabel:function(){return this._label},setLabel:function(t){t&&(this.addChild(t),t.anchorX=0,t.anchorY=0,this.width=t.width,this.height=t.height,t.setCascadeColorEnabled(!0)),this._label&&this.removeChild(this._label,!0),this._label=t},setEnabled:function(t){this._enabled!==t&&(t?this.setColor(this._colorBackup):(this._colorBackup=this.color,this.setColor(this._disabledColor))),cc.MenuItem.prototype.setEnabled.call(this,t)},initWithLabel:function(t,e,i){return this.initWithCallback(e,i),this._originalScale=1,this._colorBackup=cc.color.WHITE,this._disabledColor=cc.color(126,126,126),this.setLabel(t),this.setCascadeColorEnabled(!0),this.setCascadeOpacityEnabled(!0),!0},setString:function(t){this._label.string=t,this.width=this._label.width,this.height=this._label.height},getString:function(){return this._label.string},activate:function(){this._enabled&&(this.stopAllActions(),this.scale=this._originalScale,cc.MenuItem.prototype.activate.call(this))},selected:function(){if(this._enabled){cc.MenuItem.prototype.selected.call(this);var t=this.getActionByTag(cc.ZOOM_ACTION_TAG);t?this.stopAction(t):this._originalScale=this.scale,t=cc.scaleTo(.1,1.2*this._originalScale),t.setTag(cc.ZOOM_ACTION_TAG),this.runAction(t)}},unselected:function(){if(this._enabled){cc.MenuItem.prototype.unselected.call(this),this.stopActionByTag(cc.ZOOM_ACTION_TAG);var t=cc.scaleTo(.1,this._originalScale);t.setTag(cc.ZOOM_ACTION_TAG),this.runAction(t)}}}),_p=cc.MenuItemLabel.prototype,cc.defineGetterSetter(_p,"string",_p.getString,_p.setString),cc.defineGetterSetter(_p,"disabledColor",_p.getDisabledColor,_p.setDisabledColor),cc.defineGetterSetter(_p,"label",_p.getLabel,_p.setLabel),cc.MenuItemLabel.create=function(t,e,i){return new cc.MenuItemLabel(t,e,i)},cc.MenuItemAtlasFont=cc.MenuItemLabel.extend({ctor:function(t,e,i,n,r,o,s){var c;t&&0<t.length&&(c=new cc.LabelAtlas(t,e,i,n,r)),cc.MenuItemLabel.prototype.ctor.call(this,c,o,s)},initWithString:function(t,e,i,n,r,o,s){if(!t||0===t.length)throw"cc.MenuItemAtlasFont.initWithString(): value should be non-null and its length should be greater than 0";var c=new cc.LabelAtlas;return c.initWithString(t,e,i,n,r),this.initWithLabel(c,o,s),!0}}),cc.MenuItemAtlasFont.create=function(t,e,i,n,r,o,s){return new cc.MenuItemAtlasFont(t,e,i,n,r,o,s)},cc.MenuItemFont=cc.MenuItemLabel.extend({_fontSize:null,_fontName:null,ctor:function(t,e,i){var n;t&&0<t.length?(this._fontName=cc._globalFontName,this._fontSize=cc._globalFontSize,n=new cc.LabelTTF(t,this._fontName,this._fontSize)):(this._fontSize=0,this._fontName=""),cc.MenuItemLabel.prototype.ctor.call(this,n,e,i)},initWithString:function(t,e,i){if(!t||0===t.length)throw"Value should be non-null and its length should be greater than 0";return this._fontName=cc._globalFontName,this._fontSize=cc._globalFontSize,t=new cc.LabelTTF(t,this._fontName,this._fontSize),this.initWithLabel(t,e,i),!0},setFontSize:function(t){this._fontSize=t,this._recreateLabel()},getFontSize:function(){return this._fontSize},setFontName:function(t){this._fontName=t,this._recreateLabel()},getFontName:function(){return this._fontName},_recreateLabel:function(){var t=new cc.LabelTTF(this._label.string,this._fontName,this._fontSize);this.setLabel(t)}}),cc.MenuItemFont.setFontSize=function(t){cc._globalFontSize=t},cc.MenuItemFont.fontSize=function(){return cc._globalFontSize},cc.MenuItemFont.setFontName=function(t){cc._globalFontNameRelease&&(cc._globalFontName=""),cc._globalFontName=t,cc._globalFontNameRelease=!0},_p=cc.MenuItemFont.prototype,cc.defineGetterSetter(_p,"fontSize",_p.getFontSize,_p.setFontSize),cc.defineGetterSetter(_p,"fontName",_p.getFontName,_p.setFontName),cc.MenuItemFont.fontName=function(){return cc._globalFontName},cc.MenuItemFont.create=function(t,e,i){return new cc.MenuItemFont(t,e,i)},cc.MenuItemSprite=cc.MenuItem.extend({_normalImage:null,_selectedImage:null,_disabledImage:null,ctor:function(t,e,i,n,r){if(cc.MenuItem.prototype.ctor.call(this),this._disabledImage=this._selectedImage=this._normalImage=null,void 0!==e){var o,s,c;void 0!==r?(o=i,c=n,s=r):void 0!==n&&cc.isFunction(n)?(o=i,c=n):void 0!==n&&cc.isFunction(i)?(s=n,c=i,o=null):void 0===i&&(o=null),this.initWithNormalSprite(t,e,o,c,s)}},getNormalImage:function(){return this._normalImage},setNormalImage:function(t){this._normalImage!==t&&(t&&(this.addChild(t,0,cc.NORMAL_TAG),t.anchorX=0,t.anchorY=0),this._normalImage&&this.removeChild(this._normalImage,!0),this._normalImage=t,this.width=this._normalImage.width,this.height=this._normalImage.height,this._updateImagesVisibility(),t.textureLoaded&&!t.textureLoaded()&&t.addEventListener("load",function(t){this.width=t.width,this.height=t.height},this))},getSelectedImage:function(){return this._selectedImage},setSelectedImage:function(t){this._selectedImage!==t&&(t&&(this.addChild(t,0,cc.SELECTED_TAG),t.anchorX=0,t.anchorY=0),this._selectedImage&&this.removeChild(this._selectedImage,!0),this._selectedImage=t,this._updateImagesVisibility())},getDisabledImage:function(){return this._disabledImage},setDisabledImage:function(t){this._disabledImage!==t&&(t&&(this.addChild(t,0,cc.DISABLE_TAG),t.anchorX=0,t.anchorY=0),this._disabledImage&&this.removeChild(this._disabledImage,!0),this._disabledImage=t,this._updateImagesVisibility())},initWithNormalSprite:function(t,e,i,n,r){return this.initWithCallback(n,r),this.setNormalImage(t),this.setSelectedImage(e),this.setDisabledImage(i),(t=this._normalImage)&&(this.width=t.width,this.height=t.height,t.textureLoaded&&!t.textureLoaded()&&t.addEventListener("load",function(t){this.width=t.width,this.height=t.height,this.setCascadeColorEnabled(!0),this.setCascadeOpacityEnabled(!0)},this)),this.setCascadeColorEnabled(!0),this.setCascadeOpacityEnabled(!0),!0},selected:function(){cc.MenuItem.prototype.selected.call(this),this._normalImage&&(this._disabledImage&&(this._disabledImage.visible=!1),this._selectedImage?(this._normalImage.visible=!1,this._selectedImage.visible=!0):this._normalImage.visible=!0)},unselected:function(){cc.MenuItem.prototype.unselected.call(this),this._normalImage&&(this._normalImage.visible=!0,this._selectedImage&&(this._selectedImage.visible=!1),this._disabledImage&&(this._disabledImage.visible=!1))},setEnabled:function(t){this._enabled!==t&&(cc.MenuItem.prototype.setEnabled.call(this,t),this._updateImagesVisibility())},_updateImagesVisibility:function(){var t=this._normalImage,e=this._selectedImage,i=this._disabledImage;this._enabled?(t&&(t.visible=!0),e&&(e.visible=!1),i&&(i.visible=!1)):i?(t&&(t.visible=!1),e&&(e.visible=!1),i&&(i.visible=!0)):(t&&(t.visible=!0),e&&(e.visible=!1))}}),_p=cc.MenuItemSprite.prototype,cc.defineGetterSetter(_p,"normalImage",_p.getNormalImage,_p.setNormalImage),cc.defineGetterSetter(_p,"selectedImage",_p.getSelectedImage,_p.setSelectedImage),cc.defineGetterSetter(_p,"disabledImage",_p.getDisabledImage,_p.setDisabledImage),cc.MenuItemSprite.create=function(t,e,i,n,r){return new cc.MenuItemSprite(t,e,i,n,r||void 0)},cc.MenuItemImage=cc.MenuItemSprite.extend({ctor:function(t,e,i,n,r){var o=null,s=null,c=null,a=null,l=null;void 0===t?cc.MenuItemSprite.prototype.ctor.call(this):(o=new cc.Sprite(t),e&&(s=new cc.Sprite(e)),void 0===n?a=i:void 0===r?(a=i,l=n):r&&(c=new cc.Sprite(i),a=n,l=r),cc.MenuItemSprite.prototype.ctor.call(this,o,s,c,a,l))},setNormalSpriteFrame:function(t){this.setNormalImage(new cc.Sprite(t))},setSelectedSpriteFrame:function(t){this.setSelectedImage(new cc.Sprite(t))},setDisabledSpriteFrame:function(t){this.setDisabledImage(new cc.Sprite(t))},initWithNormalImage:function(t,e,i,n,r){var o=null,s=null,c=null;return t&&(o=new cc.Sprite(t)),e&&(s=new cc.Sprite(e)),i&&(c=new cc.Sprite(i)),this.initWithNormalSprite(o,s,c,n,r)}}),cc.MenuItemImage.create=function(t,e,i,n,r){return new cc.MenuItemImage(t,e,i,n,r)},cc.MenuItemToggle=cc.MenuItem.extend({subItems:null,_selectedIndex:0,_opacity:null,_color:null,ctor:function(){cc.MenuItem.prototype.ctor.call(this),this._selectedIndex=0,this.subItems=[],this._opacity=0,this._color=cc.color.WHITE,0<arguments.length&&this.initWithItems(Array.prototype.slice.apply(arguments))},getOpacity:function(){return this._opacity},setOpacity:function(t){if(this._opacity=t,this.subItems&&0<this.subItems.length)for(var e=0;e<this.subItems.length;e++)this.subItems[e].opacity=t;this._color.a=t},getColor:function(){var t=this._color;return cc.color(t.r,t.g,t.b,t.a)},setColor:function(t){var e=this._color;if(e.r=t.r,e.g=t.g,e.b=t.b,this.subItems&&0<this.subItems.length)for(e=0;e<this.subItems.length;e++)this.subItems[e].setColor(t);void 0===t.a||t.a_undefined||this.setOpacity(t.a)},getSelectedIndex:function(){return this._selectedIndex},setSelectedIndex:function(t){if(t!==this._selectedIndex){this._selectedIndex=t,(t=this.getChildByTag(cc.CURRENT_ITEM))&&t.removeFromParent(!1),t=this.subItems[this._selectedIndex],this.addChild(t,0,cc.CURRENT_ITEM);var e=t.width,i=t.height;this.width=e,this.height=i,t.setPosition(e/2,i/2)}},getSubItems:function(){return this.subItems},setSubItems:function(t){this.subItems=t},initWithItems:function(t){var e=t.length;cc.isFunction(t[t.length-2])?(this.initWithCallback(t[t.length-2],t[t.length-1]),e-=2):cc.isFunction(t[t.length-1])?(this.initWithCallback(t[t.length-1],null),e-=1):this.initWithCallback(null,null);for(var i=this.subItems,n=i.length=0;e>n;n++)t[n]&&i.push(t[n]);return this._selectedIndex=cc.UINT_MAX,this.setSelectedIndex(0),this.setCascadeColorEnabled(!0),this.setCascadeOpacityEnabled(!0),!0},addSubItem:function(t){this.subItems.push(t)},activate:function(){this._enabled&&this.setSelectedIndex((this._selectedIndex+1)%this.subItems.length),cc.MenuItem.prototype.activate.call(this)},selected:function(){cc.MenuItem.prototype.selected.call(this),this.subItems[this._selectedIndex].selected()},unselected:function(){cc.MenuItem.prototype.unselected.call(this),this.subItems[this._selectedIndex].unselected()},setEnabled:function(t){if(this._enabled!==t){cc.MenuItem.prototype.setEnabled.call(this,t);var e=this.subItems;if(e&&0<e.length)for(var i=0;i<e.length;i++)e[i].enabled=t}},selectedItem:function(){return this.subItems[this._selectedIndex]},getSelectedItem:function(){return this.subItems[this._selectedIndex]},onEnter:function(){cc.Node.prototype.onEnter.call(this),this.setSelectedIndex(this._selectedIndex)}}),_p=cc.MenuItemToggle.prototype,cc.defineGetterSetter(_p,"selectedIndex",_p.getSelectedIndex,_p.setSelectedIndex),cc.MenuItemToggle.create=function(){0<arguments.length&&null==arguments[arguments.length-1]&&cc.log("parameters should not be ending with null in Javascript");var t=new cc.MenuItemToggle;return t.initWithItems(Array.prototype.slice.apply(arguments)),t},cc.MENU_STATE_WAITING=0,cc.MENU_STATE_TRACKING_TOUCH=1,cc.MENU_HANDLER_PRIORITY=-128,cc.DEFAULT_PADDING=5,cc.Menu=cc.Layer.extend({enabled:!1,_selectedItem:null,_state:-1,_touchListener:null,_className:"Menu",ctor:function(t){cc.Layer.prototype.ctor.call(this),this._color=cc.color.WHITE,this.enabled=!1,this._opacity=255,this._selectedItem=null,this._state=-1,this._touchListener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:this._onTouchBegan,onTouchMoved:this._onTouchMoved,onTouchEnded:this._onTouchEnded,onTouchCancelled:this._onTouchCancelled}),0<arguments.length&&null==arguments[arguments.length-1]&&cc.log("parameters should not be ending with null in Javascript");
var e,i=arguments.length;if(0===i)e=[];else if(1===i)e=t instanceof Array?t:[t];else if(i>1){e=[];for(var n=0;i>n;n++)arguments[n]&&e.push(arguments[n])}this.initWithArray(e)},onEnter:function(){var t=this._touchListener;t._isRegistered()||cc.eventManager.addListener(t,this),cc.Node.prototype.onEnter.call(this)},isEnabled:function(){return this.enabled},setEnabled:function(t){this.enabled=t},initWithItems:function(t){var e=[];if(t)for(var i=0;i<t.length;i++)t[i]&&e.push(t[i]);return this.initWithArray(e)},initWithArray:function(t){if(cc.Layer.prototype.init.call(this)){this.enabled=!0;var e=cc.winSize;if(this.setPosition(e.width/2,e.height/2),this.setContentSize(e),this.setAnchorPoint(.5,.5),this.ignoreAnchorPointForPosition(!0),t)for(e=0;e<t.length;e++)this.addChild(t[e],e);return this._selectedItem=null,this._state=cc.MENU_STATE_WAITING,this.cascadeOpacity=this.cascadeColor=!0}return!1},addChild:function(t,e,i){if(!(t instanceof cc.MenuItem))throw"cc.Menu.addChild() : Menu only supports MenuItem objects as children";cc.Layer.prototype.addChild.call(this,t,e,i)},alignItemsVertically:function(){this.alignItemsVerticallyWithPadding(cc.DEFAULT_PADDING)},alignItemsVerticallyWithPadding:function(t){var e,i,n,r,o=-t,s=this._children;if(s&&0<s.length){for(i=0,e=s.length;e>i;i++)o+=s[i].height*s[i].scaleY+t;var c=o/2;for(i=0,e=s.length;e>i;i++)r=s[i],n=r.height,o=r.scaleY,r.setPosition(0,c-n*o/2),c-=n*o+t}},alignItemsHorizontally:function(){this.alignItemsHorizontallyWithPadding(cc.DEFAULT_PADDING)},alignItemsHorizontallyWithPadding:function(t){var e,i,n,r,o=-t,s=this._children;if(s&&0<s.length){for(e=0,i=s.length;i>e;e++)o+=s[e].width*s[e].scaleX+t;var c=-o/2;for(e=0,i=s.length;i>e;e++)r=s[e],o=r.scaleX,n=s[e].width,r.setPosition(c+n*o/2,0),c+=n*o+t}},alignItemsInColumns:function(){0<arguments.length&&null==arguments[arguments.length-1]&&cc.log("parameters should not be ending with null in Javascript");for(var t=[],e=0;e<arguments.length;e++)t.push(arguments[e]);var i,n,r,o=-5,s=0,c=0,a=0,l=this._children;if(l&&0<l.length)for(e=0,r=l.length;r>e;e++)s>=t.length||!(i=t[s])||(n=l[e].height,c=c>=n||isNaN(n)?c:n,++a,a>=i&&(o+=c+5,c=a=0,++s));var h=cc.director.getWinSize(),u=i=c=s=0,d=0,o=o/2;if(l&&0<l.length)for(e=0,r=l.length;r>e;e++){var _=l[e];0===i&&(i=t[s],d=u=h.width/(1+i)),n=_._getHeight(),c=c>=n||isNaN(n)?c:n,_.setPosition(d-h.width/2,o-n/2),d+=u,++a,a>=i&&(o-=c+5,c=i=a=0,++s)}},alignItemsInRows:function(){0<arguments.length&&null==arguments[arguments.length-1]&&cc.log("parameters should not be ending with null in Javascript");var t,e=[];for(t=0;t<arguments.length;t++)e.push(arguments[t]);var i,n,r,o,s=[],c=[],a=-10,l=-5,h=0,u=0,d=0,_=this._children;if(_&&0<_.length)for(t=0,r=_.length;r>t;t++)n=_[t],h>=e.length||!(i=e[h])||(o=n.width,u=u>=o||isNaN(o)?u:o,l+=n.height+5,++d,d>=i&&(s.push(u),c.push(l),a+=u+10,u=d=0,l=-5,++h));l=cc.director.getWinSize(),i=u=h=0;var a=-a/2,p=0;if(_&&0<_.length)for(t=0,r=_.length;r>t;t++)n=_[t],0===i&&(i=e[h],p=c[h]),o=n._getWidth(),u=u>=o||isNaN(o)?u:o,n.setPosition(a+s[h]/2,p-l.height/2),p-=n.height+10,++d,d>=i&&(a+=u+5,u=i=d=0,++h)},removeChild:function(t,e){null!=t&&(t instanceof cc.MenuItem?(this._selectedItem===t&&(this._selectedItem=null),cc.Node.prototype.removeChild.call(this,t,e)):cc.log("cc.Menu.removeChild():Menu only supports MenuItem objects as children"))},_onTouchBegan:function(t,e){var i=e.getCurrentTarget();if(i._state!==cc.MENU_STATE_WAITING||!i._visible||!i.enabled)return!1;for(var n=i.parent;null!=n;n=n.parent)if(!n.isVisible())return!1;return i._selectedItem=i._itemForTouch(t),i._selectedItem?(i._state=cc.MENU_STATE_TRACKING_TOUCH,i._selectedItem.selected(),i._selectedItem.setNodeDirty(),!0):!1},_onTouchEnded:function(t,e){var i=e.getCurrentTarget();i._state!==cc.MENU_STATE_TRACKING_TOUCH?cc.log("cc.Menu.onTouchEnded(): invalid state"):(i._selectedItem&&(i._selectedItem.unselected(),i._selectedItem.setNodeDirty(),i._selectedItem.activate()),i._state=cc.MENU_STATE_WAITING)},_onTouchCancelled:function(t,e){var i=e.getCurrentTarget();i._state!==cc.MENU_STATE_TRACKING_TOUCH?cc.log("cc.Menu.onTouchCancelled(): invalid state"):(this._selectedItem&&(i._selectedItem.unselected(),i._selectedItem.setNodeDirty()),i._state=cc.MENU_STATE_WAITING)},_onTouchMoved:function(t,e){var i=e.getCurrentTarget();if(i._state!==cc.MENU_STATE_TRACKING_TOUCH)cc.log("cc.Menu.onTouchMoved(): invalid state");else{var n=i._itemForTouch(t);n!==i._selectedItem&&(i._selectedItem&&(i._selectedItem.unselected(),i._selectedItem.setNodeDirty()),i._selectedItem=n,i._selectedItem&&(i._selectedItem.selected(),i._selectedItem.setNodeDirty()))}},onExit:function(){this._state===cc.MENU_STATE_TRACKING_TOUCH&&(this._selectedItem&&(this._selectedItem.unselected(),this._selectedItem=null),this._state=cc.MENU_STATE_WAITING),cc.Node.prototype.onExit.call(this)},setOpacityModifyRGB:function(){},isOpacityModifyRGB:function(){return!1},_itemForTouch:function(t){t=t.getLocation();var e,i=this._children;if(i&&0<i.length)for(var n=i.length-1;n>=0;n--)if(e=i[n],e.isVisible()&&e.isEnabled()){var r=e.convertToNodeSpace(t),o=e.rect();if(o.x=0,o.y=0,cc.rectContainsPoint(o,r))return e}return null}}),_p=cc.Menu.prototype,cc.Menu.create=function(t){var e=arguments.length;return e>0&&null==arguments[e-1]&&cc.log("parameters should not be ending with null in Javascript"),0===e?new cc.Menu:new cc.Menu(1===e?t:Array.prototype.slice.call(arguments,0))},cc.TGA_OK=0,cc.TGA_ERROR_FILE_OPEN=1,cc.TGA_ERROR_READING_FILE=2,cc.TGA_ERROR_INDEXED_COLOR=3,cc.TGA_ERROR_MEMORY=4,cc.TGA_ERROR_COMPRESSED_FILE=5,cc.ImageTGA=function(t,e,i,n,r,o,s){this.status=t||0,this.type=e||0,this.pixelDepth=i||0,this.width=n||0,this.height=r||0,this.imageData=o||[],this.flipped=s||0},cc.tgaLoadHeader=function(t,e,i){var n=2;return n+1>e?!1:(t=new cc.BinaryStreamReader(t),t.setOffset(n),i.type=t.readByte(),n+=10,n+4+1>e?!1:(t.setOffset(n),i.width=t.readUnsignedShort(),i.height=t.readUnsignedInteger(),i.pixelDepth=t.readByte(),n+5+1>e?!1:(e=t.readByte(),i.flipped=0,32&e&&(i.flipped=1),!0)))},cc.tgaLoadImageData=function(t,e,i){var n,r;if(n=0|i.pixelDepth/2,r=i.height*i.width*n,18+r>e)return!1;if(i.imageData=cc.__getSubArray(t,18,18+r),n>=3)for(t=0;r>t;t+=n)e=i.imageData[t],i.imageData[t]=i.imageData[t+2],i.imageData[t+2]=e;return!0},cc.tgaRGBtogreyscale=function(t){var e,i;if(8!==t.pixelDepth){var n=t.pixelDepth/8,r=new Uint8Array(t.height*t.width);if(null!==r){for(i=e=0;i<t.width*t.height;e+=n,i++)r[i]=.3*t.imageData[e]+.59*t.imageData[e+1]+.11*t.imageData[e+2];t.pixelDepth=8,t.type=3,t.imageData=r}}},cc.tgaDestroy=function(t){t&&(t.imageData=null)},cc.tgaLoadRLEImageData=function(t,e,i){var n,r,o,s=0,c=0,a=0,l=[],h=0,u=18;for(n=i.pixelDepth/8,r=i.height*i.width,o=0;r>o;o++){if(0!==h)h--,c=0!==a;else{if(u+1>e)break;h=t[u],u+=1,(a=128&h)&&(h-=128),c=0}if(!c){if(u+n>e)break;l=cc.__getSubArray(t,u,u+n),u+=n,n>=3&&(c=l[0],l[0]=l[2],l[2]=c)}for(c=0;n>c;c++)i.imageData[s+c]=l[c];s+=n}return!0},cc.tgaFlipImage=function(t){for(var e=t.pixelDepth/8*t.width,i=0;i<t.height/2;i++){var n=cc.__getSubArray(t.imageData,i*e,i*e+e);cc.__setDataToArray(cc.__getSubArray(t.imageData,(t.height-(i+1))*e,e),t.imageData,i*e),cc.__setDataToArray(n,t.imageData,(t.height-(i+1))*e)}t.flipped=0},cc.__getSubArray=function(t,e,i){return t instanceof Array?t.slice(e,i):t.subarray(e,i)},cc.__setDataToArray=function(t,e,i){for(var n=0;n<t.length;n++)e[i+n]=t[n]},cc.BinaryStreamReader=cc.Class.extend({_binaryData:null,_offset:0,ctor:function(t){this._binaryData=t},setBinaryData:function(t){this._binaryData=t,this._offset=0},getBinaryData:function(){return this._binaryData},_checkSize:function(t){if(!(this._offset+Math.ceil(t/8)<this._data.length))throw Error("Index out of bound")},_decodeFloat:function(t,e){var i=t+e+1,n=i>>3;this._checkSize(i);var i=Math.pow(2,e-1)-1,r=this._readBits(t+e,1,n),o=this._readBits(t,e,n),s=0,c=2,a=0;do for(var l=this._readByte(++a,n),h=t%8||8,u=1<<h;u>>=1;)l&u&&(s+=1/c),c*=2;while(t-=h);return this._offset+=n,o===(i<<1)+1?s?0/0:r?-1/0:1/0:(1+-2*r)*(o||s?o?Math.pow(2,o-i)*(1+s):Math.pow(2,-i+1)*s:0)},_readByte:function(t,e){return this._data[this._offset+e-t-1]},_decodeInt:function(t,e){var i=this._readBits(0,t,t/8),n=Math.pow(2,t);return this._offset+=t/8,e&&i>=n/2?i-n:i},_shl:function(t,e){for(++e;--e;t=1073741824===(1073741824&(t%=2147483648))?2*t:2*(t-1073741824)+2147483648);return t},_readBits:function(t,e,i){var n=(t+e)%8,r=t%8,o=i-(t>>3)-1;t=i+(-(t+e)>>3);var s=o-t;for(e=this._readByte(o,i)>>r&(1<<(s?8-r:e))-1,s&&n&&(e+=(this._readByte(t++,i)&(1<<n)-1)<<(s--<<3)-r);s;)e+=this._shl(this._readByte(t++,i),(s--<<3)-r);return e},readInteger:function(){return this._decodeInt(32,!0)},readUnsignedInteger:function(){return this._decodeInt(32,!1)},readSingle:function(){return this._decodeFloat(23,8)},readShort:function(){return this._decodeInt(16,!0)},readUnsignedShort:function(){return this._decodeInt(16,!1)},readByte:function(){var t=this._data[this._offset];return this._offset+=1,t},readData:function(t,e){return this._binaryData instanceof Array?this._binaryData.slice(t,e):this._binaryData.subarray(t,e)},setOffset:function(t){this._offset=t},getOffset:function(){return this._offset}}),cc.TMX_ORIENTATION_ORTHO=0,cc.TMX_ORIENTATION_HEX=1,cc.TMX_ORIENTATION_ISO=2,cc.TMXTiledMap=cc.Node.extend({properties:null,mapOrientation:null,objectGroups:null,_mapSize:null,_tileSize:null,_tileProperties:null,_className:"TMXTiledMap",ctor:function(t,e){cc.Node.prototype.ctor.call(this),this._mapSize=cc.size(0,0),this._tileSize=cc.size(0,0),void 0!==e?this.initWithXML(t,e):void 0!==t&&this.initWithTMXFile(t)},getMapSize:function(){return cc.size(this._mapSize.width,this._mapSize.height)},setMapSize:function(t){this._mapSize.width=t.width,this._mapSize.height=t.height},_getMapWidth:function(){return this._mapSize.width},_setMapWidth:function(t){this._mapSize.width=t},_getMapHeight:function(){return this._mapSize.height},_setMapHeight:function(t){this._mapSize.height=t},getTileSize:function(){return cc.size(this._tileSize.width,this._tileSize.height)},setTileSize:function(t){this._tileSize.width=t.width,this._tileSize.height=t.height},_getTileWidth:function(){return this._tileSize.width},_setTileWidth:function(t){this._tileSize.width=t},_getTileHeight:function(){return this._tileSize.height},_setTileHeight:function(t){this._tileSize.height=t},getMapOrientation:function(){return this.mapOrientation},setMapOrientation:function(t){this.mapOrientation=t},getObjectGroups:function(){return this.objectGroups},setObjectGroups:function(t){this.objectGroups=t},getProperties:function(){return this.properties},setProperties:function(t){this.properties=t},initWithTMXFile:function(t){if(!t||0===t.length)throw"cc.TMXTiledMap.initWithTMXFile(): tmxFile should be non-null or non-empty string.";if(this.height=this.width=0,t=new cc.TMXMapInfo(t),!t)return!1;var e=t.getTilesets();return e&&0!==e.length||cc.log("cc.TMXTiledMap.initWithTMXFile(): Map not found. Please check the filename."),this._buildWithMapInfo(t),!0},initWithXML:function(t,e){this.height=this.width=0;var i=new cc.TMXMapInfo(t,e),n=i.getTilesets();return n&&0!==n.length||cc.log("cc.TMXTiledMap.initWithXML(): Map not found. Please check the filename."),this._buildWithMapInfo(i),!0},_buildWithMapInfo:function(t){this._mapSize=t.getMapSize(),this._tileSize=t.getTileSize(),this.mapOrientation=t.orientation,this.objectGroups=t.getObjectGroups(),this.properties=t.properties,this._tileProperties=t.getTileProperties();var e=0,i=t.getLayers();if(i)for(var n=null,r=0,o=i.length;o>r;r++)(n=i[r])&&n.visible&&(n=this._parseLayer(n,t),this.addChild(n,e,e),this.width=Math.max(this.width,n.width),this.height=Math.max(this.height,n.height),e++)},allLayers:function(){for(var t=[],e=this._children,i=0,n=e.length;n>i;i++){var r=e[i];r&&r instanceof cc.TMXLayer&&t.push(r)}return t},getLayer:function(t){if(!t||0===t.length)throw"cc.TMXTiledMap.getLayer(): layerName should be non-null or non-empty string.";for(var e=this._children,i=0;i<e.length;i++){var n=e[i];if(n&&n.layerName===t)return n}return null},getObjectGroup:function(t){if(!t||0===t.length)throw"cc.TMXTiledMap.getObjectGroup(): groupName should be non-null or non-empty string.";if(this.objectGroups)for(var e=0;e<this.objectGroups.length;e++){var i=this.objectGroups[e];if(i&&i.groupName===t)return i}return null},getProperty:function(t){return this.properties[t.toString()]},propertiesForGID:function(t){return cc.log("propertiesForGID is deprecated. Please use getPropertiesForGID instead."),this.getPropertiesForGID[t]},getPropertiesForGID:function(t){return this._tileProperties[t]},_parseLayer:function(t,e){var i=this._tilesetForLayer(t,e),i=new cc.TMXLayer(i,t,e);return t.ownTiles=!1,i.setupTiles(),i},_tilesetForLayer:function(t,e){var i=t._layerSize,n=e.getTilesets();if(n)for(var r=n.length-1;r>=0;r--){var o=n[r];if(o)for(var s=0;s<i.height;s++)for(var c=0;c<i.width;c++){var a=t._tiles[c+i.width*s];if(0!==a&&(a&cc.TMX_TILE_FLIPPED_MASK)>>>0>=o.firstGid)return o}}return cc.log("cocos2d: Warning: TMX Layer "+t.name+" has no tiles"),null}}),_p=cc.TMXTiledMap.prototype,cc.defineGetterSetter(_p,"mapWidth",_p._getMapWidth,_p._setMapWidth),cc.defineGetterSetter(_p,"mapHeight",_p._getMapHeight,_p._setMapHeight),cc.defineGetterSetter(_p,"tileWidth",_p._getTileWidth,_p._setTileWidth),cc.defineGetterSetter(_p,"tileHeight",_p._getTileHeight,_p._setTileHeight),cc.TMXTiledMap.create=function(t,e){return new cc.TMXTiledMap(t,e)},cc.TMX_PROPERTY_NONE=0,cc.TMX_PROPERTY_MAP=1,cc.TMX_PROPERTY_LAYER=2,cc.TMX_PROPERTY_OBJECTGROUP=3,cc.TMX_PROPERTY_OBJECT=4,cc.TMX_PROPERTY_TILE=5,cc.TMX_TILE_HORIZONTAL_FLAG=2147483648,cc.TMX_TILE_VERTICAL_FLAG=1073741824,cc.TMX_TILE_DIAGONAL_FLAG=536870912,cc.TMX_TILE_FLIPPED_ALL=(cc.TMX_TILE_HORIZONTAL_FLAG|cc.TMX_TILE_VERTICAL_FLAG|cc.TMX_TILE_DIAGONAL_FLAG)>>>0,cc.TMX_TILE_FLIPPED_MASK=~cc.TMX_TILE_FLIPPED_ALL>>>0,cc.TMXLayerInfo=cc.Class.extend({properties:null,name:"",_layerSize:null,_tiles:null,visible:null,_opacity:null,ownTiles:!0,_minGID:1e5,_maxGID:0,offset:null,ctor:function(){this.properties=[],this.name="",this._layerSize=null,this._tiles=[],this.visible=!0,this._opacity=0,this.ownTiles=!0,this._minGID=1e5,this._maxGID=0,this.offset=cc.p(0,0)},getProperties:function(){return this.properties},setProperties:function(t){this.properties=t}}),cc.TMXTilesetInfo=cc.Class.extend({name:"",firstGid:0,_tileSize:null,spacing:0,margin:0,sourceImage:"",imageSize:null,ctor:function(){this._tileSize=cc.size(0,0),this.imageSize=cc.size(0,0)},rectForGID:function(t){var e=cc.rect(0,0,0,0);e.width=this._tileSize.width,e.height=this._tileSize.height,t&=cc.TMX_TILE_FLIPPED_MASK,t-=parseInt(this.firstGid,10);var i=parseInt((this.imageSize.width-2*this.margin+this.spacing)/(this._tileSize.width+this.spacing),10);return e.x=parseInt(t%i*(this._tileSize.width+this.spacing)+this.margin,10),e.y=parseInt(parseInt(t/i,10)*(this._tileSize.height+this.spacing)+this.margin,10),e}}),cc.TMXMapInfo=cc.SAXParser.extend({properties:null,orientation:null,parentElement:null,parentGID:null,layerAttrs:0,storingCharacters:!1,tmxFileName:null,currentString:null,_objectGroups:null,_mapSize:null,_tileSize:null,_layers:null,_tilesets:null,_tileProperties:null,_resources:"",_currentFirstGID:0,ctor:function(t,e){cc.SAXParser.prototype.ctor.apply(this),this._mapSize=cc.size(0,0),this._tileSize=cc.size(0,0),this._layers=[],this._tilesets=[],this._objectGroups=[],this.properties=[],this._tileProperties={},this._currentFirstGID=0,void 0!==e?this.initWithXML(t,e):void 0!==t&&this.initWithTMXFile(t)},getOrientation:function(){return this.orientation},setOrientation:function(t){this.orientation=t},getMapSize:function(){return cc.size(this._mapSize.width,this._mapSize.height)},setMapSize:function(t){this._mapSize.width=t.width,this._mapSize.height=t.height},_getMapWidth:function(){return this._mapSize.width},_setMapWidth:function(t){this._mapSize.width=t},_getMapHeight:function(){return this._mapSize.height},_setMapHeight:function(t){this._mapSize.height=t},getTileSize:function(){return cc.size(this._tileSize.width,this._tileSize.height)},setTileSize:function(t){this._tileSize.width=t.width,this._tileSize.height=t.height},_getTileWidth:function(){return this._tileSize.width},_setTileWidth:function(t){this._tileSize.width=t},_getTileHeight:function(){return this._tileSize.height},_setTileHeight:function(t){this._tileSize.height=t},getLayers:function(){return this._layers},setLayers:function(t){this._layers.push(t)},getTilesets:function(){return this._tilesets},setTilesets:function(t){this._tilesets.push(t)},getObjectGroups:function(){return this._objectGroups},setObjectGroups:function(t){this._objectGroups.push(t)},getParentElement:function(){return this.parentElement},setParentElement:function(t){this.parentElement=t},getParentGID:function(){return this.parentGID},setParentGID:function(t){this.parentGID=t},getLayerAttribs:function(){return this.layerAttrs},setLayerAttribs:function(t){this.layerAttrs=t},getStoringCharacters:function(){return this.storingCharacters},setStoringCharacters:function(t){this.storingCharacters=t},getProperties:function(){return this.properties},setProperties:function(t){this.properties=t},initWithTMXFile:function(t){return this._internalInit(t,null),this.parseXMLFile(t)},initWithXML:function(t,e){return this._internalInit(null,e),this.parseXMLString(t)},parseXMLFile:function(t,e){var i=(e=e||!1)?t:cc.loader.getRes(t);if(!i)throw"Please load the resource first : "+t;var n,r,i=this._parseXML(i).documentElement;if(n=i.getAttribute("version"),r=i.getAttribute("orientation"),"map"===i.nodeName&&("1.0"!==n&&null!==n&&cc.log("cocos2d: TMXFormat: Unsupported TMX version:"+n),"orthogonal"===r?this.orientation=cc.TMX_ORIENTATION_ORTHO:"isometric"===r?this.orientation=cc.TMX_ORIENTATION_ISO:"hexagonal"===r?this.orientation=cc.TMX_ORIENTATION_HEX:null!==r&&cc.log("cocos2d: TMXFomat: Unsupported orientation:"+r),n=cc.size(0,0),n.width=parseFloat(i.getAttribute("width")),n.height=parseFloat(i.getAttribute("height")),this.setMapSize(n),n=cc.size(0,0),n.width=parseFloat(i.getAttribute("tilewidth")),n.height=parseFloat(i.getAttribute("tileheight")),this.setTileSize(n),r=i.querySelectorAll("map > properties >  property"))){var o={};for(n=0;n<r.length;n++)o[r[n].getAttribute("name")]=r[n].getAttribute("value");this.properties=o}for(o=i.getElementsByTagName("tileset"),"map"!==i.nodeName&&(o=[],o.push(i)),n=0;n<o.length;n++){r=o[n];var s=r.getAttribute("source");if(s)r=e?cc.path.join(this._resources,s):cc.path.changeBasename(t,s),this.parseXMLFile(r);else{s=new cc.TMXTilesetInfo,s.name=r.getAttribute("name")||"",s.firstGid=parseInt(r.getAttribute("firstgid"))||0,s.spacing=parseInt(r.getAttribute("spacing"))||0,s.margin=parseInt(r.getAttribute("margin"))||0;var c=cc.size(0,0);c.width=parseFloat(r.getAttribute("tilewidth")),c.height=parseFloat(r.getAttribute("tileheight")),s._tileSize=c;var c=r.getElementsByTagName("image")[0].getAttribute("source"),a=-1;if(this.tmxFileName&&(a=this.tmxFileName.lastIndexOf("/")),-1!==a?(a=this.tmxFileName.substr(0,a+1),s.sourceImage=a+c):s.sourceImage=this._resources+(this._resources?"/":"")+c,this.setTilesets(s),c=r.getElementsByTagName("tile"))for(a=0;a<c.length;a++){r=c[a],this.parentGID=parseInt(s.firstGid)+parseInt(r.getAttribute("id")||0);var l=r.querySelectorAll("properties > property");if(l){var h={};for(r=0;r<l.length;r++){var u=l[r].getAttribute("name");h[u]=l[r].getAttribute("value")}this._tileProperties[this.parentGID]=h}}}}if(o=i.getElementsByTagName("layer"))for(n=0;n<o.length;n++){for(c=o[n],a=c.getElementsByTagName("data")[0],s=new cc.TMXLayerInfo,s.name=c.getAttribute("name"),r=cc.size(0,0),r.width=parseFloat(c.getAttribute("width")),r.height=parseFloat(c.getAttribute("height")),s._layerSize=r,r=c.getAttribute("visible"),s.visible="0"!=r,r=c.getAttribute("opacity")||1,s._opacity=r?parseInt(255*parseFloat(r)):255,s.offset=cc.p(parseFloat(c.getAttribute("x"))||0,parseFloat(c.getAttribute("y"))||0),l="",r=0;r<a.childNodes.length;r++)l+=a.childNodes[r].nodeValue;if(l=l.trim(),r=a.getAttribute("compression"),h=a.getAttribute("encoding"),r&&"gzip"!==r&&"zlib"!==r)return cc.log("cc.TMXMapInfo.parseXMLFile(): unsupported compression method"),null;switch(r){case"gzip":s._tiles=cc.unzipBase64AsArray(l,4);break;case"zlib":r=new Zlib.Inflate(cc.Codec.Base64.decodeAsArray(l,1)),s._tiles=cc.uint8ArrayToUint32Array(r.decompress());break;case null:case"":if("base64"===h)s._tiles=cc.Codec.Base64.decodeAsArray(l,4);else if("csv"===h)for(s._tiles=[],r=l.split(","),a=0;a<r.length;a++)s._tiles.push(parseInt(r[a]));else for(r=a.getElementsByTagName("tile"),s._tiles=[],a=0;a<r.length;a++)s._tiles.push(parseInt(r[a].getAttribute("gid")));break;default:this.layerAttrs===cc.TMXLayerInfo.ATTRIB_NONE&&cc.log("cc.TMXMapInfo.parseXMLFile(): Only base64 and/or gzip/zlib maps are supported")}if(c=c.querySelectorAll("properties > property")){for(a={},r=0;r<c.length;r++)a[c[r].getAttribute("name")]=c[r].getAttribute("value");s.properties=a}this.setLayers(s)}if(o=i.getElementsByTagName("objectgroup"))for(n=0;n<o.length;n++){if(c=o[n],s=new cc.TMXObjectGroup,s.groupName=c.getAttribute("name"),s.setPositionOffset(cc.p(parseFloat(c.getAttribute("x"))*this.getTileSize().width||0,parseFloat(c.getAttribute("y"))*this.getTileSize().height||0)),a=c.querySelectorAll("objectgroup > properties > property"))for(r=0;r<a.length;r++)l={},l[a[r].getAttribute("name")]=a[r].getAttribute("value"),s.properties=l;if(c=c.querySelectorAll("object"),a=cc.director.getContentScaleFactor(),c)for(r=0;r<c.length;r++){if(h=c[r],l={},l.name=h.getAttribute("name")||"",l.type=h.getAttribute("type")||"",l.width=parseInt(h.getAttribute("width"))||0,l.height=parseInt(h.getAttribute("height"))||0,l.x=((0|(h.getAttribute("x")||0))+s.getPositionOffset().x)/a,u=(0|(h.getAttribute("y")||0))+s.getPositionOffset().y/a,l.y=(parseInt(this.getMapSize().height*this.getTileSize().height)-u-l.height)/cc.director.getContentScaleFactor(),l.rotation=parseInt(h.getAttribute("rotation"))||0,u=h.querySelectorAll("properties > property"))for(var d=0;d<u.length;d++)l[u[d].getAttribute("name")]=u[d].getAttribute("value");(u=h.querySelectorAll("polygon"))&&0<u.length&&(u=u[0].getAttribute("points"))&&(l.polygonPoints=this._parsePointsString(u)),(h=h.querySelectorAll("polyline"))&&0<h.length&&(h=h[0].getAttribute("points"))&&(l.polylinePoints=this._parsePointsString(h)),s.setObjects(l)}this.setObjectGroups(s)}return i},_parsePointsString:function(t){if(!t)return null;var e=[];t=t.split(" ");for(var i=0;i<t.length;i++){var n=t[i].split(",");e.push({x:n[0],y:n[1]})}return e},parseXMLString:function(t){return this.parseXMLFile(t,!0)},getTileProperties:function(){return this._tileProperties},setTileProperties:function(t){this._tileProperties.push(t)},getCurrentString:function(){return this.currentString},setCurrentString:function(t){this.currentString=t},getTMXFileName:function(){return this.tmxFileName},setTMXFileName:function(t){this.tmxFileName=t},_internalInit:function(t,e){this._tilesets.length=0,this._layers.length=0,this.tmxFileName=t,e&&(this._resources=e),this._objectGroups.length=0,this.properties.length=0,this._tileProperties.length=0,this.currentString="",this.storingCharacters=!1,this.layerAttrs=cc.TMXLayerInfo.ATTRIB_NONE,this.parentElement=cc.TMX_PROPERTY_NONE,this._currentFirstGID=0}}),_p=cc.TMXMapInfo.prototype,cc.defineGetterSetter(_p,"mapWidth",_p._getMapWidth,_p._setMapWidth),cc.defineGetterSetter(_p,"mapHeight",_p._getMapHeight,_p._setMapHeight),cc.defineGetterSetter(_p,"tileWidth",_p._getTileWidth,_p._setTileWidth),cc.defineGetterSetter(_p,"tileHeight",_p._getTileHeight,_p._setTileHeight),cc.TMXMapInfo.create=function(t,e){return new cc.TMXMapInfo(t,e)},cc.loader.register(["tmx","tsx"],cc._txtLoader),cc.TMXLayerInfo.ATTRIB_NONE=1,cc.TMXLayerInfo.ATTRIB_BASE64=2,cc.TMXLayerInfo.ATTRIB_GZIP=4,cc.TMXLayerInfo.ATTRIB_ZLIB=8,cc.TMXObjectGroup=cc.Class.extend({properties:null,groupName:"",_positionOffset:null,_objects:null,ctor:function(){this.groupName="",this._positionOffset=cc.p(0,0),this.properties=[],this._objects=[]},getPositionOffset:function(){return cc.p(this._positionOffset)},setPositionOffset:function(t){this._positionOffset.x=t.x,this._positionOffset.y=t.y},getProperties:function(){return this.properties},setProperties:function(t){this.properties.push(t)},getGroupName:function(){return this.groupName.toString()},setGroupName:function(t){this.groupName=t},propertyNamed:function(t){return this.properties[t]},objectNamed:function(t){return this.getObject(t)},getObject:function(t){if(this._objects&&0<this._objects.length)for(var e=this._objects,i=0,n=e.length;n>i;i++){var r=e[i].name;if(r&&r===t)return e[i]}return null},getObjects:function(){return this._objects},setObjects:function(t){this._objects.push(t)}}),cc.TMXLayer=cc.SpriteBatchNode.extend({tiles:null,tileset:null,layerOrientation:null,properties:null,layerName:"",_layerSize:null,_mapTileSize:null,_opacity:255,_minGID:null,_maxGID:null,_vertexZvalue:null,_useAutomaticVertexZ:null,_reusedTile:null,_atlasIndexArray:null,_contentScaleFactor:null,_className:"TMXLayer",ctor:function(t,e,i){cc.SpriteBatchNode.prototype.ctor.call(this),this._descendants=[],this._layerSize=cc.size(0,0),this._mapTileSize=cc.size(0,0),void 0!==i&&this.initWithTilesetInfo(t,e,i)},_createRenderCmd:function(){return cc._renderType===cc._RENDER_TYPE_CANVAS?new cc.TMXLayer.CanvasRenderCmd(this):new cc.TMXLayer.WebGLRenderCmd(this)},setContentSize:function(t,e){cc.Node.prototype.setContentSize.call(this,t,e),this._renderCmd._updateCacheContext(t,e)},getTexture:function(){return this._renderCmd.getTexture()},getLayerSize:function(){return cc.size(this._layerSize.width,this._layerSize.height)},setLayerSize:function(t){this._layerSize.width=t.width,this._layerSize.height=t.height},_getLayerWidth:function(){return this._layerSize.width},_setLayerWidth:function(t){this._layerSize.width=t},_getLayerHeight:function(){return this._layerSize.height},_setLayerHeight:function(t){this._layerSize.height=t},getMapTileSize:function(){return cc.size(this._mapTileSize.width,this._mapTileSize.height)},setMapTileSize:function(t){this._mapTileSize.width=t.width,this._mapTileSize.height=t.height},_getTileWidth:function(){return this._mapTileSize.width},_setTileWidth:function(t){this._mapTileSize.width=t},_getTileHeight:function(){return this._mapTileSize.height},_setTileHeight:function(t){this._mapTileSize.height=t},getTiles:function(){return this.tiles},setTiles:function(t){this.tiles=t},getTileset:function(){return this.tileset},setTileset:function(t){this.tileset=t},getLayerOrientation:function(){return this.layerOrientation},setLayerOrientation:function(t){this.layerOrientation=t},getProperties:function(){return this.properties},setProperties:function(t){this.properties=t},initWithTilesetInfo:function(t,e,i){var n,r=e._layerSize,o=.35*parseInt(r.width*r.height)+1;return t&&(n=cc.textureCache.addImage(t.sourceImage)),this.initWithTexture(n,o)?(this.layerName=e.name,this._layerSize=r,this.tiles=e._tiles,this._minGID=e._minGID,this._maxGID=e._maxGID,this._opacity=e._opacity,this.properties=e.properties,this._contentScaleFactor=cc.director.getContentScaleFactor(),this.tileset=t,this._mapTileSize=i.getTileSize(),this.layerOrientation=i.orientation,t=this._calculateLayerOffset(e.offset),this.setPosition(cc.pointPixelsToPoints(t)),this._atlasIndexArray=[],this.setContentSize(cc.sizePixelsToPoints(cc.size(this._layerSize.width*this._mapTileSize.width,this._layerSize.height*this._mapTileSize.height))),this._useAutomaticVertexZ=!1,this._vertexZvalue=0,!0):!1},releaseMap:function(){this.tiles&&(this.tiles=null),this._atlasIndexArray&&(this._atlasIndexArray=null)},getTileAt:function(t,e){if(!t)throw"cc.TMXLayer.getTileAt(): pos should be non-null";if(void 0!==e&&(t=cc.p(t,e)),t.x>=this._layerSize.width||t.y>=this._layerSize.height||0>t.x||0>t.y)throw"cc.TMXLayer.getTileAt(): invalid position";if(!this.tiles||!this._atlasIndexArray)return cc.log("cc.TMXLayer.getTileAt(): TMXLayer: the tiles map has been released"),null;var i=null,n=this.getTileGIDAt(t);if(0===n)return i;var r=0|t.x+t.y*this._layerSize.width,i=this.getChildByTag(r);return i||(n=this.tileset.rectForGID(n),n=cc.rectPixelsToPoints(n),i=new cc.Sprite,i.initWithTexture(this.texture,n),i.batchNode=this,i.setPosition(this.getPositionAt(t)),i.vertexZ=this._vertexZForPos(t),i.anchorX=0,i.anchorY=0,i.opacity=this._opacity,n=this._atlasIndexForExistantZ(r),this.addSpriteWithoutQuad(i,n,r)),i},getTileGIDAt:function(t,e){if(null==t)throw"cc.TMXLayer.getTileGIDAt(): pos should be non-null";if(void 0!==e&&(t=cc.p(t,e)),t.x>=this._layerSize.width||t.y>=this._layerSize.height||0>t.x||0>t.y)throw"cc.TMXLayer.getTileGIDAt(): invalid position";return this.tiles&&this._atlasIndexArray?(this.tiles[0|t.x+t.y*this._layerSize.width]&cc.TMX_TILE_FLIPPED_MASK)>>>0:(cc.log("cc.TMXLayer.getTileGIDAt(): TMXLayer: the tiles map has been released"),null)},getTileFlagsAt:function(t,e){if(!t)throw"cc.TMXLayer.getTileFlagsAt(): pos should be non-null";if(void 0!==e&&(t=cc.p(t,e)),t.x>=this._layerSize.width||t.y>=this._layerSize.height||0>t.x||0>t.y)throw"cc.TMXLayer.getTileFlagsAt(): invalid position";return this.tiles&&this._atlasIndexArray?(this.tiles[0|t.x+t.y*this._layerSize.width]&cc.TMX_TILE_FLIPPED_ALL)>>>0:(cc.log("cc.TMXLayer.getTileFlagsAt(): TMXLayer: the tiles map has been released"),null)},setTileGID:function(t,e,i,n){if(!e)throw"cc.TMXLayer.setTileGID(): pos should be non-null";if(void 0!==n?e=cc.p(e,i):n=i,e.x>=this._layerSize.width||e.y>=this._layerSize.height||0>e.x||0>e.y)throw"cc.TMXLayer.setTileGID(): invalid position";if(this.tiles&&this._atlasIndexArray)if(0!==t&&t<this.tileset.firstGid)cc.log("cc.TMXLayer.setTileGID(): invalid gid:"+t);else{n=n||0,this._setNodeDirtyForCache(),i=this.getTileFlagsAt(e);var r=this.getTileGIDAt(e);if(r!==t||i!==n)if(i=(t|n)>>>0,0===t)this.removeTileAt(e);else if(0===r)this._insertTileForGID(i,e);else{var r=e.x+e.y*this._layerSize.width,o=this.getChildByTag(r);o?(t=this.tileset.rectForGID(t),t=cc.rectPixelsToPoints(t),o.setTextureRect(t,!1),null!=n&&this._setupTileSprite(o,e,i),this.tiles[r]=i):this._updateTileForGID(i,e)}}else cc.log("cc.TMXLayer.setTileGID(): TMXLayer: the tiles map has been released")},removeTileAt:function(t,e){if(!t)throw"cc.TMXLayer.removeTileAt(): pos should be non-null";if(void 0!==e&&(t=cc.p(t,e)),t.x>=this._layerSize.width||t.y>=this._layerSize.height||0>t.x||0>t.y)throw"cc.TMXLayer.removeTileAt(): invalid position";if(this.tiles&&this._atlasIndexArray){if(0!==this.getTileGIDAt(t)){cc._renderType===cc._RENDER_TYPE_CANVAS&&this._setNodeDirtyForCache();var i=0|t.x+t.y*this._layerSize.width,n=this._atlasIndexForExistantZ(i);if(this.tiles[i]=0,this._atlasIndexArray.splice(n,1),i=this.getChildByTag(i))cc.SpriteBatchNode.prototype.removeChild.call(this,i,!0);else if(cc._renderType===cc._RENDER_TYPE_WEBGL&&this.textureAtlas.removeQuadAtIndex(n),this._children)for(var i=this._children,r=0,o=i.length;o>r;r++){var s=i[r];if(s){var c=s.atlasIndex;c>=n&&(s.atlasIndex=c-1)}}}}else cc.log("cc.TMXLayer.removeTileAt(): TMXLayer: the tiles map has been released")},getPositionAt:function(t,e){void 0!==e&&(t=cc.p(t,e));var i=cc.p(0,0);switch(this.layerOrientation){case cc.TMX_ORIENTATION_ORTHO:i=this._positionForOrthoAt(t);break;case cc.TMX_ORIENTATION_ISO:i=this._positionForIsoAt(t);break;case cc.TMX_ORIENTATION_HEX:i=this._positionForHexAt(t)}return cc.pointPixelsToPoints(i)},getProperty:function(t){return this.properties[t]},setupTiles:function(){this._renderCmd.initImageSize(),this._parseInternalProperties(),cc._renderType===cc._RENDER_TYPE_CANVAS&&this._setNodeDirtyForCache();for(var t=this._layerSize.height,e=this._layerSize.width,i=0;t>i;i++)for(var n=0;e>n;n++){var r=this.tiles[n+e*i];0!==r&&(this._appendTileForGID(r,cc.p(n,i)),this._minGID=Math.min(r,this._minGID),this._maxGID=Math.max(r,this._maxGID))}this._maxGID>=this.tileset.firstGid&&this._minGID>=this.tileset.firstGid||cc.log("cocos2d:TMX: Only 1 tileset per layer is supported")
},addChild:function(){cc.log("addChild: is not supported on cc.TMXLayer. Instead use setTileGID or tileAt.")},removeChild:function(t,e){if(t)if(-1===this._children.indexOf(t))cc.log("cc.TMXLayer.removeChild(): Tile does not belong to TMXLayer");else{cc._renderType===cc._RENDER_TYPE_CANVAS&&this._setNodeDirtyForCache();var i=t.atlasIndex;this.tiles[this._atlasIndexArray[i]]=0,this._atlasIndexArray.splice(i,1),cc.SpriteBatchNode.prototype.removeChild.call(this,t,e),cc.renderer.childrenOrderDirty=!0}},getLayerName:function(){return this.layerName},setLayerName:function(t){this.layerName=t},_positionForIsoAt:function(t){return cc.p(this._mapTileSize.width/2*(this._layerSize.width+t.x-t.y-1),this._mapTileSize.height/2*(2*this._layerSize.height-t.x-t.y-2))},_positionForOrthoAt:function(t){return cc.p(t.x*this._mapTileSize.width,(this._layerSize.height-t.y-1)*this._mapTileSize.height)},_positionForHexAt:function(t){return cc.p(t.x*this._mapTileSize.width*3/4,(this._layerSize.height-t.y-1)*this._mapTileSize.height+(1===t.x%2?-this._mapTileSize.height/2:0))},_calculateLayerOffset:function(t){var e=cc.p(0,0);switch(this.layerOrientation){case cc.TMX_ORIENTATION_ORTHO:e=cc.p(t.x*this._mapTileSize.width,-t.y*this._mapTileSize.height);break;case cc.TMX_ORIENTATION_ISO:e=cc.p(this._mapTileSize.width/2*(t.x-t.y),this._mapTileSize.height/2*(-t.x-t.y));break;case cc.TMX_ORIENTATION_HEX:0===t.x&&0===t.y||cc.log("offset for hexagonal map not implemented yet")}return e},_appendTileForGID:function(t,e){var i=this.tileset.rectForGID(t),i=cc.rectPixelsToPoints(i),n=0|e.x+e.y*this._layerSize.width,i=this._renderCmd._reusedTileWithRect(i);this._setupTileSprite(i,e,t);var r=this._atlasIndexArray.length;return this.insertQuadFromSprite(i,r),this._atlasIndexArray.splice(r,0,n),i},_insertTileForGID:function(t,e){var i=this.tileset.rectForGID(t),i=cc.rectPixelsToPoints(i),n=0|e.x+e.y*this._layerSize.width,i=this._renderCmd._reusedTileWithRect(i);this._setupTileSprite(i,e,t);var r=this._atlasIndexForNewZ(n);if(this.insertQuadFromSprite(i,r),this._atlasIndexArray.splice(r,0,n),this._children)for(var o=this._children,s=0,c=o.length;c>s;s++){var a=o[s];if(a){var l=a.atlasIndex;l>=r&&(a.atlasIndex=l+1)}}return this.tiles[n]=t,i},_updateTileForGID:function(t,e){var i=this.tileset.rectForGID(t),n=this._contentScaleFactor,i=cc.rect(i.x/n,i.y/n,i.width/n,i.height/n),n=e.x+e.y*this._layerSize.width,i=this._renderCmd._reusedTileWithRect(i);return this._setupTileSprite(i,e,t),i.atlasIndex=this._atlasIndexForExistantZ(n),i.dirty=!0,i.updateTransform(),this.tiles[n]=t,i},_parseInternalProperties:function(){var t=this.getProperty("cc_vertexz");if(t)if("automatic"===t){this._useAutomaticVertexZ=!0;var e=this.getProperty("cc_alpha_func"),t=0;e&&(t=parseFloat(e)),cc._renderType===cc._RENDER_TYPE_WEBGL&&(this.shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURECOLORALPHATEST),e=cc._renderContext.getUniformLocation(this.shaderProgram.getProgram(),cc.UNIFORM_ALPHA_TEST_VALUE_S),this.shaderProgram.use(),this.shaderProgram.setUniformLocationWith1f(e,t))}else this._vertexZvalue=parseInt(t,10)},_setupTileSprite:function(t,e,i){var n=e.x+e.y*this._layerSize.width;t.setPosition(this.getPositionAt(e)),cc._renderType===cc._RENDER_TYPE_WEBGL?t.vertexZ=this._vertexZForPos(e):t.tag=n,t.anchorX=0,t.anchorY=0,t.opacity=this._opacity,cc._renderType===cc._RENDER_TYPE_WEBGL&&(t.rotation=0),t.setFlippedX(!1),t.setFlippedY(!1),(i&cc.TMX_TILE_DIAGONAL_FLAG)>>>0?(t.anchorX=.5,t.anchorY=.5,t.x=this.getPositionAt(e).x+t.width/2,t.y=this.getPositionAt(e).y+t.height/2,e=(i&(cc.TMX_TILE_HORIZONTAL_FLAG|cc.TMX_TILE_VERTICAL_FLAG)>>>0)>>>0,e===cc.TMX_TILE_HORIZONTAL_FLAG?t.rotation=90:e===cc.TMX_TILE_VERTICAL_FLAG?t.rotation=270:(t.rotation=e===(cc.TMX_TILE_VERTICAL_FLAG|cc.TMX_TILE_HORIZONTAL_FLAG)>>>0?90:270,t.setFlippedX(!0))):((i&cc.TMX_TILE_HORIZONTAL_FLAG)>>>0&&t.setFlippedX(!0),(i&cc.TMX_TILE_VERTICAL_FLAG)>>>0&&t.setFlippedY(!0))},_vertexZForPos:function(t){var e=0,i=0;if(this._useAutomaticVertexZ)switch(this.layerOrientation){case cc.TMX_ORIENTATION_ISO:i=this._layerSize.width+this._layerSize.height,e=-(i-(t.x+t.y));break;case cc.TMX_ORIENTATION_ORTHO:e=-(this._layerSize.height-t.y);break;case cc.TMX_ORIENTATION_HEX:cc.log("TMX Hexa zOrder not supported");break;default:cc.log("TMX invalid value")}else e=this._vertexZvalue;return e},_atlasIndexForExistantZ:function(t){var e;if(this._atlasIndexArray)for(var i=this._atlasIndexArray,n=0,r=i.length;r>n&&(e=i[n],e!==t);n++);return cc.isNumber(e)||cc.log("cc.TMXLayer._atlasIndexForExistantZ(): TMX atlas index not found. Shall not happen"),n},_atlasIndexForNewZ:function(t){for(var e=this._atlasIndexArray,i=0,n=e.length;n>i&&!(t<e[i]);i++);return i}}),_p=cc.TMXLayer.prototype,cc.defineGetterSetter(_p,"texture",_p.getTexture,_p.setTexture),cc.defineGetterSetter(_p,"layerWidth",_p._getLayerWidth,_p._setLayerWidth),cc.defineGetterSetter(_p,"layerHeight",_p._getLayerHeight,_p._setLayerHeight),cc.defineGetterSetter(_p,"tileWidth",_p._getTileWidth,_p._setTileWidth),cc.defineGetterSetter(_p,"tileHeight",_p._getTileHeight,_p._setTileHeight),cc.TMXLayer.create=function(t,e,i){return new cc.TMXLayer(t,e,i)},function(){cc.TMXLayer.CanvasRenderCmd=function(t){cc.SpriteBatchNode.CanvasRenderCmd.call(this,t),this._needDraw=!0,this._realWorldTransform={a:1,b:0,c:0,d:1,tx:0,ty:0};var e=cc._canvas;t=cc.newElement("canvas"),t.width=e.width,t.height=e.height,this._cacheCanvas=t,this._cacheContext=new cc.CanvasContextWrapper(this._cacheCanvas.getContext("2d")),e=new cc.Texture2D,e.initWithElement(t),e.handleLoadedTexture(),this._cacheTexture=e,this._cacheDirty=!1};var t=cc.TMXLayer.CanvasRenderCmd.prototype=Object.create(cc.SpriteBatchNode.CanvasRenderCmd.prototype);t.constructor=cc.TMXLayer.CanvasRenderCmd,t._setNodeDirtyForCache=function(){this._cacheDirty=!0},t._renderingChildToCache=function(){if(this._cacheDirty){var t=this._cacheContext,e=t.getContext(),i=this._cacheCanvas;e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,i.width,i.height);for(var e=this._node._children,i=0,n=e.length;n>i;i++)if(e[i]){var r=e[i]._renderCmd;r&&(r.rendering(t,1,1),r._cacheDirty=!1)}this._cacheDirty=!1}},t.rendering=function(t,e,i){var n=this._displayedOpacity/255;if(!(0>=n)){var r=this._node;this._renderingChildToCache();var o=t||cc._renderContext;t=o.getContext(),o.setGlobalAlpha(n),(n=this._cacheCanvas)&&0!==n.width&&0!==n.height&&(o.setTransform(this._realWorldTransform,e,i),o=n.height*i,r.layerOrientation===cc.TMX_ORIENTATION_HEX?t.drawImage(n,0,0,n.width,n.height,0,-o+.5*r._mapTileSize.height*i,n.width*e,o):t.drawImage(n,0,0,n.width,n.height,0,-o,n.width*e,o)),cc.g_NumberOfDraws++}},t._updateCacheContext=function(){var t=this._node,e=t._contentSize,i=this._cacheCanvas,n=cc.contentScaleFactor();i.width=0|1.5*e.width*n,i.height=0|1.5*e.height*n,t.layerOrientation===cc.TMX_ORIENTATION_HEX?this._cacheContext.setOffset(0,.5*-t._mapTileSize.height):this._cacheContext.setOffset(0,0),t=this._cacheTexture._contentSize,t.width=i.width,t.height=i.height},t.getTexture=function(){return this._cacheTexture},t.visit=function(t){var e,i=this._node,n=i._children;if(i._visible&&n&&0!==n.length){if((t=t||this.getParentRenderCmd())&&(this._curLevel=t._curLevel+1),this._syncStatus(t),this._cacheDirty){t=this._cacheContext;var r=this._cacheCanvas,o=t.getContext(),s=i.__instanceId,c=cc.renderer;for(c._turnToCacheMode(s),i.sortAllChildren(),i=0,e=n.length;e>i;i++)if(n[i]){var a=n[i]._renderCmd;a&&(a.visit(this),a._cacheDirty=!1)}o.setTransform(1,0,0,1,0,0),o.clearRect(0,0,r.width,r.height),c._renderingToCacheCanvas(t,s),this._cacheDirty=!1}cc.renderer.pushRenderCommand(this),this._dirtyFlag=0}},t.transform=function(t,e){var i=this.getNodeToParentTransform(),n=this._realWorldTransform;if(t){var r=t._worldTransform;n.a=i.a*r.a+i.b*r.c,n.b=i.a*r.b+i.b*r.d,n.c=i.c*r.a+i.d*r.c,n.d=i.c*r.b+i.d*r.d,n.tx=r.a*i.tx+r.c*i.ty+r.tx,n.ty=r.d*i.ty+r.ty+r.b*i.tx}else n.a=i.a,n.b=i.b,n.c=i.c,n.d=i.d,n.tx=i.tx,n.ty=i.ty;if(e&&(i=this._node._children)&&0!==i.length)for(n=0,r=i.length;r>n;n++)i[n]._renderCmd.transform(this,e)},t.initImageSize=function(){this._node.tileset.imageSize=this._originalTexture.getContentSizeInPixels()},t._reusedTileWithRect=function(t){var e=this._node;return e._reusedTile=new cc.Sprite,e._reusedTile.initWithTexture(e._renderCmd._texture,t,!1),e._reusedTile.batchNode=e,e._reusedTile.parent=e,e._reusedTile._renderCmd._cachedParent=e._renderCmd,e._reusedTile}}(),function(){cc.TMXLayer.WebGLRenderCmd=function(t){cc.SpriteBatchNode.WebGLRenderCmd.call(this,t),this._needDraw=!0};var t=cc.TMXLayer.WebGLRenderCmd.prototype=Object.create(cc.SpriteBatchNode.WebGLRenderCmd.prototype);t.constructor=cc.TMXLayer.WebGLRenderCmd,t._updateCacheContext=function(){},t.initImageSize=function(){this._node.tileset.imageSize=this._textureAtlas.texture.getContentSizeInPixels(),this._textureAtlas.texture.setAliasTexParameters()},t._reusedTileWithRect=function(t){var e=this._node;return e._reusedTile?(e._reusedTile.batchNode=null,e._reusedTile.setTextureRect(t,!1)):(e._reusedTile=new cc.Sprite,e._reusedTile.initWithTexture(e.texture,t,!1)),e._reusedTile.batchNode=e,e._reusedTile}}(),cc.PointObject=cc.Class.extend({_ratio:null,_offset:null,_child:null,ctor:function(t,e){this.initWithCCPoint(t,e)},getRatio:function(){return this._ratio},setRatio:function(t){this._ratio=t},getOffset:function(){return this._offset},setOffset:function(t){this._offset=t},getChild:function(){return this._child},setChild:function(t){this._child=t},initWithCCPoint:function(t,e){return this._ratio=t,this._offset=e,this._child=null,!0}}),cc.PointObject.create=function(t,e){return new cc.PointObject(t,e)},cc.ParallaxNode=cc.Node.extend({parallaxArray:null,_lastPosition:null,_className:"ParallaxNode",getParallaxArray:function(){return this.parallaxArray},setParallaxArray:function(t){this.parallaxArray=t},ctor:function(){cc.Node.prototype.ctor.call(this),this.parallaxArray=[],this._lastPosition=cc.p(-100,-100)},addChild:function(t,e,i,n){if(3===arguments.length)cc.log("ParallaxNode: use addChild(child, z, ratio, offset) instead");else{if(!t)throw"cc.ParallaxNode.addChild(): child should be non-null";var r=new cc.PointObject(i,n);r.setChild(t),this.parallaxArray.push(r),t.setPosition(this._position.x*i.x+n.x,this._position.y*i.y+n.y),cc.Node.prototype.addChild.call(this,t,e,t.tag)}},removeChild:function(t,e){for(var i=this.parallaxArray,n=0;n<i.length;n++)if(i[n].getChild()===t){i.splice(n,1);break}cc.Node.prototype.removeChild.call(this,t,e)},removeAllChildren:function(t){this.parallaxArray.length=0,cc.Node.prototype.removeAllChildren.call(this,t)},_updateParallaxPosition:function(){var t=this._absolutePosition();if(!cc.pointEqualToPoint(t,this._lastPosition)){for(var e=this.parallaxArray,i=0,n=e.length;n>i;i++){var r=e[i];r.getChild().setPosition(-t.x+t.x*r.getRatio().x+r.getOffset().x,-t.y+t.y*r.getRatio().y+r.getOffset().y)}this._lastPosition=t}},_absolutePosition:function(){for(var t=this._position,e=this;null!==e.parent;)e=e.parent,t=cc.pAdd(t,e.getPosition());return t},_createRenderCmd:function(){return cc._renderType===cc._RENDER_TYPE_CANVAS?new cc.ParallaxNode.CanvasRenderCmd(this):new cc.ParallaxNode.WebGLRenderCmd(this)}}),cc.ParallaxNode.create=function(){return new cc.ParallaxNode},function(){cc.ParallaxNode.CanvasRenderCmd=function(t){cc.Node.CanvasRenderCmd.call(this,t),this._needDraw=!1};var t=cc.ParallaxNode.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);t.constructor=cc.ParallaxNode.CanvasRenderCmd,t.updateStatus=function(){this._node._updateParallaxPosition(),cc.Node.CanvasRenderCmd.prototype.updateStatus.call(this)},t._syncStatus=function(t){this._node._updateParallaxPosition(),cc.Node.CanvasRenderCmd.prototype._syncStatus.call(this,t)}}(),function(){if(cc._renderType===cc._RENDER_TYPE_WEBGL){cc.ParallaxNode.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t),this._needDraw=!1};var t=cc.ParallaxNode.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);t.constructor=cc.ParallaxNode.WebGLRenderCmd,t.updateStatus=function(){this._node._updateParallaxPosition(),cc.Node.WebGLRenderCmd.prototype.updateStatus.call(this)},t._syncStatus=function(t){this._node._updateParallaxPosition(),cc.Node.WebGLRenderCmd.prototype._syncStatus.call(this,t)}}}(),function(){var t=cc.sys,e={common:{multichannel:!0,webAudio:cc.sys._supportWebAudio,auto:!0}};e[t.BROWSER_TYPE_IE]={multichannel:!0,webAudio:cc.sys._supportWebAudio,auto:!0,emptied:!0},e[t.BROWSER_TYPE_ANDROID]={multichannel:!1,webAudio:!1,auto:!1},e[t.BROWSER_TYPE_CHROME]={multichannel:!0,webAudio:!0,auto:!1},e[t.BROWSER_TYPE_FIREFOX]={multichannel:!0,webAudio:!0,auto:!0,delay:!0},e[t.BROWSER_TYPE_UC]={multichannel:!0,webAudio:!1,auto:!1},e[t.BROWSER_TYPE_QQ]={multichannel:!1,webAudio:!1,auto:!0},e[t.BROWSER_TYPE_OUPENG]={multichannel:!1,webAudio:!1,auto:!1,replay:!0,emptied:!0},e[t.BROWSER_TYPE_WECHAT]={multichannel:!1,webAudio:!1,auto:!1,replay:!0,emptied:!0},e[t.BROWSER_TYPE_360]={multichannel:!1,webAudio:!1,auto:!0},e[t.BROWSER_TYPE_MIUI]={multichannel:!1,webAudio:!1,auto:!0},e[t.BROWSER_TYPE_LIEBAO]={multichannel:!1,webAudio:!1,auto:!1,replay:!0,emptied:!0},e[t.BROWSER_TYPE_SOUGOU]={multichannel:!1,webAudio:!1,auto:!1,replay:!0,emptied:!0},e[t.BROWSER_TYPE_BAIDU]={multichannel:!1,webAudio:!1,auto:!1,replay:!0,emptied:!0},e[t.BROWSER_TYPE_BAIDU_APP]={multichannel:!1,webAudio:!1,auto:!1,replay:!0,emptied:!0},e[t.BROWSER_TYPE_SAFARI]={multichannel:!0,webAudio:!0,auto:!1,webAudioCallback:function(t){document.createElement("audio").src=t}};var i,n;try{var r=navigator.userAgent.toLowerCase();switch(t.browserType){case t.BROWSER_TYPE_IE:n=r.match(/(msie |rv:)([\d.]+)/);break;case t.BROWSER_TYPE_FIREFOX:n=r.match(/(firefox\/|rv:)([\d.]+)/);break;case t.BROWSER_TYPE_CHROME:n=r.match(/chrome\/([\d.]+)/);break;case t.BROWSER_TYPE_BAIDU:n=r.match(/baidubrowser\/([\d.]+)/);break;case t.BROWSER_TYPE_UC:n=r.match(/ucbrowser\/([\d.]+)/);break;case t.BROWSER_TYPE_QQ:n=r.match(/qqbrowser\/([\d.]+)/);break;case t.BROWSER_TYPE_OUPENG:n=r.match(/oupeng\/([\d.]+)/);break;case t.BROWSER_TYPE_WECHAT:n=r.match(/micromessenger\/([\d.]+)/);break;case t.BROWSER_TYPE_SAFARI:n=r.match(/safari\/([\d.]+)/);break;case t.BROWSER_TYPE_MIUI:n=r.match(/miuibrowser\/([\d.]+)/)}i=n?n[1]:""}catch(o){console.log(o)}if(cc.sys.isMobile)cc.__audioSupport=cc.sys.os!==cc.sys.OS_IOS?e[t.browserType]||e.common:e[t.BROWSER_TYPE_SAFARI];else switch(t.browserType){case t.BROWSER_TYPE_IE:cc.__audioSupport=e[t.BROWSER_TYPE_IE];break;case t.BROWSER_TYPE_FIREFOX:cc.__audioSupport=e[t.BROWSER_TYPE_FIREFOX];break;default:cc.__audioSupport=e.common}if(i)switch(t.browserType){case t.BROWSER_TYPE_CHROME:i=parseInt(i),30>i?cc.__audioSupport={multichannel:!1,webAudio:!0,auto:!1}:42===i&&(cc.__audioSupport.manualLoop=!0);break;case t.BROWSER_TYPE_MIUI:cc.sys.isMobile&&(i=i.match(/\d+/g),2>i[0]||2===i[0]&&0===i[1]&&1>=i[2])&&(cc.__audioSupport.auto=!1)}}(),cc.Audio=cc.Class.extend({volume:1,loop:!1,src:null,_touch:!1,_playing:!1,_AUDIO_TYPE:"AUDIO",_pause:!1,_buffer:null,_currentSource:null,_startTime:null,_currentTime:null,_context:null,_volume:null,_ignoreEnded:!1,_manualLoop:!1,_element:null,ctor:function(t,e,i){t&&(this._context=t),e&&(this._volume=e),t&&e&&(this._AUDIO_TYPE="WEBAUDIO"),this.src=i},_setBufferCallback:null,setBuffer:function(t){if(t){var e=this._playing;this._AUDIO_TYPE="WEBAUDIO",this._buffer&&this._buffer!==t&&this.getPlaying()&&this.stop(),this._buffer=t,e&&this.play(),this._volume.gain.value=this.volume,this._setBufferCallback&&this._setBufferCallback(t)}},_setElementCallback:null,setElement:function(t){if(t){var e=this._playing;this._AUDIO_TYPE="AUDIO",this._element&&this._element!==t&&this.getPlaying()&&this.stop(),this._element=t,e&&this.play(),t.volume=this.volume,t.loop=this.loop,this._setElementCallback&&this._setElementCallback(t)}},play:function(t,e){this._playing=!0,this.loop=void 0===e?this.loop:e,"AUDIO"===this._AUDIO_TYPE?this._playOfAudio(t):this._playOfWebAudio(t)},getPlaying:function(){if(!this._playing)return this._playing;if("AUDIO"===this._AUDIO_TYPE){var t=this._element;return!t||this._pause||t.ended?this._playing=!1:!0}return(t=this._currentSource)?null==t.playbackState?this._playing:this._currentTime+this._context.currentTime-this._startTime<this._currentSource.buffer.duration:!0},_playOfWebAudio:function(t){var e=this._currentSource;if(this._buffer){if(!this._pause&&e){if(!(0===this._context.currentTime||this._currentTime+this._context.currentTime-this._startTime>this._currentSource.buffer.duration))return;this._stopOfWebAudio()}if(e=this._context.createBufferSource(),e.buffer=this._buffer,e.connect(this._volume),e.loop=this._manualLoop?!1:this.loop,this._startTime=this._context.currentTime,this._currentTime=t||0,e.start)e.start(0,t||0);else if(e.noteGrainOn){var i=e.buffer.duration;this.loop?e.noteGrainOn(0,t,i):e.noteGrainOn(0,t,i-t)}else e.noteOn(0);this._currentSource=e;var n=this;e.onended=function(){n._manualLoop&&n._playing&&n.loop?(n.stop(),n.play()):n._ignoreEnded?n._ignoreEnded=!1:n._pause?n._playing=!1:n.stop()}}},_playOfAudio:function(){var t=this._element;t&&(t.loop=this.loop,t.play())},stop:function(){this._playing=!1,"AUDIO"===this._AUDIO_TYPE?this._stopOfAudio():this._stopOfWebAudio()},_stopOfWebAudio:function(){var t=this._currentSource;this._ignoreEnded=!0,t&&(t.stop(0),this._currentSource=null)},_stopOfAudio:function(){var t=this._element;t&&(t.pause(),t.duration&&1/0!==t.duration&&(t.currentTime=0))},pause:function(){!1!==this.getPlaying()&&(this._playing=!1,this._pause=!0,"AUDIO"===this._AUDIO_TYPE?this._pauseOfAudio():this._pauseOfWebAudio())},_pauseOfWebAudio:function(){this._currentTime+=this._context.currentTime-this._startTime;var t=this._currentSource;t&&t.stop(0)},_pauseOfAudio:function(){var t=this._element;t&&t.pause()},resume:function(){this._pause&&("AUDIO"===this._AUDIO_TYPE?this._resumeOfAudio():this._resumeOfWebAudio(),this._pause=!1,this._playing=!0)},_resumeOfWebAudio:function(){var t=this._currentSource;t&&(this._startTime=this._context.currentTime,this._playOfWebAudio(this._currentTime%t.buffer.duration))},_resumeOfAudio:function(){var t=this._element;t&&t.play()},setVolume:function(t){t>1&&(t=1),0>t&&(t=0),this.volume=t,"AUDIO"===this._AUDIO_TYPE?this._element&&(this._element.volume=t):this._volume&&(this._volume.gain.value=t)},getVolume:function(){return this.volume},cloneNode:function(){var t,e;if("AUDIO"===this._AUDIO_TYPE){t=new cc.Audio;var i=document.createElement("audio");i.src=this.src,t.setElement(i)}else i=this._context.createGain(),i.gain.value=1,i.connect(this._context.destination),t=new cc.Audio(this._context,i,this.src),this._buffer?t.setBuffer(this._buffer):(e=this,this._setBufferCallback=function(i){t.setBuffer(i),e._setBufferCallback=null}),t._manualLoop=this._manualLoop;return t._AUDIO_TYPE=this._AUDIO_TYPE,t}}),function(t){var e=t.webAudio,i=t.multichannel,n=t.auto,r=[];!function(){var t=document.createElement("audio");if(t.canPlayType){var e=t.canPlayType('audio/ogg; codecs="vorbis"');e&&""!==e&&r.push(".ogg"),(e=t.canPlayType("audio/mpeg"))&&""!==e&&r.push(".mp3"),(e=t.canPlayType('audio/wav; codecs="1"'))&&""!==e&&r.push(".wav"),(e=t.canPlayType("audio/mp4"))&&""!==e&&r.push(".mp4"),(t=t.canPlayType("audio/x-m4a"))&&""!==t&&r.push(".m4a")}}();try{if(e){var o=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext);t.delay&&setTimeout(function(){o=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext)},0)}}catch(s){e=!1,cc.log("browser don't support webAudio")}var c={cache:{},load:function(i,n,s,a){if(0===r.length)return a("can not support audio!");cc.loader.audioPath&&(i=cc.path.join(cc.loader.audioPath,i));var l=cc.path.extname(i),h=[l];for(s=0;s<r.length;s++)l!==r[s]&&h.push(r[s]);var u;if(c.cache[n])return a(null,c.cache[n]);if(e)try{var d=o.createGain();d.gain.value=1,d.connect(o.destination),u=new cc.Audio(o,d,i),t.manualLoop&&(u._manualLoop=!0)}catch(_){e=!1,cc.log("browser don't support webAudio"),u=new cc.Audio(null,null,i)}else u=new cc.Audio(null,null,i);this.loadAudioFromExtList(i,h,u,a),c.cache[n]=u},loadAudioFromExtList:function(i,n,s,a){if(0===n.length){var l="can not found the resource of audio! Last match url is : ",l=l+i.replace(/\.(.*)?$/,"(");return r.forEach(function(t){l+=t+"|"}),l=l.replace(/\|$/,")"),a(l)}if(i=cc.path.changeExtname(i,n.splice(0,1)),e){t.webAudioCallback&&t.webAudioCallback(i);var h=new XMLHttpRequest;h.open("GET",i,!0),h.responseType="arraybuffer",h.onload=function(){o.decodeAudioData(h.response,function(t){s.setBuffer(t),a(null,s)},function(){c.loadAudioFromExtList(i,n,s,a)})},h.send()}else{var u=document.createElement("audio"),d=!1,_=!1,p=setTimeout(function(){0===u.readyState?g():(_=!0,u.pause(),document.body.removeChild(u),a("audio load timeout : "+i,s))},1e4),f=function(){if(!d){u.pause();try{u.currentTime=0,u.volume=1}catch(t){}document.body.removeChild(u),s.setElement(u),u.removeEventListener("canplaythrough",f,!1),u.removeEventListener("error",m,!1),u.removeEventListener("emptied",g,!1),!_&&a(null,s),d=!0,clearTimeout(p)}},m=function(){d&&(u.pause(),document.body.removeChild(u),u.removeEventListener("canplaythrough",f,!1),u.removeEventListener("error",m,!1),u.removeEventListener("emptied",g,!1),!_&&c.loadAudioFromExtList(i,n,s,a),d=!0,clearTimeout(p))},g=function(){_=!0,f(),a(null,s)};cc._addEventListener(u,"canplaythrough",f,!1),cc._addEventListener(u,"error",m,!1),t.emptied&&cc._addEventListener(u,"emptied",g,!1),u.src=i,document.body.appendChild(u),u.volume=0,u.play()}}};if(cc.loader.register(["mp3","ogg","wav","mp4","m4a"],c),cc.audioEngine={_currMusic:null,_musicVolume:1,willPlayMusic:function(){return!1},playMusic:function(t,e){var i=this._currMusic;i&&i.src!==t&&i.getPlaying()&&i.stop(),i=c.cache[t],i||(cc.loader.load(t),i=c.cache[t]),i.play(0,e),i.setVolume(this._musicVolume),this._currMusic=i},stopMusic:function(t){var e=this._currMusic;e&&(e.stop(),t&&cc.loader.release(e.src))},pauseMusic:function(){var t=this._currMusic;t&&t.pause()},resumeMusic:function(){var t=this._currMusic;t&&t.resume()},rewindMusic:function(){var t=this._currMusic;t&&(t.stop(),t.play())},getMusicVolume:function(){return this._musicVolume},setMusicVolume:function(t){t-=0,isNaN(t)&&(t=1),t>1&&(t=1),0>t&&(t=0),this._musicVolume=t;var e=this._currMusic;e&&e.setVolume(t)},isMusicPlaying:function(){var t=this._currMusic;return t?t.getPlaying():!1},_audioPool:{},_maxAudioInstance:5,_effectVolume:1,playEffect:function(t,n){if(!i)return null;var r=this._audioPool[t];r||(r=this._audioPool[t]=[]);var o;for(o=0;o<r.length&&r[o].getPlaying();o++);if(r[o])s=r[o],s.setVolume(this._effectVolume),s.play(0,n);else if(!e&&o>this._maxAudioInstance)cc.log("Error: %s greater than %d",t,this._maxAudioInstance);else{var s=c.cache[t];s||(cc.loader.load(t),s=c.cache[t]),s=s.cloneNode(),s.setVolume(this._effectVolume),s.loop=n||!1,s.play(),r.push(s)}return s},setEffectsVolume:function(t){t-=0,isNaN(t)&&(t=1),t>1&&(t=1),0>t&&(t=0),this._effectVolume=t;var e,i=this._audioPool;for(e in i){var n=i[e];if(Array.isArray(n))for(var r=0;r<n.length;r++)n[r].setVolume(t)}},getEffectsVolume:function(){return this._effectVolume},pauseEffect:function(t){t&&t.pause()},pauseAllEffects:function(){var t,e=this._audioPool;for(t in e)for(var i=e[t],n=0;n<e[t].length;n++)i[n].getPlaying()&&i[n].pause()},resumeEffect:function(t){t&&t.resume()},resumeAllEffects:function(){var t,e=this._audioPool;for(t in e)for(var i=e[t],n=0;n<e[t].length;n++)i[n].resume()},stopEffect:function(t){t&&t.stop()},stopAllEffects:function(){var t,e=this._audioPool;for(t in e)for(var i=e[t],n=0;n<e[t].length;n++)i[n].stop()},unloadEffect:function(t){if(t){cc.loader.release(t);var e=this._audioPool[t];e&&(e.length=0),delete this._audioPool[t],delete c.cache[t]}},end:function(){this.stopMusic(),this.stopAllEffects()},_pauseCache:[],_pausePlaying:function(){var t=this._currMusic;t&&t.getPlaying()&&(t.pause(),this._pauseCache.push(t));var e,t=this._audioPool;for(e in t)for(var i=t[e],n=0;n<t[e].length;n++)i[n].getPlaying()&&(i[n].pause(),this._pauseCache.push(i[n]))},_resumePlaying:function(){for(var t=this._pauseCache,e=0;e<t.length;e++)t[e].resume();t.length=0}},!n){var a=function(){var e=cc.audioEngine._currMusic;e&&!1===e._touch&&e._playing&&e.getPlaying()&&(e._touch=!0,e.play(0,e.loop),!t.replay&&cc._canvas.removeEventListener("touchstart",a))};setTimeout(function(){cc._canvas&&cc._canvas.addEventListener("touchstart",a,!1)},150)}cc.eventManager.addCustomListener(cc.game.EVENT_HIDE,function(){cc.audioEngine._pausePlaying()}),cc.eventManager.addCustomListener(cc.game.EVENT_SHOW,function(){cc.audioEngine._resumePlaying()})}(cc.__audioSupport),function(){cc.PhysicsSprite=cc.Sprite.extend({_ignoreBodyRotation:!1,_body:null,_rotation:1,ctor:function(t,e){if(cc.Sprite.prototype.ctor.call(this),void 0===t)cc.PhysicsSprite.prototype.init.call(this);else if(cc.isString(t))if("#"===t[0]){var i=t.substr(1,t.length-1),i=cc.spriteFrameCache.getSpriteFrame(i);this.initWithSpriteFrame(i)}else this.init(t,e);else cc.isObject(t)&&(t instanceof cc.Texture2D?this.initWithTexture(t,e):t instanceof cc.SpriteFrame&&this.initWithSpriteFrame(t));cc.renderer.pushRenderCommand(this._renderCmd)},visit:function(){cc.renderer.pushRenderCommand(this._renderCmd),cc.Sprite.prototype.visit.call(this)},setBody:function(t){this._body=t},getBody:function(){return this._body},getPosition:function(){var t=this._body;return{x:t.p.x,y:t.p.y}},getPositionX:function(){return this._body.p.x},getPositionY:function(){return this._body.p.y},setPosition:function(t,e){void 0===e?(this._body.p.x=t.x,this._body.p.y=t.y):(this._body.p.x=t,this._body.p.y=e)},setPositionX:function(t){this._body.p.x=t},setPositionY:function(t){this._body.p.y=t},_syncPosition:function(){var t=this._position,e=this._body;t.x===e.p.x&&t.y===e.p.y||cc.Sprite.prototype.setPosition.call(this,e.p.x,e.p.y)},getRotation:function(){return this._ignoreBodyRotation?this._rotationX:-cc.radiansToDegrees(this._body.a)},setRotation:function(t){this._ignoreBodyRotation?cc.Sprite.prototype.setRotation.call(this,t):this._body.a=-cc.degreesToRadians(t)},_syncRotation:function(){this._rotationX!==-cc.radiansToDegrees(this._body.a)&&cc.Sprite.prototype.setRotation.call(this,-cc.radiansToDegrees(this._body.a))},getNodeToParentTransform:function(){return this._renderCmd.getNodeToParentTransform()},isDirty:function(){return!this._body.isSleeping()},setDirty:function(){},setIgnoreBodyRotation:function(t){this._ignoreBodyRotation=t},_createRenderCmd:function(){return cc._renderType===cc._RENDER_TYPE_CANVAS?new cc.PhysicsSprite.CanvasRenderCmd(this):new cc.PhysicsSprite.WebGLRenderCmd(this)}}),cc.PhysicsSprite._className="PhysicsSprite";var t=cc.PhysicsSprite.prototype;cc.defineGetterSetter(t,"body",t.getBody,t.setBody),cc.defineGetterSetter(t,"dirty",t.isDirty,t.setDirty),cc.PhysicsSprite.create=function(t,e){return new cc.PhysicsSprite(t,e)},cc.PhysicsSprite.createWithSpriteFrameName=cc.PhysicsSprite.create,cc.PhysicsSprite.createWithSpriteFrame=cc.PhysicsSprite.create}(),cc.__convertVerts=function(t){for(var e=[],i=0;i<t.length/2;i++)e[i]={x:t[2*i],y:t[2*i+1]};return e},cc.ColorForBody=function(t){return t.isRogue()||t.isSleeping()?cc.color(128,128,128,128):t.nodeIdleTime>t.space.sleepTimeThreshold?cc.color(84,84,84,128):cc.color(255,0,0,128)},cc.DrawShape=function(t){var e=t.body,i=cc.ColorForBody(e);switch(t.collisionCode){case cp.CircleShape.prototype.collisionCode:this.drawDot(t.tc,Math.max(t.r,1),i),this.drawSegment(t.tc,cp.v.add(t.tc,cp.v.mult(e.rot,t.r)),1,i);break;case cp.SegmentShape.prototype.collisionCode:this.drawSegment(t.ta,t.tb,Math.max(t.r,2),i);break;case cp.PolyShape.prototype.collisionCode:e=cc.color(i.r,i.g,i.b,cc.lerp(i.a,255,.5)),this.drawPoly(cc.__convertVerts(t.tVerts),i,1,e);break;default:cc.log("cc.DrawShape(): Bad assertion in DrawShape()")}},cc.DrawConstraint=function(t){var e,i=t.a,n=t.b;t instanceof cp.PinJoint?(e=i.local2World(t.anchr1),i=n.local2World(t.anchr2),this.drawDot(e,3,cc.CONSTRAINT_COLOR),this.drawDot(i,3,cc.CONSTRAINT_COLOR),this.drawSegment(e,i,1,cc.CONSTRAINT_COLOR)):t instanceof cp.SlideJoint?(e=i.local2World(t.anchr1),i=n.local2World(t.anchr2),this.drawDot(e,3,cc.CONSTRAINT_COLOR),this.drawDot(i,3,cc.CONSTRAINT_COLOR),this.drawSegment(e,i,1,cc.CONSTRAINT_COLOR)):t instanceof cp.PivotJoint?(e=i.local2World(t.anchr1),i=n.local2World(t.anchr2),this.drawDot(e,3,cc.CONSTRAINT_COLOR),this.drawDot(i,3,cc.CONSTRAINT_COLOR)):t instanceof cp.GrooveJoint&&(e=i.local2World(t.grv_a),i=i.local2World(t.grv_b),n=n.local2World(t.anchr2),this.drawDot(n,3,cc.CONSTRAINT_COLOR),this.drawSegment(e,i,1,cc.CONSTRAINT_COLOR))},cc.CONSTRAINT_COLOR=cc.color(0,255,0,128),cc.PhysicsDebugNode=cc.DrawNode.extend({_space:null,_className:"PhysicsDebugNode",ctor:function(t){cc.DrawNode.prototype.ctor.call(this),this._space=t},getSpace:function(){return this._space},setSpace:function(t){this._space=t},draw:function(){this._space&&(this._space.eachShape(cc.DrawShape.bind(this)),this._space.eachConstraint(cc.DrawConstraint.bind(this)),cc.DrawNode.prototype.draw.call(this),this.clear())},_createRenderCmd:function(){return cc._renderType===cc._RENDER_TYPE_CANVAS?new cc.PhysicsDebugNode.CanvasRenderCmd(this):new cc.PhysicsDebugNode.WebGLRenderCmd(this)}}),cc.PhysicsDebugNode.create=function(t){return new cc.PhysicsDebugNode(t)},function(){cc.PhysicsDebugNode.CanvasRenderCmd=function(t){cc.Node.CanvasRenderCmd.call(this,t),this._buffer=t._buffer,this._needDraw=!0};var t=cc.PhysicsDebugNode.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);t.constructor=cc.PhysicsDebugNode.CanvasRenderCmd,t.rendering=function(t,e,i){var n=this._node;n._space&&(n._space.eachShape(cc.DrawShape.bind(n)),n._space.eachConstraint(cc.DrawConstraint.bind(n)),cc.DrawNode.CanvasRenderCmd.prototype.rendering.call(this,t,e,i),n.clear())},t._drawDot=cc.DrawNode.CanvasRenderCmd.prototype._drawDot,t._drawSegment=cc.DrawNode.CanvasRenderCmd.prototype._drawSegment,t._drawPoly=cc.DrawNode.CanvasRenderCmd.prototype._drawPoly}(),function(){cc.PhysicsDebugNode.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0},cc.PhysicsDebugNode.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype),cc.PhysicsDebugNode.WebGLRenderCmd.prototype.constructor=cc.PhysicsDebugNode.WebGLRenderCmd,cc.PhysicsDebugNode.WebGLRenderCmd.prototype.rendering=function(t){t=this._node,t._space&&(t._space.eachShape(cc.DrawShape.bind(t)),t._space.eachConstraint(cc.DrawConstraint.bind(t)),cc.glBlendFunc(t._blendFunc.src,t._blendFunc.dst),this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix),t._render(),t.clear())}}(),function(){cc.PhysicsSprite.CanvasRenderCmd=function(t){cc.Sprite.CanvasRenderCmd.call(this,t),this._needDraw=!0};var t=cc.PhysicsSprite.CanvasRenderCmd.prototype=Object.create(cc.Sprite.CanvasRenderCmd.prototype);t.constructor=cc.PhysicsSprite.CanvasRenderCmd,t.rendering=function(t,e,i){var n=this._node;n._syncPosition(),n._ignoreBodyRotation||n._syncRotation(),this.transform(this.getParentRenderCmd()),cc.Sprite.CanvasRenderCmd.prototype.rendering.call(this,t,e,i)},t.getNodeToParentTransform=function(){var t=this._node,e=this._transform,i=t._body,n=t._scaleX,r=t._scaleY,o=this._anchorPointInPoints;e.tx=i.p.x,e.ty=i.p.y;var i=-i.a,s=1,c=0;return i&&!t._ignoreBodyRotation&&(s=Math.cos(i),c=Math.sin(i)),e.a=e.d=s,e.b=-c,e.c=c,(1!==n||1!==r)&&(e.a*=n,e.c*=n,e.b*=r,e.d*=r),e.tx+=s*-o.x*n+-c*o.y*r,e.ty-=c*-o.x*n+s*o.y*r,this._ignoreAnchorPointForPosition&&(e.tx+=o.x,e.ty+=o.y),this._transform}}(),function(){cc.PhysicsSprite.WebGLRenderCmd=function(t){cc.Sprite.WebGLRenderCmd.call(this,t),this._needDraw=!0};var t=cc.PhysicsSprite.WebGLRenderCmd.prototype=Object.create(cc.Sprite.WebGLRenderCmd.prototype);t.constructor=cc.PhysicsSprite.WebGLRenderCmd,t.rendering=function(t){var e=this._node;
e._syncPosition(),e._ignoreBodyRotation||e._syncRotation(),this.transform(this.getParentRenderCmd()),cc.Sprite.WebGLRenderCmd.prototype.rendering.call(this,t)},t.getNodeToParentTransform=function(){var t=this._node,e=t._body,i=this._anchorPointInPoints,n=t._scaleX,r=t._scaleY,o=e.p.x,s=e.p.y;this._ignoreAnchorPointForPosition&&(o+=i.x,s+=i.y);var e=e.a,c=1,a=0;return e&&!t._ignoreBodyRotation&&(c=Math.cos(e),a=Math.sin(e)),cc._rectEqualToZero(i)||(o+=c*-i.x*n+-a*-i.y*r,s+=a*-i.x*n+c*-i.y*r),this._transform=cc.affineTransformMake(c*n,a*n,-a*r,c*r,o,s)},t.updateTransform=function(){this._dirty=this._node.isDirty(),cc.Sprite.WebGLRenderCmd.prototype.updateTransform.call(this)}}();var Box2D={};!function(t,e){function i(){}!(Object.defineProperty instanceof Function)&&Object.prototype.__defineGetter__ instanceof Function&&Object.prototype.__defineSetter__ instanceof Function&&(Object.defineProperty=function(t,e,i){i.get instanceof Function&&t.__defineGetter__(e,i.get),i.set instanceof Function&&t.__defineSetter__(e,i.set)}),t.inherit=function(t,e){i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t},t.generateCallback=function(t,e){return function(){e.apply(t,arguments)}},t.NVector=function(t){t===e&&(t=0);for(var i=Array(t||0),n=0;t>n;++n)i[n]=0;return i},t.is=function(t,i){return null===t?!1:i instanceof Function&&t instanceof i||t.constructor.__implements!=e&&t.constructor.__implements[i]?!0:!1},t.parseUInt=function(t){return Math.abs(parseInt(t))}}(Box2D);var Vector=Array,Vector_a2j_Number=Box2D.NVector;"undefined"==typeof Box2D&&(Box2D={}),"undefined"==typeof Box2D.Collision&&(Box2D.Collision={}),"undefined"==typeof Box2D.Collision.Shapes&&(Box2D.Collision.Shapes={}),"undefined"==typeof Box2D.Common&&(Box2D.Common={}),"undefined"==typeof Box2D.Common.Math&&(Box2D.Common.Math={}),"undefined"==typeof Box2D.Dynamics&&(Box2D.Dynamics={}),"undefined"==typeof Box2D.Dynamics.Contacts&&(Box2D.Dynamics.Contacts={}),"undefined"==typeof Box2D.Dynamics.Controllers&&(Box2D.Dynamics.Controllers={}),"undefined"==typeof Box2D.Dynamics.Joints&&(Box2D.Dynamics.Joints={}),function(){function t(){t.b2AABB.apply(this,arguments)}function e(){e.b2Bound.apply(this,arguments)}function i(){i.b2BoundValues.apply(this,arguments),this.constructor===i&&this.b2BoundValues.apply(this,arguments)}function n(){n.b2Collision.apply(this,arguments)}function r(){r.b2ContactID.apply(this,arguments),this.constructor===r&&this.b2ContactID.apply(this,arguments)}function o(){o.b2ContactPoint.apply(this,arguments)}function s(){s.b2Distance.apply(this,arguments)}function c(){c.b2DistanceInput.apply(this,arguments)}function a(){a.b2DistanceOutput.apply(this,arguments)}function l(){l.b2DistanceProxy.apply(this,arguments)}function h(){h.b2DynamicTree.apply(this,arguments),this.constructor===h&&this.b2DynamicTree.apply(this,arguments)}function u(){u.b2DynamicTreeBroadPhase.apply(this,arguments)}function d(){d.b2DynamicTreeNode.apply(this,arguments)}function _(){_.b2DynamicTreePair.apply(this,arguments)}function p(){p.b2Manifold.apply(this,arguments),this.constructor===p&&this.b2Manifold.apply(this,arguments)}function f(){f.b2ManifoldPoint.apply(this,arguments),this.constructor===f&&this.b2ManifoldPoint.apply(this,arguments)}function m(){m.b2Point.apply(this,arguments)}function g(){g.b2RayCastInput.apply(this,arguments),this.constructor===g&&this.b2RayCastInput.apply(this,arguments)}function y(){y.b2RayCastOutput.apply(this,arguments)}function T(){T.b2Segment.apply(this,arguments)}function S(){S.b2SeparationFunction.apply(this,arguments)}function C(){C.b2Simplex.apply(this,arguments),this.constructor===C&&this.b2Simplex.apply(this,arguments)}function v(){v.b2SimplexCache.apply(this,arguments)}function x(){x.b2SimplexVertex.apply(this,arguments)}function E(){E.b2TimeOfImpact.apply(this,arguments)}function b(){b.b2TOIInput.apply(this,arguments)}function A(){A.b2WorldManifold.apply(this,arguments),this.constructor===A&&this.b2WorldManifold.apply(this,arguments)}function R(){R.ClipVertex.apply(this,arguments)}function P(){P.Features.apply(this,arguments)}function I(){I.b2CircleShape.apply(this,arguments),this.constructor===I&&this.b2CircleShape.apply(this,arguments)}function w(){w.b2EdgeChainDef.apply(this,arguments),this.constructor===w&&this.b2EdgeChainDef.apply(this,arguments)}function L(){L.b2EdgeShape.apply(this,arguments),this.constructor===L&&this.b2EdgeShape.apply(this,arguments)}function D(){D.b2MassData.apply(this,arguments)}function O(){O.b2PolygonShape.apply(this,arguments),this.constructor===O&&this.b2PolygonShape.apply(this,arguments)}function N(){N.b2Shape.apply(this,arguments),this.constructor===N&&this.b2Shape.apply(this,arguments)}function B(){B.b2Color.apply(this,arguments),this.constructor===B&&this.b2Color.apply(this,arguments)}function F(){F.b2Settings.apply(this,arguments)}function M(){M.b2Mat22.apply(this,arguments),this.constructor===M&&this.b2Mat22.apply(this,arguments)}function V(){V.b2Mat33.apply(this,arguments),this.constructor===V&&this.b2Mat33.apply(this,arguments)}function k(){k.b2Math.apply(this,arguments)}function W(){W.b2Sweep.apply(this,arguments)}function G(){G.b2Transform.apply(this,arguments),this.constructor===G&&this.b2Transform.apply(this,arguments)}function z(){z.b2Vec2.apply(this,arguments),this.constructor===z&&this.b2Vec2.apply(this,arguments)}function U(){U.b2Vec3.apply(this,arguments),this.constructor===U&&this.b2Vec3.apply(this,arguments)}function Y(){Y.b2Body.apply(this,arguments),this.constructor===Y&&this.b2Body.apply(this,arguments)}function X(){X.b2BodyDef.apply(this,arguments),this.constructor===X&&this.b2BodyDef.apply(this,arguments)}function H(){H.b2ContactFilter.apply(this,arguments)}function j(){j.b2ContactImpulse.apply(this,arguments)}function q(){q.b2ContactListener.apply(this,arguments)}function J(){J.b2ContactManager.apply(this,arguments),this.constructor===J&&this.b2ContactManager.apply(this,arguments)}function Z(){Z.b2DebugDraw.apply(this,arguments),this.constructor===Z&&this.b2DebugDraw.apply(this,arguments)}function Q(){Q.b2DestructionListener.apply(this,arguments)}function K(){K.b2FilterData.apply(this,arguments)}function $(){$.b2Fixture.apply(this,arguments),this.constructor===$&&this.b2Fixture.apply(this,arguments)}function te(){te.b2FixtureDef.apply(this,arguments),this.constructor===te&&this.b2FixtureDef.apply(this,arguments)}function ee(){ee.b2Island.apply(this,arguments),this.constructor===ee&&this.b2Island.apply(this,arguments)}function ie(){ie.b2TimeStep.apply(this,arguments)}function ne(){ne.b2World.apply(this,arguments),this.constructor===ne&&this.b2World.apply(this,arguments)}function re(){re.b2CircleContact.apply(this,arguments)}function oe(){oe.b2Contact.apply(this,arguments),this.constructor===oe&&this.b2Contact.apply(this,arguments)}function se(){se.b2ContactConstraint.apply(this,arguments),this.constructor===se&&this.b2ContactConstraint.apply(this,arguments)}function ce(){ce.b2ContactConstraintPoint.apply(this,arguments)}function ae(){ae.b2ContactEdge.apply(this,arguments)}function le(){le.b2ContactFactory.apply(this,arguments),this.constructor===le&&this.b2ContactFactory.apply(this,arguments)}function he(){he.b2ContactRegister.apply(this,arguments)}function ue(){ue.b2ContactResult.apply(this,arguments)}function de(){de.b2ContactSolver.apply(this,arguments),this.constructor===de&&this.b2ContactSolver.apply(this,arguments)}function _e(){_e.b2EdgeAndCircleContact.apply(this,arguments)}function pe(){pe.b2NullContact.apply(this,arguments),this.constructor===pe&&this.b2NullContact.apply(this,arguments)}function fe(){fe.b2PolyAndCircleContact.apply(this,arguments)}function me(){me.b2PolyAndEdgeContact.apply(this,arguments)}function ge(){ge.b2PolygonContact.apply(this,arguments)}function ye(){ye.b2PositionSolverManifold.apply(this,arguments),this.constructor===ye&&this.b2PositionSolverManifold.apply(this,arguments)}function Te(){Te.b2BuoyancyController.apply(this,arguments)}function Se(){Se.b2ConstantAccelController.apply(this,arguments)}function Ce(){Ce.b2ConstantForceController.apply(this,arguments)}function ve(){ve.b2Controller.apply(this,arguments)}function xe(){xe.b2ControllerEdge.apply(this,arguments)}function Ee(){Ee.b2GravityController.apply(this,arguments)}function be(){be.b2TensorDampingController.apply(this,arguments)}function Ae(){Ae.b2DistanceJoint.apply(this,arguments),this.constructor===Ae&&this.b2DistanceJoint.apply(this,arguments)}function Re(){Re.b2DistanceJointDef.apply(this,arguments),this.constructor===Re&&this.b2DistanceJointDef.apply(this,arguments)}function Pe(){Pe.b2FrictionJoint.apply(this,arguments),this.constructor===Pe&&this.b2FrictionJoint.apply(this,arguments)}function Ie(){Ie.b2FrictionJointDef.apply(this,arguments),this.constructor===Ie&&this.b2FrictionJointDef.apply(this,arguments)}function we(){we.b2GearJoint.apply(this,arguments),this.constructor===we&&this.b2GearJoint.apply(this,arguments)}function Le(){Le.b2GearJointDef.apply(this,arguments),this.constructor===Le&&this.b2GearJointDef.apply(this,arguments)}function De(){De.b2Jacobian.apply(this,arguments)}function Oe(){Oe.b2Joint.apply(this,arguments),this.constructor===Oe&&this.b2Joint.apply(this,arguments)}function Ne(){Ne.b2JointDef.apply(this,arguments),this.constructor===Ne&&this.b2JointDef.apply(this,arguments)}function Be(){Be.b2JointEdge.apply(this,arguments)}function Fe(){Fe.b2LineJoint.apply(this,arguments),this.constructor===Fe&&this.b2LineJoint.apply(this,arguments)}function Me(){Me.b2LineJointDef.apply(this,arguments),this.constructor===Me&&this.b2LineJointDef.apply(this,arguments)}function Ve(){Ve.b2MouseJoint.apply(this,arguments),this.constructor===Ve&&this.b2MouseJoint.apply(this,arguments)}function ke(){ke.b2MouseJointDef.apply(this,arguments),this.constructor===ke&&this.b2MouseJointDef.apply(this,arguments)}function We(){We.b2PrismaticJoint.apply(this,arguments),this.constructor===We&&this.b2PrismaticJoint.apply(this,arguments)}function Ge(){Ge.b2PrismaticJointDef.apply(this,arguments),this.constructor===Ge&&this.b2PrismaticJointDef.apply(this,arguments)}function ze(){ze.b2PulleyJoint.apply(this,arguments),this.constructor===ze&&this.b2PulleyJoint.apply(this,arguments)}function Ue(){Ue.b2PulleyJointDef.apply(this,arguments),this.constructor===Ue&&this.b2PulleyJointDef.apply(this,arguments)}function Ye(){Ye.b2RevoluteJoint.apply(this,arguments),this.constructor===Ye&&this.b2RevoluteJoint.apply(this,arguments)}function Xe(){Xe.b2RevoluteJointDef.apply(this,arguments),this.constructor===Xe&&this.b2RevoluteJointDef.apply(this,arguments)}function He(){He.b2WeldJoint.apply(this,arguments),this.constructor===He&&this.b2WeldJoint.apply(this,arguments)}function je(){je.b2WeldJointDef.apply(this,arguments),this.constructor===je&&this.b2WeldJointDef.apply(this,arguments)}Box2D.Collision.IBroadPhase="Box2D.Collision.IBroadPhase",Box2D.Collision.b2AABB=t,Box2D.Collision.b2Bound=e,Box2D.Collision.b2BoundValues=i,Box2D.Collision.b2Collision=n,Box2D.Collision.b2ContactID=r,Box2D.Collision.b2ContactPoint=o,Box2D.Collision.b2Distance=s,Box2D.Collision.b2DistanceInput=c,Box2D.Collision.b2DistanceOutput=a,Box2D.Collision.b2DistanceProxy=l,Box2D.Collision.b2DynamicTree=h,Box2D.Collision.b2DynamicTreeBroadPhase=u,Box2D.Collision.b2DynamicTreeNode=d,Box2D.Collision.b2DynamicTreePair=_,Box2D.Collision.b2Manifold=p,Box2D.Collision.b2ManifoldPoint=f,Box2D.Collision.b2Point=m,Box2D.Collision.b2RayCastInput=g,Box2D.Collision.b2RayCastOutput=y,Box2D.Collision.b2Segment=T,Box2D.Collision.b2SeparationFunction=S,Box2D.Collision.b2Simplex=C,Box2D.Collision.b2SimplexCache=v,Box2D.Collision.b2SimplexVertex=x,Box2D.Collision.b2TimeOfImpact=E,Box2D.Collision.b2TOIInput=b,Box2D.Collision.b2WorldManifold=A,Box2D.Collision.ClipVertex=R,Box2D.Collision.Features=P,Box2D.Collision.Shapes.b2CircleShape=I,Box2D.Collision.Shapes.b2EdgeChainDef=w,Box2D.Collision.Shapes.b2EdgeShape=L,Box2D.Collision.Shapes.b2MassData=D,Box2D.Collision.Shapes.b2PolygonShape=O,Box2D.Collision.Shapes.b2Shape=N,Box2D.Common.b2internal="Box2D.Common.b2internal",Box2D.Common.b2Color=B,Box2D.Common.b2Settings=F,Box2D.Common.Math.b2Mat22=M,Box2D.Common.Math.b2Mat33=V,Box2D.Common.Math.b2Math=k,Box2D.Common.Math.b2Sweep=W,Box2D.Common.Math.b2Transform=G,Box2D.Common.Math.b2Vec2=z,Box2D.Common.Math.b2Vec3=U,Box2D.Dynamics.b2Body=Y,Box2D.Dynamics.b2BodyDef=X,Box2D.Dynamics.b2ContactFilter=H,Box2D.Dynamics.b2ContactImpulse=j,Box2D.Dynamics.b2ContactListener=q,Box2D.Dynamics.b2ContactManager=J,Box2D.Dynamics.b2DebugDraw=Z,Box2D.Dynamics.b2DestructionListener=Q,Box2D.Dynamics.b2FilterData=K,Box2D.Dynamics.b2Fixture=$,Box2D.Dynamics.b2FixtureDef=te,Box2D.Dynamics.b2Island=ee,Box2D.Dynamics.b2TimeStep=ie,Box2D.Dynamics.b2World=ne,Box2D.Dynamics.Contacts.b2CircleContact=re,Box2D.Dynamics.Contacts.b2Contact=oe,Box2D.Dynamics.Contacts.b2ContactConstraint=se,Box2D.Dynamics.Contacts.b2ContactConstraintPoint=ce,Box2D.Dynamics.Contacts.b2ContactEdge=ae,Box2D.Dynamics.Contacts.b2ContactFactory=le,Box2D.Dynamics.Contacts.b2ContactRegister=he,Box2D.Dynamics.Contacts.b2ContactResult=ue,Box2D.Dynamics.Contacts.b2ContactSolver=de,Box2D.Dynamics.Contacts.b2EdgeAndCircleContact=_e,Box2D.Dynamics.Contacts.b2NullContact=pe,Box2D.Dynamics.Contacts.b2PolyAndCircleContact=fe,Box2D.Dynamics.Contacts.b2PolyAndEdgeContact=me,Box2D.Dynamics.Contacts.b2PolygonContact=ge,Box2D.Dynamics.Contacts.b2PositionSolverManifold=ye,Box2D.Dynamics.Controllers.b2BuoyancyController=Te,Box2D.Dynamics.Controllers.b2ConstantAccelController=Se,Box2D.Dynamics.Controllers.b2ConstantForceController=Ce,Box2D.Dynamics.Controllers.b2Controller=ve,Box2D.Dynamics.Controllers.b2ControllerEdge=xe,Box2D.Dynamics.Controllers.b2GravityController=Ee,Box2D.Dynamics.Controllers.b2TensorDampingController=be,Box2D.Dynamics.Joints.b2DistanceJoint=Ae,Box2D.Dynamics.Joints.b2DistanceJointDef=Re,Box2D.Dynamics.Joints.b2FrictionJoint=Pe,Box2D.Dynamics.Joints.b2FrictionJointDef=Ie,Box2D.Dynamics.Joints.b2GearJoint=we,Box2D.Dynamics.Joints.b2GearJointDef=Le,Box2D.Dynamics.Joints.b2Jacobian=De,Box2D.Dynamics.Joints.b2Joint=Oe,Box2D.Dynamics.Joints.b2JointDef=Ne,Box2D.Dynamics.Joints.b2JointEdge=Be,Box2D.Dynamics.Joints.b2LineJoint=Fe,Box2D.Dynamics.Joints.b2LineJointDef=Me,Box2D.Dynamics.Joints.b2MouseJoint=Ve,Box2D.Dynamics.Joints.b2MouseJointDef=ke,Box2D.Dynamics.Joints.b2PrismaticJoint=We,Box2D.Dynamics.Joints.b2PrismaticJointDef=Ge,Box2D.Dynamics.Joints.b2PulleyJoint=ze,Box2D.Dynamics.Joints.b2PulleyJointDef=Ue,Box2D.Dynamics.Joints.b2RevoluteJoint=Ye,Box2D.Dynamics.Joints.b2RevoluteJointDef=Xe,Box2D.Dynamics.Joints.b2WeldJoint=He,Box2D.Dynamics.Joints.b2WeldJointDef=je}(),Box2D.postDefs=[],function(){var t=Box2D.Collision.Shapes.b2CircleShape,e=Box2D.Collision.Shapes.b2PolygonShape,i=Box2D.Collision.Shapes.b2Shape,n=Box2D.Common.b2Settings,r=Box2D.Common.Math.b2Math,o=Box2D.Common.Math.b2Sweep,s=Box2D.Common.Math.b2Transform,c=Box2D.Common.Math.b2Vec2,a=Box2D.Collision.b2AABB,l=Box2D.Collision.b2Bound,h=Box2D.Collision.b2BoundValues,u=Box2D.Collision.b2Collision,d=Box2D.Collision.b2ContactID,_=Box2D.Collision.b2ContactPoint,p=Box2D.Collision.b2Distance,f=Box2D.Collision.b2DistanceInput,m=Box2D.Collision.b2DistanceOutput,g=Box2D.Collision.b2DistanceProxy,y=Box2D.Collision.b2DynamicTree,T=Box2D.Collision.b2DynamicTreeBroadPhase,S=Box2D.Collision.b2DynamicTreeNode,C=Box2D.Collision.b2DynamicTreePair,v=Box2D.Collision.b2Manifold,x=Box2D.Collision.b2ManifoldPoint,E=Box2D.Collision.b2Point,b=Box2D.Collision.b2RayCastInput,A=Box2D.Collision.b2RayCastOutput,R=Box2D.Collision.b2Segment,P=Box2D.Collision.b2SeparationFunction,I=Box2D.Collision.b2Simplex,w=Box2D.Collision.b2SimplexCache,L=Box2D.Collision.b2SimplexVertex,D=Box2D.Collision.b2TimeOfImpact,O=Box2D.Collision.b2TOIInput,N=Box2D.Collision.b2WorldManifold,B=Box2D.Collision.ClipVertex,F=Box2D.Collision.Features,M=Box2D.Collision.IBroadPhase;a.b2AABB=function(){this.lowerBound=new c,this.upperBound=new c},a.prototype.IsValid=function(){var t=this.upperBound.y-this.lowerBound.y;return t=(t=0<=this.upperBound.x-this.lowerBound.x&&t>=0)&&this.lowerBound.IsValid()&&this.upperBound.IsValid()},a.prototype.GetCenter=function(){return new c((this.lowerBound.x+this.upperBound.x)/2,(this.lowerBound.y+this.upperBound.y)/2)},a.prototype.GetExtents=function(){return new c((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2)},a.prototype.Contains=function(t){var e;return e=(e=(e=(e=this.lowerBound.x<=t.lowerBound.x)&&this.lowerBound.y<=t.lowerBound.y)&&t.upperBound.x<=this.upperBound.x)&&t.upperBound.y<=this.upperBound.y},a.prototype.RayCast=function(t,e){var i=-Number.MAX_VALUE,n=Number.MAX_VALUE,r=e.p1.x,o=e.p1.y,s=e.p2.x-e.p1.x,c=e.p2.y-e.p1.y,a=Math.abs(s),l=Math.abs(c),h=t.normal,u=0,d=0,_=u=0,_=0;if(a<Number.MIN_VALUE){if(r<this.lowerBound.x||this.upperBound.x<r)return!1}else if(u=1/s,d=(this.lowerBound.x-r)*u,u*=this.upperBound.x-r,_=-1,d>u&&(_=d,d=u,u=_,_=1),d>i&&(h.x=_,h.y=0,i=d),n=Math.min(n,u),i>n)return!1;if(l<Number.MIN_VALUE){if(o<this.lowerBound.y||this.upperBound.y<o)return!1}else if(u=1/c,d=(this.lowerBound.y-o)*u,u*=this.upperBound.y-o,_=-1,d>u&&(_=d,d=u,u=_,_=1),d>i&&(h.y=_,h.x=0,i=d),n=Math.min(n,u),i>n)return!1;return t.fraction=i,!0},a.prototype.TestOverlap=function(t){var e=t.lowerBound.y-this.upperBound.y,i=this.lowerBound.y-t.upperBound.y;return 0<t.lowerBound.x-this.upperBound.x||e>0||0<this.lowerBound.x-t.upperBound.x||i>0?!1:!0},a.Combine=function(t,e){var i=new a;return i.Combine(t,e),i},a.prototype.Combine=function(t,e){this.lowerBound.x=Math.min(t.lowerBound.x,e.lowerBound.x),this.lowerBound.y=Math.min(t.lowerBound.y,e.lowerBound.y),this.upperBound.x=Math.max(t.upperBound.x,e.upperBound.x),this.upperBound.y=Math.max(t.upperBound.y,e.upperBound.y)},l.b2Bound=function(){},l.prototype.IsLower=function(){return 0==(1&this.value)},l.prototype.IsUpper=function(){return 1==(1&this.value)},l.prototype.Swap=function(t){var e=this.value,i=this.proxy,n=this.stabbingCount;this.value=t.value,this.proxy=t.proxy,this.stabbingCount=t.stabbingCount,t.value=e,t.proxy=i,t.stabbingCount=n},h.b2BoundValues=function(){},h.prototype.b2BoundValues=function(){this.lowerValues=new Vector_a2j_Number,this.lowerValues[0]=0,this.lowerValues[1]=0,this.upperValues=new Vector_a2j_Number,this.upperValues[0]=0,this.upperValues[1]=0},u.b2Collision=function(){},u.ClipSegmentToLine=function(t,e,i,n){void 0===n&&(n=0);var r,o=0;r=e[0];var s=r.v;r=e[1];var c=r.v,a=i.x*s.x+i.y*s.y-n;return r=i.x*c.x+i.y*c.y-n,0>=a&&t[o++].Set(e[0]),0>=r&&t[o++].Set(e[1]),0>a*r&&(i=a/(a-r),r=t[o],r=r.v,r.x=s.x+i*(c.x-s.x),r.y=s.y+i*(c.y-s.y),r=t[o],r.id=(a>0?e[0]:e[1]).id,++o),o},u.EdgeSeparation=function(t,e,i,n,r){void 0===i&&(i=0),parseInt(t.m_vertexCount);var o=t.m_vertices;t=t.m_normals;var s,c,a=parseInt(n.m_vertexCount),l=n.m_vertices;s=e.R,c=t[i],t=s.col1.x*c.x+s.col2.x*c.y,n=s.col1.y*c.x+s.col2.y*c.y,s=r.R;var h=s.col1.x*t+s.col1.y*n;s=s.col2.x*t+s.col2.y*n;for(var u=0,d=Number.MAX_VALUE,_=0;a>_;++_)c=l[_],c=c.x*h+c.y*s,d>c&&(d=c,u=_);return c=o[i],s=e.R,i=e.position.x+(s.col1.x*c.x+s.col2.x*c.y),e=e.position.y+(s.col1.y*c.x+s.col2.y*c.y),c=l[u],s=r.R,o=r.position.x+(s.col1.x*c.x+s.col2.x*c.y),r=r.position.y+(s.col1.y*c.x+s.col2.y*c.y),(o-i)*t+(r-e)*n},u.FindMaxSeparation=function(t,e,i,n,r){var o,s,c=parseInt(e.m_vertexCount),a=e.m_normals;s=r.R,o=n.m_centroid;var l=r.position.x+(s.col1.x*o.x+s.col2.x*o.y),h=r.position.y+(s.col1.y*o.x+s.col2.y*o.y);s=i.R,o=e.m_centroid,l-=i.position.x+(s.col1.x*o.x+s.col2.x*o.y),h-=i.position.y+(s.col1.y*o.x+s.col2.y*o.y),s=l*i.R.col1.x+h*i.R.col1.y;for(var h=l*i.R.col2.x+h*i.R.col2.y,l=0,d=-Number.MAX_VALUE,_=0;c>_;++_)o=a[_],o=o.x*s+o.y*h,o>d&&(d=o,l=_);a=u.EdgeSeparation(e,i,l,n,r),o=parseInt(l-1>=0?l-1:c-1),s=u.EdgeSeparation(e,i,o,n,r);var h=parseInt(c>l+1?l+1:0),d=u.EdgeSeparation(e,i,h,n,r),p=_=0,f=0;if(s>a&&s>d)f=-1,_=o,p=s;else{if(!(d>a))return t[0]=l,a;f=1,_=h,p=d}for(;l=-1==f?_-1>=0?_-1:c-1:c>_+1?_+1:0,a=u.EdgeSeparation(e,i,l,n,r),a>p;)_=l,p=a;return t[0]=_,p},u.FindIncidentEdge=function(t,e,i,n,r,o){void 0===n&&(n=0),parseInt(e.m_vertexCount);var s=e.m_normals,c=parseInt(r.m_vertexCount);e=r.m_vertices,r=r.m_normals;var a;a=i.R,i=s[n];var s=a.col1.x*i.x+a.col2.x*i.y,l=a.col1.y*i.x+a.col2.y*i.y;a=o.R,i=a.col1.x*s+a.col1.y*l,l=a.col2.x*s+a.col2.y*l,s=i,a=0;for(var h=Number.MAX_VALUE,u=0;c>u;++u)i=r[u],i=s*i.x+l*i.y,h>i&&(h=i,a=u);r=parseInt(a),s=parseInt(c>r+1?r+1:0),c=t[0],i=e[r],a=o.R,c.v.x=o.position.x+(a.col1.x*i.x+a.col2.x*i.y),c.v.y=o.position.y+(a.col1.y*i.x+a.col2.y*i.y),c.id.features.referenceEdge=n,c.id.features.incidentEdge=r,c.id.features.incidentVertex=0,c=t[1],i=e[s],a=o.R,c.v.x=o.position.x+(a.col1.x*i.x+a.col2.x*i.y),c.v.y=o.position.y+(a.col1.y*i.x+a.col2.y*i.y),c.id.features.referenceEdge=n,c.id.features.incidentEdge=s,c.id.features.incidentVertex=1},u.MakeClipPointVector=function(){var t=new Vector(2);return t[0]=new B,t[1]=new B,t},u.CollidePolygons=function(t,e,i,r,o){var s;t.m_pointCount=0;var c=e.m_radius+r.m_radius;u.s_edgeAO[0]=0;var a=u.FindMaxSeparation(u.s_edgeAO,e,i,r,o);if(s=u.s_edgeAO[0],!(a>c)){var l;u.s_edgeBO[0]=0;var h=u.FindMaxSeparation(u.s_edgeBO,r,o,e,i);if(l=u.s_edgeBO[0],!(h>c)){var d=0,_=0;h>.98*a+.001?(a=r,r=e,e=o,d=l,t.m_type=v.e_faceB,_=1):(a=e,e=i,i=o,d=s,t.m_type=v.e_faceA,_=0),s=u.s_incidentEdge,u.FindIncidentEdge(s,a,e,d,r,i),l=parseInt(a.m_vertexCount),o=a.m_vertices;var p,a=o[d];p=l>d+1?o[parseInt(d+1)]:o[0],d=u.s_localTangent,d.Set(p.x-a.x,p.y-a.y),d.Normalize(),o=u.s_localNormal,o.x=d.y,o.y=-d.x,r=u.s_planePoint,r.Set(.5*(a.x+p.x),.5*(a.y+p.y)),h=u.s_tangent,l=e.R,h.x=l.col1.x*d.x+l.col2.x*d.y,h.y=l.col1.y*d.x+l.col2.y*d.y;var f=u.s_tangent2;f.x=-h.x,f.y=-h.y,d=u.s_normal,d.x=h.y,d.y=-h.x;var m=u.s_v11,g=u.s_v12;if(m.x=e.position.x+(l.col1.x*a.x+l.col2.x*a.y),m.y=e.position.y+(l.col1.y*a.x+l.col2.y*a.y),g.x=e.position.x+(l.col1.x*p.x+l.col2.x*p.y),g.y=e.position.y+(l.col1.y*p.x+l.col2.y*p.y),e=d.x*m.x+d.y*m.y,l=h.x*g.x+h.y*g.y+c,p=u.s_clipPoints1,a=u.s_clipPoints2,g=0,g=u.ClipSegmentToLine(p,s,f,-h.x*m.x-h.y*m.y+c),!(2>g||(g=u.ClipSegmentToLine(a,p,h,l),2>g))){for(t.m_localPlaneNormal.SetV(o),t.m_localPoint.SetV(r),r=o=0;r<n.b2_maxManifoldPoints;++r)s=a[r],d.x*s.v.x+d.y*s.v.y-e<=c&&(h=t.m_points[o],l=i.R,f=s.v.x-i.position.x,m=s.v.y-i.position.y,h.m_localPoint.x=f*l.col1.x+m*l.col1.y,h.m_localPoint.y=f*l.col2.x+m*l.col2.y,h.m_id.Set(s.id),h.m_id.features.flip=_,++o);t.m_pointCount=o}}}},u.CollideCircles=function(t,e,i,n,r){t.m_pointCount=0;var o,s;o=i.R,s=e.m_p;var c=i.position.x+(o.col1.x*s.x+o.col2.x*s.y);i=i.position.y+(o.col1.y*s.x+o.col2.y*s.y),o=r.R,s=n.m_p,c=r.position.x+(o.col1.x*s.x+o.col2.x*s.y)-c,r=r.position.y+(o.col1.y*s.x+o.col2.y*s.y)-i,o=e.m_radius+n.m_radius,c*c+r*r>o*o||(t.m_type=v.e_circles,t.m_localPoint.SetV(e.m_p),t.m_localPlaneNormal.SetZero(),t.m_pointCount=1,t.m_points[0].m_localPoint.SetV(n.m_p),t.m_points[0].m_id.key=0)},u.CollidePolygonAndCircle=function(t,e,i,n,r){var o,s,c=t.m_pointCount=0,a=0;s=r.R,o=n.m_p;var l=r.position.y+(s.col1.y*o.x+s.col2.y*o.y),c=r.position.x+(s.col1.x*o.x+s.col2.x*o.y)-i.position.x,a=l-i.position.y;s=i.R,i=c*s.col1.x+a*s.col1.y,s=c*s.col2.x+a*s.col2.y;var h=0,l=-Number.MAX_VALUE;r=e.m_radius+n.m_radius;var u=parseInt(e.m_vertexCount),d=e.m_vertices;e=e.m_normals;for(var _=0;u>_;++_){if(o=d[_],c=i-o.x,a=s-o.y,o=e[_],c=o.x*c+o.y*a,c>r)return;c>l&&(l=c,h=_)}c=parseInt(h),a=parseInt(u>c+1?c+1:0),o=d[c],d=d[a],l<Number.MIN_VALUE?(t.m_pointCount=1,t.m_type=v.e_faceA,t.m_localPlaneNormal.SetV(e[h]),t.m_localPoint.x=.5*(o.x+d.x),t.m_localPoint.y=.5*(o.y+d.y),t.m_points[0].m_localPoint.SetV(n.m_p),t.m_points[0].m_id.key=0):(l=(i-d.x)*(o.x-d.x)+(s-d.y)*(o.y-d.y),0>=(i-o.x)*(d.x-o.x)+(s-o.y)*(d.y-o.y)?(i-o.x)*(i-o.x)+(s-o.y)*(s-o.y)>r*r||(t.m_pointCount=1,t.m_type=v.e_faceA,t.m_localPlaneNormal.x=i-o.x,t.m_localPlaneNormal.y=s-o.y,t.m_localPlaneNormal.Normalize(),t.m_localPoint.SetV(o),t.m_points[0].m_localPoint.SetV(n.m_p),t.m_points[0].m_id.key=0):0>=l?(i-d.x)*(i-d.x)+(s-d.y)*(s-d.y)>r*r||(t.m_pointCount=1,t.m_type=v.e_faceA,t.m_localPlaneNormal.x=i-d.x,t.m_localPlaneNormal.y=s-d.y,t.m_localPlaneNormal.Normalize(),t.m_localPoint.SetV(d),t.m_points[0].m_localPoint.SetV(n.m_p),t.m_points[0].m_id.key=0):(h=.5*(o.x+d.x),o=.5*(o.y+d.y),l=(i-h)*e[c].x+(s-o)*e[c].y,l>r||(t.m_pointCount=1,t.m_type=v.e_faceA,t.m_localPlaneNormal.x=e[c].x,t.m_localPlaneNormal.y=e[c].y,t.m_localPlaneNormal.Normalize(),t.m_localPoint.Set(h,o),t.m_points[0].m_localPoint.SetV(n.m_p),t.m_points[0].m_id.key=0)))},u.TestOverlap=function(t,e){var i=e.lowerBound,n=t.upperBound,r=i.x-n.x,o=i.y-n.y,i=t.lowerBound,n=e.upperBound,s=i.y-n.y;return r>0||o>0||0<i.x-n.x||s>0?!1:!0},Box2D.postDefs.push(function(){Box2D.Collision.b2Collision.s_incidentEdge=u.MakeClipPointVector(),Box2D.Collision.b2Collision.s_clipPoints1=u.MakeClipPointVector(),Box2D.Collision.b2Collision.s_clipPoints2=u.MakeClipPointVector(),Box2D.Collision.b2Collision.s_edgeAO=new Vector_a2j_Number(1),Box2D.Collision.b2Collision.s_edgeBO=new Vector_a2j_Number(1),Box2D.Collision.b2Collision.s_localTangent=new c,Box2D.Collision.b2Collision.s_localNormal=new c,Box2D.Collision.b2Collision.s_planePoint=new c,Box2D.Collision.b2Collision.s_normal=new c,Box2D.Collision.b2Collision.s_tangent=new c,Box2D.Collision.b2Collision.s_tangent2=new c,Box2D.Collision.b2Collision.s_v11=new c,Box2D.Collision.b2Collision.s_v12=new c,Box2D.Collision.b2Collision.b2CollidePolyTempVec=new c,Box2D.Collision.b2Collision.b2_nullFeature=255}),d.b2ContactID=function(){this.features=new F},d.prototype.b2ContactID=function(){this.features._m_id=this},d.prototype.Set=function(t){this.key=t._key},d.prototype.Copy=function(){var t=new d;return t.key=this.key,t},Object.defineProperty(d.prototype,"key",{enumerable:!1,configurable:!0,get:function(){return this._key}}),Object.defineProperty(d.prototype,"key",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0),this._key=t,this.features._referenceEdge=255&this._key,this.features._incidentEdge=(65280&this._key)>>8&255,this.features._incidentVertex=(16711680&this._key)>>16&255,this.features._flip=(4278190080&this._key)>>24&255}}),_.b2ContactPoint=function(){this.position=new c,this.velocity=new c,this.normal=new c,this.id=new d},p.b2Distance=function(){},p.Distance=function(t,e,i){++p.b2_gjkCalls;var o=i.proxyA,s=i.proxyB,a=i.transformA,l=i.transformB,h=p.s_simplex;h.ReadCache(e,o,a,s,l);var u=h.m_vertices,d=p.s_saveA,_=p.s_saveB,f=0;h.GetClosestPoint().LengthSquared();for(var m,g=0,y=0;20>y;){for(f=h.m_count,g=0;f>g;g++)d[g]=u[g].indexA,_[g]=u[g].indexB;switch(h.m_count){case 1:break;case 2:h.Solve2();break;case 3:h.Solve3();break;default:n.b2Assert(!1)}if(3==h.m_count)break;if(m=h.GetClosestPoint(),m.LengthSquared(),g=h.GetSearchDirection(),g.LengthSquared()<Number.MIN_VALUE*Number.MIN_VALUE)break;m=u[h.m_count],m.indexA=o.GetSupport(r.MulTMV(a.R,g.GetNegative())),m.wA=r.MulX(a,o.GetVertex(m.indexA)),m.indexB=s.GetSupport(r.MulTMV(l.R,g)),m.wB=r.MulX(l,s.GetVertex(m.indexB)),m.w=r.SubtractVV(m.wB,m.wA),++y,++p.b2_gjkIters;for(var T=!1,g=0;f>g;g++)if(m.indexA==d[g]&&m.indexB==_[g]){T=!0;break}if(T)break;++h.m_count}p.b2_gjkMaxIters=r.Max(p.b2_gjkMaxIters,y),h.GetWitnessPoints(t.pointA,t.pointB),t.distance=r.SubtractVV(t.pointA,t.pointB).Length(),t.iterations=y,h.WriteCache(e),i.useRadii&&(e=o.m_radius,s=s.m_radius,t.distance>e+s&&t.distance>Number.MIN_VALUE?(t.distance-=e+s,i=r.SubtractVV(t.pointB,t.pointA),i.Normalize(),t.pointA.x+=e*i.x,t.pointA.y+=e*i.y,t.pointB.x-=s*i.x,t.pointB.y-=s*i.y):(m=new c,m.x=.5*(t.pointA.x+t.pointB.x),m.y=.5*(t.pointA.y+t.pointB.y),t.pointA.x=t.pointB.x=m.x,t.pointA.y=t.pointB.y=m.y,t.distance=0))},Box2D.postDefs.push(function(){Box2D.Collision.b2Distance.s_simplex=new I,Box2D.Collision.b2Distance.s_saveA=new Vector_a2j_Number(3),Box2D.Collision.b2Distance.s_saveB=new Vector_a2j_Number(3)}),f.b2DistanceInput=function(){},m.b2DistanceOutput=function(){this.pointA=new c,this.pointB=new c},g.b2DistanceProxy=function(){},g.prototype.Set=function(r){switch(r.GetType()){case i.e_circleShape:r=r instanceof t?r:null,this.m_vertices=new Vector(1,!0),this.m_vertices[0]=r.m_p,this.m_count=1,this.m_radius=r.m_radius;break;case i.e_polygonShape:r=r instanceof e?r:null,this.m_vertices=r.m_vertices,this.m_count=r.m_vertexCount,this.m_radius=r.m_radius;break;default:n.b2Assert(!1)}},g.prototype.GetSupport=function(t){for(var e=0,i=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y,n=1;n<this.m_count;++n){var r=this.m_vertices[n].x*t.x+this.m_vertices[n].y*t.y;r>i&&(e=n,i=r)}return e},g.prototype.GetSupportVertex=function(t){for(var e=0,i=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y,n=1;n<this.m_count;++n){var r=this.m_vertices[n].x*t.x+this.m_vertices[n].y*t.y;r>i&&(e=n,i=r)}return this.m_vertices[e]},g.prototype.GetVertexCount=function(){return this.m_count},g.prototype.GetVertex=function(t){return void 0===t&&(t=0),n.b2Assert(t>=0&&t<this.m_count),this.m_vertices[t]},y.b2DynamicTree=function(){},y.prototype.b2DynamicTree=function(){this.m_freeList=this.m_root=null,this.m_insertionCount=this.m_path=0},y.prototype.CreateProxy=function(t,e){var i=this.AllocateNode(),r=n.b2_aabbExtension,o=n.b2_aabbExtension;return i.aabb.lowerBound.x=t.lowerBound.x-r,i.aabb.lowerBound.y=t.lowerBound.y-o,i.aabb.upperBound.x=t.upperBound.x+r,i.aabb.upperBound.y=t.upperBound.y+o,i.userData=e,this.InsertLeaf(i),i},y.prototype.DestroyProxy=function(t){this.RemoveLeaf(t),this.FreeNode(t)},y.prototype.MoveProxy=function(t,e,i){if(n.b2Assert(t.IsLeaf()),t.aabb.Contains(e))return!1;this.RemoveLeaf(t);var r=n.b2_aabbExtension+n.b2_aabbMultiplier*(0<i.x?i.x:-i.x);return i=n.b2_aabbExtension+n.b2_aabbMultiplier*(0<i.y?i.y:-i.y),t.aabb.lowerBound.x=e.lowerBound.x-r,t.aabb.lowerBound.y=e.lowerBound.y-i,t.aabb.upperBound.x=e.upperBound.x+r,t.aabb.upperBound.y=e.upperBound.y+i,this.InsertLeaf(t),!0},y.prototype.Rebalance=function(t){if(void 0===t&&(t=0),null!=this.m_root)for(var e=0;t>e;e++){for(var i=this.m_root,n=0;0==i.IsLeaf();)i=this.m_path>>n&1?i.child2:i.child1,n=n+1&31;++this.m_path,this.RemoveLeaf(i),this.InsertLeaf(i)}},y.prototype.GetFatAABB=function(t){return t.aabb},y.prototype.GetUserData=function(t){return t.userData},y.prototype.Query=function(t,e){if(null!=this.m_root){var i=new Vector,n=0;for(i[n++]=this.m_root;n>0;){var r=i[--n];if(r.aabb.TestOverlap(e))if(r.IsLeaf()){if(!t(r))break}else i[n++]=r.child1,i[n++]=r.child2}}},y.prototype.RayCast=function(t,e){if(null!=this.m_root){var i=e.p1,n=e.p2,o=r.SubtractVV(i,n);o.Normalize();var o=r.CrossFV(1,o),s=r.AbsV(o),c=e.maxFraction,l=new a,h=0,u=0,h=i.x+c*(n.x-i.x),u=i.y+c*(n.y-i.y);l.lowerBound.x=Math.min(i.x,h),l.lowerBound.y=Math.min(i.y,u),l.upperBound.x=Math.max(i.x,h),l.upperBound.y=Math.max(i.y,u);var d=new Vector,_=0;for(d[_++]=this.m_root;_>0;)if(c=d[--_],0!=c.aabb.TestOverlap(l)&&(h=c.aabb.GetCenter(),u=c.aabb.GetExtents(),!(0<Math.abs(o.x*(i.x-h.x)+o.y*(i.y-h.y))-s.x*u.x-s.y*u.y)))if(c.IsLeaf()){if(h=new b,h.p1=e.p1,h.p2=e.p2,h.maxFraction=e.maxFraction,c=t(h,c),0==c)break;c>0&&(h=i.x+c*(n.x-i.x),u=i.y+c*(n.y-i.y),l.lowerBound.x=Math.min(i.x,h),l.lowerBound.y=Math.min(i.y,u),l.upperBound.x=Math.max(i.x,h),l.upperBound.y=Math.max(i.y,u))}else d[_++]=c.child1,d[_++]=c.child2}},y.prototype.AllocateNode=function(){if(this.m_freeList){var t=this.m_freeList;return this.m_freeList=t.parent,t.parent=null,t.child1=null,t.child2=null,t}return new S},y.prototype.FreeNode=function(t){t.parent=this.m_freeList,this.m_freeList=t},y.prototype.InsertLeaf=function(t){if(++this.m_insertionCount,null==this.m_root)this.m_root=t,this.m_root.parent=null;else{var e=t.aabb.GetCenter(),i=this.m_root;if(0==i.IsLeaf())do var n=i.child1,i=i.child2,r=Math.abs((n.aabb.lowerBound.x+n.aabb.upperBound.x)/2-e.x)+Math.abs((n.aabb.lowerBound.y+n.aabb.upperBound.y)/2-e.y),o=Math.abs((i.aabb.lowerBound.x+i.aabb.upperBound.x)/2-e.x)+Math.abs((i.aabb.lowerBound.y+i.aabb.upperBound.y)/2-e.y),i=o>r?n:i;while(0==i.IsLeaf());if(e=i.parent,n=this.AllocateNode(),n.parent=e,n.userData=null,n.aabb.Combine(t.aabb,i.aabb),e){i.parent.child1==i?e.child1=n:e.child2=n,n.child1=i,n.child2=t,i.parent=n,t.parent=n;
do{if(e.aabb.Contains(n.aabb))break;e.aabb.Combine(e.child1.aabb,e.child2.aabb),n=e,e=e.parent}while(e)}else n.child1=i,n.child2=t,i.parent=n,this.m_root=t.parent=n}},y.prototype.RemoveLeaf=function(t){if(t==this.m_root)this.m_root=null;else{var e=t.parent,i=e.parent;if(t=e.child1==t?e.child2:e.child1,i)for(i.child1==e?i.child1=t:i.child2=t,t.parent=i,this.FreeNode(e);i&&(e=i.aabb,i.aabb=a.Combine(i.child1.aabb,i.child2.aabb),!e.Contains(i.aabb));)i=i.parent;else this.m_root=t,t.parent=null,this.FreeNode(e)}},T.b2DynamicTreeBroadPhase=function(){this.m_tree=new y,this.m_moveBuffer=new Vector,this.m_pairBuffer=new Vector,this.m_pairCount=0},T.prototype.CreateProxy=function(t,e){var i=this.m_tree.CreateProxy(t,e);return++this.m_proxyCount,this.BufferMove(i),i},T.prototype.DestroyProxy=function(t){this.UnBufferMove(t),--this.m_proxyCount,this.m_tree.DestroyProxy(t)},T.prototype.MoveProxy=function(t,e,i){this.m_tree.MoveProxy(t,e,i)&&this.BufferMove(t)},T.prototype.TestOverlap=function(t,e){var i=this.m_tree.GetFatAABB(t),n=this.m_tree.GetFatAABB(e);return i.TestOverlap(n)},T.prototype.GetUserData=function(t){return this.m_tree.GetUserData(t)},T.prototype.GetFatAABB=function(t){return this.m_tree.GetFatAABB(t)},T.prototype.GetProxyCount=function(){return this.m_proxyCount},T.prototype.UpdatePairs=function(t){for(var e,i=this,n=i.m_pairCount=0,n=0;n<i.m_moveBuffer.length;++n){e=i.m_moveBuffer[n];var r=i.m_tree.GetFatAABB(e);i.m_tree.Query(function(t){if(t==e)return!0;i.m_pairCount==i.m_pairBuffer.length&&(i.m_pairBuffer[i.m_pairCount]=new C);var n=i.m_pairBuffer[i.m_pairCount];return n.proxyA=e>t?t:e,n.proxyB=t>=e?t:e,++i.m_pairCount,!0},r)}for(n=i.m_moveBuffer.length=0;n<i.m_pairCount;){var r=i.m_pairBuffer[n],o=i.m_tree.GetUserData(r.proxyA),s=i.m_tree.GetUserData(r.proxyB);for(t(o,s),++n;n<i.m_pairCount&&(o=i.m_pairBuffer[n],o.proxyA==r.proxyA&&o.proxyB==r.proxyB);)++n}},T.prototype.Query=function(t,e){this.m_tree.Query(t,e)},T.prototype.RayCast=function(t,e){this.m_tree.RayCast(t,e)},T.prototype.Validate=function(){},T.prototype.Rebalance=function(t){void 0===t&&(t=0),this.m_tree.Rebalance(t)},T.prototype.BufferMove=function(t){this.m_moveBuffer[this.m_moveBuffer.length]=t},T.prototype.UnBufferMove=function(t){t=parseInt(this.m_moveBuffer.indexOf(t)),this.m_moveBuffer.splice(t,1)},T.prototype.ComparePairs=function(){return 0},T.__implements={},T.__implements[M]=!0,S.b2DynamicTreeNode=function(){this.aabb=new a},S.prototype.IsLeaf=function(){return null==this.child1},C.b2DynamicTreePair=function(){},v.b2Manifold=function(){this.m_pointCount=0},v.prototype.b2Manifold=function(){this.m_points=new Vector(n.b2_maxManifoldPoints);for(var t=0;t<n.b2_maxManifoldPoints;t++)this.m_points[t]=new x;this.m_localPlaneNormal=new c,this.m_localPoint=new c},v.prototype.Reset=function(){for(var t=0;t<n.b2_maxManifoldPoints;t++)(this.m_points[t]instanceof x?this.m_points[t]:null).Reset();this.m_localPlaneNormal.SetZero(),this.m_localPoint.SetZero(),this.m_pointCount=this.m_type=0},v.prototype.Set=function(t){this.m_pointCount=t.m_pointCount;for(var e=0;e<n.b2_maxManifoldPoints;e++)(this.m_points[e]instanceof x?this.m_points[e]:null).Set(t.m_points[e]);this.m_localPlaneNormal.SetV(t.m_localPlaneNormal),this.m_localPoint.SetV(t.m_localPoint),this.m_type=t.m_type},v.prototype.Copy=function(){var t=new v;return t.Set(this),t},Box2D.postDefs.push(function(){Box2D.Collision.b2Manifold.e_circles=1,Box2D.Collision.b2Manifold.e_faceA=2,Box2D.Collision.b2Manifold.e_faceB=4}),x.b2ManifoldPoint=function(){this.m_localPoint=new c,this.m_id=new d},x.prototype.b2ManifoldPoint=function(){this.Reset()},x.prototype.Reset=function(){this.m_localPoint.SetZero(),this.m_tangentImpulse=this.m_normalImpulse=0,this.m_id.key=0},x.prototype.Set=function(t){this.m_localPoint.SetV(t.m_localPoint),this.m_normalImpulse=t.m_normalImpulse,this.m_tangentImpulse=t.m_tangentImpulse,this.m_id.Set(t.m_id)},E.b2Point=function(){this.p=new c},E.prototype.Support=function(){return this.p},E.prototype.GetFirstVertex=function(){return this.p},b.b2RayCastInput=function(){this.p1=new c,this.p2=new c},b.prototype.b2RayCastInput=function(t,e,i){void 0===t&&(t=null),void 0===e&&(e=null),void 0===i&&(i=1),t&&this.p1.SetV(t),e&&this.p2.SetV(e),this.maxFraction=i},A.b2RayCastOutput=function(){this.normal=new c},R.b2Segment=function(){this.p1=new c,this.p2=new c},R.prototype.TestSegment=function(t,e,i,n){void 0===n&&(n=0);var r=i.p1,o=i.p2.x-r.x,s=i.p2.y-r.y;i=this.p2.y-this.p1.y;var c=-(this.p2.x-this.p1.x),a=100*Number.MIN_VALUE,l=-(o*i+s*c);if(l>a){var h=r.x-this.p1.x,u=r.y-this.p1.y,r=h*i+u*c;if(r>=0&&n*l>=r&&(n=-o*u+s*h,n>=-a*l&&l*(1+a)>=n))return r/=l,n=Math.sqrt(i*i+c*c),t[0]=r,e.Set(i/n,c/n),!0}return!1},R.prototype.Extend=function(t){this.ExtendForward(t),this.ExtendBackward(t)},R.prototype.ExtendForward=function(t){var e=this.p2.x-this.p1.x,i=this.p2.y-this.p1.y;t=Math.min(e>0?(t.upperBound.x-this.p1.x)/e:0>e?(t.lowerBound.x-this.p1.x)/e:Number.POSITIVE_INFINITY,i>0?(t.upperBound.y-this.p1.y)/i:0>i?(t.lowerBound.y-this.p1.y)/i:Number.POSITIVE_INFINITY),this.p2.x=this.p1.x+e*t,this.p2.y=this.p1.y+i*t},R.prototype.ExtendBackward=function(t){var e=-this.p2.x+this.p1.x,i=-this.p2.y+this.p1.y;t=Math.min(e>0?(t.upperBound.x-this.p2.x)/e:0>e?(t.lowerBound.x-this.p2.x)/e:Number.POSITIVE_INFINITY,i>0?(t.upperBound.y-this.p2.y)/i:0>i?(t.lowerBound.y-this.p2.y)/i:Number.POSITIVE_INFINITY),this.p1.x=this.p2.x+e*t,this.p1.y=this.p2.y+i*t},P.b2SeparationFunction=function(){this.m_localPoint=new c,this.m_axis=new c},P.prototype.Initialize=function(t,e,i,o,s){this.m_proxyA=e,this.m_proxyB=o;var a=parseInt(t.count);n.b2Assert(a>0&&3>a);var l,h,u,d,_=d=u=o=e=0,p=0,_=0;1==a?(this.m_type=P.e_points,l=this.m_proxyA.GetVertex(t.indexA[0]),h=this.m_proxyB.GetVertex(t.indexB[0]),a=l,t=i.R,e=i.position.x+(t.col1.x*a.x+t.col2.x*a.y),o=i.position.y+(t.col1.y*a.x+t.col2.y*a.y),a=h,t=s.R,u=s.position.x+(t.col1.x*a.x+t.col2.x*a.y),d=s.position.y+(t.col1.y*a.x+t.col2.y*a.y),this.m_axis.x=u-e,this.m_axis.y=d-o,this.m_axis.Normalize()):(t.indexB[0]==t.indexB[1]?(this.m_type=P.e_faceA,e=this.m_proxyA.GetVertex(t.indexA[0]),o=this.m_proxyA.GetVertex(t.indexA[1]),h=this.m_proxyB.GetVertex(t.indexB[0]),this.m_localPoint.x=.5*(e.x+o.x),this.m_localPoint.y=.5*(e.y+o.y),this.m_axis=r.CrossVF(r.SubtractVV(o,e),1),this.m_axis.Normalize(),a=this.m_axis,t=i.R,_=t.col1.x*a.x+t.col2.x*a.y,p=t.col1.y*a.x+t.col2.y*a.y,a=this.m_localPoint,t=i.R,e=i.position.x+(t.col1.x*a.x+t.col2.x*a.y),o=i.position.y+(t.col1.y*a.x+t.col2.y*a.y),a=h,t=s.R,u=s.position.x+(t.col1.x*a.x+t.col2.x*a.y),d=s.position.y+(t.col1.y*a.x+t.col2.y*a.y),_=(u-e)*_+(d-o)*p):t.indexA[0]==t.indexA[0]?(this.m_type=P.e_faceB,u=this.m_proxyB.GetVertex(t.indexB[0]),d=this.m_proxyB.GetVertex(t.indexB[1]),l=this.m_proxyA.GetVertex(t.indexA[0]),this.m_localPoint.x=.5*(u.x+d.x),this.m_localPoint.y=.5*(u.y+d.y),this.m_axis=r.CrossVF(r.SubtractVV(d,u),1),this.m_axis.Normalize(),a=this.m_axis,t=s.R,_=t.col1.x*a.x+t.col2.x*a.y,p=t.col1.y*a.x+t.col2.y*a.y,a=this.m_localPoint,t=s.R,u=s.position.x+(t.col1.x*a.x+t.col2.x*a.y),d=s.position.y+(t.col1.y*a.x+t.col2.y*a.y),a=l,t=i.R,e=i.position.x+(t.col1.x*a.x+t.col2.x*a.y),o=i.position.y+(t.col1.y*a.x+t.col2.y*a.y),_=(e-u)*_+(o-d)*p):(e=this.m_proxyA.GetVertex(t.indexA[0]),o=this.m_proxyA.GetVertex(t.indexA[1]),u=this.m_proxyB.GetVertex(t.indexB[0]),d=this.m_proxyB.GetVertex(t.indexB[1]),r.MulX(i,l),l=r.MulMV(i.R,r.SubtractVV(o,e)),r.MulX(s,h),_=r.MulMV(s.R,r.SubtractVV(d,u)),s=l.x*l.x+l.y*l.y,h=_.x*_.x+_.y*_.y,t=r.SubtractVV(_,l),i=l.x*t.x+l.y*t.y,t=_.x*t.x+_.y*t.y,l=l.x*_.x+l.y*_.y,p=s*h-l*l,_=0,0!=p&&(_=r.Clamp((l*t-i*h)/p,0,1)),0>(l*_+t)/h&&(_=r.Clamp((l-i)/s,0,1)),l=new c,l.x=e.x+_*(o.x-e.x),l.y=e.y+_*(o.y-e.y),h=new c,h.x=u.x+_*(d.x-u.x),h.y=u.y+_*(d.y-u.y),0==_||1==_?(this.m_type=P.e_faceB,this.m_axis=r.CrossVF(r.SubtractVV(d,u),1),this.m_axis.Normalize(),this.m_localPoint=h):(this.m_type=P.e_faceA,this.m_axis=r.CrossVF(r.SubtractVV(o,e),1),this.m_localPoint=l)),0>_&&this.m_axis.NegativeSelf())},P.prototype.Evaluate=function(t,e){var i,o,s=0;switch(this.m_type){case P.e_points:return i=r.MulTMV(t.R,this.m_axis),o=r.MulTMV(e.R,this.m_axis.GetNegative()),i=this.m_proxyA.GetSupportVertex(i),o=this.m_proxyB.GetSupportVertex(o),i=r.MulX(t,i),o=r.MulX(e,o),s=(o.x-i.x)*this.m_axis.x+(o.y-i.y)*this.m_axis.y;case P.e_faceA:return s=r.MulMV(t.R,this.m_axis),i=r.MulX(t,this.m_localPoint),o=r.MulTMV(e.R,s.GetNegative()),o=this.m_proxyB.GetSupportVertex(o),o=r.MulX(e,o),s=(o.x-i.x)*s.x+(o.y-i.y)*s.y;case P.e_faceB:return s=r.MulMV(e.R,this.m_axis),o=r.MulX(e,this.m_localPoint),i=r.MulTMV(t.R,s.GetNegative()),i=this.m_proxyA.GetSupportVertex(i),i=r.MulX(t,i),s=(i.x-o.x)*s.x+(i.y-o.y)*s.y;default:return n.b2Assert(!1),0}},Box2D.postDefs.push(function(){Box2D.Collision.b2SeparationFunction.e_points=1,Box2D.Collision.b2SeparationFunction.e_faceA=2,Box2D.Collision.b2SeparationFunction.e_faceB=4}),I.b2Simplex=function(){this.m_v1=new L,this.m_v2=new L,this.m_v3=new L,this.m_vertices=new Vector(3)},I.prototype.b2Simplex=function(){this.m_vertices[0]=this.m_v1,this.m_vertices[1]=this.m_v2,this.m_vertices[2]=this.m_v3},I.prototype.ReadCache=function(t,e,i,o,s){n.b2Assert(0<=t.count&&3>=t.count);var c,a;this.m_count=t.count;for(var l=this.m_vertices,h=0;h<this.m_count;h++){var u=l[h];u.indexA=t.indexA[h],u.indexB=t.indexB[h],c=e.GetVertex(u.indexA),a=o.GetVertex(u.indexB),u.wA=r.MulX(i,c),u.wB=r.MulX(s,a),u.w=r.SubtractVV(u.wB,u.wA),u.a=0}1<this.m_count&&(t=t.metric,c=this.GetMetric(),.5*t>c||c>2*t||c<Number.MIN_VALUE)&&(this.m_count=0),0==this.m_count&&(u=l[0],u.indexA=0,u.indexB=0,c=e.GetVertex(0),a=o.GetVertex(0),u.wA=r.MulX(i,c),u.wB=r.MulX(s,a),u.w=r.SubtractVV(u.wB,u.wA),this.m_count=1)},I.prototype.WriteCache=function(t){t.metric=this.GetMetric(),t.count=Box2D.parseUInt(this.m_count);for(var e=this.m_vertices,i=0;i<this.m_count;i++)t.indexA[i]=Box2D.parseUInt(e[i].indexA),t.indexB[i]=Box2D.parseUInt(e[i].indexB)},I.prototype.GetSearchDirection=function(){switch(this.m_count){case 1:return this.m_v1.w.GetNegative();case 2:var t=r.SubtractVV(this.m_v2.w,this.m_v1.w);return 0<r.CrossVV(t,this.m_v1.w.GetNegative())?r.CrossFV(1,t):r.CrossVF(t,1);default:return n.b2Assert(!1),new c}},I.prototype.GetClosestPoint=function(){switch(this.m_count){case 0:return n.b2Assert(!1),new c;case 1:return this.m_v1.w;case 2:return new c(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);default:return n.b2Assert(!1),new c}},I.prototype.GetWitnessPoints=function(t,e){switch(this.m_count){case 0:n.b2Assert(!1);break;case 1:t.SetV(this.m_v1.wA),e.SetV(this.m_v1.wB);break;case 2:t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,e.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,e.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:e.x=t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,e.y=t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:n.b2Assert(!1)}},I.prototype.GetMetric=function(){switch(this.m_count){case 0:return n.b2Assert(!1),0;case 1:return 0;case 2:return r.SubtractVV(this.m_v1.w,this.m_v2.w).Length();case 3:return r.CrossVV(r.SubtractVV(this.m_v2.w,this.m_v1.w),r.SubtractVV(this.m_v3.w,this.m_v1.w));default:return n.b2Assert(!1),0}},I.prototype.Solve2=function(){var t=this.m_v1.w,e=this.m_v2.w,i=r.SubtractVV(e,t),t=-(t.x*i.x+t.y*i.y);0>=t?this.m_count=this.m_v1.a=1:(e=e.x*i.x+e.y*i.y,0>=e?(this.m_count=this.m_v2.a=1,this.m_v1.Set(this.m_v2)):(i=1/(e+t),this.m_v1.a=e*i,this.m_v2.a=t*i,this.m_count=2))},I.prototype.Solve3=function(){var t=this.m_v1.w,e=this.m_v2.w,i=this.m_v3.w,n=r.SubtractVV(e,t),o=r.Dot(t,n),s=r.Dot(e,n),o=-o,c=r.SubtractVV(i,t),a=r.Dot(t,c),l=r.Dot(i,c),a=-a,h=r.SubtractVV(i,e),u=r.Dot(e,h),h=r.Dot(i,h),u=-u,c=r.CrossVV(n,c),n=c*r.CrossVV(e,i),i=c*r.CrossVV(i,t),t=c*r.CrossVV(t,e);0>=o&&0>=a?this.m_count=this.m_v1.a=1:s>0&&o>0&&0>=t?(l=1/(s+o),this.m_v1.a=s*l,this.m_v2.a=o*l,this.m_count=2):l>0&&a>0&&0>=i?(s=1/(l+a),this.m_v1.a=l*s,this.m_v3.a=a*s,this.m_count=2,this.m_v2.Set(this.m_v3)):0>=s&&0>=u?(this.m_count=this.m_v2.a=1,this.m_v1.Set(this.m_v2)):0>=l&&0>=h?(this.m_count=this.m_v3.a=1,this.m_v1.Set(this.m_v3)):h>0&&u>0&&0>=n?(s=1/(h+u),this.m_v2.a=h*s,this.m_v3.a=u*s,this.m_count=2,this.m_v1.Set(this.m_v3)):(s=1/(n+i+t),this.m_v1.a=n*s,this.m_v2.a=i*s,this.m_v3.a=t*s,this.m_count=3)},w.b2SimplexCache=function(){this.indexA=new Vector_a2j_Number(3),this.indexB=new Vector_a2j_Number(3)},L.b2SimplexVertex=function(){},L.prototype.Set=function(t){this.wA.SetV(t.wA),this.wB.SetV(t.wB),this.w.SetV(t.w),this.a=t.a,this.indexA=t.indexA,this.indexB=t.indexB},D.b2TimeOfImpact=function(){},D.TimeOfImpact=function(t){++D.b2_toiCalls;var e=t.proxyA,i=t.proxyB,o=t.sweepA,s=t.sweepB;n.b2Assert(o.t0==s.t0),n.b2Assert(1-o.t0>Number.MIN_VALUE);var c=e.m_radius+i.m_radius;t=t.tolerance;var a=0,l=0,h=0;for(D.s_cache.count=0,D.s_distanceInput.useRadii=!1;;){if(o.GetTransform(D.s_xfA,a),s.GetTransform(D.s_xfB,a),D.s_distanceInput.proxyA=e,D.s_distanceInput.proxyB=i,D.s_distanceInput.transformA=D.s_xfA,D.s_distanceInput.transformB=D.s_xfB,p.Distance(D.s_distanceOutput,D.s_cache,D.s_distanceInput),0>=D.s_distanceOutput.distance){a=1;break}D.s_fcn.Initialize(D.s_cache,e,D.s_xfA,i,D.s_xfB);var u=D.s_fcn.Evaluate(D.s_xfA,D.s_xfB);if(0>=u){a=1;break}if(0==l&&(h=u>c?r.Max(c-t,.75*c):r.Max(u-t,.02*c)),.5*t>u-h){if(0==l){a=1;break}break}var d=a,_=a,f=1;o.GetTransform(D.s_xfA,f),s.GetTransform(D.s_xfB,f);var m=D.s_fcn.Evaluate(D.s_xfA,D.s_xfB);if(m>=h){a=1;break}for(var g=0;;){var y=0,y=1&g?_+(h-u)*(f-_)/(m-u):.5*(_+f);o.GetTransform(D.s_xfA,y),s.GetTransform(D.s_xfB,y);var T=D.s_fcn.Evaluate(D.s_xfA,D.s_xfB);if(r.Abs(T-h)<.025*t){d=y;break}if(T>h?(_=y,u=T):(f=y,m=T),++g,++D.b2_toiRootIters,50==g)break}if(D.b2_toiMaxRootIters=r.Max(D.b2_toiMaxRootIters,g),d<(1+100*Number.MIN_VALUE)*a)break;if(a=d,l++,++D.b2_toiIters,1e3==l)break}return D.b2_toiMaxIters=r.Max(D.b2_toiMaxIters,l),a},Box2D.postDefs.push(function(){Box2D.Collision.b2TimeOfImpact.b2_toiCalls=0,Box2D.Collision.b2TimeOfImpact.b2_toiIters=0,Box2D.Collision.b2TimeOfImpact.b2_toiMaxIters=0,Box2D.Collision.b2TimeOfImpact.b2_toiRootIters=0,Box2D.Collision.b2TimeOfImpact.b2_toiMaxRootIters=0,Box2D.Collision.b2TimeOfImpact.s_cache=new w,Box2D.Collision.b2TimeOfImpact.s_distanceInput=new f,Box2D.Collision.b2TimeOfImpact.s_xfA=new s,Box2D.Collision.b2TimeOfImpact.s_xfB=new s,Box2D.Collision.b2TimeOfImpact.s_fcn=new P,Box2D.Collision.b2TimeOfImpact.s_distanceOutput=new m}),O.b2TOIInput=function(){this.proxyA=new g,this.proxyB=new g,this.sweepA=new o,this.sweepB=new o},N.b2WorldManifold=function(){this.m_normal=new c},N.prototype.b2WorldManifold=function(){this.m_points=new Vector(n.b2_maxManifoldPoints);for(var t=0;t<n.b2_maxManifoldPoints;t++)this.m_points[t]=new c},N.prototype.Initialize=function(t,e,i,n,r){if(void 0===i&&(i=0),void 0===r&&(r=0),0!=t.m_pointCount){var o,s,c=0,a=0,l=0,h=0,u=0,d=0;switch(o=0,t.m_type){case v.e_circles:s=e.R,o=t.m_localPoint,c=e.position.x+s.col1.x*o.x+s.col2.x*o.y,e=e.position.y+s.col1.y*o.x+s.col2.y*o.y,s=n.R,o=t.m_points[0].m_localPoint,t=n.position.x+s.col1.x*o.x+s.col2.x*o.y,n=n.position.y+s.col1.y*o.x+s.col2.y*o.y,o=t-c,s=n-e,a=o*o+s*s,a>Number.MIN_VALUE*Number.MIN_VALUE?(a=Math.sqrt(a),this.m_normal.x=o/a,this.m_normal.y=s/a):(this.m_normal.x=1,this.m_normal.y=0),o=e+i*this.m_normal.y,n-=r*this.m_normal.y,this.m_points[0].x=.5*(c+i*this.m_normal.x+(t-r*this.m_normal.x)),this.m_points[0].y=.5*(o+n);break;case v.e_faceA:for(s=e.R,o=t.m_localPlaneNormal,a=s.col1.x*o.x+s.col2.x*o.y,l=s.col1.y*o.x+s.col2.y*o.y,s=e.R,o=t.m_localPoint,h=e.position.x+s.col1.x*o.x+s.col2.x*o.y,u=e.position.y+s.col1.y*o.x+s.col2.y*o.y,this.m_normal.x=a,this.m_normal.y=l,c=0;c<t.m_pointCount;c++)s=n.R,o=t.m_points[c].m_localPoint,d=n.position.x+s.col1.x*o.x+s.col2.x*o.y,o=n.position.y+s.col1.y*o.x+s.col2.y*o.y,this.m_points[c].x=d+.5*(i-(d-h)*a-(o-u)*l-r)*a,this.m_points[c].y=o+.5*(i-(d-h)*a-(o-u)*l-r)*l;break;case v.e_faceB:for(s=n.R,o=t.m_localPlaneNormal,a=s.col1.x*o.x+s.col2.x*o.y,l=s.col1.y*o.x+s.col2.y*o.y,s=n.R,o=t.m_localPoint,h=n.position.x+s.col1.x*o.x+s.col2.x*o.y,u=n.position.y+s.col1.y*o.x+s.col2.y*o.y,this.m_normal.x=-a,this.m_normal.y=-l,c=0;c<t.m_pointCount;c++)s=e.R,o=t.m_points[c].m_localPoint,d=e.position.x+s.col1.x*o.x+s.col2.x*o.y,o=e.position.y+s.col1.y*o.x+s.col2.y*o.y,this.m_points[c].x=d+.5*(r-(d-h)*a-(o-u)*l-i)*a,this.m_points[c].y=o+.5*(r-(d-h)*a-(o-u)*l-i)*l}}},B.ClipVertex=function(){this.v=new c,this.id=new d},B.prototype.Set=function(t){this.v.SetV(t.v),this.id.Set(t.id)},F.Features=function(){},Object.defineProperty(F.prototype,"referenceEdge",{enumerable:!1,configurable:!0,get:function(){return this._referenceEdge}}),Object.defineProperty(F.prototype,"referenceEdge",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0),this._referenceEdge=t,this._m_id._key=4294967040&this._m_id._key|255&this._referenceEdge}}),Object.defineProperty(F.prototype,"incidentEdge",{enumerable:!1,configurable:!0,get:function(){return this._incidentEdge}}),Object.defineProperty(F.prototype,"incidentEdge",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0),this._incidentEdge=t,this._m_id._key=4294902015&this._m_id._key|this._incidentEdge<<8&65280}}),Object.defineProperty(F.prototype,"incidentVertex",{enumerable:!1,configurable:!0,get:function(){return this._incidentVertex}}),Object.defineProperty(F.prototype,"incidentVertex",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0),this._incidentVertex=t,this._m_id._key=4278255615&this._m_id._key|this._incidentVertex<<16&16711680}}),Object.defineProperty(F.prototype,"flip",{enumerable:!1,configurable:!0,get:function(){return this._flip}}),Object.defineProperty(F.prototype,"flip",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0),this._flip=t,this._m_id._key=16777215&this._m_id._key|this._flip<<24&4278190080}})}(),function(){var t=Box2D.Common.b2Settings,e=Box2D.Collision.Shapes.b2CircleShape,i=Box2D.Collision.Shapes.b2EdgeChainDef,n=Box2D.Collision.Shapes.b2EdgeShape,r=Box2D.Collision.Shapes.b2MassData,o=Box2D.Collision.Shapes.b2PolygonShape,s=Box2D.Collision.Shapes.b2Shape,c=Box2D.Common.Math.b2Mat22,a=Box2D.Common.Math.b2Math,l=Box2D.Common.Math.b2Transform,h=Box2D.Common.Math.b2Vec2,u=Box2D.Collision.b2Distance,d=Box2D.Collision.b2DistanceInput,_=Box2D.Collision.b2DistanceOutput,p=Box2D.Collision.b2DistanceProxy,f=Box2D.Collision.b2SimplexCache;Box2D.inherit(e,Box2D.Collision.Shapes.b2Shape),e.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype,e.b2CircleShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments),this.m_p=new h},e.prototype.Copy=function(){var t=new e;return t.Set(this),t},e.prototype.Set=function(t){this.__super.Set.call(this,t),Box2D.is(t,e)&&this.m_p.SetV((t instanceof e?t:null).m_p)},e.prototype.TestPoint=function(t,e){var i=t.R,n=t.position.x+(i.col1.x*this.m_p.x+i.col2.x*this.m_p.y),i=t.position.y+(i.col1.y*this.m_p.x+i.col2.y*this.m_p.y),n=e.x-n,i=e.y-i;return n*n+i*i<=this.m_radius*this.m_radius},e.prototype.RayCast=function(t,e,i){var n=i.R,r=e.p1.x-(i.position.x+(n.col1.x*this.m_p.x+n.col2.x*this.m_p.y));i=e.p1.y-(i.position.y+(n.col1.y*this.m_p.x+n.col2.y*this.m_p.y));var n=e.p2.x-e.p1.x,o=e.p2.y-e.p1.y,s=r*n+i*o,c=n*n+o*o,a=s*s-c*(r*r+i*i-this.m_radius*this.m_radius);return 0>a||c<Number.MIN_VALUE?!1:(s=-(s+Math.sqrt(a)),s>=0&&s<=e.maxFraction*c?(s/=c,t.fraction=s,t.normal.x=r+s*n,t.normal.y=i+s*o,t.normal.Normalize(),!0):!1)},e.prototype.ComputeAABB=function(t,e){var i=e.R,n=e.position.x+(i.col1.x*this.m_p.x+i.col2.x*this.m_p.y),i=e.position.y+(i.col1.y*this.m_p.x+i.col2.y*this.m_p.y);t.lowerBound.Set(n-this.m_radius,i-this.m_radius),t.upperBound.Set(n+this.m_radius,i+this.m_radius)},e.prototype.ComputeMass=function(e,i){void 0===i&&(i=0),e.mass=i*t.b2_pi*this.m_radius*this.m_radius,e.center.SetV(this.m_p),e.I=e.mass*(.5*this.m_radius*this.m_radius+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y))},e.prototype.ComputeSubmergedArea=function(t,e,i,n){void 0===e&&(e=0),i=a.MulX(i,this.m_p);var r=-(a.Dot(t,i)-e);if(r<-this.m_radius+Number.MIN_VALUE)return 0;if(r>this.m_radius)return n.SetV(i),Math.PI*this.m_radius*this.m_radius;e=this.m_radius*this.m_radius;var o=r*r,r=e*(Math.asin(r/this.m_radius)+Math.PI/2)+r*Math.sqrt(e-o);return e=-2/3*Math.pow(e-o,1.5)/r,n.x=i.x+t.x*e,n.y=i.y+t.y*e,r},e.prototype.GetLocalPosition=function(){return this.m_p},e.prototype.SetLocalPosition=function(t){this.m_p.SetV(t)},e.prototype.GetRadius=function(){return this.m_radius},e.prototype.SetRadius=function(t){void 0===t&&(t=0),this.m_radius=t},e.prototype.b2CircleShape=function(t){void 0===t&&(t=0),this.__super.b2Shape.call(this),this.m_type=s.e_circleShape,this.m_radius=t},i.b2EdgeChainDef=function(){},i.prototype.b2EdgeChainDef=function(){this.vertexCount=0,this.isALoop=!0,this.vertices=[]},Box2D.inherit(n,Box2D.Collision.Shapes.b2Shape),n.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype,n.b2EdgeShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments),this.s_supportVec=new h,this.m_v1=new h,this.m_v2=new h,this.m_coreV1=new h,this.m_coreV2=new h,this.m_normal=new h,this.m_direction=new h,this.m_cornerDir1=new h,this.m_cornerDir2=new h},n.prototype.TestPoint=function(){return!1},n.prototype.RayCast=function(t,e,i){var n,r=e.p2.x-e.p1.x,o=e.p2.y-e.p1.y;n=i.R;var s=i.position.x+(n.col1.x*this.m_v1.x+n.col2.x*this.m_v1.y),c=i.position.y+(n.col1.y*this.m_v1.x+n.col2.y*this.m_v1.y),a=i.position.y+(n.col1.y*this.m_v2.x+n.col2.y*this.m_v2.y)-c;i=-(i.position.x+(n.col1.x*this.m_v2.x+n.col2.x*this.m_v2.y)-s),n=100*Number.MIN_VALUE;var l=-(r*a+o*i);if(l>n){var s=e.p1.x-s,h=e.p1.y-c,c=s*a+h*i;if(c>=0&&c<=e.maxFraction*l&&(e=-r*h+o*s,e>=-n*l&&l*(1+n)>=e))return t.fraction=c/l,e=Math.sqrt(a*a+i*i),t.normal.x=a/e,t.normal.y=i/e,!0}return!1},n.prototype.ComputeAABB=function(t,e){var i=e.R,n=e.position.x+(i.col1.x*this.m_v1.x+i.col2.x*this.m_v1.y),r=e.position.y+(i.col1.y*this.m_v1.x+i.col2.y*this.m_v1.y),o=e.position.x+(i.col1.x*this.m_v2.x+i.col2.x*this.m_v2.y),i=e.position.y+(i.col1.y*this.m_v2.x+i.col2.y*this.m_v2.y);o>n?(t.lowerBound.x=n,t.upperBound.x=o):(t.lowerBound.x=o,t.upperBound.x=n),i>r?(t.lowerBound.y=r,t.upperBound.y=i):(t.lowerBound.y=i,t.upperBound.y=r)},n.prototype.ComputeMass=function(t){t.mass=0,t.center.SetV(this.m_v1),t.I=0},n.prototype.ComputeSubmergedArea=function(t,e,i,n){void 0===e&&(e=0);var r=new h(t.x*e,t.y*e),o=a.MulX(i,this.m_v1);i=a.MulX(i,this.m_v2);var s=a.Dot(t,o)-e;if(t=a.Dot(t,i)-e,s>0){if(t>0)return 0;o.x=-t/(s-t)*o.x+s/(s-t)*i.x,o.y=-t/(s-t)*o.y+s/(s-t)*i.y}else t>0&&(i.x=-t/(s-t)*o.x+s/(s-t)*i.x,i.y=-t/(s-t)*o.y+s/(s-t)*i.y);return n.x=(r.x+o.x+i.x)/3,n.y=(r.y+o.y+i.y)/3,.5*((o.x-r.x)*(i.y-r.y)-(o.y-r.y)*(i.x-r.x))},n.prototype.GetLength=function(){return this.m_length},n.prototype.GetVertex1=function(){return this.m_v1},n.prototype.GetVertex2=function(){return this.m_v2},n.prototype.GetCoreVertex1=function(){return this.m_coreV1},n.prototype.GetCoreVertex2=function(){return this.m_coreV2},n.prototype.GetNormalVector=function(){return this.m_normal},n.prototype.GetDirectionVector=function(){return this.m_direction},n.prototype.GetCorner1Vector=function(){return this.m_cornerDir1},n.prototype.GetCorner2Vector=function(){return this.m_cornerDir2},n.prototype.Corner1IsConvex=function(){return this.m_cornerConvex1},n.prototype.Corner2IsConvex=function(){return this.m_cornerConvex2},n.prototype.GetFirstVertex=function(t){var e=t.R;return new h(t.position.x+(e.col1.x*this.m_coreV1.x+e.col2.x*this.m_coreV1.y),t.position.y+(e.col1.y*this.m_coreV1.x+e.col2.y*this.m_coreV1.y))},n.prototype.GetNextEdge=function(){return this.m_nextEdge},n.prototype.GetPrevEdge=function(){return this.m_prevEdge},n.prototype.Support=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0);var n=t.R,r=t.position.x+(n.col1.x*this.m_coreV1.x+n.col2.x*this.m_coreV1.y),o=t.position.y+(n.col1.y*this.m_coreV1.x+n.col2.y*this.m_coreV1.y),s=t.position.x+(n.col1.x*this.m_coreV2.x+n.col2.x*this.m_coreV2.y);return t=t.position.y+(n.col1.y*this.m_coreV2.x+n.col2.y*this.m_coreV2.y),r*e+o*i>s*e+t*i?(this.s_supportVec.x=r,this.s_supportVec.y=o):(this.s_supportVec.x=s,this.s_supportVec.y=t),this.s_supportVec},n.prototype.b2EdgeShape=function(e,i){this.__super.b2Shape.call(this),this.m_type=s.e_edgeShape,this.m_nextEdge=this.m_prevEdge=null,this.m_v1=e,this.m_v2=i,this.m_direction.Set(this.m_v2.x-this.m_v1.x,this.m_v2.y-this.m_v1.y),this.m_length=this.m_direction.Normalize(),this.m_normal.Set(this.m_direction.y,-this.m_direction.x),this.m_coreV1.Set(-t.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-t.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y),this.m_coreV2.Set(-t.b2_toiSlop*(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-t.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y),this.m_cornerDir1=this.m_normal,this.m_cornerDir2.Set(-this.m_normal.x,-this.m_normal.y)},n.prototype.SetPrevEdge=function(t,e,i,n){this.m_prevEdge=t,this.m_coreV1=e,this.m_cornerDir1=i,this.m_cornerConvex1=n},n.prototype.SetNextEdge=function(t,e,i,n){this.m_nextEdge=t,this.m_coreV2=e,this.m_cornerDir2=i,this.m_cornerConvex2=n},r.b2MassData=function(){this.mass=0,this.center=new h(0,0),this.I=0},Box2D.inherit(o,Box2D.Collision.Shapes.b2Shape),o.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype,o.b2PolygonShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments)},o.prototype.Copy=function(){var t=new o;return t.Set(this),t},o.prototype.Set=function(t){if(this.__super.Set.call(this,t),Box2D.is(t,o)){t=t instanceof o?t:null,this.m_centroid.SetV(t.m_centroid),this.m_vertexCount=t.m_vertexCount,this.Reserve(this.m_vertexCount);for(var e=0;e<this.m_vertexCount;e++)this.m_vertices[e].SetV(t.m_vertices[e]),this.m_normals[e].SetV(t.m_normals[e])}},o.prototype.SetAsArray=function(t,e){void 0===e&&(e=0);for(var i,n=new Vector,r=0,r=0;r<t.length;++r)i=t[r],n.push(i);this.SetAsVector(n,e)},o.AsArray=function(t,e){void 0===e&&(e=0);var i=new o;return i.SetAsArray(t,e),i},o.prototype.SetAsVector=function(e,i){void 0===i&&(i=0),0==i&&(i=e.length),t.b2Assert(i>=2),this.m_vertexCount=i,this.Reserve(i);for(var n=0,n=0;n<this.m_vertexCount;n++)this.m_vertices[n].SetV(e[n]);for(n=0;n<this.m_vertexCount;++n){var r=parseInt(n),s=parseInt(n+1<this.m_vertexCount?n+1:0),r=a.SubtractVV(this.m_vertices[s],this.m_vertices[r]);t.b2Assert(r.LengthSquared()>Number.MIN_VALUE),this.m_normals[n].SetV(a.CrossVF(r,1)),this.m_normals[n].Normalize()}this.m_centroid=o.ComputeCentroid(this.m_vertices,this.m_vertexCount)},o.AsVector=function(t,e){void 0===e&&(e=0);var i=new o;return i.SetAsVector(t,e),i},o.prototype.SetAsBox=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-t,-e),this.m_vertices[1].Set(t,-e),this.m_vertices[2].Set(t,e),this.m_vertices[3].Set(-t,e),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero()},o.AsBox=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0);var i=new o;return i.SetAsBox(t,e),i},o.prototype.SetAsOrientedBox=function(t,e,i,n){for(void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=null),void 0===n&&(n=0),this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-t,-e),this.m_vertices[1].Set(t,-e),this.m_vertices[2].Set(t,e),this.m_vertices[3].Set(-t,e),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid=i,t=new l,t.position=i,t.R.Set(n),i=0;i<this.m_vertexCount;++i)this.m_vertices[i]=a.MulX(t,this.m_vertices[i]),this.m_normals[i]=a.MulMV(t.R,this.m_normals[i])},o.AsOrientedBox=function(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=null),void 0===n&&(n=0);var r=new o;return r.SetAsOrientedBox(t,e,i,n),r},o.prototype.SetAsEdge=function(t,e){this.m_vertexCount=2,this.Reserve(2),this.m_vertices[0].SetV(t),this.m_vertices[1].SetV(e),this.m_centroid.x=.5*(t.x+e.x),this.m_centroid.y=.5*(t.y+e.y),this.m_normals[0]=a.CrossVF(a.SubtractVV(e,t),1),this.m_normals[0].Normalize(),this.m_normals[1].x=-this.m_normals[0].x,this.m_normals[1].y=-this.m_normals[0].y},o.AsEdge=function(t,e){var i=new o;return i.SetAsEdge(t,e),i},o.prototype.TestPoint=function(t,e){var i;i=t.R;for(var n=e.x-t.position.x,r=e.y-t.position.y,o=n*i.col1.x+r*i.col1.y,s=n*i.col2.x+r*i.col2.y,c=0;c<this.m_vertexCount;++c)if(i=this.m_vertices[c],n=o-i.x,r=s-i.y,i=this.m_normals[c],0<i.x*n+i.y*r)return!1;return!0},o.prototype.RayCast=function(t,e,i){var n,r,o=0,s=e.maxFraction,c=0,a=0,c=e.p1.x-i.position.x,a=e.p1.y-i.position.y;n=i.R;var l=c*n.col1.x+a*n.col1.y,h=c*n.col2.x+a*n.col2.y,c=e.p2.x-i.position.x,a=e.p2.y-i.position.y;n=i.R,e=c*n.col1.x+a*n.col1.y-l,n=c*n.col2.x+a*n.col2.y-h;for(var u=-1,d=0;d<this.m_vertexCount;++d){if(r=this.m_vertices[d],c=r.x-l,a=r.y-h,r=this.m_normals[d],c=r.x*c+r.y*a,a=r.x*e+r.y*n,0==a){if(0>c)return!1}else 0>a&&o*a>c?(o=c/a,u=d):a>0&&s*a>c&&(s=c/a);if(s<o-Number.MIN_VALUE)return!1}return u>=0?(t.fraction=o,n=i.R,r=this.m_normals[u],t.normal.x=n.col1.x*r.x+n.col2.x*r.y,t.normal.y=n.col1.y*r.x+n.col2.y*r.y,!0):!1},o.prototype.ComputeAABB=function(t,e){for(var i=e.R,n=this.m_vertices[0],r=e.position.x+(i.col1.x*n.x+i.col2.x*n.y),o=e.position.y+(i.col1.y*n.x+i.col2.y*n.y),s=r,c=o,a=1;a<this.m_vertexCount;++a)var n=this.m_vertices[a],l=e.position.x+(i.col1.x*n.x+i.col2.x*n.y),n=e.position.y+(i.col1.y*n.x+i.col2.y*n.y),r=l>r?r:l,o=n>o?o:n,s=s>l?s:l,c=c>n?c:n;t.lowerBound.x=r-this.m_radius,t.lowerBound.y=o-this.m_radius,t.upperBound.x=s+this.m_radius,t.upperBound.y=c+this.m_radius},o.prototype.ComputeMass=function(t,e){if(void 0===e&&(e=0),2==this.m_vertexCount)t.center.x=.5*(this.m_vertices[0].x+this.m_vertices[1].x),t.center.y=.5*(this.m_vertices[0].y+this.m_vertices[1].y),t.mass=0,t.I=0;else{for(var i=0,n=0,r=0,o=0,s=1/3,c=0;c<this.m_vertexCount;++c)var a=this.m_vertices[c],l=c+1<this.m_vertexCount?this.m_vertices[parseInt(c+1)]:this.m_vertices[0],h=a.x-0,u=a.y-0,d=l.x-0,_=l.y-0,p=h*_-u*d,f=.5*p,r=r+f,i=i+f*s*(0+a.x+l.x),n=n+f*s*(0+a.y+l.y),a=h,o=o+p*(s*(.25*(a*a+d*a+d*d)+(0*a+0*d))+0+(s*(.25*(u*u+_*u+_*_)+(0*u+0*_))+0));t.mass=e*r,t.center.Set(1/r*i,1/r*n),t.I=e*o}},o.prototype.ComputeSubmergedArea=function(t,e,i,n){void 0===e&&(e=0);var o=a.MulTMV(i.R,t),s=e-a.Dot(t,i.position),c=new Vector_a2j_Number,l=0,u=-1;e=-1;var d=!1;for(t=t=0;t<this.m_vertexCount;++t){c[t]=a.Dot(o,this.m_vertices[t])-s;var _=c[t]<-Number.MIN_VALUE;t>0&&(_?d||(u=t-1,l++):d&&(e=t-1,l++)),d=_}switch(l){case 0:return d?(t=new r,this.ComputeMass(t,1),n.SetV(a.MulX(i,t.center)),t.mass):0;case 1:-1==u?u=this.m_vertexCount-1:e=this.m_vertexCount-1}for(t=parseInt((u+1)%this.m_vertexCount),o=parseInt((e+1)%this.m_vertexCount),s=(0-c[u])/(c[t]-c[u]),c=(0-c[e])/(c[o]-c[e]),u=new h(this.m_vertices[u].x*(1-s)+this.m_vertices[t].x*s,this.m_vertices[u].y*(1-s)+this.m_vertices[t].y*s),e=new h(this.m_vertices[e].x*(1-c)+this.m_vertices[o].x*c,this.m_vertices[e].y*(1-c)+this.m_vertices[o].y*c),c=0,s=new h,l=this.m_vertices[t];t!=o;)t=(t+1)%this.m_vertexCount,d=t==o?e:this.m_vertices[t],_=.5*((l.x-u.x)*(d.y-u.y)-(l.y-u.y)*(d.x-u.x)),c+=_,s.x+=_*(u.x+l.x+d.x)/3,s.y+=_*(u.y+l.y+d.y)/3,l=d;return s.Multiply(1/c),n.SetV(a.MulX(i,s)),c},o.prototype.GetVertexCount=function(){return this.m_vertexCount},o.prototype.GetVertices=function(){return this.m_vertices},o.prototype.GetNormals=function(){return this.m_normals},o.prototype.GetSupport=function(t){for(var e=0,i=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y,n=1;n<this.m_vertexCount;++n){var r=this.m_vertices[n].x*t.x+this.m_vertices[n].y*t.y;r>i&&(e=n,i=r)}return e},o.prototype.GetSupportVertex=function(t){for(var e=0,i=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y,n=1;n<this.m_vertexCount;++n){var r=this.m_vertices[n].x*t.x+this.m_vertices[n].y*t.y;
r>i&&(e=n,i=r)}return this.m_vertices[e]},o.prototype.Validate=function(){return!1},o.prototype.b2PolygonShape=function(){this.__super.b2Shape.call(this),this.m_type=s.e_polygonShape,this.m_centroid=new h,this.m_vertices=new Vector,this.m_normals=new Vector},o.prototype.Reserve=function(t){void 0===t&&(t=0);for(var e=parseInt(this.m_vertices.length);t>e;e++)this.m_vertices[e]=new h,this.m_normals[e]=new h},o.ComputeCentroid=function(t,e){void 0===e&&(e=0);for(var i=new h,n=0,r=1/3,o=0;e>o;++o){var s=t[o],c=e>o+1?t[parseInt(o+1)]:t[0],a=.5*((s.x-0)*(c.y-0)-(s.y-0)*(c.x-0)),n=n+a;i.x+=a*r*(0+s.x+c.x),i.y+=a*r*(0+s.y+c.y)}return i.x*=1/n,i.y*=1/n,i},o.ComputeOBB=function(t,e,i){void 0===i&&(i=0);for(var n=0,r=new Vector(i+1),n=0;i>n;++n)r[n]=e[n];for(r[i]=r[0],e=Number.MAX_VALUE,n=1;i>=n;++n){for(var o=r[parseInt(n-1)],s=r[n].x-o.x,c=r[n].y-o.y,a=Math.sqrt(s*s+c*c),s=s/a,c=c/a,l=-c,h=s,u=a=Number.MAX_VALUE,d=-Number.MAX_VALUE,_=-Number.MAX_VALUE,p=0;i>p;++p){var f=r[p].x-o.x,m=r[p].y-o.y,g=s*f+c*m,f=l*f+h*m;a>g&&(a=g),u>f&&(u=f),g>d&&(d=g),f>_&&(_=f)}p=(d-a)*(_-u),.95*e>p&&(e=p,t.R.col1.x=s,t.R.col1.y=c,t.R.col2.x=l,t.R.col2.y=h,s=.5*(a+d),c=.5*(u+_),l=t.R,t.center.x=o.x+(l.col1.x*s+l.col2.x*c),t.center.y=o.y+(l.col1.y*s+l.col2.y*c),t.extents.x=.5*(d-a),t.extents.y=.5*(_-u))}},Box2D.postDefs.push(function(){Box2D.Collision.Shapes.b2PolygonShape.s_mat=new c}),s.b2Shape=function(){},s.prototype.Copy=function(){return null},s.prototype.Set=function(t){this.m_radius=t.m_radius},s.prototype.GetType=function(){return this.m_type},s.prototype.TestPoint=function(){return!1},s.prototype.RayCast=function(){return!1},s.prototype.ComputeAABB=function(){},s.prototype.ComputeMass=function(){},s.prototype.ComputeSubmergedArea=function(){return 0},s.TestOverlap=function(t,e,i,n){var r=new d;return r.proxyA=new p,r.proxyA.Set(t),r.proxyB=new p,r.proxyB.Set(i),r.transformA=e,r.transformB=n,r.useRadii=!0,t=new f,t.count=0,e=new _,u.Distance(e,t,r),e.distance<10*Number.MIN_VALUE},s.prototype.b2Shape=function(){this.m_type=s.e_unknownShape,this.m_radius=t.b2_linearSlop},Box2D.postDefs.push(function(){Box2D.Collision.Shapes.b2Shape.e_unknownShape=-1,Box2D.Collision.Shapes.b2Shape.e_circleShape=0,Box2D.Collision.Shapes.b2Shape.e_polygonShape=1,Box2D.Collision.Shapes.b2Shape.e_edgeShape=2,Box2D.Collision.Shapes.b2Shape.e_shapeTypeCount=3,Box2D.Collision.Shapes.b2Shape.e_hitCollide=1,Box2D.Collision.Shapes.b2Shape.e_missCollide=0,Box2D.Collision.Shapes.b2Shape.e_startsInsideCollide=-1})}(),function(){var t=Box2D.Common.b2Color,e=Box2D.Common.b2Settings,i=Box2D.Common.Math.b2Math;t.b2Color=function(){this._b=this._g=this._r=0},t.prototype.b2Color=function(t,e,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),this._r=Box2D.parseUInt(255*i.Clamp(t,0,1)),this._g=Box2D.parseUInt(255*i.Clamp(e,0,1)),this._b=Box2D.parseUInt(255*i.Clamp(n,0,1))},t.prototype.Set=function(t,e,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),this._r=Box2D.parseUInt(255*i.Clamp(t,0,1)),this._g=Box2D.parseUInt(255*i.Clamp(e,0,1)),this._b=Box2D.parseUInt(255*i.Clamp(n,0,1))},Object.defineProperty(t.prototype,"r",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0),this._r=Box2D.parseUInt(255*i.Clamp(t,0,1))}}),Object.defineProperty(t.prototype,"g",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0),this._g=Box2D.parseUInt(255*i.Clamp(t,0,1))}}),Object.defineProperty(t.prototype,"b",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0),this._b=Box2D.parseUInt(255*i.Clamp(t,0,1))}}),Object.defineProperty(t.prototype,"color",{enumerable:!1,configurable:!0,get:function(){return this._r<<16|this._g<<8|this._b}}),e.b2Settings=function(){},e.b2MixFriction=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),Math.sqrt(t*e)},e.b2MixRestitution=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),t>e?t:e},e.b2Assert=function(t){if(!t)throw"Assertion Failed"},Box2D.postDefs.push(function(){Box2D.Common.b2Settings.VERSION="2.1alpha",Box2D.Common.b2Settings.USHRT_MAX=65535,Box2D.Common.b2Settings.b2_pi=Math.PI,Box2D.Common.b2Settings.b2_maxManifoldPoints=2,Box2D.Common.b2Settings.b2_aabbExtension=.1,Box2D.Common.b2Settings.b2_aabbMultiplier=2,Box2D.Common.b2Settings.b2_polygonRadius=2*e.b2_linearSlop,Box2D.Common.b2Settings.b2_linearSlop=.005,Box2D.Common.b2Settings.b2_angularSlop=2/180*e.b2_pi,Box2D.Common.b2Settings.b2_toiSlop=8*e.b2_linearSlop,Box2D.Common.b2Settings.b2_maxTOIContactsPerIsland=32,Box2D.Common.b2Settings.b2_maxTOIJointsPerIsland=32,Box2D.Common.b2Settings.b2_velocityThreshold=1,Box2D.Common.b2Settings.b2_maxLinearCorrection=.2,Box2D.Common.b2Settings.b2_maxAngularCorrection=8/180*e.b2_pi,Box2D.Common.b2Settings.b2_maxTranslation=2,Box2D.Common.b2Settings.b2_maxTranslationSquared=e.b2_maxTranslation*e.b2_maxTranslation,Box2D.Common.b2Settings.b2_maxRotation=.5*e.b2_pi,Box2D.Common.b2Settings.b2_maxRotationSquared=e.b2_maxRotation*e.b2_maxRotation,Box2D.Common.b2Settings.b2_contactBaumgarte=.2,Box2D.Common.b2Settings.b2_timeToSleep=.5,Box2D.Common.b2Settings.b2_linearSleepTolerance=.01,Box2D.Common.b2Settings.b2_angularSleepTolerance=2/180*e.b2_pi})}(),function(){var t=Box2D.Common.Math.b2Mat22,e=Box2D.Common.Math.b2Mat33,i=Box2D.Common.Math.b2Math,n=Box2D.Common.Math.b2Sweep,r=Box2D.Common.Math.b2Transform,o=Box2D.Common.Math.b2Vec2,s=Box2D.Common.Math.b2Vec3;t.b2Mat22=function(){this.col1=new o,this.col2=new o},t.prototype.b2Mat22=function(){this.SetIdentity()},t.FromAngle=function(e){void 0===e&&(e=0);var i=new t;return i.Set(e),i},t.FromVV=function(e,i){var n=new t;return n.SetVV(e,i),n},t.prototype.Set=function(t){void 0===t&&(t=0);var e=Math.cos(t);t=Math.sin(t),this.col1.x=e,this.col2.x=-t,this.col1.y=t,this.col2.y=e},t.prototype.SetVV=function(t,e){this.col1.SetV(t),this.col2.SetV(e)},t.prototype.Copy=function(){var e=new t;return e.SetM(this),e},t.prototype.SetM=function(t){this.col1.SetV(t.col1),this.col2.SetV(t.col2)},t.prototype.AddM=function(t){this.col1.x+=t.col1.x,this.col1.y+=t.col1.y,this.col2.x+=t.col2.x,this.col2.y+=t.col2.y},t.prototype.SetIdentity=function(){this.col1.x=1,this.col2.x=0,this.col1.y=0,this.col2.y=1},t.prototype.SetZero=function(){this.col1.x=0,this.col2.x=0,this.col1.y=0,this.col2.y=0},t.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)},t.prototype.GetInverse=function(t){var e=this.col1.x,i=this.col2.x,n=this.col1.y,r=this.col2.y,o=e*r-i*n;return 0!=o&&(o=1/o),t.col1.x=o*r,t.col2.x=-o*i,t.col1.y=-o*n,t.col2.y=o*e,t},t.prototype.Solve=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0);var n=this.col1.x,r=this.col2.x,o=this.col1.y,s=this.col2.y,c=n*s-r*o;return 0!=c&&(c=1/c),t.x=c*(s*e-r*i),t.y=c*(n*i-o*e),t},t.prototype.Abs=function(){this.col1.Abs(),this.col2.Abs()},e.b2Mat33=function(){this.col1=new s,this.col2=new s,this.col3=new s},e.prototype.b2Mat33=function(t,e,i){void 0===t&&(t=null),void 0===e&&(e=null),void 0===i&&(i=null),t||e||i?(this.col1.SetV(t),this.col2.SetV(e),this.col3.SetV(i)):(this.col1.SetZero(),this.col2.SetZero(),this.col3.SetZero())},e.prototype.SetVVV=function(t,e,i){this.col1.SetV(t),this.col2.SetV(e),this.col3.SetV(i)},e.prototype.Copy=function(){return new e(this.col1,this.col2,this.col3)},e.prototype.SetM=function(t){this.col1.SetV(t.col1),this.col2.SetV(t.col2),this.col3.SetV(t.col3)},e.prototype.AddM=function(t){this.col1.x+=t.col1.x,this.col1.y+=t.col1.y,this.col1.z+=t.col1.z,this.col2.x+=t.col2.x,this.col2.y+=t.col2.y,this.col2.z+=t.col2.z,this.col3.x+=t.col3.x,this.col3.y+=t.col3.y,this.col3.z+=t.col3.z},e.prototype.SetIdentity=function(){this.col1.x=1,this.col2.x=0,this.col3.x=0,this.col1.y=0,this.col2.y=1,this.col3.y=0,this.col1.z=0,this.col2.z=0,this.col3.z=1},e.prototype.SetZero=function(){this.col1.x=0,this.col2.x=0,this.col3.x=0,this.col1.y=0,this.col2.y=0,this.col3.y=0,this.col1.z=0,this.col2.z=0,this.col3.z=0},e.prototype.Solve22=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0);var n=this.col1.x,r=this.col2.x,o=this.col1.y,s=this.col2.y,c=n*s-r*o;return 0!=c&&(c=1/c),t.x=c*(s*e-r*i),t.y=c*(n*i-o*e),t},e.prototype.Solve33=function(t,e,i,n){void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0);var r=this.col1.x,o=this.col1.y,s=this.col1.z,c=this.col2.x,a=this.col2.y,l=this.col2.z,h=this.col3.x,u=this.col3.y,d=this.col3.z,_=r*(a*d-l*u)+o*(l*h-c*d)+s*(c*u-a*h);return 0!=_&&(_=1/_),t.x=_*(e*(a*d-l*u)+i*(l*h-c*d)+n*(c*u-a*h)),t.y=_*(r*(i*d-n*u)+o*(n*h-e*d)+s*(e*u-i*h)),t.z=_*(r*(a*n-l*i)+o*(l*e-c*n)+s*(c*i-a*e)),t},i.b2Math=function(){},i.IsValid=function(t){return void 0===t&&(t=0),isFinite(t)},i.Dot=function(t,e){return t.x*e.x+t.y*e.y},i.CrossVV=function(t,e){return t.x*e.y-t.y*e.x},i.CrossVF=function(t,e){return void 0===e&&(e=0),new o(e*t.y,-e*t.x)},i.CrossFV=function(t,e){return void 0===t&&(t=0),new o(-t*e.y,t*e.x)},i.MulMV=function(t,e){return new o(t.col1.x*e.x+t.col2.x*e.y,t.col1.y*e.x+t.col2.y*e.y)},i.MulTMV=function(t,e){return new o(i.Dot(e,t.col1),i.Dot(e,t.col2))},i.MulX=function(t,e){var n=i.MulMV(t.R,e);return n.x+=t.position.x,n.y+=t.position.y,n},i.MulXT=function(t,e){var n=i.SubtractVV(e,t.position),r=n.x*t.R.col1.x+n.y*t.R.col1.y;return n.y=n.x*t.R.col2.x+n.y*t.R.col2.y,n.x=r,n},i.AddVV=function(t,e){return new o(t.x+e.x,t.y+e.y)},i.SubtractVV=function(t,e){return new o(t.x-e.x,t.y-e.y)},i.Distance=function(t,e){var i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)},i.DistanceSquared=function(t,e){var i=t.x-e.x,n=t.y-e.y;return i*i+n*n},i.MulFV=function(t,e){return void 0===t&&(t=0),new o(t*e.x,t*e.y)},i.AddMM=function(e,n){return t.FromVV(i.AddVV(e.col1,n.col1),i.AddVV(e.col2,n.col2))},i.MulMM=function(e,n){return t.FromVV(i.MulMV(e,n.col1),i.MulMV(e,n.col2))},i.MulTMM=function(e,n){var r=new o(i.Dot(e.col1,n.col1),i.Dot(e.col2,n.col1)),s=new o(i.Dot(e.col1,n.col2),i.Dot(e.col2,n.col2));return t.FromVV(r,s)},i.Abs=function(t){return void 0===t&&(t=0),t>0?t:-t},i.AbsV=function(t){return new o(i.Abs(t.x),i.Abs(t.y))},i.AbsM=function(e){return t.FromVV(i.AbsV(e.col1),i.AbsV(e.col2))},i.Min=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),e>t?t:e},i.MinV=function(t,e){return new o(i.Min(t.x,e.x),i.Min(t.y,e.y))},i.Max=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),t>e?t:e},i.MaxV=function(t,e){return new o(i.Max(t.x,e.x),i.Max(t.y,e.y))},i.Clamp=function(t,e,i){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),e>t?e:t>i?i:t},i.ClampV=function(t,e,n){return i.MaxV(e,i.MinV(t,n))},i.Swap=function(t,e){var i=t[0];t[0]=e[0],e[0]=i},i.Random=function(){return 2*Math.random()-1},i.RandomRange=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0);var i=Math.random();return(e-t)*i+t},i.NextPowerOfTwo=function(t){return void 0===t&&(t=0),t|=t>>1&2147483647,t|=t>>2&1073741823,t|=t>>4&268435455,t|=t>>8&16777215,(t|t>>16&65535)+1},i.IsPowerOfTwo=function(t){return void 0===t&&(t=0),t>0&&0==(t&t-1)},Box2D.postDefs.push(function(){Box2D.Common.Math.b2Math.b2Vec2_zero=new o(0,0),Box2D.Common.Math.b2Math.b2Mat22_identity=t.FromVV(new o(1,0),new o(0,1)),Box2D.Common.Math.b2Math.b2Transform_identity=new r(i.b2Vec2_zero,i.b2Mat22_identity)}),n.b2Sweep=function(){this.localCenter=new o,this.c0=new o,this.c=new o},n.prototype.Set=function(t){this.localCenter.SetV(t.localCenter),this.c0.SetV(t.c0),this.c.SetV(t.c),this.a0=t.a0,this.a=t.a,this.t0=t.t0},n.prototype.Copy=function(){var t=new n;return t.localCenter.SetV(this.localCenter),t.c0.SetV(this.c0),t.c.SetV(this.c),t.a0=this.a0,t.a=this.a,t.t0=this.t0,t},n.prototype.GetTransform=function(t,e){void 0===e&&(e=0),t.position.x=(1-e)*this.c0.x+e*this.c.x,t.position.y=(1-e)*this.c0.y+e*this.c.y,t.R.Set((1-e)*this.a0+e*this.a);var i=t.R;t.position.x-=i.col1.x*this.localCenter.x+i.col2.x*this.localCenter.y,t.position.y-=i.col1.y*this.localCenter.x+i.col2.y*this.localCenter.y},n.prototype.Advance=function(t){if(void 0===t&&(t=0),this.t0<t&&1-this.t0>Number.MIN_VALUE){var e=(t-this.t0)/(1-this.t0);this.c0.x=(1-e)*this.c0.x+e*this.c.x,this.c0.y=(1-e)*this.c0.y+e*this.c.y,this.a0=(1-e)*this.a0+e*this.a,this.t0=t}},r.b2Transform=function(){this.position=new o,this.R=new t},r.prototype.b2Transform=function(t,e){void 0===t&&(t=null),void 0===e&&(e=null),t&&(this.position.SetV(t),this.R.SetM(e))},r.prototype.Initialize=function(t,e){this.position.SetV(t),this.R.SetM(e)},r.prototype.SetIdentity=function(){this.position.SetZero(),this.R.SetIdentity()},r.prototype.Set=function(t){this.position.SetV(t.position),this.R.SetM(t.R)},r.prototype.GetAngle=function(){return Math.atan2(this.R.col1.y,this.R.col1.x)},o.b2Vec2=function(){},o.prototype.b2Vec2=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e},o.prototype.SetZero=function(){this.y=this.x=0},o.prototype.Set=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e},o.prototype.SetV=function(t){this.x=t.x,this.y=t.y},o.prototype.GetNegative=function(){return new o(-this.x,-this.y)},o.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y},o.Make=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),new o(t,e)},o.prototype.Copy=function(){return new o(this.x,this.y)},o.prototype.Add=function(t){this.x+=t.x,this.y+=t.y},o.prototype.Subtract=function(t){this.x-=t.x,this.y-=t.y},o.prototype.Multiply=function(t){void 0===t&&(t=0),this.x*=t,this.y*=t},o.prototype.MulM=function(t){var e=this.x;this.x=t.col1.x*e+t.col2.x*this.y,this.y=t.col1.y*e+t.col2.y*this.y},o.prototype.MulTM=function(t){var e=i.Dot(this,t.col1);this.y=i.Dot(this,t.col2),this.x=e},o.prototype.CrossVF=function(t){void 0===t&&(t=0);var e=this.x;this.x=t*this.y,this.y=-t*e},o.prototype.CrossFV=function(t){void 0===t&&(t=0);var e=this.x;this.x=-t*this.y,this.y=t*e},o.prototype.MinV=function(t){this.x=this.x<t.x?this.x:t.x,this.y=this.y<t.y?this.y:t.y},o.prototype.MaxV=function(t){this.x=this.x>t.x?this.x:t.x,this.y=this.y>t.y?this.y:t.y},o.prototype.Abs=function(){0>this.x&&(this.x=-this.x),0>this.y&&(this.y=-this.y)},o.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},o.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y},o.prototype.Normalize=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y);if(t<Number.MIN_VALUE)return 0;var e=1/t;return this.x*=e,this.y*=e,t},o.prototype.IsValid=function(){return i.IsValid(this.x)&&i.IsValid(this.y)},s.b2Vec3=function(){},s.prototype.b2Vec3=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this.x=t,this.y=e,this.z=i},s.prototype.SetZero=function(){this.x=this.y=this.z=0},s.prototype.Set=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this.x=t,this.y=e,this.z=i},s.prototype.SetV=function(t){this.x=t.x,this.y=t.y,this.z=t.z},s.prototype.GetNegative=function(){return new s(-this.x,-this.y,-this.z)},s.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y,this.z=-this.z},s.prototype.Copy=function(){return new s(this.x,this.y,this.z)},s.prototype.Add=function(t){this.x+=t.x,this.y+=t.y,this.z+=t.z},s.prototype.Subtract=function(t){this.x-=t.x,this.y-=t.y,this.z-=t.z},s.prototype.Multiply=function(t){void 0===t&&(t=0),this.x*=t,this.y*=t,this.z*=t}}(),function(){var t=Box2D.Common.Math.b2Math,e=Box2D.Common.Math.b2Sweep,i=Box2D.Common.Math.b2Transform,n=Box2D.Common.Math.b2Vec2,r=Box2D.Common.b2Color,o=Box2D.Common.b2Settings,s=Box2D.Collision.b2AABB,c=Box2D.Collision.b2ContactPoint,a=Box2D.Collision.b2DynamicTreeBroadPhase,l=Box2D.Collision.b2RayCastInput,h=Box2D.Collision.b2RayCastOutput,u=Box2D.Collision.Shapes.b2CircleShape,d=Box2D.Collision.Shapes.b2EdgeShape,_=Box2D.Collision.Shapes.b2MassData,p=Box2D.Collision.Shapes.b2PolygonShape,f=Box2D.Collision.Shapes.b2Shape,m=Box2D.Dynamics.b2Body,g=Box2D.Dynamics.b2BodyDef,y=Box2D.Dynamics.b2ContactFilter,T=Box2D.Dynamics.b2ContactImpulse,S=Box2D.Dynamics.b2ContactListener,C=Box2D.Dynamics.b2ContactManager,v=Box2D.Dynamics.b2DebugDraw,x=Box2D.Dynamics.b2DestructionListener,E=Box2D.Dynamics.b2FilterData,b=Box2D.Dynamics.b2Fixture,A=Box2D.Dynamics.b2FixtureDef,R=Box2D.Dynamics.b2Island,P=Box2D.Dynamics.b2TimeStep,I=Box2D.Dynamics.b2World,w=Box2D.Dynamics.Contacts.b2Contact,L=Box2D.Dynamics.Contacts.b2ContactFactory,D=Box2D.Dynamics.Contacts.b2ContactSolver,O=Box2D.Dynamics.Joints.b2Joint,N=Box2D.Dynamics.Joints.b2PulleyJoint;m.b2Body=function(){this.m_xf=new i,this.m_sweep=new e,this.m_linearVelocity=new n,this.m_force=new n},m.prototype.connectEdges=function(e,i,n){void 0===n&&(n=0);var r=Math.atan2(i.GetDirectionVector().y,i.GetDirectionVector().x);n=Math.tan(.5*(r-n)),n=t.MulFV(n,i.GetDirectionVector()),n=t.SubtractVV(n,i.GetNormalVector()),n=t.MulFV(o.b2_toiSlop,n),n=t.AddVV(n,i.GetVertex1());var s=t.AddVV(e.GetDirectionVector(),i.GetDirectionVector());s.Normalize();var c=0<t.Dot(e.GetDirectionVector(),i.GetNormalVector());return e.SetNextEdge(i,n,s,c),i.SetPrevEdge(e,n,s,c),r},m.prototype.CreateFixture=function(t){if(1==this.m_world.IsLocked())return null;var e=new b;return e.Create(this,this.m_xf,t),this.m_flags&m.e_activeFlag&&e.CreateProxy(this.m_world.m_contactManager.m_broadPhase,this.m_xf),e.m_next=this.m_fixtureList,this.m_fixtureList=e,++this.m_fixtureCount,e.m_body=this,0<e.m_density&&this.ResetMassData(),this.m_world.m_flags|=I.e_newFixture,e},m.prototype.CreateFixture2=function(t,e){void 0===e&&(e=0);var i=new A;return i.shape=t,i.density=e,this.CreateFixture(i)},m.prototype.DestroyFixture=function(t){if(1!=this.m_world.IsLocked()){for(var e=this.m_fixtureList,i=null;null!=e;){if(e==t){i?i.m_next=t.m_next:this.m_fixtureList=t.m_next;break}i=e,e=e.m_next}for(e=this.m_contactList;e;){var i=e.contact,e=e.next,n=i.GetFixtureA(),r=i.GetFixtureB();t!=n&&t!=r||this.m_world.m_contactManager.Destroy(i)}this.m_flags&m.e_activeFlag&&t.DestroyProxy(this.m_world.m_contactManager.m_broadPhase),t.Destroy(),t.m_body=null,t.m_next=null,--this.m_fixtureCount,this.ResetMassData()}},m.prototype.SetPositionAndAngle=function(t,e){void 0===e&&(e=0);var i;if(1!=this.m_world.IsLocked()){this.m_xf.R.Set(e),this.m_xf.position.SetV(t),i=this.m_xf.R;var n=this.m_sweep.localCenter;for(this.m_sweep.c.x=i.col1.x*n.x+i.col2.x*n.y,this.m_sweep.c.y=i.col1.y*n.x+i.col2.y*n.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_sweep.a0=this.m_sweep.a=e,n=this.m_world.m_contactManager.m_broadPhase,i=this.m_fixtureList;i;i=i.m_next)i.Synchronize(n,this.m_xf,this.m_xf);this.m_world.m_contactManager.FindNewContacts()}},m.prototype.SetTransform=function(t){this.SetPositionAndAngle(t.position,t.GetAngle())},m.prototype.GetTransform=function(){return this.m_xf},m.prototype.GetPosition=function(){return this.m_xf.position},m.prototype.SetPosition=function(t){this.SetPositionAndAngle(t,this.GetAngle())},m.prototype.GetAngle=function(){return this.m_sweep.a},m.prototype.SetAngle=function(t){void 0===t&&(t=0),this.SetPositionAndAngle(this.GetPosition(),t)},m.prototype.GetWorldCenter=function(){return this.m_sweep.c},m.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter},m.prototype.SetLinearVelocity=function(t){this.m_type!=m.b2_staticBody&&this.m_linearVelocity.SetV(t)},m.prototype.GetLinearVelocity=function(){return this.m_linearVelocity},m.prototype.SetAngularVelocity=function(t){void 0===t&&(t=0),this.m_type!=m.b2_staticBody&&(this.m_angularVelocity=t)},m.prototype.GetAngularVelocity=function(){return this.m_angularVelocity},m.prototype.GetDefinition=function(){var t=new g;return t.type=this.GetType(),t.allowSleep=(this.m_flags&m.e_allowSleepFlag)==m.e_allowSleepFlag,t.angle=this.GetAngle(),t.angularDamping=this.m_angularDamping,t.angularVelocity=this.m_angularVelocity,t.fixedRotation=(this.m_flags&m.e_fixedRotationFlag)==m.e_fixedRotationFlag,t.bullet=(this.m_flags&m.e_bulletFlag)==m.e_bulletFlag,t.awake=(this.m_flags&m.e_awakeFlag)==m.e_awakeFlag,t.linearDamping=this.m_linearDamping,t.linearVelocity.SetV(this.GetLinearVelocity()),t.position=this.GetPosition(),t.userData=this.GetUserData(),t},m.prototype.ApplyForce=function(t,e){this.m_type==m.b2_dynamicBody&&(0==this.IsAwake()&&this.SetAwake(!0),this.m_force.x+=t.x,this.m_force.y+=t.y,this.m_torque+=(e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x)},m.prototype.ApplyTorque=function(t){void 0===t&&(t=0),this.m_type==m.b2_dynamicBody&&(0==this.IsAwake()&&this.SetAwake(!0),this.m_torque+=t)},m.prototype.ApplyImpulse=function(t,e){this.m_type==m.b2_dynamicBody&&(0==this.IsAwake()&&this.SetAwake(!0),this.m_linearVelocity.x+=this.m_invMass*t.x,this.m_linearVelocity.y+=this.m_invMass*t.y,this.m_angularVelocity+=this.m_invI*((e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x))},m.prototype.Split=function(e){for(var i,n=this.GetLinearVelocity().Copy(),r=this.GetAngularVelocity(),o=this.GetWorldCenter(),s=this.m_world.CreateBody(this.GetDefinition()),c=this.m_fixtureList;c;)if(e(c)){var a=c.m_next;i?i.m_next=a:this.m_fixtureList=a,this.m_fixtureCount--,c.m_next=s.m_fixtureList,s.m_fixtureList=c,s.m_fixtureCount++,c.m_body=s,c=a}else i=c,c=c.m_next;return this.ResetMassData(),s.ResetMassData(),i=this.GetWorldCenter(),e=s.GetWorldCenter(),i=t.AddVV(n,t.CrossFV(r,t.SubtractVV(i,o))),n=t.AddVV(n,t.CrossFV(r,t.SubtractVV(e,o))),this.SetLinearVelocity(i),s.SetLinearVelocity(n),this.SetAngularVelocity(r),s.SetAngularVelocity(r),this.SynchronizeFixtures(),s.SynchronizeFixtures(),s},m.prototype.Merge=function(t){var e;for(e=t.m_fixtureList;e;){var i=e.m_next;t.m_fixtureCount--,e.m_next=this.m_fixtureList,this.m_fixtureList=e,this.m_fixtureCount++,e.m_body=r,e=i}n.m_fixtureCount=0;var n=this,r=t;n.GetWorldCenter(),r.GetWorldCenter(),n.GetLinearVelocity().Copy(),r.GetLinearVelocity().Copy(),n.GetAngularVelocity(),r.GetAngularVelocity(),n.ResetMassData(),this.SynchronizeFixtures()},m.prototype.GetMass=function(){return this.m_mass},m.prototype.GetInertia=function(){return this.m_I},m.prototype.GetMassData=function(t){t.mass=this.m_mass,t.I=this.m_I,t.center.SetV(this.m_sweep.localCenter)},m.prototype.SetMassData=function(e){if(o.b2Assert(0==this.m_world.IsLocked()),1!=this.m_world.IsLocked()&&this.m_type==m.b2_dynamicBody){this.m_invI=this.m_I=this.m_invMass=0,this.m_mass=e.mass,0>=this.m_mass&&(this.m_mass=1),this.m_invMass=1/this.m_mass,0<e.I&&0==(this.m_flags&m.e_fixedRotationFlag)&&(this.m_I=e.I-this.m_mass*(e.center.x*e.center.x+e.center.y*e.center.y),this.m_invI=1/this.m_I);var i=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(e.center),this.m_sweep.c0.SetV(t.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-i.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-i.x)}},m.prototype.ResetMassData=function(){if(this.m_invI=this.m_I=this.m_invMass=this.m_mass=0,this.m_sweep.localCenter.SetZero(),this.m_type!=m.b2_staticBody&&this.m_type!=m.b2_kinematicBody){for(var e=n.Make(0,0),i=this.m_fixtureList;i;i=i.m_next)if(0!=i.m_density){var r=i.GetMassData();this.m_mass+=r.mass,e.x+=r.center.x*r.mass,e.y+=r.center.y*r.mass,this.m_I+=r.I}0<this.m_mass?(this.m_invMass=1/this.m_mass,e.x*=this.m_invMass,e.y*=this.m_invMass):this.m_invMass=this.m_mass=1,0<this.m_I&&0==(this.m_flags&m.e_fixedRotationFlag)?(this.m_I-=this.m_mass*(e.x*e.x+e.y*e.y),this.m_I*=this.m_inertiaScale,o.b2Assert(0<this.m_I),this.m_invI=1/this.m_I):this.m_invI=this.m_I=0,i=this.m_sweep.c.Copy(),this.m_sweep.localCenter.SetV(e),this.m_sweep.c0.SetV(t.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-i.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-i.x)}},m.prototype.GetWorldPoint=function(t){var e=this.m_xf.R;return t=new n(e.col1.x*t.x+e.col2.x*t.y,e.col1.y*t.x+e.col2.y*t.y),t.x+=this.m_xf.position.x,t.y+=this.m_xf.position.y,t},m.prototype.GetWorldVector=function(e){return t.MulMV(this.m_xf.R,e)},m.prototype.GetLocalPoint=function(e){return t.MulXT(this.m_xf,e)},m.prototype.GetLocalVector=function(e){return t.MulTMV(this.m_xf.R,e)},m.prototype.GetLinearVelocityFromWorldPoint=function(t){return new n(this.m_linearVelocity.x-this.m_angularVelocity*(t.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(t.x-this.m_sweep.c.x))},m.prototype.GetLinearVelocityFromLocalPoint=function(t){var e=this.m_xf.R;return t=new n(e.col1.x*t.x+e.col2.x*t.y,e.col1.y*t.x+e.col2.y*t.y),t.x+=this.m_xf.position.x,t.y+=this.m_xf.position.y,new n(this.m_linearVelocity.x-this.m_angularVelocity*(t.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(t.x-this.m_sweep.c.x))},m.prototype.GetLinearDamping=function(){return this.m_linearDamping},m.prototype.SetLinearDamping=function(t){void 0===t&&(t=0),this.m_linearDamping=t},m.prototype.GetAngularDamping=function(){return this.m_angularDamping},m.prototype.SetAngularDamping=function(t){void 0===t&&(t=0),this.m_angularDamping=t},m.prototype.SetType=function(t){if(void 0===t&&(t=0),this.m_type!=t)for(this.m_type=t,this.ResetMassData(),this.m_type==m.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0,t=this.m_contactList;t;t=t.next)t.contact.FlagForFiltering()},m.prototype.GetType=function(){return this.m_type},m.prototype.SetBullet=function(t){this.m_flags=t?this.m_flags|m.e_bulletFlag:this.m_flags&~m.e_bulletFlag},m.prototype.IsBullet=function(){return(this.m_flags&m.e_bulletFlag)==m.e_bulletFlag},m.prototype.SetSleepingAllowed=function(t){t?this.m_flags|=m.e_allowSleepFlag:(this.m_flags&=~m.e_allowSleepFlag,this.SetAwake(!0))},m.prototype.SetAwake=function(t){t?(this.m_flags|=m.e_awakeFlag,this.m_sleepTime=0):(this.m_flags&=~m.e_awakeFlag,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)},m.prototype.IsAwake=function(){return(this.m_flags&m.e_awakeFlag)==m.e_awakeFlag},m.prototype.SetFixedRotation=function(t){this.m_flags=t?this.m_flags|m.e_fixedRotationFlag:this.m_flags&~m.e_fixedRotationFlag,this.ResetMassData()},m.prototype.IsFixedRotation=function(){return(this.m_flags&m.e_fixedRotationFlag)==m.e_fixedRotationFlag},m.prototype.SetActive=function(t){if(t!=this.IsActive()){var e;if(t)for(this.m_flags|=m.e_activeFlag,t=this.m_world.m_contactManager.m_broadPhase,e=this.m_fixtureList;e;e=e.m_next)e.CreateProxy(t,this.m_xf);else{for(this.m_flags&=~m.e_activeFlag,t=this.m_world.m_contactManager.m_broadPhase,e=this.m_fixtureList;e;e=e.m_next)e.DestroyProxy(t);for(t=this.m_contactList;t;)e=t,t=t.next,this.m_world.m_contactManager.Destroy(e.contact);this.m_contactList=null}}},m.prototype.IsActive=function(){return(this.m_flags&m.e_activeFlag)==m.e_activeFlag},m.prototype.IsSleepingAllowed=function(){return(this.m_flags&m.e_allowSleepFlag)==m.e_allowSleepFlag},m.prototype.GetFixtureList=function(){return this.m_fixtureList},m.prototype.GetJointList=function(){return this.m_jointList},m.prototype.GetControllerList=function(){return this.m_controllerList},m.prototype.GetContactList=function(){return this.m_contactList},m.prototype.GetNext=function(){return this.m_next},m.prototype.GetUserData=function(){return this.m_userData},m.prototype.SetUserData=function(t){this.m_userData=t},m.prototype.GetWorld=function(){return this.m_world},m.prototype.b2Body=function(t,e){this.m_flags=0,t.bullet&&(this.m_flags|=m.e_bulletFlag),t.fixedRotation&&(this.m_flags|=m.e_fixedRotationFlag),t.allowSleep&&(this.m_flags|=m.e_allowSleepFlag),t.awake&&(this.m_flags|=m.e_awakeFlag),t.active&&(this.m_flags|=m.e_activeFlag),this.m_world=e,this.m_xf.position.SetV(t.position),this.m_xf.R.Set(t.angle),this.m_sweep.localCenter.SetZero(),this.m_sweep.t0=1,this.m_sweep.a0=this.m_sweep.a=t.angle;var i=this.m_xf.R,n=this.m_sweep.localCenter;this.m_sweep.c.x=i.col1.x*n.x+i.col2.x*n.y,this.m_sweep.c.y=i.col1.y*n.x+i.col2.y*n.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_contactList=this.m_controllerList=this.m_jointList=null,this.m_controllerCount=0,this.m_next=this.m_prev=null,this.m_linearVelocity.SetV(t.linearVelocity),this.m_angularVelocity=t.angularVelocity,this.m_linearDamping=t.linearDamping,this.m_angularDamping=t.angularDamping,this.m_force.Set(0,0),this.m_sleepTime=this.m_torque=0,this.m_type=t.type,this.m_invMass=this.m_mass=this.m_type==m.b2_dynamicBody?1:0,this.m_invI=this.m_I=0,this.m_inertiaScale=t.inertiaScale,this.m_userData=t.userData,this.m_fixtureList=null,this.m_fixtureCount=0},m.prototype.SynchronizeFixtures=function(){var t=m.s_xf1;t.R.Set(this.m_sweep.a0);var e=t.R,i=this.m_sweep.localCenter;for(t.position.x=this.m_sweep.c0.x-(e.col1.x*i.x+e.col2.x*i.y),t.position.y=this.m_sweep.c0.y-(e.col1.y*i.x+e.col2.y*i.y),i=this.m_world.m_contactManager.m_broadPhase,e=this.m_fixtureList;e;e=e.m_next)e.Synchronize(i,t,this.m_xf)},m.prototype.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var t=this.m_xf.R,e=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(t.col1.x*e.x+t.col2.x*e.y),this.m_xf.position.y=this.m_sweep.c.y-(t.col1.y*e.x+t.col2.y*e.y)},m.prototype.ShouldCollide=function(t){if(this.m_type!=m.b2_dynamicBody&&t.m_type!=m.b2_dynamicBody)return!1;for(var e=this.m_jointList;e;e=e.next)if(e.other==t&&0==e.joint.m_collideConnected)return!1;return!0},m.prototype.Advance=function(t){void 0===t&&(t=0),this.m_sweep.Advance(t),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.SynchronizeTransform()},Box2D.postDefs.push(function(){Box2D.Dynamics.b2Body.s_xf1=new i,Box2D.Dynamics.b2Body.e_islandFlag=1,Box2D.Dynamics.b2Body.e_awakeFlag=2,Box2D.Dynamics.b2Body.e_allowSleepFlag=4,Box2D.Dynamics.b2Body.e_bulletFlag=8,Box2D.Dynamics.b2Body.e_fixedRotationFlag=16,Box2D.Dynamics.b2Body.e_activeFlag=32,Box2D.Dynamics.b2Body.b2_staticBody=0,Box2D.Dynamics.b2Body.b2_kinematicBody=1,Box2D.Dynamics.b2Body.b2_dynamicBody=2}),g.b2BodyDef=function(){this.position=new n,this.linearVelocity=new n},g.prototype.b2BodyDef=function(){this.userData=null,this.position.Set(0,0),this.angle=0,this.linearVelocity.Set(0,0),this.angularDamping=this.linearDamping=this.angularVelocity=0,this.awake=this.allowSleep=!0,this.bullet=this.fixedRotation=!1,this.type=m.b2_staticBody,this.active=!0,this.inertiaScale=1},y.b2ContactFilter=function(){},y.prototype.ShouldCollide=function(t,e){var i=t.GetFilterData(),n=e.GetFilterData();return i.groupIndex==n.groupIndex&&0!=i.groupIndex?0<i.groupIndex:0!=(i.maskBits&n.categoryBits)&&0!=(i.categoryBits&n.maskBits)},y.prototype.RayCollide=function(t,e){return t?this.ShouldCollide(t instanceof b?t:null,e):!0},Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactFilter.b2_defaultFilter=new y}),T.b2ContactImpulse=function(){this.normalImpulses=new Vector_a2j_Number(o.b2_maxManifoldPoints),this.tangentImpulses=new Vector_a2j_Number(o.b2_maxManifoldPoints)},S.b2ContactListener=function(){},S.prototype.BeginContact=function(){},S.prototype.EndContact=function(){},S.prototype.PreSolve=function(){},S.prototype.PostSolve=function(){},Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactListener.b2_defaultListener=new S}),C.b2ContactManager=function(){},C.prototype.b2ContactManager=function(){this.m_world=null,this.m_contactCount=0,this.m_contactFilter=y.b2_defaultFilter,this.m_contactListener=S.b2_defaultListener,this.m_contactFactory=new L(this.m_allocator),this.m_broadPhase=new a},C.prototype.AddPair=function(t,e){var i=t instanceof b?t:null,n=e instanceof b?e:null,r=i.GetBody(),o=n.GetBody();if(r!=o){for(var s=o.GetContactList();s;){if(s.other==r){var c=s.contact.GetFixtureA(),a=s.contact.GetFixtureB();if(c==i&&a==n||c==n&&a==i)return}s=s.next}0!=o.ShouldCollide(r)&&0!=this.m_contactFilter.ShouldCollide(i,n)&&(s=this.m_contactFactory.Create(i,n),i=s.GetFixtureA(),n=s.GetFixtureB(),r=i.m_body,o=n.m_body,s.m_prev=null,s.m_next=this.m_world.m_contactList,null!=this.m_world.m_contactList&&(this.m_world.m_contactList.m_prev=s),this.m_world.m_contactList=s,s.m_nodeA.contact=s,s.m_nodeA.other=o,s.m_nodeA.prev=null,s.m_nodeA.next=r.m_contactList,null!=r.m_contactList&&(r.m_contactList.prev=s.m_nodeA),r.m_contactList=s.m_nodeA,s.m_nodeB.contact=s,s.m_nodeB.other=r,s.m_nodeB.prev=null,s.m_nodeB.next=o.m_contactList,null!=o.m_contactList&&(o.m_contactList.prev=s.m_nodeB),o.m_contactList=s.m_nodeB,++this.m_world.m_contactCount)
}},C.prototype.FindNewContacts=function(){this.m_broadPhase.UpdatePairs(Box2D.generateCallback(this,this.AddPair))},C.prototype.Destroy=function(t){var e=t.GetFixtureA(),i=t.GetFixtureB(),e=e.GetBody(),i=i.GetBody();t.IsTouching()&&this.m_contactListener.EndContact(t),t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_world.m_contactList&&(this.m_world.m_contactList=t.m_next),t.m_nodeA.prev&&(t.m_nodeA.prev.next=t.m_nodeA.next),t.m_nodeA.next&&(t.m_nodeA.next.prev=t.m_nodeA.prev),t.m_nodeA==e.m_contactList&&(e.m_contactList=t.m_nodeA.next),t.m_nodeB.prev&&(t.m_nodeB.prev.next=t.m_nodeB.next),t.m_nodeB.next&&(t.m_nodeB.next.prev=t.m_nodeB.prev),t.m_nodeB==i.m_contactList&&(i.m_contactList=t.m_nodeB.next),this.m_contactFactory.Destroy(t),--this.m_contactCount},C.prototype.Collide=function(){for(var t=this.m_world.m_contactList;t;){var e=t.GetFixtureA(),i=t.GetFixtureB(),n=e.GetBody(),r=i.GetBody();if(0==n.IsAwake()&&0==r.IsAwake())t=t.GetNext();else{if(t.m_flags&w.e_filterFlag){if(0==r.ShouldCollide(n)){e=t,t=e.GetNext(),this.Destroy(e);continue}if(0==this.m_contactFilter.ShouldCollide(e,i)){e=t,t=e.GetNext(),this.Destroy(e);continue}t.m_flags&=~w.e_filterFlag}0==this.m_broadPhase.TestOverlap(e.m_proxy,i.m_proxy)?(e=t,t=e.GetNext(),this.Destroy(e)):(t.Update(this.m_contactListener),t=t.GetNext())}}},Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactManager.s_evalCP=new c}),v.b2DebugDraw=function(){},v.prototype.b2DebugDraw=function(){},v.prototype.SetFlags=function(){},v.prototype.GetFlags=function(){},v.prototype.AppendFlags=function(){},v.prototype.ClearFlags=function(){},v.prototype.SetSprite=function(){},v.prototype.GetSprite=function(){},v.prototype.SetDrawScale=function(){},v.prototype.GetDrawScale=function(){},v.prototype.SetLineThickness=function(){},v.prototype.GetLineThickness=function(){},v.prototype.SetAlpha=function(){},v.prototype.GetAlpha=function(){},v.prototype.SetFillAlpha=function(){},v.prototype.GetFillAlpha=function(){},v.prototype.SetXFormScale=function(){},v.prototype.GetXFormScale=function(){},v.prototype.DrawPolygon=function(){},v.prototype.DrawSolidPolygon=function(){},v.prototype.DrawCircle=function(){},v.prototype.DrawSolidCircle=function(){},v.prototype.DrawSegment=function(){},v.prototype.DrawTransform=function(){},Box2D.postDefs.push(function(){Box2D.Dynamics.b2DebugDraw.e_shapeBit=1,Box2D.Dynamics.b2DebugDraw.e_jointBit=2,Box2D.Dynamics.b2DebugDraw.e_aabbBit=4,Box2D.Dynamics.b2DebugDraw.e_pairBit=8,Box2D.Dynamics.b2DebugDraw.e_centerOfMassBit=16,Box2D.Dynamics.b2DebugDraw.e_controllerBit=32}),x.b2DestructionListener=function(){},x.prototype.SayGoodbyeJoint=function(){},x.prototype.SayGoodbyeFixture=function(){},E.b2FilterData=function(){this.categoryBits=1,this.maskBits=65535,this.groupIndex=0},E.prototype.Copy=function(){var t=new E;return t.categoryBits=this.categoryBits,t.maskBits=this.maskBits,t.groupIndex=this.groupIndex,t},b.b2Fixture=function(){this.m_filter=new E},b.prototype.GetType=function(){return this.m_shape.GetType()},b.prototype.GetShape=function(){return this.m_shape},b.prototype.SetSensor=function(t){if(this.m_isSensor!=t&&(this.m_isSensor=t,null!=this.m_body))for(t=this.m_body.GetContactList();t;){var e=t.contact,i=e.GetFixtureA(),n=e.GetFixtureB();i!=this&&n!=this||e.SetSensor(i.IsSensor()||n.IsSensor()),t=t.next}},b.prototype.IsSensor=function(){return this.m_isSensor},b.prototype.SetFilterData=function(t){if(this.m_filter=t.Copy(),!this.m_body)for(t=this.m_body.GetContactList();t;){var e=t.contact,i=e.GetFixtureA(),n=e.GetFixtureB();i!=this&&n!=this||e.FlagForFiltering(),t=t.next}},b.prototype.GetFilterData=function(){return this.m_filter.Copy()},b.prototype.GetBody=function(){return this.m_body},b.prototype.GetNext=function(){return this.m_next},b.prototype.GetUserData=function(){return this.m_userData},b.prototype.SetUserData=function(t){this.m_userData=t},b.prototype.TestPoint=function(t){return this.m_shape.TestPoint(this.m_body.GetTransform(),t)},b.prototype.RayCast=function(t,e){return this.m_shape.RayCast(t,e,this.m_body.GetTransform())},b.prototype.GetMassData=function(t){return void 0===t&&(t=null),null==t&&(t=new _),this.m_shape.ComputeMass(t,this.m_density),t},b.prototype.SetDensity=function(t){void 0===t&&(t=0),this.m_density=t},b.prototype.GetDensity=function(){return this.m_density},b.prototype.GetFriction=function(){return this.m_friction},b.prototype.SetFriction=function(t){void 0===t&&(t=0),this.m_friction=t},b.prototype.GetRestitution=function(){return this.m_restitution},b.prototype.SetRestitution=function(t){void 0===t&&(t=0),this.m_restitution=t},b.prototype.GetAABB=function(){return this.m_aabb},b.prototype.b2Fixture=function(){this.m_aabb=new s,this.m_shape=this.m_next=this.m_body=this.m_userData=null,this.m_restitution=this.m_friction=this.m_density=0},b.prototype.Create=function(t,e,i){this.m_userData=i.userData,this.m_friction=i.friction,this.m_restitution=i.restitution,this.m_body=t,this.m_next=null,this.m_filter=i.filter.Copy(),this.m_isSensor=i.isSensor,this.m_shape=i.shape.Copy(),this.m_density=i.density},b.prototype.Destroy=function(){this.m_shape=null},b.prototype.CreateProxy=function(t,e){this.m_shape.ComputeAABB(this.m_aabb,e),this.m_proxy=t.CreateProxy(this.m_aabb,this)},b.prototype.DestroyProxy=function(t){null!=this.m_proxy&&(t.DestroyProxy(this.m_proxy),this.m_proxy=null)},b.prototype.Synchronize=function(e,i,n){if(this.m_proxy){var r=new s,o=new s;this.m_shape.ComputeAABB(r,i),this.m_shape.ComputeAABB(o,n),this.m_aabb.Combine(r,o),i=t.SubtractVV(n.position,i.position),e.MoveProxy(this.m_proxy,this.m_aabb,i)}},A.b2FixtureDef=function(){this.filter=new E},A.prototype.b2FixtureDef=function(){this.userData=this.shape=null,this.friction=.2,this.density=this.restitution=0,this.filter.categoryBits=1,this.filter.maskBits=65535,this.filter.groupIndex=0,this.isSensor=!1},R.b2Island=function(){},R.prototype.b2Island=function(){this.m_bodies=new Vector,this.m_contacts=new Vector,this.m_joints=new Vector},R.prototype.Initialize=function(t,e,i,n,r,o){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0);var s=0;for(this.m_bodyCapacity=t,this.m_contactCapacity=e,this.m_jointCapacity=i,this.m_jointCount=this.m_contactCount=this.m_bodyCount=0,this.m_allocator=n,this.m_listener=r,this.m_contactSolver=o,s=this.m_bodies.length;t>s;s++)this.m_bodies[s]=null;for(s=this.m_contacts.length;e>s;s++)this.m_contacts[s]=null;for(s=this.m_joints.length;i>s;s++)this.m_joints[s]=null},R.prototype.Clear=function(){this.m_jointCount=this.m_contactCount=this.m_bodyCount=0},R.prototype.Solve=function(e,i,n){for(var r,s=0,c=0,s=0;s<this.m_bodyCount;++s)c=this.m_bodies[s],c.GetType()==m.b2_dynamicBody&&(c.m_linearVelocity.x+=e.dt*(i.x+c.m_invMass*c.m_force.x),c.m_linearVelocity.y+=e.dt*(i.y+c.m_invMass*c.m_force.y),c.m_angularVelocity+=e.dt*c.m_invI*c.m_torque,c.m_linearVelocity.Multiply(t.Clamp(1-e.dt*c.m_linearDamping,0,1)),c.m_angularVelocity*=t.Clamp(1-e.dt*c.m_angularDamping,0,1));for(this.m_contactSolver.Initialize(e,this.m_contacts,this.m_contactCount,this.m_allocator),i=this.m_contactSolver,i.InitVelocityConstraints(e),s=0;s<this.m_jointCount;++s)r=this.m_joints[s],r.InitVelocityConstraints(e);for(s=0;s<e.velocityIterations;++s){for(c=0;c<this.m_jointCount;++c)r=this.m_joints[c],r.SolveVelocityConstraints(e);i.SolveVelocityConstraints()}for(s=0;s<this.m_jointCount;++s)r=this.m_joints[s],r.FinalizeVelocityConstraints();for(i.FinalizeVelocityConstraints(),s=0;s<this.m_bodyCount;++s)if(c=this.m_bodies[s],c.GetType()!=m.b2_staticBody){var a=e.dt*c.m_linearVelocity.x,l=e.dt*c.m_linearVelocity.y;a*a+l*l>o.b2_maxTranslationSquared&&(c.m_linearVelocity.Normalize(),c.m_linearVelocity.x=c.m_linearVelocity.x*o.b2_maxTranslation*e.inv_dt,c.m_linearVelocity.y=c.m_linearVelocity.y*o.b2_maxTranslation*e.inv_dt),a=e.dt*c.m_angularVelocity,a*a>o.b2_maxRotationSquared&&(c.m_angularVelocity=0>c.m_angularVelocity?-o.b2_maxRotation*e.inv_dt:o.b2_maxRotation*e.inv_dt),c.m_sweep.c0.SetV(c.m_sweep.c),c.m_sweep.a0=c.m_sweep.a,c.m_sweep.c.x+=e.dt*c.m_linearVelocity.x,c.m_sweep.c.y+=e.dt*c.m_linearVelocity.y,c.m_sweep.a+=e.dt*c.m_angularVelocity,c.SynchronizeTransform()}for(s=0;s<e.positionIterations;++s){for(a=i.SolvePositionConstraints(o.b2_contactBaumgarte),l=!0,c=0;c<this.m_jointCount;++c)r=this.m_joints[c],r=r.SolvePositionConstraints(o.b2_contactBaumgarte),l=l&&r;if(a&&l)break}if(this.Report(i.m_constraints),n){for(n=Number.MAX_VALUE,i=o.b2_linearSleepTolerance*o.b2_linearSleepTolerance,a=o.b2_angularSleepTolerance*o.b2_angularSleepTolerance,s=0;s<this.m_bodyCount;++s)c=this.m_bodies[s],c.GetType()!=m.b2_staticBody&&(0==(c.m_flags&m.e_allowSleepFlag)&&(n=c.m_sleepTime=0),0==(c.m_flags&m.e_allowSleepFlag)||c.m_angularVelocity*c.m_angularVelocity>a||t.Dot(c.m_linearVelocity,c.m_linearVelocity)>i?n=c.m_sleepTime=0:(c.m_sleepTime+=e.dt,n=t.Min(n,c.m_sleepTime)));if(n>=o.b2_timeToSleep)for(s=0;s<this.m_bodyCount;++s)c=this.m_bodies[s],c.SetAwake(!1)}},R.prototype.SolveTOI=function(t){var e=0,i=0;this.m_contactSolver.Initialize(t,this.m_contacts,this.m_contactCount,this.m_allocator);for(var n=this.m_contactSolver,e=0;e<this.m_jointCount;++e)this.m_joints[e].InitVelocityConstraints(t);for(e=0;e<t.velocityIterations;++e)for(n.SolveVelocityConstraints(),i=0;i<this.m_jointCount;++i)this.m_joints[i].SolveVelocityConstraints(t);for(e=0;e<this.m_bodyCount;++e)if(i=this.m_bodies[e],i.GetType()!=m.b2_staticBody){var r=t.dt*i.m_linearVelocity.x,s=t.dt*i.m_linearVelocity.y;r*r+s*s>o.b2_maxTranslationSquared&&(i.m_linearVelocity.Normalize(),i.m_linearVelocity.x=i.m_linearVelocity.x*o.b2_maxTranslation*t.inv_dt,i.m_linearVelocity.y=i.m_linearVelocity.y*o.b2_maxTranslation*t.inv_dt),r=t.dt*i.m_angularVelocity,r*r>o.b2_maxRotationSquared&&(i.m_angularVelocity=0>i.m_angularVelocity?-o.b2_maxRotation*t.inv_dt:o.b2_maxRotation*t.inv_dt),i.m_sweep.c0.SetV(i.m_sweep.c),i.m_sweep.a0=i.m_sweep.a,i.m_sweep.c.x+=t.dt*i.m_linearVelocity.x,i.m_sweep.c.y+=t.dt*i.m_linearVelocity.y,i.m_sweep.a+=t.dt*i.m_angularVelocity,i.SynchronizeTransform()}for(e=0;e<t.positionIterations;++e){for(r=n.SolvePositionConstraints(.75),s=!0,i=0;i<this.m_jointCount;++i)var c=this.m_joints[i].SolvePositionConstraints(o.b2_contactBaumgarte),s=s&&c;if(r&&s)break}this.Report(n.m_constraints)},R.prototype.Report=function(t){if(null!=this.m_listener)for(var e=0;e<this.m_contactCount;++e){for(var i=this.m_contacts[e],n=t[e],r=0;r<n.pointCount;++r)R.s_impulse.normalImpulses[r]=n.points[r].normalImpulse,R.s_impulse.tangentImpulses[r]=n.points[r].tangentImpulse;this.m_listener.PostSolve(i,R.s_impulse)}},R.prototype.AddBody=function(t){t.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount++]=t},R.prototype.AddContact=function(t){this.m_contacts[this.m_contactCount++]=t},R.prototype.AddJoint=function(t){this.m_joints[this.m_jointCount++]=t},Box2D.postDefs.push(function(){Box2D.Dynamics.b2Island.s_impulse=new T}),P.b2TimeStep=function(){},P.prototype.Set=function(t){this.dt=t.dt,this.inv_dt=t.inv_dt,this.positionIterations=t.positionIterations,this.velocityIterations=t.velocityIterations,this.warmStarting=t.warmStarting},I.b2World=function(){this.s_stack=new Vector,this.m_contactManager=new C,this.m_contactSolver=new D,this.m_island=new R},I.prototype.b2World=function(t,e){this.m_controllerList=this.m_jointList=this.m_contactList=this.m_bodyList=this.m_debugDraw=this.m_destructionListener=null,this.m_controllerCount=this.m_jointCount=this.m_contactCount=this.m_bodyCount=0,I.m_warmStarting=!0,I.m_continuousPhysics=!0,this.m_allowSleep=e,t.y=t.y,this.m_gravity=t,this.m_inv_dt0=0,this.m_contactManager.m_world=this;var i=new g;this.m_groundBody=this.CreateBody(i)},I.prototype.SetDestructionListener=function(t){this.m_destructionListener=t},I.prototype.SetContactFilter=function(t){this.m_contactManager.m_contactFilter=t},I.prototype.SetContactListener=function(t){this.m_contactManager.m_contactListener=t},I.prototype.SetDebugDraw=function(t){this.m_debugDraw=t},I.prototype.SetBroadPhase=function(t){var e=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=t;for(var i=this.m_bodyList;i;i=i.m_next)for(var n=i.m_fixtureList;n;n=n.m_next)n.m_proxy=t.CreateProxy(e.GetFatAABB(n.m_proxy),n)},I.prototype.Validate=function(){this.m_contactManager.m_broadPhase.Validate()},I.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()},I.prototype.CreateBody=function(t){return 1==this.IsLocked()?null:(t=new m(t,this),t.m_prev=null,(t.m_next=this.m_bodyList)&&(this.m_bodyList.m_prev=t),this.m_bodyList=t,++this.m_bodyCount,t)},I.prototype.DestroyBody=function(t){if(1!=this.IsLocked()){for(var e=t.m_jointList;e;){var i=e,e=e.next;this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(i.joint),this.DestroyJoint(i.joint)}for(e=t.m_controllerList;e;)i=e,e=e.nextController,i.controller.RemoveBody(t);for(e=t.m_contactList;e;)i=e,e=e.next,this.m_contactManager.Destroy(i.contact);for(t.m_contactList=null,e=t.m_fixtureList;e;)i=e,e=e.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(i),i.DestroyProxy(this.m_contactManager.m_broadPhase),i.Destroy();t.m_fixtureList=null,t.m_fixtureCount=0,t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_bodyList&&(this.m_bodyList=t.m_next),--this.m_bodyCount}},I.prototype.CreateJoint=function(t){var e=O.Create(t,null);e.m_prev=null,(e.m_next=this.m_jointList)&&(this.m_jointList.m_prev=e),this.m_jointList=e,++this.m_jointCount,e.m_edgeA.joint=e,e.m_edgeA.other=e.m_bodyB,e.m_edgeA.prev=null,(e.m_edgeA.next=e.m_bodyA.m_jointList)&&(e.m_bodyA.m_jointList.prev=e.m_edgeA),e.m_bodyA.m_jointList=e.m_edgeA,e.m_edgeB.joint=e,e.m_edgeB.other=e.m_bodyA,e.m_edgeB.prev=null,(e.m_edgeB.next=e.m_bodyB.m_jointList)&&(e.m_bodyB.m_jointList.prev=e.m_edgeB),e.m_bodyB.m_jointList=e.m_edgeB;var i=t.bodyA,n=t.bodyB;if(0==t.collideConnected)for(t=n.GetContactList();t;)t.other==i&&t.contact.FlagForFiltering(),t=t.next;return e},I.prototype.DestroyJoint=function(t){var e=t.m_collideConnected;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_jointList&&(this.m_jointList=t.m_next);var i=t.m_bodyA,n=t.m_bodyB;if(i.SetAwake(!0),n.SetAwake(!0),t.m_edgeA.prev&&(t.m_edgeA.prev.next=t.m_edgeA.next),t.m_edgeA.next&&(t.m_edgeA.next.prev=t.m_edgeA.prev),t.m_edgeA==i.m_jointList&&(i.m_jointList=t.m_edgeA.next),t.m_edgeA.prev=null,t.m_edgeA.next=null,t.m_edgeB.prev&&(t.m_edgeB.prev.next=t.m_edgeB.next),t.m_edgeB.next&&(t.m_edgeB.next.prev=t.m_edgeB.prev),t.m_edgeB==n.m_jointList&&(n.m_jointList=t.m_edgeB.next),t.m_edgeB.prev=null,t.m_edgeB.next=null,O.Destroy(t,null),--this.m_jointCount,0==e)for(t=n.GetContactList();t;)t.other==i&&t.contact.FlagForFiltering(),t=t.next},I.prototype.AddController=function(t){return t.m_next=this.m_controllerList,t.m_prev=null,this.m_controllerList=t,t.m_world=this,this.m_controllerCount++,t},I.prototype.RemoveController=function(t){t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),this.m_controllerList==t&&(this.m_controllerList=t.m_next),this.m_controllerCount--},I.prototype.CreateController=function(t){if(t.m_world!=this)throw Error("Controller can only be a member of one world");return t.m_next=this.m_controllerList,t.m_prev=null,this.m_controllerList&&(this.m_controllerList.m_prev=t),this.m_controllerList=t,++this.m_controllerCount,t.m_world=this,t},I.prototype.DestroyController=function(t){t.Clear(),t.m_next&&(t.m_next.m_prev=t.m_prev),t.m_prev&&(t.m_prev.m_next=t.m_next),t==this.m_controllerList&&(this.m_controllerList=t.m_next),--this.m_controllerCount},I.prototype.SetWarmStarting=function(t){I.m_warmStarting=t},I.prototype.SetContinuousPhysics=function(t){I.m_continuousPhysics=t},I.prototype.GetBodyCount=function(){return this.m_bodyCount},I.prototype.GetJointCount=function(){return this.m_jointCount},I.prototype.GetContactCount=function(){return this.m_contactCount},I.prototype.SetGravity=function(t){this.m_gravity=t},I.prototype.GetGravity=function(){return this.m_gravity},I.prototype.GetGroundBody=function(){return this.m_groundBody},I.prototype.Step=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this.m_flags&I.e_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_flags&=~I.e_newFixture),this.m_flags|=I.e_locked;var n=I.s_timestep2;n.dt=t,n.velocityIterations=e,n.positionIterations=i,n.inv_dt=t>0?1/t:0,n.dtRatio=this.m_inv_dt0*t,n.warmStarting=I.m_warmStarting,this.m_contactManager.Collide(),0<n.dt&&this.Solve(n),I.m_continuousPhysics&&0<n.dt&&this.SolveTOI(n),0<n.dt&&(this.m_inv_dt0=n.inv_dt),this.m_flags&=~I.e_locked},I.prototype.ClearForces=function(){for(var t=this.m_bodyList;t;t=t.m_next)t.m_force.SetZero(),t.m_torque=0},I.prototype.DrawDebugData=function(){if(null!=this.m_debugDraw){this.m_debugDraw.m_sprite.graphics.clear();var t,e,i,o=this.m_debugDraw.GetFlags();new n,new n,new n;var c;new s,new s,c=[new n,new n,new n,new n];var a=new r(0,0,0);if(o&v.e_shapeBit)for(t=this.m_bodyList;t;t=t.m_next)for(c=t.m_xf,e=t.GetFixtureList();e;e=e.m_next)i=e.GetShape(),0==t.IsActive()?a.Set(.5,.5,.3):t.GetType()==m.b2_staticBody?a.Set(.5,.9,.5):t.GetType()==m.b2_kinematicBody?a.Set(.5,.5,.9):0==t.IsAwake()?a.Set(.6,.6,.6):a.Set(.9,.7,.7),this.DrawShape(i,c,a);if(o&v.e_jointBit)for(t=this.m_jointList;t;t=t.m_next)this.DrawJoint(t);if(o&v.e_controllerBit)for(t=this.m_controllerList;t;t=t.m_next)t.Draw(this.m_debugDraw);if(o&v.e_pairBit)for(a.Set(.3,.9,.9),t=this.m_contactManager.m_contactList;t;t=t.GetNext())i=t.GetFixtureA(),e=t.GetFixtureB(),i=i.GetAABB().GetCenter(),e=e.GetAABB().GetCenter(),this.m_debugDraw.DrawSegment(i,e,a);if(o&v.e_aabbBit)for(i=this.m_contactManager.m_broadPhase,c=[new n,new n,new n,new n],t=this.m_bodyList;t;t=t.GetNext())if(0!=t.IsActive())for(e=t.GetFixtureList();e;e=e.GetNext()){var l=i.GetFatAABB(e.m_proxy);c[0].Set(l.lowerBound.x,l.lowerBound.y),c[1].Set(l.upperBound.x,l.lowerBound.y),c[2].Set(l.upperBound.x,l.upperBound.y),c[3].Set(l.lowerBound.x,l.upperBound.y),this.m_debugDraw.DrawPolygon(c,4,a)}if(o&v.e_centerOfMassBit)for(t=this.m_bodyList;t;t=t.m_next)c=I.s_xf,c.R=t.m_xf.R,c.position=t.GetWorldCenter(),this.m_debugDraw.DrawTransform(c)}},I.prototype.QueryAABB=function(t,e){var i=this.m_contactManager.m_broadPhase;i.Query(function(e){return t(i.GetUserData(e))},e)},I.prototype.QueryShape=function(t,e,n){void 0===n&&(n=null),null==n&&(n=new i,n.SetIdentity());var r=this.m_contactManager.m_broadPhase,o=new s;e.ComputeAABB(o,n),r.Query(function(i){return i=r.GetUserData(i)instanceof b?r.GetUserData(i):null,f.TestOverlap(e,n,i.GetShape(),i.GetBody().GetTransform())?t(i):!0},o)},I.prototype.QueryPoint=function(t,e){var i=this.m_contactManager.m_broadPhase,n=new s;n.lowerBound.Set(e.x-o.b2_linearSlop,e.y-o.b2_linearSlop),n.upperBound.Set(e.x+o.b2_linearSlop,e.y+o.b2_linearSlop),i.Query(function(n){return n=i.GetUserData(n)instanceof b?i.GetUserData(n):null,n.TestPoint(e)?t(n):!0},n)},I.prototype.RayCast=function(t,e,i){var r=this.m_contactManager.m_broadPhase,o=new h,s=new l(e,i);r.RayCast(function(s,c){var a=r.GetUserData(c),a=a instanceof b?a:null;if(a.RayCast(o,s)){var l=o.fraction,h=new n((1-l)*e.x+l*i.x,(1-l)*e.y+l*i.y);return t(a,h,o.normal,l)}return s.maxFraction},s)},I.prototype.RayCastOne=function(t,e){var i;return this.RayCast(function(t,e,n,r){return void 0===r&&(r=0),i=t,r},t,e),i},I.prototype.RayCastAll=function(t,e){var i=new Vector;return this.RayCast(function(t){return i[i.length]=t,1},t,e),i},I.prototype.GetBodyList=function(){return this.m_bodyList},I.prototype.GetJointList=function(){return this.m_jointList},I.prototype.GetContactList=function(){return this.m_contactList},I.prototype.IsLocked=function(){return 0<(this.m_flags&I.e_locked)},I.prototype.Solve=function(t){for(var e,i=this.m_controllerList;i;i=i.m_next)i.Step(t);for(i=this.m_island,i.Initialize(this.m_bodyCount,this.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener,this.m_contactSolver),e=this.m_bodyList;e;e=e.m_next)e.m_flags&=~m.e_islandFlag;for(var n=this.m_contactList;n;n=n.m_next)n.m_flags&=~w.e_islandFlag;for(n=this.m_jointList;n;n=n.m_next)n.m_islandFlag=!1;parseInt(this.m_bodyCount);for(var n=this.s_stack,r=this.m_bodyList;r;r=r.m_next)if(!(r.m_flags&m.e_islandFlag)&&0!=r.IsAwake()&&0!=r.IsActive()&&r.GetType()!=m.b2_staticBody){i.Clear();var o=0;for(n[o++]=r,r.m_flags|=m.e_islandFlag;o>0;)if(e=n[--o],i.AddBody(e),0==e.IsAwake()&&e.SetAwake(!0),e.GetType()!=m.b2_staticBody){for(var s,c=e.m_contactList;c;c=c.next)c.contact.m_flags&w.e_islandFlag||1==c.contact.IsSensor()||0==c.contact.IsEnabled()||0==c.contact.IsTouching()||(i.AddContact(c.contact),c.contact.m_flags|=w.e_islandFlag,s=c.other,s.m_flags&m.e_islandFlag||(n[o++]=s,s.m_flags|=m.e_islandFlag));for(e=e.m_jointList;e;e=e.next)1!=e.joint.m_islandFlag&&(s=e.other,0!=s.IsActive()&&(i.AddJoint(e.joint),e.joint.m_islandFlag=!0,s.m_flags&m.e_islandFlag||(n[o++]=s,s.m_flags|=m.e_islandFlag)))}for(i.Solve(t,this.m_gravity,this.m_allowSleep),o=0;o<i.m_bodyCount;++o)e=i.m_bodies[o],e.GetType()==m.b2_staticBody&&(e.m_flags&=~m.e_islandFlag)}for(o=0;o<n.length&&n[o];++o)n[o]=null;for(e=this.m_bodyList;e;e=e.m_next)0!=e.IsAwake()&&0!=e.IsActive()&&e.GetType()!=m.b2_staticBody&&e.SynchronizeFixtures();this.m_contactManager.FindNewContacts()},I.prototype.SolveTOI=function(t){var e,i,n,r=this.m_island;r.Initialize(this.m_bodyCount,o.b2_maxTOIContactsPerIsland,o.b2_maxTOIJointsPerIsland,null,this.m_contactManager.m_contactListener,this.m_contactSolver);var s=I.s_queue;for(e=this.m_bodyList;e;e=e.m_next)e.m_flags&=~m.e_islandFlag,e.m_sweep.t0=0;for(n=this.m_contactList;n;n=n.m_next)n.m_flags&=~(w.e_toiFlag|w.e_islandFlag);for(n=this.m_jointList;n;n=n.m_next)n.m_islandFlag=!1;for(;;){var c=null,a=1;for(n=this.m_contactList;n;n=n.m_next)if(1!=n.IsSensor()&&0!=n.IsEnabled()&&0!=n.IsContinuous()){if(e=1,n.m_flags&w.e_toiFlag)e=n.m_toi;else{if(e=n.m_fixtureA,i=n.m_fixtureB,e=e.m_body,i=i.m_body,!(e.GetType()==m.b2_dynamicBody&&0!=e.IsAwake()||i.GetType()==m.b2_dynamicBody&&0!=i.IsAwake()))continue;var l=e.m_sweep.t0;e.m_sweep.t0<i.m_sweep.t0?(l=i.m_sweep.t0,e.m_sweep.Advance(l)):i.m_sweep.t0<e.m_sweep.t0&&(l=e.m_sweep.t0,i.m_sweep.Advance(l)),e=n.ComputeTOI(e.m_sweep,i.m_sweep),o.b2Assert(e>=0&&1>=e),e>0&&1>e&&(e=(1-e)*l+e,e>1&&(e=1)),n.m_toi=e,n.m_flags|=w.e_toiFlag}Number.MIN_VALUE<e&&a>e&&(c=n,a=e)}if(null==c||1-100*Number.MIN_VALUE<a)break;if(e=c.m_fixtureA,i=c.m_fixtureB,e=e.m_body,i=i.m_body,I.s_backupA.Set(e.m_sweep),I.s_backupB.Set(i.m_sweep),e.Advance(a),i.Advance(a),c.Update(this.m_contactManager.m_contactListener),c.m_flags&=~w.e_toiFlag,1==c.IsSensor()||0==c.IsEnabled())e.m_sweep.Set(I.s_backupA),i.m_sweep.Set(I.s_backupB),e.SynchronizeTransform(),i.SynchronizeTransform();else if(0!=c.IsTouching()){for(e.GetType()!=m.b2_dynamicBody&&(e=i),r.Clear(),c=n=0,s[n+c++]=e,e.m_flags|=m.e_islandFlag;c>0;)if(e=s[n++],--c,r.AddBody(e),0==e.IsAwake()&&e.SetAwake(!0),e.GetType()==m.b2_dynamicBody){for(i=e.m_contactList;i&&r.m_contactCount!=r.m_contactCapacity;i=i.next)i.contact.m_flags&w.e_islandFlag||1==i.contact.IsSensor()||0==i.contact.IsEnabled()||0==i.contact.IsTouching()||(r.AddContact(i.contact),i.contact.m_flags|=w.e_islandFlag,l=i.other,l.m_flags&m.e_islandFlag||(l.GetType()!=m.b2_staticBody&&(l.Advance(a),l.SetAwake(!0)),s[n+c]=l,++c,l.m_flags|=m.e_islandFlag));for(e=e.m_jointList;e;e=e.next)r.m_jointCount!=r.m_jointCapacity&&1!=e.joint.m_islandFlag&&(l=e.other,0!=l.IsActive()&&(r.AddJoint(e.joint),e.joint.m_islandFlag=!0,l.m_flags&m.e_islandFlag||(l.GetType()!=m.b2_staticBody&&(l.Advance(a),l.SetAwake(!0)),s[n+c]=l,++c,l.m_flags|=m.e_islandFlag)))}for(n=I.s_timestep,n.warmStarting=!1,n.dt=(1-a)*t.dt,n.inv_dt=1/n.dt,n.dtRatio=0,n.velocityIterations=t.velocityIterations,n.positionIterations=t.positionIterations,r.SolveTOI(n),a=a=0;a<r.m_bodyCount;++a)if(e=r.m_bodies[a],e.m_flags&=~m.e_islandFlag,0!=e.IsAwake()&&e.GetType()==m.b2_dynamicBody)for(e.SynchronizeFixtures(),i=e.m_contactList;i;i=i.next)i.contact.m_flags&=~w.e_toiFlag;for(a=0;a<r.m_contactCount;++a)n=r.m_contacts[a],n.m_flags&=~(w.e_toiFlag|w.e_islandFlag);for(a=0;a<r.m_jointCount;++a)n=r.m_joints[a],n.m_islandFlag=!1;this.m_contactManager.FindNewContacts()}}},I.prototype.DrawJoint=function(t){var e=t.GetBodyA(),i=t.GetBodyB(),n=e.m_xf.position,r=i.m_xf.position,o=t.GetAnchorA(),s=t.GetAnchorB(),c=I.s_jointColor;switch(t.m_type){case O.e_distanceJoint:this.m_debugDraw.DrawSegment(o,s,c);break;case O.e_pulleyJoint:e=t instanceof N?t:null,t=e.GetGroundAnchorA(),e=e.GetGroundAnchorB(),this.m_debugDraw.DrawSegment(t,o,c),this.m_debugDraw.DrawSegment(e,s,c),this.m_debugDraw.DrawSegment(t,e,c);break;case O.e_mouseJoint:this.m_debugDraw.DrawSegment(o,s,c);break;default:e!=this.m_groundBody&&this.m_debugDraw.DrawSegment(n,o,c),this.m_debugDraw.DrawSegment(o,s,c),i!=this.m_groundBody&&this.m_debugDraw.DrawSegment(r,s,c)}},I.prototype.DrawShape=function(e,i,n){switch(e.m_type){case f.e_circleShape:var r=e instanceof u?e:null;e=t.MulX(i,r.m_p),this.m_debugDraw.DrawSolidCircle(e,r.m_radius,i.R.col1,n);break;case f.e_polygonShape:r=0,r=e instanceof p?e:null,e=parseInt(r.GetVertexCount());for(var o=r.GetVertices(),s=new Vector(e),r=0;e>r;++r)s[r]=t.MulX(i,o[r]);this.m_debugDraw.DrawSolidPolygon(s,e,n);break;case f.e_edgeShape:r=e instanceof d?e:null,this.m_debugDraw.DrawSegment(t.MulX(i,r.GetVertex1()),t.MulX(i,r.GetVertex2()),n)}},Box2D.postDefs.push(function(){Box2D.Dynamics.b2World.s_timestep2=new P,Box2D.Dynamics.b2World.s_xf=new i,Box2D.Dynamics.b2World.s_backupA=new e,Box2D.Dynamics.b2World.s_backupB=new e,Box2D.Dynamics.b2World.s_timestep=new P,Box2D.Dynamics.b2World.s_queue=new Vector,Box2D.Dynamics.b2World.s_jointColor=new r(.5,.8,.8),Box2D.Dynamics.b2World.e_newFixture=1,Box2D.Dynamics.b2World.e_locked=2})}(),function(){var t=Box2D.Collision.Shapes.b2CircleShape,e=Box2D.Collision.Shapes.b2EdgeShape,i=Box2D.Collision.Shapes.b2PolygonShape,n=Box2D.Collision.Shapes.b2Shape,r=Box2D.Dynamics.Contacts.b2CircleContact,o=Box2D.Dynamics.Contacts.b2Contact,s=Box2D.Dynamics.Contacts.b2ContactConstraint,c=Box2D.Dynamics.Contacts.b2ContactConstraintPoint,a=Box2D.Dynamics.Contacts.b2ContactEdge,l=Box2D.Dynamics.Contacts.b2ContactFactory,h=Box2D.Dynamics.Contacts.b2ContactRegister,u=Box2D.Dynamics.Contacts.b2ContactResult,d=Box2D.Dynamics.Contacts.b2ContactSolver,_=Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,p=Box2D.Dynamics.Contacts.b2NullContact,f=Box2D.Dynamics.Contacts.b2PolyAndCircleContact,m=Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,g=Box2D.Dynamics.Contacts.b2PolygonContact,y=Box2D.Dynamics.Contacts.b2PositionSolverManifold,T=Box2D.Dynamics.b2Body,S=Box2D.Dynamics.b2TimeStep,C=Box2D.Common.b2Settings,v=Box2D.Common.Math.b2Mat22,x=Box2D.Common.Math.b2Math,E=Box2D.Common.Math.b2Vec2,b=Box2D.Collision.b2Collision,A=Box2D.Collision.b2ContactID,R=Box2D.Collision.b2Manifold,P=Box2D.Collision.b2TimeOfImpact,I=Box2D.Collision.b2TOIInput,w=Box2D.Collision.b2WorldManifold;Box2D.inherit(r,Box2D.Dynamics.Contacts.b2Contact),r.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,r.b2CircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},r.Create=function(){return new r},r.Destroy=function(){},r.prototype.Reset=function(t,e){this.__super.Reset.call(this,t,e)},r.prototype.Evaluate=function(){var e=this.m_fixtureA.GetBody(),i=this.m_fixtureB.GetBody();b.CollideCircles(this.m_manifold,this.m_fixtureA.GetShape()instanceof t?this.m_fixtureA.GetShape():null,e.m_xf,this.m_fixtureB.GetShape()instanceof t?this.m_fixtureB.GetShape():null,i.m_xf)},o.b2Contact=function(){this.m_nodeA=new a,this.m_nodeB=new a,this.m_manifold=new R,this.m_oldManifold=new R},o.prototype.GetManifold=function(){return this.m_manifold},o.prototype.GetWorldManifold=function(t){var e=this.m_fixtureA.GetBody(),i=this.m_fixtureB.GetBody(),n=this.m_fixtureA.GetShape(),r=this.m_fixtureB.GetShape();t.Initialize(this.m_manifold,e.GetTransform(),n.m_radius,i.GetTransform(),r.m_radius)},o.prototype.IsTouching=function(){return(this.m_flags&o.e_touchingFlag)==o.e_touchingFlag},o.prototype.IsContinuous=function(){return(this.m_flags&o.e_continuousFlag)==o.e_continuousFlag},o.prototype.SetSensor=function(t){this.m_flags=t?this.m_flags|o.e_sensorFlag:this.m_flags&~o.e_sensorFlag},o.prototype.IsSensor=function(){return(this.m_flags&o.e_sensorFlag)==o.e_sensorFlag},o.prototype.SetEnabled=function(t){this.m_flags=t?this.m_flags|o.e_enabledFlag:this.m_flags&~o.e_enabledFlag},o.prototype.IsEnabled=function(){return(this.m_flags&o.e_enabledFlag)==o.e_enabledFlag},o.prototype.GetNext=function(){return this.m_next},o.prototype.GetFixtureA=function(){return this.m_fixtureA},o.prototype.GetFixtureB=function(){return this.m_fixtureB},o.prototype.FlagForFiltering=function(){this.m_flags|=o.e_filterFlag},o.prototype.b2Contact=function(){},o.prototype.Reset=function(t,e){if(void 0===t&&(t=null),void 0===e&&(e=null),this.m_flags=o.e_enabledFlag,t&&e){(t.IsSensor()||e.IsSensor())&&(this.m_flags|=o.e_sensorFlag);var i=t.GetBody(),n=e.GetBody();(i.GetType()!=T.b2_dynamicBody||i.IsBullet()||n.GetType()!=T.b2_dynamicBody||n.IsBullet())&&(this.m_flags|=o.e_continuousFlag),this.m_fixtureA=t,this.m_fixtureB=e,this.m_manifold.m_pointCount=0,this.m_next=this.m_prev=null,this.m_nodeA.contact=null,this.m_nodeA.prev=null,this.m_nodeA.next=null,this.m_nodeA.other=null,this.m_nodeB.contact=null,this.m_nodeB.prev=null,this.m_nodeB.next=null,this.m_nodeB.other=null}else this.m_fixtureB=this.m_fixtureA=null},o.prototype.Update=function(t){var e=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=e,this.m_flags|=o.e_enabledFlag;var i=!1,e=(this.m_flags&o.e_touchingFlag)==o.e_touchingFlag,r=this.m_fixtureA.m_body,s=this.m_fixtureB.m_body,c=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&o.e_sensorFlag)c&&(i=this.m_fixtureA.GetShape(),c=this.m_fixtureB.GetShape(),r=r.GetTransform(),s=s.GetTransform(),i=n.TestOverlap(i,r,c,s)),this.m_manifold.m_pointCount=0;else{if(r.GetType()!=T.b2_dynamicBody||r.IsBullet()||s.GetType()!=T.b2_dynamicBody||s.IsBullet()?this.m_flags|=o.e_continuousFlag:this.m_flags&=~o.e_continuousFlag,c)for(this.Evaluate(),i=0<this.m_manifold.m_pointCount,c=0;c<this.m_manifold.m_pointCount;++c){var a=this.m_manifold.m_points[c];a.m_normalImpulse=0,a.m_tangentImpulse=0;for(var l=a.m_id,h=0;h<this.m_oldManifold.m_pointCount;++h){var u=this.m_oldManifold.m_points[h];if(u.m_id.key==l.key){a.m_normalImpulse=u.m_normalImpulse,a.m_tangentImpulse=u.m_tangentImpulse;break}}}else this.m_manifold.m_pointCount=0;i!=e&&(r.SetAwake(!0),s.SetAwake(!0))}this.m_flags=i?this.m_flags|o.e_touchingFlag:this.m_flags&~o.e_touchingFlag,0==e&&1==i&&t.BeginContact(this),1==e&&0==i&&t.EndContact(this),0==(this.m_flags&o.e_sensorFlag)&&t.PreSolve(this,this.m_oldManifold)},o.prototype.Evaluate=function(){},o.prototype.ComputeTOI=function(t,e){return o.s_input.proxyA.Set(this.m_fixtureA.GetShape()),o.s_input.proxyB.Set(this.m_fixtureB.GetShape()),o.s_input.sweepA=t,o.s_input.sweepB=e,o.s_input.tolerance=C.b2_linearSlop,P.TimeOfImpact(o.s_input)},Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2Contact.e_sensorFlag=1,Box2D.Dynamics.Contacts.b2Contact.e_continuousFlag=2,Box2D.Dynamics.Contacts.b2Contact.e_islandFlag=4,Box2D.Dynamics.Contacts.b2Contact.e_toiFlag=8,Box2D.Dynamics.Contacts.b2Contact.e_touchingFlag=16,Box2D.Dynamics.Contacts.b2Contact.e_enabledFlag=32,Box2D.Dynamics.Contacts.b2Contact.e_filterFlag=64,Box2D.Dynamics.Contacts.b2Contact.s_input=new I}),s.b2ContactConstraint=function(){this.localPlaneNormal=new E,this.localPoint=new E,this.normal=new E,this.normalMass=new v,this.K=new v},s.prototype.b2ContactConstraint=function(){this.points=new Vector(C.b2_maxManifoldPoints);for(var t=0;t<C.b2_maxManifoldPoints;t++)this.points[t]=new c},c.b2ContactConstraintPoint=function(){this.localPoint=new E,this.rA=new E,this.rB=new E
},a.b2ContactEdge=function(){},l.b2ContactFactory=function(){},l.prototype.b2ContactFactory=function(t){this.m_allocator=t,this.InitializeRegisters()},l.prototype.AddType=function(t,e,i,n){void 0===i&&(i=0),void 0===n&&(n=0),this.m_registers[i][n].createFcn=t,this.m_registers[i][n].destroyFcn=e,this.m_registers[i][n].primary=!0,i!=n&&(this.m_registers[n][i].createFcn=t,this.m_registers[n][i].destroyFcn=e,this.m_registers[n][i].primary=!1)},l.prototype.InitializeRegisters=function(){this.m_registers=new Vector(n.e_shapeTypeCount);for(var t=0;t<n.e_shapeTypeCount;t++){this.m_registers[t]=new Vector(n.e_shapeTypeCount);for(var e=0;e<n.e_shapeTypeCount;e++)this.m_registers[t][e]=new h}this.AddType(r.Create,r.Destroy,n.e_circleShape,n.e_circleShape),this.AddType(f.Create,f.Destroy,n.e_polygonShape,n.e_circleShape),this.AddType(g.Create,g.Destroy,n.e_polygonShape,n.e_polygonShape),this.AddType(_.Create,_.Destroy,n.e_edgeShape,n.e_circleShape),this.AddType(m.Create,m.Destroy,n.e_polygonShape,n.e_edgeShape)},l.prototype.Create=function(t,e){var i=parseInt(t.GetType()),n=parseInt(e.GetType()),i=this.m_registers[i][n];return i.pool?(n=i.pool,i.pool=n.m_next,i.poolCount--,n.Reset(t,e),n):(n=i.createFcn,null!=n?(i.primary?(n=n(this.m_allocator),n.Reset(t,e)):(n=n(this.m_allocator),n.Reset(e,t)),n):null)},l.prototype.Destroy=function(t){0<t.m_manifold.m_pointCount&&(t.m_fixtureA.m_body.SetAwake(!0),t.m_fixtureB.m_body.SetAwake(!0));var e=parseInt(t.m_fixtureA.GetType()),i=parseInt(t.m_fixtureB.GetType()),e=this.m_registers[e][i];e.poolCount++,t.m_next=e.pool,e.pool=t,(e=e.destroyFcn)(t,this.m_allocator)},h.b2ContactRegister=function(){},u.b2ContactResult=function(){this.position=new E,this.normal=new E,this.id=new A},d.b2ContactSolver=function(){this.m_step=new S,this.m_constraints=new Vector},d.prototype.b2ContactSolver=function(){},d.prototype.Initialize=function(t,e,i,n){void 0===i&&(i=0);var r;for(this.m_step.Set(t),this.m_allocator=n,t=0,this.m_constraintCount=i;this.m_constraints.length<this.m_constraintCount;)this.m_constraints[this.m_constraints.length]=new s;for(t=0;i>t;++t){r=e[t],n=r.m_fixtureA;var o=r.m_fixtureB,c=n.m_shape.m_radius,a=o.m_shape.m_radius,l=n.m_body,h=o.m_body,u=r.GetManifold(),_=C.b2MixFriction(n.GetFriction(),o.GetFriction()),p=C.b2MixRestitution(n.GetRestitution(),o.GetRestitution()),f=l.m_linearVelocity.x,m=l.m_linearVelocity.y,g=h.m_linearVelocity.x,y=h.m_linearVelocity.y,T=l.m_angularVelocity,S=h.m_angularVelocity;for(C.b2Assert(0<u.m_pointCount),d.s_worldManifold.Initialize(u,l.m_xf,c,h.m_xf,a),o=d.s_worldManifold.m_normal.x,r=d.s_worldManifold.m_normal.y,n=this.m_constraints[t],n.bodyA=l,n.bodyB=h,n.manifold=u,n.normal.x=o,n.normal.y=r,n.pointCount=u.m_pointCount,n.friction=_,n.restitution=p,n.localPlaneNormal.x=u.m_localPlaneNormal.x,n.localPlaneNormal.y=u.m_localPlaneNormal.y,n.localPoint.x=u.m_localPoint.x,n.localPoint.y=u.m_localPoint.y,n.radius=c+a,n.type=u.m_type,c=0;c<n.pointCount;++c){_=u.m_points[c],a=n.points[c],a.normalImpulse=_.m_normalImpulse,a.tangentImpulse=_.m_tangentImpulse,a.localPoint.SetV(_.m_localPoint);var _=a.rA.x=d.s_worldManifold.m_points[c].x-l.m_sweep.c.x,p=a.rA.y=d.s_worldManifold.m_points[c].y-l.m_sweep.c.y,v=a.rB.x=d.s_worldManifold.m_points[c].x-h.m_sweep.c.x,x=a.rB.y=d.s_worldManifold.m_points[c].y-h.m_sweep.c.y,E=_*r-p*o,b=v*r-x*o,E=E*E,b=b*b;a.normalMass=1/(l.m_invMass+h.m_invMass+l.m_invI*E+h.m_invI*b);var A=l.m_mass*l.m_invMass+h.m_mass*h.m_invMass,A=A+(l.m_mass*l.m_invI*E+h.m_mass*h.m_invI*b);a.equalizedMass=1/A,b=r,A=-o,E=_*A-p*b,b=v*A-x*b,E*=E,b*=b,a.tangentMass=1/(l.m_invMass+h.m_invMass+l.m_invI*E+h.m_invI*b),a.velocityBias=0,_=n.normal.x*(g+-S*x-f- -T*p)+n.normal.y*(y+S*v-m-T*_),_<-C.b2_velocityThreshold&&(a.velocityBias+=-n.restitution*_)}2==n.pointCount&&(y=n.points[0],g=n.points[1],u=l.m_invMass,l=l.m_invI,f=h.m_invMass,h=h.m_invI,m=y.rA.x*r-y.rA.y*o,y=y.rB.x*r-y.rB.y*o,T=g.rA.x*r-g.rA.y*o,g=g.rB.x*r-g.rB.y*o,o=u+f+l*m*m+h*y*y,r=u+f+l*T*T+h*g*g,h=u+f+l*m*T+h*y*g,100*(o*r-h*h)>o*o?(n.K.col1.Set(o,h),n.K.col2.Set(h,r),n.K.GetInverse(n.normalMass)):n.pointCount=1)}},d.prototype.InitVelocityConstraints=function(t){for(var e=0;e<this.m_constraintCount;++e){var i=this.m_constraints[e],n=i.bodyA,r=i.bodyB,o=n.m_invMass,s=n.m_invI,c=r.m_invMass,a=r.m_invI,l=i.normal.x,h=i.normal.y,u=h,d=-l,_=0,p=0;if(t.warmStarting)for(p=i.pointCount,_=0;p>_;++_){var f=i.points[_];f.normalImpulse*=t.dtRatio,f.tangentImpulse*=t.dtRatio;var m=f.normalImpulse*l+f.tangentImpulse*u,g=f.normalImpulse*h+f.tangentImpulse*d;n.m_angularVelocity-=s*(f.rA.x*g-f.rA.y*m),n.m_linearVelocity.x-=o*m,n.m_linearVelocity.y-=o*g,r.m_angularVelocity+=a*(f.rB.x*g-f.rB.y*m),r.m_linearVelocity.x+=c*m,r.m_linearVelocity.y+=c*g}else for(p=i.pointCount,_=0;p>_;++_)n=i.points[_],n.normalImpulse=0,n.tangentImpulse=0}},d.prototype.SolveVelocityConstraints=function(){for(var t,e,i=0,n=0,r=0,o=0,s=r=r=n=n=0,c=n=n=0,a=n=o=0,l=0,h=0;h<this.m_constraintCount;++h){var o=this.m_constraints[h],u=o.bodyA,d=o.bodyB,_=u.m_angularVelocity,p=d.m_angularVelocity,f=u.m_linearVelocity,m=d.m_linearVelocity,g=u.m_invMass,y=u.m_invI,T=d.m_invMass,S=d.m_invI,a=o.normal.x,C=l=o.normal.y;for(e=-a,c=o.friction,i=0;i<o.pointCount;i++)t=o.points[i],n=m.x-p*t.rB.y-f.x+_*t.rA.y,r=m.y+p*t.rB.x-f.y-_*t.rA.x,n=n*C+r*e,n=t.tangentMass*-n,r=c*t.normalImpulse,r=x.Clamp(t.tangentImpulse+n,-r,r),n=r-t.tangentImpulse,s=n*C,n*=e,f.x-=g*s,f.y-=g*n,_-=y*(t.rA.x*n-t.rA.y*s),m.x+=T*s,m.y+=T*n,p+=S*(t.rB.x*n-t.rB.y*s),t.tangentImpulse=r;if(parseInt(o.pointCount),1==o.pointCount)t=o.points[0],n=m.x+-p*t.rB.y-f.x- -_*t.rA.y,r=m.y+p*t.rB.x-f.y-_*t.rA.x,o=n*a+r*l,n=-t.normalMass*(o-t.velocityBias),r=t.normalImpulse+n,r=r>0?r:0,n=r-t.normalImpulse,s=n*a,n*=l,f.x-=g*s,f.y-=g*n,_-=y*(t.rA.x*n-t.rA.y*s),m.x+=T*s,m.y+=T*n,p+=S*(t.rB.x*n-t.rB.y*s),t.normalImpulse=r;else{t=o.points[0];var i=o.points[1],n=t.normalImpulse,c=i.normalImpulse,v=(m.x-p*t.rB.y-f.x+_*t.rA.y)*a+(m.y+p*t.rB.x-f.y-_*t.rA.x)*l,E=(m.x-p*i.rB.y-f.x+_*i.rA.y)*a+(m.y+p*i.rB.x-f.y-_*i.rA.x)*l,r=v-t.velocityBias,s=E-i.velocityBias;for(e=o.K,r-=e.col1.x*n+e.col2.x*c,s-=e.col1.y*n+e.col2.y*c;;){if(e=o.normalMass,C=-(e.col1.x*r+e.col2.x*s),e=-(e.col1.y*r+e.col2.y*s),C>=0&&e>=0){n=C-n,c=e-c,o=n*a,n*=l,a*=c,l*=c,f.x-=g*(o+a),f.y-=g*(n+l),_-=y*(t.rA.x*n-t.rA.y*o+i.rA.x*l-i.rA.y*a),m.x+=T*(o+a),m.y+=T*(n+l),p+=S*(t.rB.x*n-t.rB.y*o+i.rB.x*l-i.rB.y*a),t.normalImpulse=C,i.normalImpulse=e;break}if(C=-t.normalMass*r,e=0,E=o.K.col1.y*C+s,C>=0&&E>=0){n=C-n,c=e-c,o=n*a,n*=l,a*=c,l*=c,f.x-=g*(o+a),f.y-=g*(n+l),_-=y*(t.rA.x*n-t.rA.y*o+i.rA.x*l-i.rA.y*a),m.x+=T*(o+a),m.y+=T*(n+l),p+=S*(t.rB.x*n-t.rB.y*o+i.rB.x*l-i.rB.y*a),t.normalImpulse=C,i.normalImpulse=e;break}if(C=0,e=-i.normalMass*s,v=o.K.col2.x*e+r,e>=0&&v>=0){n=C-n,c=e-c,o=n*a,n*=l,a*=c,l*=c,f.x-=g*(o+a),f.y-=g*(n+l),_-=y*(t.rA.x*n-t.rA.y*o+i.rA.x*l-i.rA.y*a),m.x+=T*(o+a),m.y+=T*(n+l),p+=S*(t.rB.x*n-t.rB.y*o+i.rB.x*l-i.rB.y*a),t.normalImpulse=C,i.normalImpulse=e;break}if(e=C=0,v=r,E=s,v>=0&&E>=0){n=C-n,c=e-c,o=n*a,n*=l,a*=c,l*=c,f.x-=g*(o+a),f.y-=g*(n+l),_-=y*(t.rA.x*n-t.rA.y*o+i.rA.x*l-i.rA.y*a),m.x+=T*(o+a),m.y+=T*(n+l),p+=S*(t.rB.x*n-t.rB.y*o+i.rB.x*l-i.rB.y*a),t.normalImpulse=C,i.normalImpulse=e;break}break}}u.m_angularVelocity=_,d.m_angularVelocity=p}},d.prototype.FinalizeVelocityConstraints=function(){for(var t=0;t<this.m_constraintCount;++t)for(var e=this.m_constraints[t],i=e.manifold,n=0;n<e.pointCount;++n){var r=i.m_points[n],o=e.points[n];r.m_normalImpulse=o.normalImpulse,r.m_tangentImpulse=o.tangentImpulse}},d.prototype.SolvePositionConstraints=function(t){void 0===t&&(t=0);for(var e=0,i=0;i<this.m_constraintCount;i++){var n=this.m_constraints[i],r=n.bodyA,o=n.bodyB,s=r.m_mass*r.m_invMass,c=r.m_mass*r.m_invI,a=o.m_mass*o.m_invMass,l=o.m_mass*o.m_invI;d.s_psm.Initialize(n);for(var h=d.s_psm.m_normal,u=0;u<n.pointCount;u++){var _=n.points[u],p=d.s_psm.m_points[u],f=d.s_psm.m_separations[u],m=p.x-r.m_sweep.c.x,g=p.y-r.m_sweep.c.y,y=p.x-o.m_sweep.c.x,p=p.y-o.m_sweep.c.y,e=f>e?e:f,f=x.Clamp(t*(f+C.b2_linearSlop),-C.b2_maxLinearCorrection,0),f=-_.equalizedMass*f,_=f*h.x,f=f*h.y;r.m_sweep.c.x-=s*_,r.m_sweep.c.y-=s*f,r.m_sweep.a-=c*(m*f-g*_),r.SynchronizeTransform(),o.m_sweep.c.x+=a*_,o.m_sweep.c.y+=a*f,o.m_sweep.a+=l*(y*f-p*_),o.SynchronizeTransform()}}return e>-1.5*C.b2_linearSlop},Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold=new w,Box2D.Dynamics.Contacts.b2ContactSolver.s_psm=new y}),Box2D.inherit(_,Box2D.Dynamics.Contacts.b2Contact),_.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,_.b2EdgeAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},_.Create=function(){return new _},_.Destroy=function(){},_.prototype.Reset=function(t,e){this.__super.Reset.call(this,t,e)},_.prototype.Evaluate=function(){var i=this.m_fixtureA.GetBody(),n=this.m_fixtureB.GetBody();this.b2CollideEdgeAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof e?this.m_fixtureA.GetShape():null,i.m_xf,this.m_fixtureB.GetShape()instanceof t?this.m_fixtureB.GetShape():null,n.m_xf)},_.prototype.b2CollideEdgeAndCircle=function(){},Box2D.inherit(p,Box2D.Dynamics.Contacts.b2Contact),p.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,p.b2NullContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},p.prototype.b2NullContact=function(){this.__super.b2Contact.call(this)},p.prototype.Evaluate=function(){},Box2D.inherit(f,Box2D.Dynamics.Contacts.b2Contact),f.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,f.b2PolyAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},f.Create=function(){return new f},f.Destroy=function(){},f.prototype.Reset=function(t,e){this.__super.Reset.call(this,t,e),C.b2Assert(t.GetType()==n.e_polygonShape),C.b2Assert(e.GetType()==n.e_circleShape)},f.prototype.Evaluate=function(){var e=this.m_fixtureA.m_body,n=this.m_fixtureB.m_body;b.CollidePolygonAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof i?this.m_fixtureA.GetShape():null,e.m_xf,this.m_fixtureB.GetShape()instanceof t?this.m_fixtureB.GetShape():null,n.m_xf)},Box2D.inherit(m,Box2D.Dynamics.Contacts.b2Contact),m.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,m.b2PolyAndEdgeContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},m.Create=function(){return new m},m.Destroy=function(){},m.prototype.Reset=function(t,e){this.__super.Reset.call(this,t,e),C.b2Assert(t.GetType()==n.e_polygonShape),C.b2Assert(e.GetType()==n.e_edgeShape)},m.prototype.Evaluate=function(){var t=this.m_fixtureA.GetBody(),n=this.m_fixtureB.GetBody();this.b2CollidePolyAndEdge(this.m_manifold,this.m_fixtureA.GetShape()instanceof i?this.m_fixtureA.GetShape():null,t.m_xf,this.m_fixtureB.GetShape()instanceof e?this.m_fixtureB.GetShape():null,n.m_xf)},m.prototype.b2CollidePolyAndEdge=function(){},Box2D.inherit(g,Box2D.Dynamics.Contacts.b2Contact),g.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,g.b2PolygonContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},g.Create=function(){return new g},g.Destroy=function(){},g.prototype.Reset=function(t,e){this.__super.Reset.call(this,t,e)},g.prototype.Evaluate=function(){var t=this.m_fixtureA.GetBody(),e=this.m_fixtureB.GetBody();b.CollidePolygons(this.m_manifold,this.m_fixtureA.GetShape()instanceof i?this.m_fixtureA.GetShape():null,t.m_xf,this.m_fixtureB.GetShape()instanceof i?this.m_fixtureB.GetShape():null,e.m_xf)},y.b2PositionSolverManifold=function(){},y.prototype.b2PositionSolverManifold=function(){this.m_normal=new E,this.m_separations=new Vector_a2j_Number(C.b2_maxManifoldPoints),this.m_points=new Vector(C.b2_maxManifoldPoints);for(var t=0;t<C.b2_maxManifoldPoints;t++)this.m_points[t]=new E},y.prototype.Initialize=function(t){C.b2Assert(0<t.pointCount);var e,i=0,n=0,r=0,o=0,s=0;switch(t.type){case R.e_circles:e=t.bodyA.m_xf.R,r=t.localPoint,i=t.bodyA.m_xf.position.x+(e.col1.x*r.x+e.col2.x*r.y),n=t.bodyA.m_xf.position.y+(e.col1.y*r.x+e.col2.y*r.y),e=t.bodyB.m_xf.R,r=t.points[0].localPoint,o=t.bodyB.m_xf.position.x+(e.col1.x*r.x+e.col2.x*r.y),e=t.bodyB.m_xf.position.y+(e.col1.y*r.x+e.col2.y*r.y);var r=o-i,s=e-n,c=r*r+s*s;c>Number.MIN_VALUE*Number.MIN_VALUE?(c=Math.sqrt(c),this.m_normal.x=r/c,this.m_normal.y=s/c):(this.m_normal.x=1,this.m_normal.y=0),this.m_points[0].x=.5*(i+o),this.m_points[0].y=.5*(n+e),this.m_separations[0]=r*this.m_normal.x+s*this.m_normal.y-t.radius;break;case R.e_faceA:for(e=t.bodyA.m_xf.R,r=t.localPlaneNormal,this.m_normal.x=e.col1.x*r.x+e.col2.x*r.y,this.m_normal.y=e.col1.y*r.x+e.col2.y*r.y,e=t.bodyA.m_xf.R,r=t.localPoint,o=t.bodyA.m_xf.position.x+(e.col1.x*r.x+e.col2.x*r.y),s=t.bodyA.m_xf.position.y+(e.col1.y*r.x+e.col2.y*r.y),e=t.bodyB.m_xf.R,i=0;i<t.pointCount;++i)r=t.points[i].localPoint,n=t.bodyB.m_xf.position.x+(e.col1.x*r.x+e.col2.x*r.y),r=t.bodyB.m_xf.position.y+(e.col1.y*r.x+e.col2.y*r.y),this.m_separations[i]=(n-o)*this.m_normal.x+(r-s)*this.m_normal.y-t.radius,this.m_points[i].x=n,this.m_points[i].y=r;break;case R.e_faceB:for(e=t.bodyB.m_xf.R,r=t.localPlaneNormal,this.m_normal.x=e.col1.x*r.x+e.col2.x*r.y,this.m_normal.y=e.col1.y*r.x+e.col2.y*r.y,e=t.bodyB.m_xf.R,r=t.localPoint,o=t.bodyB.m_xf.position.x+(e.col1.x*r.x+e.col2.x*r.y),s=t.bodyB.m_xf.position.y+(e.col1.y*r.x+e.col2.y*r.y),e=t.bodyA.m_xf.R,i=0;i<t.pointCount;++i)r=t.points[i].localPoint,n=t.bodyA.m_xf.position.x+(e.col1.x*r.x+e.col2.x*r.y),r=t.bodyA.m_xf.position.y+(e.col1.y*r.x+e.col2.y*r.y),this.m_separations[i]=(n-o)*this.m_normal.x+(r-s)*this.m_normal.y-t.radius,this.m_points[i].Set(n,r);this.m_normal.x*=-1,this.m_normal.y*=-1}},Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointA=new E,Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointB=new E})}(),function(){var t=Box2D.Common.Math.b2Mat22,e=Box2D.Common.Math.b2Math,i=Box2D.Common.Math.b2Vec2,n=Box2D.Common.b2Color,r=Box2D.Dynamics.Controllers.b2BuoyancyController,o=Box2D.Dynamics.Controllers.b2ConstantAccelController,s=Box2D.Dynamics.Controllers.b2ConstantForceController,c=Box2D.Dynamics.Controllers.b2Controller,a=Box2D.Dynamics.Controllers.b2ControllerEdge,l=Box2D.Dynamics.Controllers.b2GravityController,h=Box2D.Dynamics.Controllers.b2TensorDampingController;Box2D.inherit(r,Box2D.Dynamics.Controllers.b2Controller),r.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,r.b2BuoyancyController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.normal=new i(0,-1),this.density=this.offset=0,this.velocity=new i(0,0),this.linearDrag=2,this.angularDrag=1,this.useDensity=!1,this.useWorldGravity=!0,this.gravity=null},r.prototype.Step=function(t){if(this.m_bodyList)for(this.useWorldGravity&&(this.gravity=this.GetWorld().GetGravity().Copy()),t=this.m_bodyList;t;t=t.nextBody){var e=t.body;if(0!=e.IsAwake()){for(var n=new i,r=new i,o=0,s=0,c=e.GetFixtureList();c;c=c.GetNext()){var a=new i,l=c.GetShape().ComputeSubmergedArea(this.normal,this.offset,e.GetTransform(),a),o=o+l;n.x+=l*a.x,n.y+=l*a.y;var h=0,h=1,s=s+l*h;r.x+=l*a.x*h,r.y+=l*a.y*h}n.x/=o,n.y/=o,r.x/=s,r.y/=s,o<Number.MIN_VALUE||(s=this.gravity.GetNegative(),s.Multiply(this.density*o),e.ApplyForce(s,r),r=e.GetLinearVelocityFromWorldPoint(n),r.Subtract(this.velocity),r.Multiply(-this.linearDrag*o),e.ApplyForce(r,n),e.ApplyTorque(-e.GetInertia()/e.GetMass()*o*e.GetAngularVelocity()*this.angularDrag))}}},r.prototype.Draw=function(t){var e=new i,r=new i;e.x=this.normal.x*this.offset+1e3*this.normal.y,e.y=this.normal.y*this.offset-1e3*this.normal.x,r.x=this.normal.x*this.offset-1e3*this.normal.y,r.y=this.normal.y*this.offset+1e3*this.normal.x;var o=new n(0,0,1);t.DrawSegment(e,r,o)},Box2D.inherit(o,Box2D.Dynamics.Controllers.b2Controller),o.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,o.b2ConstantAccelController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.A=new i(0,0)},o.prototype.Step=function(t){t=new i(this.A.x*t.dt,this.A.y*t.dt);for(var e=this.m_bodyList;e;e=e.nextBody){var n=e.body;n.IsAwake()&&n.SetLinearVelocity(new i(n.GetLinearVelocity().x+t.x,n.GetLinearVelocity().y+t.y))}},Box2D.inherit(s,Box2D.Dynamics.Controllers.b2Controller),s.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,s.b2ConstantForceController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.F=new i(0,0)},s.prototype.Step=function(t){for(t=this.m_bodyList;t;t=t.nextBody){var e=t.body;e.IsAwake()&&e.ApplyForce(this.F,e.GetWorldCenter())}},c.b2Controller=function(){},c.prototype.Step=function(){},c.prototype.Draw=function(){},c.prototype.AddBody=function(t){var e=new a;e.controller=this,e.body=t,e.nextBody=this.m_bodyList,e.prevBody=null,this.m_bodyList=e,e.nextBody&&(e.nextBody.prevBody=e),this.m_bodyCount++,e.nextController=t.m_controllerList,e.prevController=null,t.m_controllerList=e,e.nextController&&(e.nextController.prevController=e),t.m_controllerCount++},c.prototype.RemoveBody=function(t){for(var e=t.m_controllerList;e&&e.controller!=this;)e=e.nextController;e.prevBody&&(e.prevBody.nextBody=e.nextBody),e.nextBody&&(e.nextBody.prevBody=e.prevBody),e.nextController&&(e.nextController.prevController=e.prevController),e.prevController&&(e.prevController.nextController=e.nextController),this.m_bodyList==e&&(this.m_bodyList=e.nextBody),t.m_controllerList==e&&(t.m_controllerList=e.nextController),t.m_controllerCount--,this.m_bodyCount--},c.prototype.Clear=function(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body)},c.prototype.GetNext=function(){return this.m_next},c.prototype.GetWorld=function(){return this.m_world},c.prototype.GetBodyList=function(){return this.m_bodyList},a.b2ControllerEdge=function(){},Box2D.inherit(l,Box2D.Dynamics.Controllers.b2Controller),l.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,l.b2GravityController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.G=1,this.invSqr=!0},l.prototype.Step=function(t){var e=t=null,n=null,r=0,o=null,s=null,c=null,a=0,l=0,h=0,a=null;if(this.invSqr)for(t=this.m_bodyList;t;t=t.nextBody)for(e=t.body,n=e.GetWorldCenter(),r=e.GetMass(),o=this.m_bodyList;o!=t;o=o.nextBody)s=o.body,c=s.GetWorldCenter(),a=c.x-n.x,l=c.y-n.y,h=a*a+l*l,h<Number.MIN_VALUE||(a=new i(a,l),a.Multiply(this.G/h/Math.sqrt(h)*r*s.GetMass()),e.IsAwake()&&e.ApplyForce(a,n),a.Multiply(-1),s.IsAwake()&&s.ApplyForce(a,c));else for(t=this.m_bodyList;t;t=t.nextBody)for(e=t.body,n=e.GetWorldCenter(),r=e.GetMass(),o=this.m_bodyList;o!=t;o=o.nextBody)s=o.body,c=s.GetWorldCenter(),a=c.x-n.x,l=c.y-n.y,h=a*a+l*l,h<Number.MIN_VALUE||(a=new i(a,l),a.Multiply(this.G/h*r*s.GetMass()),e.IsAwake()&&e.ApplyForce(a,n),a.Multiply(-1),s.IsAwake()&&s.ApplyForce(a,c))},Box2D.inherit(h,Box2D.Dynamics.Controllers.b2Controller),h.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,h.b2TensorDampingController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.T=new t,this.maxTimestep=0},h.prototype.SetAxisAligned=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.T.col1.x=-t,this.T.col1.y=0,this.T.col2.x=0,this.T.col2.y=-e,this.maxTimestep=t>0||e>0?1/Math.max(t,e):0},h.prototype.Step=function(t){if(t=t.dt,!(t<=Number.MIN_VALUE)){t>this.maxTimestep&&0<this.maxTimestep&&(t=this.maxTimestep);for(var n=this.m_bodyList;n;n=n.nextBody){var r=n.body;if(r.IsAwake()){var o=r.GetWorldVector(e.MulMV(this.T,r.GetLocalVector(r.GetLinearVelocity())));r.SetLinearVelocity(new i(r.GetLinearVelocity().x+o.x*t,r.GetLinearVelocity().y+o.y*t))}}}}}(),function(){var t=Box2D.Common.b2Settings,e=Box2D.Common.Math.b2Mat22,i=Box2D.Common.Math.b2Mat33,n=Box2D.Common.Math.b2Math,r=Box2D.Common.Math.b2Vec2,o=Box2D.Common.Math.b2Vec3,s=Box2D.Dynamics.Joints.b2DistanceJoint,c=Box2D.Dynamics.Joints.b2DistanceJointDef,a=Box2D.Dynamics.Joints.b2FrictionJoint,l=Box2D.Dynamics.Joints.b2FrictionJointDef,h=Box2D.Dynamics.Joints.b2GearJoint,u=Box2D.Dynamics.Joints.b2GearJointDef,d=Box2D.Dynamics.Joints.b2Jacobian,_=Box2D.Dynamics.Joints.b2Joint,p=Box2D.Dynamics.Joints.b2JointDef,f=Box2D.Dynamics.Joints.b2JointEdge,m=Box2D.Dynamics.Joints.b2LineJoint,g=Box2D.Dynamics.Joints.b2LineJointDef,y=Box2D.Dynamics.Joints.b2MouseJoint,T=Box2D.Dynamics.Joints.b2MouseJointDef,S=Box2D.Dynamics.Joints.b2PrismaticJoint,C=Box2D.Dynamics.Joints.b2PrismaticJointDef,v=Box2D.Dynamics.Joints.b2PulleyJoint,x=Box2D.Dynamics.Joints.b2PulleyJointDef,E=Box2D.Dynamics.Joints.b2RevoluteJoint,b=Box2D.Dynamics.Joints.b2RevoluteJointDef,A=Box2D.Dynamics.Joints.b2WeldJoint,R=Box2D.Dynamics.Joints.b2WeldJointDef;Box2D.inherit(s,Box2D.Dynamics.Joints.b2Joint),s.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,s.b2DistanceJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new r,this.m_localAnchor2=new r,this.m_u=new r},s.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},s.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},s.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new r(t*this.m_impulse*this.m_u.x,t*this.m_impulse*this.m_u.y)},s.prototype.GetReactionTorque=function(){return 0},s.prototype.GetLength=function(){return this.m_length},s.prototype.SetLength=function(t){void 0===t&&(t=0),this.m_length=t},s.prototype.GetFrequency=function(){return this.m_frequencyHz},s.prototype.SetFrequency=function(t){void 0===t&&(t=0),this.m_frequencyHz=t},s.prototype.GetDampingRatio=function(){return this.m_dampingRatio},s.prototype.SetDampingRatio=function(t){void 0===t&&(t=0),this.m_dampingRatio=t},s.prototype.b2DistanceJoint=function(t){this.__super.b2Joint.call(this,t),this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_length=t.length,this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_bias=this.m_gamma=this.m_impulse=0},s.prototype.InitVelocityConstraints=function(e){var i,n=0,r=this.m_bodyA,o=this.m_bodyB;i=r.m_xf.R;var s=this.m_localAnchor1.x-r.m_sweep.localCenter.x,c=this.m_localAnchor1.y-r.m_sweep.localCenter.y,n=i.col1.x*s+i.col2.x*c,c=i.col1.y*s+i.col2.y*c,s=n;i=o.m_xf.R;var a=this.m_localAnchor2.x-o.m_sweep.localCenter.x,l=this.m_localAnchor2.y-o.m_sweep.localCenter.y,n=i.col1.x*a+i.col2.x*l,l=i.col1.y*a+i.col2.y*l,a=n;this.m_u.x=o.m_sweep.c.x+a-r.m_sweep.c.x-s,this.m_u.y=o.m_sweep.c.y+l-r.m_sweep.c.y-c,n=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y),n>t.b2_linearSlop?this.m_u.Multiply(1/n):this.m_u.SetZero(),i=s*this.m_u.y-c*this.m_u.x;var h=a*this.m_u.y-l*this.m_u.x;if(i=r.m_invMass+r.m_invI*i*i+o.m_invMass+o.m_invI*h*h,this.m_mass=0!=i?1/i:0,0<this.m_frequencyHz){var n=n-this.m_length,h=2*Math.PI*this.m_frequencyHz,u=this.m_mass*h*h;this.m_gamma=e.dt*(2*this.m_mass*this.m_dampingRatio*h+e.dt*u),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=n*e.dt*u*this.m_gamma,this.m_mass=i+this.m_gamma,this.m_mass=0!=this.m_mass?1/this.m_mass:0}e.warmStarting?(this.m_impulse*=e.dtRatio,e=this.m_impulse*this.m_u.x,i=this.m_impulse*this.m_u.y,r.m_linearVelocity.x-=r.m_invMass*e,r.m_linearVelocity.y-=r.m_invMass*i,r.m_angularVelocity-=r.m_invI*(s*i-c*e),o.m_linearVelocity.x+=o.m_invMass*e,o.m_linearVelocity.y+=o.m_invMass*i,o.m_angularVelocity+=o.m_invI*(a*i-l*e)):this.m_impulse=0},s.prototype.SolveVelocityConstraints=function(t){var e;t=this.m_bodyA;var i=this.m_bodyB;e=t.m_xf.R;var n=this.m_localAnchor1.x-t.m_sweep.localCenter.x,r=this.m_localAnchor1.y-t.m_sweep.localCenter.y,o=e.col1.x*n+e.col2.x*r,r=e.col1.y*n+e.col2.y*r,n=o;e=i.m_xf.R;var s=this.m_localAnchor2.x-i.m_sweep.localCenter.x,c=this.m_localAnchor2.y-i.m_sweep.localCenter.y,o=e.col1.x*s+e.col2.x*c,c=e.col1.y*s+e.col2.y*c,s=o,o=-this.m_mass*(this.m_u.x*(i.m_linearVelocity.x+-i.m_angularVelocity*c-(t.m_linearVelocity.x+-t.m_angularVelocity*r))+this.m_u.y*(i.m_linearVelocity.y+i.m_angularVelocity*s-(t.m_linearVelocity.y+t.m_angularVelocity*n))+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=o,e=o*this.m_u.x,o*=this.m_u.y,t.m_linearVelocity.x-=t.m_invMass*e,t.m_linearVelocity.y-=t.m_invMass*o,t.m_angularVelocity-=t.m_invI*(n*o-r*e),i.m_linearVelocity.x+=i.m_invMass*e,i.m_linearVelocity.y+=i.m_invMass*o,i.m_angularVelocity+=i.m_invI*(s*o-c*e)},s.prototype.SolvePositionConstraints=function(e){var i;if(0<this.m_frequencyHz)return!0;e=this.m_bodyA;var r=this.m_bodyB;i=e.m_xf.R;var o=this.m_localAnchor1.x-e.m_sweep.localCenter.x,s=this.m_localAnchor1.y-e.m_sweep.localCenter.y,c=i.col1.x*o+i.col2.x*s,s=i.col1.y*o+i.col2.y*s,o=c;i=r.m_xf.R;var a=this.m_localAnchor2.x-r.m_sweep.localCenter.x,l=this.m_localAnchor2.y-r.m_sweep.localCenter.y,c=i.col1.x*a+i.col2.x*l,l=i.col1.y*a+i.col2.y*l,a=c,c=r.m_sweep.c.x+a-e.m_sweep.c.x-o,h=r.m_sweep.c.y+l-e.m_sweep.c.y-s;i=Math.sqrt(c*c+h*h),c/=i,h/=i,i-=this.m_length,i=n.Clamp(i,-t.b2_maxLinearCorrection,t.b2_maxLinearCorrection);var u=-this.m_mass*i;return this.m_u.Set(c,h),c=u*this.m_u.x,h=u*this.m_u.y,e.m_sweep.c.x-=e.m_invMass*c,e.m_sweep.c.y-=e.m_invMass*h,e.m_sweep.a-=e.m_invI*(o*h-s*c),r.m_sweep.c.x+=r.m_invMass*c,r.m_sweep.c.y+=r.m_invMass*h,r.m_sweep.a+=r.m_invI*(a*h-l*c),e.SynchronizeTransform(),r.SynchronizeTransform(),n.Abs(i)<t.b2_linearSlop},Box2D.inherit(c,Box2D.Dynamics.Joints.b2JointDef),c.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,c.b2DistanceJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new r,this.localAnchorB=new r},c.prototype.b2DistanceJointDef=function(){this.__super.b2JointDef.call(this),this.type=_.e_distanceJoint,this.length=1,this.dampingRatio=this.frequencyHz=0},c.prototype.Initialize=function(t,e,i,n){this.bodyA=t,this.bodyB=e,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(i)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(n)),t=n.x-i.x,i=n.y-i.y,this.length=Math.sqrt(t*t+i*i),this.dampingRatio=this.frequencyHz=0},Box2D.inherit(a,Box2D.Dynamics.Joints.b2Joint),a.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,a.b2FrictionJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchorA=new r,this.m_localAnchorB=new r,this.m_linearMass=new e,this.m_linearImpulse=new r},a.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},a.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},a.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new r(t*this.m_linearImpulse.x,t*this.m_linearImpulse.y)},a.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),t*this.m_angularImpulse},a.prototype.SetMaxForce=function(t){void 0===t&&(t=0),this.m_maxForce=t},a.prototype.GetMaxForce=function(){return this.m_maxForce},a.prototype.SetMaxTorque=function(t){void 0===t&&(t=0),this.m_maxTorque=t},a.prototype.GetMaxTorque=function(){return this.m_maxTorque},a.prototype.b2FrictionJoint=function(t){this.__super.b2Joint.call(this,t),this.m_localAnchorA.SetV(t.localAnchorA),this.m_localAnchorB.SetV(t.localAnchorB),this.m_linearMass.SetZero(),this.m_angularMass=0,this.m_linearImpulse.SetZero(),this.m_angularImpulse=0,this.m_maxForce=t.maxForce,this.m_maxTorque=t.maxTorque},a.prototype.InitVelocityConstraints=function(t){var i,n=0,r=this.m_bodyA,o=this.m_bodyB;i=r.m_xf.R;var s=this.m_localAnchorA.x-r.m_sweep.localCenter.x,c=this.m_localAnchorA.y-r.m_sweep.localCenter.y,n=i.col1.x*s+i.col2.x*c,c=i.col1.y*s+i.col2.y*c,s=n;i=o.m_xf.R;var a=this.m_localAnchorB.x-o.m_sweep.localCenter.x,l=this.m_localAnchorB.y-o.m_sweep.localCenter.y,n=i.col1.x*a+i.col2.x*l,l=i.col1.y*a+i.col2.y*l,a=n;i=r.m_invMass;var n=o.m_invMass,h=r.m_invI,u=o.m_invI,d=new e;d.col1.x=i+n,d.col2.x=0,d.col1.y=0,d.col2.y=i+n,d.col1.x+=h*c*c,d.col2.x+=-h*s*c,d.col1.y+=-h*s*c,d.col2.y+=h*s*s,d.col1.x+=u*l*l,d.col2.x+=-u*a*l,d.col1.y+=-u*a*l,d.col2.y+=u*a*a,d.GetInverse(this.m_linearMass),this.m_angularMass=h+u,0<this.m_angularMass&&(this.m_angularMass=1/this.m_angularMass),t.warmStarting?(this.m_linearImpulse.x*=t.dtRatio,this.m_linearImpulse.y*=t.dtRatio,this.m_angularImpulse*=t.dtRatio,t=this.m_linearImpulse,r.m_linearVelocity.x-=i*t.x,r.m_linearVelocity.y-=i*t.y,r.m_angularVelocity-=h*(s*t.y-c*t.x+this.m_angularImpulse),o.m_linearVelocity.x+=n*t.x,o.m_linearVelocity.y+=n*t.y,o.m_angularVelocity+=u*(a*t.y-l*t.x+this.m_angularImpulse)):(this.m_linearImpulse.SetZero(),this.m_angularImpulse=0)},a.prototype.SolveVelocityConstraints=function(t){var e,i=0,o=this.m_bodyA,s=this.m_bodyB,c=o.m_linearVelocity,a=o.m_angularVelocity,l=s.m_linearVelocity,h=s.m_angularVelocity,u=o.m_invMass,d=s.m_invMass,_=o.m_invI,p=s.m_invI;e=o.m_xf.R;var f=this.m_localAnchorA.x-o.m_sweep.localCenter.x,m=this.m_localAnchorA.y-o.m_sweep.localCenter.y,i=e.col1.x*f+e.col2.x*m,m=e.col1.y*f+e.col2.y*m,f=i;e=s.m_xf.R;var g=this.m_localAnchorB.x-s.m_sweep.localCenter.x,y=this.m_localAnchorB.y-s.m_sweep.localCenter.y,i=e.col1.x*g+e.col2.x*y,y=e.col1.y*g+e.col2.y*y,g=i;e=0;var i=-this.m_angularMass*(h-a),T=this.m_angularImpulse;e=t.dt*this.m_maxTorque,this.m_angularImpulse=n.Clamp(this.m_angularImpulse+i,-e,e),i=this.m_angularImpulse-T,a-=_*i,h+=p*i,e=n.MulMV(this.m_linearMass,new r(-(l.x-h*y-c.x+a*m),-(l.y+h*g-c.y-a*f))),i=this.m_linearImpulse.Copy(),this.m_linearImpulse.Add(e),e=t.dt*this.m_maxForce,this.m_linearImpulse.LengthSquared()>e*e&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Multiply(e)),e=n.SubtractVV(this.m_linearImpulse,i),c.x-=u*e.x,c.y-=u*e.y,a-=_*(f*e.y-m*e.x),l.x+=d*e.x,l.y+=d*e.y,h+=p*(g*e.y-y*e.x),o.m_angularVelocity=a,s.m_angularVelocity=h},a.prototype.SolvePositionConstraints=function(){return!0},Box2D.inherit(l,Box2D.Dynamics.Joints.b2JointDef),l.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,l.b2FrictionJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new r,this.localAnchorB=new r},l.prototype.b2FrictionJointDef=function(){this.__super.b2JointDef.call(this),this.type=_.e_frictionJoint,this.maxTorque=this.maxForce=0},l.prototype.Initialize=function(t,e,i){this.bodyA=t,this.bodyB=e,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(i)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(i))},Box2D.inherit(h,Box2D.Dynamics.Joints.b2Joint),h.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,h.b2GearJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_groundAnchor1=new r,this.m_groundAnchor2=new r,this.m_localAnchor1=new r,this.m_localAnchor2=new r,this.m_J=new d},h.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},h.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},h.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new r(t*this.m_impulse*this.m_J.linearB.x,t*this.m_impulse*this.m_J.linearB.y)},h.prototype.GetReactionTorque=function(t){void 0===t&&(t=0);var e=this.m_bodyB.m_xf.R,i=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x,n=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y,r=e.col1.x*i+e.col2.x*n,n=e.col1.y*i+e.col2.y*n;return t*(this.m_impulse*this.m_J.angularB-r*this.m_impulse*this.m_J.linearB.y+n*this.m_impulse*this.m_J.linearB.x)},h.prototype.GetRatio=function(){return this.m_ratio},h.prototype.SetRatio=function(t){void 0===t&&(t=0),this.m_ratio=t},h.prototype.b2GearJoint=function(t){this.__super.b2Joint.call(this,t);var e=parseInt(t.joint1.m_type),i=parseInt(t.joint2.m_type);this.m_prismatic2=this.m_revolute2=this.m_prismatic1=this.m_revolute1=null;var n=0,r=0;this.m_ground1=t.joint1.GetBodyA(),this.m_bodyA=t.joint1.GetBodyB(),e==_.e_revoluteJoint?(this.m_revolute1=t.joint1 instanceof E?t.joint1:null,this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2),n=this.m_revolute1.GetJointAngle()):(this.m_prismatic1=t.joint1 instanceof S?t.joint1:null,this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2),n=this.m_prismatic1.GetJointTranslation()),this.m_ground2=t.joint2.GetBodyA(),this.m_bodyB=t.joint2.GetBodyB(),i==_.e_revoluteJoint?(this.m_revolute2=t.joint2 instanceof E?t.joint2:null,this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2),r=this.m_revolute2.GetJointAngle()):(this.m_prismatic2=t.joint2 instanceof S?t.joint2:null,this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2),r=this.m_prismatic2.GetJointTranslation()),this.m_ratio=t.ratio,this.m_constant=n+this.m_ratio*r,this.m_impulse=0
},h.prototype.InitVelocityConstraints=function(t){var e=this.m_ground1,i=this.m_ground2,n=this.m_bodyA,r=this.m_bodyB,o=0,s=0,c=0,a=0,l=c=0,h=0;this.m_J.SetZero(),this.m_revolute1?(this.m_J.angularA=-1,h+=n.m_invI):(e=e.m_xf.R,s=this.m_prismatic1.m_localXAxis1,o=e.col1.x*s.x+e.col2.x*s.y,s=e.col1.y*s.x+e.col2.y*s.y,e=n.m_xf.R,c=this.m_localAnchor1.x-n.m_sweep.localCenter.x,a=this.m_localAnchor1.y-n.m_sweep.localCenter.y,l=e.col1.x*c+e.col2.x*a,a=e.col1.y*c+e.col2.y*a,c=l*s-a*o,this.m_J.linearA.Set(-o,-s),this.m_J.angularA=-c,h+=n.m_invMass+n.m_invI*c*c),this.m_revolute2?(this.m_J.angularB=-this.m_ratio,h+=this.m_ratio*this.m_ratio*r.m_invI):(e=i.m_xf.R,s=this.m_prismatic2.m_localXAxis1,o=e.col1.x*s.x+e.col2.x*s.y,s=e.col1.y*s.x+e.col2.y*s.y,e=r.m_xf.R,c=this.m_localAnchor2.x-r.m_sweep.localCenter.x,a=this.m_localAnchor2.y-r.m_sweep.localCenter.y,l=e.col1.x*c+e.col2.x*a,a=e.col1.y*c+e.col2.y*a,c=l*s-a*o,this.m_J.linearB.Set(-this.m_ratio*o,-this.m_ratio*s),this.m_J.angularB=-this.m_ratio*c,h+=this.m_ratio*this.m_ratio*(r.m_invMass+r.m_invI*c*c)),this.m_mass=h>0?1/h:0,t.warmStarting?(n.m_linearVelocity.x+=n.m_invMass*this.m_impulse*this.m_J.linearA.x,n.m_linearVelocity.y+=n.m_invMass*this.m_impulse*this.m_J.linearA.y,n.m_angularVelocity+=n.m_invI*this.m_impulse*this.m_J.angularA,r.m_linearVelocity.x+=r.m_invMass*this.m_impulse*this.m_J.linearB.x,r.m_linearVelocity.y+=r.m_invMass*this.m_impulse*this.m_J.linearB.y,r.m_angularVelocity+=r.m_invI*this.m_impulse*this.m_J.angularB):this.m_impulse=0},h.prototype.SolveVelocityConstraints=function(t){t=this.m_bodyA;var e=this.m_bodyB,i=this.m_J.Compute(t.m_linearVelocity,t.m_angularVelocity,e.m_linearVelocity,e.m_angularVelocity),i=-this.m_mass*i;this.m_impulse+=i,t.m_linearVelocity.x+=t.m_invMass*i*this.m_J.linearA.x,t.m_linearVelocity.y+=t.m_invMass*i*this.m_J.linearA.y,t.m_angularVelocity+=t.m_invI*i*this.m_J.angularA,e.m_linearVelocity.x+=e.m_invMass*i*this.m_J.linearB.x,e.m_linearVelocity.y+=e.m_invMass*i*this.m_J.linearB.y,e.m_angularVelocity+=e.m_invI*i*this.m_J.angularB},h.prototype.SolvePositionConstraints=function(e){e=this.m_bodyA;var i=this.m_bodyB,n=0,r=0,n=this.m_revolute1?this.m_revolute1.GetJointAngle():this.m_prismatic1.GetJointTranslation(),r=this.m_revolute2?this.m_revolute2.GetJointAngle():this.m_prismatic2.GetJointTranslation(),n=-this.m_mass*(this.m_constant-(n+this.m_ratio*r));return e.m_sweep.c.x+=e.m_invMass*n*this.m_J.linearA.x,e.m_sweep.c.y+=e.m_invMass*n*this.m_J.linearA.y,e.m_sweep.a+=e.m_invI*n*this.m_J.angularA,i.m_sweep.c.x+=i.m_invMass*n*this.m_J.linearB.x,i.m_sweep.c.y+=i.m_invMass*n*this.m_J.linearB.y,i.m_sweep.a+=i.m_invI*n*this.m_J.angularB,e.SynchronizeTransform(),i.SynchronizeTransform(),0<t.b2_linearSlop},Box2D.inherit(u,Box2D.Dynamics.Joints.b2JointDef),u.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,u.b2GearJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments)},u.prototype.b2GearJointDef=function(){this.__super.b2JointDef.call(this),this.type=_.e_gearJoint,this.joint2=this.joint1=null,this.ratio=1},d.b2Jacobian=function(){this.linearA=new r,this.linearB=new r},d.prototype.SetZero=function(){this.linearA.SetZero(),this.angularA=0,this.linearB.SetZero(),this.angularB=0},d.prototype.Set=function(t,e,i,n){void 0===e&&(e=0),void 0===n&&(n=0),this.linearA.SetV(t),this.angularA=e,this.linearB.SetV(i),this.angularB=n},d.prototype.Compute=function(t,e,i,n){return void 0===e&&(e=0),void 0===n&&(n=0),this.linearA.x*t.x+this.linearA.y*t.y+this.angularA*e+(this.linearB.x*i.x+this.linearB.y*i.y)+this.angularB*n},_.b2Joint=function(){this.m_edgeA=new f,this.m_edgeB=new f,this.m_localCenterA=new r,this.m_localCenterB=new r},_.prototype.GetType=function(){return this.m_type},_.prototype.GetAnchorA=function(){return null},_.prototype.GetAnchorB=function(){return null},_.prototype.GetReactionForce=function(){return null},_.prototype.GetReactionTorque=function(){return 0},_.prototype.GetBodyA=function(){return this.m_bodyA},_.prototype.GetBodyB=function(){return this.m_bodyB},_.prototype.GetNext=function(){return this.m_next},_.prototype.GetUserData=function(){return this.m_userData},_.prototype.SetUserData=function(t){this.m_userData=t},_.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},_.Create=function(t){var e=null;switch(t.type){case _.e_distanceJoint:e=new s(t instanceof c?t:null);break;case _.e_mouseJoint:e=new y(t instanceof T?t:null);break;case _.e_prismaticJoint:e=new S(t instanceof C?t:null);break;case _.e_revoluteJoint:e=new E(t instanceof b?t:null);break;case _.e_pulleyJoint:e=new v(t instanceof x?t:null);break;case _.e_gearJoint:e=new h(t instanceof u?t:null);break;case _.e_lineJoint:e=new m(t instanceof g?t:null);break;case _.e_weldJoint:e=new A(t instanceof R?t:null);break;case _.e_frictionJoint:e=new a(t instanceof l?t:null)}return e},_.Destroy=function(){},_.prototype.b2Joint=function(e){t.b2Assert(e.bodyA!=e.bodyB),this.m_type=e.type,this.m_next=this.m_prev=null,this.m_bodyA=e.bodyA,this.m_bodyB=e.bodyB,this.m_collideConnected=e.collideConnected,this.m_islandFlag=!1,this.m_userData=e.userData},_.prototype.InitVelocityConstraints=function(){},_.prototype.SolveVelocityConstraints=function(){},_.prototype.FinalizeVelocityConstraints=function(){},_.prototype.SolvePositionConstraints=function(){return!1},Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2Joint.e_unknownJoint=0,Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint=1,Box2D.Dynamics.Joints.b2Joint.e_prismaticJoint=2,Box2D.Dynamics.Joints.b2Joint.e_distanceJoint=3,Box2D.Dynamics.Joints.b2Joint.e_pulleyJoint=4,Box2D.Dynamics.Joints.b2Joint.e_mouseJoint=5,Box2D.Dynamics.Joints.b2Joint.e_gearJoint=6,Box2D.Dynamics.Joints.b2Joint.e_lineJoint=7,Box2D.Dynamics.Joints.b2Joint.e_weldJoint=8,Box2D.Dynamics.Joints.b2Joint.e_frictionJoint=9,Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit=0,Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit=1,Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit=2,Box2D.Dynamics.Joints.b2Joint.e_equalLimits=3}),p.b2JointDef=function(){},p.prototype.b2JointDef=function(){this.type=_.e_unknownJoint,this.bodyB=this.bodyA=this.userData=null,this.collideConnected=!1},f.b2JointEdge=function(){},Box2D.inherit(m,Box2D.Dynamics.Joints.b2Joint),m.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,m.b2LineJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new r,this.m_localAnchor2=new r,this.m_localXAxis1=new r,this.m_localYAxis1=new r,this.m_axis=new r,this.m_perp=new r,this.m_K=new e,this.m_impulse=new r},m.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},m.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},m.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new r(t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),t*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))},m.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),t*this.m_impulse.y},m.prototype.GetJointTranslation=function(){var t=this.m_bodyA,e=this.m_bodyB,i=t.GetWorldPoint(this.m_localAnchor1),n=e.GetWorldPoint(this.m_localAnchor2),e=n.x-i.x,i=n.y-i.y,t=t.GetWorldVector(this.m_localXAxis1);return t.x*e+t.y*i},m.prototype.GetJointSpeed=function(){var t,e=this.m_bodyA,i=this.m_bodyB;t=e.m_xf.R;var n=this.m_localAnchor1.x-e.m_sweep.localCenter.x,r=this.m_localAnchor1.y-e.m_sweep.localCenter.y,o=t.col1.x*n+t.col2.x*r,r=t.col1.y*n+t.col2.y*r,n=o;t=i.m_xf.R;var s=this.m_localAnchor2.x-i.m_sweep.localCenter.x,c=this.m_localAnchor2.y-i.m_sweep.localCenter.y,o=t.col1.x*s+t.col2.x*c,c=t.col1.y*s+t.col2.y*c,s=o;t=i.m_sweep.c.x+s-(e.m_sweep.c.x+n);var o=i.m_sweep.c.y+c-(e.m_sweep.c.y+r),a=e.GetWorldVector(this.m_localXAxis1),l=e.m_linearVelocity,h=i.m_linearVelocity,e=e.m_angularVelocity,i=i.m_angularVelocity;return t*-e*a.y+o*e*a.x+(a.x*(h.x+-i*c-l.x- -e*r)+a.y*(h.y+i*s-l.y-e*n))},m.prototype.IsLimitEnabled=function(){return this.m_enableLimit},m.prototype.EnableLimit=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t},m.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},m.prototype.GetUpperLimit=function(){return this.m_upperTranslation},m.prototype.SetLimits=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=e},m.prototype.IsMotorEnabled=function(){return this.m_enableMotor},m.prototype.EnableMotor=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t},m.prototype.SetMotorSpeed=function(t){void 0===t&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t},m.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},m.prototype.SetMaxMotorForce=function(t){void 0===t&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=t},m.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce},m.prototype.GetMotorForce=function(){return this.m_motorImpulse},m.prototype.b2LineJoint=function(t){this.__super.b2Joint.call(this,t),this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_localXAxis1.SetV(t.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_impulse.SetZero(),this.m_motorImpulse=this.m_motorMass=0,this.m_lowerTranslation=t.lowerTranslation,this.m_upperTranslation=t.upperTranslation,this.m_maxMotorForce=t.maxMotorForce,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor,this.m_limitState=_.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},m.prototype.InitVelocityConstraints=function(e){var i,r=this.m_bodyA,o=this.m_bodyB,s=0;this.m_localCenterA.SetV(r.GetLocalCenter()),this.m_localCenterB.SetV(o.GetLocalCenter());var c=r.GetTransform();o.GetTransform(),i=r.m_xf.R;var a=this.m_localAnchor1.x-this.m_localCenterA.x,l=this.m_localAnchor1.y-this.m_localCenterA.y,s=i.col1.x*a+i.col2.x*l,l=i.col1.y*a+i.col2.y*l,a=s;i=o.m_xf.R;var h=this.m_localAnchor2.x-this.m_localCenterB.x,u=this.m_localAnchor2.y-this.m_localCenterB.y,s=i.col1.x*h+i.col2.x*u,u=i.col1.y*h+i.col2.y*u,h=s;i=o.m_sweep.c.x+h-r.m_sweep.c.x-a,s=o.m_sweep.c.y+u-r.m_sweep.c.y-l,this.m_invMassA=r.m_invMass,this.m_invMassB=o.m_invMass,this.m_invIA=r.m_invI,this.m_invIB=o.m_invI,this.m_axis.SetV(n.MulMV(c.R,this.m_localXAxis1)),this.m_a1=(i+a)*this.m_axis.y-(s+l)*this.m_axis.x,this.m_a2=h*this.m_axis.y-u*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass=this.m_motorMass>Number.MIN_VALUE?1/this.m_motorMass:0,this.m_perp.SetV(n.MulMV(c.R,this.m_localYAxis1)),this.m_s1=(i+a)*this.m_perp.y-(s+l)*this.m_perp.x,this.m_s2=h*this.m_perp.y-u*this.m_perp.x,c=this.m_invMassA,a=this.m_invMassB,l=this.m_invIA,h=this.m_invIB,this.m_K.col1.x=c+a+l*this.m_s1*this.m_s1+h*this.m_s2*this.m_s2,this.m_K.col1.y=l*this.m_s1*this.m_a1+h*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=c+a+l*this.m_a1*this.m_a1+h*this.m_a2*this.m_a2,this.m_enableLimit?(i=this.m_axis.x*i+this.m_axis.y*s,n.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*t.b2_linearSlop?this.m_limitState=_.e_equalLimits:i<=this.m_lowerTranslation?this.m_limitState!=_.e_atLowerLimit&&(this.m_limitState=_.e_atLowerLimit,this.m_impulse.y=0):i>=this.m_upperTranslation?this.m_limitState!=_.e_atUpperLimit&&(this.m_limitState=_.e_atUpperLimit,this.m_impulse.y=0):(this.m_limitState=_.e_inactiveLimit,this.m_impulse.y=0)):this.m_limitState=_.e_inactiveLimit,0==this.m_enableMotor&&(this.m_motorImpulse=0),e.warmStarting?(this.m_impulse.x*=e.dtRatio,this.m_impulse.y*=e.dtRatio,this.m_motorImpulse*=e.dtRatio,e=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x,i=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y,s=this.m_impulse.x*this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*this.m_a1,c=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2,r.m_linearVelocity.x-=this.m_invMassA*e,r.m_linearVelocity.y-=this.m_invMassA*i,r.m_angularVelocity-=this.m_invIA*s,o.m_linearVelocity.x+=this.m_invMassB*e,o.m_linearVelocity.y+=this.m_invMassB*i,o.m_angularVelocity+=this.m_invIB*c):(this.m_impulse.SetZero(),this.m_motorImpulse=0)},m.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyA,i=this.m_bodyB,o=e.m_linearVelocity,s=e.m_angularVelocity,c=i.m_linearVelocity,a=i.m_angularVelocity,l=0,h=0,u=0,d=0;this.m_enableMotor&&this.m_limitState!=_.e_equalLimits&&(d=this.m_motorMass*(this.m_motorSpeed-(this.m_axis.x*(c.x-o.x)+this.m_axis.y*(c.y-o.y)+this.m_a2*a-this.m_a1*s)),l=this.m_motorImpulse,h=t.dt*this.m_maxMotorForce,this.m_motorImpulse=n.Clamp(this.m_motorImpulse+d,-h,h),d=this.m_motorImpulse-l,l=d*this.m_axis.x,h=d*this.m_axis.y,u=d*this.m_a1,d*=this.m_a2,o.x-=this.m_invMassA*l,o.y-=this.m_invMassA*h,s-=this.m_invIA*u,c.x+=this.m_invMassB*l,c.y+=this.m_invMassB*h,a+=this.m_invIB*d),h=this.m_perp.x*(c.x-o.x)+this.m_perp.y*(c.y-o.y)+this.m_s2*a-this.m_s1*s,this.m_enableLimit&&this.m_limitState!=_.e_inactiveLimit?(u=this.m_axis.x*(c.x-o.x)+this.m_axis.y*(c.y-o.y)+this.m_a2*a-this.m_a1*s,l=this.m_impulse.Copy(),t=this.m_K.Solve(new r,-h,-u),this.m_impulse.Add(t),this.m_limitState==_.e_atLowerLimit?this.m_impulse.y=n.Max(this.m_impulse.y,0):this.m_limitState==_.e_atUpperLimit&&(this.m_impulse.y=n.Min(this.m_impulse.y,0)),h=-h-(this.m_impulse.y-l.y)*this.m_K.col2.x,u=0,u=0!=this.m_K.col1.x?h/this.m_K.col1.x+l.x:l.x,this.m_impulse.x=u,t.x=this.m_impulse.x-l.x,t.y=this.m_impulse.y-l.y,l=t.x*this.m_perp.x+t.y*this.m_axis.x,h=t.x*this.m_perp.y+t.y*this.m_axis.y,u=t.x*this.m_s1+t.y*this.m_a1,d=t.x*this.m_s2+t.y*this.m_a2):(t=0,t=0!=this.m_K.col1.x?-h/this.m_K.col1.x:0,this.m_impulse.x+=t,l=t*this.m_perp.x,h=t*this.m_perp.y,u=t*this.m_s1,d=t*this.m_s2),o.x-=this.m_invMassA*l,o.y-=this.m_invMassA*h,s-=this.m_invIA*u,c.x+=this.m_invMassB*l,c.y+=this.m_invMassB*h,a+=this.m_invIB*d,e.m_linearVelocity.SetV(o),e.m_angularVelocity=s,i.m_linearVelocity.SetV(c),i.m_angularVelocity=a},m.prototype.SolvePositionConstraints=function(i){i=this.m_bodyA;var o,s=this.m_bodyB,c=i.m_sweep.c,a=i.m_sweep.a,l=s.m_sweep.c,h=s.m_sweep.a,u=0,d=0,_=0,p=0,f=o=0,m=0,d=!1,g=0,y=e.FromAngle(a),_=e.FromAngle(h);o=y;var m=this.m_localAnchor1.x-this.m_localCenterA.x,T=this.m_localAnchor1.y-this.m_localCenterA.y,u=o.col1.x*m+o.col2.x*T,T=o.col1.y*m+o.col2.y*T,m=u;if(o=_,_=this.m_localAnchor2.x-this.m_localCenterB.x,p=this.m_localAnchor2.y-this.m_localCenterB.y,u=o.col1.x*_+o.col2.x*p,p=o.col1.y*_+o.col2.y*p,_=u,o=l.x+_-c.x-m,u=l.y+p-c.y-T,this.m_enableLimit){this.m_axis=n.MulMV(y,this.m_localXAxis1),this.m_a1=(o+m)*this.m_axis.y-(u+T)*this.m_axis.x,this.m_a2=_*this.m_axis.y-p*this.m_axis.x;var S=this.m_axis.x*o+this.m_axis.y*u;n.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*t.b2_linearSlop?(g=n.Clamp(S,-t.b2_maxLinearCorrection,t.b2_maxLinearCorrection),f=n.Abs(S),d=!0):S<=this.m_lowerTranslation?(g=n.Clamp(S-this.m_lowerTranslation+t.b2_linearSlop,-t.b2_maxLinearCorrection,0),f=this.m_lowerTranslation-S,d=!0):S>=this.m_upperTranslation&&(g=n.Clamp(S-this.m_upperTranslation+t.b2_linearSlop,0,t.b2_maxLinearCorrection),f=S-this.m_upperTranslation,d=!0)}return this.m_perp=n.MulMV(y,this.m_localYAxis1),this.m_s1=(o+m)*this.m_perp.y-(u+T)*this.m_perp.x,this.m_s2=_*this.m_perp.y-p*this.m_perp.x,y=new r,T=this.m_perp.x*o+this.m_perp.y*u,f=n.Max(f,n.Abs(T)),m=0,d?(d=this.m_invMassA,_=this.m_invMassB,p=this.m_invIA,o=this.m_invIB,this.m_K.col1.x=d+_+p*this.m_s1*this.m_s1+o*this.m_s2*this.m_s2,this.m_K.col1.y=p*this.m_s1*this.m_a1+o*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=d+_+p*this.m_a1*this.m_a1+o*this.m_a2*this.m_a2,this.m_K.Solve(y,-T,-g)):(d=this.m_invMassA,_=this.m_invMassB,p=this.m_invIA,o=this.m_invIB,g=d+_+p*this.m_s1*this.m_s1+o*this.m_s2*this.m_s2,y.x=0!=g?-T/g:0,y.y=0),g=y.x*this.m_perp.x+y.y*this.m_axis.x,d=y.x*this.m_perp.y+y.y*this.m_axis.y,T=y.x*this.m_s1+y.y*this.m_a1,y=y.x*this.m_s2+y.y*this.m_a2,c.x-=this.m_invMassA*g,c.y-=this.m_invMassA*d,a-=this.m_invIA*T,l.x+=this.m_invMassB*g,l.y+=this.m_invMassB*d,h+=this.m_invIB*y,i.m_sweep.a=a,s.m_sweep.a=h,i.SynchronizeTransform(),s.SynchronizeTransform(),f<=t.b2_linearSlop&&m<=t.b2_angularSlop},Box2D.inherit(g,Box2D.Dynamics.Joints.b2JointDef),g.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,g.b2LineJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new r,this.localAnchorB=new r,this.localAxisA=new r},g.prototype.b2LineJointDef=function(){this.__super.b2JointDef.call(this),this.type=_.e_lineJoint,this.localAxisA.Set(1,0),this.enableLimit=!1,this.upperTranslation=this.lowerTranslation=0,this.enableMotor=!1,this.motorSpeed=this.maxMotorForce=0},g.prototype.Initialize=function(t,e,i,n){this.bodyA=t,this.bodyB=e,this.localAnchorA=this.bodyA.GetLocalPoint(i),this.localAnchorB=this.bodyB.GetLocalPoint(i),this.localAxisA=this.bodyA.GetLocalVector(n)},Box2D.inherit(y,Box2D.Dynamics.Joints.b2Joint),y.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,y.b2MouseJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.K=new e,this.K1=new e,this.K2=new e,this.m_localAnchor=new r,this.m_target=new r,this.m_impulse=new r,this.m_mass=new e,this.m_C=new r},y.prototype.GetAnchorA=function(){return this.m_target},y.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor)},y.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new r(t*this.m_impulse.x,t*this.m_impulse.y)},y.prototype.GetReactionTorque=function(){return 0},y.prototype.GetTarget=function(){return this.m_target},y.prototype.SetTarget=function(t){0==this.m_bodyB.IsAwake()&&this.m_bodyB.SetAwake(!0),this.m_target=t},y.prototype.GetMaxForce=function(){return this.m_maxForce},y.prototype.SetMaxForce=function(t){void 0===t&&(t=0),this.m_maxForce=t},y.prototype.GetFrequency=function(){return this.m_frequencyHz},y.prototype.SetFrequency=function(t){void 0===t&&(t=0),this.m_frequencyHz=t},y.prototype.GetDampingRatio=function(){return this.m_dampingRatio},y.prototype.SetDampingRatio=function(t){void 0===t&&(t=0),this.m_dampingRatio=t},y.prototype.b2MouseJoint=function(t){this.__super.b2Joint.call(this,t),this.m_target.SetV(t.target);var e=this.m_target.x-this.m_bodyB.m_xf.position.x,i=this.m_target.y-this.m_bodyB.m_xf.position.y,n=this.m_bodyB.m_xf.R;this.m_localAnchor.x=e*n.col1.x+i*n.col1.y,this.m_localAnchor.y=e*n.col2.x+i*n.col2.y,this.m_maxForce=t.maxForce,this.m_impulse.SetZero(),this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_gamma=this.m_beta=0},y.prototype.InitVelocityConstraints=function(t){var e=this.m_bodyB,i=e.GetMass(),n=2*Math.PI*this.m_frequencyHz,r=i*n*n;this.m_gamma=t.dt*(2*i*this.m_dampingRatio*n+t.dt*r),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_beta=t.dt*r*this.m_gamma;var r=e.m_xf.R,i=this.m_localAnchor.x-e.m_sweep.localCenter.x,n=this.m_localAnchor.y-e.m_sweep.localCenter.y,o=r.col1.x*i+r.col2.x*n,n=r.col1.y*i+r.col2.y*n,i=o,r=e.m_invMass,o=e.m_invI;this.K1.col1.x=r,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=r,this.K2.col1.x=o*n*n,this.K2.col2.x=-o*i*n,this.K2.col1.y=-o*i*n,this.K2.col2.y=o*i*i,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.col1.x+=this.m_gamma,this.K.col2.y+=this.m_gamma,this.K.GetInverse(this.m_mass),this.m_C.x=e.m_sweep.c.x+i-this.m_target.x,this.m_C.y=e.m_sweep.c.y+n-this.m_target.y,e.m_angularVelocity*=.98,this.m_impulse.x*=t.dtRatio,this.m_impulse.y*=t.dtRatio,e.m_linearVelocity.x+=r*this.m_impulse.x,e.m_linearVelocity.y+=r*this.m_impulse.y,e.m_angularVelocity+=o*(i*this.m_impulse.y-n*this.m_impulse.x)},y.prototype.SolveVelocityConstraints=function(t){var e,i=this.m_bodyB,n=0,r=0;e=i.m_xf.R;var o=this.m_localAnchor.x-i.m_sweep.localCenter.x,s=this.m_localAnchor.y-i.m_sweep.localCenter.y,n=e.col1.x*o+e.col2.x*s,s=e.col1.y*o+e.col2.y*s,o=n,n=i.m_linearVelocity.x+-i.m_angularVelocity*s,c=i.m_linearVelocity.y+i.m_angularVelocity*o;e=this.m_mass,n=n+this.m_beta*this.m_C.x+this.m_gamma*this.m_impulse.x,r=c+this.m_beta*this.m_C.y+this.m_gamma*this.m_impulse.y,c=-(e.col1.x*n+e.col2.x*r),r=-(e.col1.y*n+e.col2.y*r),e=this.m_impulse.x,n=this.m_impulse.y,this.m_impulse.x+=c,this.m_impulse.y+=r,t=t.dt*this.m_maxForce,this.m_impulse.LengthSquared()>t*t&&this.m_impulse.Multiply(t/this.m_impulse.Length()),c=this.m_impulse.x-e,r=this.m_impulse.y-n,i.m_linearVelocity.x+=i.m_invMass*c,i.m_linearVelocity.y+=i.m_invMass*r,i.m_angularVelocity+=i.m_invI*(o*r-s*c)},y.prototype.SolvePositionConstraints=function(){return!0},Box2D.inherit(T,Box2D.Dynamics.Joints.b2JointDef),T.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,T.b2MouseJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.target=new r},T.prototype.b2MouseJointDef=function(){this.__super.b2JointDef.call(this),this.type=_.e_mouseJoint,this.maxForce=0,this.frequencyHz=5,this.dampingRatio=.7},Box2D.inherit(S,Box2D.Dynamics.Joints.b2Joint),S.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,S.b2PrismaticJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new r,this.m_localAnchor2=new r,this.m_localXAxis1=new r,this.m_localYAxis1=new r,this.m_axis=new r,this.m_perp=new r,this.m_K=new i,this.m_impulse=new o},S.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},S.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},S.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new r(t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),t*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))},S.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),t*this.m_impulse.y},S.prototype.GetJointTranslation=function(){var t=this.m_bodyA,e=this.m_bodyB,i=t.GetWorldPoint(this.m_localAnchor1),n=e.GetWorldPoint(this.m_localAnchor2),e=n.x-i.x,i=n.y-i.y,t=t.GetWorldVector(this.m_localXAxis1);return t.x*e+t.y*i},S.prototype.GetJointSpeed=function(){var t,e=this.m_bodyA,i=this.m_bodyB;t=e.m_xf.R;var n=this.m_localAnchor1.x-e.m_sweep.localCenter.x,r=this.m_localAnchor1.y-e.m_sweep.localCenter.y,o=t.col1.x*n+t.col2.x*r,r=t.col1.y*n+t.col2.y*r,n=o;t=i.m_xf.R;var s=this.m_localAnchor2.x-i.m_sweep.localCenter.x,c=this.m_localAnchor2.y-i.m_sweep.localCenter.y,o=t.col1.x*s+t.col2.x*c,c=t.col1.y*s+t.col2.y*c,s=o;t=i.m_sweep.c.x+s-(e.m_sweep.c.x+n);var o=i.m_sweep.c.y+c-(e.m_sweep.c.y+r),a=e.GetWorldVector(this.m_localXAxis1),l=e.m_linearVelocity,h=i.m_linearVelocity,e=e.m_angularVelocity,i=i.m_angularVelocity;return t*-e*a.y+o*e*a.x+(a.x*(h.x+-i*c-l.x- -e*r)+a.y*(h.y+i*s-l.y-e*n))},S.prototype.IsLimitEnabled=function(){return this.m_enableLimit},S.prototype.EnableLimit=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t},S.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},S.prototype.GetUpperLimit=function(){return this.m_upperTranslation},S.prototype.SetLimits=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=e},S.prototype.IsMotorEnabled=function(){return this.m_enableMotor},S.prototype.EnableMotor=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t},S.prototype.SetMotorSpeed=function(t){void 0===t&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t},S.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},S.prototype.SetMaxMotorForce=function(t){void 0===t&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=t},S.prototype.GetMotorForce=function(){return this.m_motorImpulse},S.prototype.b2PrismaticJoint=function(t){this.__super.b2Joint.call(this,t),this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_localXAxis1.SetV(t.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_refAngle=t.referenceAngle,this.m_impulse.SetZero(),this.m_motorImpulse=this.m_motorMass=0,this.m_lowerTranslation=t.lowerTranslation,this.m_upperTranslation=t.upperTranslation,this.m_maxMotorForce=t.maxMotorForce,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor,this.m_limitState=_.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},S.prototype.InitVelocityConstraints=function(e){var i,r=this.m_bodyA,o=this.m_bodyB,s=0;this.m_localCenterA.SetV(r.GetLocalCenter()),this.m_localCenterB.SetV(o.GetLocalCenter());var c=r.GetTransform();o.GetTransform(),i=r.m_xf.R;var a=this.m_localAnchor1.x-this.m_localCenterA.x,l=this.m_localAnchor1.y-this.m_localCenterA.y,s=i.col1.x*a+i.col2.x*l,l=i.col1.y*a+i.col2.y*l,a=s;i=o.m_xf.R;var h=this.m_localAnchor2.x-this.m_localCenterB.x,u=this.m_localAnchor2.y-this.m_localCenterB.y,s=i.col1.x*h+i.col2.x*u,u=i.col1.y*h+i.col2.y*u,h=s;i=o.m_sweep.c.x+h-r.m_sweep.c.x-a,s=o.m_sweep.c.y+u-r.m_sweep.c.y-l,this.m_invMassA=r.m_invMass,this.m_invMassB=o.m_invMass,this.m_invIA=r.m_invI,this.m_invIB=o.m_invI,this.m_axis.SetV(n.MulMV(c.R,this.m_localXAxis1)),this.m_a1=(i+a)*this.m_axis.y-(s+l)*this.m_axis.x,this.m_a2=h*this.m_axis.y-u*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass>Number.MIN_VALUE&&(this.m_motorMass=1/this.m_motorMass),this.m_perp.SetV(n.MulMV(c.R,this.m_localYAxis1)),this.m_s1=(i+a)*this.m_perp.y-(s+l)*this.m_perp.x,this.m_s2=h*this.m_perp.y-u*this.m_perp.x,c=this.m_invMassA,a=this.m_invMassB,l=this.m_invIA,h=this.m_invIB,this.m_K.col1.x=c+a+l*this.m_s1*this.m_s1+h*this.m_s2*this.m_s2,this.m_K.col1.y=l*this.m_s1+h*this.m_s2,this.m_K.col1.z=l*this.m_s1*this.m_a1+h*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=l+h,this.m_K.col2.z=l*this.m_a1+h*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=c+a+l*this.m_a1*this.m_a1+h*this.m_a2*this.m_a2,this.m_enableLimit?(i=this.m_axis.x*i+this.m_axis.y*s,n.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*t.b2_linearSlop?this.m_limitState=_.e_equalLimits:i<=this.m_lowerTranslation?this.m_limitState!=_.e_atLowerLimit&&(this.m_limitState=_.e_atLowerLimit,this.m_impulse.z=0):i>=this.m_upperTranslation?this.m_limitState!=_.e_atUpperLimit&&(this.m_limitState=_.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=_.e_inactiveLimit,this.m_impulse.z=0)):this.m_limitState=_.e_inactiveLimit,0==this.m_enableMotor&&(this.m_motorImpulse=0),e.warmStarting?(this.m_impulse.x*=e.dtRatio,this.m_impulse.y*=e.dtRatio,this.m_motorImpulse*=e.dtRatio,e=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x,i=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y,s=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,c=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2,r.m_linearVelocity.x-=this.m_invMassA*e,r.m_linearVelocity.y-=this.m_invMassA*i,r.m_angularVelocity-=this.m_invIA*s,o.m_linearVelocity.x+=this.m_invMassB*e,o.m_linearVelocity.y+=this.m_invMassB*i,o.m_angularVelocity+=this.m_invIB*c):(this.m_impulse.SetZero(),this.m_motorImpulse=0)},S.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyA,i=this.m_bodyB,s=e.m_linearVelocity,c=e.m_angularVelocity,a=i.m_linearVelocity,l=i.m_angularVelocity,h=0,u=0,d=0,p=0;this.m_enableMotor&&this.m_limitState!=_.e_equalLimits&&(p=this.m_motorMass*(this.m_motorSpeed-(this.m_axis.x*(a.x-s.x)+this.m_axis.y*(a.y-s.y)+this.m_a2*l-this.m_a1*c)),h=this.m_motorImpulse,t=t.dt*this.m_maxMotorForce,this.m_motorImpulse=n.Clamp(this.m_motorImpulse+p,-t,t),p=this.m_motorImpulse-h,h=p*this.m_axis.x,u=p*this.m_axis.y,d=p*this.m_a1,p*=this.m_a2,s.x-=this.m_invMassA*h,s.y-=this.m_invMassA*u,c-=this.m_invIA*d,a.x+=this.m_invMassB*h,a.y+=this.m_invMassB*u,l+=this.m_invIB*p),d=this.m_perp.x*(a.x-s.x)+this.m_perp.y*(a.y-s.y)+this.m_s2*l-this.m_s1*c,u=l-c,this.m_enableLimit&&this.m_limitState!=_.e_inactiveLimit?(t=this.m_axis.x*(a.x-s.x)+this.m_axis.y*(a.y-s.y)+this.m_a2*l-this.m_a1*c,h=this.m_impulse.Copy(),t=this.m_K.Solve33(new o,-d,-u,-t),this.m_impulse.Add(t),this.m_limitState==_.e_atLowerLimit?this.m_impulse.z=n.Max(this.m_impulse.z,0):this.m_limitState==_.e_atUpperLimit&&(this.m_impulse.z=n.Min(this.m_impulse.z,0)),d=-d-(this.m_impulse.z-h.z)*this.m_K.col3.x,u=-u-(this.m_impulse.z-h.z)*this.m_K.col3.y,u=this.m_K.Solve22(new r,d,u),u.x+=h.x,u.y+=h.y,this.m_impulse.x=u.x,this.m_impulse.y=u.y,t.x=this.m_impulse.x-h.x,t.y=this.m_impulse.y-h.y,t.z=this.m_impulse.z-h.z,h=t.x*this.m_perp.x+t.z*this.m_axis.x,u=t.x*this.m_perp.y+t.z*this.m_axis.y,d=t.x*this.m_s1+t.y+t.z*this.m_a1,p=t.x*this.m_s2+t.y+t.z*this.m_a2):(t=this.m_K.Solve22(new r,-d,-u),this.m_impulse.x+=t.x,this.m_impulse.y+=t.y,h=t.x*this.m_perp.x,u=t.x*this.m_perp.y,d=t.x*this.m_s1+t.y,p=t.x*this.m_s2+t.y),s.x-=this.m_invMassA*h,s.y-=this.m_invMassA*u,c-=this.m_invIA*d,a.x+=this.m_invMassB*h,a.y+=this.m_invMassB*u,l+=this.m_invIB*p,e.m_linearVelocity.SetV(s),e.m_angularVelocity=c,i.m_linearVelocity.SetV(a),i.m_angularVelocity=l},S.prototype.SolvePositionConstraints=function(i){i=this.m_bodyA;var s,c=this.m_bodyB,a=i.m_sweep.c,l=i.m_sweep.a,h=c.m_sweep.c,u=c.m_sweep.a,d=0,_=0,p=0,f=d=s=0,m=0,_=!1,g=0,y=e.FromAngle(l),T=e.FromAngle(u);s=y;var m=this.m_localAnchor1.x-this.m_localCenterA.x,S=this.m_localAnchor1.y-this.m_localCenterA.y,d=s.col1.x*m+s.col2.x*S,S=s.col1.y*m+s.col2.y*S,m=d;if(s=T,T=this.m_localAnchor2.x-this.m_localCenterB.x,p=this.m_localAnchor2.y-this.m_localCenterB.y,d=s.col1.x*T+s.col2.x*p,p=s.col1.y*T+s.col2.y*p,T=d,s=h.x+T-a.x-m,d=h.y+p-a.y-S,this.m_enableLimit){this.m_axis=n.MulMV(y,this.m_localXAxis1),this.m_a1=(s+m)*this.m_axis.y-(d+S)*this.m_axis.x,this.m_a2=T*this.m_axis.y-p*this.m_axis.x;var C=this.m_axis.x*s+this.m_axis.y*d;n.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*t.b2_linearSlop?(g=n.Clamp(C,-t.b2_maxLinearCorrection,t.b2_maxLinearCorrection),f=n.Abs(C),_=!0):C<=this.m_lowerTranslation?(g=n.Clamp(C-this.m_lowerTranslation+t.b2_linearSlop,-t.b2_maxLinearCorrection,0),f=this.m_lowerTranslation-C,_=!0):C>=this.m_upperTranslation&&(g=n.Clamp(C-this.m_upperTranslation+t.b2_linearSlop,0,t.b2_maxLinearCorrection),f=C-this.m_upperTranslation,_=!0)}return this.m_perp=n.MulMV(y,this.m_localYAxis1),this.m_s1=(s+m)*this.m_perp.y-(d+S)*this.m_perp.x,this.m_s2=T*this.m_perp.y-p*this.m_perp.x,y=new o,S=this.m_perp.x*s+this.m_perp.y*d,T=u-l-this.m_refAngle,f=n.Max(f,n.Abs(S)),m=n.Abs(T),_?(_=this.m_invMassA,p=this.m_invMassB,s=this.m_invIA,d=this.m_invIB,this.m_K.col1.x=_+p+s*this.m_s1*this.m_s1+d*this.m_s2*this.m_s2,this.m_K.col1.y=s*this.m_s1+d*this.m_s2,this.m_K.col1.z=s*this.m_s1*this.m_a1+d*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=s+d,this.m_K.col2.z=s*this.m_a1+d*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=_+p+s*this.m_a1*this.m_a1+d*this.m_a2*this.m_a2,this.m_K.Solve33(y,-S,-T,-g)):(_=this.m_invMassA,p=this.m_invMassB,s=this.m_invIA,d=this.m_invIB,g=s*this.m_s1+d*this.m_s2,C=s+d,this.m_K.col1.Set(_+p+s*this.m_s1*this.m_s1+d*this.m_s2*this.m_s2,g,0),this.m_K.col2.Set(g,C,0),g=this.m_K.Solve22(new r,-S,-T),y.x=g.x,y.y=g.y,y.z=0),g=y.x*this.m_perp.x+y.z*this.m_axis.x,_=y.x*this.m_perp.y+y.z*this.m_axis.y,S=y.x*this.m_s1+y.y+y.z*this.m_a1,y=y.x*this.m_s2+y.y+y.z*this.m_a2,a.x-=this.m_invMassA*g,a.y-=this.m_invMassA*_,l-=this.m_invIA*S,h.x+=this.m_invMassB*g,h.y+=this.m_invMassB*_,u+=this.m_invIB*y,i.m_sweep.a=l,c.m_sweep.a=u,i.SynchronizeTransform(),c.SynchronizeTransform(),f<=t.b2_linearSlop&&m<=t.b2_angularSlop
},Box2D.inherit(C,Box2D.Dynamics.Joints.b2JointDef),C.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,C.b2PrismaticJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new r,this.localAnchorB=new r,this.localAxisA=new r},C.prototype.b2PrismaticJointDef=function(){this.__super.b2JointDef.call(this),this.type=_.e_prismaticJoint,this.localAxisA.Set(1,0),this.referenceAngle=0,this.enableLimit=!1,this.upperTranslation=this.lowerTranslation=0,this.enableMotor=!1,this.motorSpeed=this.maxMotorForce=0},C.prototype.Initialize=function(t,e,i,n){this.bodyA=t,this.bodyB=e,this.localAnchorA=this.bodyA.GetLocalPoint(i),this.localAnchorB=this.bodyB.GetLocalPoint(i),this.localAxisA=this.bodyA.GetLocalVector(n),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},Box2D.inherit(v,Box2D.Dynamics.Joints.b2Joint),v.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,v.b2PulleyJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_groundAnchor1=new r,this.m_groundAnchor2=new r,this.m_localAnchor1=new r,this.m_localAnchor2=new r,this.m_u1=new r,this.m_u2=new r},v.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},v.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},v.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new r(t*this.m_impulse*this.m_u2.x,t*this.m_impulse*this.m_u2.y)},v.prototype.GetReactionTorque=function(){return 0},v.prototype.GetGroundAnchorA=function(){var t=this.m_ground.m_xf.position.Copy();return t.Add(this.m_groundAnchor1),t},v.prototype.GetGroundAnchorB=function(){var t=this.m_ground.m_xf.position.Copy();return t.Add(this.m_groundAnchor2),t},v.prototype.GetLength1=function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchor1),e=t.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x),t=t.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y);return Math.sqrt(e*e+t*t)},v.prototype.GetLength2=function(){var t=this.m_bodyB.GetWorldPoint(this.m_localAnchor2),e=t.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor2.x),t=t.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor2.y);return Math.sqrt(e*e+t*t)},v.prototype.GetRatio=function(){return this.m_ratio},v.prototype.b2PulleyJoint=function(t){this.__super.b2Joint.call(this,t),this.m_ground=this.m_bodyA.m_world.m_groundBody,this.m_groundAnchor1.x=t.groundAnchorA.x-this.m_ground.m_xf.position.x,this.m_groundAnchor1.y=t.groundAnchorA.y-this.m_ground.m_xf.position.y,this.m_groundAnchor2.x=t.groundAnchorB.x-this.m_ground.m_xf.position.x,this.m_groundAnchor2.y=t.groundAnchorB.y-this.m_ground.m_xf.position.y,this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_ratio=t.ratio,this.m_constant=t.lengthA+this.m_ratio*t.lengthB,this.m_maxLength1=n.Min(t.maxLengthA,this.m_constant-this.m_ratio*v.b2_minPulleyLength),this.m_maxLength2=n.Min(t.maxLengthB,(this.m_constant-v.b2_minPulleyLength)/this.m_ratio),this.m_limitImpulse2=this.m_limitImpulse1=this.m_impulse=0},v.prototype.InitVelocityConstraints=function(e){var i,n=this.m_bodyA,r=this.m_bodyB;i=n.m_xf.R;var o=this.m_localAnchor1.x-n.m_sweep.localCenter.x,s=this.m_localAnchor1.y-n.m_sweep.localCenter.y,c=i.col1.x*o+i.col2.x*s,s=i.col1.y*o+i.col2.y*s,o=c;i=r.m_xf.R;var a=this.m_localAnchor2.x-r.m_sweep.localCenter.x,l=this.m_localAnchor2.y-r.m_sweep.localCenter.y,c=i.col1.x*a+i.col2.x*l,l=i.col1.y*a+i.col2.y*l,a=c;i=r.m_sweep.c.x+a;var c=r.m_sweep.c.y+l,h=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,u=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.Set(n.m_sweep.c.x+o-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x),n.m_sweep.c.y+s-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y)),this.m_u2.Set(i-h,c-u),i=this.m_u1.Length(),c=this.m_u2.Length(),i>t.b2_linearSlop?this.m_u1.Multiply(1/i):this.m_u1.SetZero(),c>t.b2_linearSlop?this.m_u2.Multiply(1/c):this.m_u2.SetZero(),0<this.m_constant-i-this.m_ratio*c?(this.m_state=_.e_inactiveLimit,this.m_impulse=0):this.m_state=_.e_atUpperLimit,i<this.m_maxLength1?(this.m_limitState1=_.e_inactiveLimit,this.m_limitImpulse1=0):this.m_limitState1=_.e_atUpperLimit,c<this.m_maxLength2?(this.m_limitState2=_.e_inactiveLimit,this.m_limitImpulse2=0):this.m_limitState2=_.e_atUpperLimit,i=o*this.m_u1.y-s*this.m_u1.x,c=a*this.m_u2.y-l*this.m_u2.x,this.m_limitMass1=n.m_invMass+n.m_invI*i*i,this.m_limitMass2=r.m_invMass+r.m_invI*c*c,this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2,this.m_limitMass1=1/this.m_limitMass1,this.m_limitMass2=1/this.m_limitMass2,this.m_pulleyMass=1/this.m_pulleyMass,e.warmStarting?(this.m_impulse*=e.dtRatio,this.m_limitImpulse1*=e.dtRatio,this.m_limitImpulse2*=e.dtRatio,e=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x,i=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y,c=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x,h=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.y,n.m_linearVelocity.x+=n.m_invMass*e,n.m_linearVelocity.y+=n.m_invMass*i,n.m_angularVelocity+=n.m_invI*(o*i-s*e),r.m_linearVelocity.x+=r.m_invMass*c,r.m_linearVelocity.y+=r.m_invMass*h,r.m_angularVelocity+=r.m_invI*(a*h-l*c)):this.m_limitImpulse2=this.m_limitImpulse1=this.m_impulse=0},v.prototype.SolveVelocityConstraints=function(t){t=this.m_bodyA;var e,i=this.m_bodyB;e=t.m_xf.R;var r=this.m_localAnchor1.x-t.m_sweep.localCenter.x,o=this.m_localAnchor1.y-t.m_sweep.localCenter.y,s=e.col1.x*r+e.col2.x*o,o=e.col1.y*r+e.col2.y*o,r=s;e=i.m_xf.R;var c=this.m_localAnchor2.x-i.m_sweep.localCenter.x,a=this.m_localAnchor2.y-i.m_sweep.localCenter.y,s=e.col1.x*c+e.col2.x*a,a=e.col1.y*c+e.col2.y*a,c=s,l=s=e=0,h=0;e=h=e=h=l=s=e=0,this.m_state==_.e_atUpperLimit&&(e=t.m_linearVelocity.x+-t.m_angularVelocity*o,s=t.m_linearVelocity.y+t.m_angularVelocity*r,l=i.m_linearVelocity.x+-i.m_angularVelocity*a,h=i.m_linearVelocity.y+i.m_angularVelocity*c,e=-(this.m_u1.x*e+this.m_u1.y*s)-this.m_ratio*(this.m_u2.x*l+this.m_u2.y*h),h=this.m_pulleyMass*-e,e=this.m_impulse,this.m_impulse=n.Max(0,this.m_impulse+h),h=this.m_impulse-e,e=-h*this.m_u1.x,s=-h*this.m_u1.y,l=-this.m_ratio*h*this.m_u2.x,h=-this.m_ratio*h*this.m_u2.y,t.m_linearVelocity.x+=t.m_invMass*e,t.m_linearVelocity.y+=t.m_invMass*s,t.m_angularVelocity+=t.m_invI*(r*s-o*e),i.m_linearVelocity.x+=i.m_invMass*l,i.m_linearVelocity.y+=i.m_invMass*h,i.m_angularVelocity+=i.m_invI*(c*h-a*l)),this.m_limitState1==_.e_atUpperLimit&&(e=t.m_linearVelocity.x+-t.m_angularVelocity*o,s=t.m_linearVelocity.y+t.m_angularVelocity*r,e=-(this.m_u1.x*e+this.m_u1.y*s),h=-this.m_limitMass1*e,e=this.m_limitImpulse1,this.m_limitImpulse1=n.Max(0,this.m_limitImpulse1+h),h=this.m_limitImpulse1-e,e=-h*this.m_u1.x,s=-h*this.m_u1.y,t.m_linearVelocity.x+=t.m_invMass*e,t.m_linearVelocity.y+=t.m_invMass*s,t.m_angularVelocity+=t.m_invI*(r*s-o*e)),this.m_limitState2==_.e_atUpperLimit&&(l=i.m_linearVelocity.x+-i.m_angularVelocity*a,h=i.m_linearVelocity.y+i.m_angularVelocity*c,e=-(this.m_u2.x*l+this.m_u2.y*h),h=-this.m_limitMass2*e,e=this.m_limitImpulse2,this.m_limitImpulse2=n.Max(0,this.m_limitImpulse2+h),h=this.m_limitImpulse2-e,l=-h*this.m_u2.x,h=-h*this.m_u2.y,i.m_linearVelocity.x+=i.m_invMass*l,i.m_linearVelocity.y+=i.m_invMass*h,i.m_angularVelocity+=i.m_invI*(c*h-a*l))},v.prototype.SolvePositionConstraints=function(e){e=this.m_bodyA;var i,r=this.m_bodyB,o=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,s=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,c=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,a=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,l=0,h=0,u=0,d=0,p=i=0,f=0,m=0,g=p=m=i=p=i=0;return this.m_state==_.e_atUpperLimit&&(i=e.m_xf.R,l=this.m_localAnchor1.x-e.m_sweep.localCenter.x,h=this.m_localAnchor1.y-e.m_sweep.localCenter.y,p=i.col1.x*l+i.col2.x*h,h=i.col1.y*l+i.col2.y*h,l=p,i=r.m_xf.R,u=this.m_localAnchor2.x-r.m_sweep.localCenter.x,d=this.m_localAnchor2.y-r.m_sweep.localCenter.y,p=i.col1.x*u+i.col2.x*d,d=i.col1.y*u+i.col2.y*d,u=p,i=e.m_sweep.c.x+l,p=e.m_sweep.c.y+h,f=r.m_sweep.c.x+u,m=r.m_sweep.c.y+d,this.m_u1.Set(i-o,p-s),this.m_u2.Set(f-c,m-a),i=this.m_u1.Length(),p=this.m_u2.Length(),i>t.b2_linearSlop?this.m_u1.Multiply(1/i):this.m_u1.SetZero(),p>t.b2_linearSlop?this.m_u2.Multiply(1/p):this.m_u2.SetZero(),i=this.m_constant-i-this.m_ratio*p,g=n.Max(g,-i),i=n.Clamp(i+t.b2_linearSlop,-t.b2_maxLinearCorrection,0),m=-this.m_pulleyMass*i,i=-m*this.m_u1.x,p=-m*this.m_u1.y,f=-this.m_ratio*m*this.m_u2.x,m=-this.m_ratio*m*this.m_u2.y,e.m_sweep.c.x+=e.m_invMass*i,e.m_sweep.c.y+=e.m_invMass*p,e.m_sweep.a+=e.m_invI*(l*p-h*i),r.m_sweep.c.x+=r.m_invMass*f,r.m_sweep.c.y+=r.m_invMass*m,r.m_sweep.a+=r.m_invI*(u*m-d*f),e.SynchronizeTransform(),r.SynchronizeTransform()),this.m_limitState1==_.e_atUpperLimit&&(i=e.m_xf.R,l=this.m_localAnchor1.x-e.m_sweep.localCenter.x,h=this.m_localAnchor1.y-e.m_sweep.localCenter.y,p=i.col1.x*l+i.col2.x*h,h=i.col1.y*l+i.col2.y*h,l=p,i=e.m_sweep.c.x+l,p=e.m_sweep.c.y+h,this.m_u1.Set(i-o,p-s),i=this.m_u1.Length(),i>t.b2_linearSlop?(this.m_u1.x*=1/i,this.m_u1.y*=1/i):this.m_u1.SetZero(),i=this.m_maxLength1-i,g=n.Max(g,-i),i=n.Clamp(i+t.b2_linearSlop,-t.b2_maxLinearCorrection,0),m=-this.m_limitMass1*i,i=-m*this.m_u1.x,p=-m*this.m_u1.y,e.m_sweep.c.x+=e.m_invMass*i,e.m_sweep.c.y+=e.m_invMass*p,e.m_sweep.a+=e.m_invI*(l*p-h*i),e.SynchronizeTransform()),this.m_limitState2==_.e_atUpperLimit&&(i=r.m_xf.R,u=this.m_localAnchor2.x-r.m_sweep.localCenter.x,d=this.m_localAnchor2.y-r.m_sweep.localCenter.y,p=i.col1.x*u+i.col2.x*d,d=i.col1.y*u+i.col2.y*d,u=p,f=r.m_sweep.c.x+u,m=r.m_sweep.c.y+d,this.m_u2.Set(f-c,m-a),p=this.m_u2.Length(),p>t.b2_linearSlop?(this.m_u2.x*=1/p,this.m_u2.y*=1/p):this.m_u2.SetZero(),i=this.m_maxLength2-p,g=n.Max(g,-i),i=n.Clamp(i+t.b2_linearSlop,-t.b2_maxLinearCorrection,0),m=-this.m_limitMass2*i,f=-m*this.m_u2.x,m=-m*this.m_u2.y,r.m_sweep.c.x+=r.m_invMass*f,r.m_sweep.c.y+=r.m_invMass*m,r.m_sweep.a+=r.m_invI*(u*m-d*f),r.SynchronizeTransform()),g<t.b2_linearSlop},Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength=2}),Box2D.inherit(x,Box2D.Dynamics.Joints.b2JointDef),x.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,x.b2PulleyJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.groundAnchorA=new r,this.groundAnchorB=new r,this.localAnchorA=new r,this.localAnchorB=new r},x.prototype.b2PulleyJointDef=function(){this.__super.b2JointDef.call(this),this.type=_.e_pulleyJoint,this.groundAnchorA.Set(-1,1),this.groundAnchorB.Set(1,1),this.localAnchorA.Set(-1,0),this.localAnchorB.Set(1,0),this.maxLengthB=this.lengthB=this.maxLengthA=this.lengthA=0,this.ratio=1,this.collideConnected=!0},x.prototype.Initialize=function(t,e,i,n,r,o,s){void 0===s&&(s=0),this.bodyA=t,this.bodyB=e,this.groundAnchorA.SetV(i),this.groundAnchorB.SetV(n),this.localAnchorA=this.bodyA.GetLocalPoint(r),this.localAnchorB=this.bodyB.GetLocalPoint(o),t=r.x-i.x,i=r.y-i.y,this.lengthA=Math.sqrt(t*t+i*i),i=o.x-n.x,n=o.y-n.y,this.lengthB=Math.sqrt(i*i+n*n),this.ratio=s,s=this.lengthA+this.ratio*this.lengthB,this.maxLengthA=s-this.ratio*v.b2_minPulleyLength,this.maxLengthB=(s-v.b2_minPulleyLength)/this.ratio},Box2D.inherit(E,Box2D.Dynamics.Joints.b2Joint),E.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,E.b2RevoluteJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.K=new e,this.K1=new e,this.K2=new e,this.K3=new e,this.impulse3=new o,this.impulse2=new r,this.reduced=new r,this.m_localAnchor1=new r,this.m_localAnchor2=new r,this.m_impulse=new o,this.m_mass=new i},E.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},E.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},E.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new r(t*this.m_impulse.x,t*this.m_impulse.y)},E.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),t*this.m_impulse.z},E.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle},E.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity},E.prototype.IsLimitEnabled=function(){return this.m_enableLimit},E.prototype.EnableLimit=function(t){this.m_enableLimit=t},E.prototype.GetLowerLimit=function(){return this.m_lowerAngle},E.prototype.GetUpperLimit=function(){return this.m_upperAngle},E.prototype.SetLimits=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.m_lowerAngle=t,this.m_upperAngle=e},E.prototype.IsMotorEnabled=function(){return this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor},E.prototype.EnableMotor=function(t){this.m_enableMotor=t},E.prototype.SetMotorSpeed=function(t){void 0===t&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t},E.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},E.prototype.SetMaxMotorTorque=function(t){void 0===t&&(t=0),this.m_maxMotorTorque=t},E.prototype.GetMotorTorque=function(){return this.m_maxMotorTorque},E.prototype.b2RevoluteJoint=function(t){this.__super.b2Joint.call(this,t),this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_referenceAngle=t.referenceAngle,this.m_impulse.SetZero(),this.m_motorImpulse=0,this.m_lowerAngle=t.lowerAngle,this.m_upperAngle=t.upperAngle,this.m_maxMotorTorque=t.maxMotorTorque,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor,this.m_limitState=_.e_inactiveLimit},E.prototype.InitVelocityConstraints=function(e){var i,r=this.m_bodyA,o=this.m_bodyB,s=0;i=r.m_xf.R;var c=this.m_localAnchor1.x-r.m_sweep.localCenter.x,a=this.m_localAnchor1.y-r.m_sweep.localCenter.y,s=i.col1.x*c+i.col2.x*a,a=i.col1.y*c+i.col2.y*a,c=s;i=o.m_xf.R;var l=this.m_localAnchor2.x-o.m_sweep.localCenter.x,h=this.m_localAnchor2.y-o.m_sweep.localCenter.y,s=i.col1.x*l+i.col2.x*h,h=i.col1.y*l+i.col2.y*h,l=s;i=r.m_invMass;var s=o.m_invMass,u=r.m_invI,d=o.m_invI;if(this.m_mass.col1.x=i+s+a*a*u+h*h*d,this.m_mass.col2.x=-a*c*u-h*l*d,this.m_mass.col3.x=-a*u-h*d,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=i+s+c*c*u+l*l*d,this.m_mass.col3.y=c*u+l*d,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=u+d,this.m_motorMass=1/(u+d),0==this.m_enableMotor&&(this.m_motorImpulse=0),this.m_enableLimit){var p=o.m_sweep.a-r.m_sweep.a-this.m_referenceAngle;n.Abs(this.m_upperAngle-this.m_lowerAngle)<2*t.b2_angularSlop?this.m_limitState=_.e_equalLimits:p<=this.m_lowerAngle?(this.m_limitState!=_.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=_.e_atLowerLimit):p>=this.m_upperAngle?(this.m_limitState!=_.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=_.e_atUpperLimit):(this.m_limitState=_.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=_.e_inactiveLimit;e.warmStarting?(this.m_impulse.x*=e.dtRatio,this.m_impulse.y*=e.dtRatio,this.m_motorImpulse*=e.dtRatio,e=this.m_impulse.x,p=this.m_impulse.y,r.m_linearVelocity.x-=i*e,r.m_linearVelocity.y-=i*p,r.m_angularVelocity-=u*(c*p-a*e+this.m_motorImpulse+this.m_impulse.z),o.m_linearVelocity.x+=s*e,o.m_linearVelocity.y+=s*p,o.m_angularVelocity+=d*(l*p-h*e+this.m_motorImpulse+this.m_impulse.z)):(this.m_impulse.SetZero(),this.m_motorImpulse=0)},E.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyA,i=this.m_bodyB,r=0,o=r=0,s=0,c=0,a=0,l=e.m_linearVelocity,h=e.m_angularVelocity,u=i.m_linearVelocity,d=i.m_angularVelocity,p=e.m_invMass,f=i.m_invMass,m=e.m_invI,g=i.m_invI;if(this.m_enableMotor&&this.m_limitState!=_.e_equalLimits&&(o=this.m_motorMass*-(d-h-this.m_motorSpeed),s=this.m_motorImpulse,c=t.dt*this.m_maxMotorTorque,this.m_motorImpulse=n.Clamp(this.m_motorImpulse+o,-c,c),o=this.m_motorImpulse-s,h-=m*o,d+=g*o),this.m_enableLimit&&this.m_limitState!=_.e_inactiveLimit){t=e.m_xf.R,o=this.m_localAnchor1.x-e.m_sweep.localCenter.x,s=this.m_localAnchor1.y-e.m_sweep.localCenter.y,r=t.col1.x*o+t.col2.x*s,s=t.col1.y*o+t.col2.y*s,o=r,t=i.m_xf.R,c=this.m_localAnchor2.x-i.m_sweep.localCenter.x,a=this.m_localAnchor2.y-i.m_sweep.localCenter.y,r=t.col1.x*c+t.col2.x*a,a=t.col1.y*c+t.col2.y*a,c=r,t=u.x+-d*a-l.x- -h*s;var y=u.y+d*c-l.y-h*o;this.m_mass.Solve33(this.impulse3,-t,-y,-(d-h)),this.m_limitState==_.e_equalLimits?this.m_impulse.Add(this.impulse3):this.m_limitState==_.e_atLowerLimit?(r=this.m_impulse.z+this.impulse3.z,0>r&&(this.m_mass.Solve22(this.reduced,-t,-y),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)):this.m_limitState==_.e_atUpperLimit&&(r=this.m_impulse.z+this.impulse3.z,r>0&&(this.m_mass.Solve22(this.reduced,-t,-y),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)),l.x-=p*this.impulse3.x,l.y-=p*this.impulse3.y,h-=m*(o*this.impulse3.y-s*this.impulse3.x+this.impulse3.z),u.x+=f*this.impulse3.x,u.y+=f*this.impulse3.y,d+=g*(c*this.impulse3.y-a*this.impulse3.x+this.impulse3.z)}else t=e.m_xf.R,o=this.m_localAnchor1.x-e.m_sweep.localCenter.x,s=this.m_localAnchor1.y-e.m_sweep.localCenter.y,r=t.col1.x*o+t.col2.x*s,s=t.col1.y*o+t.col2.y*s,o=r,t=i.m_xf.R,c=this.m_localAnchor2.x-i.m_sweep.localCenter.x,a=this.m_localAnchor2.y-i.m_sweep.localCenter.y,r=t.col1.x*c+t.col2.x*a,a=t.col1.y*c+t.col2.y*a,c=r,this.m_mass.Solve22(this.impulse2,-(u.x+-d*a-l.x- -h*s),-(u.y+d*c-l.y-h*o)),this.m_impulse.x+=this.impulse2.x,this.m_impulse.y+=this.impulse2.y,l.x-=p*this.impulse2.x,l.y-=p*this.impulse2.y,h-=m*(o*this.impulse2.y-s*this.impulse2.x),u.x+=f*this.impulse2.x,u.y+=f*this.impulse2.y,d+=g*(c*this.impulse2.y-a*this.impulse2.x);e.m_linearVelocity.SetV(l),e.m_angularVelocity=h,i.m_linearVelocity.SetV(u),i.m_angularVelocity=d},E.prototype.SolvePositionConstraints=function(e){var i,r=0;e=this.m_bodyA;var o=this.m_bodyB,s=0,c=i=0,a=0,l=0;if(this.m_enableLimit&&this.m_limitState!=_.e_inactiveLimit){var r=o.m_sweep.a-e.m_sweep.a-this.m_referenceAngle,h=0;this.m_limitState==_.e_equalLimits?(r=n.Clamp(r-this.m_lowerAngle,-t.b2_maxAngularCorrection,t.b2_maxAngularCorrection),h=-this.m_motorMass*r,s=n.Abs(r)):this.m_limitState==_.e_atLowerLimit?(r-=this.m_lowerAngle,s=-r,r=n.Clamp(r+t.b2_angularSlop,-t.b2_maxAngularCorrection,0),h=-this.m_motorMass*r):this.m_limitState==_.e_atUpperLimit&&(s=r-=this.m_upperAngle,r=n.Clamp(r-t.b2_angularSlop,0,t.b2_maxAngularCorrection),h=-this.m_motorMass*r),e.m_sweep.a-=e.m_invI*h,o.m_sweep.a+=o.m_invI*h,e.SynchronizeTransform(),o.SynchronizeTransform()}i=e.m_xf.R,h=this.m_localAnchor1.x-e.m_sweep.localCenter.x,r=this.m_localAnchor1.y-e.m_sweep.localCenter.y,c=i.col1.x*h+i.col2.x*r,r=i.col1.y*h+i.col2.y*r,h=c,i=o.m_xf.R;var u=this.m_localAnchor2.x-o.m_sweep.localCenter.x,d=this.m_localAnchor2.y-o.m_sweep.localCenter.y,c=i.col1.x*u+i.col2.x*d,d=i.col1.y*u+i.col2.y*d,u=c,a=o.m_sweep.c.x+u-e.m_sweep.c.x-h,l=o.m_sweep.c.y+d-e.m_sweep.c.y-r,p=a*a+l*l;i=Math.sqrt(p);var c=e.m_invMass,f=o.m_invMass,m=e.m_invI,g=o.m_invI,y=10*t.b2_linearSlop;return p>y*y&&(p=1/(c+f),a=p*-a,l=p*-l,e.m_sweep.c.x-=.5*c*a,e.m_sweep.c.y-=.5*c*l,o.m_sweep.c.x+=.5*f*a,o.m_sweep.c.y+=.5*f*l,a=o.m_sweep.c.x+u-e.m_sweep.c.x-h,l=o.m_sweep.c.y+d-e.m_sweep.c.y-r),this.K1.col1.x=c+f,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=c+f,this.K2.col1.x=m*r*r,this.K2.col2.x=-m*h*r,this.K2.col1.y=-m*h*r,this.K2.col2.y=m*h*h,this.K3.col1.x=g*d*d,this.K3.col2.x=-g*u*d,this.K3.col1.y=-g*u*d,this.K3.col2.y=g*u*u,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.AddM(this.K3),this.K.Solve(E.tImpulse,-a,-l),a=E.tImpulse.x,l=E.tImpulse.y,e.m_sweep.c.x-=e.m_invMass*a,e.m_sweep.c.y-=e.m_invMass*l,e.m_sweep.a-=e.m_invI*(h*l-r*a),o.m_sweep.c.x+=o.m_invMass*a,o.m_sweep.c.y+=o.m_invMass*l,o.m_sweep.a+=o.m_invI*(u*l-d*a),e.SynchronizeTransform(),o.SynchronizeTransform(),i<=t.b2_linearSlop&&s<=t.b2_angularSlop},Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse=new r}),Box2D.inherit(b,Box2D.Dynamics.Joints.b2JointDef),b.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,b.b2RevoluteJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new r,this.localAnchorB=new r},b.prototype.b2RevoluteJointDef=function(){this.__super.b2JointDef.call(this),this.type=_.e_revoluteJoint,this.localAnchorA.Set(0,0),this.localAnchorB.Set(0,0),this.motorSpeed=this.maxMotorTorque=this.upperAngle=this.lowerAngle=this.referenceAngle=0,this.enableMotor=this.enableLimit=!1},b.prototype.Initialize=function(t,e,i){this.bodyA=t,this.bodyB=e,this.localAnchorA=this.bodyA.GetLocalPoint(i),this.localAnchorB=this.bodyB.GetLocalPoint(i),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},Box2D.inherit(A,Box2D.Dynamics.Joints.b2Joint),A.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,A.b2WeldJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchorA=new r,this.m_localAnchorB=new r,this.m_impulse=new o,this.m_mass=new i},A.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},A.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},A.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new r(t*this.m_impulse.x,t*this.m_impulse.y)},A.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),t*this.m_impulse.z},A.prototype.b2WeldJoint=function(t){this.__super.b2Joint.call(this,t),this.m_localAnchorA.SetV(t.localAnchorA),this.m_localAnchorB.SetV(t.localAnchorB),this.m_referenceAngle=t.referenceAngle,this.m_impulse.SetZero(),this.m_mass=new i},A.prototype.InitVelocityConstraints=function(t){var e,i=0,n=this.m_bodyA,r=this.m_bodyB;e=n.m_xf.R;var o=this.m_localAnchorA.x-n.m_sweep.localCenter.x,s=this.m_localAnchorA.y-n.m_sweep.localCenter.y,i=e.col1.x*o+e.col2.x*s,s=e.col1.y*o+e.col2.y*s,o=i;e=r.m_xf.R;var c=this.m_localAnchorB.x-r.m_sweep.localCenter.x,a=this.m_localAnchorB.y-r.m_sweep.localCenter.y,i=e.col1.x*c+e.col2.x*a,a=e.col1.y*c+e.col2.y*a,c=i;e=n.m_invMass;var i=r.m_invMass,l=n.m_invI,h=r.m_invI;this.m_mass.col1.x=e+i+s*s*l+a*a*h,this.m_mass.col2.x=-s*o*l-a*c*h,this.m_mass.col3.x=-s*l-a*h,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=e+i+o*o*l+c*c*h,this.m_mass.col3.y=o*l+c*h,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=l+h,t.warmStarting?(this.m_impulse.x*=t.dtRatio,this.m_impulse.y*=t.dtRatio,this.m_impulse.z*=t.dtRatio,n.m_linearVelocity.x-=e*this.m_impulse.x,n.m_linearVelocity.y-=e*this.m_impulse.y,n.m_angularVelocity-=l*(o*this.m_impulse.y-s*this.m_impulse.x+this.m_impulse.z),r.m_linearVelocity.x+=i*this.m_impulse.x,r.m_linearVelocity.y+=i*this.m_impulse.y,r.m_angularVelocity+=h*(c*this.m_impulse.y-a*this.m_impulse.x+this.m_impulse.z)):this.m_impulse.SetZero()},A.prototype.SolveVelocityConstraints=function(t){var e,i=0;t=this.m_bodyA;var n=this.m_bodyB,r=t.m_linearVelocity,s=t.m_angularVelocity,c=n.m_linearVelocity,a=n.m_angularVelocity,l=t.m_invMass,h=n.m_invMass,u=t.m_invI,d=n.m_invI;e=t.m_xf.R;var _=this.m_localAnchorA.x-t.m_sweep.localCenter.x,p=this.m_localAnchorA.y-t.m_sweep.localCenter.y,i=e.col1.x*_+e.col2.x*p,p=e.col1.y*_+e.col2.y*p,_=i;e=n.m_xf.R;var f=this.m_localAnchorB.x-n.m_sweep.localCenter.x,m=this.m_localAnchorB.y-n.m_sweep.localCenter.y,i=e.col1.x*f+e.col2.x*m,m=e.col1.y*f+e.col2.y*m,f=i;e=c.x-a*m-r.x+s*p;var i=c.y+a*f-r.y-s*_,g=a-s,y=new o;this.m_mass.Solve33(y,-e,-i,-g),this.m_impulse.Add(y),r.x-=l*y.x,r.y-=l*y.y,s-=u*(_*y.y-p*y.x+y.z),c.x+=h*y.x,c.y+=h*y.y,a+=d*(f*y.y-m*y.x+y.z),t.m_angularVelocity=s,n.m_angularVelocity=a},A.prototype.SolvePositionConstraints=function(e){var i,r=0;e=this.m_bodyA;var s=this.m_bodyB;i=e.m_xf.R;var c=this.m_localAnchorA.x-e.m_sweep.localCenter.x,a=this.m_localAnchorA.y-e.m_sweep.localCenter.y,r=i.col1.x*c+i.col2.x*a,a=i.col1.y*c+i.col2.y*a,c=r;i=s.m_xf.R;var l=this.m_localAnchorB.x-s.m_sweep.localCenter.x,h=this.m_localAnchorB.y-s.m_sweep.localCenter.y,r=i.col1.x*l+i.col2.x*h,h=i.col1.y*l+i.col2.y*h,l=r;i=e.m_invMass;var r=s.m_invMass,u=e.m_invI,d=s.m_invI,_=s.m_sweep.c.x+l-e.m_sweep.c.x-c,p=s.m_sweep.c.y+h-e.m_sweep.c.y-a,f=s.m_sweep.a-e.m_sweep.a-this.m_referenceAngle,m=10*t.b2_linearSlop,g=Math.sqrt(_*_+p*p),y=n.Abs(f);return g>m&&(u*=1,d*=1),this.m_mass.col1.x=i+r+a*a*u+h*h*d,this.m_mass.col2.x=-a*c*u-h*l*d,this.m_mass.col3.x=-a*u-h*d,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=i+r+c*c*u+l*l*d,this.m_mass.col3.y=c*u+l*d,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=u+d,m=new o,this.m_mass.Solve33(m,-_,-p,-f),e.m_sweep.c.x-=i*m.x,e.m_sweep.c.y-=i*m.y,e.m_sweep.a-=u*(c*m.y-a*m.x+m.z),s.m_sweep.c.x+=r*m.x,s.m_sweep.c.y+=r*m.y,s.m_sweep.a+=d*(l*m.y-h*m.x+m.z),e.SynchronizeTransform(),s.SynchronizeTransform(),g<=t.b2_linearSlop&&y<=t.b2_angularSlop},Box2D.inherit(R,Box2D.Dynamics.Joints.b2JointDef),R.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,R.b2WeldJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new r,this.localAnchorB=new r},R.prototype.b2WeldJointDef=function(){this.__super.b2JointDef.call(this),this.type=_.e_weldJoint,this.referenceAngle=0},R.prototype.Initialize=function(t,e,i){this.bodyA=t,this.bodyB=e,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(i)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(i)),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}(),function(){var t=Box2D.Dynamics.b2DebugDraw;t.b2DebugDraw=function(){this.m_xformScale=this.m_fillAlpha=this.m_alpha=this.m_lineThickness=this.m_drawScale=1;var t=this;this.m_sprite={graphics:{clear:function(){t.m_ctx.clearRect(0,0,t.m_ctx.canvas.width,t.m_ctx.canvas.height)}}}},t.prototype._color=function(t,e){return"rgba("+((16711680&t)>>16)+","+((65280&t)>>8)+","+(255&t)+","+e+")"},t.prototype.b2DebugDraw=function(){this.m_drawFlags=0},t.prototype.SetFlags=function(t){void 0===t&&(t=0),this.m_drawFlags=t},t.prototype.GetFlags=function(){return this.m_drawFlags},t.prototype.AppendFlags=function(t){void 0===t&&(t=0),this.m_drawFlags|=t},t.prototype.ClearFlags=function(t){void 0===t&&(t=0),this.m_drawFlags&=~t},t.prototype.SetSprite=function(t){this.m_ctx=t},t.prototype.GetSprite=function(){return this.m_ctx},t.prototype.SetDrawScale=function(t){void 0===t&&(t=0),this.m_drawScale=t},t.prototype.GetDrawScale=function(){return this.m_drawScale},t.prototype.SetLineThickness=function(t){void 0===t&&(t=0),this.m_lineThickness=t,this.m_ctx.strokeWidth=t},t.prototype.GetLineThickness=function(){return this.m_lineThickness},t.prototype.SetAlpha=function(t){void 0===t&&(t=0),this.m_alpha=t},t.prototype.GetAlpha=function(){return this.m_alpha},t.prototype.SetFillAlpha=function(t){void 0===t&&(t=0),this.m_fillAlpha=t},t.prototype.GetFillAlpha=function(){return this.m_fillAlpha},t.prototype.SetXFormScale=function(t){void 0===t&&(t=0),this.m_xformScale=t},t.prototype.GetXFormScale=function(){return this.m_xformScale},t.prototype.DrawPolygon=function(t,e,i){if(e){var n=this.m_ctx,r=this.m_drawScale;for(n.beginPath(),n.strokeStyle=this._color(i.color,this.m_alpha),n.moveTo(t[0].x*r,t[0].y*r),i=1;e>i;i++)n.lineTo(t[i].x*r,t[i].y*r);n.lineTo(t[0].x*r,t[0].y*r),n.closePath(),n.stroke()}},t.prototype.DrawSolidPolygon=function(t,e,i){if(e){var n=this.m_ctx,r=this.m_drawScale;for(n.beginPath(),n.strokeStyle=this._color(i.color,this.m_alpha),n.fillStyle=this._color(i.color,this.m_fillAlpha),n.moveTo(t[0].x*r,t[0].y*r),i=1;e>i;i++)n.lineTo(t[i].x*r,t[i].y*r);n.lineTo(t[0].x*r,t[0].y*r),n.closePath(),n.fill(),n.stroke()}},t.prototype.DrawCircle=function(t,e,i){if(e){var n=this.m_ctx,r=this.m_drawScale;n.beginPath(),n.strokeStyle=this._color(i.color,this.m_alpha),n.arc(t.x*r,t.y*r,e*r,0,2*Math.PI,!0),n.closePath(),n.stroke()}},t.prototype.DrawSolidCircle=function(t,e,i,n){if(e){var r=this.m_ctx,o=this.m_drawScale,s=t.x*o,c=t.y*o;r.moveTo(0,0),r.beginPath(),r.strokeStyle=this._color(n.color,this.m_alpha),r.fillStyle=this._color(n.color,this.m_fillAlpha),r.arc(s,c,e*o,0,2*Math.PI,!0),r.moveTo(s,c),r.lineTo((t.x+i.x*e)*o,(t.y+i.y*e)*o),r.closePath(),r.fill(),r.stroke()}},t.prototype.DrawSegment=function(t,e,i){var n=this.m_ctx,r=this.m_drawScale;n.strokeStyle=this._color(i.color,this.m_alpha),n.beginPath(),n.moveTo(t.x*r,t.y*r),n.lineTo(e.x*r,e.y*r),n.closePath(),n.stroke()},t.prototype.DrawTransform=function(t){var e=this.m_ctx,i=this.m_drawScale;e.beginPath(),e.strokeStyle=this._color(16711680,this.m_alpha),e.moveTo(t.position.x*i,t.position.y*i),e.lineTo((t.position.x+this.m_xformScale*t.R.col1.x)*i,(t.position.y+this.m_xformScale*t.R.col1.y)*i),e.strokeStyle=this._color(65280,this.m_alpha),e.moveTo(t.position.x*i,t.position.y*i),e.lineTo((t.position.x+this.m_xformScale*t.R.col2.x)*i,(t.position.y+this.m_xformScale*t.R.col2.y)*i),e.closePath(),e.stroke()}}();var i;for(i=0;i<Box2D.postDefs.length;++i)Box2D.postDefs[i]();delete Box2D.postDefs,"undefined"!=typeof require&&"undefined"!=typeof module&&(module.exports=Box2D),function(){Object.create=Object.create||function(t){function e(){}return e.prototype=t,new e};var t;"undefined"==typeof exports?(t={},"object"==typeof window&&(window.cp=t)):t=exports;var e,i,n=function(t,e){if(!t)throw Error("Assertion failed: "+e)},r=function(t,e){!t&&console&&console.warn&&(console.warn("ASSERTION FAILED: "+e),console.trace&&console.trace())},o=function(t,e){return e>t?t:e},s=function(t,e){return t>e?t:e};"object"==typeof window&&-1<window.navigator.userAgent.indexOf("Firefox")?(e=Math.min,i=Math.max):(e=o,i=s);var c=function(t,e){return e>t?t+" "+e:e+" "+t},a=function(t,e){for(var i=0;i<t.length;i++)if(t[i]===e){t[i]=t[t.length-1],t.length--;break}};t.momentForCircle=function(t,e,i,n){return t*(.5*(e*e+i*i)+I(n))},t.areaForCircle=function(t,e){return Math.PI*Math.abs(t*t-e*e)},t.momentForSegment=function(t,e,i){var n=x(S(e,i),.5);return t*(F(i,e)/12+I(n))},t.areaForSegment=function(t,e,i){return i*(Math.PI*i+2*B(t,e))},t.momentForPoly=function(t,e,i){for(var n=0,r=0,o=e.length,s=0;o>s;s+=2)var c=e[s]+i.x,a=e[s+1]+i.y,l=e[(s+2)%o]+i.x,h=e[(s+3)%o]+i.y,u=l*a-h*c,n=n+u*(c*c+a*a+(c*l+a*h)+(l*l+h*h)),r=r+u;return t*n/(6*r)},t.areaForPoly=function(t){for(var e=0,i=0,n=t.length;n>i;i+=2)e+=E(new f(t[i],t[i+1]),new f(t[(i+2)%n],t[(i+3)%n]));return-e/2},t.centroidForPoly=function(t){for(var e=0,i=new f(0,0),n=0,r=t.length;r>n;n+=2)var o=new f(t[n],t[n+1]),s=new f(t[(n+2)%r],t[(n+3)%r]),c=E(o,s),e=e+c,i=S(i,x(S(o,s),c));return x(i,1/(3*e))},t.recenterPoly=function(e){for(var i=t.centroidForPoly(e),n=0;n<e.length;n+=2)e[n]-=i.x,e[n+1]-=i.y},t.momentForBox=function(t,e,i){return t*(e*e+i*i)/12},t.momentForBox2=function(e,i){var n=i.r-i.l,r=i.t-i.b,o=x([i.l+i.r,i.b+i.t],.5);return t.momentForBox(e,n,r)+e*I(o)};var l=t.loopIndexes=function(t){var e,i,n,r,o=0,s=0;e=n=t[0],i=r=t[1];for(var c=t.length>>1,a=1;c>a;a++){var l=t[2*a],h=t[2*a+1];e>l||l==e&&i>h?(e=l,i=h,o=a):(l>n||l==n&&h>r)&&(n=l,r=h,s=a)}return[o,s]},h=function(t,e,i){var n=t[2*e];t[2*e]=t[2*i],t[2*i]=n,n=t[2*e+1],t[2*e+1]=t[2*i+1],t[2*i+1]=n},u=function(t,e,i,n,r,o){if(0===i)return 0;var s=0,c=e;r=C(r,n),o*=y(r);var a=e;for(i=e+i-1;i>=a;){var l=new f(t[2*a],t[2*a+1]),l=E(r,C(l,n));l>o?(l>s&&(s=l,c=a),a++):(h(t,a,i),i--)}return c!=e&&h(t,e,c),a-e},d=function(t,e,i,n,r,o,s,c){if(0>n)return 0;if(0==n)return e[2*c]=o.x,e[2*c+1]=o.y,1;var a=u(e,i,n,r,o,t),l=new f(e[2*i],e[2*i+1]);return r=d(t,e,i+1,a-1,r,l,o,c),l=c+r++,e[2*l]=o.x,e[2*l+1]=o.y,n=u(e,i+a,n-a,o,s,t),l=new f(e[2*(i+a)],e[2*(i+a)+1]),r+d(t,e,i+a+1,n-1,o,l,s,c+r)};t.convexHull=function(t,e,i){if(e)for(var n=0;n<t.length;n++)e[n]=t[n];else e=t;var o=l(t),n=o[0],o=o[1];return n==o?(e.length=2,e):(h(e,0,n),h(e,1,0==o?n:o),n=new f(e[0],e[1]),o=new f(e[2],e[3]),t=d(i,e,2,(t.length>>1)-2,n,o,n,1)+1,e.length=2*t,r(J(e),"Internal error: cpConvexHull() and cpPolyValidate() did not agree.Please report this error with as much info as you can."),e)
};var _=function(t,n,r){return e(i(t,n),r)},p=function(t){return i(0,e(t,1))},f=t.Vect=function(t,e){this.x=t,this.y=e};t.v=function(t,e){return new f(t,e)};var m=t.vzero=new f(0,0),g=t.v.dot=function(t,e){return t.x*e.x+t.y*e.y},y=t.v.len=function(t){return Math.sqrt(g(t,t))},T=t.v.len2=function(t,e){return Math.sqrt(t*t+e*e)};t.v.eql=function(t,e){return t.x===e.x&&t.y===e.y};var S=t.v.add=function(t,e){return new f(t.x+e.x,t.y+e.y)};f.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this};var C=t.v.sub=function(t,e){return new f(t.x-e.x,t.y-e.y)};f.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this};var v=t.v.neg=function(t){return new f(-t.x,-t.y)};f.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this};var x=t.v.mult=function(t,e){return new f(t.x*e,t.y*e)};f.prototype.mult=function(t){return this.x*=t,this.y*=t,this};var E=t.v.cross=function(t,e){return t.x*e.y-t.y*e.x},b=t.v.perp=function(t){return new f(-t.y,t.x)};t.v.pvrperp=function(t){return new f(t.y,-t.x)};var A=t.v.project=function(t,e){return x(e,g(t,e)/I(e))};f.prototype.project=function(t){return this.mult(g(this,t)/I(t)),this};var R=t.v.rotate=function(t,e){return new f(t.x*e.x-t.y*e.y,t.x*e.y+t.y*e.x)};f.prototype.rotate=function(t){return this.x=this.x*t.x-this.y*t.y,this.y=this.x*t.y+this.y*t.x,this};var P=t.v.unrotate=function(t,e){return new f(t.x*e.x+t.y*e.y,t.y*e.x-t.x*e.y)},I=t.v.lengthsq=function(t){return g(t,t)},w=t.v.lengthsq2=function(t,e){return t*t+e*e},L=t.v.lerp=function(t,e,i){return S(x(t,1-i),x(e,i))},D=t.v.normalize=function(t){return x(t,1/y(t))},O=t.v.normalize_safe=function(t){return 0===t.x&&0===t.y?m:D(t)},N=t.v.clamp=function(t,e){return g(t,t)>e*e?x(D(t),e):t};t.v.lerpconst=function(t,e,i){return S(t,N(C(e,t),i))};var B=t.v.dist=function(t,e){return y(C(t,e))},F=t.v.distsq=function(t,e){return I(C(t,e))};t.v.near=function(t,e,i){return F(t,e)<i*i};var M=t.v.slerp=function(t,e,i){var n=Math.acos(g(t,e));if(n){var r=1/Math.sin(n);return S(x(t,Math.sin((1-i)*n)*r),x(e,Math.sin(i*n)*r))}return t};t.v.slerpconst=function(t,i,n){var r=Math.acos(g(t,i));return M(t,i,e(n,r)/r)},t.v.forangle=function(t){return new f(Math.cos(t),Math.sin(t))},t.v.toangle=function(t){return Math.atan2(t.y,t.x)},t.v.str=function(t){return"("+t.x.toFixed(3)+", "+t.y.toFixed(3)+")"};var V=0,k=t.BB=function(t,e,i,n){this.l=t,this.b=e,this.r=i,this.t=n,V++};t.bb=function(t,e,i,n){return new k(t,e,i,n)};var W=function(t,e){return new k(t.x-e,t.y-e,t.x+e,t.y+e)},G=0;t.NO_GROUP=0;var z=t.ALL_LAYERS=-1;t.resetShapeIdCounter=function(){G=0};var U=t.Shape=function(t){this.body=t,this.bb_l=this.bb_b=this.bb_r=this.bb_t=0,this.hashid=G++,this.sensor=!1,this.u=this.e=0,this.surface_v=m,this.group=this.collision_type=0,this.layers=z,this.space=null,this.collisionCode=this.collisionCode};U.prototype.setElasticity=function(t){this.e=t},U.prototype.setFriction=function(t){this.body.activate(),this.u=t},U.prototype.setLayers=function(t){this.body.activate(),this.layers=t},U.prototype.setSensor=function(t){this.body.activate(),this.sensor=t},U.prototype.setCollisionType=function(t){this.body.activate(),this.collision_type=t},U.prototype.getBody=function(){return this.body},U.prototype.active=function(){return this.body&&-1!==this.body.shapeList.indexOf(this)},U.prototype.setBody=function(t){n(!this.active(),"You cannot change the body on an active shape. You must remove the shape from the space before changing the body."),this.body=t},U.prototype.cacheBB=function(){return this.update(this.body.p,this.body.rot)},U.prototype.update=function(t,e){n(!isNaN(e.x),"Rotation is NaN"),n(!isNaN(t.x),"Position is NaN"),this.cacheData(t,e)},U.prototype.pointQuery=function(t){return t=this.nearestPointQuery(t),0>t.d?t:void 0},U.prototype.getBB=function(){return new k(this.bb_l,this.bb_b,this.bb_r,this.bb_t)};var Y=function(t,e,i){this.shape=t,this.p=e,this.d=i},X=function(t,e,i){this.shape=t,this.t=e,this.n=i};X.prototype.hitPoint=function(t,e){return L(t,e,this.t)},X.prototype.hitDist=function(t,e){return B(t,e)*this.t};var H=t.CircleShape=function(t,e,i){this.c=this.tc=i,this.r=e,this.type="circle",U.call(this,t)};H.prototype=Object.create(U.prototype),H.prototype.cacheData=function(t,e){var i=this.tc=R(this.c,e).add(t),n=this.r;this.bb_l=i.x-n,this.bb_b=i.y-n,this.bb_r=i.x+n,this.bb_t=i.y+n},H.prototype.nearestPointQuery=function(t){var e=t.x-this.tc.x,i=t.y-this.tc.y;t=T(e,i);var n=this.r,e=new f(this.tc.x+e*n/t,this.tc.y+i*n/t);return new Y(this,e,t-n)};var j=function(t,e,i,n,r,o){return n=C(n,e),r=C(r,e),e=g(n,n)-2*g(n,r)+g(r,r),o=-2*g(n,n)+2*g(n,r),i=g(n,n)-i*i,i=o*o-4*e*i,i>=0&&(i=(-o-Math.sqrt(i))/(2*e),i>=0&&1>=i)?new X(t,i,D(L(n,r,i))):void 0};H.prototype.segmentQuery=function(t,e){return j(this,this.tc,this.r,t,e)};var q=t.SegmentShape=function(t,e,i,n){this.a=e,this.b=i,this.n=b(D(C(i,e))),this.ta=this.tb=this.tn=null,this.r=n,this.b_tangent=this.a_tangent=m,this.type="segment",U.call(this,t)};q.prototype=Object.create(U.prototype),q.prototype.cacheData=function(t,e){this.ta=S(t,R(this.a,e)),this.tb=S(t,R(this.b,e)),this.tn=R(this.n,e);var i,n,r,o;this.ta.x<this.tb.x?(i=this.ta.x,n=this.tb.x):(i=this.tb.x,n=this.ta.x),this.ta.y<this.tb.y?(r=this.ta.y,o=this.tb.y):(r=this.tb.y,o=this.ta.y);var s=this.r;this.bb_l=i-s,this.bb_b=r-s,this.bb_r=n+s,this.bb_t=o+s},q.prototype.nearestPointQuery=function(t){var e;e=this.tb;var i=C(this.ta,e),n=p(g(i,C(t,e))/I(i));e=S(e,x(i,n));var i=t.x-e.x,r=t.y-e.y;return t=T(i,r),n=this.r,e=t?S(e,x(new f(i,r),n/t)):e,new Y(this,e,t-n)},q.prototype.segmentQuery=function(t,e){var i=this.tn,n=g(C(this.ta,t),i),r=this.r,o=n>0?v(i):i,s=C(x(o,r),t),c=S(this.ta,s),a=S(this.tb,s),s=C(e,t);if(0>=E(s,c)*E(s,a)){if(r=n+(n>0?-r:r),n=-r,i=g(s,i)-r,0>n*i)return new X(this,n/(n-i),o)}else if(0!==r)return o=j(this,this.ta,this.r,t,e),i=j(this,this.tb,this.r,t,e),o?i&&i.t<o.t?i:o:i},q.prototype.setNeighbors=function(t,e){this.a_tangent=C(t,this.a),this.b_tangent=C(e,this.b)},q.prototype.setEndpoints=function(t,e){this.a=t,this.b=e,this.n=b(D(C(e,t)))};var J=function(t){for(var e=t.length,i=0;e>i;i+=2){var n=t[(i+2)%e],r=t[(i+3)%e];if(0<(n-t[i])*(t[(i+5)%e]-r)-(r-t[i+1])*(t[(i+4)%e]-n))return!1}return!0},Z=t.PolyShape=function(t,e,i){this.setVerts(e,i),this.type="poly",U.call(this,t)};Z.prototype=Object.create(U.prototype);var Q=function(t,e){this.n=t,this.d=e};Q.prototype.compare=function(t){return g(this.n,t)-this.d},Z.prototype.setVerts=function(t,e){n(4<=t.length,"Polygons require some verts"),n("number"==typeof t[0],"Polygon verticies should be specified in a flattened list (eg [x1,y1,x2,y2,x3,y3,...])"),n(J(t),"Polygon is concave or has a reversed winding. Consider using cpConvexHull()");var i=t.length,r=i>>1;for(this.verts=Array(i),this.tVerts=Array(i),this.planes=Array(r),this.tPlanes=Array(r),r=0;i>r;r+=2){var o=t[r]+e.x,s=t[r+1]+e.y,c=D(b(new f(t[(r+2)%i]+e.x-o,t[(r+3)%i]+e.y-s)));this.verts[r]=o,this.verts[r+1]=s,this.planes[r>>1]=new Q(c,c.x*o+c.y*s),this.tPlanes[r>>1]=new Q(new f(0,0),0)}},t.BoxShape=function(t,e,i){return e/=2,i/=2,K(t,new k(-e,-i,e,i))};var K=t.BoxShape2=function(t,e){return new Z(t,[e.l,e.b,e.l,e.t,e.r,e.t,e.r,e.b],m)};Z.prototype.transformVerts=function(t,n){for(var r=this.verts,o=this.tVerts,s=1/0,c=-1/0,a=1/0,l=-1/0,h=0;h<r.length;h+=2){var u=r[h],d=r[h+1],_=t.x+u*n.x-d*n.y,u=t.y+u*n.y+d*n.x;o[h]=_,o[h+1]=u,s=e(s,_),c=i(c,_),a=e(a,u),l=i(l,u)}this.bb_l=s,this.bb_b=a,this.bb_r=c,this.bb_t=l},Z.prototype.transformAxes=function(t,e){for(var i=this.planes,n=this.tPlanes,r=0;r<i.length;r++){var o=R(i[r].n,e);n[r].n=o,n[r].d=g(t,o)+i[r].d}},Z.prototype.cacheData=function(t,e){this.transformAxes(t,e),this.transformVerts(t,e)},Z.prototype.nearestPointQuery=function(t){for(var e=this.tPlanes,i=this.tVerts,n=i[i.length-2],r=i[i.length-1],o=1/0,s=m,c=!1,a=0;a<e.length;a++){0<e[a].compare(t)&&(c=!0);var l,h=i[2*a],u=i[2*a+1];l=h;var d=u,n=n-l,r=r-d,_=p((n*(t.x-l)+r*(t.y-d))/w(n,r));l=new f(l+n*_,d+r*_),d=B(t,l),o>d&&(o=d,s=l),n=h,r=u}return new Y(this,s,c?o:-o)},Z.prototype.segmentQuery=function(t,e){for(var i=this.tPlanes,n=this.tVerts,r=i.length,o=2*r,s=0;r>s;s++){var c=i[s].n,a=g(t,c);if(!(i[s].d>a)){var l=g(e,c),a=(i[s].d-a)/(l-a);if(!(0>a||a>1)){var l=L(t,e,a),l=-E(c,l),h=-(c.x*n[(2*s+3)%o]-c.y*n[(2*s+2)%o]);if(-(c.x*n[2*s+1]-c.y*n[2*s])<=l&&h>=l)return new X(this,a,c)}}}},Z.prototype.valueOnAxis=function(t,i){for(var n=this.tVerts,r=t.x*n[0]+t.y*n[1],o=2;o<n.length;o+=2)r=e(r,t.x*n[o]+t.y*n[o+1]);return r-i},Z.prototype.containsVert=function(t,e){for(var i=this.tPlanes,n=0;n<i.length;n++){var r=i[n].n;if(0<r.x*t+r.y*e-i[n].d)return!1}return!0},Z.prototype.containsVertPartial=function(t,e,i){for(var n=this.tPlanes,r=0;r<n.length;r++){var o=n[r].n;if(!(0>g(o,i))&&0<o.x*t+o.y*e-n[r].d)return!1}return!0},Z.prototype.getNumVerts=function(){return this.verts.length/2},Z.prototype.getVert=function(t){return new f(this.verts[2*t],this.verts[2*t+1])};var $=t.Body=function(t,e){this.p=new f(0,0),this.vx=this.vy=0,this.f=new f(0,0),this.t=this.w=0,this.w_limit=this.v_limit=1/0,this.w_bias=this.v_biasx=this.v_biasy=0,this.space=null,this.shapeList=[],this.nodeNext=this.nodeRoot=this.constraintList=this.arbiterList=null,this.nodeIdleTime=0,this.setMass(t),this.setMoment(e),this.rot=new f(0,0),this.setAngle(0)};if(t.StaticBody=function(){var t=new $(1/0,1/0);return t.nodeIdleTime=1/0,t},"undefined"!=typeof DEBUG&&DEBUG){var te=function(t,e){n(t.x==t.x&&t.y==t.y,e)},ee=function(t,e){n(1/0!==Math.abs(t.x)&&1/0!==Math.abs(t.y),e)};$.prototype.sanityCheck=function(){n(this.m===this.m&&this.m_inv===this.m_inv,"Body's mass is invalid."),n(this.i===this.i&&this.i_inv===this.i_inv,"Body's moment is invalid.");var t=this.p;te(t,"Body's position is invalid."),ee(t,"Body's position is invalid."),t=this.f,te(t,"Body's force is invalid."),ee(t,"Body's force is invalid."),n(this.vx===this.vx&&1/0!==Math.abs(this.vx),"Body's velocity is invalid."),n(this.vy===this.vy&&1/0!==Math.abs(this.vy),"Body's velocity is invalid."),n(this.a===this.a&&1/0!==Math.abs(this.a),"Body's angle is invalid."),n(this.w===this.w&&1/0!==Math.abs(this.w),"Body's angular velocity is invalid."),n(this.t===this.t&&1/0!==Math.abs(this.t),"Body's torque is invalid."),t=this.rot,te(t,"Body's rotation vector is invalid."),ee(t,"Body's rotation vector is invalid."),n(this.v_limit===this.v_limit,"Body's velocity limit is invalid."),n(this.w_limit===this.w_limit,"Body's angular velocity limit is invalid.")}}else $.prototype.sanityCheck=function(){};$.prototype.getPos=function(){return this.p},$.prototype.getVel=function(){return new f(this.vx,this.vy)},$.prototype.getAngVel=function(){return this.w},$.prototype.isSleeping=function(){return null!==this.nodeRoot},$.prototype.isStatic=function(){return 1/0===this.nodeIdleTime},$.prototype.isRogue=function(){return null===this.space},$.prototype.setMass=function(t){n(t>0,"Mass must be positive and non-zero."),this.activate(),this.m=t,this.m_inv=1/t},$.prototype.setMoment=function(t){n(t>0,"Moment of Inertia must be positive and non-zero."),this.activate(),this.i=t,this.i_inv=1/t},$.prototype.addShape=function(t){this.shapeList.push(t)},$.prototype.removeShape=function(t){a(this.shapeList,t)};var ie=function(t,e,i){return t===i?t.next(e):(t.a===e?t.next_a=ie(t.next_a,e,i):t.next_b=ie(t.next_b,e,i),t)};$.prototype.removeConstraint=function(t){this.constraintList=ie(this.constraintList,this,t)},$.prototype.setPos=function(e){this.activate(),this.sanityCheck(),e===m&&(e=t.v(0,0)),this.p=e},$.prototype.setVel=function(t){this.activate(),this.vx=t.x,this.vy=t.y},$.prototype.setAngVel=function(t){this.activate(),this.w=t},$.prototype.setAngleInternal=function(t){n(!isNaN(t),"Internal Error: Attempting to set body's angle to NaN"),this.a=t,this.rot.x=Math.cos(t),this.rot.y=Math.sin(t)},$.prototype.setAngle=function(t){this.activate(),this.sanityCheck(),this.setAngleInternal(t)},$.prototype.velocity_func=function(t,e,i){var n=this.vx*e+(t.x+this.f.x*this.m_inv)*i;t=this.vy*e+(t.y+this.f.y*this.m_inv)*i;var r=this.v_limit,o=n*n+t*t,r=o>r*r?r/Math.sqrt(o):1;this.vx=n*r,this.vy=t*r,n=this.w_limit,this.w=_(this.w*e+this.t*this.i_inv*i,-n,n),this.sanityCheck()},$.prototype.position_func=function(t){this.p.x+=(this.vx+this.v_biasx)*t,this.p.y+=(this.vy+this.v_biasy)*t,this.setAngleInternal(this.a+(this.w+this.w_bias)*t),this.w_bias=this.v_biasx=this.v_biasy=0,this.sanityCheck()},$.prototype.resetForces=function(){this.activate(),this.f=new f(0,0),this.t=0},$.prototype.applyForce=function(t,e){this.activate(),this.f=S(this.f,t),this.t+=E(e,t)},$.prototype.applyImpulse=function(t,e){this.activate(),qe(this,t.x,t.y,e)},$.prototype.getVelAtPoint=function(t){return S(new f(this.vx,this.vy),x(b(t),this.w))},$.prototype.getVelAtWorldPoint=function(t){return this.getVelAtPoint(C(t,this.p))},$.prototype.getVelAtLocalPoint=function(t){return this.getVelAtPoint(R(t,this.rot))},$.prototype.eachShape=function(t){for(var e=0,i=this.shapeList.length;i>e;e++)t(this.shapeList[e])},$.prototype.eachConstraint=function(t){for(var e=this.constraintList;e;){var i=e.next(this);t(e),e=i}},$.prototype.eachArbiter=function(t){for(var e=this.arbiterList;e;){var i=e.next(this);e.swappedColl=this===e.body_b,t(e),e=i}},$.prototype.local2World=function(t){return S(this.p,R(t,this.rot))},$.prototype.world2Local=function(t){return P(C(t,this.p),this.rot)},$.prototype.kineticEnergy=function(){var t=this.vx*this.vx+this.vy*this.vy,e=this.w*this.w;return(t?t*this.m:0)+(e?e*this.i:0)};var ne=t.SpatialIndex=function(t){if(this.staticIndex=t){if(t.dynamicIndex)throw Error("This static index is already associated with a dynamic index.");t.dynamicIndex=this}};ne.prototype.collideStatic=function(t,e){if(0<t.count){var i=t.query;this.each(function(t){i(t,new k(t.bb_l,t.bb_b,t.bb_r,t.bb_t),e)})}};var re=t.BBTree=function(t){ne.call(this,t),this.velocityFunc=null,this.leaves={},this.count=0,this.pooledPairs=this.pooledNodes=this.root=null,this.stamp=0};re.prototype=Object.create(ne.prototype);var oe=0,se=function(t,n,r){this.obj=null,this.bb_l=e(n.bb_l,r.bb_l),this.bb_b=e(n.bb_b,r.bb_b),this.bb_r=i(n.bb_r,r.bb_r),this.bb_t=i(n.bb_t,r.bb_t),this.parent=null,this.setA(n),this.setB(r)};re.prototype.makeNode=function(t,e){var i=this.pooledNodes;return i?(this.pooledNodes=i.parent,i.constructor(this,t,e),i):(oe++,new se(this,t,e))};var ce=0,ae=function(t,e){this.obj=e,t.getBB(e,this),this.parent=null,this.stamp=1,this.pairs=null,ce++};re.prototype.getBB=function(t,n){var r=this.velocityFunc;if(r){var o=.1*(t.bb_r-t.bb_l),s=.1*(t.bb_t-t.bb_b),r=x(r(t),.1);n.bb_l=t.bb_l+e(-o,r.x),n.bb_b=t.bb_b+e(-s,r.y),n.bb_r=t.bb_r+i(o,r.x),n.bb_t=t.bb_t+i(s,r.y)}else n.bb_l=t.bb_l,n.bb_b=t.bb_b,n.bb_r=t.bb_r,n.bb_t=t.bb_t},re.prototype.getStamp=function(){var t=this.dynamicIndex;return t&&t.stamp?t.stamp:this.stamp},re.prototype.incrementStamp=function(){this.dynamicIndex&&this.dynamicIndex.stamp?this.dynamicIndex.stamp++:this.stamp++};var le=0,he=function(t,e,i,n){this.prevA=null,this.leafA=t,this.nextA=e,this.prevB=null,this.leafB=i,this.nextB=n};re.prototype.makePair=function(t,e,i,n){var r=this.pooledPairs;return r?(this.pooledPairs=r.prevA,r.prevA=null,r.leafA=t,r.nextA=e,r.prevB=null,r.leafB=i,r.nextB=n,r):(le++,new he(t,e,i,n))},he.prototype.recycle=function(t){this.prevA=t.pooledPairs,t.pooledPairs=this};var ue=function(t,e,i){i&&(i.leafA===e?i.prevA=t:i.prevB=t),t?t.leafA===e?t.nextA=i:t.nextB=i:e.pairs=i};ae.prototype.clearPairs=function(t){var e,i=this.pairs;for(this.pairs=null;i;)i.leafA===this?(e=i.nextA,ue(i.prevB,i.leafB,i.nextB)):(e=i.nextB,ue(i.prevA,i.leafA,i.nextA)),i.recycle(t),i=e};var de=function(t,e,i){var n=t.pairs,r=e.pairs;i=i.makePair(t,n,e,r),t.pairs=e.pairs=i,n&&(n.leafA===t?n.prevA=i:n.prevB=i),r&&(r.leafA===e?r.prevA=i:r.prevB=i)};se.prototype.recycle=function(t){this.parent=t.pooledNodes,t.pooledNodes=this},ae.prototype.recycle=function(){},se.prototype.setA=function(t){this.A=t,t.parent=this},se.prototype.setB=function(t){this.B=t,t.parent=this},ae.prototype.isLeaf=!0,se.prototype.isLeaf=!1,se.prototype.otherChild=function(t){return this.A==t?this.B:this.A},se.prototype.replaceChild=function(t,n,o){for(r(t==this.A||t==this.B,"Node is not a child of parent."),this.A==t?(this.A.recycle(o),this.setA(n)):(this.B.recycle(o),this.setB(n)),t=this;t;t=t.parent)n=t.A,o=t.B,t.bb_l=e(n.bb_l,o.bb_l),t.bb_b=e(n.bb_b,o.bb_b),t.bb_r=i(n.bb_r,o.bb_r),t.bb_t=i(n.bb_t,o.bb_t)},se.prototype.bbArea=ae.prototype.bbArea=function(){return(this.bb_r-this.bb_l)*(this.bb_t-this.bb_b)};var _e=function(t,n){return(i(t.bb_r,n.bb_r)-e(t.bb_l,n.bb_l))*(i(t.bb_t,n.bb_t)-e(t.bb_b,n.bb_b))},pe=function(t,e){return Math.abs(t.bb_l+t.bb_r-e.bb_l-e.bb_r)+Math.abs(t.bb_b+t.bb_t-e.bb_b-e.bb_t)},fe=function(t,n,r){if(null==t)return n;if(t.isLeaf)return r.makeNode(n,t);var o=t.B.bbArea()+_e(t.A,n),s=t.A.bbArea()+_e(t.B,n);return o===s&&(o=pe(t.A,n),s=pe(t.B,n)),o>s?t.setB(fe(t.B,n,r)):t.setA(fe(t.A,n,r)),t.bb_l=e(t.bb_l,n.bb_l),t.bb_b=e(t.bb_b,n.bb_b),t.bb_r=i(t.bb_r,n.bb_r),t.bb_t=i(t.bb_t,n.bb_t),t};se.prototype.intersectsBB=ae.prototype.intersectsBB=function(t){return this.bb_l<=t.r&&t.l<=this.bb_r&&this.bb_b<=t.t&&t.b<=this.bb_t};var me=function(t,e,i){t.intersectsBB(e)&&(t.isLeaf?i(t.obj):(me(t.A,e,i),me(t.B,e,i)))},ge=function(t,n,r){var o=1/(r.x-n.x),s=t.bb_l==n.x?-1/0:(t.bb_l-n.x)*o,c=t.bb_r==n.x?1/0:(t.bb_r-n.x)*o,o=e(s,c),s=i(s,c),c=1/(r.y-n.y);return r=t.bb_b==n.y?-1/0:(t.bb_b-n.y)*c,n=t.bb_t==n.y?1/0:(t.bb_t-n.y)*c,t=e(r,n),n=i(r,n),s>=t&&n>=o&&(o=i(o,t),0<=e(s,n)&&1>=o)?i(o,0):1/0},ye=function(t,i,n,r,o){if(t.isLeaf)return o(t.obj);var s=ge(t.A,i,n),c=ge(t.B,i,n);return c>s?(r>s&&(r=e(r,ye(t.A,i,n,r,o))),r>c&&(r=e(r,ye(t.B,i,n,r,o)))):(r>c&&(r=e(r,ye(t.B,i,n,r,o))),r>s&&(r=e(r,ye(t.A,i,n,r,o)))),r};re.prototype.subtreeRecycle=function(t){t.isLeaf&&(this.subtreeRecycle(t.A),this.subtreeRecycle(t.B),t.recycle(this))};var Te=function(t,e,i){if(e==t)return null;var n=e.parent;return n==t?(e=t.otherChild(e),e.parent=t.parent,t.recycle(i),e):(n.parent.replaceChild(n,n.otherChild(e),i),t)},Se=function(t,e){return t.bb_l<=e.bb_r&&e.bb_l<=t.bb_r&&t.bb_b<=e.bb_t&&e.bb_b<=t.bb_t};ae.prototype.markLeafQuery=function(t,e,i,n){Se(t,this)&&(e?de(t,this,i):(this.stamp<t.stamp&&de(this,t,i),n&&n(t.obj,this.obj)))},se.prototype.markLeafQuery=function(t,e,i,n){Se(t,this)&&(this.A.markLeafQuery(t,e,i,n),this.B.markLeafQuery(t,e,i,n))},ae.prototype.markSubtree=function(t,e,i){if(this.stamp==t.getStamp())for(e&&e.markLeafQuery(this,!1,t,i),e=this;e.parent;e=e.parent)e==e.parent.A?e.parent.B.markLeafQuery(this,!0,t,i):e.parent.A.markLeafQuery(this,!1,t,i);else for(t=this.pairs;t;)this===t.leafB?(i&&i(t.leafA.obj,this.obj),t=t.nextB):t=t.nextA},se.prototype.markSubtree=function(t,e,i){this.A.markSubtree(t,e,i),this.B.markSubtree(t,e,i)},ae.prototype.containsObj=function(t){return this.bb_l<=t.bb_l&&this.bb_r>=t.bb_r&&this.bb_b<=t.bb_b&&this.bb_t>=t.bb_t},ae.prototype.update=function(t){var e=t.root;return this.containsObj(this.obj)?!1:(t.getBB(this.obj,this),e=Te(e,this,t),t.root=fe(e,this,t),this.clearPairs(t),this.stamp=t.getStamp(),!0)},ae.prototype.addPairs=function(t){var e=t.dynamicIndex;e?(t=e.root)&&t.markLeafQuery(this,!0,e,null):this.markSubtree(t,t.staticIndex.root,null)},re.prototype.insert=function(t,e){var i=new ae(this,t);this.leaves[e]=i,this.root=fe(this.root,i,this),this.count++,i.stamp=this.getStamp(),i.addPairs(this),this.incrementStamp()},re.prototype.remove=function(t,e){var i=this.leaves[e];delete this.leaves[e],this.root=Te(this.root,i,this),this.count--,i.clearPairs(this),i.recycle(this)},re.prototype.contains=function(t,e){return null!=this.leaves[e]};var Ce=function(){};re.prototype.reindexQuery=function(t){if(this.root){var e,i=this.leaves;for(e in i)i[e].update(this);i=(e=this.staticIndex)&&e.root,this.root.markSubtree(this,i,t),e&&!i&&this.collideStatic(this,e,t),this.incrementStamp()}},re.prototype.reindex=function(){this.reindexQuery(Ce)},re.prototype.reindexObject=function(t,e){var i=this.leaves[e];i&&(i.update(this)&&i.addPairs(this),this.incrementStamp())},re.prototype.pointQuery=function(t,e){this.query(new k(t.x,t.y,t.x,t.y),e)},re.prototype.segmentQuery=function(t,e,i,n){this.root&&ye(this.root,t,e,i,n)},re.prototype.query=function(t,e){this.root&&me(this.root,t,e)},re.prototype.count=function(){return this.count},re.prototype.each=function(t){for(var e in this.leaves)t(this.leaves[e].obj)};var ve=function(t,n,r,o,s){return(i(t.bb_r,o)-e(t.bb_l,n))*(i(t.bb_t,s)-e(t.bb_b,r))},xe=function(t,n,r,o){if(1==o)return n[r];if(2==o)return t.makeNode(n[r],n[r+1]);for(var s=n[r],c=s.bb_l,a=s.bb_b,l=s.bb_r,h=s.bb_t,u=r+o,d=r+1;u>d;d++)s=n[d],c=e(c,s.bb_l),a=e(a,s.bb_b),l=i(l,s.bb_r),h=i(h,s.bb_t);var s=l-c>h-a,_=Array(2*o);if(s)for(d=r;u>d;d++)_[2*d+0]=n[d].bb_l,_[2*d+1]=n[d].bb_r;else for(d=r;u>d;d++)_[2*d+0]=n[d].bb_b,_[2*d+1]=n[d].bb_t;_.sort(function(t,e){return t-e});var p=.5*(_[o-1]+_[o]),d=c,_=a,f=l,m=h;s?f=c=p:m=a=p;for(var p=u,g=r;p>g;)s=n[g],ve(s,c,a,l,h)<ve(s,d,_,f,m)?(p--,n[g]=n[p],n[p]=s):g++;if(p==o){for(s=null,d=r;u>d;d++)s=fe(s,n[d],t);return s}return NodeNew(t,xe(t,n,r,p-r),xe(t,n,p,u-p))};re.prototype.optimize=function(){var t,e=Array(this.count),i=0;for(t in this.leaves)e[i++]=this.nodes[t];tree.subtreeRecycle(root),this.root=xe(tree,e,e.length)};var Ee=function(t,e){!t.isLeaf&&10>=e&&(Ee(t.A,e+1),Ee(t.B,e+1));for(var i="",n=0;e>n;n++)i+=" ";console.log(i+t.bb_b+" "+t.bb_t)};re.prototype.log=function(){this.root&&Ee(this.root,0)};var be=t.CollisionHandler=function(){this.a=this.b=0};be.prototype.begin=function(){return!0},be.prototype.preSolve=function(){return!0},be.prototype.postSolve=function(){},be.prototype.separate=function(){};var Ae=function(t,e){this.u=this.e=0,this.surface_vr=m,this.a=t,this.body_a=t.body,this.b=e,this.body_b=e.body,this.contacts=this.thread_b_next=this.thread_b_prev=this.thread_a_next=this.thread_a_prev=null,this.stamp=0,this.handler=null,this.swappedColl=!1,this.state="first coll"};Ae.prototype.getShapes=function(){return this.swappedColl?[this.b,this.a]:[this.a,this.b]},Ae.prototype.totalImpulse=function(){for(var t=this.contacts,e=new f(0,0),i=0,n=t.length;n>i;i++){var r=t[i];e.add(x(r.n,r.jnAcc))}return this.swappedColl?e:e.neg()},Ae.prototype.totalImpulseWithFriction=function(){for(var t=this.contacts,e=new f(0,0),i=0,n=t.length;n>i;i++){var r=t[i];e.add(new f(r.jnAcc,r.jtAcc).rotate(r.n))}return this.swappedColl?e:e.neg()},Ae.prototype.totalKE=function(){for(var t=(1-this.e)/(1+this.e),e=0,i=this.contacts,n=0,r=i.length;r>n;n++)var o=i[n],s=o.jnAcc,c=o.jtAcc,e=e+(t*s*s/o.nMass+c*c/o.tMass);return e},Ae.prototype.ignore=function(){this.state="ignore"},Ae.prototype.getA=function(){return this.swappedColl?this.b:this.a},Ae.prototype.getB=function(){return this.swappedColl?this.a:this.b},Ae.prototype.isFirstContact=function(){return"first coll"===this.state};var Re=function(t,e,i){this.point=t,this.normal=e,this.dist=i};Ae.prototype.getContactPointSet=function(){var t,e=Array(this.contacts.length);for(t=0;t<e.length;t++)e[t]=new Re(this.contacts[t].p,this.contacts[t].n,this.contacts[t].dist);return e},Ae.prototype.getNormal=function(t){return t=this.contacts[t].n,this.swappedColl?v(t):t},Ae.prototype.getPoint=function(t){return this.contacts[t].p},Ae.prototype.getDepth=function(t){return this.contacts[t].dist};var Pe=function(t,e,i,n){i?i.body_a===e?i.thread_a_next=n:i.thread_b_next=n:e.arbiterList=n,n&&(n.body_a===e?n.thread_a_prev=i:n.thread_b_prev=i)};Ae.prototype.unthread=function(){Pe(this,this.body_a,this.thread_a_prev,this.thread_a_next),Pe(this,this.body_b,this.thread_b_prev,this.thread_b_next),this.thread_b_prev=this.thread_b_next=this.thread_a_prev=this.thread_a_next=null},Ae.prototype.update=function(t,e,i,n){if(this.contacts)for(var r=0;r<this.contacts.length;r++)for(var o=this.contacts[r],s=0;s<t.length;s++){var c=t[s];c.hash===o.hash&&(c.jnAcc=o.jnAcc,c.jtAcc=o.jtAcc)}this.contacts=t,this.handler=e,this.swappedColl=i.collision_type!==e.a,this.e=i.e*n.e,this.u=i.u*n.u,this.surface_vr=C(i.surface_v,n.surface_v),this.a=i,this.body_a=i.body,this.b=n,this.body_b=n.body,"cached"==this.state&&(this.state="first coll")},Ae.prototype.preStep=function(t,i,n){for(var r=this.body_a,o=this.body_b,s=0;s<this.contacts.length;s++){var c=this.contacts[s];c.r1=C(c.p,r.p),c.r2=C(c.p,o.p),c.nMass=1/Ke(r,o,c.r1,c.r2,c.n),c.tMass=1/Ke(r,o,c.r1,c.r2,b(c.n)),c.bias=-n*e(0,c.dist+i)/t,c.jBias=0,c.bounce=je(r,o,c.r1,c.r2,c.n)*this.e}},Ae.prototype.applyCachedImpulse=function(t){if(!this.isFirstContact())for(var e=this.body_a,i=this.body_b,n=0;n<this.contacts.length;n++){var r=this.contacts[n],o=r.n.x,s=r.n.y;Je(e,i,r.r1,r.r2,(o*r.jnAcc-s*r.jtAcc)*t,(o*r.jtAcc+s*r.jnAcc)*t)}};var Ie=0,we=0;Ae.prototype.applyImpulse=function(){Ie++;for(var t=this.body_a,e=this.body_b,n=this.surface_vr,r=this.u,o=0;o<this.contacts.length;o++){we++;var s=this.contacts[o],c=s.nMass,a=s.n,l=s.r1,h=s.r2,u=e.vx-h.y*e.w-(t.vx-l.y*t.w),d=e.vy+h.x*e.w-(t.vy+l.x*t.w),p=u*a.x+d*a.y,f=(u+n.x)*-a.y+(d+n.y)*a.x,d=s.jBias;s.jBias=i(d+(s.bias-(a.x*(e.v_biasx-h.y*e.w_bias-t.v_biasx+l.y*t.w_bias)+a.y*(h.x*e.w_bias+e.v_biasy-l.x*t.w_bias-t.v_biasy)))*c,0),u=s.jnAcc,s.jnAcc=i(u+-(s.bounce+p)*c,0),p=r*s.jnAcc,c=s.jtAcc,s.jtAcc=_(c+-f*s.tMass,-p,p),p=a.x*(s.jBias-d),d=a.y*(s.jBias-d),Ze(t,-p,-d,l),Ze(e,p,d,h),u=s.jnAcc-u,s=s.jtAcc-c,Je(t,e,l,h,a.x*u-a.y*s,a.x*s+a.y*u)}},Ae.prototype.callSeparate=function(t){t.lookupHandler(this.a.collision_type,this.b.collision_type).separate(this,t)},Ae.prototype.next=function(t){return this.body_a==t?this.thread_a_next:this.thread_b_next};var Le=0,De=function(t,e,i,n){this.p=t,this.n=e,this.dist=i,this.r1=this.r2=m,this.jnAcc=this.jtAcc=this.jBias=this.nMass=this.tMass=this.bounce=this.bias=0,this.hash=n,Le++},Oe=[],Ne=function(t,e,i,n){n=i+n,e=C(e,t);var r=I(e);return r>=n*n?void 0:(r=Math.sqrt(r),new De(S(t,x(e,.5+(i-.5*n)/(r?r:1/0))),r?x(e,1/r):new f(1,0),r-n,0))},Be=0,Fe=function(t,e){var i=0,n=t.valueOnAxis(e[0].n,e[0].d);if(n>0)return-1;for(var r=1;r<e.length;r++){var o=t.valueOnAxis(e[r].n,e[r].d);if(o>0)return-1;o>n&&(n=o,i=r)}return Be=n,i},Me=function(t,e,i,n){for(var r=[],o=t.tVerts,s=0;s<o.length;s+=2){var a=o[s],l=o[s+1];e.containsVert(a,l)&&r.push(new De(new f(a,l),i,n,c(t.hashid,s>>1)))}for(o=e.tVerts,s=0;s<o.length;s+=2)a=o[s],l=o[s+1],t.containsVert(a,l)&&r.push(new De(new f(a,l),i,n,c(e.hashid,s>>1)));if(!r.length){for(r=[],o=t.tVerts,s=0;s<o.length;s+=2)a=o[s],l=o[s+1],e.containsVertPartial(a,l,v(i))&&r.push(new De(new f(a,l),i,n,c(t.hashid,s)));for(o=e.tVerts,s=0;s<o.length;s+=2)a=o[s],l=o[s+1],t.containsVertPartial(a,l,i)&&r.push(new De(new f(a,l),i,n,c(e.hashid,s)))}return t=r},Ve=function(t,i,n){var r=g(i,t.ta)-t.r;return t=g(i,t.tb)-t.r,e(r,t)-n},ke=function(t,e,i,n,r){for(var o=E(e.tn,e.ta),s=E(e.tn,e.tb),a=x(e.tn,r),l=i.tVerts,h=0;h<l.length;h+=2){var u=l[h],d=l[h+1];if(u*a.x+d*a.y<g(e.tn,e.ta)*r+e.r){var _=e.tn.x*d-e.tn.y*u;o>=_&&_>=s&&t.push(new De(new f(u,d),a,n,c(i.hashid,h)))}}};H.prototype.collisionCode=0,q.prototype.collisionCode=1,Z.prototype.collisionCode=2,H.prototype.collisionTable=[function(t,e){var i=Ne(t.tc,e.tc,t.r,e.r);return i?[i]:Oe},function(t,e){var i=e.ta,n=t.tc,r=C(e.tb,i),o=p(g(r,C(n,i))/I(r)),i=S(i,x(r,o));return(n=Ne(n,i,t.r,e.r))?(i=n.n,0===o&&0>g(i,e.a_tangent)||1===o&&0>g(i,e.b_tangent)?Oe:[n]):Oe},function(t,e){for(var i=e.tPlanes,n=0,r=g(i[0].n,t.tc)-i[0].d-t.r,o=0;o<i.length;o++){var s=g(i[o].n,t.tc)-i[o].d-t.r;if(s>0)return Oe;s>r&&(r=s,n=o)}var i=i[n].n,c=e.tVerts,a=c.length,l=n<<1,n=c[l],o=c[l+1],s=c[(l+2)%a],c=c[(l+3)%a],a=i.x*o-i.y*n,l=i.x*c-i.y*s,h=E(i,t.tc);if(l>h){var u=Ne(t.tc,new f(s,c),t.r,0,u);return u?[u]:Oe}return a>h?[new De(C(t.tc,x(i,t.r+r/2)),v(i),r,0)]:(u=Ne(t.tc,new f(n,o),t.r,0,u))?[u]:Oe}],q.prototype.collisionTable=[null,function(){return Oe},function(t,e){var i=[],n=e.tPlanes,r=n.length,o=g(t.tn,t.ta),s=e.valueOnAxis(t.tn,o)-t.r,o=e.valueOnAxis(v(t.tn),-o)-t.r;if(o>0||s>0)return Oe;var a=0,l=Ve(t,n[0].n,n[0].d);if(l>0)return Oe;for(var h=0;r>h;h++){var u=Ve(t,n[h].n,n[h].d);if(u>0)return Oe;u>l&&(l=u,a=h)}if(n=v(n[a].n),h=S(t.ta,x(n,t.r)),u=S(t.tb,x(n,t.r)),e.containsVert(h.x,h.y)&&i.push(new De(h,n,l,c(t.hashid,0))),e.containsVert(u.x,u.y)&&i.push(new De(u,n,l,c(t.hashid,1))),(s>=l||o>=l)&&(s>o?ke(i,t,e,s,1):ke(i,t,e,o,-1)),0===i.length){if(s=2*a,o=e.tVerts,l=new f(o[s],o[s+1]),(a=Ne(t.ta,l,t.r,0,i))||(a=Ne(t.tb,l,t.r,0,i)))return[a];if(r*=2,r=new f(o[(s+2)%r],o[(s+3)%r]),(a=Ne(t.ta,r,t.r,0,i))||(a=Ne(t.tb,r,t.r,0,i)))return[a]}return i}],Z.prototype.collisionTable=[null,null,function(t,e){var i=Fe(e,t.tPlanes);if(-1==i)return Oe;var n=Be,r=Fe(t,e.tPlanes);if(-1==r)return Oe;var o=Be;return n>o?Me(t,e,t.tPlanes[i].n,n):Me(t,e,v(e.tPlanes[r].n),o)}];var We=t.collideShapes=function(t,e){return n(t.collisionCode<=e.collisionCode,"Collided shapes must be sorted by type"),t.collisionTable[e.collisionCode](t,e)},Ge=new be,ze=t.Space=function(){this.curr_dt=this.stamp=0,this.bodies=[],this.rousedBodies=[],this.sleepingComponents=[],this.staticShapes=new re(null),this.activeShapes=new re(this.staticShapes),this.arbiters=[],this.contactBuffersHead=null,this.cachedArbiters={},this.constraints=[],this.locked=0,this.collisionHandlers={},this.defaultHandler=Ge,this.postStepCallbacks=[],this.iterations=10,this.gravity=m,this.damping=1,this.idleSpeedThreshold=0,this.sleepTimeThreshold=1/0,this.collisionSlop=.1,this.collisionBias=Math.pow(.9,60),this.collisionPersistence=3,this.enableContactGraph=!1,this.staticBody=new $(1/0,1/0),this.staticBody.nodeIdleTime=1/0,this.collideShapes=this.makeCollideShapes()};ze.prototype.getCurrentTimeStep=function(){return this.curr_dt},ze.prototype.setIterations=function(t){this.iterations=t},ze.prototype.isLocked=function(){return this.locked};var Ue=function(t){n(!t.locked,"This addition/removal cannot be done safely during a call to cpSpaceStep()  or during a query. Put these calls into a post-step callback.")};ze.prototype.addCollisionHandler=function(t,e,i,n,r,o){Ue(this),this.removeCollisionHandler(t,e);var s=new be;s.a=t,s.b=e,i&&(s.begin=i),n&&(s.preSolve=n),r&&(s.postSolve=r),o&&(s.separate=o),this.collisionHandlers[c(t,e)]=s},ze.prototype.removeCollisionHandler=function(t,e){Ue(this),delete this.collisionHandlers[c(t,e)]},ze.prototype.setDefaultCollisionHandler=function(t,e,i,n){Ue(this);var r=new be;t&&(r.begin=t),e&&(r.preSolve=e),i&&(r.postSolve=i),n&&(r.separate=n),this.defaultHandler=r},ze.prototype.lookupHandler=function(t,e){return this.collisionHandlers[c(t,e)]||this.defaultHandler},ze.prototype.addShape=function(t){var e=t.body;return e.isStatic()?this.addStaticShape(t):(n(!t.space,"This shape is already added to a space and cannot be added to another."),Ue(this),e.activate(),e.addShape(t),t.update(e.p,e.rot),this.activeShapes.insert(t,t.hashid),t.space=this,t)},ze.prototype.addStaticShape=function(t){n(!t.space,"This shape is already added to a space and cannot be added to another."),Ue(this);var e=t.body;return e.addShape(t),t.update(e.p,e.rot),this.staticShapes.insert(t,t.hashid),t.space=this,t},ze.prototype.addBody=function(t){return n(!t.isStatic(),"Static bodies cannot be added to a space as they are not meant to be simulated."),n(!t.space,"This body is already added to a space and cannot be added to another."),Ue(this),this.bodies.push(t),t.space=this,t},ze.prototype.addConstraint=function(t){n(!t.space,"This shape is already added to a space and cannot be added to another."),Ue(this);var e=t.a,i=t.b;return e.activate(),i.activate(),this.constraints.push(t),t.next_a=e.constraintList,e.constraintList=t,t.next_b=i.constraintList,i.constraintList=t,t.space=this,t},ze.prototype.filterArbiters=function(t,e){for(var i in this.cachedArbiters){var n=this.cachedArbiters[i];(t===n.body_a&&(e===n.a||null===e)||t===n.body_b&&(e===n.b||null===e))&&(e&&"cached"!==n.state&&n.callSeparate(this),n.unthread(),a(this.arbiters,n),delete this.cachedArbiters[i])}},ze.prototype.removeShape=function(t){var e=t.body;
e.isStatic()?this.removeStaticShape(t):(n(this.containsShape(t),"Cannot remove a shape that was not added to the space. (Removed twice maybe?)"),Ue(this),e.activate(),e.removeShape(t),this.filterArbiters(e,t),this.activeShapes.remove(t,t.hashid),t.space=null)},ze.prototype.removeStaticShape=function(t){n(this.containsShape(t),"Cannot remove a static or sleeping shape that was not added to the space. (Removed twice maybe?)"),Ue(this);var e=t.body;e.isStatic()&&e.activateStatic(t),e.removeShape(t),this.filterArbiters(e,t),this.staticShapes.remove(t,t.hashid),t.space=null},ze.prototype.removeBody=function(t){n(this.containsBody(t),"Cannot remove a body that was not added to the space. (Removed twice maybe?)"),Ue(this),t.activate(),a(this.bodies,t),t.space=null},ze.prototype.removeConstraint=function(t){n(this.containsConstraint(t),"Cannot remove a constraint that was not added to the space. (Removed twice maybe?)"),Ue(this),t.a.activate(),t.b.activate(),a(this.constraints,t),t.a.removeConstraint(t),t.b.removeConstraint(t),t.space=null},ze.prototype.containsShape=function(t){return t.space===this},ze.prototype.containsBody=function(t){return t.space==this},ze.prototype.containsConstraint=function(t){return t.space==this},ze.prototype.uncacheArbiter=function(t){delete this.cachedArbiters[c(t.a.hashid,t.b.hashid)],a(this.arbiters,t)},ze.prototype.eachBody=function(t){this.lock();for(var e=this.bodies,i=0;i<e.length;i++)t(e[i]);for(e=this.sleepingComponents,i=0;i<e.length;i++)for(var n=e[i];n;){var r=n.nodeNext;t(n),n=r}this.unlock(!0)},ze.prototype.eachShape=function(t){this.lock(),this.activeShapes.each(t),this.staticShapes.each(t),this.unlock(!0)},ze.prototype.eachConstraint=function(t){this.lock();for(var e=this.constraints,i=0;i<e.length;i++)t(e[i]);this.unlock(!0)},ze.prototype.reindexStatic=function(){n(!this.locked,"You cannot manually reindex objects while the space is locked. Wait until the current query or step is complete."),this.staticShapes.each(function(t){var e=t.body;t.update(e.p,e.rot)}),this.staticShapes.reindex()},ze.prototype.reindexShape=function(t){n(!this.locked,"You cannot manually reindex objects while the space is locked. Wait until the current query or step is complete.");var e=t.body;t.update(e.p,e.rot),this.activeShapes.reindexObject(t,t.hashid),this.staticShapes.reindexObject(t,t.hashid)},ze.prototype.reindexShapesForBody=function(t){for(t=t.shapeList;t;t=t.next)this.reindexShape(t)},ze.prototype.useSpatialHash=function(){throw Error("Spatial Hash not implemented.")},ze.prototype.activateBody=function(t){if(n(!t.isRogue(),"Internal error: Attempting to activate a rogue body."),this.locked)-1===this.rousedBodies.indexOf(t)&&this.rousedBodies.push(t);else{this.bodies.push(t);for(var e=0;e<t.shapeList.length;e++){var i=t.shapeList[e];this.staticShapes.remove(i,i.hashid),this.activeShapes.insert(i,i.hashid)}for(e=t.arbiterList;e;e=e.next(t))if(i=e.body_a,t===i||i.isStatic()){var i=e.a,r=e.b;this.cachedArbiters[c(i.hashid,r.hashid)]=e,e.stamp=this.stamp,e.handler=this.lookupHandler(i.collision_type,r.collision_type),this.arbiters.push(e)}for(e=t.constraintList;e;e=e.nodeNext)i=e.a,(t===i||i.isStatic())&&this.constraints.push(e)}},ze.prototype.deactivateBody=function(t){n(!t.isRogue(),"Internal error: Attempting to deactivate a rogue body."),a(this.bodies,t);for(var e=0;e<t.shapeList.length;e++){var i=t.shapeList[e];this.activeShapes.remove(i,i.hashid),this.staticShapes.insert(i,i.hashid)}for(i=t.arbiterList;i;i=i.next(t))e=i.body_a,(t===e||e.isStatic())&&this.uncacheArbiter(i);for(i=t.constraintList;i;i=i.nodeNext)e=i.a,(t===e||e.isStatic())&&a(this.constraints,i)},$.prototype.activate=function(){if(!this.isRogue()){this.nodeIdleTime=0;var t=this?this.nodeRoot:null;if(t&&t.isSleeping(t)){n(!t.isRogue(),"Internal Error: componentActivate() called on a rogue body.");for(var e=t.space,i=t;i;){var r=i.nodeNext;i.nodeIdleTime=0,i.nodeRoot=null,i.nodeNext=null,e.activateBody(i),i=r}a(e.sleepingComponents,t)}}},$.prototype.activateStatic=function(t){n(this.isStatic(),"Body.activateStatic() called on a non-static body.");for(var e=this.arbiterList;e;e=e.next(this))t&&t!=e.a&&t!=e.b||(e.body_a==this?e.body_b:e.body_a).activate()},$.prototype.pushArbiter=function(t){r(null===(t.body_a===this?t.thread_a_next:t.thread_b_next),"Internal Error: Dangling contact graph pointers detected. (A)"),r(null===(t.body_a===this?t.thread_a_prev:t.thread_b_prev),"Internal Error: Dangling contact graph pointers detected. (B)");var e=this.arbiterList;r(null===e||null===(e.body_a===this?e.thread_a_prev:e.thread_b_prev),"Internal Error: Dangling contact graph pointers detected. (C)"),t.body_a===this?t.thread_a_next=e:t.thread_b_next=e,e&&(e.body_a===this?e.thread_a_prev=t:e.thread_b_prev=t),this.arbiterList=t};var Ye=function(t,e){if(!e.isRogue()){var i=e?e.nodeRoot:null;if(null==i){for(e.nodeRoot=t,e!==t&&(e.nodeNext=t.nodeNext,t.nodeNext=e),i=e.arbiterList;i;i=i.next(e))Ye(t,e==i.body_a?i.body_b:i.body_a);for(i=e.constraintList;i;i=i.next(e))Ye(t,e==i.a?i.b:i.a)}else r(i===t,"Internal Error: Inconsistency detected in the contact graph.")}};ze.prototype.processComponents=function(t){for(var e=1/0!==this.sleepTimeThreshold,i=this.bodies,n=0;n<i.length;n++){var o=i[n];r(null===o.nodeNext,"Internal Error: Dangling next pointer detected in contact graph."),r(null===o.nodeRoot,"Internal Error: Dangling root pointer detected in contact graph.")}if(e)for(var s=(n=this.idleSpeedThreshold)?n*n:I(this.gravity)*t*t,n=0;n<i.length;n++){var o=i[n],c=s?o.m*s:0;o.nodeIdleTime=o.kineticEnergy()>c?0:o.nodeIdleTime+t}for(s=this.arbiters,n=0,c=s.length;c>n;n++){var a=s[n],o=a.body_a;t=a.body_b,e&&((t.isRogue()&&!t.isStatic()||o.isSleeping())&&o.activate(),(o.isRogue()&&!o.isStatic()||t.isSleeping())&&t.activate()),o.pushArbiter(a),t.pushArbiter(a)}if(e){for(e=this.constraints,n=0;n<e.length;n++)t=e[n],o=t.a,t=t.b,t.isRogue()&&!t.isStatic()&&o.activate(),o.isRogue()&&!o.isStatic()&&t.activate();for(n=0;n<i.length;){if(o=i[n],null===(o?o.nodeRoot:null)){Ye(o,o);t:{for(e=o;e;e=e.nodeNext)if(e.nodeIdleTime<this.sleepTimeThreshold){e=!0;break t}e=!1}if(!e){for(this.sleepingComponents.push(o),e=o;e;e=e.nodeNext)this.deactivateBody(e);continue}}n++,o.nodeRoot=null,o.nodeNext=null}}},$.prototype.sleep=function(){this.sleepWithGroup(null)},$.prototype.sleepWithGroup=function(t){n(!this.isStatic()&&!this.isRogue(),"Rogue and static bodies cannot be put to sleep.");var e=this.space;if(n(e,"Cannot put a rogue body to sleep."),n(!e.locked,"Bodies cannot be put to sleep during a query or a call to cpSpaceStep(). Put these calls into a post-step callback."),n(null===t||t.isSleeping(),"Cannot use a non-sleeping body as a group identifier."),this.isSleeping())n((this?this.nodeRoot:null)===(t?t.nodeRoot:null),"The body is already sleeping and it's group cannot be reassigned.");else{for(var i=0;i<this.shapeList.length;i++)this.shapeList[i].update(this.p,this.rot);e.deactivateBody(this),t?(this.nodeRoot=t=t?t.nodeRoot:null,this.nodeNext=t.nodeNext,this.nodeIdleTime=0,t.nodeNext=this):(this.nodeRoot=this,this.nodeNext=null,this.nodeIdleTime=0,e.sleepingComponents.push(this)),a(e.bodies,this)}},ze.prototype.activateShapesTouchingShape=function(t){1/0!==this.sleepTimeThreshold&&this.shapeQuery(t,function(t){t.body.activate()})},ze.prototype.pointQuery=function(t,e,i,n){var r=function(r){(!r.group||i!==r.group)&&e&r.layers&&r.pointQuery(t)&&n(r)},o=new k(t.x,t.y,t.x,t.y);this.lock(),this.activeShapes.query(o,r),this.staticShapes.query(o,r),this.unlock(!0)},ze.prototype.pointQueryFirst=function(t,e,i){var n=null;return this.pointQuery(t,e,i,function(t){t.sensor||(n=t)}),n},ze.prototype.nearestPointQuery=function(t,e,i,n,r){var o=function(o){if((!o.group||n!==o.group)&&i&o.layers){var s=o.nearestPointQuery(t);s.d<e&&r(o,s.d,s.p)}},s=W(t,e);this.lock(),this.activeShapes.query(s,o),this.staticShapes.query(s,o),this.unlock(!0)},ze.prototype.nearestPointQueryNearest=function(t,e,i,n){var r,o=function(o){o.group&&n===o.group||!(i&o.layers)||o.sensor||(o=o.nearestPointQuery(t),o.d<e&&(!r||o.d<r.d)&&(r=o))},s=W(t,e);return this.activeShapes.query(s,o),this.staticShapes.query(s,o),r},ze.prototype.segmentQuery=function(t,e,i,n,r){var o=function(o){var s;return(!o.group||n!==o.group)&&i&o.layers&&(s=o.segmentQuery(t,e))&&r(o,s.t,s.n),1};this.lock(),this.staticShapes.segmentQuery(t,e,1,o),this.activeShapes.segmentQuery(t,e,1,o),this.unlock(!0)},ze.prototype.segmentQueryFirst=function(t,e,i,n){var r=null,o=function(o){var s;return(!o.group||n!==o.group)&&i&o.layers&&!o.sensor&&(s=o.segmentQuery(t,e))&&(null===r||s.t<r.t)&&(r=s),r?r.t:1};return this.staticShapes.segmentQuery(t,e,1,o),this.activeShapes.segmentQuery(t,e,r?r.t:1,o),r},ze.prototype.bbQuery=function(t,e,i,n){var r=function(r){(!r.group||i!==r.group)&&e&r.layers&&t.l<=r.bb_r&&r.bb_l<=t.r&&t.b<=r.bb_t&&r.bb_b<=t.t&&n(r)};this.lock(),this.activeShapes.query(t,r),this.staticShapes.query(t,r),this.unlock(!0)},ze.prototype.shapeQuery=function(t,e){var i=t.body;i&&t.update(i.p,i.rot);var i=new k(t.bb_l,t.bb_b,t.bb_r,t.bb_t),n=!1,r=function(i){if((!t.group||t.group!==i.group)&&t.layers&i.layers&&t!==i){var r;if(t.collisionCode<=i.collisionCode)r=We(t,i);else{r=We(i,t);for(var o=0;o<r.length;o++)r[o].n=v(r[o].n)}if(r.length&&(n=!(t.sensor||i.sensor),e)){for(var s=Array(r.length),o=0;o<r.length;o++)s[o]=new Re(r[o].p,r[o].n,r[o].dist);e(i,s)}}};return this.lock(),this.activeShapes.query(i,r),this.staticShapes.query(i,r),this.unlock(!0),n},ze.prototype.addPostStepCallback=function(t){r(this.locked,"Adding a post-step callback when the space is not locked is unnecessary. Post-step callbacks will not called until the end of the next call to cpSpaceStep() or the next query."),this.postStepCallbacks.push(t)},ze.prototype.runPostStepCallbacks=function(){for(var t=0;t<this.postStepCallbacks.length;t++)this.postStepCallbacks[t]();this.postStepCallbacks=[]},ze.prototype.lock=function(){this.locked++},ze.prototype.unlock=function(t){if(this.locked--,n(0<=this.locked,"Internal Error: Space lock underflow."),0===this.locked&&t){t=this.rousedBodies;for(var e=0;e<t.length;e++)this.activateBody(t[e]);t.length=0,this.runPostStepCallbacks()}},ze.prototype.makeCollideShapes=function(){var t=this;return function(e,i){if(e.bb_l<=i.bb_r&&i.bb_l<=e.bb_r&&e.bb_b<=i.bb_t&&i.bb_b<=e.bb_t&&e.body!==i.body&&(!e.group||e.group!==i.group)&&e.layers&i.layers){var n=t.lookupHandler(e.collision_type,i.collision_type),r=e.sensor||i.sensor;if(!r||n!==Ge){if(e.collisionCode>i.collisionCode){var o=e;e=i,i=o}if(o=We(e,i),0!==o.length){var s=c(e.hashid,i.hashid),a=t.cachedArbiters[s];a||(a=t.cachedArbiters[s]=new Ae(e,i)),a.update(o,n,e,i),"first coll"!=a.state||n.begin(a,t)||a.ignore(),"ignore"!==a.state&&n.preSolve(a,t)&&!r?t.arbiters.push(a):(a.contacts=null,"ignore"!==a.state&&(a.state="normal")),a.stamp=t.stamp}}}}},ze.prototype.arbiterSetFilter=function(t){var e=this.stamp-t.stamp,i=t.body_a,n=t.body_b;return(i.isStatic()||i.isSleeping())&&(n.isStatic()||n.isSleeping())?!0:(e>=1&&"cached"!=t.state&&(t.callSeparate(this),t.state="cached"),e>=this.collisionPersistence?(t.contacts=null,!1):!0)};var Xe=function(t){var e=t.body;t.update(e.p,e.rot)};ze.prototype.step=function(t){if(0!==t){n(0===m.x&&0===m.y,"vzero is invalid"),this.stamp++;var e=this.curr_dt;this.curr_dt=t;var i,r,o=this.bodies,s=this.constraints,c=this.arbiters;for(i=0;i<c.length;i++){var a=c[i];a.state="normal",a.body_a.isSleeping()||a.body_b.isSleeping()||a.unthread()}for(c.length=0,this.lock(),i=0;i<o.length;i++)o[i].position_func(t);this.activeShapes.each(Xe),this.activeShapes.reindexQuery(this.collideShapes),this.unlock(!1),this.processComponents(t),this.lock();for(r in this.cachedArbiters)this.arbiterSetFilter(this.cachedArbiters[r])||delete this.cachedArbiters[r];for(r=this.collisionSlop,a=1-Math.pow(this.collisionBias,t),i=0;i<c.length;i++)c[i].preStep(t,r,a);for(i=0;i<s.length;i++)r=s[i],r.preSolve(this),r.preStep(t);for(r=Math.pow(this.damping,t),a=this.gravity,i=0;i<o.length;i++)o[i].velocity_func(a,r,t);for(t=0===e?0:t/e,i=0;i<c.length;i++)c[i].applyCachedImpulse(t);for(i=0;i<s.length;i++)s[i].applyCachedImpulse(t);for(i=0;i<this.iterations;i++){for(t=0;t<c.length;t++)c[t].applyImpulse();for(t=0;t<s.length;t++)s[t].applyImpulse()}for(i=0;i<s.length;i++)s[i].postSolve(this);for(i=0;i<c.length;i++)c[i].handler.postSolve(c[i],this);this.unlock(!0)}};var He=function(t,e,i,n){return new f(e.vx+-n.y*e.w-(t.vx+-i.y*t.w),e.vy+n.x*e.w-(t.vy+i.x*t.w))},je=function(t,e,i,n,r){return(e.vx+-n.y*e.w-(t.vx+-i.y*t.w))*r.x+(e.vy+n.x*e.w-(t.vy+i.x*t.w))*r.y},qe=function(t,e,i,n){t.vx+=e*t.m_inv,t.vy+=i*t.m_inv,t.w+=t.i_inv*(n.x*i-n.y*e)},Je=function(t,e,i,n,r,o){qe(t,-r,-o,i),qe(e,r,o,n)},Ze=function(t,e,i,n){t.v_biasx+=e*t.m_inv,t.v_biasy+=i*t.m_inv,t.w_bias+=t.i_inv*(n.x*i-n.y*e)},Qe=function(t,e,i){return e=E(e,i),t.m_inv+t.i_inv*e*e},Ke=function(t,e,i,n,o){return t=Qe(t,i,o)+Qe(e,n,o),r(0!==t,"Unsolvable collision or constraint."),t},$e=function(t,e,i,n,o,s){var c;c=t.m_inv+e.m_inv;var a=t.i_inv,l=i.x*i.x*a;t=-i.x*i.y*a,i=c+i.y*i.y*a,c+=l,a=e.i_inv,e=n.x*n.x*a,l=-n.x*n.y*a,i+=n.y*n.y*a,n=0+t+l,t=0+t+l,c+=e,e=i*c-n*t,r(0!==e,"Unsolvable constraint."),e=1/e,o.x=c*e,o.y=-n*e,s.x=-t*e,s.y=i*e},ti=t.Constraint=function(t,e){this.a=t,this.b=e,this.next_b=this.next_a=this.space=null,this.maxForce=1/0,this.errorBias=Math.pow(.9,60),this.maxBias=1/0};ti.prototype.activateBodies=function(){this.a&&this.a.activate(),this.b&&this.b.activate()},ti.prototype.preStep=function(){},ti.prototype.applyCachedImpulse=function(){},ti.prototype.applyImpulse=function(){},ti.prototype.getImpulse=function(){return 0},ti.prototype.preSolve=function(){},ti.prototype.postSolve=function(){},ti.prototype.next=function(t){return this.a===t?this.next_a:this.next_b};var ei=t.PinJoint=function(t,e,i,n){ti.call(this,t,e),this.anchr1=i,this.anchr2=n,t=t?S(t.p,R(i,t.rot)):i,e=e?S(e.p,R(n,e.rot)):n,this.dist=y(C(e,t)),r(0<this.dist,"You created a 0 length pin joint. A pivot joint will be much more stable."),this.n=this.r1=this.r2=null,this.bias=this.jnAcc=this.jnMax=this.nMass=0};ei.prototype=Object.create(ti.prototype),ei.prototype.preStep=function(t){var e=this.a,i=this.b;this.r1=R(this.anchr1,e.rot),this.r2=R(this.anchr2,i.rot);var n=C(S(i.p,this.r2),S(e.p,this.r1)),r=y(n);this.n=x(n,1/(r?r:1/0)),this.nMass=1/Ke(e,i,this.r1,this.r2,this.n),e=this.maxBias,this.bias=_(-(1-Math.pow(this.errorBias,t))*(r-this.dist)/t,-e,e),this.jnMax=this.maxForce*t},ei.prototype.applyCachedImpulse=function(t){t=x(this.n,this.jnAcc*t),Je(this.a,this.b,this.r1,this.r2,t.x,t.y)},ei.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=this.n,n=je(t,e,this.r1,this.r2,i),n=(this.bias-n)*this.nMass,r=this.jnAcc;this.jnAcc=_(r+n,-this.jnMax,this.jnMax),n=this.jnAcc-r,Je(t,e,this.r1,this.r2,i.x*n,i.y*n)},ei.prototype.getImpulse=function(){return Math.abs(this.jnAcc)};var ii=t.SlideJoint=function(t,e,i,n,r,o){ti.call(this,t,e),this.anchr1=i,this.anchr2=n,this.min=r,this.max=o,this.r1=this.r2=this.n=null,this.bias=this.jnAcc=this.jnMax=this.nMass=0};ii.prototype=Object.create(ti.prototype),ii.prototype.preStep=function(t){var e=this.a,i=this.b;this.r1=R(this.anchr1,e.rot),this.r2=R(this.anchr2,i.rot);var n=C(S(i.p,this.r2),S(e.p,this.r1)),r=y(n),o=0;r>this.max?(o=r-this.max,this.n=O(n)):r<this.min?(o=this.min-r,this.n=v(O(n))):(this.n=m,this.jnAcc=0),this.nMass=1/Ke(e,i,this.r1,this.r2,this.n),e=this.maxBias,this.bias=_(-(1-Math.pow(this.errorBias,t))*o/t,-e,e),this.jnMax=this.maxForce*t},ii.prototype.applyCachedImpulse=function(t){t*=this.jnAcc,Je(this.a,this.b,this.r1,this.r2,this.n.x*t,this.n.y*t)},ii.prototype.applyImpulse=function(){if(0!==this.n.x||0!==this.n.y){var t=this.a,e=this.b,i=this.n,n=He(t,e,this.r1,this.r2),n=g(n,i),n=(this.bias-n)*this.nMass,r=this.jnAcc;this.jnAcc=_(r+n,-this.jnMax,0),n=this.jnAcc-r,Je(t,e,this.r1,this.r2,i.x*n,i.y*n)}},ii.prototype.getImpulse=function(){return Math.abs(this.jnAcc)};var ni=t.PivotJoint=function(t,e,i,n){ti.call(this,t,e),"undefined"==typeof n&&(n=i,i=t?t.world2Local(n):n,n=e?e.world2Local(n):n),this.anchr1=i,this.anchr2=n,this.r1=this.r2=m,this.k1=new f(0,0),this.k2=new f(0,0),this.jAcc=m,this.jMaxLen=0,this.bias=m};ni.prototype=Object.create(ti.prototype),ni.prototype.preStep=function(t){var e=this.a,i=this.b;this.r1=R(this.anchr1,e.rot),this.r2=R(this.anchr2,i.rot),$e(e,i,this.r1,this.r2,this.k1,this.k2),this.jMaxLen=this.maxForce*t,e=C(S(i.p,this.r2),S(e.p,this.r1)),this.bias=N(x(e,-(1-Math.pow(this.errorBias,t))/t),this.maxBias)},ni.prototype.applyCachedImpulse=function(t){Je(this.a,this.b,this.r1,this.r2,this.jAcc.x*t,this.jAcc.y*t)},ni.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=He(t,e,this.r1,this.r2),i=C(this.bias,i),n=this.k2,i=new f(g(i,this.k1),g(i,n)),n=this.jAcc;this.jAcc=N(S(this.jAcc,i),this.jMaxLen),Je(t,e,this.r1,this.r2,this.jAcc.x-n.x,this.jAcc.y-n.y)},ni.prototype.getImpulse=function(){return y(this.jAcc)};var ri=t.GrooveJoint=function(t,e,i,n,r){ti.call(this,t,e),this.grv_a=i,this.grv_b=n,this.grv_n=b(D(C(n,i))),this.anchr2=r,this.grv_tn=null,this.clamp=0,this.r1=this.r2=null,this.k1=new f(0,0),this.k2=new f(0,0),this.jAcc=m,this.jMaxLen=0,this.bias=null};ri.prototype=Object.create(ti.prototype),ri.prototype.preStep=function(t){var e=this.a,i=this.b,n=e.local2World(this.grv_a),r=e.local2World(this.grv_b),o=R(this.grv_n,e.rot),s=g(n,o);this.grv_tn=o,this.r2=R(this.anchr2,i.rot);var c=E(S(i.p,this.r2),o);c<=E(n,o)?(this.clamp=1,this.r1=C(n,e.p)):c>=E(r,o)?(this.clamp=-1,this.r1=C(r,e.p)):(this.clamp=0,this.r1=C(S(x(b(o),-c),x(o,s)),e.p)),$e(e,i,this.r1,this.r2,this.k1,this.k2),this.jMaxLen=this.maxForce*t,e=C(S(i.p,this.r2),S(e.p,this.r1)),this.bias=N(x(e,-(1-Math.pow(this.errorBias,t))/t),this.maxBias)},ri.prototype.applyCachedImpulse=function(t){Je(this.a,this.b,this.r1,this.r2,this.jAcc.x*t,this.jAcc.y*t)},ri.prototype.grooveConstrain=function(t){var e=this.grv_tn;return t=0<this.clamp*E(t,e)?t:A(t,e),N(t,this.jMaxLen)},ri.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=He(t,e,this.r1,this.r2),i=C(this.bias,i),n=this.k2,i=new f(g(i,this.k1),g(i,n)),n=this.jAcc;this.jAcc=this.grooveConstrain(S(n,i)),Je(t,e,this.r1,this.r2,this.jAcc.x-n.x,this.jAcc.y-n.y)},ri.prototype.getImpulse=function(){return y(this.jAcc)},ri.prototype.setGrooveA=function(t){this.grv_a=t,this.grv_n=b(D(C(this.grv_b,t))),this.activateBodies()},ri.prototype.setGrooveB=function(t){this.grv_b=t,this.grv_n=b(D(C(t,this.grv_a))),this.activateBodies()};var oi=function(t,e){return(t.restLength-e)*t.stiffness},si=t.DampedSpring=function(t,e,i,n,r,o,s){ti.call(this,t,e),this.anchr1=i,this.anchr2=n,this.restLength=r,this.stiffness=o,this.damping=s,this.springForceFunc=oi,this.target_vrn=this.v_coef=0,this.r1=this.r2=null,this.nMass=0,this.n=null};si.prototype=Object.create(ti.prototype),si.prototype.preStep=function(t){var e=this.a,i=this.b;this.r1=R(this.anchr1,e.rot),this.r2=R(this.anchr2,i.rot);var n=C(S(i.p,this.r2),S(e.p,this.r1)),o=y(n);this.n=x(n,1/(o?o:1/0)),n=Ke(e,i,this.r1,this.r2,this.n),r(0!==n,"Unsolvable this."),this.nMass=1/n,this.target_vrn=0,this.v_coef=1-Math.exp(-this.damping*t*n),o=this.springForceFunc(this,o),Je(e,i,this.r1,this.r2,this.n.x*o*t,this.n.y*o*t)},si.prototype.applyCachedImpulse=function(){},si.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=je(t,e,this.r1,this.r2,this.n),n=(this.target_vrn-i)*this.v_coef;this.target_vrn=i+n,n*=this.nMass,Je(t,e,this.r1,this.r2,this.n.x*n,this.n.y*n)},si.prototype.getImpulse=function(){return 0};var ci=function(t,e){return(e-t.restAngle)*t.stiffness},ai=t.DampedRotarySpring=function(t,e,i,n,r){ti.call(this,t,e),this.restAngle=i,this.stiffness=n,this.damping=r,this.springTorqueFunc=ci,this.iSum=this.w_coef=this.target_wrn=0};ai.prototype=Object.create(ti.prototype),ai.prototype.preStep=function(t){var e=this.a,i=this.b,n=e.i_inv+i.i_inv;r(0!==n,"Unsolvable spring."),this.iSum=1/n,this.w_coef=1-Math.exp(-this.damping*t*n),this.target_wrn=0,t*=this.springTorqueFunc(this,e.a-i.a),e.w-=t*e.i_inv,i.w+=t*i.i_inv},ai.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=t.w-e.w,n=(this.target_wrn-i)*this.w_coef;this.target_wrn=i+n,i=n*this.iSum,t.w+=i*t.i_inv,e.w-=i*e.i_inv};var li=t.RotaryLimitJoint=function(t,e,i,n){ti.call(this,t,e),this.min=i,this.max=n,this.iSum=this.bias=this.jMax=this.jAcc=0};li.prototype=Object.create(ti.prototype),li.prototype.preStep=function(t){var e=this.a,i=this.b,n=i.a-e.a,r=0;n>this.max?r=this.max-n:n<this.min&&(r=this.min-n),this.iSum=1/(1/e.i+1/i.i),e=this.maxBias,this.bias=_(-(1-Math.pow(this.errorBias,t))*r/t,-e,e),this.jMax=this.maxForce*t,this.bias||(this.jAcc=0)},li.prototype.applyCachedImpulse=function(t){var e=this.a,i=this.b;t*=this.jAcc,e.w-=t*e.i_inv,i.w+=t*i.i_inv},li.prototype.applyImpulse=function(){if(this.bias){var t=this.a,e=this.b,i=-(this.bias+(e.w-t.w))*this.iSum,n=this.jAcc;this.jAcc=0>this.bias?_(n+i,0,this.jMax):_(n+i,-this.jMax,0),i=this.jAcc-n,t.w-=i*t.i_inv,e.w+=i*e.i_inv}},li.prototype.getImpulse=function(){return Math.abs(joint.jAcc)};var hi=t.RatchetJoint=function(t,e,i,n){ti.call(this,t,e),this.angle=0,this.phase=i,this.ratchet=n,this.angle=(e?e.a:0)-(t?t.a:0),this.iSum=this.bias=this.jAcc=this.jMax=0};hi.prototype=Object.create(ti.prototype),hi.prototype.preStep=function(t){var e=this.a,i=this.b,n=this.phase,r=this.ratchet,o=i.a-e.a,s=this.angle-o,c=0;s*r>0?c=s:this.angle=Math.floor((o-n)/r)*r+n,this.iSum=1/(e.i_inv+i.i_inv),e=this.maxBias,this.bias=_(-(1-Math.pow(this.errorBias,t))*c/t,-e,e),this.jMax=this.maxForce*t,this.bias||(this.jAcc=0)},hi.prototype.applyCachedImpulse=function(t){var e=this.a,i=this.b;t*=this.jAcc,e.w-=t*e.i_inv,i.w+=t*i.i_inv},hi.prototype.applyImpulse=function(){if(this.bias){var t=this.a,e=this.b,i=this.ratchet,n=-(this.bias+(e.w-t.w))*this.iSum,r=this.jAcc;this.jAcc=_((r+n)*i,0,this.jMax*Math.abs(i))/i,n=this.jAcc-r,t.w-=n*t.i_inv,e.w+=n*e.i_inv}},hi.prototype.getImpulse=function(t){return Math.abs(t.jAcc)};var ui=t.GearJoint=function(t,e,i,n){ti.call(this,t,e),this.phase=i,this.ratio=n,this.ratio_inv=1/n,this.iSum=this.bias=this.jMax=this.jAcc=0};ui.prototype=Object.create(ti.prototype),ui.prototype.preStep=function(t){var e=this.a,i=this.b;this.iSum=1/(e.i_inv*this.ratio_inv+this.ratio*i.i_inv);var n=this.maxBias;this.bias=_(-(1-Math.pow(this.errorBias,t))*(i.a*this.ratio-e.a-this.phase)/t,-n,n),this.jMax=this.maxForce*t},ui.prototype.applyCachedImpulse=function(t){var e=this.a,i=this.b;t*=this.jAcc,e.w-=t*e.i_inv*this.ratio_inv,i.w+=t*i.i_inv},ui.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=(this.bias-(e.w*this.ratio-t.w))*this.iSum,n=this.jAcc;this.jAcc=_(n+i,-this.jMax,this.jMax),i=this.jAcc-n,t.w-=i*t.i_inv*this.ratio_inv,e.w+=i*e.i_inv},ui.prototype.getImpulse=function(){return Math.abs(this.jAcc)},ui.prototype.setRatio=function(t){this.ratio=t,this.ratio_inv=1/t,this.activateBodies()};var di=t.SimpleMotor=function(t,e,i){ti.call(this,t,e),this.rate=i,this.iSum=this.jMax=this.jAcc=0};di.prototype=Object.create(ti.prototype),di.prototype.preStep=function(t){this.iSum=1/(this.a.i_inv+this.b.i_inv),this.jMax=this.maxForce*t},di.prototype.applyCachedImpulse=function(t){var e=this.a,i=this.b;t*=this.jAcc,e.w-=t*e.i_inv,i.w+=t*i.i_inv},di.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=-(e.w-t.w+this.rate)*this.iSum,n=this.jAcc;this.jAcc=_(n+i,-this.jMax,this.jMax),i=this.jAcc-n,t.w-=i*t.i_inv,e.w+=i*e.i_inv},di.prototype.getImpulse=function(){return Math.abs(this.jAcc)}}();var io="undefined"==typeof module?{}:module.exports;!function(){if(function(t,e){t.version="0.9.16",t.protocol=1,t.transports=[],t.j=[],t.sockets={},t.connect=function(i,n){var r,o,s=t.util.parseUri(i);e&&e.location&&(s.protocol=s.protocol||e.location.protocol.slice(0,-1),s.host=s.host||(e.document?e.document.domain:e.location.hostname),s.port=s.port||e.location.port),r=t.util.uniqueUri(s);var c={host:s.host,secure:"https"==s.protocol,port:s.port||("https"==s.protocol?443:80),query:s.query||""};return t.util.merge(c,n),(c["force new connection"]||!t.sockets[r])&&(o=new t.Socket(c)),!c["force new connection"]&&o&&(t.sockets[r]=o),o=o||t.sockets[r],o.of(1<s.path.length?s.path:"")}}("object"==typeof module?module.exports:this.io={},this),function(t,e){var i=t.util={},n=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,r="source protocol authority userInfo user password host port relative path directory file query anchor".split(" ");i.parseUri=function(t){t=n.exec(t||"");for(var e={},i=14;i--;)e[r[i]]=t[i]||"";return e},i.uniqueUri=function(t){var i=t.protocol,n=t.host;return t=t.port,"document"in e?(n=n||document.domain,t=t||("https"==i&&"https:"!==document.location.protocol?443:document.location.port)):(n=n||"localhost",!t&&"https"==i&&(t=443)),(i||"http")+"://"+n+":"+(t||80)},i.query=function(t,e){var n=i.chunkQuery(t||""),r=[];i.merge(n,i.chunkQuery(e||""));for(var o in n)n.hasOwnProperty(o)&&r.push(o+"="+n[o]);return r.length?"?"+r.join("&"):""},i.chunkQuery=function(t){var e={};t=t.split("&");for(var i,n=0,r=t.length;r>n;++n)i=t[n].split("="),i[0]&&(e[i[0]]=i[1]);return e};var o=!1;i.load=function(t){return"document"in e&&"complete"===document.readyState||o?t():void i.on(e,"load",t,!1)},i.on=function(t,e,i,n){t.attachEvent?t.attachEvent("on"+e,i):t.addEventListener&&t.addEventListener(e,i,n)},i.request=function(t){if(t&&"undefined"!=typeof XDomainRequest&&!i.ua.hasCORS)return new XDomainRequest;if("undefined"!=typeof XMLHttpRequest&&(!t||i.ua.hasCORS))return new XMLHttpRequest;if(!t)try{return new(window[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}return null},"undefined"!=typeof window&&i.load(function(){o=!0}),i.defer=function(t){return i.ua.webkit&&"undefined"==typeof importScripts?void i.load(function(){setTimeout(t,100)}):t()},i.merge=function(t,e,n,r){r=r||[],n="undefined"==typeof n?2:n;for(var o in e)e.hasOwnProperty(o)&&0>i.indexOf(r,o)&&("object"==typeof t[o]&&n?i.merge(t[o],e[o],n-1,r):(t[o]=e[o],r.push(e[o])));return t},i.mixin=function(t,e){i.merge(t.prototype,e.prototype)},i.inherit=function(t,e){function i(){}i.prototype=e.prototype,t.prototype=new i},i.isArray=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},i.intersect=function(t,e){for(var n=[],r=t.length>e.length?t:e,o=t.length>e.length?e:t,s=0,c=o.length;c>s;s++)~i.indexOf(r,o[s])&&n.push(o[s]);return n},i.indexOf=function(t,e,i){var n=t.length;for(i=0>i?0>i+n?0:i+n:i||0;n>i&&t[i]!==e;i++);return i>=n?-1:i},i.toArray=function(t){for(var e=[],i=0,n=t.length;n>i;i++)e.push(t[i]);return e},i.ua={},i.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var t=new XMLHttpRequest}catch(e){return!1}return void 0!=t.withCredentials}(),i.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent),i.ua.iDevice="undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)}("undefined"!=typeof io?io:module.exports,this),function(t,e){function i(){}t.EventEmitter=i,i.prototype.on=function(t,i){return this.$events||(this.$events={}),this.$events[t]?e.util.isArray(this.$events[t])?this.$events[t].push(i):this.$events[t]=[this.$events[t],i]:this.$events[t]=i,this},i.prototype.addListener=i.prototype.on,i.prototype.once=function(t,e){function i(){n.removeListener(t,i),e.apply(this,arguments)}var n=this;return i.listener=e,this.on(t,i),this},i.prototype.removeListener=function(t,i){if(this.$events&&this.$events[t]){var n=this.$events[t];if(e.util.isArray(n)){for(var r=-1,o=0,s=n.length;s>o;o++)if(n[o]===i||n[o].listener&&n[o].listener===i){r=o;break}if(0>r)return this;n.splice(r,1),n.length||delete this.$events[t]}else(n===i||n.listener&&n.listener===i)&&delete this.$events[t]}return this},i.prototype.removeAllListeners=function(t){return void 0===t?(this.$events={},this):(this.$events&&this.$events[t]&&(this.$events[t]=null),this)},i.prototype.listeners=function(t){return this.$events||(this.$events={}),this.$events[t]||(this.$events[t]=[]),e.util.isArray(this.$events[t])||(this.$events[t]=[this.$events[t]]),this.$events[t]},i.prototype.emit=function(t){if(!this.$events)return!1;var i=this.$events[t];if(!i)return!1;var n=Array.prototype.slice.call(arguments,1);if("function"==typeof i)i.apply(this,n);else{if(!e.util.isArray(i))return!1;for(var i=i.slice(),r=0,o=i.length;o>r;r++)i[r].apply(this,n)}return!0}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(a,c){function d(t){return 10>t?"0"+t:t}function e(t){return k.lastIndex=0,k.test(t)?'"'+t.replace(k,function(t){var e=p[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+t+'"'}function f(t,i){var o,s,c,a,l,h=m,u=i[t];switch(u instanceof Date&&(u=isFinite(t.valueOf())?t.getUTCFullYear()+"-"+d(t.getUTCMonth()+1)+"-"+d(t.getUTCDate())+"T"+d(t.getUTCHours())+":"+d(t.getUTCMinutes())+":"+d(t.getUTCSeconds())+"Z":null),"function"==typeof r&&(u=r.call(i,t,u)),typeof u){case"string":return e(u);case"number":return isFinite(u)?String(u):"null";case"boolean":case"null":return String(u);case"object":if(!u)return"null";if(m+=n,l=[],"[object Array]"===Object.prototype.toString.apply(u)){for(a=u.length,o=0;a>o;o+=1)l[o]=f(o,u)||"null";return c=0===l.length?"[]":m?"[\n"+m+l.join(",\n"+m)+"\n"+h+"]":"["+l.join(",")+"]",m=h,c}if(r&&"object"==typeof r)for(a=r.length,o=0;a>o;o+=1)"string"==typeof r[o]&&(s=r[o],c=f(s,u),c&&l.push(e(s)+(m?": ":":")+c));else for(s in u)Object.prototype.hasOwnProperty.call(u,s)&&(c=f(s,u),c&&l.push(e(s)+(m?": ":":")+c));return c=0===l.length?"{}":m?"{\n"+m+l.join(",\n"+m)+"\n"+h+"}":"{"+l.join(",")+"}",m=h,c}}if(c&&c.parse)return a.JSON={parse:c.parse,stringify:c.stringify};var g=a.JSON={},h=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,k=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,m,n,p={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},r;g.stringify=function(t,e,i){var o;if(n=m="","number"==typeof i)for(o=0;i>o;o+=1)n+=" ";else"string"==typeof i&&(n=i);if(r=e,!e||"function"==typeof e||"object"==typeof e&&"number"==typeof e.length)return f("",{"":t});throw Error("JSON.stringify")},g.parse=function(a,b){function c(t,e){var i,n,r=t[e];if(r&&"object"==typeof r)for(i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n=c(r,i),void 0!==n?r[i]=n:delete r[i]);return b.call(t,e,r)}var d;if(a=String(a),h.lastIndex=0,h.test(a)&&(a=a.replace(h,function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return d=eval("("+a+")"),"function"==typeof b?c({"":d},""):d;throw new SyntaxError("JSON.parse")}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof JSON?JSON:void 0),function(t,e){var i=t.parser={},n=i.packets="disconnect connect heartbeat message json event ack error noop".split(" "),r=i.reasons=["transport not supported","client not handshaken","unauthorized"],o=i.advice=["reconnect"],s=e.JSON,c=e.util.indexOf;i.encodePacket=function(t){var e=c(n,t.type),i=t.id||"",a=t.endpoint||"",l=t.ack,h=null;switch(t.type){case"error":var u=t.reason?c(r,t.reason):"";t=t.advice?c(o,t.advice):"",(""!==u||""!==t)&&(h=u+(""!==t?"+"+t:""));break;case"message":""!==t.data&&(h=t.data);break;case"event":h={name:t.name},t.args&&t.args.length&&(h.args=t.args),h=s.stringify(h);break;case"json":h=s.stringify(t.data);break;case"connect":t.qs&&(h=t.qs);break;case"ack":h=t.ackId+(t.args&&t.args.length?"+"+s.stringify(t.args):"")}return e=[e,i+("data"==l?"+":""),a],null!==h&&void 0!==h&&e.push(h),e.join(":")},i.encodePayload=function(t){var e="";
if(1==t.length)return t[0];for(var i=0,n=t.length;n>i;i++)e+=""+t[i].length+""+t[i];return e};var a=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;i.decodePacket=function(t){var e=t.match(a);if(!e)return{};var i=e[2]||"";t=e[5]||"";var c={type:n[e[1]],endpoint:e[4]||""};switch(i&&(c.id=i,c.ack=e[3]?"data":!0),c.type){case"error":e=t.split("+"),c.reason=r[e[0]]||"",c.advice=o[e[1]]||"";break;case"message":c.data=t||"";break;case"event":try{var l=s.parse(t);c.name=l.name,c.args=l.args}catch(h){}c.args=c.args||[];break;case"json":try{c.data=s.parse(t)}catch(u){}break;case"connect":c.qs=t||"";break;case"ack":if((e=t.match(/^([0-9]+)(\+)?(.*)/))&&(c.ackId=e[1],c.args=[],e[3]))try{c.args=e[3]?s.parse(e[3]):[]}catch(d){}}return c},i.decodePayload=function(t){if(""==t.charAt(0)){for(var e=[],n=1,r="";n<t.length;n++)""==t.charAt(n)?(e.push(i.decodePacket(t.substr(n+1).substr(0,r))),n+=Number(r)+1,r=""):r+=t.charAt(n);return e}return[i.decodePacket(t)]}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(t,e){function i(t,e){this.socket=t,this.sessid=e}t.Transport=i,e.util.mixin(i,e.EventEmitter),i.prototype.heartbeats=function(){return!0},i.prototype.onData=function(t){if(this.clearCloseTimeout(),(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout(),""!==t&&(t=e.parser.decodePayload(t))&&t.length)for(var i=0,n=t.length;n>i;i++)this.onPacket(t[i]);return this},i.prototype.onPacket=function(t){return this.socket.setHeartbeatTimeout(),"heartbeat"==t.type?this.onHeartbeat():("connect"==t.type&&""==t.endpoint&&this.onConnect(),"error"==t.type&&"reconnect"==t.advice&&(this.isOpen=!1),this.socket.onPacket(t),this)},i.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var t=this;this.closeTimeout=setTimeout(function(){t.onDisconnect()},this.socket.closeTimeout)}},i.prototype.onDisconnect=function(){return this.isOpen&&this.close(),this.clearTimeouts(),this.socket.onDisconnect(),this},i.prototype.onConnect=function(){return this.socket.onConnect(),this},i.prototype.clearCloseTimeout=function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)},i.prototype.clearTimeouts=function(){this.clearCloseTimeout(),this.reopenTimeout&&clearTimeout(this.reopenTimeout)},i.prototype.packet=function(t){this.send(e.parser.encodePacket(t))},i.prototype.onHeartbeat=function(){this.packet({type:"heartbeat"})},i.prototype.onOpen=function(){this.isOpen=!0,this.clearCloseTimeout(),this.socket.onOpen()},i.prototype.onClose=function(){this.isOpen=!1,this.socket.onClose(),this.onDisconnect()},i.prototype.prepareUrl=function(){var t=this.socket.options;return this.scheme()+"://"+t.host+":"+t.port+"/"+t.resource+"/"+e.protocol+"/"+this.name+"/"+this.sessid},i.prototype.ready=function(t,e){e.call(this)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(t,e,i){function n(t){if(this.options={port:80,secure:!1,document:"document"in i?document:!1,resource:"socket.io",transports:e.transports,"connect timeout":1e4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":1/0,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":!1,"auto connect":!0,"flash policy port":10843,manualFlush:!1},e.util.merge(this.options,t),this.reconnecting=this.connecting=this.open=this.connected=!1,this.namespaces={},this.buffer=[],this.doBuffer=!1,this.options["sync disconnect on unload"]&&(!this.isXDomain()||e.util.ua.hasCORS)){var n=this;e.util.on(i,"beforeunload",function(){n.disconnectSync()},!1)}this.options["auto connect"]&&this.connect()}function r(){}t.Socket=n,e.util.mixin(n,e.EventEmitter),n.prototype.of=function(t){return this.namespaces[t]||(this.namespaces[t]=new e.SocketNamespace(this,t),""!==t&&this.namespaces[t].packet({type:"connect"})),this.namespaces[t]},n.prototype.publish=function(){this.emit.apply(this,arguments);var t,e;for(e in this.namespaces)this.namespaces.hasOwnProperty(e)&&(t=this.of(e),t.$emit.apply(t,arguments))},n.prototype.handshake=function(t){function i(e){e instanceof Error?(n.connecting=!1,n.onError(e.message)):t.apply(null,e.split(":"))}var n=this,o=this.options,o=["http"+(o.secure?"s":"")+":/",o.host+":"+o.port,o.resource,e.protocol,e.util.query(this.options.query,"t="+ +new Date)].join("/");if(this.isXDomain()&&!e.util.ua.hasCORS){var s=document.getElementsByTagName("script")[0],c=document.createElement("script");c.src=o+"&jsonp="+e.j.length,s.parentNode.insertBefore(c,s),e.j.push(function(t){i(t),c.parentNode.removeChild(c)})}else{var a=e.util.request();a.open("GET",o,!0),this.isXDomain()&&(a.withCredentials=!0),a.onreadystatechange=function(){4==a.readyState&&(a.onreadystatechange=r,200==a.status?i(a.responseText):403==a.status?n.onError(a.responseText):(n.connecting=!1,!n.reconnecting&&n.onError(a.responseText)))},a.send(null)}},n.prototype.getTransport=function(t){t=t||this.transports;for(var i,n=0;i=t[n];n++)if(e.Transport[i]&&e.Transport[i].check(this)&&(!this.isXDomain()||e.Transport[i].xdomainCheck(this)))return new e.Transport[i](this,this.sessionid);return null},n.prototype.connect=function(t){if(this.connecting)return this;var i=this;return i.connecting=!0,this.handshake(function(n,r,o,s){function c(t){return i.transport&&i.transport.clearTimeouts(),i.transport=i.getTransport(t),i.transport?void i.transport.ready(i,function(){i.connecting=!0,i.publish("connecting",i.transport.name),i.transport.open(),i.options["connect timeout"]&&(i.connectTimeoutTimer=setTimeout(function(){if(!i.connected&&(i.connecting=!1,i.options["try multiple transports"])){for(var t=i.transports;0<t.length&&t.splice(0,1)[0]!=i.transport.name;);t.length?c(t):i.publish("connect_failed")}},i.options["connect timeout"]))}):i.publish("connect_failed")}i.sessionid=n,i.closeTimeout=1e3*o,i.heartbeatTimeout=1e3*r,i.transports||(i.transports=i.origTransports=s?e.util.intersect(s.split(","),i.options.transports):i.options.transports),i.setHeartbeatTimeout(),c(i.transports),i.once("connect",function(){clearTimeout(i.connectTimeoutTimer),t&&"function"==typeof t&&t()})}),this},n.prototype.setHeartbeatTimeout=function(){if(clearTimeout(this.heartbeatTimeoutTimer),!this.transport||this.transport.heartbeats()){var t=this;this.heartbeatTimeoutTimer=setTimeout(function(){t.transport.onClose()},this.heartbeatTimeout)}},n.prototype.packet=function(t){return this.connected&&!this.doBuffer?this.transport.packet(t):this.buffer.push(t),this},n.prototype.setBuffer=function(t){this.doBuffer=t,!t&&this.connected&&this.buffer.length&&(this.options.manualFlush||this.flushBuffer())},n.prototype.flushBuffer=function(){this.transport.payload(this.buffer),this.buffer=[]},n.prototype.disconnect=function(){return(this.connected||this.connecting)&&(this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted")),this},n.prototype.disconnectSync=function(){var t=e.util.request(),i=["http"+(this.options.secure?"s":"")+":/",this.options.host+":"+this.options.port,this.options.resource,e.protocol,"",this.sessionid].join("/")+"/?disconnect=1";t.open("GET",i,!1),t.send(null),this.onDisconnect("booted")},n.prototype.isXDomain=function(){var t=i.location.port||("https:"==i.location.protocol?443:80);return this.options.host!==i.location.hostname||this.options.port!=t},n.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))},n.prototype.onOpen=function(){this.open=!0},n.prototype.onClose=function(){this.open=!1,clearTimeout(this.heartbeatTimeoutTimer)},n.prototype.onPacket=function(t){this.of(t.endpoint).onPacket(t)},n.prototype.onError=function(t){t&&t.advice&&"reconnect"===t.advice&&(this.connected||this.connecting)&&(this.disconnect(),this.options.reconnect&&this.reconnect()),this.publish("error",t&&t.reason?t.reason:t)},n.prototype.onDisconnect=function(t){var e=this.connected,i=this.connecting;this.open=this.connecting=this.connected=!1,(e||i)&&(this.transport.close(),this.transport.clearTimeouts(),e&&(this.publish("disconnect",t),"booted"!=t&&this.options.reconnect&&!this.reconnecting&&this.reconnect()))},n.prototype.reconnect=function(){function t(){if(i.connected){for(var t in i.namespaces)i.namespaces.hasOwnProperty(t)&&""!==t&&i.namespaces[t].packet({type:"connect"});i.publish("reconnect",i.transport.name,i.reconnectionAttempts)}clearTimeout(i.reconnectionTimer),i.removeListener("connect_failed",e),i.removeListener("connect",e),i.reconnecting=!1,delete i.reconnectionAttempts,delete i.reconnectionDelay,delete i.reconnectionTimer,delete i.redoTransports,i.options["try multiple transports"]=r}function e(){if(i.reconnecting){if(i.connected)return t();if(i.connecting&&i.reconnecting)return i.reconnectionTimer=setTimeout(e,1e3);i.reconnectionAttempts++>=n?i.redoTransports?(i.publish("reconnect_failed"),t()):(i.on("connect_failed",e),i.options["try multiple transports"]=!0,i.transports=i.origTransports,i.transport=i.getTransport(),i.redoTransports=!0,i.connect()):(i.reconnectionDelay<o&&(i.reconnectionDelay*=2),i.connect(),i.publish("reconnecting",i.reconnectionDelay,i.reconnectionAttempts),i.reconnectionTimer=setTimeout(e,i.reconnectionDelay))}}this.reconnecting=!0,this.reconnectionAttempts=0,this.reconnectionDelay=this.options["reconnection delay"];var i=this,n=this.options["max reconnection attempts"],r=this.options["try multiple transports"],o=this.options["reconnection limit"];this.options["try multiple transports"]=!1,this.reconnectionTimer=setTimeout(e,this.reconnectionDelay),this.on("connect",e)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(t,e){function i(t,e){this.socket=t,this.name=e||"",this.flags={},this.json=new n(this,"json"),this.ackPackets=0,this.acks={}}function n(t,e){this.namespace=t,this.name=e}t.SocketNamespace=i,e.util.mixin(i,e.EventEmitter),i.prototype.$emit=e.EventEmitter.prototype.emit,i.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)},i.prototype.packet=function(t){return t.endpoint=this.name,this.socket.packet(t),this.flags={},this},i.prototype.send=function(t,e){var i={type:this.flags.json?"json":"message",data:t};return"function"==typeof e&&(i.id=++this.ackPackets,i.ack=!0,this.acks[i.id]=e),this.packet(i)},i.prototype.emit=function(t){var e=Array.prototype.slice.call(arguments,1),i=e[e.length-1],n={type:"event",name:t};return"function"==typeof i&&(n.id=++this.ackPackets,n.ack="data",this.acks[n.id]=i,e=e.slice(0,e.length-1)),n.args=e,this.packet(n)},i.prototype.disconnect=function(){return""===this.name?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect")),this},i.prototype.onPacket=function(t){function i(){n.packet({type:"ack",args:e.util.toArray(arguments),ackId:t.id})}var n=this;switch(t.type){case"connect":this.$emit("connect");break;case"disconnect":""===this.name?this.socket.onDisconnect(t.reason||"booted"):this.$emit("disconnect",t.reason);break;case"message":case"json":var r=["message",t.data];"data"==t.ack?r.push(i):t.ack&&this.packet({type:"ack",ackId:t.id}),this.$emit.apply(this,r);break;case"event":r=[t.name].concat(t.args),"data"==t.ack&&r.push(i),this.$emit.apply(this,r);break;case"ack":this.acks[t.ackId]&&(this.acks[t.ackId].apply(this,t.args),delete this.acks[t.ackId]);break;case"error":t.advice?this.socket.onError(t):"unauthorized"==t.reason?this.$emit("connect_failed",t.reason):this.$emit("error",t.reason)}},n.prototype.send=function(){this.namespace.flags[this.name]=!0,this.namespace.send.apply(this.namespace,arguments)},n.prototype.emit=function(){this.namespace.flags[this.name]=!0,this.namespace.emit.apply(this.namespace,arguments)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(t,e,i){function n(){e.Transport.apply(this,arguments)}t.websocket=n,e.util.inherit(n,e.Transport),n.prototype.name="websocket",n.prototype.open=function(){var t,n=e.util.query(this.socket.options.query),r=this;return t||(t=i.MozWebSocket||i.WebSocket),this.websocket=new t(this.prepareUrl()+n),this.websocket.onopen=function(){r.onOpen(),r.socket.setBuffer(!1)},this.websocket.onmessage=function(t){r.onData(t.data)},this.websocket.onclose=function(){r.onClose(),r.socket.setBuffer(!0)},this.websocket.onerror=function(t){r.onError(t)},this},n.prototype.send=e.util.ua.iDevice?function(t){var e=this;return setTimeout(function(){e.websocket.send(t)},0),this}:function(t){return this.websocket.send(t),this},n.prototype.payload=function(t){for(var e=0,i=t.length;i>e;e++)this.packet(t[e]);return this},n.prototype.close=function(){return this.websocket.close(),this},n.prototype.onError=function(t){this.socket.onError(t)},n.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"},n.check=function(){return"WebSocket"in i&&!("__addTask"in WebSocket)||"MozWebSocket"in i},n.xdomainCheck=function(){return!0},e.transports.push("websocket")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(t,e){function i(){e.Transport.websocket.apply(this,arguments)}t.flashsocket=i,e.util.inherit(i,e.Transport.websocket),i.prototype.name="flashsocket",i.prototype.open=function(){var t=this,i=arguments;return WebSocket.__addTask(function(){e.Transport.websocket.prototype.open.apply(t,i)}),this},i.prototype.send=function(){var t=this,i=arguments;return WebSocket.__addTask(function(){e.Transport.websocket.prototype.send.apply(t,i)}),this},i.prototype.close=function(){return WebSocket.__tasks.length=0,e.Transport.websocket.prototype.close.call(this),this},i.prototype.ready=function(t,n){function r(){var e=t.options,r=e["flash policy port"],s=["http"+(e.secure?"s":"")+":/",e.host+":"+e.port,e.resource,"static/flashsocket","WebSocketMain"+(t.isXDomain()?"Insecure":"")+".swf"];i.loaded||("undefined"==typeof WEB_SOCKET_SWF_LOCATION&&(WEB_SOCKET_SWF_LOCATION=s.join("/")),843!==r&&WebSocket.loadFlashPolicyFile("xmlsocket://"+e.host+":"+r),WebSocket.__initialize(),i.loaded=!0),n.call(o)}var o=this;return document.body?r():void e.util.load(r)},i.check=function(){return"undefined"!=typeof WebSocket&&"__initialize"in WebSocket&&a?10<=a.getFlashPlayerVersion().major:!1},i.xdomainCheck=function(){return!0},"undefined"!=typeof window&&(WEB_SOCKET_DISABLE_AUTO_INITIALIZATION=!0),e.transports.push("flashsocket")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports),"undefined"!=typeof window)var a=function(){function t(){if(!M){try{var t=w.getElementsByTagName("body")[0].appendChild(w.createElement("span"));t.parentNode.removeChild(t)}catch(e){return}M=!0;for(var t=O.length,i=0;t>i;i++)O[i]()}}function e(t){M?t():O[O.length]=t}function i(t){if(typeof I.addEventListener!=b)I.addEventListener("load",t,!1);else if(typeof w.addEventListener!=b)w.addEventListener("load",t,!1);else if(typeof I.attachEvent!=b)p(I,"onload",t);else if("function"==typeof I.onload){var e=I.onload;I.onload=function(){e(),t()}}else I.onload=t}function n(){var t=w.getElementsByTagName("body")[0],e=w.createElement(A);e.setAttribute("type",R);var i=t.appendChild(e);if(i){var n=0;!function(){if(typeof i.GetVariable!=b){var o=i.GetVariable("$version");o&&(o=o.split(" ")[1].split(","),W.pv=[parseInt(o[0],10),parseInt(o[1],10),parseInt(o[2],10)])}else if(10>n)return n++,void setTimeout(arguments.callee,10);t.removeChild(e),i=null,r()}()}else r()}function r(){var t=N.length;if(t>0)for(var e=0;t>e;e++){var i=N[e].id,n=N[e].callbackFn,r={success:!1,id:i};if(0<W.pv[0]){var a=_(i);if(a)if(!f(N[e].swfVersion)||W.wk&&312>W.wk)if(N[e].expressInstall&&s()){r={},r.data=N[e].expressInstall,r.width=a.getAttribute("width")||"0",r.height=a.getAttribute("height")||"0",a.getAttribute("class")&&(r.styleclass=a.getAttribute("class")),a.getAttribute("align")&&(r.align=a.getAttribute("align"));for(var h={},a=a.getElementsByTagName("param"),u=a.length,d=0;u>d;d++)"movie"!=a[d].getAttribute("name").toLowerCase()&&(h[a[d].getAttribute("name")]=a[d].getAttribute("value"));c(r,h,i,n)}else l(a),n&&n(r);else g(i,!0),n&&(r.success=!0,r.ref=o(i),n(r))}else g(i,!0),n&&((i=o(i))&&typeof i.SetVariable!=b&&(r.success=!0,r.ref=i),n(r))}}function o(t){var e=null;return(t=_(t))&&"OBJECT"==t.nodeName&&(typeof t.SetVariable!=b?e=t:(t=t.getElementsByTagName(A)[0])&&(e=t)),e}function s(){return!V&&f("6.0.65")&&(W.win||W.mac)&&!(W.wk&&312>W.wk)}function c(t,e,i,n){V=!0,C=n||null,v={success:!1,id:i};var r=_(i);r&&("OBJECT"==r.nodeName?(T=h(r),S=null):(T=r,S=i),t.id=P,(typeof t.width==b||!/%$/.test(t.width)&&310>parseInt(t.width,10))&&(t.width="310"),(typeof t.height==b||!/%$/.test(t.height)&&137>parseInt(t.height,10))&&(t.height="137"),w.title=w.title.slice(0,47)+" - Flash Player Installation",n=W.ie&&W.win?["Active"].concat("").join("X"):"PlugIn",n="MMredirectURL="+I.location.toString().replace(/&/g,"%26")+"&MMplayerType="+n+"&MMdoctitle="+w.title,typeof e.flashvars!=b?e.flashvars+="&"+n:e.flashvars=n,W.ie&&W.win&&4!=r.readyState&&(n=w.createElement("div"),i+="SWFObjectNew",n.setAttribute("id",i),r.parentNode.insertBefore(n,r),r.style.display="none",function(){4==r.readyState?r.parentNode.removeChild(r):setTimeout(arguments.callee,10)}()),u(t,e,i))}function l(t){if(W.ie&&W.win&&4!=t.readyState){var e=w.createElement("div");t.parentNode.insertBefore(e,t),e.parentNode.replaceChild(h(t),e),t.style.display="none",function(){4==t.readyState?t.parentNode.removeChild(t):setTimeout(arguments.callee,10)}()}else t.parentNode.replaceChild(h(t),t)}function h(t){var e=w.createElement("div");if(W.win&&W.ie)e.innerHTML=t.innerHTML;else if((t=t.getElementsByTagName(A)[0])&&(t=t.childNodes))for(var i=t.length,n=0;i>n;n++)1==t[n].nodeType&&"PARAM"==t[n].nodeName||8==t[n].nodeType||e.appendChild(t[n].cloneNode(!0));return e}function u(t,e,i){var n,r=_(i);if(W.wk&&312>W.wk)return n;if(r)if(typeof t.id==b&&(t.id=i),W.ie&&W.win){var o,s="";for(o in t)t[o]!=Object.prototype[o]&&("data"==o.toLowerCase()?e.movie=t[o]:"styleclass"==o.toLowerCase()?s+=' class="'+t[o]+'"':"classid"!=o.toLowerCase()&&(s+=" "+o+'="'+t[o]+'"'));o="";for(var c in e)e[c]!=Object.prototype[c]&&(o+='<param name="'+c+'" value="'+e[c]+'" />');r.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+s+">"+o+"</object>",B[B.length]=t.id,n=_(t.id)}else{c=w.createElement(A),c.setAttribute("type",R);for(var a in t)t[a]!=Object.prototype[a]&&("styleclass"==a.toLowerCase()?c.setAttribute("class",t[a]):"classid"!=a.toLowerCase()&&c.setAttribute(a,t[a]));for(s in e)e[s]!=Object.prototype[s]&&"movie"!=s.toLowerCase()&&(t=c,o=s,a=e[s],i=w.createElement("param"),i.setAttribute("name",o),i.setAttribute("value",a),t.appendChild(i));r.parentNode.replaceChild(c,r),n=c}return n}function d(t){var e=_(t);e&&"OBJECT"==e.nodeName&&(W.ie&&W.win?(e.style.display="none",function(){if(4==e.readyState){var i=_(t);if(i){for(var n in i)"function"==typeof i[n]&&(i[n]=null);i.parentNode.removeChild(i)}}else setTimeout(arguments.callee,10)}()):e.parentNode.removeChild(e))}function _(t){var e=null;try{e=w.getElementById(t)}catch(i){}return e}function p(t,e,i){t.attachEvent(e,i),F[F.length]=[t,e,i]}function f(t){var e=W.pv;return t=t.split("."),t[0]=parseInt(t[0],10),t[1]=parseInt(t[1],10)||0,t[2]=parseInt(t[2],10)||0,e[0]>t[0]||e[0]==t[0]&&e[1]>t[1]||e[0]==t[0]&&e[1]==t[1]&&e[2]>=t[2]?!0:!1}function m(t,e,i,n){if(!W.ie||!W.mac){var r=w.getElementsByTagName("head")[0];r&&(i=i&&"string"==typeof i?i:"screen",n&&(x=null,E=null),x&&E==i||(n=w.createElement("style"),n.setAttribute("type","text/css"),n.setAttribute("media",i),x=r.appendChild(n),W.ie&&W.win&&typeof w.styleSheets!=b&&0<w.styleSheets.length&&(x=w.styleSheets[w.styleSheets.length-1]),E=i),W.ie&&W.win?x&&typeof x.addRule==A&&x.addRule(t,e):x&&typeof w.createTextNode!=b&&x.appendChild(w.createTextNode(t+" {"+e+"}")))}}function g(t,e){if(k){var i=e?"visible":"hidden";M&&_(t)?_(t).style.visibility=i:m("#"+t,"visibility:"+i)}}function y(t){return null!=/[\\\"<>\.;]/.exec(t)&&typeof encodeURIComponent!=b?encodeURIComponent(t):t}var T,S,C,v,x,E,b="undefined",A="object",R="application/x-shockwave-flash",P="SWFObjectExprInst",I=window,w=document,L=navigator,D=!1,O=[function(){D?n():r()}],N=[],B=[],F=[],M=!1,V=!1,k=!0,W=function(){var t=typeof w.getElementById!=b&&typeof w.getElementsByTagName!=b&&typeof w.createElement!=b,e=L.userAgent.toLowerCase(),i=L.platform.toLowerCase(),n=/win/.test(i?i:e),i=/mac/.test(i?i:e),e=/webkit/.test(e)?parseFloat(e.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,r=!1,o=[0,0,0],s=null;if(typeof L.plugins!=b&&typeof L.plugins["Shockwave Flash"]==A)(s=L.plugins["Shockwave Flash"].description)&&(typeof L.mimeTypes==b||!L.mimeTypes[R]||L.mimeTypes[R].enabledPlugin)&&(D=!0,r=!1,s=s.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),o[0]=parseInt(s.replace(/^(.*)\..*$/,"$1"),10),o[1]=parseInt(s.replace(/^.*\.(.*)\s.*$/,"$1"),10),o[2]=/[a-zA-Z]/.test(s)?parseInt(s.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof I[["Active"].concat("Object").join("X")]!=b)try{var c=new(window[["Active"].concat("Object").join("X")])("ShockwaveFlash.ShockwaveFlash");c&&(s=c.GetVariable("$version"),s&&(r=!0,s=s.split(" ")[1].split(","),o=[parseInt(s[0],10),parseInt(s[1],10),parseInt(s[2],10)]))}catch(a){}return{w3:t,pv:o,wk:e,ie:r,win:n,mac:i}}();return function(){W.w3&&((typeof w.readyState!=b&&"complete"==w.readyState||typeof w.readyState==b&&(w.getElementsByTagName("body")[0]||w.body))&&t(),M||(typeof w.addEventListener!=b&&w.addEventListener("DOMContentLoaded",t,!1),W.ie&&W.win&&(w.attachEvent("onreadystatechange",function(){"complete"==w.readyState&&(w.detachEvent("onreadystatechange",arguments.callee),t())}),I==top&&function(){if(!M){try{w.documentElement.doScroll("left")}catch(e){return void setTimeout(arguments.callee,0)}t()}}()),W.wk&&function(){M||(/loaded|complete/.test(w.readyState)?t():setTimeout(arguments.callee,0))}(),i(t)))}(),function(){W.ie&&W.win&&window.attachEvent("onunload",function(){for(var t=F.length,e=0;t>e;e++)F[e][0].detachEvent(F[e][1],F[e][2]);for(t=B.length,e=0;t>e;e++)d(B[e]);for(var i in W)W[i]=null;W=null;for(var n in a)a[n]=null;a=null})}(),{registerObject:function(t,e,i,n){if(W.w3&&t&&e){var r={};r.id=t,r.swfVersion=e,r.expressInstall=i,r.callbackFn=n,N[N.length]=r,g(t,!1)}else n&&n({success:!1,id:t})},getObjectById:function(t){return W.w3?o(t):void 0},embedSWF:function(t,i,n,r,o,a,l,h,d,_){var p={success:!1,id:i};W.w3&&!(W.wk&&312>W.wk)&&t&&i&&n&&r&&o?(g(i,!1),e(function(){n+="",r+="";var e={};if(d&&typeof d===A)for(var m in d)e[m]=d[m];if(e.data=t,e.width=n,e.height=r,m={},h&&typeof h===A)for(var y in h)m[y]=h[y];if(l&&typeof l===A)for(var T in l)typeof m.flashvars!=b?m.flashvars+="&"+T+"="+l[T]:m.flashvars=T+"="+l[T];if(f(o))y=u(e,m,i),e.id==i&&g(i,!0),p.success=!0,p.ref=y;else{if(a&&s())return e.data=a,void c(e,m,i,_);g(i,!0)}_&&_(p)})):_&&_(p)},switchOffAutoHideShow:function(){k=!1},ua:W,getFlashPlayerVersion:function(){return{major:W.pv[0],minor:W.pv[1],release:W.pv[2]}},hasFlashPlayerVersion:f,createSWF:function(t,e,i){return W.w3?u(t,e,i):void 0},showExpressInstall:function(t,e,i,n){W.w3&&s()&&c(t,e,i,n)},removeSWF:function(t){W.w3&&d(t)},createCSS:function(t,e,i,n){W.w3&&m(t,e,i,n)},addDomLoadEvent:e,addLoadEvent:i,getQueryParamValue:function(t){var e=w.location.search||w.location.hash;if(e){if(/\?/.test(e)&&(e=e.split("?")[1]),null==t)return y(e);for(var e=e.split("&"),i=0;i<e.length;i++)if(e[i].substring(0,e[i].indexOf("="))==t)return y(e[i].substring(e[i].indexOf("=")+1))}return""},expressInstallCallback:function(){if(V){var t=_(P);t&&T&&(t.parentNode.replaceChild(T,t),S&&(g(S,!0),W.ie&&W.win&&(T.style.display="block")),C&&C(v)),V=!1}}}}();!function(){if("undefined"!=typeof window&&!window.WebSocket){var t=window.console;t&&t.log&&t.error||(t={log:function(){},error:function(){}}),a.hasFlashPlayerVersion("10.0.0")?("file:"==location.protocol&&t.error("WARNING: web-socket-js doesn't work in file:///... URL unless you set Flash Security Settings properly. Open the page via Web server i.e. http://..."),WebSocket=function(t,e,i,n,r){var o=this;o.__id=WebSocket.__nextId++,WebSocket.__instances[o.__id]=o,o.readyState=WebSocket.CONNECTING,o.bufferedAmount=0,o.__events={},e?"string"==typeof e&&(e=[e]):e=[],setTimeout(function(){WebSocket.__addTask(function(){WebSocket.__flash.create(o.__id,t,e,i||null,n||0,r||null)})},0)},WebSocket.prototype.send=function(t){if(this.readyState==WebSocket.CONNECTING)throw"INVALID_STATE_ERR: Web Socket connection has not been established";return t=WebSocket.__flash.send(this.__id,encodeURIComponent(t)),0>t?!0:(this.bufferedAmount+=t,!1)},WebSocket.prototype.close=function(){this.readyState!=WebSocket.CLOSED&&this.readyState!=WebSocket.CLOSING&&(this.readyState=WebSocket.CLOSING,WebSocket.__flash.close(this.__id))},WebSocket.prototype.addEventListener=function(t,e){t in this.__events||(this.__events[t]=[]),this.__events[t].push(e)},WebSocket.prototype.removeEventListener=function(t,e,i){if(t in this.__events)for(t=this.__events[t],i=t.length-1;i>=0;--i)if(t[i]===e){t.splice(i,1);break}},WebSocket.prototype.dispatchEvent=function(t){for(var e=this.__events[t.type]||[],i=0;i<e.length;++i)e[i](t);(e=this["on"+t.type])&&e(t)},WebSocket.prototype.__handleEvent=function(t){if("readyState"in t&&(this.readyState=t.readyState),"protocol"in t&&(this.protocol=t.protocol),"open"==t.type||"error"==t.type)t=this.__createSimpleEvent(t.type);else if("close"==t.type)t=this.__createSimpleEvent("close");else{if("message"!=t.type)throw"unknown event type: "+t.type;t=decodeURIComponent(t.message),t=this.__createMessageEvent("message",t)}this.dispatchEvent(t)},WebSocket.prototype.__createSimpleEvent=function(t){if(document.createEvent&&window.Event){var e=document.createEvent("Event");return e.initEvent(t,!1,!1),e}return{type:t,bubbles:!1,cancelable:!1}},WebSocket.prototype.__createMessageEvent=function(t,e){if(document.createEvent&&window.MessageEvent&&!window.opera){var i=document.createEvent("MessageEvent");return i.initMessageEvent("message",!1,!1,e,null,null,window,null),i}return{type:t,data:e,bubbles:!1,cancelable:!1}},WebSocket.CONNECTING=0,WebSocket.OPEN=1,WebSocket.CLOSING=2,WebSocket.CLOSED=3,WebSocket.__flash=null,WebSocket.__instances={},WebSocket.__tasks=[],WebSocket.__nextId=0,WebSocket.loadFlashPolicyFile=function(t){WebSocket.__addTask(function(){WebSocket.__flash.loadManualPolicyFile(t)})},WebSocket.__initialize=function(){if(!WebSocket.__flash)if(WebSocket.__swfLocation&&(window.WEB_SOCKET_SWF_LOCATION=WebSocket.__swfLocation),window.WEB_SOCKET_SWF_LOCATION){var e=document.createElement("div");e.id="webSocketContainer",e.style.position="absolute",WebSocket.__isFlashLite()?(e.style.left="0px",e.style.top="0px"):(e.style.left="-100px",e.style.top="-100px");var i=document.createElement("div");i.id="webSocketFlash",e.appendChild(i),document.body.appendChild(e),a.embedSWF(WEB_SOCKET_SWF_LOCATION,"webSocketFlash","1","1","10.0.0",null,null,{hasPriority:!0,swliveconnect:!0,allowScriptAccess:"always"},null,function(e){e.success||t.error("[WebSocket] swfobject.embedSWF failed")})}else t.error("[WebSocket] set WEB_SOCKET_SWF_LOCATION to location of WebSocketMain.swf")},WebSocket.__onFlashInitialized=function(){setTimeout(function(){WebSocket.__flash=document.getElementById("webSocketFlash"),WebSocket.__flash.setCallerUrl(location.href),WebSocket.__flash.setDebug(!!window.WEB_SOCKET_DEBUG);for(var t=0;t<WebSocket.__tasks.length;++t)WebSocket.__tasks[t]();WebSocket.__tasks=[]},0)},WebSocket.__onFlashEvent=function(){return setTimeout(function(){try{for(var e=WebSocket.__flash.receiveEvents(),i=0;i<e.length;++i)WebSocket.__instances[e[i].webSocketId].__handleEvent(e[i])}catch(n){t.error(n)}},0),!0},WebSocket.__log=function(e){t.log(decodeURIComponent(e))},WebSocket.__error=function(e){t.error(decodeURIComponent(e))},WebSocket.__addTask=function(t){WebSocket.__flash?t():WebSocket.__tasks.push(t)},WebSocket.__isFlashLite=function(){if(!window.navigator||!window.navigator.mimeTypes)return!1;var t=window.navigator.mimeTypes["application/x-shockwave-flash"];return t&&t.enabledPlugin&&t.enabledPlugin.filename&&t.enabledPlugin.filename.match(/flashlite/i)?!0:!1},window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION||(window.addEventListener?window.addEventListener("load",function(){WebSocket.__initialize()},!1):window.attachEvent("onload",function(){WebSocket.__initialize()}))):t.error("Flash Player >= 10.0.0 is required.")}}(),function(t,e,i){function n(t){t&&(e.Transport.apply(this,arguments),this.sendBuffer=[])}function r(){}t.XHR=n,e.util.inherit(n,e.Transport),n.prototype.open=function(){return this.socket.setBuffer(!1),this.onOpen(),this.get(),this.setCloseTimeout(),this},n.prototype.payload=function(t){for(var i=[],n=0,r=t.length;r>n;n++)i.push(e.parser.encodePacket(t[n]));this.send(e.parser.encodePayload(i))},n.prototype.send=function(t){return this.post(t),this},n.prototype.post=function(t){function e(){4==this.readyState&&(this.onreadystatechange=r,o.posting=!1,200==this.status?o.socket.setBuffer(!1):o.onClose())}function n(){this.onload=r,o.socket.setBuffer(!1)}var o=this;this.socket.setBuffer(!0),this.sendXHR=this.request("POST"),i.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=this.sendXHR.onerror=n:this.sendXHR.onreadystatechange=e,this.sendXHR.send(t)},n.prototype.close=function(){return this.onClose(),this},n.prototype.request=function(t){var i=e.util.request(this.socket.isXDomain()),n=e.util.query(this.socket.options.query,"t="+ +new Date);if(i.open(t||"GET",this.prepareUrl()+n,!0),"POST"==t)try{i.setRequestHeader?i.setRequestHeader("Content-type","text/plain;charset=UTF-8"):i.contentType="text/plain"}catch(r){}return i},n.prototype.scheme=function(){return this.socket.options.secure?"https":"http"},n.check=function(t,n){try{var r=e.util.request(n),o=i.XDomainRequest&&r instanceof XDomainRequest,s=t&&t.options&&t.options.secure?"https:":"http:",c=i.location&&s!=i.location.protocol;if(r&&(!o||!c))return!0}catch(a){}return!1},n.xdomainCheck=function(t){return n.check(t,!0)}}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(t,e){function i(){e.Transport.XHR.apply(this,arguments)}t.htmlfile=i,e.util.inherit(i,e.Transport.XHR),i.prototype.name="htmlfile",i.prototype.get=function(){this.doc=new(window[["Active"].concat("Object").join("X")])("htmlfile"),this.doc.open(),this.doc.write("<html></html>"),this.doc.close(),this.doc.parentWindow.s=this;var t=this.doc.createElement("div");t.className="socketio",this.doc.body.appendChild(t),this.iframe=this.doc.createElement("iframe"),t.appendChild(this.iframe);var i=this,t=e.util.query(this.socket.options.query,"t="+ +new Date);this.iframe.src=this.prepareUrl()+t,e.util.on(window,"unload",function(){i.destroy()})},i.prototype._=function(t,e){t=t.replace(/\\\//g,"/"),this.onData(t);try{var i=e.getElementsByTagName("script")[0];i.parentNode.removeChild(i)}catch(n){}},i.prototype.destroy=function(){if(this.iframe){try{this.iframe.src="about:blank"}catch(t){}this.doc=null,this.iframe.parentNode.removeChild(this.iframe),this.iframe=null,CollectGarbage()}},i.prototype.close=function(){return this.destroy(),e.Transport.XHR.prototype.close.call(this)},i.check=function(t){if("undefined"!=typeof window&&["Active"].concat("Object").join("X")in window)try{return new(window[["Active"].concat("Object").join("X")])("htmlfile")&&e.Transport.XHR.check(t)}catch(i){}return!1},i.xdomainCheck=function(){return!1},e.transports.push("htmlfile")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(t,e,i){function n(){e.Transport.XHR.apply(this,arguments)}function r(){}t["xhr-polling"]=n,e.util.inherit(n,e.Transport.XHR),e.util.merge(n,e.Transport.XHR),n.prototype.name="xhr-polling",n.prototype.heartbeats=function(){return!1},n.prototype.open=function(){return e.Transport.XHR.prototype.open.call(this),!1
},n.prototype.get=function(){function t(){4==this.readyState&&(this.onreadystatechange=r,200==this.status?(o.onData(this.responseText),o.get()):o.onClose())}function e(){this.onerror=this.onload=r,o.retryCounter=1,o.onData(this.responseText),o.get()}function n(){o.retryCounter++,!o.retryCounter||3<o.retryCounter?o.onClose():o.get()}if(this.isOpen){var o=this;this.xhr=this.request(),i.XDomainRequest&&this.xhr instanceof XDomainRequest?(this.xhr.onload=e,this.xhr.onerror=n):this.xhr.onreadystatechange=t,this.xhr.send(null)}},n.prototype.onClose=function(){if(e.Transport.XHR.prototype.onClose.call(this),this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=r;try{this.xhr.abort()}catch(t){}this.xhr=null}},n.prototype.ready=function(t,i){var n=this;e.util.defer(function(){i.call(n)})},e.transports.push("xhr-polling")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(t,e,i){function n(){e.Transport["xhr-polling"].apply(this,arguments),this.index=e.j.length;var t=this;e.j.push(function(e){t._(e)})}var r=i.document&&"MozAppearance"in i.document.documentElement.style;t["jsonp-polling"]=n,e.util.inherit(n,e.Transport["xhr-polling"]),n.prototype.name="jsonp-polling",n.prototype.post=function(t){function i(){n(),r.socket.setBuffer(!1)}function n(){r.iframe&&r.form.removeChild(r.iframe);try{s=document.createElement('<iframe name="'+r.iframeId+'">')}catch(t){s=document.createElement("iframe"),s.name=r.iframeId}s.id=r.iframeId,r.form.appendChild(s),r.iframe=s}var r=this,o=e.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);if(!this.form){var s,c=document.createElement("form"),a=document.createElement("textarea"),l=this.iframeId="socketio_iframe_"+this.index;c.className="socketio",c.style.position="absolute",c.style.top="0px",c.style.left="0px",c.style.display="none",c.target=l,c.method="POST",c.setAttribute("accept-charset","utf-8"),a.name="d",c.appendChild(a),document.body.appendChild(c),this.form=c,this.area=a}this.form.action=this.prepareUrl()+o,n(),this.area.value=e.JSON.stringify(t);try{this.form.submit()}catch(h){}this.iframe.attachEvent?s.onreadystatechange=function(){"complete"==r.iframe.readyState&&i()}:this.iframe.onload=i,this.socket.setBuffer(!0)},n.prototype.get=function(){var t=this,i=document.createElement("script"),n=e.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),i.async=!0,i.src=this.prepareUrl()+n,i.onerror=function(){t.onClose()},n=document.getElementsByTagName("script")[0],n.parentNode.insertBefore(i,n),this.script=i,r&&setTimeout(function(){var t=document.createElement("iframe");document.body.appendChild(t),document.body.removeChild(t)},100)},n.prototype._=function(t){return this.onData(t),this.isOpen&&this.get(),this},n.prototype.ready=function(t,i){var n=this;return r?void e.util.load(function(){i.call(n)}):i.call(this)},n.check=function(){return"document"in i},n.xdomainCheck=function(){return!0},e.transports.push("jsonp-polling")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),"function"==typeof define&&define.amd&&define([],function(){return io})}(),function(){if(void 0!==cc){var a=cc.game.config.plugin||{},b=function(){};b.prototype={constructor:b,getInstance:function(){return this},loadPlugin:function(){},unloadPlugin:function(){}};var c=function(){};c.prototype={constructor:c,setDebugMode:function(){},startSession:function(){},setCaptureUncaughtException:function(){},callFuncWithParam:function(t){return"function"==typeof this[t]?this[t].apply(this,Array.prototype.splice.call(arguments,1)):void cc.log("function is not define")},callStringFuncWithParam:function(){this.callFuncWithParam.apply(arguments)},getPluginName:function(){return this._name},getPluginVersion:function(){return this._version}},c.extend=function(a,b){var d,e={};for(d in c.prototype)e[d]=c.prototype[d];for(d in b)e[d]=b[d];return d=eval("(function "+a+"Plugin(){})"),e.constructor=d,d.prototype=e,d};var d=function(t,e){var i=plugin.PluginParam.ParamType;switch(t){case i.TypeInt:i=parseInt(e);break;case i.TypeFloat:i=parseFloat(e);break;case i.TypeBool:i=Boolean(e);break;case i.TypeString:i=String(e);break;case i.TypeStringMap:i=e;break;default:i=e}return i};d.ParamType={TypeInt:1,TypeFloat:2,TypeBool:3,TypeString:4,TypeStringMap:5},d.AdsResultCode={AdsReceived:0,FullScreenViewShown:1,FullScreenViewDismissed:2,PointsSpendSucceed:3,PointsSpendFailed:4,NetworkError:5,UnknownError:6},d.PayResultCode={PaySuccess:0,PayFail:1,PayCancel:2,PayTimeOut:3},d.ShareResultCode={ShareSuccess:0,ShareFail:1,ShareCancel:2,ShareTimeOut:3};var e={},b={extend:function(t,i){e[t]=new(c.extend(t,i)),"function"==typeof e[t].ctor&&e[t].ctor(a[t])},PluginList:e,PluginParam:d,PluginManager:new b};window.plugin=b}}();var gaf=gaf||{};gaf.COMPRESSION_NONE=4669766,gaf.COMPRESSION_ZIP=4669763,gaf.IDNONE=4294967295,gaf.FIRST_FRAME_INDEX=0,gaf.EFFECT_DROP_SHADOW=0,gaf.EFFECT_BLUR=1,gaf.EFFECT_GLOW=2,gaf.EFFECT_COLOR_MATRIX=6,gaf.ACTION_STOP=0,gaf.ACTION_PLAY=1,gaf.ACTION_GO_TO_AND_STOP=2,gaf.ACTION_GO_TO_AND_PLAY=3,gaf.ACTION_DISPATCH_EVENT=4,gaf.PI_FRAME=0,gaf.PI_EVENT_TYPE=0,gaf.TYPE_TEXTURE=0,gaf.TYPE_TEXT_FIELD=1,gaf.TYPE_TIME_LINE=2,gaf.UNIFORM_BLUR_TEXEL_OFFSET="u_step",gaf.UNIFORM_GLOW_TEXEL_OFFSET="u_step",gaf.UNIFORM_GLOW_COLOR="u_glowColor",gaf.UNIFORM_ALPHA_TINT_MULT="colorTransformMult",gaf.UNIFORM_ALPHA_TINT_OFFSET="colorTransformOffsets",gaf.UNIFORM_ALPHA_COLOR_MATRIX_BODY="colorMatrix",gaf.UNIFORM_ALPHA_COLOR_MATRIX_APPENDIX="colorMatrix2",gaf=gaf||{},gaf._tmp=gaf._tmp||{},gaf._initialized=!1,gaf.CCGAFLoader=function(){this.load=function(t,e,i,n){gaf._initialized||gaf._setup(),(new gaf.Loader).LoadFile(t,function(t){n(null,t)})}},gaf._setup=function(){gaf._setupShaders(),gaf._initialized=!0},cc.loader.register(".gaf",new gaf.CCGAFLoader),gaf.CGAffineTransformCocosFormatFromFlashFormat=function(t){var e={};return e.a=t.a,e.b=-t.b,e.c=-t.c,e.d=t.d,e.tx=t.tx,e.ty=-t.ty,e},gaf._AssetPreload=function(){this[0]=this.End,this[1]=this.Atlases,this[2]=this.AnimationMasks,this[3]=this.AnimationObjects,this[4]=this.AnimationFrames,this[5]=this.NamedParts,this[6]=this.Sequences,this[7]=this.TextFields,this[8]=this.Atlases,this[9]=this.Stage,this[10]=this.AnimationObjects,this[11]=this.AnimationMasks,this[12]=this.AnimationFrames,this[13]=this.TimeLine},gaf._AssetPreload.prototype.End=function(t,e,i){i&&(i.getFps=function(){return t.getSceneFps()})},gaf._AssetPreload.prototype.Tag=function(t,e,i){this[e.tagId].call(this,t,e.content,i)},gaf._AssetPreload.prototype.Tags=function(t,e,i){var n=this;e.forEach(function(e){n.Tag(t,e,i)})},gaf._AssetPreload.prototype.AtlasCreateFrames=function(t,e,i){t.forEach(function(t){var n=e._atlases[t.atlasId],r=cc.rect(t.origin.x,t.origin.y,t.size.x,t.size.y),n=new cc.SpriteFrame(n,r);n._gafAnchor={x:0-(0-t.pivot.x/t.size.x),y:0+(1-t.pivot.y/t.size.y)},i[t.elementAtlasId]=n})},gaf._AssetPreload.prototype.Atlases=function(t,e){var i=t._atlasScales[e.scale]=t._atlasScales[e.scale]||[],n=cc.Director._getInstance().getContentScaleFactor();e.atlases.forEach(function(r){var o=r.id,s=function(){gaf._AssetPreload.AtlasCreateFrames(e.elements,t,i)},c="";r.sources.forEach(function(t){t.csf===n&&(c=t.source)}),cc.assert(c,"GAF Error. Texture for current CSF not found. Reconvert animation with correct parameters."),t._textureLoadDelegate&&(c=t._textureLoadDelegate(c));var a=!1;r=t._getSearchPaths(c);for(var l=0,h=r.length;h>l;++l){var u=cc.textureCache.getTextureForKey(r[l]);if(u&&u.isLoaded()){u.handleLoadedTexture(!0),a=!0,t._atlases[o]=u,s();break}}a||(a=function(e){e.handleLoadedTexture(!0),t._onAtlasLoaded(o,e)},l=function(){cc.log("GAF Error. Couldn't find `"+c+"` required by `"+t.getGAFFileName()+"`")},t._atlasesToLoad.hasOwnProperty(o)||(gaf._AtlasLoader.loadArray(r,a,l),t._atlasesToLoad[o]={}),t._onLoadTasks.push(s))})},gaf._AssetPreload.prototype.AnimationObjects=function(t,e,i){e.forEach(function(e){e.type=void 0===e.type?gaf.TYPE_TEXTURE:e.type,i._objects.push(e.objectId),t._objects[e.objectId]=e})},gaf._AssetPreload.prototype.convertTint=function(t,e){return t?{mult:{r:255*t.redMultiplier,g:255*t.greenMultiplier,b:255*t.blueMultiplier,a:255*e},offset:{r:255*t.redOffset,g:255*t.greenOffset,b:255*t.blueOffset,a:255*t.alphaOffset}}:null},gaf._AssetPreload.prototype.convertState=function(t){return{hasColorTransform:t.hasColorTransform,hasMask:t.hasMask,hasEffect:t.hasEffect,objectIdRef:t.objectIdRef,depth:t.depth,alpha:255*t.alpha,matrix:gaf.CGAffineTransformCocosFormatFromFlashFormat(t.matrix),colorTransform:this.convertTint(t.colorTransform,t.alpha),effect:t.effect,maskObjectIdRef:t.maskObjectIdRef}},gaf._AssetPreload.prototype.AnimationFrames=function(t,e,i){var n=this;cc.assert(i,"Error. Time Line should not be null.");var r={},o=[];t=0;for(var s=e.length;s>t;++t){var c=e[t];c.state&&c.state.forEach(function(t){r[t.objectIdRef]=0!==t.alpha?n.convertState(t):null});var a,l=[];for(a in r)r.hasOwnProperty(a)&&r[a]&&l.push(r[a]);o[c.frame-1]={states:l,actions:c.actions||null}}i.getFrames=function(){return o}},gaf._AssetPreload.prototype.NamedParts=function(t,e,i){var n={};e.forEach(function(t){n[t.name]=t.objectId}),i.getNamedParts=function(){return n}},gaf._AssetPreload.prototype.Sequences=function(t,e,i){var n={};e.forEach(function(t){n[t.id]={start:t.start-1,end:t.end}}),i.getSequences=function(){return n}},gaf._AssetPreload.prototype.TextFields=function(){},gaf._AssetPreload.prototype.Stage=function(t,e){t._sceneFps=e.fps,t._sceneColor=e.color,t._sceneWidth=e.width,t._sceneHeight=e.height},gaf._AssetPreload.prototype.AnimationMasks=function(t,e,i){e.forEach(function(e){e.type=void 0===e.type?gaf.TYPE_TEXTURE:e.type,i._objects.push(e.objectId),t._masks[e.objectId]=e})},gaf._AssetPreload.prototype.TimeLine=function(t,e,i){i=new gaf._TimeLineProto(t,e.animationFrameCount,e.boundingBox,e.pivotPoint,e.id,e.linkageName),t._pushTimeLine(i),this.Tags(t,e.tags,i)},gaf._AssetPreload=new gaf._AssetPreload,gaf=gaf||{},gaf.Asset=cc.Class.extend({_className:"GAFAsset",_header:null,_timeLines:null,_textFields:null,_protos:null,_objects:null,_masks:null,_rootTimeLine:null,_textureLoadDelegate:null,_sceneFps:60,_sceneWidth:0,_sceneHeight:0,_sceneColor:0,_gafData:null,_desiredAtlasScale:1,_usedAtlasScale:0,_atlases:null,_onLoadTasks:null,_atlasScales:null,_textureLoaded:!1,_atlasesToLoad:null,_gafName:null,initWithGAFFile:function(t,e){var i=this;this._textureLoadDelegate=e,this._gafName=t;var n=cc.loader.getRes(t);return n?this._init(n):(cc.loader.load(t,function(t,e){t||i._init(e[0])}),!1)},initWithGAFBundle:function(){return cc.assert(!1,"initWithGAFBundle is not yet implemented"),!1},setRootTimelineWithName:function(t){for(var e=0,i=this._timeLines.length;i>e;++e){var n=this._timeLines[e];if(n&&n.getLinkageName()===t){this._setRootTimeline(n);break}}},isAssetVersionPlayable:function(){return!0},desiredAtlasScale:function(){return this._desiredAtlasScale},setDesiredAtlasScale:function(t){this._desiredAtlasScale=t;for(var e in this._atlasScales)this._atlasScales.hasOwnProperty(e)&&(0===this._usedAtlasScale||Math.abs(this._usedAtlasScale-t)>Math.abs(e-t))&&(this._usedAtlasScale=e)},createObject:function(){return this._instantiateGaf(this._gafData)},createObjectAndRun:function(t){cc.assert(1===arguments.length,"GAFAsset::createObjectAndRun should have one param");var e=this._instantiateGaf(this._gafData);return e.setLooped(t,!0),e.start(),e},setTextureLoadDelegate:function(){},getSceneFps:function(){return this._sceneFps},getSceneWidth:function(){},getSceneHeight:function(){},getSceneColor:function(){},setSceneFps:function(t){this._sceneFps=t},setSceneWidth:function(){},setSceneHeight:function(){},setSceneColor:function(){},getHeader:function(){return this._header},getGAFFileName:function(){return this._gafName},ctor:function(){this._header={},this._timeLines=[],this._textFields=[],this._objects=[],this._masks=[],this._protos=[],this._atlases={},this._onLoadTasks=[],this._atlasScales={},this._atlasesToLoad={},0<arguments.length&&this.initWithGAFFile.apply(this,arguments)},_getProtos:function(){return this._protos},_setRootTimeline:function(t){this._rootTimeLine=t,this._header.pivot=t.getPivot(),this._header.frameSize=t.getRect()},_setHeader:function(t){for(var e in t)t.hasOwnProperty(e)&&(this._header[e]=t[e])},_getMajorVerison:function(){return this._header.versionMajor},_init:function(t){var e=this;this._gafData=t,this._setHeader(t.header),this._timeLinesToLink=[],4>this._getMajorVerison()&&this._pushTimeLine(new gaf._TimeLineProto(this,this._header.framesCount,this._header.frameSize,this._header.pivot)),gaf._AssetPreload.Tags(this,t.tags,this._rootTimeLine),this._objects.forEach(function(t){switch(t.type){case gaf.TYPE_TEXTURE:e._protos[t.objectId]||(e._protos[t.objectId]=new gaf._SpriteProto(e,e._atlasScales,t.elementAtlasIdRef));break;case gaf.TYPE_TIME_LINE:e._protos[t.objectId]=e._timeLines[t.elementAtlasIdRef];break;case gaf.TYPE_TEXT_FIELD:e._protos[t.objectId]=e._textFields[t.elementAtlasIdRef];break;default:cc.log("Unknown object type: "+t.type)}}),this._masks.forEach(function(t){if(!e._protos[t.objectId]){var i=null;switch(t.type){case gaf.TYPE_TEXTURE:i=new gaf._SpriteProto(e,e._atlasScales,t.elementAtlasIdRef);break;case gaf.TYPE_TIME_LINE:i=e._timeLines[t.elementAtlasIdRef];break;case gaf.TYPE_TEXT_FIELD:i=e._textFields[t.elementAtlasIdRef]}e._protos[t.objectId]=new gaf._MaskProto(e,i,t.elementAtlasIdRef)}}),this.setDesiredAtlasScale(this._desiredAtlasScale),0===Object.keys(this._atlasesToLoad).length&&(this._textureLoaded=!0,this.dispatchEvent("load"))},_pushTimeLine:function(t){this._timeLines[t.getId()]=t,0===t.getId()&&this._setRootTimeline(t)},_instantiateGaf:function(){var t=null;return t=this._rootTimeLine._gafConstruct()},_onAtlasLoaded:function(t,e){this._atlases[t]=e,delete this._atlasesToLoad[t],0===Object.keys(this._atlasesToLoad).length&&(this._onLoadTasks.forEach(function(t){t()}),this._onLoadTasks.length=0,this._textureLoaded=!0,this.dispatchEvent("load"))},isLoaded:function(){return this._textureLoaded},_getSearchPaths:function(t){var e=this.getGAFFileName().split("/");return e[e.length-1]=t,e=e.join("/"),[t,e]}}),gaf.Asset.create=function(t,e){return new gaf.Asset(t,e)},gaf.Asset.createWithBundle=function(t,e,i){var n=new gaf.Asset;return n.initWithGAFBundle(t,e,i),n},cc.EventHelper.prototype.apply(gaf.Asset.prototype),gaf=gaf||{},gaf._stateHasCtx=function(t){if(t.hasColorTransform&&(0<t.colorTransform.offset.r||0<t.colorTransform.offset.g||0<t.colorTransform.offset.b||0<t.colorTransform.offset.a))return!0;if(t.hasEffect)for(var e=0,i=t.effect.length;i>e;++e)if(t.effect[e].type===gaf.EFFECT_COLOR_MATRIX)return!0;return!1},gaf.Object=cc.Node.extend({_asset:null,_className:"GAFObject",_id:gaf.IDNONE,_gafproto:null,_parentTimeLine:null,_lastVisibleInFrame:0,_filterStack:null,_cascadeColorMult:null,_cascadeColorOffset:null,_needsCtx:!1,_usedAtlasScale:1,ctor:function(t){1==arguments.length&&(this._usedAtlasScale=t),this._super(),this._cascadeColorMult=cc.color(255,255,255,255),this._cascadeColorOffset=cc.color(0,0,0,0),this._filterStack=[]},setAnimationStartedNextLoopDelegate:function(){},setAnimationFinishedPlayDelegate:function(){},setLooped:function(){},getBoundingBoxForCurrentFrame:function(){return null},setFps:function(){},getObjectByName:function(){return null},clearSequence:function(){},getIsAnimationRunning:function(){return!1},getSequences:function(){return[]},gotoAndStop:function(){},getStartFrame:function(){return gaf.IDNONE},setFramePlayedDelegate:function(){},getCurrentFrameIndex:function(){return gaf.IDNONE},getTotalFrameCount:function(){return 0},start:function(){},stop:function(){},isVisibleInCurrentFrame:function(){return!(this._parentTimeLine&&this._parentTimeLine.getCurrentFrameIndex()+1!=this._lastVisibleInFrame)},isDone:function(){return!0},playSequence:function(){return!1},isReversed:function(){return!1},setSequenceDelegate:function(){},setFrame:function(){return!1},setControlDelegate:function(){},getEndFrame:function(){return gaf.IDNONE},pauseAnimation:function(){},gotoAndPlay:function(){},isLooped:function(){return!1},resumeAnimation:function(){},setReversed:function(){},hasSequences:function(){return!1},getFps:function(){return 60},setLocator:function(){},setExternalTransform:function(t){cc.affineTransformEqualToTransform(this._additionalTransform,t)||this.setAdditionalTransform(t)},getExternalTransform:function(){return this._additionalTransform},setAnimationRunning:function(){},_enableTick:function(){},_resetState:function(){},_updateVisibility:function(t){this.setOpacity(t.alpha+(t.hasColorTransform?t.colorTransform.offset.a:0))},isVisible:function(){return 0<this.getOpacity()},visit:function(t){this.isVisibleInCurrentFrame()&&this._super(t)},_getFilters:function(){return null},_processAnimation:function(){},_applyState:function(t,e){this._applyStateSuper(t,e)},_applyStateSuper:function(t,e){if(this._needsCtx=e._needsCtx,this._filterStack.length=0,this._parentTimeLine=e,1!=this._usedAtlasScale){var i=cc.clone(t.matrix);i.tx*=this._usedAtlasScale,i.ty*=this._usedAtlasScale,this.setExternalTransform(i)}else this.setExternalTransform(t.matrix);t.hasEffect&&(this._filterStack=this._filterStack.concat(t.effect),this._needsCtx=!0),e._filterStack&&0<e._filterStack.length&&(this._filterStack=this._filterStack.concat(e._filterStack)),0<this._filterStack.length&&this._filterStack[0].type===gaf.EFFECT_COLOR_MATRIX&&(this._needsCtx=!0),t.hasColorTransform?(this._cascadeColorMult.r=t.colorTransform.mult.r*e._cascadeColorMult.r/255,this._cascadeColorMult.g=t.colorTransform.mult.g*e._cascadeColorMult.g/255,this._cascadeColorMult.b=t.colorTransform.mult.b*e._cascadeColorMult.b/255,this._cascadeColorMult.a=t.colorTransform.mult.a*e._cascadeColorMult.a/255,this._cascadeColorOffset.r=t.colorTransform.offset.r+e._cascadeColorOffset.r,this._cascadeColorOffset.g=t.colorTransform.offset.g+e._cascadeColorOffset.g,this._cascadeColorOffset.b=t.colorTransform.offset.b+e._cascadeColorOffset.b,this._cascadeColorOffset.a=t.colorTransform.offset.a+e._cascadeColorOffset.a):(this._cascadeColorMult.r=e._cascadeColorMult.r,this._cascadeColorMult.g=e._cascadeColorMult.g,this._cascadeColorMult.b=e._cascadeColorMult.b,this._cascadeColorMult.a=e._cascadeColorMult.a/255*t.alpha,this._cascadeColorOffset.r=e._cascadeColorOffset.r,this._cascadeColorOffset.g=e._cascadeColorOffset.g,this._cascadeColorOffset.b=e._cascadeColorOffset.b,this._cascadeColorOffset.a=e._cascadeColorOffset.a),(0<this._cascadeColorOffset.r||0<this._cascadeColorOffset.g||0<this._cascadeColorOffset.b||0<this._cascadeColorOffset.a)&&(this._needsCtx=!0)},_initRendererCmd:function(){this._renderCmd=cc.renderer.getRenderCmd(this),this._renderCmd._visit=this._renderCmd.visit;var t=this;this._renderCmd.visit=function(e){t.isVisibleInCurrentFrame()&&this._visit(e)}},_getNode:function(){return this},setAnchorPoint:function(t,e){void 0===e?this._super(t.x,t.y-1):this._super(t,e-1)}}),gaf.Object._createNullObject=function(){var t=new gaf.Object;return t.isVisible=function(){return!0},t},gaf.TimeLine=gaf.Object.extend({_className:"GAFTimeLine",_objects:null,_container:null,_animationStartedNextLoopDelegate:null,_animationFinishedPlayDelegate:null,_framePlayedDelegate:null,_sequenceDelegate:null,_fps:60,_frameTime:1/60,_currentSequenceStart:gaf.FIRST_FRAME_INDEX,_currentSequenceEnd:gaf.FIRST_FRAME_INDEX,_totalFrameCount:0,_isRunning:!1,_isLooped:!1,_isReversed:!1,_timeDelta:0,_animationsSelectorScheduled:!1,_currentFrame:gaf.FIRST_FRAME_INDEX,setAnimationStartedNextLoopDelegate:function(t){this._animationStartedNextLoopDelegate=t},setAnimationFinishedPlayDelegate:function(t){this._animationFinishedPlayDelegate=t},setLooped:function(t,e){this._isLooped=t,e&&this._objects.forEach(function(i){i.setLooped(t,e)})},getBoundingBoxForCurrentFrame:function(){var t=null,e=!0;return this._objects.forEach(function(i){if(i.isVisibleInCurrentFrame()&&i.isVisible()){var n=i.getBoundingBoxForCurrentFrame();n||(n=i.getBoundingBox()),e?(e=!1,t=n):t=cc.rectUnion(t,n)}}),cc._rectApplyAffineTransformIn(t,this._container.getNodeToParentTransform())},setFps:function(t){cc.assert(0!==t,"Error! Fps is set to zero."),this._fps=t,this._frameTime=1/t},getObjectByName:function(t){var e=t.split("."),i=null,n=-1,r=this,o={};try{e.forEach(function(t){var e=r._gafproto.getNamedParts();if(!e.hasOwnProperty(t))throw o.lastElement=t,o;n=e[t],r=i=r._objects[n]})}catch(s){if(s!==o)throw s;return cc.log("Sequence incorrect: `"+t+"` At: `"+o.lastElement+"`"),null}return i},clearSequence:function(){this._currentSequenceStart=gaf.FIRST_FRAME_INDEX,this._currentSequenceEnd=this._gafproto.getTotalFrames()},getIsAnimationRunning:function(){return this._isRunning},gotoAndStop:function(t){var e=0,e="string"==typeof t?this.getStartFrame(t):t;return this.setFrame(e)?(this.setAnimationRunning(!1,!1),!0):!1},gotoAndPlay:function(t){var e=0,e="string"==typeof t?this.getStartFrame(t):t;return this.setFrame(e)?(this.setAnimationRunning(!0,!1),!0):!1},getStartFrame:function(t){return(t=this._gafproto.getSequences()[t])?t.start:gaf.IDNONE},getEndFrame:function(t){return(t=this._gafproto.getSequences()[t])?t.end:gaf.IDNONE},setFramePlayedDelegate:function(t){this._framePlayedDelegate=t},getCurrentFrameIndex:function(){return this._showingFrame},getTotalFrameCount:function(){return this._gafproto.getTotalFrames()},start:function(){this._enableTick(!0),this._isRunning||(this._currentFrame=gaf.FIRST_FRAME_INDEX,this.setAnimationRunning(!0,!0))},stop:function(){this._enableTick(!1),this._isRunning&&(this._currentFrame=gaf.FIRST_FRAME_INDEX,this.setAnimationRunning(!1,!0))},isDone:function(){return this._isLooped?!1:this._isReversed?this._currentFrame<gaf.FIRST_FRAME_INDEX-1:this._currentFrame>this._totalFrameCount},getSequences:function(){return this._gafproto.getSequences()},playSequence:function(t,e){var i=this.getStartFrame(t),n=this.getEndFrame(t);return gaf.IDNONE===i||gaf.IDNONE===n?!1:(this._currentSequenceStart=i,this._currentSequenceEnd=n,this._currentFrame=this._currentSequenceStart,this.setLooped(e,!1),this.resumeAnimation(),!0)},isReversed:function(){return this._isReversed},setSequenceDelegate:function(t){this._sequenceDelegate=t},setFrame:function(t){return t>=gaf.FIRST_FRAME_INDEX&&t<this._totalFrameCount?(this._currentFrame=this._showingFrame=t,this._processAnimation(),!0):!1},pauseAnimation:function(){this._isRunning&&this.setAnimationRunning(!1,!1)},isLooped:function(){return this._isLooped},resumeAnimation:function(){this._isRunning||this.setAnimationRunning(!0,!1)},setReversed:function(t){this._isReversed=t},hasSequences:function(){return 0<this._gafproto.getSequences().length},getFps:function(){return this._fps},ctor:function(t,e){this._super(e),this._objects=[],cc.assert(t,"Error! Missing mandatory parameter."),this._gafproto=t},setExternalTransform:function(t){cc.affineTransformEqualToTransform(this._container._additionalTransform,t)||this._container.setAdditionalTransform(t)},_init:function(){this.setContentSize(this._gafproto.getBoundingBox()),this._totalFrameCount=this._currentSequenceEnd=this._gafproto.getTotalFrames(),this.setFps(this._gafproto.getFps()),this._container=new cc.Node,this.addChild(this._container);var t=this,e=this._gafproto.getAsset();this._gafproto.getObjects().forEach(function(i){var n=e._getProtos()[i];cc.assert(n,"Error. GAF proto for type: "+i.type+" and reference id: "+i+" not found."),t._objects[i]=n._gafConstruct()})},_enableTick:function(t){!this._animationsSelectorScheduled&&t?(this.schedule(this._processAnimations),this._animationsSelectorScheduled=!0):this._animationsSelectorScheduled&&!t&&(this.unschedule(this._processAnimations),this._animationsSelectorScheduled=!1)},_processAnimations:function(t){for(this._timeDelta+=t;this._timeDelta>=this._frameTime;)this._timeDelta-=this._frameTime,this._step()},_step:function(){if(this._showingFrame=this._currentFrame,this.getIsAnimationRunning()){if(this._sequenceDelegate){var t;(t=this._isReversed?this._getSequenceByFirstFrame(this._currentFrame+1):this._getSequenceByLastFrame(this._currentFrame))&&this._sequenceDelegate(this,t)}this._isCurrentFrameLastInSequence()&&(this._isLooped?this._animationStartedNextLoopDelegate&&this._animationStartedNextLoopDelegate(this):(this.setAnimationRunning(!1,!1),this._animationFinishedPlayDelegate&&this._animationFinishedPlayDelegate(this))),this._processAnimation(),this._currentFrame=this._nextFrame()}else this._processAnimation()},_isCurrentFrameLastInSequence:function(){return this._isReversed?this._currentFrame==this._currentSequenceStart:this._currentFrame==this._currentSequenceEnd-1},_nextFrame:function(){return this._isCurrentFrameLastInSequence()?this._isLooped?this._isReversed?this._currentSequenceEnd-1:this._currentSequenceStart:this._currentFrame:this._currentFrame+(this._isReversed?-1:1)},_processAnimation:function(){this._realizeFrame(this._container,this._currentFrame),this._framePlayedDelegate&&this._framePlayedDelegate(this,this._currentFrame)},_realizeFrame:function(t,e){var i=this._objects,n=this._gafproto.getFrames();if(!(e>n.length)&&(n=n[e]))for(var n=n.states,r=0,o=n.length;o>r;++r){var s=n[r],c=i[s.objectIdRef];if(!c)break;if(0>s.alpha&&c._resetState(),c._updateVisibility(s,this),c.isVisible()){c._applyState(s,this);var a=t;s.hasMask&&(a=i[s.maskObjectIdRef]._getNode(),cc.assert(a,"Error! Mask not found.")),c._lastVisibleInFrame=1+e,gaf.TimeLine.rearrangeSubobject(a,c,s.depth),c._step&&c._step()}}},setAnimationRunning:function(t,e){this._isRunning=t,e&&this._objects.forEach(function(i){i&&i.setAnimationRunning&&i.setAnimationRunning(t,e)})},_getSequenceByLastFrame:function(){var t,e=this._gafproto.getSequences();for(t in e)if(e.hasOwnProperty(t)&&e[t].end===frame+1)return t;return""},_resetState:function(){this._super(),this._currentFrame=this._currentSequenceStart},_getSequenceByFirstFrame:function(){var t,e=this._gafproto.getSequences();for(t in e)if(e.hasOwnProperty(t)&&e[t].start===frame)return t;return""}}),gaf.TimeLine.rearrangeSubobject=function(t,e,i){e.getParent()!==t?(e.removeFromParent(!1),t.addChild(e,i)):e.setLocalZOrder(i)},gaf.TextField=gaf.Object.extend({_className:"GAFTextField"}),gaf.Sprite=gaf.Object.extend({_className:"GAFSprite",_hasCtx:!1,_hasFilter:!1,ctor:function(t,e){this._super(e),cc.assert(t,"Error! Missing mandatory parameter."),this._gafproto=t},_init:function(){var t=this._gafproto.getFrame();cc.assert(t instanceof cc.SpriteFrame,"Error. Wrong object type."),this._sprite=new cc.Sprite,this._sprite._renderCmd=this._gafCreateRenderCmd(this._sprite),this._sprite.initWithSpriteFrame(t),this._sprite.setAnchorPoint(this._gafproto.getAnchor()),this.addChild(this._sprite),this._sprite.setOpacityModifyRGB(!0),cc._renderType===cc._RENDER_TYPE_WEBGL&&this._sprite.setBlendFunc(gl.ONE,gl.ONE_MINUS_SRC_ALPHA)},_applyState:function(t,e){this._applyStateSuper(t,e),this._needsCtx?(this._hasCtx||(this._enableCtx(),this._hasCtx=!0),this._applyCtxState(t)):(this._hasCtx&&(this._disableCtx(),this._hasCtx=!1),cc.colorEqual(this._sprite._realColor,this._cascadeColorMult)||this._sprite.setColor(this._cascadeColorMult),this._sprite.getOpacity()!=this._cascadeColorMult.a&&this._sprite.setOpacity(this._cascadeColorMult.a))},_enableCtx:function(){this._sprite._renderCmd._enableCtx()},_disableCtx:function(){this._sprite._renderCmd._disableCtx()},_applyCtxState:function(){this._sprite._renderCmd._applyCtxState(this)},getBoundingBoxForCurrentFrame:function(){var t=this._sprite.getBoundingBox();return cc._rectApplyAffineTransformIn(t,this.getNodeToParentTransform())},_gafCreateRenderCmd:function(t){return cc._renderType===cc._RENDER_TYPE_CANVAS?new gaf.Sprite.CanvasRenderCmd(t):new gaf.Sprite.WebGLRenderCmd(t)}}),gaf.Mask=gaf.Object.extend({_className:"GAFMask",_clippingNode:null,ctor:function(t){this._super(),cc.assert(t,"Error! Missing mandatory parameter."),this._gafproto=t},_init:function(){var t=this._gafproto.getMaskNodeProto();cc.assert(t,"Error. Mask node for id ref "+this._gafproto.getIdRef()+" not found."),this._maskNode=t._gafConstruct(),this._clippingNode=cc.ClippingNode.create(this._maskNode),this._clippingNode.setAlphaThreshold(.5),this.addChild(this._clippingNode)},setExternalTransform:function(t){cc.affineTransformEqualToTransform(this._maskNode._additionalTransform,t)||this._maskNode.setAdditionalTransform(t)},_getNode:function(){return this._clippingNode}}),function(){gaf.Sprite.CanvasRenderCmd=function(t){cc.Sprite.CanvasRenderCmd.call(this,t),this._hasCtx=this._hasTintOffset=this._hasTintMult=!1,this._tintMult=cc.color(255,255,255,255),this._tintOffset=cc.color(0,0,0,0),this._textureDirty=!1};var t=gaf.Sprite.CanvasRenderCmd.prototype=Object.create(cc.Sprite.CanvasRenderCmd.prototype);t.constructor=gaf.Sprite.CanvasRenderCmd,t._disableCtx=function(){this._hasCtx=this._hasTintOffset=!1,this._textureDirty=!0,this.setDirtyFlag(cc.Node._dirtyFlags.colorDirty),this._tintMult=cc.color(255,255,255,255),this._tintOffset=cc.color(0,0,0,0)},t._enableCtx=function(){},t._applyCtxState=function(t){var e=t._cascadeColorMult,i=t._cascadeColorOffset,n=e.a;this._node.getOpacity()!=n&&this._node.setOpacity(n),(n=!cc.colorEqual(this._tintMult,e))&&(this._node.setColor(e),this._tintMult=e,this._hasTintMult=255!==e.r||255!==e.g||255!==e.b),(e=this._tintOffset.r!=i.r||this._tintOffset.g!=i.g||this._tintOffset.b!=i.b||this._tintOffset.a!=i.a)&&(this._tintOffset=i,this._hasTintOffset=0!==i.r||0!==i.g||0!==i.b||0!==i.a),(this._textureDirty=n||e)&&this.setDirtyFlag(cc.Node._dirtyFlags.colorDirty),this._hasCtx=0<t._filterStack.length&&t._filterStack[0].type===gaf.EFFECT_COLOR_MATRIX},t.rendering=function(t,e,i){var n=this._node,r=this._textureCoord,o=this._displayedOpacity/255;if((!n._texture||0!==r.width&&0!==r.height&&n._texture._textureLoaded)&&0!==o){t=t||cc._renderContext;var s=t.getContext(),c=n._offsetPosition.x,a=n._rect.height,l=n._rect.width,h=-n._offsetPosition.y-a;t.setTransform(this._worldTransform,e,i),t.setCompositeOperation(this._blendFuncStr),t.setGlobalAlpha(o),(n._flippedX||n._flippedY)&&t.save(),n._flippedX&&(c=-c-l,s.scale(-1,1)),n._flippedY&&(h=n._offsetPosition.y,s.scale(1,-1)),o=n._texture._htmlElementObj,this._colorized?s.drawImage(o,0,0,r.width,r.height,c*e,h*i,l*e,a*i):s.drawImage(o,r.renderX,r.renderY,r.width,r.height,c*e,h*i,l*e,a*i),(n._flippedX||n._flippedY)&&t.restore(),cc.g_NumberOfDraws++}},cc.sys._supportCanvasNewBlendModes&&(t._updateColor=function(){var t=this._displayedColor,e=this._node;if(this._hasTintMult|=255!==t.r||255!==t.g||255!==t.b,this._textureDirty){this._textureDirty=!1,this._colorized&&(this._colorized=!1,e.texture=this._originalTexture);var i,n=e._texture,r=this._textureCoord;if(this._hasTintMult&&n&&r.validRect&&this._originalTexture){if(i=n.getHtmlElementObj(),!i)return;this._colorized=!0,(this._hasTintOffset||this._hasCtx)&&(t=this._tintMult),i=cc.Sprite.CanvasRenderCmd._generateTintImageWithMultiply(this._originalTexture._htmlElementObj,t,r),n=new cc.Texture2D,n.initWithElement(i),n.handleLoadedTexture(),e.texture=n}n=e._texture,this._hasTintOffset&&(t=cc.textureCache.getTextureColors(this._originalTexture.getHtmlElementObj()),n&&r.validRect&&this._originalTexture&&(i=n.getHtmlElementObj()))&&(i=this._colorized?cc.rect(0,0,r.width,r.height):r,i=this._gafGenerateTintImage(e.texture._htmlElementObj,i,t,this._tintOffset,r),n=new cc.Texture2D,n.initWithElement(i),n.handleLoadedTexture(),e.texture=n,this._colorized=!0)}},t._gafGenerateTintImage=function(t,e,i,n,r,o){r||(r=cc.rect(0,0,t.width,t.height));var s,c=Math.min(r.width,i[0].width),a=Math.min(r.height,i[0].height);return o?(s=o.getContext("2d"),s.clearRect(0,0,c,a)):(o=cc.newElement("canvas"),o.width=c,o.height=a,s=o.getContext("2d")),s.save(),s.globalCompositeOperation="source-over",s.drawImage(i[2],r.x,r.y,c,a,0,0,c,a),s.globalCompositeOperation="source-in",s.fillStyle="rgba("+Math.round(n.r)+","+Math.round(n.g)+","+Math.round(n.b)+",1)",s.fillRect(0,0,c,a),s.globalCompositeOperation="lighter",s.drawImage(t,e.x,e.y,c,a,0,0,c,a),s.restore(),o
})}(),function(){gaf.Sprite.WebGLRenderCmd=function(t){cc.Sprite.WebGLRenderCmd.call(this,t),this._defualtShader=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURECOLOR),this._customShader=gaf._Shaders.Alpha,this._ctxMatrixAppendix=this._ctxMatrixBody=this._tintOffset=this._tintMult=null};var t=gaf.Sprite.WebGLRenderCmd.prototype=Object.create(cc.Sprite.WebGLRenderCmd.prototype);t.constructor=gaf.Sprite.WebGLRenderCmd,t._identityVec=[1,1,1,1],t._zeroVec=[0,0,0,0],t._identityMat=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t._disableCtx=function(){this.setShaderProgram(this._defualtShader)},t._enableCtx=function(){this.setShaderProgram(this._customShader)},t._applyCtxState=function(t){var e=t._cascadeColorMult;this._tintMult=[e.r/255,e.g/255,e.b/255,e.a/255],e=t._cascadeColorOffset,this._tintOffset=[e.r/255,e.g/255,e.b/255,e.a/255],(t=t._filterStack)&&0<t.length&&t[0].type===gaf.EFFECT_COLOR_MATRIX?(t=t[0].colorMatrix,this._ctxMatrixBody=[t.rr,t.rg,t.rb,t.ra,t.gr,t.gg,t.gb,t.ga,t.br,t.bg,t.bb,t.ba,t.ar,t.ag,t.ab,t.aa],this._ctxMatrixAppendix=[t.r/255,t.g/255,t.b/255,t.a/255]):this._ctxMatrixAppendix=this._ctxMatrixBody=null},t._setUniforms=function(){this._shaderProgram===this._customShader&&(this._shaderProgram.use(),this._shaderProgram.setUniformLocationWith4fv(gaf._Uniforms.ColorTransformMult,this._tintMult,1),this._shaderProgram.setUniformLocationWith4fv(gaf._Uniforms.ColorTransformOffset,this._tintOffset,1),this._ctxMatrixBody&&this._ctxMatrixAppendix?(this._shaderProgram.setUniformLocationWithMatrix4fv(gaf._Uniforms.ColorMatrixBody,this._ctxMatrixBody,1),this._shaderProgram.setUniformLocationWith4fv(gaf._Uniforms.ColorMatrixAppendix,this._ctxMatrixAppendix,1)):(this._shaderProgram.setUniformLocationWithMatrix4fv(gaf._Uniforms.ColorMatrixBody,this._identityMat,1),this._shaderProgram.setUniformLocationWith4fv(gaf._Uniforms.ColorMatrixAppendix,this._zeroVec,1)))},t.rendering=function(t){this._setUniforms(),cc.Sprite.WebGLRenderCmd.prototype.rendering.call(this,t)}}(),gaf._TimeLineProto=function(t,e,i,n,r,o){r="undefined"!=typeof r?r:0,o=o||"",this._objects=[],this.getTotalFrames=function(){return e},this.getBoundingBox=function(){return i},this.getId=function(){return r},this.getLinkageName=function(){return o},this.getPivot=function(){return n},this.getRect=function(){return i},this.getNamedParts=function(){return{}},this.getSequences=function(){return{}},this.getFrames=function(){return[]},this.getFps=function(){return 60},this.getObjects=function(){return this._objects},this.getAsset=function(){return t},this._gafConstruct=function(){var t=this.getAsset()._usedAtlasScale,t=new gaf.TimeLine(this,t);return t._init(),t}},gaf._SpriteProto=function(t,e,i){this.getFrames=function(){return e},this.getIdRef=function(){return i},this.getAsset=function(){return t},this._gafConstruct=function(){var t=this.getAsset()._usedAtlasScale,t=new gaf.Sprite(this,t);return t._init(),t}},gaf._SpriteProto.prototype.getFrame=function(){var t=this.getAsset()._usedAtlasScale;cc.assert(t,"Error. Atlas scale zero.");var e=this.getFrames()[t];return cc.assert(e,"Error. No frames found for used scale `"+t+"`"),e[this.getIdRef()]},gaf._SpriteProto.prototype.getAnchor=function(){return this.getFrame()._gafAnchor},gaf._MaskProto=function(t,e,i){this.getIdRef=function(){return i},this.getMaskNodeProto=function(){return e},this._gafConstruct=function(){var t=new gaf.Mask(this);return t._init(),t}},gaf.ReadSingleTag=function(t){var e=t.Ushort(),i=gaf.Tags[e],n={};return"undefined"==typeof i?(console.log("GAF. Non implemented tag detected."),gaf.Tags.Default.parse(t,e)):n=i.parse(t,e),n},gaf.ReadTags=function(t){var e=[];try{do{var i=gaf.ReadSingleTag(t);e.push(i)}while(0!=i.tagId)}catch(n){if(!(n instanceof Error&&"GAF format error"==n.message))throw console.log(n.stack),n;console.log("GAF format error:\n"+n.stack)}return e},gaf.Tag=function(){this.Default=Object.create(gaf.Tag.base),this[0]=Object.create(gaf.Tag.End),this[1]=Object.create(gaf.Tag.DefineAtlas),this[2]=Object.create(gaf.Tag.DefineAnimationMasks),this[3]=Object.create(gaf.Tag.DefineAnimationObjects),this[4]=Object.create(gaf.Tag.DefineAnimationFrames),this[5]=Object.create(gaf.Tag.DefineNamedParts),this[6]=Object.create(gaf.Tag.DefineSequences),this[7]=Object.create(gaf.Tag.DefineTextFields),this[8]=Object.create(gaf.Tag.DefineAtlas2),this[9]=Object.create(gaf.Tag.DefineStage),this[10]=Object.create(gaf.Tag.DefineAnimationObjects2),this[11]=Object.create(gaf.Tag.DefineAnimationMasks2),this[12]=Object.create(gaf.Tag.DefineAnimationFrames2),this[13]=Object.create(gaf.Tag.DefineTimeline)},gaf.Tag.base=function(){},gaf.Tag.base.parse=function(t,e){var i=t.Uint();return t.startNestedBuffer(i),i=this.doParse(t),t.endNestedBuffer(),i.tagName=this.tagName,i.tagId=e,i},gaf.Tag.base.doParse=function(){return{}},gaf.Tag.End=Object.create(gaf.Tag.base),gaf.Tag.End.tagName="TagEnd",gaf.Tag.DefineAtlas=Object.create(gaf.Tag.base),gaf.Tag.DefineAtlas.tagName="TagDefineAtlas",gaf.Tag.DefineAtlas.doParse=function(t){return{content:t.fields("scale","Float","atlases",t.array("Ubyte",t.fields("id","Uint","sources",t.array("Ubyte",t.fields("source","String","csf","Float")))),"elements",t.array("Uint",t.fields("pivot","Point","origin","Point","scale","Float","size","Point","atlasId","Uint","elementAtlasId","Uint")))()}},gaf.Tag.DefineAnimationMasks=Object.create(gaf.Tag.base),gaf.Tag.DefineAnimationMasks.tagName="TagDefineAnimationMasks",gaf.Tag.DefineAnimationMasks.doParse=function(t){return{content:t.array("Uint",t.fields("objectId","Uint","elementAtlasIdRef","Uint"))()}},gaf.Tag.DefineAnimationObjects=Object.create(gaf.Tag.base),gaf.Tag.DefineAnimationObjects.tagName="TagDefineAnimationObjects",gaf.Tag.DefineAnimationObjects.doParse=function(t){return{content:t.array("Uint",t.fields("objectId","Uint","elementAtlasIdRef","Uint"))()}},gaf.Tag.DefineAnimationFrames=Object.create(gaf.Tag.base),gaf.Tag.DefineAnimationFrames.tagName="TagDefineAnimationFrames",gaf.Tag.DefineAnimationFrames.doParse=function(t){return{content:t.array("Uint",t.fields("frame","Uint","state",t.array("Uint",t.fields("hasColorTransform","Ubyte","hasMask","Ubyte","hasEffect","Ubyte","objectIdRef","Uint","depth","Int","alpha","Float","matrix","Matrix","colorTransform",t.condition("hasColorTransform",1,t.fields("alphaOffset","Float","redMultiplier","Float","redOffset","Float","greenMultiplier","Float","greenOffset","Float","blueMultiplier","Float","blueOffset","Float")),"effect",t.condition("hasEffect",1,t.array("Ubyte",gaf.Tag._readFilter(t))),"maskObjectIdRef",t.condition("hasMask",1,t.fields("maskObjectIdRef","Uint"))))))()}},gaf.Tag.DefineNamedParts=Object.create(gaf.Tag.base),gaf.Tag.DefineNamedParts.tagName="TagDefineNamedParts",gaf.Tag.DefineNamedParts.doParse=function(t){return{content:t.array("Uint",t.fields("objectId","Uint","name","String"))()}},gaf.Tag.DefineSequences=Object.create(gaf.Tag.base),gaf.Tag.DefineSequences.tagName="TagDefineSequences",gaf.Tag.DefineSequences.doParse=function(t){return{content:t.array("Uint",t.fields("id","String","start","Ushort","end","Ushort"))()}},gaf.Tag.DefineTextFields=Object.create(gaf.Tag.base),gaf.Tag.DefineTextFields.tagName="TagDefineTextFields",gaf.Tag.DefineTextFields.doParse=function(t){return{content:t.array("Uint",t.fields("id","Uint","pivot","Point","end","Ushort","width","Float","height","Float","text","String","embedFonts","Boolean","multiline","Boolean","wordWrap","Boolean","hasRestrict","Boolean","restrict",t.condition("hasRestrict",1,function(){return t.String}),"editable","Boolean","selectable","Boolean","displayAsPassword","Boolean","maxChars","Uint","align","Uint","blockIndent","Uint","bold","Boolean","bullet","Boolean","color","color","font","String","indent","Uint","italic","Boolean","kerning","Boolean","leading","Uint","leftMargin","Uint","letterSpacing","Float","rightMargin","Uint","size","Uint","tabStops",t.array("Uint",t.fields("value","Uint")),"target","string","underline","Boolean","url","String"))()}},gaf.Tag.DefineAtlas2=Object.create(gaf.Tag.base),gaf.Tag.DefineAtlas2.tagName="TagDefineAtlas2",gaf.Tag.DefineAtlas2.doParse=function(t){return{content:t.fields("scale","Float","atlases",t.array("Ubyte",t.fields("id","Uint","sources",t.array("Ubyte",t.fields("source","String","csf","Float")))),"elements",t.array("Uint",t.fields("pivot","Point","origin","Point","scale","Float","size","Point","atlasId","Uint","elementAtlasId","Uint","hasScale9Grid","Boolean","scale9GridRect",t.condition("hasScale9Grid",1,function(){return t.Rect()}))))()}},gaf.Tag.DefineStage=Object.create(gaf.Tag.base),gaf.Tag.DefineStage.tagName="TagDefineStage",gaf.Tag.DefineStage.doParse=function(t){return{content:t.fields("fps","Ubyte","color","color","width","Ushort","height","Ushort")()}},gaf.Tag.DefineAnimationObjects2=Object.create(gaf.Tag.base),gaf.Tag.DefineAnimationObjects2.tagName="TagDefineAnimationObjects2",gaf.Tag.DefineAnimationObjects2.doParse=function(t){return{content:t.array("Uint",t.fields("objectId","Uint","elementAtlasIdRef","Uint","type","Ushort"))()}},gaf.Tag.DefineAnimationMasks2=Object.create(gaf.Tag.base),gaf.Tag.DefineAnimationMasks2.tagName="TagDefineAnimationMasks2",gaf.Tag.DefineAnimationMasks2.doParse=function(t){return{content:t.array("Uint",t.fields("objectId","Uint","elementAtlasIdRef","Uint","type","Ushort"))()}},gaf.Tag.DefineAnimationFrames2=Object.create(gaf.Tag.base),gaf.Tag.DefineAnimationFrames2.tagName="TagDefineAnimationFrames2",gaf.Tag.DefineAnimationFrames2.doParse=function(t){return{content:t.array("Uint",t.fields("frame","Uint","hasChangesInDisplayList","Boolean","hasActions","Boolean","state",t.condition("hasChangesInDisplayList",1,t.array("Uint",t.fields("hasColorTransform","Boolean","hasMask","Boolean","hasEffect","Boolean","objectIdRef","Uint","depth","Int","alpha","Float","matrix","Matrix","colorTransform",t.condition("hasColorTransform",1,t.fields("alphaOffset","Float","redMultiplier","Float","redOffset","Float","greenMultiplier","Float","greenOffset","Float","blueMultiplier","Float","blueOffset","Float")),"effect",t.condition("hasEffect",1,t.array("Ubyte",gaf.Tag._readFilter(t))),"maskObjectIdRef",t.condition("hasMask",1,function(){return t.Uint()})))),"actions",t.condition("hasActions",1,t.array("Uint",t.fields("type","Uint","scope","String","params",gaf.Tag._readActionArguments(t))))))()}},gaf.Tag.DefineTimeline=Object.create(gaf.Tag.base),gaf.Tag.DefineTimeline.tagName="TagDefineTimeline",gaf.Tag.DefineTimeline.doParse=function(t){var e={content:t.fields("id","Uint","animationFrameCount","Uint","boundingBox","Rect","pivotPoint","Point","hasLinkage","Boolean","linkageName",t.condition("hasLinkage",1,function(){return t.String()}))()};return e.content.tags=gaf.ReadTags(t),e},gaf.Tag._readActionArguments=function(t){return function(){var e=t.Uint(),i=[];for(t.startNestedBuffer(e);t.maxOffset()<t.tell();)i.push(t.String());return t.endNestedBuffer(),i}},gaf.Tag._readFilter=function(t){return t.fields("type","Uint","dropShadow",t.condition("type",gaf.EFFECT_DROP_SHADOW,t.fields("color","color","blurX","Float","blurY","Float","angle","Float","distance","Float","strength","Float","inner","Boolean","knockout","Boolean")),"blur",t.condition("type",gaf.EFFECT_BLUR,t.fields("blurX","Float","blurY","Float")),"glow",t.condition("type",gaf.EFFECT_GLOW,t.fields("color","color","blurX","Float","blurY","Float","strength","Float","inner","Boolean","knockout","Boolean")),"colorMatrix",t.condition("type",gaf.EFFECT_COLOR_MATRIX,t.fields("rr","Float","gr","Float","br","Float","ar","Float","r","Float","rg","Float","gg","Float","bg","Float","ag","Float","g","Float","rb","Float","gb","Float","bb","Float","ab","Float","b","Float","ra","Float","ga","Float","ba","Float","aa","Float","a","Float")))},gaf.Tags=new gaf.Tag,gaf=gaf||{},gaf.Loader=function(){this.LoadFile=function(t,e){var i=new XMLHttpRequest;i.open("GET",t,!0);var n=this;i.responseType="arraybuffer",i.onload=function(t){t=new gaf.DataReader(i.response),t=n.LoadStream(t),e&&e(t)},i.send()},this.LoadStream=function(t){var e={},i=t;if(e.compression=i.Uint(),e.versionMajor=i.Ubyte(),e.versionMinor=i.Ubyte(),e.fileLength=i.Uint(),e.compression!=gaf.COMPRESSION_NONE){if(e.compression!=gaf.COMPRESSION_ZIP)throw Error("GAF syntax error.");t=t.dataRaw.slice(t.tell()),t=new window.Zlib.Inflate(new Uint8Array(t)).decompress(),t=new gaf.DataReader(t.buffer)}if(4>e.versionMajor)i=t,e.framesCount=i.Ushort(),e.frameSize=i.Rect(),e.pivot=i.Point();else{var i=t,n=i.Uint();e.scaleValues=[];for(var r=0;n>r;++r)e.scaleValues.push(i.Float());for(n=i.Uint(),e.csfValues=[],r=0;n>r;++r)e.csfValues.push(i.Float())}return t=gaf.ReadTags(t),{header:e,tags:t}}},gaf.DataReader=function(t){this.dataRaw=t,this.buf=new DataView(t),this.offset=[0]},gaf.DataReader.prototype.constructor=gaf.DataReader,gaf.DataReader.prototype.newOffset=function(t){if(this.offset[this.offset.length-1]+=t,this.getOffset()>this.maxOffset())throw Error("GAF format error");return this.offset[this.offset.length-1]-t},gaf.DataReader.prototype.maxOffset=function(){return 1==this.offset.length?this.buf.byteLength:this.offset[this.offset.length-2]},gaf.DataReader.prototype.getOffset=function(){return this.offset[this.offset.length-1]},gaf.DataReader.prototype.Ubyte=function(){return this.buf.getUint8(this.newOffset(1))},gaf.DataReader.prototype.Boolean=function(){var t=this.buf.getUint8(this.newOffset(1));if(t>1)throw Error("GAF format error");return t},gaf.DataReader.prototype.Uint=function(){return this.buf.getUint32(this.newOffset(4),!0)},gaf.DataReader.prototype.Int=function(){return this.buf.getInt32(this.newOffset(4),!0)},gaf.DataReader.prototype.color=function(){return{b:this.Ubyte(),g:this.Ubyte(),r:this.Ubyte(),a:this.Ubyte()}},gaf.DataReader.prototype.Ushort=function(){return this.buf.getUint16(this.newOffset(2),!0)},gaf.DataReader.prototype.Float=function(){return this.buf.getFloat32(this.newOffset(4),!0)},gaf.DataReader.prototype.String=function(){var t=this.Ushort(),e=this.newOffset(t),t=this.getOffset();try{var i=this.dataRaw.slice(e,t)}catch(n){if("Object doesn't support property or method 'slice'"!=n.message)throw n;for(i=[];t>e;++e)i.push(this.buf.getUint8(e))}return decodeURIComponent(escape(String.fromCharCode.apply(null,new Uint8Array(i))))},gaf.DataReader.prototype.startNestedBuffer=function(t){this.offset.push(this.offset[this.offset.length-1]),this.offset[this.offset.length-2]+=t},gaf.DataReader.prototype.endNestedBuffer=function(){if(1==this.offset.length)throw Error("No nested buffer available");this.offset.pop()},gaf.DataReader.prototype.Point=function(){return{x:this.Float(),y:this.Float()}},gaf.DataReader.prototype.Rect=function(){return{x:this.Float(),y:this.Float(),width:this.Float(),height:this.Float()}},gaf.DataReader.prototype.Matrix=function(){return{a:this.Float(),b:this.Float(),c:this.Float(),d:this.Float(),tx:this.Float(),ty:this.Float()}},gaf.DataReader.prototype.seek=function(t){this.offset[this.offset.length-1]=t},gaf.DataReader.prototype.tell=function(){return this.offset[this.offset.length-1]},gaf.DataReader.prototype.fields=function(){var t=this,e=arguments;return function(){arguments.callee.result={};var i=0;if(e.length%2)throw Error("Number of arguments is not even");for(;i<e.length;){var n=e[i++],r=e[i++];if("function"==typeof r)arguments.callee.result[n]=r();else{if(!(r in t&&"function"==typeof t[r]))throw Error("Object DataReader has no function `"+r+"`");arguments.callee.result[n]=t[r].call(t)}}return arguments.callee.result}},gaf.DataReader.prototype.condition=function(){var t=arguments;return function(){if(3!=t.length)throw Error("Condition function");var e=arguments.callee.caller;if(!("result"in e))throw Error("Condition function caller has no key `result`");var i=e.result,n=t[0],r=t[1],e=t[2];return("function"==typeof r?function(){return r(i[n])}:function(){return r==i[n]})()?e():null}},gaf.DataReader.prototype.array=function(){var t=this,e=arguments;return function(){arguments.callee.result=[];for(var i=t[e[0]].call(t),n=0;i>n;++n){var r=e[1].call();arguments.callee.result.push(r)}return arguments.callee.result}},gaf.SHADER_GAUSSIAN_BLUR_FRAG="varying mediump vec2 v_texCoord;\nuniform mediump vec2 u_step;\nvoid main()\n{ \n    mediump vec4 sum = vec4(0.0);                                      \n    sum += texture2D(CC_Texture0, v_texCoord - u_step * 4.0) * 0.05;   \n    sum += texture2D(CC_Texture0, v_texCoord - u_step * 3.0) * 0.09;   \n    sum += texture2D(CC_Texture0, v_texCoord - u_step * 2.0) * 0.12;   \n    sum += texture2D(CC_Texture0, v_texCoord - u_step * 1.0) * 0.15;   \n    sum += texture2D(CC_Texture0, v_texCoord + u_step * 0.0) * 0.18;   \n    sum += texture2D(CC_Texture0, v_texCoord + u_step * 1.0) * 0.15;   \n    sum += texture2D(CC_Texture0, v_texCoord + u_step * 2.0) * 0.12;   \n    sum += texture2D(CC_Texture0, v_texCoord + u_step * 3.0) * 0.09;   \n    sum += texture2D(CC_Texture0, v_texCoord + u_step * 4.0) * 0.05;   \n    gl_FragColor = sum;                                                \n} \n",gaf.SHADER_GLOW_FRAG="varying mediump vec2 v_texCoord;\nuniform mediump vec2 u_step;\nuniform mediump vec4 u_glowColor;\nvoid main()\n{ \n    mediump vec4 sum = vec4(0.0);                                      \n    sum += texture2D(CC_Texture0, v_texCoord - u_step * 4.0) * 0.05;   \n    sum += texture2D(CC_Texture0, v_texCoord - u_step * 3.0) * 0.09;   \n    sum += texture2D(CC_Texture0, v_texCoord - u_step * 2.0) * 0.12;   \n    sum += texture2D(CC_Texture0, v_texCoord - u_step * 1.0) * 0.15;   \n    sum += texture2D(CC_Texture0, v_texCoord + u_step * 0.0) * 0.18;   \n    sum += texture2D(CC_Texture0, v_texCoord + u_step * 1.0) * 0.15;   \n    sum += texture2D(CC_Texture0, v_texCoord + u_step * 2.0) * 0.12;   \n    sum += texture2D(CC_Texture0, v_texCoord + u_step * 3.0) * 0.09;   \n    sum += texture2D(CC_Texture0, v_texCoord + u_step * 4.0) * 0.05;   \n    gl_FragColor = sum * u_glowColor;                                  \n} \n",gaf.SHADER_COLOR_MATRIX_FRAG="varying mediump vec2 v_texCoord;\nvarying mediump vec4 v_fragmentColor;\nuniform mediump vec4 colorTransformMult;\nuniform mediump vec4 colorTransformOffsets;\nuniform mediump mat4 colorMatrix;\nuniform mediump vec4 colorMatrix2;\nvoid main()\n{ \n    vec4 texColor = texture2D(CC_Texture0, v_texCoord);                          \n    const float kMinimalAlphaAllowed = 1.0e-8;                                   \n    if (texColor.a > kMinimalAlphaAllowed)                                       \n    {                                                                            \n        texColor = vec4(texColor.rgb / texColor.a, texColor.a);                  \n        vec4 ctxColor = texColor * colorTransformMult + colorTransformOffsets;   \n        vec4 adjustColor = colorMatrix * ctxColor + colorMatrix2;                \n        adjustColor *= v_fragmentColor;                                          \n        texColor = vec4(adjustColor.rgb * adjustColor.a, adjustColor.a);         \n    }                                                                            \n    gl_FragColor = texColor;                                                     \n}\n",gaf._glShaderInit=function(){gaf._Uniforms={ColorTransformMult:-1,ColorTransformOffset:-1,ColorMatrixBody:-1,ColorMatrixAppendix:-1,BlurTexelOffset:-1,GlowTexelOffset:-1,GlowColor:-1},gaf._shaderCreate=function(t,e){var i=new cc.GLProgram,n=i.initWithVertexShaderByteArray(e,t);return cc.assert(n,"Shader init error"),i.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),i.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR),i.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS),n=i.link(),cc.assert(n,"Shader linking error"),i.updateUniforms(),i},gaf._shaderCreateAlpha=function(){var t=gaf._shaderCreate(gaf.SHADER_COLOR_MATRIX_FRAG,cc.SHADER_POSITION_TEXTURE_COLOR_VERT);return gaf._Uniforms.ColorTransformMult=t.getUniformLocationForName(gaf.UNIFORM_ALPHA_TINT_MULT),gaf._Uniforms.ColorTransformOffset=t.getUniformLocationForName(gaf.UNIFORM_ALPHA_TINT_OFFSET),gaf._Uniforms.ColorMatrixBody=t.getUniformLocationForName(gaf.UNIFORM_ALPHA_COLOR_MATRIX_BODY),gaf._Uniforms.ColorMatrixAppendix=t.getUniformLocationForName(gaf.UNIFORM_ALPHA_COLOR_MATRIX_APPENDIX),t},gaf._shaderCreateBlur=function(){var t=gaf._shaderCreate(gaf.SHADER_GAUSSIAN_BLUR_FRAG,cc.SHADER_POSITION_TEXTURE_COLOR_VERT);return gaf._Uniforms.BlurTexelOffset=t._glContext.getUniformLocation(t._programObj,gaf.UNIFORM_BLUR_TEXEL_OFFSET),t},gaf._shaderCreateGlow=function(){var t=gaf._shaderCreate(gaf.SHADER_GLOW_FRAG,cc.SHADER_POSITION_TEXTURE_COLOR_VERT);return gaf._Uniforms.GlowTexelOffset=t._glContext.getUniformLocation(t._programObj,gaf.UNIFORM_GLOW_TEXEL_OFFSET),gaf._Uniforms.GlowColor=t._glContext.getUniformLocation(t._programObj,gaf.UNIFORM_GLOW_COLOR),t},gaf._Shaders={Alpha:gaf._shaderCreateAlpha(),Blur:gaf._shaderCreateBlur(),Glow:gaf._shaderCreateGlow()}},gaf._setupShaders=function(){cc._renderType===cc._RENDER_TYPE_WEBGL?gaf._glShaderInit():delete gaf._glShaderInit},gaf._AtlasLoader={},gaf._AtlasLoader.execute=function(t,e,i){t()?e():i()},gaf._AtlasLoader.checkAtlas=function(t){return function(){return t&&"string"!=typeof t&&t.isLoaded()}},gaf._AtlasLoader.load=function(t,e,i){cc.textureCache.addImage(t,function(t){gaf._AtlasLoader.execute(gaf._AtlasLoader.checkAtlas(t),function(){e(t)},i)})},gaf._AtlasLoader.loadFront=function(t,e,i){return function(){0<t.length?gaf._AtlasLoader.load(t[0],e,gaf._AtlasLoader.loadFront(t.slice(1),e,i)):i()}},gaf._AtlasLoader.loadArray=function(t,e,i){gaf._AtlasLoader.loadFront(t,e,i)()},cc.CONTROL_EVENT_TOTAL_NUMBER=9,cc.CONTROL_EVENT_TOUCH_DOWN=1,cc.CONTROL_EVENT_TOUCH_DRAG_INSIDE=2,cc.CONTROL_EVENT_TOUCH_DRAG_OUTSIDE=4,cc.CONTROL_EVENT_TOUCH_DRAG_ENTER=8,cc.CONTROL_EVENT_TOUCH_DRAG_EXIT=16,cc.CONTROL_EVENT_TOUCH_UP_INSIDE=32,cc.CONTROL_EVENT_TOUCH_UP_OUTSIDE=64,cc.CONTROL_EVENT_TOUCH_CANCEL=128,cc.CONTROL_EVENT_VALUECHANGED=256,cc.CONTROL_STATE_NORMAL=1,cc.CONTROL_STATE_HIGHLIGHTED=2,cc.CONTROL_STATE_DISABLED=4,cc.CONTROL_STATE_SELECTED=8,cc.CONTROL_STATE_INITIAL=8,cc.Control=cc.Layer.extend({_isOpacityModifyRGB:!1,_hasVisibleParents:!1,_touchListener:null,_className:"Control",isOpacityModifyRGB:function(){return this._isOpacityModifyRGB},setOpacityModifyRGB:function(t){this._isOpacityModifyRGB=t;for(var e=this.getChildren(),i=0,n=e.length;n>i;i++){var r=e[i];r&&r.setOpacityModifyRGB(t)}},_state:cc.CONTROL_STATE_NORMAL,getState:function(){return this._state},_enabled:!1,_selected:!1,_highlighted:!1,_dispatchTable:null,setEnabled:function(t){this._state=(this._enabled=t)?cc.CONTROL_STATE_NORMAL:cc.CONTROL_STATE_DISABLED,this.needsLayout()},isEnabled:function(){return this._enabled},setSelected:function(t){this._selected=t,this.needsLayout()},isSelected:function(){return this._selected},setHighlighted:function(t){this._highlighted=t,this.needsLayout()},isHighlighted:function(){return this._highlighted},hasVisibleParents:function(){for(var t=this.getParent();null!=t;t=t.getParent())if(!t.isVisible())return!1;return!0},ctor:function(){cc.Layer.prototype.ctor.call(this),this._dispatchTable={},this._color=cc.color.WHITE},init:function(){if(cc.Layer.prototype.init.call(this)){this._state=cc.CONTROL_STATE_NORMAL,this._enabled=!0,this._highlighted=this._selected=!1;var t=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0});return this.onTouchBegan&&(t.onTouchBegan=this.onTouchBegan.bind(this)),this.onTouchMoved&&(t.onTouchMoved=this.onTouchMoved.bind(this)),this.onTouchEnded&&(t.onTouchEnded=this.onTouchEnded.bind(this)),this.onTouchCancelled&&(t.onTouchCancelled=this.onTouchCancelled.bind(this)),this._touchListener=t,!0}return!1},onEnter:function(){var t=this._touchListener;t._isRegistered()||cc.eventManager.addListener(t,this),cc.Node.prototype.onEnter.call(this)},sendActionsForControlEvents:function(t){for(var e=0,i=cc.CONTROL_EVENT_TOTAL_NUMBER;i>e;e++)if(t&1<<e)for(var n=this._dispatchListforControlEvent(1<<e),r=0,o=n.length;o>r;r++)n[r].invoke(this)},addTargetWithActionForControlEvents:function(t,e,i){for(var n=0,r=cc.CONTROL_EVENT_TOTAL_NUMBER;r>n;n++)i&1<<n&&this._addTargetWithActionForControlEvent(t,e,1<<n)},removeTargetWithActionForControlEvents:function(t,e,i){for(var n=0,r=cc.CONTROL_EVENT_TOTAL_NUMBER;r>n;n++)i&1<<n&&this._removeTargetWithActionForControlEvent(t,e,1<<n)},getTouchLocation:function(t){return t=t.getLocation(),this.convertToNodeSpace(t)},isTouchInside:function(t){return t=t.getLocation(),t=this.getParent().convertToNodeSpace(t),cc.rectContainsPoint(this.getBoundingBox(),t)},_invocationWithTargetAndActionForControlEvent:function(){return null},_dispatchListforControlEvent:function(t){return t=t.toString(),this._dispatchTable[t]||(this._dispatchTable[t]=[]),this._dispatchTable[t]},_addTargetWithActionForControlEvent:function(t,e,i){t=new cc.Invocation(t,e,i),this._dispatchListforControlEvent(i).push(t)},_removeTargetWithActionForControlEvent:function(t,e,i){if(i=this._dispatchListforControlEvent(i),t||e)for(var n=0;n<i.length;){var r=i[n],o=!0;t&&(o=t===r.getTarget()),e&&(o=o&&e===r.getAction()),o?cc.arrayRemoveObject(i,r):n++}else i.length=0},needsLayout:function(){}}),_p=cc.Control.prototype,cc.defineGetterSetter(_p,"state",_p.getState),cc.defineGetterSetter(_p,"enabled",_p.isEnabled,_p.setEnabled),cc.defineGetterSetter(_p,"selected",_p.isSelected,_p.setSelected),cc.defineGetterSetter(_p,"highlighted",_p.isHighlighted,_p.setHighlighted),_p=null,cc.Control.create=function(){var t=new cc.Control;return t&&t.init()?t:null},cc.CONTROL_ZOOM_ACTION_TAG=3435855873,cc.ControlButton=cc.Control.extend({_doesAdjustBackgroundImage:!1,zoomOnTouchDown:!1,_preferredSize:null,_labelAnchorPoint:null,_currentTitle:null,_currentTitleColor:null,_titleLabel:null,_backgroundSprite:null,_opacity:0,_isPushed:!1,_titleDispatchTable:null,_titleColorDispatchTable:null,_titleLabelDispatchTable:null,_backgroundSpriteDispatchTable:null,_parentInited:!1,_marginV:0,_marginH:0,_className:"ControlButton",ctor:function(t,e,i){cc.Control.prototype.ctor.call(this),this._preferredSize=cc.size(0,0),this._labelAnchorPoint=cc.p(0,0),this._currentTitle="",this._currentTitleColor=cc.color.WHITE,this._titleDispatchTable={},this._titleColorDispatchTable={},this._titleLabelDispatchTable={},this._backgroundSpriteDispatchTable={},void 0!=i?this.initWithTitleAndFontNameAndFontSize(t,e,i):void 0!=e?this.initWithLabelAndBackgroundSprite(t,e):void 0!=t?this.initWithBackgroundSprite(t):this.init()},init:function(){return this.initWithLabelAndBackgroundSprite(new cc.LabelTTF("","Arial",12),new cc.Scale9Sprite)},needsLayout:function(){if(this._parentInited){this._titleLabel&&this._titleLabel.setVisible(!1),this._backgroundSprite&&this._backgroundSprite.setVisible(!1),this.setLabelAnchorPoint(this._labelAnchorPoint);var t=this._state;this._currentTitle=this.getTitleForState(t),this._currentTitleColor=this.getTitleColorForState(t);var e=this._titleLabel=this.getTitleLabelForState(t);e&&e.setString&&e.setString(this._currentTitle),e&&e.setColor(this._currentTitleColor);var i=this.getContentSize();if(e&&e.setPosition(i.width/2,i.height/2),(t=this._backgroundSprite=this.getBackgroundSpriteForState(t))&&t.setPosition(i.width/2,i.height/2),i=cc.size(0,0),e){var n=e.getBoundingBox();i.width=n.width,i.height=n.height}this._doesAdjustBackgroundImage?t&&t.setContentSize(i.width+2*this._marginH,i.height+2*this._marginV):t&&(n=t.getPreferredSize(),n=cc.size(n.width,n.height),0>=n.width&&(n.width=i.width),0>=n.height&&(n.height=i.height),t.setContentSize(n)),i=e?e.getBoundingBox():cc.rect(0,0,0,0),n=t?t.getBoundingBox():cc.rect(0,0,0,0),i=cc.rectUnion(i,n),this.setContentSize(i.width,i.height),i=this.getContentSize(),e&&(e.setPosition(i.width/2,i.height/2),e.setVisible(!0)),t&&(t.setPosition(i.width/2,i.height/2),t.setVisible(!0))}},initWithLabelAndBackgroundSprite:function(t,e){if(!t)throw"cc.ControlButton.initWithLabelAndBackgroundSprite(): label should be non-null";if(!e)throw"cc.ControlButton.initWithLabelAndBackgroundSprite(): backgroundSprite should be non-null";if(cc.Control.prototype.init.call(this,!0)){this._parentInited=!0,this._titleDispatchTable={},this._titleColorDispatchTable={},this._titleLabelDispatchTable={},this._backgroundSpriteDispatchTable={},this._isPushed=!1,this.zoomOnTouchDown=!0,this._currentTitle=null,this.setAdjustBackgroundImage(!0),this.setPreferredSize(cc.size(0,0)),this.zoomOnTouchDown=!0,this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(.5,.5),this._titleLabel=t,this._backgroundSprite=e,this.setOpacity(255),this.setOpacityModifyRGB(!0);var i=t.getString();return this.setTitleForState(i,cc.CONTROL_STATE_NORMAL),this.setTitleColorForState(t.getColor(),cc.CONTROL_STATE_NORMAL),this.setTitleLabelForState(t,cc.CONTROL_STATE_NORMAL),this.setBackgroundSpriteForState(e,cc.CONTROL_STATE_NORMAL),this._state=cc.CONTROL_STATE_NORMAL,this._marginH=24,this._marginV=12,this._labelAnchorPoint=cc.p(.5,.5),this.setPreferredSize(cc.size(0,0)),this.needsLayout(),!0}return!1},initWithTitleAndFontNameAndFontSize:function(t,e,i){return t=new cc.LabelTTF(t,e,i),this.initWithLabelAndBackgroundSprite(t,new cc.Scale9Sprite)},initWithBackgroundSprite:function(t){var e=new cc.LabelTTF("","Arial",30);return this.initWithLabelAndBackgroundSprite(e,t)},doesAdjustBackgroundImage:function(){return this._doesAdjustBackgroundImage},setAdjustBackgroundImage:function(t){this._doesAdjustBackgroundImage=t,this.needsLayout()},getZoomOnTouchDown:function(){return this.zoomOnTouchDown},setZoomOnTouchDown:function(t){return this.zoomOnTouchDown=t},getPreferredSize:function(){return this._preferredSize},setPreferredSize:function(t){if(0===t.width&&0===t.height)this._doesAdjustBackgroundImage=!0;else{this._doesAdjustBackgroundImage=!1;var e,i=this._backgroundSpriteDispatchTable;for(e in i)i[e].setPreferredSize(t)}this._preferredSize=t,this.needsLayout()},getLabelAnchorPoint:function(){return this._labelAnchorPoint},setLabelAnchorPoint:function(t){this._labelAnchorPoint=t,this._titleLabel&&this._titleLabel.setAnchorPoint(t)},_getCurrentTitle:function(){return this._currentTitle},_getCurrentTitleColor:function(){return this._currentTitleColor},getOpacity:function(){return this._opacity},setOpacity:function(t){cc.Control.prototype.setOpacity.call(this,t);var e,i=this._backgroundSpriteDispatchTable;for(e in i)i[e].setOpacity(t)},setColor:function(t){cc.Control.prototype.setColor.call(this,t);var e,i=this._backgroundSpriteDispatchTable;for(e in i)i[e].setColor(t)},getColor:function(){var t=this._realColor;return cc.color(t.r,t.g,t.b,t.a)},isPushed:function(){return this._isPushed},_getVerticalMargin:function(){return this._marginV},_getHorizontalOrigin:function(){return this._marginH},setMargins:function(t,e){this._marginV=e,this._marginH=t,this.needsLayout()},setEnabled:function(t){cc.Control.prototype.setEnabled.call(this,t),this.needsLayout()},setSelected:function(t){cc.Control.prototype.setSelected.call(this,t),this.needsLayout()},setHighlighted:function(t){this._state=t?cc.CONTROL_STATE_HIGHLIGHTED:cc.CONTROL_STATE_NORMAL,cc.Control.prototype.setHighlighted.call(this,t),(t=this.getActionByTag(cc.CONTROL_ZOOM_ACTION_TAG))&&this.stopAction(t),this.zoomOnTouchDown&&(t=this.isHighlighted()&&this.isEnabled()&&!this.isSelected()?1.1:1,t=cc.scaleTo(.05,t),t.setTag(cc.CONTROL_ZOOM_ACTION_TAG),this.runAction(t))},onTouchBegan:function(t){return this.isTouchInside(t)&&this.isEnabled()&&this.isVisible()&&this.hasVisibleParents()?(this._isPushed=!0,this.setHighlighted(!0),this.sendActionsForControlEvents(cc.CONTROL_EVENT_TOUCH_DOWN),!0):!1},onTouchMoved:function(t){if(this._enabled&&this._isPushed&&!this._selected){var e=this.isTouchInside(t);e&&!this._highlighted?(this.setHighlighted(!0),this.sendActionsForControlEvents(cc.CONTROL_EVENT_TOUCH_DRAG_ENTER)):e&&this._highlighted?this.sendActionsForControlEvents(cc.CONTROL_EVENT_TOUCH_DRAG_INSIDE):!e&&this._highlighted?(this.setHighlighted(!1),this.sendActionsForControlEvents(cc.CONTROL_EVENT_TOUCH_DRAG_EXIT)):e||this._highlighted||this.sendActionsForControlEvents(cc.CONTROL_EVENT_TOUCH_DRAG_OUTSIDE)
}else this._highlighted&&this.setHighlighted(!1)},onTouchEnded:function(t){this._isPushed=!1,this.setHighlighted(!1),this.sendActionsForControlEvents(this.isTouchInside(t)?cc.CONTROL_EVENT_TOUCH_UP_INSIDE:cc.CONTROL_EVENT_TOUCH_UP_OUTSIDE)},onTouchCancelled:function(){this._isPushed=!1,this.setHighlighted(!1),this.sendActionsForControlEvents(cc.CONTROL_EVENT_TOUCH_CANCEL)},getTitleForState:function(t){var e=this._titleDispatchTable;return e?e[t]?e[t]:e[cc.CONTROL_STATE_NORMAL]:""},setTitleForState:function(t,e){this._titleDispatchTable[e]=t||"",this.getState()===e&&this.needsLayout()},getTitleColorForState:function(t){return(t=this._titleColorDispatchTable[t])?t:(t=this._titleColorDispatchTable[cc.CONTROL_STATE_NORMAL])?t:cc.color.WHITE},setTitleColorForState:function(t,e){this._titleColorDispatchTable[e]=t,this.getState()===e&&this.needsLayout()},getTitleLabelForState:function(t){var e=this._titleLabelDispatchTable;return e[t]?e[t]:e[cc.CONTROL_STATE_NORMAL]},setTitleLabelForState:function(t,e){var i=this._titleLabelDispatchTable;if(i[e]){var n=i[e];n&&this.removeChild(n,!0)}i[e]=t,t.setVisible(!1),t.setAnchorPoint(.5,.5),this.addChild(t,1),this.getState()===e&&this.needsLayout()},setTitleTTFForState:function(t,e){var i=this.getTitleForState(e);i||(i=""),this.setTitleLabelForState(new cc.LabelTTF(i,t,12),e)},getTitleTTFForState:function(t){return t=this.getTitleLabelForState(t),null!=t&&t instanceof cc.LabelTTF?t.getFontName():""},setTitleTTFSizeForState:function(t,e){var i=this.getTitleLabelForState(e);null!=i&&i instanceof cc.LabelTTF&&i.setFontSize(t)},getTitleTTFSizeForState:function(t){return t=this.getTitleLabelForState(t),null!=t&&t instanceof cc.LabelTTF?t.getFontSize():0},setTitleBMFontForState:function(t,e){var i=this.getTitleForState(e);i||(i=""),this.setTitleLabelForState(new cc.LabelBMFont(i,t),e)},getTitleBMFontForState:function(t){return t=this.getTitleLabelForState(t),null!=t&&t instanceof cc.LabelBMFont?t.getFntFile():""},getBackgroundSpriteForState:function(t){var e=this._backgroundSpriteDispatchTable;return e[t]?e[t]:e[cc.CONTROL_STATE_NORMAL]},setBackgroundSpriteForState:function(t,e){var i=this._backgroundSpriteDispatchTable;if(i[e]){var n=i[e];n&&this.removeChild(n,!0)}i[e]=t,t.setVisible(!1),t.setAnchorPoint(.5,.5),this.addChild(t),i=this._preferredSize,0===i.width&&0===i.height||t.setPreferredSize(i),this._state===e&&this.needsLayout()},setBackgroundSpriteFrameForState:function(t,e){var i=cc.Scale9Sprite.createWithSpriteFrame(t);this.setBackgroundSpriteForState(i,e)}}),_p=cc.ControlButton.prototype,cc.defineGetterSetter(_p,"adjustBackground",_p.getAdjustBackgroundImage,_p.setAdjustBackgroundImage),cc.defineGetterSetter(_p,"preferredSize",_p.getPreferredSize,_p.setPreferredSize),cc.defineGetterSetter(_p,"labelAnchor",_p.getLabelAnchorPoint,_p.setLabelAnchorPoint),_p=null,cc.ControlButton.create=function(t,e,i){return new cc.ControlButton(t,e,i)},cc.RGBA=function(t,e,i,n){this.r=t,this.g=e,this.b=i,this.a=n},cc.HSV=function(t,e,i){this.h=t,this.s=e,this.v=i},cc.ControlUtils={},cc.ControlUtils.addSpriteToTargetWithPosAndAnchor=function(t,e,i,n){return(t=new cc.Sprite("#"+t))?(t.setPosition(i),t.setAnchorPoint(n),e.addChild(t),t):null},cc.ControlUtils.HSVfromRGB=function(t){var e,i,n=new cc.HSV;return e=t.r<t.g?t.r:t.g,e=e<t.b?e:t.b,i=t.r>t.g?t.r:t.g,i=i>t.b?i:t.b,n.v=i,e=i-e,i>0?(n.s=e/i,n.h=t.r>=i?(t.g-t.b)/e:t.g>=i?2+(t.b-t.r)/e:4+(t.r-t.g)/e,n.h*=60,0>n.h&&(n.h+=360),n):(n.s=0,n.h=-1,n)},cc.ControlUtils.RGBfromHSV=function(t){var e,i,n,r,o=new cc.RGBA;if(o.a=1,0>=t.s)return t.h?(o.r=0,o.g=0,o.b=0,o):(o.r=t.v,o.g=t.v,o.b=t.v,o);switch(e=t.h,e>=360&&(e=0),e/=60,r=0|e,n=e-r,e=t.v*(1-t.s),i=t.v*(1-t.s*n),n=t.v*(1-t.s*(1-n)),r){case 0:o.r=t.v,o.g=n,o.b=e;break;case 1:o.r=i,o.g=t.v,o.b=e;break;case 2:o.r=e,o.g=t.v,o.b=n;break;case 3:o.r=e,o.g=i,o.b=t.v;break;case 4:o.r=n,o.g=e,o.b=t.v;break;default:o.r=t.v,o.g=e,o.b=i}return o},cc.ControlUtils.CCRectUnion=function(t,e){return cc.rectUnion(t,e)},cc.Invocation=cc.Class.extend({_action:null,_target:null,_controlEvent:null,ctor:function(t,e,i){this._target=t,this._action=e,this._controlEvent=i},getAction:function(){return this._action},getTarget:function(){return this._target},getControlEvent:function(){return this._controlEvent},invoke:function(t){this._target&&this._action&&(cc.isString(this._action)?this._target[this._action](t,this._controlEvent):this._action.call(this._target,t,this._controlEvent))}}),cc.Scale9Sprite=cc.Node.extend({_spriteRect:null,_capInsetsInternal:null,_positionsAreDirty:!1,_scale9Image:null,_topLeft:null,_top:null,_topRight:null,_left:null,_centre:null,_right:null,_bottomLeft:null,_bottom:null,_bottomRight:null,_scale9Dirty:!0,_opacityModifyRGB:!1,_originalSize:null,_preferredSize:null,_opacity:0,_color:null,_capInsets:null,_insetLeft:0,_insetTop:0,_insetRight:0,_insetBottom:0,_spritesGenerated:!1,_spriteFrameRotated:!1,_textureLoaded:!1,_className:"Scale9Sprite",_flippedX:!1,_flippedY:!1,textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(t,e){this.addEventListener("load",t,e)},_updateCapInset:function(){var t;t=this._insetLeft;var e=this._insetTop,i=this._insetRight,n=this._spriteRect,r=this._insetBottom;t=0===t&&0===e&&0===i&&0===r?cc.rect(0,0,0,0):this._spriteFrameRotated?cc.rect(r,t,n.width-i-t,n.height-e-r):cc.rect(t,e,n.width-t-i,n.height-e-r),this.setCapInsets(t)},_updatePositions:function(){if(this._topLeft&&this._topRight&&this._bottomRight&&this._bottomLeft&&this._centre){var t=this._contentSize,e=this._topLeft,i=this._topRight,n=this._bottomRight,r=this._bottomLeft,o=this._centre,s=this._centre.getContentSize(),c=e.getContentSize(),a=r.getContentSize(),l=t.width-c.width-i.getContentSize().width,t=t.height-c.height-n.getContentSize().height,l=l/s.width,t=t/s.height,c=s.width*l,h=s.height*t,u=a.width,a=a.height;if(cc._renderType===cc._RENDER_TYPE_WEBGL){var d=Math.round(c);c!==d&&(c=d,l=c/s.width),d=Math.round(h),h!==d&&(h=d,t=h/s.height)}o.setScaleX(l),o.setScaleY(t);var s=this._left,d=this._right,_=this._top,p=this._bottom,f=cc.p(0,0);r.setAnchorPoint(f),n.setAnchorPoint(f),e.setAnchorPoint(f),i.setAnchorPoint(f),s.setAnchorPoint(f),d.setAnchorPoint(f),_.setAnchorPoint(f),p.setAnchorPoint(f),o.setAnchorPoint(f),r.setPosition(0,0),n.setPosition(u+c,0),e.setPosition(0,a+h),i.setPosition(u+c,a+h),s.setPosition(0,a),s.setScaleY(t),d.setPosition(u+c,a),d.setScaleY(t),p.setPosition(u,0),p.setScaleX(l),_.setPosition(u,a+h),_.setScaleX(l),o.setPosition(u,a)}},ctor:function(t,e,i){if(cc.Node.prototype.ctor.call(this),this._spriteRect=cc.rect(0,0,0,0),this._capInsetsInternal=cc.rect(0,0,0,0),this._originalSize=cc.size(0,0),this._preferredSize=cc.size(0,0),this._capInsets=cc.rect(0,0,0,0),void 0!=t)if(t instanceof cc.SpriteFrame)this.initWithSpriteFrame(t,e);else{var n=cc.spriteFrameCache.getSpriteFrame(t);null!=n?this.initWithSpriteFrame(n,e):this.initWithFile(t,e,i)}else this.init()},getSprite:function(){return this._scale9Image},getOriginalSize:function(){return cc.size(this._originalSize)},getPreferredSize:function(){return cc.size(this._preferredSize)},_getPreferredWidth:function(){return this._preferredSize.width},_getPreferredHeight:function(){return this._preferredSize.height},setPreferredSize:function(t){this.setContentSize(t),this._preferredSize=t,this._positionsAreDirty&&(this._updatePositions(),this._positionsAreDirty=!1,this._scale9Dirty=!0)},_setPreferredWidth:function(t){this._setWidth(t),this._preferredSize.width=t},_setPreferredHeight:function(t){this._setHeight(t),this._preferredSize.height=t},setOpacity:function(t){if(this._scale9Image){cc.Node.prototype.setOpacity.call(this,t);for(var e=this._scale9Image.getChildren(),i=0;i<e.length;i++){var n=e[i];n&&n.setOpacity(t)}this._scale9Dirty=!0}},setColor:function(t){if(this._scale9Image){cc.Node.prototype.setColor.call(this,t);for(var e=this._scale9Image.getChildren(),i=0;i<e.length;i++){var n=e[i];n&&n.setColor(t)}this._scale9Dirty=!0}},getCapInsets:function(){return cc.rect(this._capInsets)},setCapInsets:function(t){if(this._scale9Image){var e=this._contentSize,i=e.width,e=e.height;this.updateWithBatchNode(this._scale9Image,this._spriteRect,this._spriteFrameRotated,t),this.setContentSize(i,e)}},getInsetLeft:function(){return this._insetLeft},setInsetLeft:function(t){this._insetLeft=t,this._updateCapInset()},getInsetTop:function(){return this._insetTop},setInsetTop:function(t){this._insetTop=t,this._updateCapInset()},getInsetRight:function(){return this._insetRight},setInsetRight:function(t){this._insetRight=t,this._updateCapInset()},getInsetBottom:function(){return this._insetBottom},setInsetBottom:function(t){this._insetBottom=t,this._updateCapInset()},setContentSize:function(t,e){cc.Node.prototype.setContentSize.call(this,t,e),this._positionsAreDirty=!0},_setWidth:function(t){cc.Node.prototype._setWidth.call(this,t),this._positionsAreDirty=!0},_setHeight:function(t){cc.Node.prototype._setHeight.call(this,t),this._positionsAreDirty=!0},init:function(){return this.initWithBatchNode(null,cc.rect(0,0,0,0),!1,cc.rect(0,0,0,0))},initWithBatchNode:function(t,e,i,n){return void 0===n&&(n=i,i=!1),t&&this.updateWithBatchNode(t,e,i,n),this.setCascadeColorEnabled(!0),this.setCascadeOpacityEnabled(!0),this.setAnchorPoint(.5,.5),this._positionsAreDirty=!0},initWithFile:function(t,e,i){if(t instanceof cc.Rect?(i=t=e,e=cc.rect(0,0,0,0)):(e=e||cc.rect(0,0,0,0),i=i||cc.rect(0,0,0,0)),!t)throw"cc.Scale9Sprite.initWithFile(): file should be non-null";var n=cc.textureCache.getTextureForKey(t);n||(n=cc.textureCache.addImage(t));var r=n.isLoaded();return(this._textureLoaded=r)||n.addEventListener("load",function(t){var e=this._preferredSize,i=0!==e.width&&0!==e.height;i&&(e=cc.size(e.width,e.height)),t=t.getContentSize(),this.updateWithBatchNode(this._scale9Image,cc.rect(0,0,t.width,t.height),!1,this._capInsets),i&&this.setPreferredSize(e),this._positionsAreDirty=!0,this.dispatchEvent("load")},this),this.initWithBatchNode(new cc.SpriteBatchNode(t,9),e,!1,i)},initWithSpriteFrame:function(t,e){if(!t||!t.getTexture())throw"cc.Scale9Sprite.initWithSpriteFrame(): spriteFrame should be non-null and its texture should be non-null";e=e||cc.rect(0,0,0,0);var i=t.textureLoaded();return(this._textureLoaded=i)||t.addEventListener("load",function(t){var e=this._preferredSize,i=0!==e.width&&0!==e.height;i&&(e=cc.size(e.width,e.height)),this.updateWithBatchNode(this._scale9Image,t.getRect(),cc._renderType===cc._RENDER_TYPE_WEBGL&&t.isRotated(),this._capInsets),i&&this.setPreferredSize(e),this._positionsAreDirty=!0,this.dispatchEvent("load")},this),i=new cc.SpriteBatchNode(t.getTexture(),9),this.initWithBatchNode(i,t.getRect(),cc._renderType===cc._RENDER_TYPE_WEBGL&&t.isRotated(),e)},initWithSpriteFrameName:function(t,e){if(!t)throw"cc.Scale9Sprite.initWithSpriteFrameName(): spriteFrameName should be non-null";e=e||cc.rect(0,0,0,0);var i=cc.spriteFrameCache.getSpriteFrame(t);return null==i?(cc.log("cc.Scale9Sprite.initWithSpriteFrameName(): can't find the sprite frame by spriteFrameName"),!1):this.initWithSpriteFrame(i,e)},resizableSpriteWithCapInsets:function(t){var e=new cc.Scale9Sprite;return e&&e.initWithBatchNode(this._scale9Image,this._spriteRect,!1,t)?e:null},setOpacityModifyRGB:function(t){if(this._scale9Image){this._opacityModifyRGB=t;var e=this._scale9Image.getChildren();if(e)for(var i=0,n=e.length;n>i;i++)e[i].setOpacityModifyRGB(t)}},isOpacityModifyRGB:function(){return this._opacityModifyRGB},updateWithBatchNode:function(t,e,i,n){var r=this.getOpacity(),o=this.getColor();if(e=cc.rect(e.x,e.y,e.width,e.height),this.removeAllChildren(!0),this._scale9Image!==t&&(this._scale9Image=t),!this._scale9Image)return!1;t=t.getTexture();var s=t.isLoaded();this._textureLoaded=s;var c=this._capInsets;if(c.x=n.x,c.y=n.y,c.width=n.width,c.height=n.height,!s)return t.addEventListener("load",function(){this._positionsAreDirty=!0,this.dispatchEvent("load")},this),!0;t=this._scale9Image,t.removeAllChildren(!0),this._spriteFrameRotated=i,s=t.getTexture(),cc._rectEqualToZero(e)&&(e=s.getContentSize(),e=cc.rect(0,0,e.width,e.height)),c=this._spriteRect=e,c.x=e.x,c.y=e.y,c.width=e.width,c.height=e.height,this._originalSize.width=e.width,this._originalSize.height=e.height,c=this._preferredSize,0===c.width&&0===c.height&&(c.width=e.width,c.height=e.height),c=this._capInsetsInternal,n&&(c.x=n.x,c.y=n.y,c.width=n.width,c.height=n.height);var a=e.width;n=e.height,cc._rectEqualToZero(c)&&(c.x=a/3,c.y=n/3,c.width=a/3,c.height=n/3);var l=c.x,h=c.width,u=a-(l+h),d=c.y,_=c.height,p=n-(d+_),f=0,m=0;n=cc.rect(f+.5|0,m+.5|0,l+.5|0,d+.5|0);var f=f+l,c=cc.rect(f+.5|0,m+.5|0,h+.5|0,d+.5|0),a=cc.rect(f+h+.5|0,m+.5|0,u+.5|0,d+.5|0),f=0,m=0+d,g=cc.rect(f+.5|0,m+.5|0,l+.5|0,_+.5|0),f=f+l,y=cc.rect(f+.5|0,m+.5|0,h+.5|0,_+.5|0),f=f+h,T=cc.rect(f+.5|0,m+.5|0,u+.5|0,_+.5|0),f=0,m=0+d+_,d=cc.rect(f+.5|0,m+.5|0,l+.5|0,p+.5|0),f=f+l,l=cc.rect(f+.5|0,m+.5|0,h+.5|0,p+.5|0),f=f+h,h=cc.rect(f+.5|0,m+.5|0,u+.5|0,p+.5|0),u=cc.affineTransformMakeIdentity();if(i){i=y;var p=h,f=d,m=a,_=n,S=T,C=g,v=l,x=c,u=cc.affineTransformTranslate(u,e.height+e.x,e.y),u=cc.affineTransformRotate(u,1.57079633),y=cc.rectApplyAffineTransform(y,u),h=cc.rectApplyAffineTransform(h,u),d=cc.rectApplyAffineTransform(d,u),a=cc.rectApplyAffineTransform(a,u);n=cc.rectApplyAffineTransform(n,u),T=cc.rectApplyAffineTransform(T,u),g=cc.rectApplyAffineTransform(g,u),l=cc.rectApplyAffineTransform(l,u),c=cc.rectApplyAffineTransform(c,u),i.x=y.x,i.y=y.y,p.x=h.x,p.y=h.y,f.x=d.x,f.y=d.y,m.x=a.x,m.y=a.y,_.x=n.x,_.y=n.y,S.x=T.x,S.y=T.y,C.x=g.x,C.y=g.y,v.x=l.x,v.y=l.y,x.x=c.x,x.y=c.y,this._centre=new cc.Sprite,this._centre.initWithTexture(s,i,!0),t.addChild(this._centre,0,cc.Scale9Sprite.POSITIONS_CENTRE),this._top=new cc.Sprite,this._top.initWithTexture(s,x,!0),t.addChild(this._top,1,cc.Scale9Sprite.POSITIONS_TOP),this._bottom=new cc.Sprite,this._bottom.initWithTexture(s,v,!0),t.addChild(this._bottom,1,cc.Scale9Sprite.POSITIONS_BOTTOM),this._left=new cc.Sprite,this._left.initWithTexture(s,C,!0),t.addChild(this._left,1,cc.Scale9Sprite.POSITIONS_LEFT),this._right=new cc.Sprite,this._right.initWithTexture(s,S,!0),t.addChild(this._right,1,cc.Scale9Sprite.POSITIONS_RIGHT),this._topLeft=new cc.Sprite,this._topLeft.initWithTexture(s,_,!0),t.addChild(this._topLeft,2,cc.Scale9Sprite.POSITIONS_TOPLEFT),this._topRight=new cc.Sprite,this._topRight.initWithTexture(s,m,!0),t.addChild(this._topRight,2,cc.Scale9Sprite.POSITIONS_TOPRIGHT),this._bottomLeft=new cc.Sprite,this._bottomLeft.initWithTexture(s,f,!0),t.addChild(this._bottomLeft,2,cc.Scale9Sprite.POSITIONS_BOTTOMLEFT),this._bottomRight=new cc.Sprite,this._bottomRight.initWithTexture(s,p,!0)}else u=cc.affineTransformTranslate(u,e.x,e.y),cc._rectApplyAffineTransformIn(y,u),cc._rectApplyAffineTransformIn(h,u),cc._rectApplyAffineTransformIn(d,u),cc._rectApplyAffineTransformIn(a,u),cc._rectApplyAffineTransformIn(n,u),cc._rectApplyAffineTransformIn(T,u),cc._rectApplyAffineTransformIn(g,u),cc._rectApplyAffineTransformIn(l,u),cc._rectApplyAffineTransformIn(c,u),this._centre=new cc.Sprite,this._centre.initWithTexture(s,y),t.addChild(this._centre,0,cc.Scale9Sprite.POSITIONS_CENTRE),this._top=new cc.Sprite,this._top.initWithTexture(s,c),t.addChild(this._top,1,cc.Scale9Sprite.POSITIONS_TOP),this._bottom=new cc.Sprite,this._bottom.initWithTexture(s,l),t.addChild(this._bottom,1,cc.Scale9Sprite.POSITIONS_BOTTOM),this._left=new cc.Sprite,this._left.initWithTexture(s,g),t.addChild(this._left,1,cc.Scale9Sprite.POSITIONS_LEFT),this._right=new cc.Sprite,this._right.initWithTexture(s,T),t.addChild(this._right,1,cc.Scale9Sprite.POSITIONS_RIGHT),this._topLeft=new cc.Sprite,this._topLeft.initWithTexture(s,n),t.addChild(this._topLeft,2,cc.Scale9Sprite.POSITIONS_TOPLEFT),this._topRight=new cc.Sprite,this._topRight.initWithTexture(s,a),t.addChild(this._topRight,2,cc.Scale9Sprite.POSITIONS_TOPRIGHT),this._bottomLeft=new cc.Sprite,this._bottomLeft.initWithTexture(s,d),t.addChild(this._bottomLeft,2,cc.Scale9Sprite.POSITIONS_BOTTOMLEFT),this._bottomRight=new cc.Sprite,this._bottomRight.initWithTexture(s,h);return t.addChild(this._bottomRight,2,cc.Scale9Sprite.POSITIONS_BOTTOMRIGHT),this.setContentSize(e.width,e.height),cc._renderType===cc._RENDER_TYPE_WEBGL&&this.addChild(t),this._spritesGenerated&&(this.setOpacity(r),this.setColor(o)),this._spritesGenerated=!0},setSpriteFrame:function(t){var e=new cc.SpriteBatchNode(t.getTexture(),9),i=t.textureLoaded();(this._textureLoaded=i)||t.addEventListener("load",function(t){var e=this._preferredSize,i=0!==e.width&&0!==e.height;i&&(e=cc.size(e.width,e.height)),this.updateWithBatchNode(this._scale9Image,t.getRect(),cc._renderType===cc._RENDER_TYPE_WEBGL&&t.isRotated(),this._capInsets),i&&this.setPreferredSize(e),this._positionsAreDirty=!0,this.dispatchEvent("load")},this),this.updateWithBatchNode(e,t.getRect(),cc._renderType===cc._RENDER_TYPE_WEBGL&&t.isRotated(),cc.rect(0,0,0,0)),this._insetBottom=this._insetRight=this._insetTop=this._insetLeft=0},setState:function(t){this._renderCmd.setState(t)},setFlippedX:function(t){var e=this.getScaleX();this._flippedX=t,this.setScaleX(e)},isFlippedX:function(){return this._flippedX},setFlippedY:function(t){var e=this.getScaleY();this._flippedY=t,this.setScaleY(e)},isFlippedY:function(){return this._flippedY},setScaleX:function(t){this._flippedX&&(t*=-1),cc.Node.prototype.setScaleX.call(this,t)},setScaleY:function(t){this._flippedY&&(t*=-1),cc.Node.prototype.setScaleY.call(this,t)},setScale:function(t,e){void 0===e&&(e=t),this.setScaleX(t),this.setScaleY(e)},getScaleX:function(){var t=cc.Node.prototype.getScaleX.call(this);return this._flippedX&&(t*=-1),t},getScaleY:function(){var t=cc.Node.prototype.getScaleY.call(this);return this._flippedY&&(t*=-1),t},getScale:function(){return this.getScaleX()!==this.getScaleY()&&cc.log("Scale9Sprite#scale. ScaleX != ScaleY. Don't know which one to return"),this.getScaleX()},_createRenderCmd:function(){return cc._renderType===cc._RENDER_TYPE_CANVAS?new cc.Scale9Sprite.CanvasRenderCmd(this):new cc.Scale9Sprite.WebGLRenderCmd(this)}}),_p=cc.Scale9Sprite.prototype,cc.EventHelper.prototype.apply(_p),cc.defineGetterSetter(_p,"preferredSize",_p.getPreferredSize,_p.setPreferredSize),cc.defineGetterSetter(_p,"capInsets",_p.getCapInsets,_p.setCapInsets),cc.defineGetterSetter(_p,"insetLeft",_p.getInsetLeft,_p.setInsetLeft),cc.defineGetterSetter(_p,"insetTop",_p.getInsetTop,_p.setInsetTop),cc.defineGetterSetter(_p,"insetRight",_p.getInsetRight,_p.setInsetRight),cc.defineGetterSetter(_p,"insetBottom",_p.getInsetBottom,_p.setInsetBottom),_p=null,cc.Scale9Sprite.create=function(t,e,i){return new cc.Scale9Sprite(t,e,i)},cc.Scale9Sprite.createWithSpriteFrame=function(t,e){return new cc.Scale9Sprite(t,e)},cc.Scale9Sprite.createWithSpriteFrameName=function(t,e){return new cc.Scale9Sprite(t,e)},cc.Scale9Sprite.POSITIONS_CENTRE=0,cc.Scale9Sprite.POSITIONS_TOP=1,cc.Scale9Sprite.POSITIONS_LEFT=2,cc.Scale9Sprite.POSITIONS_RIGHT=3,cc.Scale9Sprite.POSITIONS_BOTTOM=4,cc.Scale9Sprite.POSITIONS_TOPRIGHT=5,cc.Scale9Sprite.POSITIONS_TOPLEFT=6,cc.Scale9Sprite.POSITIONS_BOTTOMRIGHT=7,cc.Scale9Sprite.state={NORMAL:0,GRAY:1},function(){cc.Scale9Sprite.CanvasRenderCmd=function(t){cc.Node.CanvasRenderCmd.call(this,t),this._cachedParent=null,this._cacheDirty=!1,this._state=cc.Scale9Sprite.state.NORMAL,t=this._node;var e=this._cacheCanvas=cc.newElement("canvas");e.width=1,e.height=1,this._cacheContext=new cc.CanvasContextWrapper(e.getContext("2d"));var i=this._cacheTexture=new cc.Texture2D;i.initWithElement(e),i.handleLoadedTexture(),this._cacheSprite=new cc.Sprite(i),this._cacheSprite.setAnchorPoint(0,0),t.addChild(this._cacheSprite)};var t=cc.Scale9Sprite.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);t.constructor=cc.Scale9Sprite.CanvasRenderCmd,t.visit=function(t){var e=this._node;e._visible&&(e._positionsAreDirty&&(e._updatePositions(),e._positionsAreDirty=!1,e._scale9Dirty=!0),e._scale9Dirty=!1,this._cacheScale9Sprite(),cc.Node.CanvasRenderCmd.prototype.visit.call(this,t))},t.transform=function(t){var e=this._node;for(cc.Node.CanvasRenderCmd.prototype.transform.call(this,t),e._positionsAreDirty&&(e._updatePositions(),e._positionsAreDirty=!1,e._scale9Dirty=!0),this._cacheScale9Sprite(),t=e._children,e=0;e<t.length;e++)t[e].transform(this,!0)},t._updateDisplayColor=function(t){cc.Node.CanvasRenderCmd.prototype._updateDisplayColor.call(this,t);var e=this._node._scale9Image;if(e){for(var e=e.getChildren(),i=0;i<e.length;i++){var n=e[i];n&&(n._renderCmd._updateDisplayColor(t),n._renderCmd._updateColor())}this._cacheScale9Sprite()}},t._cacheScale9Sprite=function(){var t=this._node;if(t._scale9Image){var e=cc.contentScaleFactor(),i=t._contentSize,n=cc.size(i.width*e,i.height*e),r=this._cacheCanvas,o=this._cacheContext,s=o.getContext(),c=!1;(r.width!==n.width||r.height!==n.height)&&(r.width=n.width,r.height=n.height,c=!0),cc.renderer._turnToCacheMode(t.__instanceId),t._scale9Image.visit(),(r=t._scale9Image.getTexture())&&this._state===cc.Scale9Sprite.state.GRAY&&r._switchToGray(!0),s.setTransform(1,0,0,1,0,0),s.clearRect(0,0,n.width,n.height),cc.renderer._renderingToCacheCanvas(o,t.__instanceId,e,e),r&&this._state===cc.Scale9Sprite.state.GRAY&&r._switchToGray(!1),c&&this._cacheSprite.setTextureRect(cc.rect(0,0,i.width,i.height)),this._cacheSprite.getParent()||t.addChild(this._cacheSprite,-1)}},t.setState=function(t){this._node._scale9Image&&(this._state=t,this._cacheScale9Sprite())}}(),function(){cc.Scale9Sprite.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t),this._cachedParent=null,this._cacheDirty=!1};var t=cc.Scale9Sprite.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);t.constructor=cc.Scale9Sprite.WebGLRenderCmd,t.visit=function(t){var e=this._node;e._visible&&(e._positionsAreDirty&&(e._updatePositions(),e._positionsAreDirty=!1,e._scale9Dirty=!0),cc.Node.WebGLRenderCmd.prototype.visit.call(this,t))},t.transform=function(t,e){var i=this._node;cc.Node.WebGLRenderCmd.prototype.transform.call(this,t,e),i._positionsAreDirty&&(i._updatePositions(),i._positionsAreDirty=!1,i._scale9Dirty=!0)},t._updateDisplayColor=function(t){cc.Node.WebGLRenderCmd.prototype._updateDisplayColor.call(this,t);var e=this._node._scale9Image;if(e)for(var e=e.getChildren(),i=0;i<e.length;i++){var n=e[i];n&&(n._renderCmd._updateDisplayColor(t),n._renderCmd._updateColor())}},t._updateDisplayOpacity=function(t){cc.Node.WebGLRenderCmd.prototype._updateDisplayOpacity.call(this,t);var e=this._node._scale9Image;if(e)for(var e=e.getChildren(),i=0;i<e.length;i++){var n=e[i];n&&(n._renderCmd._updateDisplayOpacity(t),n._renderCmd._updateColor())}},t.setState=function(t){var e=this._node._scale9Image;null!==e&&(t===cc.Scale9Sprite.state.NORMAL?e.setShaderProgram(cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURECOLOR)):t===cc.Scale9Sprite.state.GRAY&&e.setShaderProgram(cc.Scale9Sprite.WebGLRenderCmd._getGrayShaderProgram()))},cc.Scale9Sprite.WebGLRenderCmd._grayShaderProgram=null,cc.Scale9Sprite.WebGLRenderCmd._getGrayShaderProgram=function(){var t=cc.Scale9Sprite.WebGLRenderCmd._grayShaderProgram;return t?t:(t=new cc.GLProgram,t.initWithVertexShaderByteArray(cc.SHADER_POSITION_TEXTURE_COLOR_VERT,cc.Scale9Sprite.WebGLRenderCmd._grayShaderFragment),t.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),t.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR),t.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS),t.link(),t.updateUniforms(),cc.Scale9Sprite.WebGLRenderCmd._grayShaderProgram=t)},cc.Scale9Sprite.WebGLRenderCmd._grayShaderFragment="precision lowp float;\nvarying vec4 v_fragmentColor; \nvarying vec2 v_texCoord; \nvoid main() \n{ \n    vec4 c = texture2D(CC_Texture0, v_texCoord); \n    gl_FragColor.xyz = vec3(0.2126*c.r + 0.7152*c.g + 0.0722*c.b); \n     gl_FragColor.w = c.w ; \n}"}(),cc.Spacer=cc.Layer.extend({}),cc.Spacer.verticalSpacer=function(t){var e=new cc.Spacer;return e.init(),e.setContentSize(0,t),e},cc.Spacer.horizontalSpacer=function(t){var e=new cc.Spacer;return e.init(),e.setContentSize(t,0),e},cc.MenuPassive=cc.Layer.extend({_color:null,_opacity:0,_className:"MenuPassive",ctor:function(){},getColor:function(){var t=this._color;return cc.color(t.r,t.g,t.b,t.a)},setColor:function(t){var e=this._color;if(e.r=t.r,e.g=t.g,e.b=t.b,this._children&&0<this._children.length)for(e=0;e<this._children.length;e++)this._children[e]&&this._children[e].setColor(t);void 0===t.a||t.a_undefined||this.setOpacity(t.a)},getOpacity:function(){return this._opacity},setOpacity:function(t){if(this._opacity=t,this._children&&0<this._children.length)for(var e=0;e<this._children.length;e++)this._children[e]&&this._children[e].setOpacity(t);this._color.a=t},initWithItems:function(t,e){if(this.init()){var i=cc.director.getWinSize();if(this.ignoreAnchorPointForPosition(!0),this.setAnchorPoint(.5,.5),this.setContentSize(i),this.setPosition(i.width/2,i.height/2),i=0,t){this.addChild(t,i);for(var n=0;n<e.length;n++)e[n]&&(i++,this.addChild(e[n],i))}return!0}return!1},alignItemsVertically:function(){this.alignItemsVerticallyWithPadding(cc.DEFAULT_PADDING)},alignItemsVerticallyWithPadding:function(t){var e,i=-t;if(this._children&&0<this._children.length)for(e=0;e<this._children.length;e++)this._children[e]&&(i+=this._children[e].getContentSize().height*this._children[e].getScaleY()+t);var n=0,r=i/2;if(this._children&&0<this._children.length)for(e=0;e<this._children.length;e++)this._children[e]&&(n=Math.max(n,this._children[e].getContentSize().width),this._children[e].setPosition(0,r-this._children[e].getContentSize().height*this._children[e].getScaleY()/2),r-=this._children[e].getContentSize().height*this._children[e].getScaleY()+t);this.setContentSize(n,i)},alignItemsHorizontally:function(){this.alignItemsHorizontallyWithPadding(cc.DEFAULT_PADDING)},alignItemsHorizontallyWithPadding:function(t){var e,i=-t;if(this._children&&0<this._children.length)for(e=0;e<this._children.length;e++)this._children[e]&&(i+=this._children[e].getContentSize().width*this._children[e].getScaleX()+t);var n=0,r=-i/2;if(this._children&&0<this._children.length)for(e=0;e<this._children.length;e++)this._children[e]&&(n=Math.max(n,this._children[e].getContentSize().height),this._children[e].setPosition(r+this._children[e].getContentSize().width*this._children[e].getScaleX()/2,0),r+=this._children[e].getContentSize().width*this._children[e].getScaleX()+t);this.setContentSize(i,n)},alignItemsInColumns:function(){var t,e=[];for(t=1;t<arguments.length;t++)e.push(arguments[t]);var i,n,r=-5,o=0,s=0,c=0;if(this._children&&0<this._children.length)for(t=0;t<this._children.length;t++)this._children[t]&&(o>=e.length?cc.log("cc.MenuPassive.alignItemsInColumns(): invalid row index"):(i=e[o])?(n=this._children[t].getContentSize().height,s=0|(s>=n||null==n?s:n),++c,c>=i&&(r+=s+5,s=c=0,++o)):cc.log("cc.MenuPassive.alignItemsInColumns(): can not have zero columns on a row"));var a=cc.director.getWinSize(),l=i=s=o=0,h=0,r=r/2;if(this._children&&0<this._children.length)for(t=0;t<this._children.length;t++)this._children[t]&&(0===i&&(i=e[o],h=l=a.width/(1+i)),n=this._children[t].getContentSize().height,s=0|(s>=n||null==n?s:n),this._children[t].setPosition(h-a.width/2,r-this._children[t].getContentSize().height/2),h+=l,++c,c>=i&&(r-=s+5,s=i=c=0,++o))},alignItemsInRows:function(){var t,e=[];for(t=1;t<arguments.length;t++)e.push(arguments[t]);var i,n,r=[],o=[],s=-10,c=-5,a=0,l=0,h=0;if(this._children&&0<this._children.length)for(t=0;t<this._children.length;t++)this._children[t]&&(a>=e.length?cc.log("cc.MenuPassive.alignItemsInRows(): invalid row index"):(i=e[a])?(n=this._children[t].getContentSize().width,l=0|(l>=n||null==n?l:n),c+=0|this._children[t].getContentSize().height+5,++h,h>=i&&(r.push(l),o.push(c),s+=l+10,l=h=0,c=-5,++a)):cc.log("cc.MenuPassive.alignItemsInColumns(): can't have zero rows on a column"));c=cc.director.getWinSize(),l=a=0,i=null;var s=-s/2,u=0;if(this._children&&0<this._children.length)for(t=0;t<this._children.length;t++)this._children[t]&&(null==i&&(i=e[a],u=o[a]),n=this._children[t].getContentSize().width,l=0|(l>=n||null==n?l:n),this._children[t].setPosition(s+r[a]/2,u-c.height/2),u-=this._children[t].getContentSize().height+10,++h,h>=i&&(s+=l+5,l=i=h=0,++a))},setOpacityModifyRGB:function(){},isOpacityModifyRGB:function(){return!1}}),cc.MenuPassive.create=function(t){t||(t=null);for(var e=[],i=1;i<arguments.length;i++)e.push(arguments[i]);return(i=new cc.MenuPassive)&&i.initWithItems(t,e)?i:null},cc.MenuPassive.createWithItem=function(t){return cc.MenuPassive.create(t,null)},cc.ControlSaturationBrightnessPicker=cc.Control.extend({_saturation:0,_brightness:0,_background:null,_overlay:null,_shadow:null,_slider:null,_startPos:null,_boxPos:0,_boxSize:0,_className:"ControlSaturationBrightnessPicker",ctor:function(t,e){cc.Control.prototype.ctor.call(this),e&&this.initWithTargetAndPos(t,e)},getSaturation:function(){return this._saturation},getBrightness:function(){return this._brightness},getBackground:function(){return this._background},getOverlay:function(){return this._brightness},getShadow:function(){return this._shadow},getSlider:function(){return this._slider},getStartPos:function(){return this._startPos},initWithTargetAndPos:function(t,e){return cc.Control.prototype.init.call(this)?(this._background=cc.ControlUtils.addSpriteToTargetWithPosAndAnchor("colourPickerBackground.png",t,e,cc.p(0,0)),this._overlay=cc.ControlUtils.addSpriteToTargetWithPosAndAnchor("colourPickerOverlay.png",t,e,cc.p(0,0)),this._shadow=cc.ControlUtils.addSpriteToTargetWithPosAndAnchor("colourPickerShadow.png",t,e,cc.p(0,0)),this._slider=cc.ControlUtils.addSpriteToTargetWithPosAndAnchor("colourPicker.png",t,e,cc.p(.5,.5)),this._startPos=e,this._boxPos=35,this._boxSize=this._background.getContentSize().width/2,!0):!1},setEnabled:function(t){cc.Control.prototype.setEnabled.call(this,t),this._slider&&this._slider.setOpacity(t?255:128)},updateWithHSV:function(t){var e=new cc.HSV;e.s=1,e.h=t.h,e.v=1,t=cc.ControlUtils.RGBfromHSV(e),this._background.setColor(cc.color(0|255*t.r,0|255*t.g,0|255*t.b))},updateDraggerWithHSV:function(t){t=cc.p(this._startPos.x+this._boxPos+this._boxSize*(1-t.s),this._startPos.y+this._boxPos+this._boxSize*t.v),this._updateSliderPosition(t)},_updateSliderPosition:function(t){var e=this._startPos.x+.5*this._background.getBoundingBox().width,i=this._startPos.y+.5*this._background.getBoundingBox().height,n=t.x-e,r=t.y-i,o=Math.sqrt(n*n+r*r),n=Math.atan2(r,n),r=.5*this._background.getBoundingBox().width;o>r&&(t.x=e+r*Math.cos(n),t.y=i+r*Math.sin(n)),this._slider.setPosition(t),t.x<this._startPos.x+this._boxPos?t.x=this._startPos.x+this._boxPos:t.x>this._startPos.x+this._boxPos+this._boxSize-1&&(t.x=this._startPos.x+this._boxPos+this._boxSize-1),t.y<this._startPos.y+this._boxPos?t.y=this._startPos.y+this._boxPos:t.y>this._startPos.y+this._boxPos+this._boxSize&&(t.y=this._startPos.y+this._boxPos+this._boxSize),this._saturation=1-Math.abs((this._startPos.x+this._boxPos-t.x)/this._boxSize),this._brightness=Math.abs((this._startPos.y+this._boxPos-t.y)/this._boxSize)},_checkSliderPosition:function(t){var e=this._startPos.x+.5*this._background.getBoundingBox().width,i=this._startPos.y+.5*this._background.getBoundingBox().height,e=t.x-e,i=t.y-i;return Math.sqrt(e*e+i*i)<=.5*this._background.getBoundingBox().width?(this._updateSliderPosition(t),this.sendActionsForControlEvents(cc.CONTROL_EVENT_VALUECHANGED),!0):!1},onTouchBegan:function(t){if(!this.isEnabled()||!this.isVisible())return!1;var e=this.getTouchLocation(t);return this._checkSliderPosition(e)},onTouchMoved:function(t){var e=this.getTouchLocation(t);this._checkSliderPosition(e)}}),_p=cc.ControlSaturationBrightnessPicker.prototype,cc.defineGetterSetter(_p,"saturation",_p.getSaturation),cc.defineGetterSetter(_p,"brightness",_p.getBrightness),cc.defineGetterSetter(_p,"background",_p.getBackground),cc.defineGetterSetter(_p,"overlay",_p.getOverlay),cc.defineGetterSetter(_p,"shadow",_p.getShadow),cc.defineGetterSetter(_p,"slider",_p.getSlider),cc.defineGetterSetter(_p,"startPos",_p.getStartPos),_p=null,cc.ControlSaturationBrightnessPicker.create=function(t,e){return new cc.ControlSaturationBrightnessPicker(t,e)
},cc.ControlHuePicker=cc.Control.extend({_hue:0,_huePercentage:0,_background:null,_slider:null,_startPos:null,_className:"ControlHuePicker",ctor:function(t,e){cc.Control.prototype.ctor.call(this),e&&this.initWithTargetAndPos(t,e)},getHue:function(){return this._hue},setHue:function(t){this._hue=t,this.setHuePercentage(this._hue/360)},getHuePercentage:function(){return this._huePercentage},setHuePercentage:function(t){this._huePercentage=t,this._hue=360*this._huePercentage;var e=this._background.getBoundingBox(),i=this._startPos.x+.5*e.width;t=this._startPos.y+.5*e.height;var e=.5*e.width-15,n=cc.degreesToRadians(360*this._huePercentage-180),i=i+e*Math.cos(n);t+=e*Math.sin(n),this._slider.setPosition(i,t)},setEnabled:function(t){cc.Control.prototype.setEnabled.call(this,t),this._slider&&this._slider.setOpacity(t?255:128)},getBackground:function(){return this._background},getSlider:function(){return this._slider},getStartPos:function(){return this._startPos},initWithTargetAndPos:function(t,e){return cc.Control.prototype.init.call(this)?(this._background=cc.ControlUtils.addSpriteToTargetWithPosAndAnchor("huePickerBackground.png",t,e,cc.p(0,0)),this._slider=cc.ControlUtils.addSpriteToTargetWithPosAndAnchor("colourPicker.png",t,e,cc.p(.5,.5)),this._slider.setPosition(e.x,e.y+.5*this._background.getBoundingBox().height),this._startPos=e,this._huePercentage=this._hue=0,!0):!1},_updateSliderPosition:function(t){var e=this._background.getBoundingBox();t=Math.atan2(t.y-(this._startPos.y+.5*e.height),t.x-(this._startPos.x+.5*e.width)),t=cc.radiansToDegrees(t)+180,this.setHue(t),this.sendActionsForControlEvents(cc.CONTROL_EVENT_VALUECHANGED)},_checkSliderPosition:function(t){var e=Math.sqrt(Math.pow(t.x+10,2)+Math.pow(t.y,2));return 80>e&&e>59?(this._updateSliderPosition(t),!0):!1},onTouchBegan:function(t){if(!this.isEnabled()||!this.isVisible())return!1;var e=this.getTouchLocation(t);return this._checkSliderPosition(e)},onTouchMoved:function(t){var e=this.getTouchLocation(t);this._checkSliderPosition(e)}}),_p=cc.ControlHuePicker.prototype,cc.defineGetterSetter(_p,"hue",_p.getHue,_p.setHue),cc.defineGetterSetter(_p,"huePercent",_p.getHuePercentage,_p.setHuePercentage),cc.defineGetterSetter(_p,"background",_p.getBackground),cc.defineGetterSetter(_p,"slider",_p.getSlider),cc.defineGetterSetter(_p,"startPos",_p.getStartPos),_p=null,cc.ControlHuePicker.create=function(t,e){return new cc.ControlHuePicker(t,e)},cc.ControlColourPicker=cc.Control.extend({_hsv:null,_colourPicker:null,_huePicker:null,_background:null,_className:"ControlColourPicker",ctor:function(){cc.Control.prototype.ctor.call(this),this.init()},hueSliderValueChanged:function(t){this._hsv.h=t.getHue();var e=cc.ControlUtils.RGBfromHSV(this._hsv);cc.Control.prototype.setColor.call(this,cc.color(0|255*e.r,0|255*e.g,0|255*e.b)),this.sendActionsForControlEvents(cc.CONTROL_EVENT_VALUECHANGED),this._updateControlPicker()},colourSliderValueChanged:function(t){this._hsv.s=t.getSaturation(),this._hsv.v=t.getBrightness();var e=cc.ControlUtils.RGBfromHSV(this._hsv);cc.Control.prototype.setColor.call(this,cc.color(0|255*e.r,0|255*e.g,0|255*e.b)),this.sendActionsForControlEvents(cc.CONTROL_EVENT_VALUECHANGED)},setColor:function(t){cc.Control.prototype.setColor.call(this,t);var e=new cc.RGBA;e.r=t.r/255,e.g=t.g/255,e.b=t.b/255,e.a=1,this._hsv=cc.ControlUtils.HSVfromRGB(e),this._updateHueAndControlPicker()},getBackground:function(){return this._background},init:function(){if(cc.Control.prototype.init.call(this)){cc.spriteFrameCache.addSpriteFrames(res.CCControlColourPickerSpriteSheet_plist);var t=new cc.SpriteBatchNode(res.CCControlColourPickerSpriteSheet_png);this.addChild(t),this._hsv=new cc.HSV(0,0,0),this._background=cc.ControlUtils.addSpriteToTargetWithPosAndAnchor("menuColourPanelBackground.png",t,cc.p(0,0),cc.p(.5,.5));var e=cc.pSub(this._background.getPosition(),cc.p(this._background.getContentSize().width/2,this._background.getContentSize().height/2));return this._huePicker=new cc.ControlHuePicker(t,cc.p(e.x+8,e.y+8)),this._colourPicker=new cc.ControlSaturationBrightnessPicker(t,cc.p(e.x+28,e.y+28)),this._huePicker.addTargetWithActionForControlEvents(this,this.hueSliderValueChanged,cc.CONTROL_EVENT_VALUECHANGED),this._colourPicker.addTargetWithActionForControlEvents(this,this.colourSliderValueChanged,cc.CONTROL_EVENT_VALUECHANGED),this._updateHueAndControlPicker(),this.addChild(this._huePicker),this.addChild(this._colourPicker),this.setContentSize(this._background.getContentSize()),!0}return!1},_updateControlPicker:function(){this._huePicker.setHue(this._hsv.h),this._colourPicker.updateWithHSV(this._hsv)},_updateHueAndControlPicker:function(){this._huePicker.setHue(this._hsv.h),this._colourPicker.updateWithHSV(this._hsv),this._colourPicker.updateDraggerWithHSV(this._hsv)},setEnabled:function(t){cc.Control.prototype.setEnabled.call(this,t),null!==this._huePicker&&this._huePicker.setEnabled(t),this._colourPicker&&this._colourPicker.setEnabled(t)},onTouchBegan:function(){return!1}}),_p=cc.ControlColourPicker.prototype,cc.defineGetterSetter(_p,"background",_p.getBackground),_p=null,cc.ControlColourPicker.create=function(){return new cc.ControlColourPicker};var res=res||{};res.CCControlColourPickerSpriteSheet_plist=res.CCControlColourPickerSpriteSheet_plist||"res/extensions/CCControlColourPickerSpriteSheet.plist",res.CCControlColourPickerSpriteSheet_png=res.CCControlColourPickerSpriteSheet_png||"res/extensions/CCControlColourPickerSpriteSheet.png",cc.SLIDER_MARGIN_H=24,cc.SLIDER_MARGIN_V=8,cc.ControlSlider=cc.Control.extend({_value:0,_minimumValue:0,_maximumValue:0,_minimumAllowedValue:0,_maximumAllowedValue:0,_thumbSprite:null,_progressSprite:null,_backgroundSprite:null,_className:"ControlSlider",ctor:function(t,e,i){cc.Control.prototype.ctor.call(this),void 0!=i&&(t=new cc.Sprite(t),e=new cc.Sprite(e),i=new cc.Sprite(i),this.initWithSprites(t,e,i))},getValue:function(){return this._value},setValue:function(t){t=Math.max(t,this._minimumValue),this._value=t=Math.min(t,this._maximumValue),this.needsLayout(),this.sendActionsForControlEvents(cc.CONTROL_EVENT_VALUECHANGED)},getMinimumValue:function(){return this._minimumValue},setMinimumValue:function(t){this._minimumAllowedValue=this._minimumValue=t,this._minimumValue>=this._maximumValue&&(this._maximumValue=this._minimumValue+1),this.setValue(this._value)},getMaximumValue:function(){return this._maximumValue},setMaximumValue:function(t){this._maximumAllowedValue=this._maximumValue=t,this._maximumValue<=this._minimumValue&&(this._minimumValue=this._maximumValue-1),this.setValue(this._value)},isTouchInside:function(t){t=t.getLocation(),t=this.getParent().convertToNodeSpace(t);var e=this.getBoundingBox();return e.width+=this._thumbSprite.getContentSize().width,e.x-=this._thumbSprite.getContentSize().width/2,cc.rectContainsPoint(e,t)},locationFromTouch:function(t){return t=t.getLocation(),t=this.convertToNodeSpace(t),0>t.x?t.x=0:t.x>this._backgroundSprite.getContentSize().width&&(t.x=this._backgroundSprite.getContentSize().width),t},getMinimumAllowedValue:function(){return this._minimumAllowedValue},setMinimumAllowedValue:function(t){this._minimumAllowedValue=t},getMaximumAllowedValue:function(){return this._maximumAllowedValue},setMaximumAllowedValue:function(t){this._maximumAllowedValue=t},getThumbSprite:function(){return this._thumbSprite},getProgressSprite:function(){return this._progressSprite},getBackgroundSprite:function(){return this._backgroundSprite},initWithSprites:function(t,e,i){return cc.Control.prototype.init.call(this)?(this.ignoreAnchorPointForPosition(!1),this._backgroundSprite=t,this._progressSprite=e,this._thumbSprite=i,t=cc.ControlUtils.CCRectUnion(t.getBoundingBox(),i.getBoundingBox()),this.setContentSize(t.width,t.height),this._backgroundSprite.setAnchorPoint(.5,.5),this._backgroundSprite.setPosition(t.width/2,t.height/2),this.addChild(this._backgroundSprite),this._progressSprite.setAnchorPoint(0,.5),this._progressSprite.setPosition(0,t.height/2),this.addChild(this._progressSprite),this._thumbSprite.setPosition(0,t.height/2),this.addChild(this._thumbSprite),this._minimumValue=0,this._maximumValue=1,this.setValue(this._minimumValue),!0):!1},setEnabled:function(t){cc.Control.prototype.setEnabled.call(this,t),this._thumbSprite&&this._thumbSprite.setOpacity(t?255:128)},sliderBegan:function(t){this.setSelected(!0),this._thumbSprite.setColor(cc.color.GRAY),this.setValue(this.valueForLocation(t))},sliderMoved:function(t){this.setValue(this.valueForLocation(t))},sliderEnded:function(){this.isSelected()&&this.setValue(this.valueForLocation(this._thumbSprite.getPosition())),this._thumbSprite.setColor(cc.color.WHITE),this.setSelected(!1)},getTouchLocationInControl:function(t){return t=t.getLocation(),t=this.convertToNodeSpace(t),0>t.x?t.x=0:t.x>this._backgroundSprite.getContentSize().width+cc.SLIDER_MARGIN_H&&(t.x=this._backgroundSprite.getContentSize().width+cc.SLIDER_MARGIN_H),t},onTouchBegan:function(t){if(!this.isTouchInside(t)||!this.isEnabled()||!this.isVisible())return!1;var e=this.locationFromTouch(t);return this.sliderBegan(e),!0},onTouchMoved:function(t){var e=this.locationFromTouch(t);this.sliderMoved(e)},onTouchEnded:function(){this.sliderEnded(cc.p(0,0))},needsLayout:function(){this._thumbSprite.setPositionX((this._value-this._minimumValue)/(this._maximumValue-this._minimumValue)*this._backgroundSprite.getContentSize().width);var t=this._progressSprite.getTextureRect(),t=cc.rect(t.x,t.y,this._thumbSprite.getPositionX(),t.height);this._progressSprite.setTextureRect(t,this._progressSprite.isTextureRectRotated()),this._thumbSprite._renderCmd.transform(this._renderCmd)},valueForLocation:function(t){return t=t.x/this._backgroundSprite.getContentSize().width,Math.max(Math.min(this._minimumValue+t*(this._maximumValue-this._minimumValue),this._maximumAllowedValue),this._minimumAllowedValue)}}),_p=cc.ControlSlider.prototype,cc.defineGetterSetter(_p,"value",_p.getValue,_p.setValue),cc.defineGetterSetter(_p,"minValue",_p.getMinimumValue,_p.setMinimumValue),cc.defineGetterSetter(_p,"maxValue",_p.getMaximumValue,_p.setMaximumValue),cc.defineGetterSetter(_p,"minAllowedValue",_p.getMinimumAllowedValue,_p.setMinimumAllowedValue),cc.defineGetterSetter(_p,"maxAllowedValue",_p.getMaximumAllowedValue,_p.setMaximumAllowedValue),cc.defineGetterSetter(_p,"thumbSprite",_p.getThumbSprite),cc.defineGetterSetter(_p,"progressSprite",_p.getProgressSprite),cc.defineGetterSetter(_p,"backgroundSprite",_p.getBackgroundSprite),_p=null,cc.ControlSlider.create=function(t,e,i){return new cc.ControlSlider(t,e,i)},cc.ControlSwitch=cc.Control.extend({_switchSprite:null,_initialTouchXPosition:0,_moved:!1,_on:!1,_className:"ControlSwitch",ctor:function(t,e,i,n,r,o){cc.Control.prototype.ctor.call(this),o&&this.initWithMaskSprite(t,e,i,n,r,o)},initWithMaskSprite:function(t,e,i,n,r,o){if(!t)throw"cc.ControlSwitch.initWithMaskSprite(): maskSprite should be non-null.";if(!e)throw"cc.ControlSwitch.initWithMaskSprite(): onSprite should be non-null.";if(!i)throw"cc.ControlSwitch.initWithMaskSprite(): offSprite should be non-null.";if(!n)throw"cc.ControlSwitch.initWithMaskSprite(): thumbSprite should be non-null.";return this.init()?(this._on=!0,this._switchSprite=new cc.ControlSwitchSprite,this._switchSprite.initWithMaskSprite(t,e,i,n,r,o),this._switchSprite.setPosition(this._switchSprite.getContentSize().width/2,this._switchSprite.getContentSize().height/2),this.addChild(this._switchSprite),this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(.5,.5),this.setContentSize(this._switchSprite.getContentSize()),!0):!1},setOn:function(t,e){e=e||!1;var i=(this._on=t)?this._switchSprite.getOnPosition():this._switchSprite.getOffPosition();e?this._switchSprite.runAction(new cc.ActionTween(.2,"sliderXPosition",this._switchSprite.getSliderXPosition(),i)):this._switchSprite.setSliderXPosition(i),this.sendActionsForControlEvents(cc.CONTROL_EVENT_VALUECHANGED)},isOn:function(){return this._on},hasMoved:function(){return this._moved},setEnabled:function(t){this._enabled=t,this._switchSprite.setOpacity(t?255:128)},locationFromTouch:function(t){return t=t.getLocation(),t=this.convertToNodeSpace(t)},onTouchBegan:function(t){return this.isTouchInside(t)&&this.isEnabled()&&this.isVisible()?(this._moved=!1,this._initialTouchXPosition=this.locationFromTouch(t).x-this._switchSprite.getSliderXPosition(),this._switchSprite.getThumbSprite().setColor(cc.color.GRAY),this._switchSprite.needsLayout(),!0):!1},onTouchMoved:function(t){var e=this.locationFromTouch(t),e=cc.p(e.x-this._initialTouchXPosition,0);this._moved=!0,this._switchSprite.setSliderXPosition(e.x)},onTouchEnded:function(t){var e=this.locationFromTouch(t);this._switchSprite.getThumbSprite().setColor(cc.color.WHITE),this.hasMoved()?this.setOn(!(e.x<this._switchSprite.getContentSize().width/2),!0):this.setOn(!this._on,!0)},onTouchCancelled:function(t){var e=this.locationFromTouch(t);this._switchSprite.getThumbSprite().setColor(cc.color.WHITE),this.hasMoved()?this.setOn(!(e.x<this._switchSprite.getContentSize().width/2),!0):this.setOn(!this._on,!0)}}),cc.ControlSwitch.create=function(t,e,i,n,r,o){return new cc.ControlSwitch(t,e,i,n,r,o)},cc.ControlSwitchSprite=cc.Sprite.extend({_sliderXPosition:0,_onPosition:0,_offPosition:0,_textureLocation:0,_maskLocation:0,_maskSize:null,_onSprite:null,_offSprite:null,_thumbSprite:null,_onLabel:null,_offLabel:null,_clipper:null,_stencil:null,_backRT:null,ctor:function(){cc.Sprite.prototype.ctor.call(this),this._maskLocation=this._offPosition=this._onPosition=this._sliderXPosition=0,this._maskSize=cc.size(0,0),this._offLabel=this._onLabel=this._thumbSprite=this._offSprite=this._onSprite=null},initWithMaskSprite:function(t,e,i,n,r,o){return cc.Sprite.prototype.init.call(this)?(this.setSpriteFrame(t.displayFrame()),this._onPosition=0,this._offPosition=-e.getContentSize().width+n.getContentSize().width/2,this._sliderXPosition=this._onPosition,this.setOnSprite(e),this.setOffSprite(i),this.setThumbSprite(n),this.setOnLabel(r),this.setOffLabel(o),this._stencil=t,t=this._maskSize=this._stencil.getContentSize(),this._stencil.setPosition(0,0),this._clipper=new cc.ClippingNode,this._clipper.setAnchorPoint(.5,.5),this._clipper.setPosition(t.width/2,t.height/2),this._clipper.setStencil(this._stencil),this.addChild(this._clipper),this._clipper.addChild(e),this._clipper.addChild(i),this._clipper.addChild(r),this._clipper.addChild(o),this.addChild(this._thumbSprite),this.needsLayout(),!0):!1},needsLayout:function(){var t=this._maskSize;this._onSprite.setPosition(this._onSprite.getContentSize().width/2+this._sliderXPosition-t.width/2,this._onSprite.getContentSize().height/2-t.height/2),this._offSprite.setPosition(this._onSprite.getContentSize().width+this._offSprite.getContentSize().width/2+this._sliderXPosition-t.width/2,this._offSprite.getContentSize().height/2-t.height/2),this._onLabel&&this._onLabel.setPosition(this._onSprite.getPositionX()-this._thumbSprite.getContentSize().width/6,this._onSprite.getContentSize().height/2-t.height/2),this._offLabel&&this._offLabel.setPosition(this._offSprite.getPositionX()+this._thumbSprite.getContentSize().width/6,this._offSprite.getContentSize().height/2-t.height/2),this._thumbSprite.setPosition(this._onSprite.getContentSize().width+this._sliderXPosition,this._maskSize.height/2)},setSliderXPosition:function(t){t<=this._offPosition?t=this._offPosition:t>=this._onPosition&&(t=this._onPosition),this._sliderXPosition=t,this.needsLayout()},getSliderXPosition:function(){return this._sliderXPosition},_getOnSideWidth:function(){return this._onSprite.getContentSize().width},_getOffSideWidth:function(){return this._offSprite.getContentSize().height},updateTweenAction:function(t,e){"sliderXPosition"===e&&this.setSliderXPosition(t)},setOnPosition:function(t){this._onPosition=t},getOnPosition:function(){return this._onPosition},setOffPosition:function(t){this._offPosition=t},getOffPosition:function(){return this._offPosition},setMaskTexture:function(t){this._stencil.setTexture(t)},getMaskTexture:function(){return this._stencil.getTexture()},setTextureLocation:function(t){this._textureLocation=t},getTextureLocation:function(){return this._textureLocation},setMaskLocation:function(t){this._maskLocation=t},getMaskLocation:function(){return this._maskLocation},setOnSprite:function(t){this._onSprite=t},getOnSprite:function(){return this._onSprite},setOffSprite:function(t){this._offSprite=t},getOffSprite:function(){return this._offSprite},setThumbSprite:function(t){this._thumbSprite=t},getThumbSprite:function(){return this._thumbSprite},setOnLabel:function(t){this._onLabel=t},getOnLabel:function(){return this._onLabel},setOffLabel:function(t){this._offLabel=t},getOffLabel:function(){return this._offLabel}}),_p=cc.ControlSwitchSprite.prototype,cc.defineGetterSetter(_p,"sliderX",_p.getSliderXPosition,_p.setSliderXPosition),cc.defineGetterSetter(_p,"onPos",_p.getOnPosition,_p.setOnPosition),cc.defineGetterSetter(_p,"offPos",_p.getOffPosition,_p.setOffPosition),cc.defineGetterSetter(_p,"maskTexture",_p.getMaskTexture,_p.setMaskTexture),cc.defineGetterSetter(_p,"maskPos",_p.getMaskLocation,_p.setMaskLocation),cc.defineGetterSetter(_p,"onSprite",_p.getOnSprite,_p.setOnSprite),cc.defineGetterSetter(_p,"offSprite",_p.getOffSprite,_p.setOffSprite),cc.defineGetterSetter(_p,"thumbSprite",_p.getThumbSprite,_p.setThumbSprite),cc.defineGetterSetter(_p,"onLabel",_p.getOnLabel,_p.setOnLabel),cc.defineGetterSetter(_p,"offLabel",_p.getOffLabel,_p.setOffLabel),cc.defineGetterSetter(_p,"onSideWidth",_p._getOnSideWidth),cc.defineGetterSetter(_p,"offSideWidth",_p._getOffSideWidth),_p=null,cc.CONTROL_STEPPER_PARTMINUS=0,cc.CONTROL_STEPPER_PARTPLUS=1,cc.CONTROL_STEPPER_PARTNONE=2,cc.CONTROL_STEPPER_LABELCOLOR_ENABLED=cc.color(55,55,55),cc.CONTROL_STEPPER_LABELCOLOR_DISABLED=cc.color(147,147,147),cc.CONTROL_STEPPER_LABELFONT="CourierNewPSMT",cc.AUTOREPEAT_DELTATIME=.15,cc.AUTOREPEAT_INCREASETIME_INCREMENT=12,cc.ControlStepper=cc.Control.extend({_minusSprite:null,_plusSprite:null,_minusLabel:null,_plusLabel:null,_value:0,_continuous:!1,_autorepeat:!1,_wraps:!1,_minimumValue:0,_maximumValue:0,_stepValue:0,_touchInsideFlag:!1,_touchedPart:cc.CONTROL_STEPPER_PARTNONE,_autorepeatCount:0,_className:"ControlStepper",ctor:function(t,e){cc.Control.prototype.ctor.call(this),this._plusLabel=this._minusLabel=this._plusSprite=this._minusSprite=null,this._value=0,this._wraps=this._autorepeat=this._continuous=!1,this._stepValue=this._maximumValue=this._minimumValue=0,this._touchInsideFlag=!1,this._touchedPart=cc.CONTROL_STEPPER_PARTNONE,this._autorepeatCount=0,e&&this.initWithMinusSpriteAndPlusSprite(t,e)},initWithMinusSpriteAndPlusSprite:function(t,e){if(!t)throw"cc.ControlStepper.initWithMinusSpriteAndPlusSprite(): Minus sprite should be non-null.";if(!e)throw"cc.ControlStepper.initWithMinusSpriteAndPlusSprite(): Plus sprite should be non-null.";if(this.init()){this._continuous=this._autorepeat=!0,this._minimumValue=0,this._maximumValue=100,this._value=0,this._stepValue=1,this._wraps=!1,this.ignoreAnchorPointForPosition(!1),this.setMinusSprite(t),this._minusSprite.setPosition(t.getContentSize().width/2,t.getContentSize().height/2),this.addChild(this._minusSprite),this.setMinusLabel(new cc.LabelTTF("-",cc.CONTROL_STEPPER_LABELFONT,40,cc.size(40,40),cc.TEXT_ALIGNMENT_CENTER,cc.VERTICAL_TEXT_ALIGNMENT_CENTER)),this._minusLabel.setColor(cc.CONTROL_STEPPER_LABELCOLOR_DISABLED),this._minusLabel.setPosition(this._minusSprite.getContentSize().width/2,this._minusSprite.getContentSize().height/2),this._minusSprite.addChild(this._minusLabel),this.setPlusSprite(e),this._plusSprite.setPosition(t.getContentSize().width+e.getContentSize().width/2,t.getContentSize().height/2),this.addChild(this._plusSprite),this.setPlusLabel(new cc.LabelTTF("+",cc.CONTROL_STEPPER_LABELFONT,40,cc.size(40,40),cc.TEXT_ALIGNMENT_CENTER,cc.VERTICAL_TEXT_ALIGNMENT_CENTER)),this._plusLabel.setColor(cc.CONTROL_STEPPER_LABELCOLOR_ENABLED),this._plusLabel.setPosition(this._plusSprite.getContentSize().width/2,this._plusSprite.getContentSize().height/2),this._plusSprite.addChild(this._plusLabel);var i=cc.ControlUtils.CCRectUnion(this._minusSprite.getBoundingBox(),this._plusSprite.getBoundingBox());return this.setContentSize(this._minusSprite.getContentSize().width+this._plusSprite.getContentSize().height,i.height),!0}return!1},setWraps:function(t){(this._wraps=t)&&(this._minusLabel.setColor(cc.CONTROL_STEPPER_LABELCOLOR_ENABLED),this._plusLabel.setColor(cc.CONTROL_STEPPER_LABELCOLOR_ENABLED)),this.setValue(this._value)},getWraps:function(){return this._wraps},setMinimumValue:function(t){if(t>=this._maximumValue)throw"cc.ControlStepper.setMinimumValue(): minimumValue should be numerically less than maximumValue.";this._minimumValue=t,this.setValue(this._value)},getMinimumValue:function(){return this._minimumValue},setMaximumValue:function(t){if(t<=this._minimumValue)throw"cc.ControlStepper.setMaximumValue(): maximumValue should be numerically less than maximumValue.";this._maximumValue=t,this.setValue(this._value)},getMaximumValue:function(){return this._maximumValue},setValue:function(t){this.setValueWithSendingEvent(t,!0)},getValue:function(){return this._value},setStepValue:function(t){if(0>=t)throw"cc.ControlStepper.setMaximumValue(): stepValue should be numerically greater than 0.";this._stepValue=t},getStepValue:function(){return this._stepValue},isContinuous:function(){return this._continuous},setValueWithSendingEvent:function(t,e){t<this._minimumValue?t=this._wraps?this._maximumValue:this._minimumValue:t>this._maximumValue&&(t=this._wraps?this._minimumValue:this._maximumValue),this._value=t,this._wraps||(this._minusLabel.setColor(t===this._minimumValue?cc.CONTROL_STEPPER_LABELCOLOR_DISABLED:cc.CONTROL_STEPPER_LABELCOLOR_ENABLED),this._plusLabel.setColor(t===this._maximumValue?cc.CONTROL_STEPPER_LABELCOLOR_DISABLED:cc.CONTROL_STEPPER_LABELCOLOR_ENABLED)),e&&this.sendActionsForControlEvents(cc.CONTROL_EVENT_VALUECHANGED)},startAutorepeat:function(){this._autorepeatCount=-1,this.schedule(this.update,cc.AUTOREPEAT_DELTATIME,cc.REPEAT_FOREVER,3*cc.AUTOREPEAT_DELTATIME)},stopAutorepeat:function(){this.unschedule(this.update)},update:function(){this._autorepeatCount++,this._autorepeatCount<cc.AUTOREPEAT_INCREASETIME_INCREMENT&&0!==this._autorepeatCount%3||(this._touchedPart===cc.CONTROL_STEPPER_PARTMINUS?this.setValueWithSendingEvent(this._value-this._stepValue,this._continuous):this._touchedPart===cc.CONTROL_STEPPER_PARTPLUS&&this.setValueWithSendingEvent(this._value+this._stepValue,this._continuous))},updateLayoutUsingTouchLocation:function(t){t.x<this._minusSprite.getContentSize().width&&this._value>this._minimumValue?(this._touchedPart=cc.CONTROL_STEPPER_PARTMINUS,this._minusSprite.setColor(cc.color.GRAY),this._plusSprite.setColor(cc.color.WHITE)):t.x>=this._minusSprite.getContentSize().width&&this._value<this._maximumValue?(this._touchedPart=cc.CONTROL_STEPPER_PARTPLUS,this._minusSprite.setColor(cc.color.WHITE),this._plusSprite.setColor(cc.color.GRAY)):(this._touchedPart=cc.CONTROL_STEPPER_PARTNONE,this._minusSprite.setColor(cc.color.WHITE),this._plusSprite.setColor(cc.color.WHITE))},onTouchBegan:function(t){if(!this.isTouchInside(t)||!this.isEnabled()||!this.isVisible())return!1;var e=this.getTouchLocation(t);return this.updateLayoutUsingTouchLocation(e),this._touchInsideFlag=!0,this._autorepeat&&this.startAutorepeat(),!0},onTouchMoved:function(t){if(this.isTouchInside(t)){var e=this.getTouchLocation(t);this.updateLayoutUsingTouchLocation(e),this._touchInsideFlag||(this._touchInsideFlag=!0,this._autorepeat&&this.startAutorepeat())}else this._touchInsideFlag=!1,this._touchedPart=cc.CONTROL_STEPPER_PARTNONE,this._minusSprite.setColor(cc.color.WHITE),this._plusSprite.setColor(cc.color.WHITE),this._autorepeat&&this.stopAutorepeat()},onTouchEnded:function(t){if(this._minusSprite.setColor(cc.color.WHITE),this._plusSprite.setColor(cc.color.WHITE),this._autorepeat&&this.stopAutorepeat(),this.isTouchInside(t)){var e=this.getTouchLocation(t);this.setValue(this._value+(e.x<this._minusSprite.getContentSize().width?0-this._stepValue:this._stepValue))}},setMinusSprite:function(t){this._minusSprite=t},getMinusSprite:function(){return this._minusSprite},setPlusSprite:function(t){this._plusSprite=t},getPlusSprite:function(){return this._plusSprite},setMinusLabel:function(t){this._minusLabel=t},getMinusLabel:function(){return this._minusLabel},setPlusLabel:function(t){this._plusLabel=t},getPlusLabel:function(){return this._plusLabel}}),_p=cc.ControlStepper.prototype,cc.defineGetterSetter(_p,"wraps",_p.getWraps,_p.setWraps),cc.defineGetterSetter(_p,"value",_p.getValue,_p.setValue),cc.defineGetterSetter(_p,"minValue",_p.getMinimumValue,_p.setMinimumValue),cc.defineGetterSetter(_p,"maxValue",_p.getMaximumValue,_p.setMaximumValue),cc.defineGetterSetter(_p,"stepValue",_p.getStepValue,_p.setStepValue),cc.defineGetterSetter(_p,"continuous",_p.isContinuous),cc.defineGetterSetter(_p,"minusSprite",_p.getMinusSprite,_p.setMinusSprite),cc.defineGetterSetter(_p,"plusSprite",_p.getPlusSprite,_p.setPlusSprite),cc.defineGetterSetter(_p,"minusLabel",_p.getMinusLabel,_p.setMinusLabel),cc.defineGetterSetter(_p,"plusLabel",_p.getPlusLabel,_p.setPlusLabel),_p=null,cc.ControlStepper.create=function(t,e){return new cc.ControlStepper(t,e)},cc.ControlPotentiometer=cc.Control.extend({_thumbSprite:null,_progressTimer:null,_previousLocation:null,_value:0,_minimumValue:0,_maximumValue:1,_className:"ControlPotentiometer",ctor:function(t,e,i){cc.Control.prototype.ctor.call(this),void 0!=i&&(t=new cc.Sprite(t),i=new cc.Sprite(i),e=new cc.ProgressTimer(new cc.Sprite(e)),this.initWithTrackSprite_ProgressTimer_ThumbSprite(t,e,i))},initWithTrackSprite_ProgressTimer_ThumbSprite:function(t,e,i){return this.init()?(this.setProgressTimer(e),this.setThumbSprite(i),this._thumbSprite.setPosition(e.getPosition()),this.addChild(i,2),this.addChild(e,1),this.addChild(t),this.setContentSize(t.getContentSize()),this._minimumValue=0,this._maximumValue=1,this.setValue(this._minimumValue),!0):!1},setEnabled:function(t){this.setEnabled(t),null!==this._thumbSprite&&this._thumbSprite.setOpacity(t?255:128)},setValue:function(t){t<this._minimumValue&&(t=this._minimumValue),t>this._maximumValue&&(t=this._maximumValue),this._value=t,t=(t-this._minimumValue)/(this._maximumValue-this._minimumValue),this._progressTimer.setPercentage(100*t),this._thumbSprite.setRotation(360*t),this.sendActionsForControlEvents(cc.CONTROL_EVENT_VALUECHANGED)},getValue:function(){return this._value},setMinimumValue:function(t){this._minimumValue=t,this._minimumValue>=this._maximumValue&&(this._maximumValue=this._minimumValue+1),this.setValue(this._maximumValue)},getMinimumValue:function(){return this._minimumValue},setMaximumValue:function(t){this._maximumValue=t,this._maximumValue<=this._minimumValue&&(this._minimumValue=this._maximumValue-1),this.setValue(this._minimumValue)},getMaximumValue:function(){return this._maximumValue},isTouchInside:function(t){return t=this.getTouchLocation(t),this.distanceBetweenPointAndPoint(this._progressTimer.getPosition(),t)<Math.min(this.getContentSize().width/2,this.getContentSize().height/2)},onTouchBegan:function(t){return this.isTouchInside(t)&&this.isEnabled()&&this.isVisible()?(this._previousLocation=this.getTouchLocation(t),this.potentiometerBegan(this._previousLocation),!0):!1},onTouchMoved:function(t){var e=this.getTouchLocation(t);this.potentiometerMoved(e)},onTouchEnded:function(){this.potentiometerEnded(cc.p(0,0))},distanceBetweenPointAndPoint:function(t,e){var i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)},angleInDegreesBetweenLineFromPoint_toPoint_toLineFromPoint_toPoint:function(t,e,i,n){var r=n.x-i.x;return i=n.y-i.y,t=Math.atan2(e.x-t.x,e.y-t.y),r=Math.atan2(r,i),180*(t-r)/Math.PI},potentiometerBegan:function(){this.setSelected(!0),this.getThumbSprite().setColor(cc.color.GRAY)},potentiometerMoved:function(t){var e=this.angleInDegreesBetweenLineFromPoint_toPoint_toLineFromPoint_toPoint(this._progressTimer.getPosition(),t,this._progressTimer.getPosition(),this._previousLocation);e>180?e-=360:-180>e&&(e+=360),this.setValue(this._value+e/360*(this._maximumValue-this._minimumValue)),this._previousLocation=t},potentiometerEnded:function(){this.getThumbSprite().setColor(cc.color.WHITE),this.setSelected(!1)},setThumbSprite:function(t){this._thumbSprite=t},getThumbSprite:function(){return this._thumbSprite},setProgressTimer:function(t){this._progressTimer=t},getProgressTimer:function(){return this._progressTimer},setPreviousLocation:function(t){this._previousLocation=t},getPreviousLocation:function(){return this._previousLocation}}),_p=cc.ControlPotentiometer.prototype,cc.defineGetterSetter(_p,"value",_p.getValue,_p.setValue),cc.defineGetterSetter(_p,"minValue",_p.getMinimumValue,_p.setMinimumValue),cc.defineGetterSetter(_p,"maxValue",_p.getMaximumValue,_p.setMaximumValue),cc.defineGetterSetter(_p,"progressTimer",_p.getProgressTimer,_p.setProgressTimer),cc.defineGetterSetter(_p,"thumbSprite",_p.getThumbSprite,_p.setThumbSprite),cc.defineGetterSetter(_p,"prevLocation",_p.getPreviousLocation,_p.setPreviousLocation),_p=null,cc.ControlPotentiometer.create=function(t,e,i){return new cc.ControlPotentiometer(t,e,i)},cc.SCROLLVIEW_DIRECTION_NONE=-1,cc.SCROLLVIEW_DIRECTION_HORIZONTAL=0,cc.SCROLLVIEW_DIRECTION_VERTICAL=1,cc.SCROLLVIEW_DIRECTION_BOTH=2;var SCROLL_DEACCEL_RATE=.95,SCROLL_DEACCEL_DIST=1,BOUNCE_DURATION=.15,INSET_RATIO=.2,MOVE_INCH=.04375,BOUNCE_BACK_FACTOR=.35;cc.convertDistanceFromPointToInch=function(t){var e=cc.view,e=(e.getScaleX()+e.getScaleY())/2;return t*e/160},cc.ScrollViewDelegate=cc.Class.extend({scrollViewDidScroll:function(){},scrollViewDidZoom:function(){}}),cc.ScrollView=cc.Layer.extend({_zoomScale:0,_minZoomScale:0,_maxZoomScale:0,_delegate:null,_direction:cc.SCROLLVIEW_DIRECTION_BOTH,_dragging:!1,_contentOffset:null,_container:null,_touchMoved:!1,_maxInset:null,_minInset:null,_bounceable:!1,_clippingToBounds:!1,_scrollDistance:null,_touchPoint:null,_touchLength:0,_touches:null,_viewSize:null,_minScale:0,_maxScale:0,_parentScissorRect:null,_scissorRestored:!1,_tmpViewRect:null,_touchListener:null,_className:"ScrollView",ctor:function(t,e){cc.Layer.prototype.ctor.call(this),this._contentOffset=cc.p(0,0),this._maxInset=cc.p(0,0),this._minInset=cc.p(0,0),this._scrollDistance=cc.p(0,0),this._touchPoint=cc.p(0,0),this._touches=[],this._viewSize=cc.size(0,0),this._parentScissorRect=new cc.Rect(0,0,0,0),this._tmpViewRect=new cc.Rect(0,0,0,0),void 0!=e?this.initWithViewSize(t,e):this.initWithViewSize(cc.size(200,200),null)},init:function(){return this.initWithViewSize(cc.size(200,200),null)},initWithViewSize:function(t,e){var i=cc.p(0,0);return cc.Layer.prototype.init.call(this)?(e||this._container||(e=new cc.Layer),e&&this.setContainer(e),this.setViewSize(t),this.setTouchEnabled(!0),this._touches.length=0,this._delegate=null,this._clippingToBounds=this._bounceable=!0,this._direction=cc.SCROLLVIEW_DIRECTION_BOTH,this._container.setPosition(i),this._touchLength=0,this._minScale=this._maxScale=1,!0):!1},setContentOffset:function(t,e){if(e)this.setContentOffsetInDuration(t,BOUNCE_DURATION);else{if(!this._bounceable){var i=this.minContainerOffset(),n=this.maxContainerOffset();t.x=Math.max(i.x,Math.min(n.x,t.x)),t.y=Math.max(i.y,Math.min(n.y,t.y))}this._container.setPosition(t),i=this._delegate,null!=i&&i.scrollViewDidScroll&&i.scrollViewDidScroll(this)}},getContentOffset:function(){var t=this._container.getPosition();return cc.p(t.x,t.y)},setContentOffsetInDuration:function(t,e){var i=cc.moveTo(e,t),n=cc.callFunc(this._stoppedAnimatedScroll,this);this._container.runAction(cc.sequence(i,n)),this.schedule(this._performedAnimatedScroll)},setZoomScale:function(t,e){if(e)this.setZoomScaleInDuration(t,BOUNCE_DURATION);else{var i=this._container;if(i.getScale()!==t){var n,r;0===this._touchLength?(r=this._viewSize,r=cc.p(.5*r.width,.5*r.height),r=this.convertToWorldSpace(r)):r=this._touchPoint,n=i.convertToNodeSpace(r),i.setScale(Math.max(this._minScale,Math.min(this._maxScale,t))),n=i.convertToWorldSpace(n),r=cc.pSub(r,n),this._delegate&&this._delegate.scrollViewDidZoom&&this._delegate.scrollViewDidZoom(this),this.setContentOffset(cc.pAdd(i.getPosition(),r))
}}},getZoomScale:function(){return this._container.getScale()},setZoomScaleInDuration:function(t,e){if(e>0){var i=this._container.getScale();i!==t&&(i=cc.actionTween(e,"zoomScale",i,t),this.runAction(i))}else this.setZoomScale(t)},minContainerOffset:function(){var t=this._container,e=t.getContentSize(),i=this._viewSize;return cc.p(i.width-e.width*t.getScaleX(),i.height-e.height*t.getScaleY())},maxContainerOffset:function(){return cc.p(0,0)},isNodeVisible:function(t){var e=this.getContentOffset(),i=this.getViewSize(),n=this.getZoomScale(),e=cc.rect(-e.x/n,-e.y/n,i.width/n,i.height/n);return cc.rectIntersectsRect(e,t.getBoundingBox())},pause:function(t){this._container.pause(),t=this._container.getChildren();for(var e=0;e<t.length;e++)t[e].pause();this._super()},resume:function(t){t=this._container.getChildren();for(var e=0,i=t.length;i>e;e++)t[e].resume();this._container.resume(),this._super()},isDragging:function(){return this._dragging},isTouchMoved:function(){return this._touchMoved},isBounceable:function(){return this._bounceable},setBounceable:function(t){this._bounceable=t},getViewSize:function(){return this._viewSize},setViewSize:function(t){this._viewSize=t,cc.Node.prototype.setContentSize.call(this,t)},getContainer:function(){return this._container},setContainer:function(t){t&&(this.removeAllChildren(!0),this._container=t,t.ignoreAnchorPointForPosition(!1),t.setAnchorPoint(0,0),this.addChild(t),this.setViewSize(this._viewSize))},getDirection:function(){return this._direction},setDirection:function(t){this._direction=t},getDelegate:function(){return this._delegate},setDelegate:function(t){this._delegate=t},onTouchBegan:function(t){if(!this.isVisible())return!1;var e=this._getViewRect(),i=this._container,n=i.convertToWorldSpace(i.convertTouchToNodeSpace(t)),r=this._touches;return 2<r.length||this._touchMoved||!cc.rectContainsPoint(e,n)?!1:(r.push(t),1===r.length?(this._touchPoint=this.convertTouchToNodeSpace(t),this._touchMoved=!1,this._dragging=!0,this._scrollDistance.x=0,this._touchLength=this._scrollDistance.y=0):2===r.length&&(this._touchPoint=cc.pMidpoint(this.convertTouchToNodeSpace(r[0]),this.convertTouchToNodeSpace(r[1])),this._touchLength=cc.pDistance(i.convertTouchToNodeSpace(r[0]),i.convertTouchToNodeSpace(r[1])),this._dragging=!1),!0)},onTouchMoved:function(t){if(this.isVisible())if(this.setNodeDirty(),1===this._touches.length&&this._dragging){this._touchMoved=!0,this._getViewRect();var e,i=this.convertTouchToNodeSpace(t),n=cc.pSub(i,this._touchPoint),r=0,o=this._direction;if(o===cc.SCROLLVIEW_DIRECTION_VERTICAL)r=n.y,e=this._container.getPositionY(),this.minContainerOffset().y<=e&&e<=this.maxContainerOffset().y||(n.y*=BOUNCE_BACK_FACTOR);else if(o===cc.SCROLLVIEW_DIRECTION_HORIZONTAL)r=n.x,e=this._container.getPositionX(),this.minContainerOffset().x<=e&&e<=this.maxContainerOffset().x||(n.x*=BOUNCE_BACK_FACTOR);else{r=Math.sqrt(n.x*n.x+n.y*n.y),e=this._container.getPositionY();var s=this.minContainerOffset(),c=this.maxContainerOffset();s.y<=e&&e<=c.y||(n.y*=BOUNCE_BACK_FACTOR),e=this._container.getPositionX(),s.x<=e&&e<=c.x||(n.x*=BOUNCE_BACK_FACTOR)}if((this._touchMoved||!(Math.abs(cc.convertDistanceFromPointToInch(r))<MOVE_INCH))&&(this._touchMoved||(n.x=0,n.y=0),this._touchPoint=i,this._touchMoved=!0,this._dragging)){switch(o){case cc.SCROLLVIEW_DIRECTION_VERTICAL:n.x=0;break;case cc.SCROLLVIEW_DIRECTION_HORIZONTAL:n.y=0}r=this._container.getPosition(),i=r.x+n.x,r=r.y+n.y,this._scrollDistance=n,this.setContentOffset(cc.p(i,r))}}else 2!==this._touches.length||this._dragging||(n=cc.pDistance(this._container.convertTouchToNodeSpace(this._touches[0]),this._container.convertTouchToNodeSpace(this._touches[1])),this.setZoomScale(this.getZoomScale()*n/this._touchLength))},onTouchEnded:function(){this.isVisible()&&(1===this._touches.length&&this._touchMoved&&this.schedule(this._deaccelerateScrolling),this._touches.length=0,this._touchMoved=this._dragging=!1)},onTouchCancelled:function(){this.isVisible()&&(this._touches.length=0,this._touchMoved=this._dragging=!1)},setContentSize:function(t,e){null!==this.getContainer()&&(void 0===e?this.getContainer().setContentSize(t):this.getContainer().setContentSize(t,e),this.updateInset())},_setWidth:function(t){var e=this.getContainer();null!==e&&(e._setWidth(t),this.updateInset())},_setHeight:function(t){var e=this.getContainer();null!==e&&(e._setHeight(t),this.updateInset())},getContentSize:function(){return this._container.getContentSize()},updateInset:function(){if(null!==this.getContainer()){var t=this._viewSize,e=this.maxContainerOffset();this._maxInset.x=e.x+t.width*INSET_RATIO,this._maxInset.y=e.y+t.height*INSET_RATIO,e=this.minContainerOffset(),this._minInset.x=e.x-t.width*INSET_RATIO,this._minInset.y=e.y-t.height*INSET_RATIO}},isClippingToBounds:function(){return this._clippingToBounds},setClippingToBounds:function(t){this._clippingToBounds=t},visit:function(t){this.isVisible()&&this._renderCmd.visit(t)},addChild:function(t,e,i){if(!t)throw Error("child must not nil!");e=e||t.getLocalZOrder(),i=i||t.getTag(),this._container!==t?this._container.addChild(t,e,i):cc.Layer.prototype.addChild.call(this,t,e,i)},isTouchEnabled:function(){return null!==this._touchListener},setTouchEnabled:function(t){this._touchListener&&cc.eventManager.removeListener(this._touchListener),this._touchListener=null,t?(t=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE}),this.onTouchBegan&&(t.onTouchBegan=this.onTouchBegan.bind(this)),this.onTouchMoved&&(t.onTouchMoved=this.onTouchMoved.bind(this)),this.onTouchEnded&&(t.onTouchEnded=this.onTouchEnded.bind(this)),this.onTouchCancelled&&(t.onTouchCancelled=this.onTouchCancelled.bind(this)),this._touchListener=t,cc.eventManager.addListener(t,this)):(this._touchMoved=this._dragging=!1,this._touches.length=0)},_initWithViewSize:function(){return null},_relocateContainer:function(t){var e=this.minContainerOffset(),i=this.maxContainerOffset(),n=this._direction,r=this._container.getPosition(),o=r.x,s=r.y;(n===cc.SCROLLVIEW_DIRECTION_BOTH||n===cc.SCROLLVIEW_DIRECTION_HORIZONTAL)&&(o=Math.max(o,e.x),o=Math.min(o,i.x)),(n===cc.SCROLLVIEW_DIRECTION_BOTH||n===cc.SCROLLVIEW_DIRECTION_VERTICAL)&&(s=Math.min(s,i.y),s=Math.max(s,e.y)),s===r.y&&o===r.x||this.setContentOffset(cc.p(o,s),t)},_deaccelerateScrolling:function(t){if(this._dragging)this.unschedule(this._deaccelerateScrolling);else{var e,i;e=this._container.getPosition(),t=this._scrollDistance,this._container.setPosition(e.x+t.x,e.y+t.y),this._bounceable?(e=this._maxInset,i=this._minInset):(e=this.maxContainerOffset(),i=this.minContainerOffset());var n=this._container.getPositionX(),r=this._container.getPositionY();t.x*=SCROLL_DEACCEL_RATE,t.y*=SCROLL_DEACCEL_RATE,this.setContentOffset(cc.p(n,r)),(Math.abs(t.x)<=SCROLL_DEACCEL_DIST&&Math.abs(t.y)<=SCROLL_DEACCEL_DIST||r>e.y||r<i.y||n>e.x||n<i.x||n===e.x||n===i.x||r===e.y||r===i.y)&&(this.unschedule(this._deaccelerateScrolling),this._relocateContainer(!0))}},_performedAnimatedScroll:function(){this._dragging?this.unschedule(this._performedAnimatedScroll):this._delegate&&this._delegate.scrollViewDidScroll&&this._delegate.scrollViewDidScroll(this)},_stoppedAnimatedScroll:function(){this.unschedule(this._performedAnimatedScroll),this._delegate&&this._delegate.scrollViewDidScroll&&this._delegate.scrollViewDidScroll(this)},_handleZoom:function(){},_getViewRect:function(){for(var t=this.convertToWorldSpace(cc.p(0,0)),e=this._viewSize,i=this.getScaleX(),n=this.getScaleY(),r=this._parent;null!=r;r=r.getParent())i*=r.getScaleX(),n*=r.getScaleY();return 0>i&&(t.x+=e.width*i,i=-i),0>n&&(t.y+=e.height*n,n=-n),r=this._tmpViewRect,r.x=t.x,r.y=t.y,r.width=e.width*i,r.height=e.height*n,r},_createRenderCmd:function(){return cc._renderType===cc._RENDER_TYPE_CANVAS?new cc.ScrollView.CanvasRenderCmd(this):new cc.ScrollView.WebGLRenderCmd(this)}}),_p=cc.ScrollView.prototype,cc.defineGetterSetter(_p,"minOffset",_p.minContainerOffset),cc.defineGetterSetter(_p,"maxOffset",_p.maxContainerOffset),cc.defineGetterSetter(_p,"bounceable",_p.isBounceable,_p.setBounceable),cc.defineGetterSetter(_p,"viewSize",_p.getViewSize,_p.setViewSize),cc.defineGetterSetter(_p,"container",_p.getContainer,_p.setContainer),cc.defineGetterSetter(_p,"direction",_p.getDirection,_p.setDirection),cc.defineGetterSetter(_p,"delegate",_p.getDelegate,_p.setDelegate),cc.defineGetterSetter(_p,"clippingToBounds",_p.isClippingToBounds,_p.setClippingToBounds),_p=null,cc.ScrollView.create=function(t,e){return new cc.ScrollView(t,e)},function(){cc.ScrollView.CanvasRenderCmd=function(t){cc.Layer.CanvasRenderCmd.call(this,t),this._needDraw=!1,this.startCmd=new cc.CustomRenderCmd(this,this._startCmd),this.endCmd=new cc.CustomRenderCmd(this,this._endCmd)};var t=cc.ScrollView.CanvasRenderCmd.prototype=Object.create(cc.Layer.CanvasRenderCmd.prototype);t.constructor=cc.ScrollView.CanvasRenderCmd,t._startCmd=function(t,e,i){var n=this._node,r=t||cc._renderContext;if(t=r.getContext(),r.save(),n._clippingToBounds){this._scissorRestored=!1,r.setTransform(this._worldTransform,e,i);var o=n.getScaleX(),r=n.getScaleY();e*=n._viewSize.width*o,i*=n._viewSize.height*r,t.beginPath(),t.rect(0,0,e,-i),t.closePath(),t.clip()}},t._endCmd=function(t){t=t||cc._renderContext,t.restore()},t.visit=function(t){var e=this._node,i=e._children;if(this.transform(t),cc.renderer.pushRenderCommand(this.startCmd),i&&0<i.length)for(t=i.length,e.sortAllChildren(),e=0;t>e;e++)i[e]._renderCmd.visit(this);cc.renderer.pushRenderCommand(this.endCmd)}}(),function(){cc.ScrollView.WebGLRenderCmd=function(t){cc.Layer.WebGLRenderCmd.call(this,t),this._needDraw=!1,this.startCmd=new cc.CustomRenderCmd(this,this._startCmd),this.endCmd=new cc.CustomRenderCmd(this,this._endCmd)};var t=cc.ScrollView.WebGLRenderCmd.prototype=Object.create(cc.Layer.WebGLRenderCmd.prototype);t.constructor=cc.ScrollView.WebGLRenderCmd,t._startCmd=function(){var t=this._node,e=cc.view,i=t._getViewRect();if(e.isScissorEnabled()){if(t._scissorRestored=!0,t._parentScissorRect=e.getScissorRect(),cc.rectIntersection(i,t._parentScissorRect)){var n=t._parentScissorRect,t=Math.max(i.x,n.x),r=Math.max(i.y,n.y),o=Math.min(i.x+i.width,n.x+n.width),i=Math.min(i.y+i.height,n.y+n.height);e.setScissorInPoints(t,r,o-t,i-r)}}else t=cc._renderContext,t.enable(t.SCISSOR_TEST),e.setScissorInPoints(i.x,i.y,i.width,i.height)},t._endCmd=function(){var t=this._node;t._scissorRestored?(t=t._parentScissorRect,cc.view.setScissorInPoints(t.x,t.y,t.width,t.height)):(t=cc._renderContext,t.disable(t.SCISSOR_TEST))},t.visit=function(t){var e,i,n=this._node,r=n._children;if(cc.kmGLPushMatrix(),this.transform(t),n._clippingToBounds&&cc.renderer.pushRenderCommand(this.startCmd),r&&0<r.length){for(i=r.length,t=0;i>t&&((e=r[t])&&0>e._localZOrder);t++)e._renderCmd.visit();for(;i>t;t++)r[t]._renderCmd.visit()}n._clippingToBounds&&cc.renderer.pushRenderCommand(this.endCmd),this._dirtyFlag=0,cc.kmGLPopMatrix()}}(),cc.SortableObject=cc.Class.extend({setObjectID:function(){},getObjectID:function(){return 0}}),cc.SortedObject=cc.SortableObject.extend({_objectID:0,ctor:function(){this._objectID=0},setObjectID:function(t){this._objectID=t},getObjectID:function(){return this._objectID}});var _compareObject=function(t,e){return t.getObjectID()-e.getObjectID()};cc.ArrayForObjectSorting=cc.Class.extend({_saveObjectArr:null,ctor:function(){this._saveObjectArr=[]},insertSortedObject:function(t){if(!t)throw"cc.ArrayForObjectSorting.insertSortedObject(): addObject should be non-null.";var e=this.indexOfSortedObject(t);this.insertObject(t,e)},removeSortedObject:function(t){if(0!==this.count()){var e=this.indexOfSortedObject(t);e<this.count()&&e!==cc.INVALID_INDEX&&this.objectAtIndex(e).getObjectID()===t.getObjectID()&&this.removeObjectAtIndex(e)}},setObjectID_ofSortedObject:function(t,e){var i=this.indexOfSortedObject(e);if(i<this.count()&&i!==cc.INVALID_INDEX){var n=this.objectAtIndex(i);n.getObjectID()===e.getObjectID()&&(this.removeObjectAtIndex(i),n.setObjectID(t),this.insertSortedObject(n))}},objectWithObjectID:function(t){if(0===this.count())return null;var e=new cc.SortedObject;e.setObjectID(t);var i=this.indexOfSortedObject(e);return i<this.count()&&i!==cc.INVALID_INDEX&&(e=this.objectAtIndex(i),e.getObjectID()!==t&&(e=null)),e},getObjectWithObjectID:function(){return null},indexOfSortedObject:function(t){var e=0;if(t){var i=0;t=t.getObjectID();for(var n=this._saveObjectArr,r=0;r<n.length;r++){var o=n[r].getObjectID();if(t===o||t>=i&&o>t)break;i=o,e++}}else e=cc.INVALID_INDEX;return e},count:function(){return this._saveObjectArr.length},lastObject:function(){var t=this._saveObjectArr;return 0===t.length?null:t[t.length-1]},objectAtIndex:function(t){return this._saveObjectArr[t]},addObject:function(t){this._saveObjectArr.push(t),this._saveObjectArr.sort(_compareObject)},removeObjectAtIndex:function(t){this._saveObjectArr.splice(t,1),this._saveObjectArr.sort(_compareObject)},insertObject:function(t,e){this._saveObjectArr.splice(e,0,t),this._saveObjectArr.sort(_compareObject)}}),cc.TABLEVIEW_FILL_TOPDOWN=0,cc.TABLEVIEW_FILL_BOTTOMUP=1,cc.TableViewCell=cc.Node.extend({_idx:0,_className:"TableViewCell",getIdx:function(){return this._idx},setIdx:function(t){this._idx=t},reset:function(){this._idx=cc.INVALID_INDEX},setObjectID:function(t){this._idx=t},getObjectID:function(){return this._idx}}),_p=cc.TableViewCell.prototype,cc.defineGetterSetter(_p,"objectId",_p.getObjectID,_p.setObjectID),_p=null,cc.TableViewDelegate=cc.ScrollViewDelegate.extend({tableCellTouched:function(){},tableCellHighlight:function(){},tableCellUnhighlight:function(){},tableCellWillRecycle:function(){}}),cc.TableViewDataSource=cc.Class.extend({tableCellSizeForIndex:function(t){return this.cellSizeForTable(t)},cellSizeForTable:function(){return cc.size(0,0)},tableCellAtIndex:function(){return null},numberOfCellsInTableView:function(){return 0}}),cc.TableView=cc.ScrollView.extend({_vOrdering:null,_indices:null,_cellsFreed:null,_dataSource:null,_tableViewDelegate:null,_oldDirection:null,_cellsPositions:null,_touchedCell:null,ctor:function(t,e,i){cc.ScrollView.prototype.ctor.call(this),this._oldDirection=cc.SCROLLVIEW_DIRECTION_NONE,this._cellsPositions=[],this.initWithViewSize(e,i),this.setDataSource(t),this._updateCellPositions(),this._updateContentSize()},__indexFromOffset:function(t){var e=0,i=this._dataSource.numberOfCellsInTableView(this)-1;switch(this.getDirection()){case cc.SCROLLVIEW_DIRECTION_HORIZONTAL:t=t.x;break;default:t=t.y}for(var n=this._cellsPositions;i>=e;){var r=0|e+(i-e)/2,o=n[r],s=n[r+1];if(t>=o&&s>=t)return r;o>t?i=r-1:e=r+1}return 0>=e?0:-1},_indexFromOffset:function(t){var e={x:t.x,y:t.y};return t=this._dataSource.numberOfCellsInTableView(this)-1,this._vOrdering===cc.TABLEVIEW_FILL_TOPDOWN&&(e.y=this.getContainer().getContentSize().height-e.y),e=this.__indexFromOffset(e),-1!==e&&(e=Math.max(0,e),e>t&&(e=cc.INVALID_INDEX)),e},__offsetFromIndex:function(t){switch(this.getDirection()){case cc.SCROLLVIEW_DIRECTION_HORIZONTAL:t=cc.p(this._cellsPositions[t],0);break;default:t=cc.p(0,this._cellsPositions[t])}return t},_offsetFromIndex:function(t){var e=this.__offsetFromIndex(t);return t=this._dataSource.tableCellSizeForIndex(this,t),this._vOrdering===cc.TABLEVIEW_FILL_TOPDOWN&&(e.y=this.getContainer().getContentSize().height-e.y-t.height),e},_updateCellPositions:function(){var t=this._dataSource.numberOfCellsInTableView(this),e=this._cellsPositions;if(t>0){for(var i,n=0,r=this._dataSource,o=0;t>o;o++)switch(e[o]=n,i=r.tableCellSizeForIndex(this,o),this.getDirection()){case cc.SCROLLVIEW_DIRECTION_HORIZONTAL:n+=i.width;break;default:n+=i.height}this._cellsPositions[t]=n}},_updateContentSize:function(){var t=cc.size(0,0),e=this._dataSource.numberOfCellsInTableView(this);if(e>0)switch(t=this._cellsPositions[e],this.getDirection()){case cc.SCROLLVIEW_DIRECTION_HORIZONTAL:t=cc.size(t,this._viewSize.height);break;default:t=cc.size(this._viewSize.width,t)}this.setContentSize(t),this._oldDirection!==this._direction&&(this.setContentOffset(this._direction===cc.SCROLLVIEW_DIRECTION_HORIZONTAL?cc.p(0,0):cc.p(0,this.minContainerOffset().y)),this._oldDirection=this._direction)},_moveCellOutOfSight:function(t){this._tableViewDelegate&&this._tableViewDelegate.tableCellWillRecycle&&this._tableViewDelegate.tableCellWillRecycle(this,t),this._cellsFreed.addObject(t),this._cellsUsed.removeSortedObject(t),cc.arrayRemoveObject(this._indices,t.getIdx()),t.reset(),t.getParent()===this.getContainer()&&this.getContainer().removeChild(t,!0)},_setIndexForCell:function(t,e){e.setAnchorPoint(0,0),e.setPosition(this._offsetFromIndex(t)),e.setIdx(t)},_addCellIfNecessary:function(t){t.getParent()!==this.getContainer()&&this.getContainer().addChild(t),this._cellsUsed.insertSortedObject(t);var e=this._indices;t=t.getIdx(),-1===e.indexOf(t)&&(e.push(t),e.sort(function(t,e){return t-e}))},getDataSource:function(){return this._dataSource},setDataSource:function(t){this._dataSource=t},getDelegate:function(){return this._tableViewDelegate},setDelegate:function(t){this._tableViewDelegate=t},setVerticalFillOrder:function(t){this._vOrdering!==t&&(this._vOrdering=t,0<this._cellsUsed.count()&&this.reloadData())},getVerticalFillOrder:function(){return this._vOrdering},initWithViewSize:function(t,e){return cc.ScrollView.prototype.initWithViewSize.call(this,t,e)?(this._cellsUsed=new cc.ArrayForObjectSorting,this._cellsFreed=new cc.ArrayForObjectSorting,this._indices=[],this._tableViewDelegate=null,this._vOrdering=cc.TABLEVIEW_FILL_BOTTOMUP,this.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL),cc.ScrollView.prototype.setDelegate.call(this,this),!0):!1},updateCellAtIndex:function(t){if(!(t===cc.INVALID_INDEX||t>this._dataSource.numberOfCellsInTableView(this)-1)){var e=this.cellAtIndex(t);e&&this._moveCellOutOfSight(e),e=this._dataSource.tableCellAtIndex(this,t),this._setIndexForCell(t,e),this._addCellIfNecessary(e)}},insertCellAtIndex:function(t){if(!(t===cc.INVALID_INDEX||t>this._dataSource.numberOfCellsInTableView(this)-1)){var e,i=this._cellsUsed;if(e=i.objectWithObjectID(t))for(var n=e=i.indexOfSortedObject(e);n<i.count();n++)e=i.objectAtIndex(n),this._setIndexForCell(e.getIdx()+1,e);e=this._dataSource.tableCellAtIndex(this,t),this._setIndexForCell(t,e),this._addCellIfNecessary(e),this._updateCellPositions(),this._updateContentSize()}},removeCellAtIndex:function(t){if(!(t===cc.INVALID_INDEX||t>this._dataSource.numberOfCellsInTableView(this)-1)){var e=this.cellAtIndex(t);if(e){var i=this._cellsUsed,n=i.indexOfSortedObject(e);for(this._moveCellOutOfSight(e),cc.arrayRemoveObject(this._indices,t),this._updateCellPositions(),t=i.count()-1;t>n;t--)e=i.objectAtIndex(t),this._setIndexForCell(e.getIdx()-1,e)}}},reloadData:function(){this._oldDirection=cc.SCROLLVIEW_DIRECTION_NONE;for(var t=this._cellsUsed,e=this._cellsFreed,i=this.getContainer(),n=0,r=t.count();r>n;n++){var o=t.objectAtIndex(n);this._tableViewDelegate&&this._tableViewDelegate.tableCellWillRecycle&&this._tableViewDelegate.tableCellWillRecycle(this,o),e.addObject(o),o.reset(),o.getParent()===i&&i.removeChild(o,!0)}this._indices=[],this._cellsUsed=new cc.ArrayForObjectSorting,this._updateCellPositions(),this._updateContentSize(),0<this._dataSource.numberOfCellsInTableView(this)&&this.scrollViewDidScroll(this)},dequeueCell:function(){if(0===this._cellsFreed.count())return null;var t=this._cellsFreed.objectAtIndex(0);return this._cellsFreed.removeObjectAtIndex(0),t},cellAtIndex:function(t){return-1===this._indices.indexOf(t)?null:this._cellsUsed.objectWithObjectID(t)},scrollViewDidScroll:function(t){var e=this._dataSource.numberOfCellsInTableView(this);if(0!==e){null!==this._tableViewDelegate&&this._tableViewDelegate.scrollViewDidScroll&&this._tableViewDelegate.scrollViewDidScroll(this);var i=0,n=this._viewSize,i=this.getContainer(),r=this.getContentOffset();r.x*=-1,r.y*=-1;var o=Math.max(e-1,0);if(this._vOrdering===cc.TABLEVIEW_FILL_TOPDOWN&&(r.y+=n.height/i.getScaleY()),t=this._indexFromOffset(r),t===cc.INVALID_INDEX&&(t=e-1),r.y=this._vOrdering===cc.TABLEVIEW_FILL_TOPDOWN?r.y-n.height/i.getScaleY():r.y+n.height/i.getScaleY(),r.x+=n.width/i.getScaleX(),n=this._indexFromOffset(r),n===cc.INVALID_INDEX&&(n=e-1),r=this._cellsUsed,0<r.count())for(e=r.objectAtIndex(0),i=e.getIdx();t>i&&(this._moveCellOutOfSight(e),0<r.count());)e=r.objectAtIndex(0),i=e.getIdx();if(0<r.count())for(e=r.lastObject(),i=e.getIdx();o>=i&&i>n&&(this._moveCellOutOfSight(e),0<r.count());)e=r.lastObject(),i=e.getIdx();for(o=this._indices;n>=t;t++)-1===o.indexOf(t)&&this.updateCellAtIndex(t)}},scrollViewDidZoom:function(){},onTouchEnded:function(t,e){if(this.isVisible()){if(this._touchedCell){var i=this.getBoundingBox(),n=cc.p(i.x,i.y),n=this._parent.convertToWorldSpace(n);i.x=n.x,i.y=n.y,n=this._tableViewDelegate,cc.rectContainsPoint(i,t.getLocation())&&null!==n&&(n.tableCellUnhighlight&&n.tableCellUnhighlight(this,this._touchedCell),n.tableCellTouched&&n.tableCellTouched(this,this._touchedCell)),this._touchedCell=null}cc.ScrollView.prototype.onTouchEnded.call(this,t,e)}},onTouchBegan:function(t,e){if(!this.isVisible())return!1;var i=cc.ScrollView.prototype.onTouchBegan.call(this,t,e);if(1===this._touches.length){var n;n=this.getContainer().convertTouchToNodeSpace(t),n=this._indexFromOffset(n),(this._touchedCell=n===cc.INVALID_INDEX?null:this.cellAtIndex(n))&&null!==this._tableViewDelegate&&this._tableViewDelegate.tableCellHighlight&&this._tableViewDelegate.tableCellHighlight(this,this._touchedCell)}else this._touchedCell&&(null!==this._tableViewDelegate&&this._tableViewDelegate.tableCellUnhighlight&&this._tableViewDelegate.tableCellUnhighlight(this,this._touchedCell),this._touchedCell=null);return i},onTouchMoved:function(t,e){cc.ScrollView.prototype.onTouchMoved.call(this,t,e),this._touchedCell&&this.isTouchMoved()&&(null!==this._tableViewDelegate&&this._tableViewDelegate.tableCellUnhighlight&&this._tableViewDelegate.tableCellUnhighlight(this,this._touchedCell),this._touchedCell=null)},onTouchCancelled:function(t,e){cc.ScrollView.prototype.onTouchCancelled.call(this,t,e),this._touchedCell&&(null!==this._tableViewDelegate&&this._tableViewDelegate.tableCellUnhighlight&&this._tableViewDelegate.tableCellUnhighlight(this,this._touchedCell),this._touchedCell=null)}}),_p=cc.TableView.prototype,cc.defineGetterSetter(_p,"dataSource",_p.getDataSource,_p.setDataSource),cc.defineGetterSetter(_p,"delegate",_p.getDelegate,_p.setDelegate),cc.defineGetterSetter(_p,"verticalFillOrder",_p.getVerticalFillOrder,_p.setVerticalFillOrder),_p=null,cc.TableView.create=function(t,e,i){return new cc.TableView(t,e,i)};var PROPERTY_POSITION="position",PROPERTY_CONTENTSIZE="contentSize",PROPERTY_SKEW="skew",PROPERTY_ANCHORPOINT="anchorPoint",PROPERTY_SCALE="scale",PROPERTY_ROTATION="rotation",PROPERTY_TAG="tag",PROPERTY_IGNOREANCHORPOINTFORPOSITION="ignoreAnchorPointForPosition",PROPERTY_VISIBLE="visible",ASSERT_FAIL_UNEXPECTED_PROPERTY=function(t){cc.log("Unexpected property: '"+t+"'!")},ASSERT_FAIL_UNEXPECTED_PROPERTYTYPE=function(t){cc.log("Unexpected property type: '"+t+"'!")};cc.NodeLoader=cc.Class.extend({_customProperties:null,ctor:function(){this._customProperties=new cc._Dictionary},loadCCNode:function(t,e){return this._createCCNode(t,e)},parseProperties:function(t,e,i){for(var n=i.readInt(!1),r=i.readInt(!1),r=n+r,o=0;r>o;o++){var s=o>=n,c=i.readInt(!1),a=i.readCachedString(),l=!1,h=i.readByte();switch((h===CCB_PLATFORM_ALL||h===CCB_PLATFORM_IOS||h===CCB_PLATFORM_MAC)&&(l=!0),t instanceof cc.BuilderFile?t.getCCBFileNode()&&s&&(t=t.getCCBFileNode(),l=-1!==t.userObject.indexOf(a)):s&&t===i.getAnimationManager().getRootNode()&&(s=t.userObject,s||(s=[],t.userObject=s),s.push(a)),c){case CCB_PROPTYPE_POSITION:c=this.parsePropTypePosition(t,e,i,a),l&&this.onHandlePropTypePosition(t,e,a,c,i);break;case CCB_PROPTYPE_POINT:c=this.parsePropTypePoint(t,e,i),l&&this.onHandlePropTypePoint(t,e,a,c,i);break;case CCB_PROPTYPE_POINTLOCK:c=this.parsePropTypePointLock(t,e,i),l&&this.onHandlePropTypePointLock(t,e,a,c,i);break;case CCB_PROPTYPE_SIZE:c=this.parsePropTypeSize(t,e,i),l&&this.onHandlePropTypeSize(t,e,a,c,i);break;case CCB_PROPTYPE_SCALELOCK:c=this.parsePropTypeScaleLock(t,e,i,a),l&&this.onHandlePropTypeScaleLock(t,e,a,c,i);break;case CCB_PROPTYPE_FLOATXY:c=this.parsePropTypeFloatXY(t,e,i),l&&this.onHandlePropTypeFloatXY(t,e,a,c,i);break;case CCB_PROPTYPE_FLOAT:c=this.parsePropTypeFloat(t,e,i),l&&this.onHandlePropTypeFloat(t,e,a,c,i);break;case CCB_PROPTYPE_DEGREES:c=this.parsePropTypeDegrees(t,e,i,a),l&&this.onHandlePropTypeDegrees(t,e,a,c,i);break;case CCB_PROPTYPE_FLOATSCALE:c=this.parsePropTypeFloatScale(t,e,i),l&&this.onHandlePropTypeFloatScale(t,e,a,c,i);break;case CCB_PROPTYPE_INTEGER:c=this.parsePropTypeInteger(t,e,i),l&&this.onHandlePropTypeInteger(t,e,a,c,i);break;case CCB_PROPTYPE_INTEGERLABELED:c=this.parsePropTypeIntegerLabeled(t,e,i),l&&this.onHandlePropTypeIntegerLabeled(t,e,a,c,i);break;case CCB_PROPTYPE_FLOATVAR:c=this.parsePropTypeFloatVar(t,e,i),l&&this.onHandlePropTypeFloatVar(t,e,a,c,i);break;case CCB_PROPTYPE_CHECK:c=this.parsePropTypeCheck(t,e,i,a),l&&this.onHandlePropTypeCheck(t,e,a,c,i);break;case CCB_PROPTYPE_SPRITEFRAME:c=this.parsePropTypeSpriteFrame(t,e,i,a),l&&this.onHandlePropTypeSpriteFrame(t,e,a,c,i);break;case CCB_PROPTYPE_ANIMATION:c=this.parsePropTypeAnimation(t,e,i),l&&this.onHandlePropTypeAnimation(t,e,a,c,i);break;case CCB_PROPTYPE_TEXTURE:c=this.parsePropTypeTexture(t,e,i),l&&this.onHandlePropTypeTexture(t,e,a,c,i);break;case CCB_PROPTYPE_BYTE:c=this.parsePropTypeByte(t,e,i,a),l&&this.onHandlePropTypeByte(t,e,a,c,i);break;case CCB_PROPTYPE_COLOR3:c=this.parsePropTypeColor3(t,e,i,a),l&&this.onHandlePropTypeColor3(t,e,a,c,i);break;case CCB_PROPTYPE_COLOR4VAR:c=this.parsePropTypeColor4FVar(t,e,i),l&&this.onHandlePropTypeColor4FVar(t,e,a,c,i);break;case CCB_PROPTYPE_FLIP:c=this.parsePropTypeFlip(t,e,i),l&&this.onHandlePropTypeFlip(t,e,a,c,i);break;case CCB_PROPTYPE_BLENDMODE:c=this.parsePropTypeBlendFunc(t,e,i),l&&this.onHandlePropTypeBlendFunc(t,e,a,c,i);break;case CCB_PROPTYPE_FNTFILE:c=i.getCCBRootPath()+this.parsePropTypeFntFile(t,e,i),l&&this.onHandlePropTypeFntFile(t,e,a,c,i);break;case CCB_PROPTYPE_FONTTTF:c=this.parsePropTypeFontTTF(t,e,i),l&&this.onHandlePropTypeFontTTF(t,e,a,c,i);break;case CCB_PROPTYPE_STRING:c=this.parsePropTypeString(t,e,i),l&&this.onHandlePropTypeString(t,e,a,c,i);break;case CCB_PROPTYPE_TEXT:c=this.parsePropTypeText(t,e,i),l&&this.onHandlePropTypeText(t,e,a,c,i);break;case CCB_PROPTYPE_BLOCK:c=this.parsePropTypeBlock(t,e,i),l&&this.onHandlePropTypeBlock(t,e,a,c,i);break;case CCB_PROPTYPE_BLOCKCCCONTROL:c=this.parsePropTypeBlockCCControl(t,e,i),l&&null!=c&&this.onHandlePropTypeBlockCCControl(t,e,a,c,i);break;case CCB_PROPTYPE_CCBFILE:c=this.parsePropTypeCCBFile(t,e,i),l&&this.onHandlePropTypeCCBFile(t,e,a,c,i);break;default:ASSERT_FAIL_UNEXPECTED_PROPERTYTYPE(c)}}},getCustomProperties:function(){return this._customProperties},_createCCNode:function(){return new cc.Node},parsePropTypePosition:function(t,e,i,n){var r=i.readFloat(),o=i.readFloat(),s=i.readInt(!1),c=i.getAnimationManager().getContainerSize(e);return e=cc._getAbsolutePosition(r,o,s,c,n),t.setPosition(cc.getAbsolutePosition(e,s,c,n)),-1<i.getAnimatedProperties().indexOf(n)&&(r=[r,o,s],i.getAnimationManager().setBaseValue(r,t,n)),e},parsePropTypePoint:function(t,e,i){return t=i.readFloat(),i=i.readFloat(),cc.p(t,i)},parsePropTypePointLock:function(t,e,i){return t=i.readFloat(),i=i.readFloat(),cc.p(t,i)},parsePropTypeSize:function(t,e,i){t=i.readFloat();var n=i.readFloat(),r=i.readInt(!1);switch(e=i.getAnimationManager().getContainerSize(e),r){case CCB_SIZETYPE_ABSOLUTE:break;case CCB_SIZETYPE_RELATIVE_CONTAINER:t=e.width-t,n=e.height-n;break;case CCB_SIZETYPE_PERCENT:t=e.width*t/100,n=e.height*n/100;break;case CCB_SIZETYPE_HORIZONTAL_PERCENT:t=e.width*t/100;break;case CCB_SIZETYPE_VERTICAL_PERCENT:n=e.height*n/100;break;case CCB_SIZETYPE_MULTIPLY_RESOLUTION:e=cc.BuilderReader.getResolutionScale(),t*=e,n*=e;break;default:cc.log("Unknown CCB type.")}return cc.size(t,n)},parsePropTypeScaleLock:function(t,e,i,n){e=i.readFloat();var r=i.readFloat(),o=i.readInt(!1);return cc.setRelativeScale(t,e,r,o,n),-1<i.getAnimatedProperties().indexOf(n)&&i.getAnimationManager().setBaseValue([e,r,o],t,n),o===CCB_SCALETYPE_MULTIPLY_RESOLUTION&&(e*=cc.BuilderReader.getResolutionScale(),r*=cc.BuilderReader.getResolutionScale()),[e,r]},parsePropTypeFloat:function(t,e,i){return i.readFloat()},parsePropTypeDegrees:function(t,e,i,n){return e=i.readFloat(),-1<i.getAnimatedProperties().indexOf(n)&&i.getAnimationManager().setBaseValue(e,t,n),e},parsePropTypeFloatScale:function(t,e,i){return t=i.readFloat(),i.readInt(!1)===CCB_SCALETYPE_MULTIPLY_RESOLUTION&&(t*=cc.BuilderReader.getResolutionScale()),t},parsePropTypeInteger:function(t,e,i){return i.readInt(!0)},parsePropTypeIntegerLabeled:function(t,e,i){return i.readInt(!0)},parsePropTypeFloatVar:function(t,e,i){return t=i.readFloat(),i=i.readFloat(),[t,i]},parsePropTypeCheck:function(t,e,i,n){return e=i.readBool(),-1<i.getAnimatedProperties().indexOf(n)&&i.getAnimationManager().setBaseValue(e,t,n),e},parsePropTypeSpriteFrame:function(t,e,i,n){e=i.readCachedString();var r,o=i.readCachedString();return null!=o&&0!==o.length&&(0===e.length?(o=i.getCCBRootPath()+o,e=cc.textureCache.addImage(o),o=e.getContentSize(),o=cc.rect(0,0,o.width,o.height),r=new cc.SpriteFrame(e,o)):(r=cc.spriteFrameCache,e=i.getCCBRootPath()+e,-1===i.getLoadedSpriteSheet().indexOf(e)&&(r.addSpriteFrames(e),i.getLoadedSpriteSheet().push(e)),r=r.getSpriteFrame(o)),-1<i.getAnimatedProperties().indexOf(n)&&i.getAnimationManager().setBaseValue(r,t,n)),r},parsePropTypeAnimation:function(t,e,i){return t=i.getCCBRootPath()+i.readCachedString(),i=i.readCachedString(),e=null,i=cc.BuilderReader.lastPathComponent(i),t=cc.BuilderReader.lastPathComponent(t),null!=i&&""!==i&&(e=cc.animationCache,e.addAnimations(t),e=e.getAnimation(i)),e},parsePropTypeTexture:function(t,e,i){return t=i.getCCBRootPath()+i.readCachedString(),""!==t?cc.textureCache.addImage(t):null},parsePropTypeByte:function(t,e,i,n){return e=i.readByte(),-1<i.getAnimatedProperties().indexOf(n)&&i.getAnimationManager().setBaseValue(e,t,n),e},parsePropTypeColor3:function(t,e,i,n){e=i.readByte();var r=i.readByte(),o=i.readByte();return e={r:e,g:r,b:o},-1<i.getAnimatedProperties().indexOf(n)&&i.getAnimationManager().setBaseValue(cc.Color3BWapper.create(e),t,n),e},parsePropTypeColor4FVar:function(t,e,i){t=0|255*i.readFloat(),e=0|255*i.readFloat();var n=0|255*i.readFloat(),r=i.readFloat(),r=1>=r?0|255*r:r,o=0|255*i.readFloat(),s=0|255*i.readFloat(),c=0|255*i.readFloat();i=i.readFloat();var a=[];return a[0]={r:t,g:e,b:n,a:r},a[1]={r:o,g:s,b:c,a:1>=i?0|255*i:i},a},parsePropTypeFlip:function(t,e,i){return t=i.readBool(),i=i.readBool(),[t,i]},parsePropTypeBlendFunc:function(t,e,i){return t=i.readInt(!1),i=i.readInt(!1),new cc.BlendFunc(t,i)},parsePropTypeFntFile:function(t,e,i){return i.readCachedString()},parsePropTypeString:function(t,e,i){return i.readCachedString()},parsePropTypeText:function(t,e,i){return i.readCachedString()},parsePropTypeFontTTF:function(t,e,i){return i.readCachedString()},parsePropTypeBlock:function(t,e,i){e=i.readCachedString();var n=i.readInt(!1);if(n!==CCB_TARGETTYPE_NONE){var r=null;if(i.isJSControlled())n===CCB_TARGETTYPE_DOCUMENTROOT?(i.addDocumentCallbackNode(t),i.addDocumentCallbackName(e),i.addDocumentCallbackControlEvents(0)):(i.addOwnerCallbackNode(t),i.addOwnerCallbackName(e),i.addOwnerCallbackControlEvents(0));else if(n===CCB_TARGETTYPE_DOCUMENTROOT?r=i.getAnimationManager().getRootNode():n===CCB_TARGETTYPE_OWNER&&(r=i.getOwner()),null!==r)if(0<e.length){if(t=0,r.onResolveCCBCCMenuItemSelector&&(t=r.onResolveCCBCCMenuItemSelector(r,e)),0===t&&(i=i.getCCBSelectorResolver(),null!=i&&(t=i.onResolveCCBCCMenuItemSelector(r,e))),0!==t)return new BlockData(t,r);cc.log("Skipping selector '"+e+"' since no CCBSelectorResolver is present.")}else cc.log("Unexpected empty selector.");
else cc.log("Unexpected NULL target for selector.")}return null},parsePropTypeBlockCCControl:function(t,e,i){e=i.readCachedString();var n=i.readInt(!1),r=i.readInt(!1);if(n!==CCB_TARGETTYPE_NONE)if(i.isJSControlled())n===CCB_TARGETTYPE_DOCUMENTROOT?(i.addDocumentCallbackNode(t),i.addDocumentCallbackName(e),i.addDocumentCallbackControlEvents(r)):(i.addOwnerCallbackNode(t),i.addOwnerCallbackName(e),i.addOwnerCallbackControlEvents(r));else if(t=null,n===CCB_TARGETTYPE_DOCUMENTROOT?t=i.getAnimationManager().getRootNode():n===CCB_TARGETTYPE_OWNER&&(t=i.getOwner()),null!==t)if(0<e.length){if(n=0,t.onResolveCCBCCControlSelector&&(n=t.onResolveCCBCCControlSelector(t,e)),0===n&&(i=i.getCCBSelectorResolver(),null!=i&&(n=i.onResolveCCBCCControlSelector(t,e))),0!==n)return new BlockCCControlData(n,t,r);cc.log("Skipping selector '"+e+"' since no CCBSelectorResolver is present.")}else cc.log("Unexpected empty selector.");else cc.log("Unexpected NULL target for selector.");return null},parsePropTypeCCBFile:function(t,e,i){var n=i.getCCBRootPath()+i.readCachedString(),n=cc.BuilderReader.deletePathExtension(n)+".ccbi";t=new cc.BuilderReader(i);var r=cc.loader.getRes(n);return r||(r=cc.loader.getUrl(n),r=cc.loader.loadBinarySync(r),cc.loader.cache[n]=r),t.initWithData(r,i.getOwner()),t.getAnimationManager().setRootContainerSize(e.getContentSize()),t.setAnimationManagers(i.getAnimationManagers()),t.getAnimationManager().setOwner(i.getOwner()),e=t.readFileWithCleanUp(!1),i.setAnimationManagers(t.getAnimationManagers()),e&&-1!==t.getAnimationManager().getAutoPlaySequenceId()&&t.getAnimationManager().runAnimations(t.getAnimationManager().getAutoPlaySequenceId(),0),e},parsePropTypeFloatXY:function(t,e,i){return t=i.readFloat(),i=i.readFloat(),[t,i]},onHandlePropTypePosition:function(t,e,i,n){i===PROPERTY_POSITION?t.setPosition(n):ASSERT_FAIL_UNEXPECTED_PROPERTY(i)},onHandlePropTypePoint:function(t,e,i,n){i===PROPERTY_ANCHORPOINT?t.setAnchorPoint(n):ASSERT_FAIL_UNEXPECTED_PROPERTY(i)},onHandlePropTypePointLock:function(t,e,i){ASSERT_FAIL_UNEXPECTED_PROPERTY(i)},onHandlePropTypeSize:function(t,e,i,n){i===PROPERTY_CONTENTSIZE?t.setContentSize(n):ASSERT_FAIL_UNEXPECTED_PROPERTY(i)},onHandlePropTypeScaleLock:function(t,e,i,n){i===PROPERTY_SCALE?(t.setScaleX(n[0]),t.setScaleY(n[1])):ASSERT_FAIL_UNEXPECTED_PROPERTY(i)},onHandlePropTypeFloatXY:function(t,e,i,n,r){i===PROPERTY_SKEW?(t.setSkewX(n[0]),t.setSkewY(n[1])):(e=i+"X",r=i+"Y",t[e]&&t[r]||ASSERT_FAIL_UNEXPECTED_PROPERTY(i),t[e](n[0]),t[r](n[1]))},onHandlePropTypeFloat:function(t,e,i,n){this._customProperties.setObject(n,i)},onHandlePropTypeDegrees:function(t,e,i,n){i===PROPERTY_ROTATION?t.setRotation(n):ASSERT_FAIL_UNEXPECTED_PROPERTY(i)},onHandlePropTypeFloatScale:function(t,e,i){ASSERT_FAIL_UNEXPECTED_PROPERTY(i)},onHandlePropTypeInteger:function(t,e,i,n){i===PROPERTY_TAG?t.setTag(n):ASSERT_FAIL_UNEXPECTED_PROPERTY(i)},onHandlePropTypeIntegerLabeled:function(t,e,i){ASSERT_FAIL_UNEXPECTED_PROPERTY(i)},onHandlePropTypeFloatVar:function(t,e,i){ASSERT_FAIL_UNEXPECTED_PROPERTY(i)},onHandlePropTypeCheck:function(t,e,i,n){i===PROPERTY_VISIBLE?t.setVisible(n):i===PROPERTY_IGNOREANCHORPOINTFORPOSITION?t.ignoreAnchorPointForPosition(n):ASSERT_FAIL_UNEXPECTED_PROPERTY(i)},onHandlePropTypeSpriteFrame:function(t,e,i){ASSERT_FAIL_UNEXPECTED_PROPERTY(i)},onHandlePropTypeAnimation:function(t,e,i){ASSERT_FAIL_UNEXPECTED_PROPERTY(i)},onHandlePropTypeTexture:function(t,e,i){ASSERT_FAIL_UNEXPECTED_PROPERTY(i)},onHandlePropTypeByte:function(t,e,i){ASSERT_FAIL_UNEXPECTED_PROPERTY(i)},onHandlePropTypeColor3:function(t,e,i){ASSERT_FAIL_UNEXPECTED_PROPERTY(i)},onHandlePropTypeColor4FVar:function(t,e,i){ASSERT_FAIL_UNEXPECTED_PROPERTY(i)},onHandlePropTypeFlip:function(t,e,i){ASSERT_FAIL_UNEXPECTED_PROPERTY(i)},onHandlePropTypeBlendFunc:function(t,e,i){ASSERT_FAIL_UNEXPECTED_PROPERTY(i)},onHandlePropTypeFntFile:function(t,e,i){ASSERT_FAIL_UNEXPECTED_PROPERTY(i)},onHandlePropTypeString:function(t,e,i,n){this._customProperties.setObject(n,i)},onHandlePropTypeText:function(t,e,i){ASSERT_FAIL_UNEXPECTED_PROPERTY(i)},onHandlePropTypeFontTTF:function(t,e,i){ASSERT_FAIL_UNEXPECTED_PROPERTY(i)},onHandlePropTypeBlock:function(t,e,i){ASSERT_FAIL_UNEXPECTED_PROPERTY(i)},onHandlePropTypeBlockCCControl:function(t,e,i){ASSERT_FAIL_UNEXPECTED_PROPERTY(i)},onHandlePropTypeCCBFile:function(t,e,i){ASSERT_FAIL_UNEXPECTED_PROPERTY(i)}}),cc.NodeLoader.loader=function(){return new cc.NodeLoader},cc.NodeLoaderListener=cc.Class.extend({onNodeLoaded:function(){}}),cc.BuilderSelectorResolver=cc.Class.extend({onResolveCCBCCMenuItemSelector:function(){},onResolveCCBCCCallFuncSelector:function(){},onResolveCCBCCControlSelector:function(){}}),cc.BuilderScriptOwnerProtocol=cc.Class.extend({createNew:function(){}}),cc.BuilderMemberVariableAssigner=cc.Class.extend({onAssignCCBMemberVariable:function(){return!1},onAssignCCBCustomProperty:function(){return!1}});var PROPERTY_CCBFILE="ccbFile";cc.BuilderFileLoader=cc.NodeLoader.extend({_createCCNode:function(){return cc.BuilderFile.create()},onHandlePropTypeCCBFile:function(t,e,i,n,r){i===PROPERTY_CCBFILE?t.setCCBFileNode(n):cc.NodeLoader.prototype.onHandlePropTypeCCBFile.call(this,t,e,i,n,r)}}),cc.BuilderFileLoader.loader=function(){return new cc.BuilderFileLoader};var PROPERTY_ENABLED="enabled",PROPERTY_SELECTED="selected",PROPERTY_CCCONTROL="ccControl";cc.ControlLoader=cc.NodeLoader.extend({_createCCNode:function(){},onHandlePropTypeBlockCCControl:function(t,e,i,n,r){i===PROPERTY_CCCONTROL?t.addTargetWithActionForControlEvents(n.target,n.selCCControlHandler,n.controlEvents):cc.NodeLoader.prototype.onHandlePropTypeBlockCCControl.call(this,t,e,i,n,r)},onHandlePropTypeCheck:function(t,e,i,n,r){i===PROPERTY_ENABLED?t.setEnabled(n):i===PROPERTY_SELECTED?t.setSelected(n):cc.NodeLoader.prototype.onHandlePropTypeCheck.call(this,t,e,i,n,r)}});var PROPERTY_ZOOMONTOUCHDOWN="zoomOnTouchDown",PROPERTY_TITLE_NORMAL="title|1",PROPERTY_TITLE_HIGHLIGHTED="title|2",PROPERTY_TITLE_DISABLED="title|3",PROPERTY_TITLECOLOR_NORMAL="titleColor|1",PROPERTY_TITLECOLOR_HIGHLIGHTED="titleColor|2",PROPERTY_TITLECOLOR_DISABLED="titleColor|3",PROPERTY_TITLETTF_NORMAL="titleTTF|1",PROPERTY_TITLETTF_HIGHLIGHTED="titleTTF|2",PROPERTY_TITLETTF_DISABLED="titleTTF|3",PROPERTY_TITLETTFSIZE_NORMAL="titleTTFSize|1",PROPERTY_TITLETTFSIZE_HIGHLIGHTED="titleTTFSize|2",PROPERTY_TITLETTFSIZE_DISABLED="titleTTFSize|4",PROPERTY_LABELANCHORPOINT="labelAnchorPoint",PROPERTY_PREFEREDSIZE="preferedSize",PROPERTY_BACKGROUNDSPRITEFRAME_NORMAL="backgroundSpriteFrame|1",PROPERTY_BACKGROUNDSPRITEFRAME_HIGHLIGHTED="backgroundSpriteFrame|2",PROPERTY_BACKGROUNDSPRITEFRAME_DISABLED="backgroundSpriteFrame|3";cc.ControlButtonLoader=cc.ControlLoader.extend({_createCCNode:function(){return new cc.ControlButton},onHandlePropTypeCheck:function(t,e,i,n,r){i===PROPERTY_ZOOMONTOUCHDOWN?t.setZoomOnTouchDown(n):cc.ControlLoader.prototype.onHandlePropTypeCheck.call(this,t,e,i,n,r)},onHandlePropTypeString:function(t,e,i,n,r){i===PROPERTY_TITLE_NORMAL?t.setTitleForState(n,cc.CONTROL_STATE_NORMAL):i===PROPERTY_TITLE_HIGHLIGHTED?t.setTitleForState(n,cc.CONTROL_STATE_HIGHLIGHTED):i===PROPERTY_TITLE_DISABLED?t.setTitleForState(n,cc.CONTROL_STATE_DISABLED):cc.ControlLoader.prototype.onHandlePropTypeString.call(this,t,e,i,n,r)},onHandlePropTypeFontTTF:function(t,e,i,n,r){i===PROPERTY_TITLETTF_NORMAL?t.setTitleTTFForState(n,cc.CONTROL_STATE_NORMAL):i===PROPERTY_TITLETTF_HIGHLIGHTED?t.setTitleTTFForState(n,cc.CONTROL_STATE_HIGHLIGHTED):i===PROPERTY_TITLETTF_DISABLED?t.setTitleTTFForState(n,cc.CONTROL_STATE_DISABLED):cc.ControlLoader.prototype.onHandlePropTypeFontTTF.call(this,t,e,i,n,r)},onHandlePropTypeFloatScale:function(t,e,i,n,r){i===PROPERTY_TITLETTFSIZE_NORMAL?t.setTitleTTFSizeForState(n,cc.CONTROL_STATE_NORMAL):i===PROPERTY_TITLETTFSIZE_HIGHLIGHTED?t.setTitleTTFSizeForState(n,cc.CONTROL_STATE_HIGHLIGHTED):i===PROPERTY_TITLETTFSIZE_DISABLED?t.setTitleTTFSizeForState(n,cc.CONTROL_STATE_DISABLED):cc.ControlLoader.prototype.onHandlePropTypeFloatScale.call(this,t,e,i,n,r)},onHandlePropTypePoint:function(t,e,i,n,r){i===PROPERTY_LABELANCHORPOINT?t.setLabelAnchorPoint(n):cc.ControlLoader.prototype.onHandlePropTypePoint.call(this,t,e,i,n,r)},onHandlePropTypeSize:function(t,e,i,n,r){i===PROPERTY_PREFEREDSIZE?t.setPreferredSize(n):cc.ControlLoader.prototype.onHandlePropTypeSize.call(this,t,e,i,n,r)},onHandlePropTypeSpriteFrame:function(t,e,i,n,r){i===PROPERTY_BACKGROUNDSPRITEFRAME_NORMAL?null!=n&&t.setBackgroundSpriteFrameForState(n,cc.CONTROL_STATE_NORMAL):i===PROPERTY_BACKGROUNDSPRITEFRAME_HIGHLIGHTED?null!=n&&t.setBackgroundSpriteFrameForState(n,cc.CONTROL_STATE_HIGHLIGHTED):i===PROPERTY_BACKGROUNDSPRITEFRAME_DISABLED?null!=n&&t.setBackgroundSpriteFrameForState(n,cc.CONTROL_STATE_DISABLED):cc.ControlLoader.prototype.onHandlePropTypeSpriteFrame.call(this,t,e,i,n,r)},onHandlePropTypeColor3:function(t,e,i,n,r){i===PROPERTY_TITLECOLOR_NORMAL?t.setTitleColorForState(n,cc.CONTROL_STATE_NORMAL):i===PROPERTY_TITLECOLOR_HIGHLIGHTED?t.setTitleColorForState(n,cc.CONTROL_STATE_HIGHLIGHTED):i===PROPERTY_TITLECOLOR_DISABLED?t.setTitleColorForState(n,cc.CONTROL_STATE_DISABLED):cc.ControlLoader.prototype.onHandlePropTypeColor3.call(this,t,e,i,n,r)}}),cc.ControlButtonLoader.loader=function(){return new cc.ControlButtonLoader};var PROPERTY_CONTAINER="container",PROPERTY_DIRECTION="direction",PROPERTY_CLIPSTOBOUNDS="clipsToBounds",PROPERTY_BOUNCES="bounces",PROPERTY_SCALE="scale";cc.ScrollViewLoader=cc.NodeLoader.extend({_createCCNode:function(){return new cc.ScrollView},onHandlePropTypeSize:function(t,e,i,n,r){i===PROPERTY_CONTENTSIZE?t.setViewSize(n):cc.NodeLoader.prototype.onHandlePropTypeSize.call(this,t,e,i,n,r)},onHandlePropTypeCCBFile:function(t,e,i,n,r){i===PROPERTY_CONTAINER?(t.setContainer(n),t.updateInset()):cc.NodeLoader.prototype.onHandlePropTypeCCBFile.call(this,t,e,i,n,r)},onHandlePropTypeCheck:function(t,e,i,n,r){i===PROPERTY_CLIPSTOBOUNDS?t.setClippingToBounds(n):i===PROPERTY_BOUNCES?t.setBounceable(n):cc.NodeLoader.prototype.onHandlePropTypeCheck.call(this,t,e,i,n,r)},onHandlePropTypeFloat:function(t,e,i,n,r){i===PROPERTY_SCALE?t.setScale(n):cc.NodeLoader.prototype.onHandlePropTypeFloat.call(this,t,e,i,n,r)},onHandlePropTypeIntegerLabeled:function(t,e,i,n,r){i===PROPERTY_DIRECTION?t.setDirection(n):cc.NodeLoader.prototype.onHandlePropTypeIntegerLabeled.call(this,t,e,i,n,r)}}),cc.ScrollViewLoader.loader=function(){return new cc.ScrollViewLoader};var PROPERTY_CONTENTSIZE="contentSize",PROPERTY_SPRITEFRAME="spriteFrame",PROPERTY_COLOR="color",PROPERTY_OPACITY="opacity",PROPERTY_BLENDFUNC="blendFunc",PROPERTY_INSETLEFT="insetLeft",PROPERTY_INSETTOP="insetTop",PROPERTY_INSETRIGHT="insetRight",PROPERTY_INSETBOTTOM="insetBottom";cc.Scale9SpriteLoader=cc.NodeLoader.extend({_createCCNode:function(){var t=new cc.Scale9Sprite;return t.setAnchorPoint(0,0),t},onHandlePropTypeColor3:function(t,e,i,n,r){i===PROPERTY_COLOR?255===n.r&&255===n.g&&255===n.b||t.setColor(n):cc.NodeLoader.prototype.onHandlePropTypeColor3.call(this,t,e,i,n,r)},onHandlePropTypeByte:function(t,e,i,n,r){i===PROPERTY_OPACITY?t.setOpacity(n):cc.NodeLoader.prototype.onHandlePropTypeByte.call(this,t,e,i,n,r)},onHandlePropTypeBlendFunc:function(t,e,i,n,r){i!==PROPERTY_BLENDFUNC&&cc.NodeLoader.prototype.onHandlePropTypeBlendFunc.call(this,t,e,i,n,r)},onHandlePropTypeSpriteFrame:function(t,e,i,n,r){i===PROPERTY_SPRITEFRAME?t.setSpriteFrame(n):cc.NodeLoader.prototype.onHandlePropTypeSpriteFrame.call(this,t,e,i,n,r)},onHandlePropTypeSize:function(t,e,i,n,r){i!==PROPERTY_CONTENTSIZE&&(i===PROPERTY_PREFEREDSIZE?t.setPreferredSize(n):cc.NodeLoader.prototype.onHandlePropTypeSize.call(this,t,e,i,n,r))},onHandlePropTypeFloat:function(t,e,i,n,r){i===PROPERTY_INSETLEFT?t.setInsetLeft(n):i===PROPERTY_INSETTOP?t.setInsetTop(n):i===PROPERTY_INSETRIGHT?t.setInsetRight(n):i===PROPERTY_INSETBOTTOM?t.setInsetBottom(n):cc.NodeLoader.prototype.onHandlePropTypeFloat.call(this,t,e,i,n,r)}}),cc.Scale9SpriteLoader.loader=function(){return new cc.Scale9SpriteLoader};var PROPERTY_FLIP="flip",PROPERTY_DISPLAYFRAME="displayFrame",PROPERTY_COLOR="color",PROPERTY_OPACITY="opacity",PROPERTY_BLENDFUNC="blendFunc";cc.SpriteLoader=cc.NodeLoader.extend({_createCCNode:function(){return new cc.Sprite},onHandlePropTypeColor3:function(t,e,i,n,r){i===PROPERTY_COLOR?255===n.r&&255===n.g&&255===n.b||t.setColor(n):cc.NodeLoader.prototype.onHandlePropTypeColor3.call(this,t,e,i,n,r)},onHandlePropTypeByte:function(t,e,i,n,r){i===PROPERTY_OPACITY?t.setOpacity(n):cc.NodeLoader.prototype.onHandlePropTypeByte.call(this,t,e,i,n,r)},onHandlePropTypeBlendFunc:function(t,e,i,n,r){i===PROPERTY_BLENDFUNC?t.setBlendFunc(n):cc.NodeLoader.prototype.onHandlePropTypeBlendFunc.call(this,t,e,i,n,r)},onHandlePropTypeSpriteFrame:function(t,e,i,n,r){i===PROPERTY_DISPLAYFRAME?n?t.setSpriteFrame(n):cc.log("ERROR: SpriteFrame is null"):cc.NodeLoader.prototype.onHandlePropTypeSpriteFrame.call(this,t,e,i,n,r)},onHandlePropTypeFlip:function(t,e,i,n,r){i===PROPERTY_FLIP?(t.setFlippedX(n[0]),t.setFlippedY(n[1])):cc.NodeLoader.prototype.onHandlePropTypeFlip.call(this,t,e,i,n,r)}}),cc.SpriteLoader.loader=function(){return new cc.SpriteLoader};var PROPERTY_TOUCH_ENABLED="touchEnabled",PROPERTY_IS_TOUCH_ENABLED="isTouchEnabled",PROPERTY_ACCELEROMETER_ENABLED="accelerometerEnabled",PROPERTY_IS_ACCELEROMETER_ENABLED="isAccelerometerEnabled",PROPERTY_IS_MOUSE_ENABLED="isMouseEnabled",PROPERTY_MOUSE_ENABLED="mouseEnabled",PROPERTY_KEYBOARD_ENABLED="keyboardEnabled",PROPERTY_IS_KEYBOARD_ENABLED="isKeyboardEnabled";cc.LayerLoader=cc.NodeLoader.extend({_createCCNode:function(){var t=new cc.Layer;return t.setContentSize(0,0),t},onHandlePropTypeCheck:function(t,e,i,n,r){i!==PROPERTY_TOUCH_ENABLED&&i!==PROPERTY_IS_TOUCH_ENABLED&&i!==PROPERTY_ACCELEROMETER_ENABLED&&i!==PROPERTY_IS_ACCELEROMETER_ENABLED&&i!==PROPERTY_MOUSE_ENABLED&&i!==PROPERTY_IS_MOUSE_ENABLED&&(i===PROPERTY_KEYBOARD_ENABLED||i===PROPERTY_IS_KEYBOARD_ENABLED?t.setKeyboardEnabled&&!cc.sys.isNative?t.setKeyboardEnabled(n):cc.log("The property '"+PROPERTY_IS_KEYBOARD_ENABLED+"' is not supported!"):cc.NodeLoader.prototype.onHandlePropTypeCheck.call(this,t,e,i,n,r))}}),cc.LayerLoader.loader=function(){return new cc.LayerLoader},cc.LayerColorLoader=cc.LayerLoader.extend({_createCCNode:function(){return new cc.LayerColor},onHandlePropTypeColor3:function(t,e,i,n,r){i===PROPERTY_COLOR?t.setColor(n):cc.LayerLoader.prototype.onHandlePropTypeColor3.call(this,t,e,i,n,r)},onHandlePropTypeByte:function(t,e,i,n,r){i===PROPERTY_OPACITY?t.setOpacity(n):cc.LayerLoader.prototype.onHandlePropTypeByte.call(this,t,e,i,n,r)},onHandlePropTypeBlendFunc:function(t,e,i,n,r){i===PROPERTY_BLENDFUNC?t.setBlendFunc(n):cc.LayerLoader.prototype.onHandlePropTypeBlendFunc.call(this,t,e,i,n,r)}}),cc.LayerColorLoader.loader=function(){return new cc.LayerColorLoader};var PROPERTY_STARTCOLOR="startColor",PROPERTY_ENDCOLOR="endColor",PROPERTY_STARTOPACITY="startOpacity",PROPERTY_ENDOPACITY="endOpacity",PROPERTY_VECTOR="vector";cc.LayerGradientLoader=cc.LayerLoader.extend({_createCCNode:function(){return new cc.LayerGradient},onHandlePropTypeColor3:function(t,e,i,n,r){i===PROPERTY_STARTCOLOR?t.setStartColor(n):i===PROPERTY_ENDCOLOR?t.setEndColor(n):cc.LayerLoader.prototype.onHandlePropTypeColor3.call(this,t,e,i,n,r)},onHandlePropTypeByte:function(t,e,i,n,r){i===PROPERTY_STARTOPACITY?t.setStartOpacity(n):i===PROPERTY_ENDOPACITY?t.setEndOpacity(n):cc.LayerLoader.prototype.onHandlePropTypeByte.call(this,t,e,i,n,r)},onHandlePropTypePoint:function(t,e,i,n,r){i===PROPERTY_VECTOR?t.setVector(n):cc.LayerLoader.prototype.onHandlePropTypePoint.call(this,t,e,i,n,r)},onHandlePropTypeBlendFunc:function(t,e,i,n,r){i===PROPERTY_BLENDFUNC?t.setBlendFunc(n):cc.LayerLoader.prototype.onHandlePropTypeBlendFunc.call(this,t,e,i,n,r)}}),cc.LayerGradientLoader.loader=function(){return new cc.LayerGradientLoader},cc.MenuLoader=cc.LayerLoader.extend({_createCCNode:function(){var t=new cc.Menu;return t.setContentSize(0,0),t}}),cc.MenuLoader.loader=function(){return new cc.MenuLoader};var PROPERTY_BLOCK="block",PROPERTY_ISENABLED="isEnabled";cc.MenuItemLoader=cc.NodeLoader.extend({_createCCNode:function(){return null},onHandlePropTypeBlock:function(t,e,i,n,r){i===PROPERTY_BLOCK?null!=n&&t.setTarget(n.selMenuHander,n.target):cc.NodeLoader.prototype.onHandlePropTypeBlock.call(this,t,e,i,n,r)},onHandlePropTypeCheck:function(t,e,i,n,r){i===PROPERTY_ISENABLED?t.setEnabled(n):cc.NodeLoader.prototype.onHandlePropTypeCheck.call(this,t,e,i,n,r)}});var PROPERTY_NORMALDISPLAYFRAME="normalSpriteFrame",PROPERTY_SELECTEDDISPLAYFRAME="selectedSpriteFrame",PROPERTY_DISABLEDDISPLAYFRAME="disabledSpriteFrame";cc.MenuItemImageLoader=cc.MenuItemLoader.extend({_createCCNode:function(){return new cc.MenuItemImage},onHandlePropTypeSpriteFrame:function(t,e,i,n,r){i===PROPERTY_NORMALDISPLAYFRAME?null!=n&&t.setNormalSpriteFrame(n):i===PROPERTY_SELECTEDDISPLAYFRAME?null!=n&&t.setSelectedSpriteFrame(n):i===PROPERTY_DISABLEDDISPLAYFRAME?null!=n&&t.setDisabledSpriteFrame(n):cc.MenuItemLoader.prototype.onHandlePropTypeSpriteFrame.call(this,t,e,i,n,r)}}),cc.MenuItemImageLoader.loader=function(){return new cc.MenuItemImageLoader};var PROPERTY_FONTNAME="fontName",PROPERTY_FONTSIZE="fontSize",PROPERTY_HORIZONTALALIGNMENT="horizontalAlignment",PROPERTY_VERTICALALIGNMENT="verticalAlignment",PROPERTY_STRING="string",PROPERTY_DIMENSIONS="dimensions";cc.LabelTTFLoader=cc.NodeLoader.extend({_createCCNode:function(){return new cc.LabelTTF},onHandlePropTypeColor3:function(t,e,i,n,r){i===PROPERTY_COLOR?255===n.r&&255===n.g&&255===n.b||t.setColor(n):cc.NodeLoader.prototype.onHandlePropTypeColor3.call(this,t,e,i,n,r)},onHandlePropTypeByte:function(t,e,i,n,r){i===PROPERTY_OPACITY?t.setOpacity(n):cc.NodeLoader.prototype.onHandlePropTypeByte.call(this,t,e,i,n,r)},onHandlePropTypeBlendFunc:function(t,e,i,n,r){i===PROPERTY_BLENDFUNC?t.setBlendFunc(n):cc.NodeLoader.prototype.onHandlePropTypeBlendFunc.call(this,t,e,i,n,r)},onHandlePropTypeFontTTF:function(t,e,i,n,r){i===PROPERTY_FONTNAME?t.setFontName(n):cc.NodeLoader.prototype.onHandlePropTypeFontTTF.call(this,t,e,i,n,r)},onHandlePropTypeText:function(t,e,i,n,r){i===PROPERTY_STRING?t.setString(n):cc.NodeLoader.prototype.onHandlePropTypeText.call(this,t,e,i,n,r)},onHandlePropTypeFloatScale:function(t,e,i,n,r){i===PROPERTY_FONTSIZE?t.setFontSize(n):cc.NodeLoader.prototype.onHandlePropTypeFloatScale.call(this,t,e,i,n,r)},onHandlePropTypeIntegerLabeled:function(t,e,i,n,r){i===PROPERTY_HORIZONTALALIGNMENT?t.setHorizontalAlignment(n):i===PROPERTY_VERTICALALIGNMENT?t.setVerticalAlignment(n):cc.NodeLoader.prototype.onHandlePropTypeIntegerLabeled.call(this,t,e,i,n,r)},onHandlePropTypeSize:function(t,e,i,n,r){i===PROPERTY_DIMENSIONS?t.setDimensions(n):cc.NodeLoader.prototype.onHandlePropTypeSize.call(this,t,e,i,n,r)}}),cc.LabelTTFLoader.loader=function(){return new cc.LabelTTFLoader};var PROPERTY_FNTFILE="fntFile";cc.LabelBMFontLoader=cc.NodeLoader.extend({_createCCNode:function(){return new cc.LabelBMFont},onHandlePropTypeColor3:function(t,e,i,n,r){i===PROPERTY_COLOR?255===n.r&&255===n.g&&255===n.b||t.setColor(n):cc.NodeLoader.prototype.onHandlePropTypeColor3.call(this,t,e,i,n,r)},onHandlePropTypeByte:function(t,e,i,n,r){i===PROPERTY_OPACITY?t.setOpacity(n):cc.NodeLoader.prototype.onHandlePropTypeByte.call(this,t,e,i,n,r)},onHandlePropTypeBlendFunc:function(t,e,i,n,r){i===PROPERTY_BLENDFUNC?t.setBlendFunc(n):cc.NodeLoader.prototype.onHandlePropTypeBlendFunc.call(this,t,e,i,n,r)},onHandlePropTypeFntFile:function(t,e,i,n,r){i===PROPERTY_FNTFILE?t.setFntFile(n):cc.NodeLoader.prototype.onHandlePropTypeFntFile.call(this,t,e,i,n,r)},onHandlePropTypeText:function(t,e,i,n,r){i===PROPERTY_STRING?t.setString(n):cc.NodeLoader.prototype.onHandlePropTypeText.call(this,t,e,i,n,r)}}),cc.LabelBMFontLoader.loader=function(){return new cc.LabelBMFontLoader};var PROPERTY_EMITERMODE="emitterMode",PROPERTY_POSVAR="posVar",PROPERTY_EMISSIONRATE="emissionRate",PROPERTY_DURATION="duration",PROPERTY_TOTALPARTICLES="totalParticles",PROPERTY_LIFE="life",PROPERTY_STARTSIZE="startSize",PROPERTY_ENDSIZE="endSize",PROPERTY_STARTSPIN="startSpin",PROPERTY_ENDSPIN="endSpin",PROPERTY_ANGLE="angle",PROPERTY_GRAVITY="gravity",PROPERTY_SPEED="speed",PROPERTY_TANGENTIALACCEL="tangentialAccel",PROPERTY_RADIALACCEL="radialAccel",PROPERTY_TEXTURE="texture",PROPERTY_STARTRADIUS="startRadius",PROPERTY_ENDRADIUS="endRadius",PROPERTY_ROTATEPERSECOND="rotatePerSecond";cc.ParticleSystemLoader=cc.NodeLoader.extend({_createCCNode:function(){return new cc.ParticleSystem},onHandlePropTypeIntegerLabeled:function(t,e,i,n,r){i===PROPERTY_EMITERMODE?t.setEmitterMode(n):cc.NodeLoader.prototype.onHandlePropTypeIntegerLabeled.call(this,t,e,i,n,r)},onHandlePropTypePoint:function(t,e,i,n,r){i===PROPERTY_POSVAR?t.setPosVar(n):i===PROPERTY_GRAVITY?t.setGravity(n):cc.NodeLoader.prototype.onHandlePropTypePoint.call(this,t,e,i,n,r)},onHandlePropTypeFloat:function(t,e,i,n,r){i===PROPERTY_EMISSIONRATE?t.setEmissionRate(n):i===PROPERTY_DURATION?t.setDuration(n):cc.NodeLoader.prototype.onHandlePropTypeFloat.call(this,t,e,i,n,r)},onHandlePropTypeInteger:function(t,e,i,n,r){i===PROPERTY_TOTALPARTICLES?t.setTotalParticles(n):cc.NodeLoader.prototype.onHandlePropTypeInteger.call(this,t,e,i,n,r)},onHandlePropTypeFloatVar:function(t,e,i,n,r){i===PROPERTY_LIFE?(t.setLife(n[0]),t.setLifeVar(n[1])):i===PROPERTY_STARTSIZE?(t.setStartSize(n[0]),t.setStartSizeVar(n[1])):i===PROPERTY_ENDSIZE?(t.setEndSize(n[0]),t.setEndSizeVar(n[1])):i===PROPERTY_STARTSPIN?(t.setStartSpin(n[0]),t.setStartSpinVar(n[1])):i===PROPERTY_ENDSPIN?(t.setEndSpin(n[0]),t.setEndSpinVar(n[1])):i===PROPERTY_ANGLE?(t.setAngle(n[0]),t.setAngleVar(n[1])):i===PROPERTY_SPEED?(t.setSpeed(n[0]),t.setSpeedVar(n[1])):i===PROPERTY_TANGENTIALACCEL?(t.setTangentialAccel(n[0]),t.setTangentialAccelVar(n[1])):i===PROPERTY_RADIALACCEL?(t.setRadialAccel(n[0]),t.setRadialAccelVar(n[1])):i===PROPERTY_STARTRADIUS?(t.setStartRadius(n[0]),t.setStartRadiusVar(n[1])):i===PROPERTY_ENDRADIUS?(t.setEndRadius(n[0]),t.setEndRadiusVar(n[1])):i===PROPERTY_ROTATEPERSECOND?(t.setRotatePerSecond(n[0]),t.setRotatePerSecondVar(n[1])):cc.NodeLoader.prototype.onHandlePropTypeFloatVar.call(this,t,e,i,n,r)},onHandlePropTypeColor4FVar:function(t,e,i,n,r){i===PROPERTY_STARTCOLOR?(t.setStartColor(n[0]),t.setStartColorVar(n[1])):i===PROPERTY_ENDCOLOR?(t.setEndColor(n[0]),t.setEndColorVar(n[1])):cc.NodeLoader.prototype.onHandlePropTypeColor4FVar.call(this,t,e,i,n,r)},onHandlePropTypeBlendFunc:function(t,e,i,n,r){i===PROPERTY_BLENDFUNC?t.setBlendFunc(n):cc.NodeLoader.prototype.onHandlePropTypeBlendFunc.call(this,t,e,i,n,r)},onHandlePropTypeTexture:function(t,e,i,n,r){i===PROPERTY_TEXTURE?t.setTexture(n):cc.NodeLoader.prototype.onHandlePropTypeTexture.call(this,t,e,i,n,r)}}),cc.ParticleSystemLoader.loader=function(){return new cc.ParticleSystemLoader},cc.NodeLoaderLibrary=cc.Class.extend({_ccNodeLoaders:null,ctor:function(){this._ccNodeLoaders={}},registerDefaultCCNodeLoaders:function(){this.registerCCNodeLoader("CCNode",cc.NodeLoader.loader()),this.registerCCNodeLoader("CCLayer",cc.LayerLoader.loader()),this.registerCCNodeLoader("CCLayerColor",cc.LayerColorLoader.loader()),this.registerCCNodeLoader("CCLayerGradient",cc.LayerGradientLoader.loader()),this.registerCCNodeLoader("CCSprite",cc.SpriteLoader.loader()),this.registerCCNodeLoader("CCLabelBMFont",cc.LabelBMFontLoader.loader()),this.registerCCNodeLoader("CCLabelTTF",cc.LabelTTFLoader.loader()),this.registerCCNodeLoader("CCScale9Sprite",cc.Scale9SpriteLoader.loader()),this.registerCCNodeLoader("CCScrollView",cc.ScrollViewLoader.loader()),this.registerCCNodeLoader("CCBFile",cc.BuilderFileLoader.loader()),this.registerCCNodeLoader("CCMenu",cc.MenuLoader.loader()),this.registerCCNodeLoader("CCMenuItemImage",cc.MenuItemImageLoader.loader()),this.registerCCNodeLoader("CCControlButton",cc.ControlButtonLoader.loader()),this.registerCCNodeLoader("CCParticleSystemQuad",cc.ParticleSystemLoader.loader())},registerCCNodeLoader:function(t,e){this._ccNodeLoaders[t]=e},unregisterCCNodeLoader:function(t){this._ccNodeLoaders[t]&&delete this._ccNodeLoaders[t]},getCCNodeLoader:function(t){return this._ccNodeLoaders[t]?this._ccNodeLoaders[t]:null},purge:function(t){if(t)for(var e in this._ccNodeLoaders)delete this._ccNodeLoaders[e];this._ccNodeLoaders={}}}),cc.NodeLoaderLibrary.sSharedCCNodeLoaderLibrary=null,cc.NodeLoaderLibrary.library=function(){return new cc.NodeLoaderLibrary},cc.NodeLoaderLibrary.sharedCCNodeLoaderLibrary=function(){return null==cc.NodeLoaderLibrary.sSharedCCNodeLoaderLibrary&&(cc.NodeLoaderLibrary.sSharedCCNodeLoaderLibrary=new cc.NodeLoaderLibrary,cc.NodeLoaderLibrary.sSharedCCNodeLoaderLibrary.registerDefaultCCNodeLoaders()),cc.NodeLoaderLibrary.sSharedCCNodeLoaderLibrary},cc.NodeLoaderLibrary.purgeSharedCCNodeLoaderLibrary=function(){cc.NodeLoaderLibrary.sSharedCCNodeLoaderLibrary=null},cc.NodeLoaderLibrary.newDefaultCCNodeLoaderLibrary=function(){var t=cc.NodeLoaderLibrary.library();return t.registerDefaultCCNodeLoaders(),t};var CCB_VERSION=5,CCB_PROPTYPE_POSITION=0,CCB_PROPTYPE_SIZE=1,CCB_PROPTYPE_POINT=2,CCB_PROPTYPE_POINTLOCK=3,CCB_PROPTYPE_SCALELOCK=4,CCB_PROPTYPE_DEGREES=5,CCB_PROPTYPE_INTEGER=6,CCB_PROPTYPE_FLOAT=7,CCB_PROPTYPE_FLOATVAR=8,CCB_PROPTYPE_CHECK=9,CCB_PROPTYPE_SPRITEFRAME=10,CCB_PROPTYPE_TEXTURE=11,CCB_PROPTYPE_BYTE=12,CCB_PROPTYPE_COLOR3=13,CCB_PROPTYPE_COLOR4VAR=14,CCB_PROPTYPE_FLIP=15,CCB_PROPTYPE_BLENDMODE=16,CCB_PROPTYPE_FNTFILE=17,CCB_PROPTYPE_TEXT=18,CCB_PROPTYPE_FONTTTF=19,CCB_PROPTYPE_INTEGERLABELED=20,CCB_PROPTYPE_BLOCK=21,CCB_PROPTYPE_ANIMATION=22,CCB_PROPTYPE_CCBFILE=23,CCB_PROPTYPE_STRING=24,CCB_PROPTYPE_BLOCKCCCONTROL=25,CCB_PROPTYPE_FLOATSCALE=26,CCB_PROPTYPE_FLOATXY=27,CCB_FLOAT0=0,CCB_FLOAT1=1,CCB_FLOAT_MINUS1=2,CCB_FLOAT05=3,CCB_FLOAT_INTEGER=4,CCB_FLOAT_FULL=5,CCB_PLATFORM_ALL=0,CCB_PLATFORM_IOS=1,CCB_PLATFORM_MAC=2,CCB_TARGETTYPE_NONE=0,CCB_TARGETTYPE_DOCUMENTROOT=1,CCB_TARGETTYPE_OWNER=2,CCB_KEYFRAME_EASING_INSTANT=0,CCB_KEYFRAME_EASING_LINEAR=1,CCB_KEYFRAME_EASING_CUBIC_IN=2,CCB_KEYFRAME_EASING_CUBIC_OUT=3,CCB_KEYFRAME_EASING_CUBIC_INOUT=4,CCB_KEYFRAME_EASING_ELASTIC_IN=5,CCB_KEYFRAME_EASING_ELASTIC_OUT=6,CCB_KEYFRAME_EASING_ELASTIC_INOUT=7,CCB_KEYFRAME_EASING_BOUNCE_IN=8,CCB_KEYFRAME_EASING_BOUNCE_OUT=9,CCB_KEYFRAME_EASING_BOUNCE_INOUT=10,CCB_KEYFRAME_EASING_BACK_IN=11,CCB_KEYFRAME_EASING_BACK_OUT=12,CCB_KEYFRAME_EASING_BACK_INOUT=13,CCB_POSITIONTYPE_RELATIVE_BOTTOM_LEFT=0,CCB_POSITIONTYPE_RELATIVE_TOP_LEFT=1,CCB_POSITIONTYPE_RELATIVE_TOP_RIGHT=2,CCB_POSITIONTYPE_RELATIVE_BOTTOM_RIGHT=3,CCB_POSITIONTYPE_PERCENT=4,CCB_POSITIONTYPE_MULTIPLY_RESOLUTION=5,CCB_SIZETYPE_ABSOLUTE=0,CCB_SIZETYPE_PERCENT=1,CCB_SIZETYPE_RELATIVE_CONTAINER=2,CCB_SIZETYPE_HORIZONTAL_PERCENT=3,CCB_SIZETYPE_VERTICAL_PERCENT=4,CCB_SIZETYPE_MULTIPLY_RESOLUTION=5,CCB_SCALETYPE_ABSOLUTE=0,CCB_SCALETYPE_MULTIPLY_RESOLUTION=1;cc.BuilderFile=cc.Node.extend({_ccbFileNode:null,getCCBFileNode:function(){return this._ccbFileNode},setCCBFileNode:function(t){this._ccbFileNode=t}}),cc.BuilderFile.create=function(){return new cc.BuilderFile},cc.BuilderReader=cc.Class.extend({_jsControlled:!1,_data:null,_ccbRootPath:"",_bytes:0,_currentByte:0,_currentBit:0,_stringCache:null,_loadedSpriteSheets:null,_owner:null,_animationManager:null,_animationManagers:null,_animatedProps:null,_ccNodeLoaderLibrary:null,_ccNodeLoaderListener:null,_ccbMemberVariableAssigner:null,_ccbSelectorResolver:null,_ownerOutletNames:null,_ownerOutletNodes:null,_nodesWithAnimationManagers:null,_animationManagerForNodes:null,_ownerCallbackNames:null,_ownerCallbackNodes:null,_ownerCallbackEvents:null,_readNodeGraphFromData:!1,ctor:function(t,e,i,n){this._stringCache=[],this._loadedSpriteSheets=[],this._currentByte=this._currentBit=-1,0!==arguments.length&&(t instanceof cc.BuilderReader?(this._loadedSpriteSheets=t._loadedSpriteSheets,this._ccNodeLoaderLibrary=t._ccNodeLoaderLibrary,this._ccbMemberVariableAssigner=t._ccbMemberVariableAssigner,this._ccbSelectorResolver=t._ccbSelectorResolver,this._ccNodeLoaderListener=t._ccNodeLoaderListener,this._ownerCallbackNames=t._ownerCallbackNames,this._ownerCallbackNodes=t._ownerCallbackNodes,this._ownerCallbackEvents=t._ownerCallbackEvents,this._ownerOutletNames=t._ownerOutletNames,this._ownerOutletNodes=t._ownerOutletNodes,this._ccbRootPath=t._ccbRootPath):(this._ccNodeLoaderLibrary=t,this._ccbMemberVariableAssigner=e,this._ccbSelectorResolver=i,this._ccNodeLoaderListener=n))},getCCBRootPath:function(){return this._ccbRootPath},setCCBRootPath:function(t){this._ccbRootPath=t},initWithData:function(t,e){return this._animationManager=new cc.BuilderAnimationManager,this._data=t,this._bytes=t.length,this._currentByte=this._currentBit=0,this._owner=e,this._animationManager.setRootContainerSize(cc.director.getWinSize()),!0},_loadBinarySync:function(t){var e=this.getXMLHttpRequest(),i="load "+t+" failed!";e.open("GET",t,!1);var n=null;if(/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)){if(e.setRequestHeader("Accept-Charset","x-user-defined"),e.send(null),200!==e.status)return cc.log(i),null;(e=cc._convertResponseBodyToText(e.responseBody))&&(n=this._stringConvertToArray(e),this._fileDataCache[t]=n)}else{if(e.overrideMimeType&&e.overrideMimeType("text/plain; charset=x-user-defined"),e.send(null),200!==e.status)return cc.log(i),null;n=this._stringConvertToArray(e.responseText),this._fileDataCache[t]=n}return n},readNodeGraphFromFile:function(t,e,i,n){null==i?i=cc.director.getWinSize():i instanceof cc.BuilderAnimationManager&&(n=i,i=cc.director.getWinSize());var r=cc.loader.getRes(t);return r||(r=cc.loader.getUrl(t),r=cc.loader.loadBinarySync(r),cc.loader.cache[t]=r),this.readNodeGraphFromData(r,e,i,n)},readNodeGraphFromData:function(t,e,i){if(this.initWithData(t,e),t=this._animationManager,t.setRootContainerSize(i),t.setOwner(e),this._ownerOutletNames=[],this._ownerOutletNodes=[],this._ownerCallbackNames=[],this._ownerCallbackNodes=[],this._ownerCallbackEvents=[],this._animationManagers=new cc._Dictionary,(e=this.readFileWithCleanUp(!0))&&-1!==t.getAutoPlaySequenceId()&&t.runAnimations(t.getAutoPlaySequenceId(),0),this._jsControlled){i=[],t=[];for(var n=this._animationManagers,r=n.allKeys(),o=0;o<r.length;o++)i.push(r[o]),t.push(n.objectForKey(r[o]));this._nodesWithAnimationManagers=i,this._animationManagerForNodes=t}return e},createSceneWithNodeGraphFromFile:function(t,e,i,n){return t=this.readNodeGraphFromFile(t,e,i,n),e=new cc.Scene,e.addChild(t),e},getCCBMemberVariableAssigner:function(){return this._ccbMemberVariableAssigner},getCCBSelectorResolver:function(){return this._ccbSelectorResolver},getAnimationManager:function(){return this._animationManager},setAnimationManager:function(t){this._animationManager=t},getAnimatedProperties:function(){return this._animatedProps},getLoadedSpriteSheet:function(){return this._loadedSpriteSheets},getOwner:function(){return this._owner},readInt:function(t){for(var e=0;!this._getBit();)e++;for(var i=0,n=e-1;n>=0;n--)this._getBit()&&(i|=1<<n);return i|=1<<e,t=t?i%2?0|i/2:0|-i/2:i-1,this._alignBits(),t},readByte:function(){var t=this._data[this._currentByte];return this._currentByte++,t},readBool:function(){return 0!==this.readByte()},readFloat:function(){switch(this.readByte()){case CCB_FLOAT0:return 0;case CCB_FLOAT1:return 1;case CCB_FLOAT_MINUS1:return-1;case CCB_FLOAT05:return.5;case CCB_FLOAT_INTEGER:return this.readInt(!0);default:return this._decodeFloat(23,8)}},_decodeFloat:function(t,e){var i=t+e+1,n=i>>3;this._checkSize(i);var i=Math.pow(2,e-1)-1,r=this._readBitsOnly(t+e,1,n),o=this._readBitsOnly(t,e,n),s=0,c=2,a=0;do for(var l=this._readByteOnly(++a,n),h=t%8||8,u=1<<h;u>>=1;)l&u&&(s+=1/c),c*=2;while(t-=h);return this._currentByte+=n,o===(i<<1)+1?s?0/0:r?-1/0:1/0:(1+-2*r)*(o||s?o?Math.pow(2,o-i)*(1+s):Math.pow(2,-i+1)*s:0)},_readBitsOnly:function(t,e,i){var n=(t+e)%8,r=t%8,o=i-(t>>3)-1;t=i+(-(t+e)>>3);var s=o-t;for(e=this._readByteOnly(o,i)>>r&(1<<(s?8-r:e))-1,s&&n&&(e+=(this._readByteOnly(t++,i)&(1<<n)-1)<<(s--<<3)-r);s;)e+=this._shl(this._readByteOnly(t++,i),(s--<<3)-r);
return e},_readByteOnly:function(t,e){return this._data[this._currentByte+e-t-1]},_shl:function(t,e){for(++e;--e;t=1073741824===(1073741824&(t%=2147483648))?2*t:2*(t-1073741824)+2147483648);return t},_checkSize:function(t){if(!(this._currentByte+Math.ceil(t/8)<this._data.length))throw Error("Index out of bound")},readCachedString:function(){return this._stringCache[this.readInt(!1)]},isJSControlled:function(){return this._jsControlled},getOwnerCallbackNames:function(){return this._ownerCallbackNames},getOwnerCallbackNodes:function(){return this._ownerCallbackNodes},getOwnerCallbackControlEvents:function(){return this._ownerCallbackEvents},getOwnerOutletNames:function(){return this._ownerOutletNames},getOwnerOutletNodes:function(){return this._ownerOutletNodes},getNodesWithAnimationManagers:function(){return this._nodesWithAnimationManagers},getAnimationManagersForNodes:function(){return this._animationManagerForNodes},getAnimationManagers:function(){return this._animationManagers},setAnimationManagers:function(t){this._animationManagers=t},addOwnerCallbackName:function(t){this._ownerCallbackNames.push(t)},addOwnerCallbackNode:function(t){this._ownerCallbackNodes.push(t)},addOwnerCallbackControlEvents:function(t){this._ownerCallbackEvents.push(t)},addDocumentCallbackName:function(t){this._animationManager.addDocumentCallbackName(t)},addDocumentCallbackNode:function(t){this._animationManager.addDocumentCallbackNode(t)},addDocumentCallbackControlEvents:function(t){this._animationManager.addDocumentCallbackControlEvents(t)},readFileWithCleanUp:function(t){if(!this._readHeader()||!this._readStringCache()||!this._readSequences())return null;var e=this._readNodeGraph();return this._animationManagers.setObject(this._animationManager,e),t&&this._cleanUpNodeGraph(e),e},addOwnerOutletName:function(t){this._ownerOutletNames.push(t)},addOwnerOutletNode:function(t){null!=t&&this._ownerOutletNodes.push(t)},_cleanUpNodeGraph:function(t){t.userObject=null,t=t.getChildren();for(var e=0,i=t.length;i>e;e++)this._cleanUpNodeGraph(t[e])},_readCallbackKeyframesForSeq:function(t){var e=this.readInt(!1);if(!e)return!0;for(var i=new cc.BuilderSequenceProperty,n=this._jsControlled,r=this._animationManager,o=i.getKeyframes(),s=0;e>s;s++){var c=this.readFloat(),a=this.readCachedString(),l=this.readInt(!1),h=[a,l],u=new cc.BuilderKeyframe;u.setTime(c),u.setValue(h),n&&r.getKeyframeCallbacks().push(l+":"+a),o.push(u)}return t.setCallbackChannel(i),!0},_readSoundKeyframesForSeq:function(t){var e=this.readInt(!1);if(!e)return!0;for(var i=new cc.BuilderSequenceProperty,n=i.getKeyframes(),r=0;e>r;r++){var o=this.readFloat(),s=this.readCachedString(),c=this.readFloat(),a=this.readFloat(),l=this.readFloat(),s=[s,c,a,l],c=new cc.BuilderKeyframe;c.setTime(o),c.setValue(s),n.push(c)}return t.setSoundChannel(i),!0},_readSequences:function(){for(var t=this._animationManager.getSequences(),e=this.readInt(!1),i=0;e>i;i++){var n=new cc.BuilderSequence;if(n.setDuration(this.readFloat()),n.setName(this.readCachedString()),n.setSequenceId(this.readInt(!1)),n.setChainedSequenceId(this.readInt(!0)),!this._readCallbackKeyframesForSeq(n)||!this._readSoundKeyframesForSeq(n))return!1;t.push(n)}return this._animationManager.setAutoPlaySequenceId(this.readInt(!0)),!0},readKeyframe:function(t){var e=new cc.BuilderKeyframe;e.setTime(this.readFloat());var i=this.readInt(!1),n=0,r=null;return(i===CCB_KEYFRAME_EASING_CUBIC_IN||i===CCB_KEYFRAME_EASING_CUBIC_OUT||i===CCB_KEYFRAME_EASING_CUBIC_INOUT||i===CCB_KEYFRAME_EASING_ELASTIC_IN||i===CCB_KEYFRAME_EASING_ELASTIC_OUT||i===CCB_KEYFRAME_EASING_ELASTIC_INOUT)&&(n=this.readFloat()),e.setEasingType(i),e.setEasingOpt(n),t===CCB_PROPTYPE_CHECK?r=this.readBool():t===CCB_PROPTYPE_BYTE?r=this.readByte():t===CCB_PROPTYPE_COLOR3?(t=cc.color(this.readByte(),this.readByte(),this.readByte()),r=cc.Color3BWapper.create(t)):t===CCB_PROPTYPE_FLOATXY?r=[this.readFloat(),this.readFloat()]:t===CCB_PROPTYPE_DEGREES?r=this.readFloat():t===CCB_PROPTYPE_SCALELOCK||t===CCB_PROPTYPE_POSITION||t===CCB_PROPTYPE_FLOATXY?r=[this.readFloat(),this.readFloat()]:t===CCB_PROPTYPE_SPRITEFRAME&&(t=this.readCachedString(),i=this.readCachedString(),""===t?(i=this._ccbRootPath+i,t=cc.textureCache.addImage(i),i=t.getContentSize(),i=cc.rect(0,0,i.width,i.height),r=new cc.SpriteFrame(t,i)):(t=this._ccbRootPath+t,n=cc.spriteFrameCache,-1===this._loadedSpriteSheets.indexOf(t)&&(n.addSpriteFrames(t),this._loadedSpriteSheets.push(t)),r=n.getSpriteFrame(i))),e.setValue(r),e},_readHeader:function(){if(!this._data)return!1;var t=this._readStringFromBytes(this._currentByte,4,!0);return this._currentByte+=4,"ccbi"!==t?!1:(t=this.readInt(!1),t!==CCB_VERSION?(cc.log("WARNING! Incompatible ccbi file version (file: "+t+" reader: "+CCB_VERSION+")"),!1):(this._jsControlled=this.readBool(),this._animationManager._jsControlled=this._jsControlled,!0))},_readStringFromBytes:function(t,e,i){t="";var n=this._data,r=this._currentByte;if(i)for(i=e-1;i>=0;i--)t+=String.fromCharCode(n[r+i]);else for(i=0;e>i;i++)t+=String.fromCharCode(n[r+i]);return t},_readStringCache:function(){for(var t=this.readInt(!1),e=0;t>e;e++)this._readStringCacheEntry();return!0},_readStringCacheEntry:function(){for(var t=this.readByte(),e=this.readByte(),t=t<<8|e,e="",i=this._data,n=this._currentByte,r=0;t>r;r++)var o=i[n+r].toString("16").toUpperCase(),o=1<o.length?o:"0"+o,e=e+("%"+o);e=decodeURIComponent(e),this._currentByte+=t,this._stringCache.push(e)},_readNodeGraph:function(t){var e,i=this.readCachedString(),n=this._jsControlled,r=this._animationManager;n&&(e=this.readCachedString());var o,s=this.readInt(!1);s!==CCB_TARGETTYPE_NONE&&(o=this.readCachedString()),(i=this._ccNodeLoaderLibrary.getCCNodeLoader(i))||(i=this._ccNodeLoaderLibrary.getCCNodeLoader("CCNode"));var c=i.loadCCNode(t,this);r.getRootNode()||r.setRootNode(c),n&&c===r.getRootNode()&&r.setDocumentControllerName(e);var a=new cc._Dictionary,l=this._animatedProps=[],h=this.readInt(!1);for(e=0;h>e;++e){for(var u=this.readInt(!1),d=new cc._Dictionary,_=this.readInt(!1),p=0;_>p;++p){var f=new cc.BuilderSequenceProperty;f.setName(this.readCachedString()),f.setType(this.readInt(!1)),l.push(f.getName());for(var m=this.readInt(!1),g=f.getKeyframes(),y=0;m>y;++y){var T=this.readKeyframe(f.getType());g.push(T)}d.setObject(f,f.getName())}a.setObject(d,u)}if(0<a.count()&&r.addNode(c,a),i.parseProperties(c,t,this),(t=c instanceof cc.BuilderFile)&&(e=c.getCCBFileNode(),e.setPosition(c.getPosition()),e.setRotation(c.getRotation()),e.setScaleX(c.getScaleX()),e.setScaleY(c.getScaleY()),e.setTag(c.getTag()),e.setVisible(!0),r.moveAnimationsFromNode(c,e),c.setCCBFileNode(null),c=e),l=a=null,s!==CCB_TARGETTYPE_NONE&&(n?s===CCB_TARGETTYPE_DOCUMENTROOT?(r.addDocumentOutletName(o),r.addDocumentOutletNode(c)):(this._ownerOutletNames.push(o),this._ownerOutletNodes.push(c)):(s===CCB_TARGETTYPE_DOCUMENTROOT?a=r.getRootNode():s===CCB_TARGETTYPE_OWNER&&(a=this._owner),a||(e=!1,a.onAssignCCBMemberVariable&&(e=a.onAssignCCBMemberVariable(a,o,c)),l=this._ccbMemberVariableAssigner,e||null==l||!l.onAssignCCBMemberVariable)||l.onAssignCCBMemberVariable(a,o,c))),0<i.getCustomProperties().length&&(o=!1,!n&&(a=c,null!=a&&null!=a.onAssignCCBCustomProperty)))for(n=i.getCustomProperties(),r=n.allKeys(),e=0;e<r.length;e++)s=n.objectForKey(r[e]),o=a.onAssignCCBCustomProperty(a,r[e],s),l=this._ccbMemberVariableAssigner,o||null==l||null==l.onAssignCCBCustomProperty||l.onAssignCCBCustomProperty(a,r[e],s);for(this._animatedProps=null,n=this.readInt(!1),e=0;n>e;e++)o=this._readNodeGraph(c),c.addChild(o);return t||(null!=c&&c.onNodeLoaded?c.onNodeLoaded(c,i):null!=this._ccNodeLoaderListener&&this._ccNodeLoaderListener.onNodeLoaded(c,i)),c},_getBit:function(){var t=0!==(this._data[this._currentByte]&1<<this._currentBit);if(this._currentBit++,8<=this._currentBit&&(this._currentBit=0,this._currentByte++,this._currentByte>this._data.length))throw"out of the data bound";return t},_alignBits:function(){this._currentBit&&(this._currentBit=0,this._currentByte++)},_readUTF8:function(){}}),cc.BuilderReader._ccbResolutionScale=1,cc.BuilderReader.setResolutionScale=function(t){cc.BuilderReader._ccbResolutionScale=t},cc.BuilderReader.getResolutionScale=function(){return cc.BuilderReader._ccbResolutionScale},cc.BuilderReader.loadAsScene=function(t,e,i,n){return n=n||cc.BuilderReader.getResourcePath(),t=cc.BuilderReader.load(t,e,i,n),e=new cc.Scene,e.addChild(t),e},cc.BuilderReader._controllerClassCache={},cc.BuilderReader.registerController=function(t,e){cc.BuilderReader._controllerClassCache[t]=cc.Class.extend(e)},cc.BuilderReader.load=function(t,e,i,n){n=n||cc.BuilderReader.getResourcePath();var r=new cc.BuilderReader(cc.NodeLoaderLibrary.newDefaultCCNodeLoaderLibrary());r.setCCBRootPath(n),(5>t.length||t.toLowerCase().lastIndexOf(".ccbi")!==t.length-5)&&(t+=".ccbi"),t=r.readNodeGraphFromFile(t,e,i);var o,s,c;if(e){n=r.getOwnerCallbackNames();var a=r.getOwnerCallbackNodes(),l=r.getOwnerCallbackControlEvents();for(i=0;i<n.length;i++)o=n[i],s=a[i],c=l[i],s instanceof cc.ControlButton?s.addTargetWithActionForControlEvents(e,e[o],c):s.setCallback(e[o],e);for(n=r.getOwnerOutletNames(),a=r.getOwnerOutletNodes(),i=0;i<n.length;i++)o=n[i],s=a[i],e[o]=s}if(n=r.getNodesWithAnimationManagers(),r=r.getAnimationManagersForNodes(),!n||!r)return t;for(a=cc.BuilderReader._controllerClassCache,i=0;i<n.length;i++){var h=n[i],u=r[i];if(h.animationManager=u,o=u.getDocumentControllerName()){if(l=a[o],!l)throw"Can not find controller : "+o;l=new l,l.controllerName=o,h.controller=l,l.rootNode=h;for(var d=u.getDocumentCallbackNames(),_=u.getDocumentCallbackNodes(),p=u.getDocumentCallbackControlEvents(),h=0;h<d.length;h++)o=d[h],s=_[h],c=p[h],s instanceof cc.ControlButton?s.addTargetWithActionForControlEvents(l,l[o],c):s.setCallback(l[o],l);for(c=u.getDocumentOutletNames(),d=u.getDocumentOutletNodes(),h=0;h<c.length;h++)o=c[h],s=d[h],l[o]=s;for(l.onDidLoadFromCCB&&cc.isFunction(l.onDidLoadFromCCB)&&l.onDidLoadFromCCB(),o=u.getKeyframeCallbacks(),h=0;h<o.length;h++)c=o[h].split(":"),s=c[0],c=c[1],1==s?u.setCallFunc(cc.callFunc(l[c],l),o[h]):2==s&&e&&u.setCallFunc(cc.callFunc(e[c],e),o[h])}}return u.runAnimations(u.getAutoPlaySequenceId(),0),t},cc.BuilderReader._resourcePath="",cc.BuilderReader.setResourcePath=function(t){cc.BuilderReader._resourcePath=t},cc.BuilderReader.getResourcePath=function(){return cc.BuilderReader._resourcePath},cc.BuilderReader.lastPathComponent=function(t){var e=t.lastIndexOf("/");return-1!==e?t.substring(e+1,t.length-e):t},cc.BuilderReader.deletePathExtension=function(t){var e=t.lastIndexOf(".");return-1!==e?t.substring(0,e):t},cc.BuilderReader.toLowerCase=function(t){return t.toLowerCase()},cc.BuilderReader.endsWith=function(t,e){return t.length>=e.length?0===t.lastIndexOf(e):!1},cc.BuilderReader.concat=function(t,e){return t+e},cc.loader.register(["ccbi"],cc._binaryLoader),cc.INT_VALUE=0,cc.FLOAT_VALUE=1,cc.POINTER_VALUE=2,cc.BOOL_VALUE=3,cc.UNSIGNEDCHAR_VALUE=4,cc.Color3BWapper=cc.Class.extend({_color:null,ctor:function(){this._color=cc.color(0,0,0)},getColor:function(){return this._color}}),cc.Color3BWapper.create=function(t){var e=new cc.Color3BWapper;return e&&(e._color.r=t.r,e._color.g=t.g,e._color.b=t.b),e},cc.BuilderValue=cc.Class.extend({_value:null,_type:0,getIntValue:function(){},getFloatValue:function(){},getBoolValue:function(){},getByteValue:function(){},getPointer:function(){},getValue:function(){return this._value}}),cc.BuilderValue.create=function(){return new cc.BuilderValue},cc.BuilderKeyframe=cc.Class.extend({_value:null,_time:0,_easingType:0,_easingOpt:0,getValue:function(){return this._value},setValue:function(t){this._value=t},getTime:function(){return this._time},setTime:function(t){this._time=t},getEasingType:function(){return this._easingType},setEasingType:function(t){this._easingType=t},getEasingOpt:function(){return this._easingOpt},setEasingOpt:function(t){this._easingOpt=t}}),cc.BuilderSequence=cc.Class.extend({_duration:0,_name:"",_sequenceId:0,_chainedSequenceId:0,_callbackChannel:null,_soundChannel:null,ctor:function(){this._name=""},getDuration:function(){return this._duration},setDuration:function(t){this._duration=t},getName:function(){return this._name},setName:function(t){this._name=t},getSequenceId:function(){return this._sequenceId},setSequenceId:function(t){this._sequenceId=t},getChainedSequenceId:function(){return this._chainedSequenceId},setChainedSequenceId:function(t){this._chainedSequenceId=t},getCallbackChannel:function(){return this._callbackChannel},setCallbackChannel:function(t){this._callbackChannel=t},getSoundChannel:function(){return this._soundChannel},setSoundChannel:function(t){this._soundChannel=t}}),cc.BuilderSequenceProperty=cc.Class.extend({_name:null,_type:0,_keyFrames:null,ctor:function(){this.init()},init:function(){this._keyFrames=[],this._name=""},getName:function(){return this._name},setName:function(t){this._name=t},getType:function(){return this._type},setType:function(t){this._type=t},getKeyframes:function(){return this._keyFrames}}),cc.getAbsolutePosition=function(t,e,i,n){return n=cc.p(0,0),e===CCB_POSITIONTYPE_RELATIVE_BOTTOM_LEFT?n=t:e===CCB_POSITIONTYPE_RELATIVE_TOP_LEFT?(n.x=t.x,n.y=i.height-t.y):e===CCB_POSITIONTYPE_RELATIVE_TOP_RIGHT?(n.x=i.width-t.x,n.y=i.height-t.y):e===CCB_POSITIONTYPE_RELATIVE_BOTTOM_RIGHT?(n.x=i.width-t.x,n.y=t.y):e===CCB_POSITIONTYPE_PERCENT?(n.x=i.width*t.x/100,n.y=i.height*t.y/100):e===CCB_POSITIONTYPE_MULTIPLY_RESOLUTION&&(e=cc.BuilderReader.getResolutionScale(),n.x=t.x*e,n.y=t.y*e),n},cc._getAbsolutePosition=function(t,e,i,n,r){return r=cc.p(0,0),i===CCB_POSITIONTYPE_RELATIVE_BOTTOM_LEFT?(r.x=t,r.y=e):i===CCB_POSITIONTYPE_RELATIVE_TOP_LEFT?(r.x=t,r.y=n.height-e):i===CCB_POSITIONTYPE_RELATIVE_TOP_RIGHT?(r.x=n.width-t,r.y=n.height-e):i===CCB_POSITIONTYPE_RELATIVE_BOTTOM_RIGHT?(r.x=n.width-t,r.y=e):i===CCB_POSITIONTYPE_PERCENT?(r.x=n.width*t/100,r.y=n.height*e/100):i===CCB_POSITIONTYPE_MULTIPLY_RESOLUTION&&(i=cc.BuilderReader.getResolutionScale(),r.x=t*i,r.y=e*i),r},cc.setRelativeScale=function(t,e,i,n){if(!t)throw"cc.setRelativeScale(): node should be non-null";n===CCB_POSITIONTYPE_MULTIPLY_RESOLUTION&&(n=cc.BuilderReader.getResolutionScale(),e*=n,i*=n),t.setScaleX(e),t.setScaleY(i)},cc.BuilderAnimationManagerDelegate=cc.Class.extend({completedAnimationSequenceNamed:function(){}}),cc.BuilderAnimationManager=cc.Class.extend({_sequences:null,_nodeSequences:null,_baseValues:null,_autoPlaySequenceId:0,_rootNode:null,_owner:null,_rootContainerSize:null,_delegate:null,_runningSequence:null,_documentOutletNames:null,_documentOutletNodes:null,_documentCallbackNames:null,_documentCallbackNodes:null,_documentCallbackControlEvents:null,_documentControllerName:"",_lastCompletedSequenceName:"",_keyframeCallbacks:null,_keyframeCallFuncs:null,_animationCompleteCallbackFunc:null,_target:null,_jsControlled:!1,ctor:function(){this._rootContainerSize=cc.size(0,0),this.init()},init:function(){return this._sequences=[],this._nodeSequences=new cc._Dictionary,this._baseValues=new cc._Dictionary,this._documentOutletNames=[],this._documentOutletNodes=[],this._documentCallbackNames=[],this._documentCallbackNodes=[],this._documentCallbackControlEvents=[],this._keyframeCallbacks=[],this._keyframeCallFuncs={},!0},getSequences:function(){return this._sequences},setSequences:function(t){this._sequences=t},getAutoPlaySequenceId:function(){return this._autoPlaySequenceId},setAutoPlaySequenceId:function(t){this._autoPlaySequenceId=t},getRootNode:function(){return this._rootNode},setRootNode:function(t){this._rootNode=t},getOwner:function(){return this._owner},setOwner:function(t){this._owner=t},addDocumentCallbackNode:function(t){this._documentCallbackNodes.push(t)},addDocumentCallbackName:function(t){this._documentCallbackNames.push(t)},addDocumentCallbackControlEvents:function(t){this._documentCallbackControlEvents.push(t)},addDocumentOutletNode:function(t){this._documentOutletNodes.push(t)},addDocumentOutletName:function(t){this._documentOutletNames.push(t)},setDocumentControllerName:function(t){this._documentControllerName=t},getDocumentControllerName:function(){return this._documentControllerName},getDocumentCallbackNames:function(){return this._documentCallbackNames},getDocumentCallbackNodes:function(){return this._documentCallbackNodes},getDocumentCallbackControlEvents:function(){return this._documentCallbackControlEvents},getDocumentOutletNames:function(){return this._documentOutletNames},getDocumentOutletNodes:function(){return this._documentOutletNodes},getLastCompletedSequenceName:function(){return this._lastCompletedSequenceName},getKeyframeCallbacks:function(){return this._keyframeCallbacks},getRootContainerSize:function(){return this._rootContainerSize},setRootContainerSize:function(t){this._rootContainerSize=cc.size(t.width,t.height)},getDelegate:function(){return this._delegate},setDelegate:function(t){this._delegate=t},getRunningSequenceName:function(){return this._runningSequence?this._runningSequence.getName():null},getContainerSize:function(t){return t?t.getContentSize():this._rootContainerSize},addNode:function(t,e){this._nodeSequences.setObject(e,t)},setBaseValue:function(t,e,i){var n=this._baseValues.objectForKey(e);n||(n=new cc._Dictionary,this._baseValues.setObject(n,e)),n.setObject(t,i)},moveAnimationsFromNode:function(t,e){var i=this._baseValues,n=i.objectForKey(t);null!==n&&(i.setObject(n,e),i.removeObjectForKey(t)),i=this._nodeSequences,n=i.objectForKey(t),null!=n&&(i.setObject(n,e),i.removeObjectForKey(t))},getActionForCallbackChannel:function(t){var e=0,i=[];t=t.getKeyframes();for(var n=t.length,r=0;n>r;++r){var o=t[r],s=o.getTime()-e,e=o.getTime();if(s>0&&i.push(cc.delayTime(s)),s=o.getValue(),o=s[0],s=s[1],this._jsControlled)o=this._keyframeCallFuncs[s+":"+o],null!=o&&i.push(o);else{var c;s===CCB_TARGETTYPE_DOCUMENTROOT?c=this._rootNode:s===CCB_TARGETTYPE_OWNER&&(c=this._owner),null!=c&&(0<o.length?(s=0,null!=c.onResolveCCBCCCallFuncSelector&&(s=c.onResolveCCBCCCallFuncSelector(c,o)),0===s?cc.log("Skipping selector '"+o+"' since no CCBSelectorResolver is present."):i.push(cc.callFunc(s,c))):cc.log("Unexpected empty selector."))}}return 1>i.length?null:cc.sequence(i)},getActionForSoundChannel:function(t){var e=0,i=[];t=t.getKeyframes();for(var n=t.length,r=0;n>r;++r){var o=t[r],s=o.getTime()-e,e=o.getTime();s>0&&i.push(cc.delayTime(s));var c=o.getValue(),o=cc.BuilderReader.getResourcePath()+c[0],s=parseFloat(c[1]),a=parseFloat(c[2]),c=parseFloat(c[3]);i.push(cc.BuilderSoundEffect.create(o,s,a,c))}return 1>i.length?null:cc.sequence(i)},runAnimationsForSequenceNamed:function(t){this.runAnimationsForSequenceIdTweenDuration(this._getSequenceId(t),0)},runAnimationsForSequenceNamedTweenDuration:function(t,e){this.runAnimationsForSequenceIdTweenDuration(this._getSequenceId(t),e)},runAnimationsForSequenceIdTweenDuration:function(t,e){if(-1===t)throw"cc.BuilderAnimationManager.runAnimationsForSequenceIdTweenDuration(): Sequence id should not be -1";e=e||0,this._rootNode.stopAllActions();for(var i=this._nodeSequences.allKeys(),n=0,r=i.length;r>n;n++){var o=i[n];o.stopAllActions();var s,c=this._nodeSequences.objectForKey(o).objectForKey(t),a=[];if(c){var l=c.allKeys();for(s=0;s<l.length;s++){var h=l[s],u=c.objectForKey(h);a.push(h),this._setFirstFrame(o,u,e),this._runAction(o,u,e)}}if(c=this._baseValues.objectForKey(o))for(l=c.allKeys(),s=0;s<l.length;s++)h=l[s],-1===a.indexOf(h)&&(u=c.objectForKey(h),null!=u&&this._setAnimatedProperty(h,o,u,e))}i=this._getSequence(t),n=cc.sequence(cc.delayTime(i.getDuration()+e),cc.callFunc(this._sequenceCompleted,this)),this._rootNode.runAction(n),i.getCallbackChannel()&&(n=this.getActionForCallbackChannel(i.getCallbackChannel()))&&this._rootNode.runAction(n),i.getSoundChannel()&&(n=this.getActionForSoundChannel(i.getSoundChannel()))&&this._rootNode.runAction(n),this._runningSequence=this._getSequence(t)},runAnimations:function(t,e){e=e||0;var i;i=cc.isString(t)?this._getSequenceId(t):t,this.runAnimationsForSequenceIdTweenDuration(i,e)},setAnimationCompletedCallback:function(t,e){this._target=t,this._animationCompleteCallbackFunc=e},setCompletedAnimationCallback:function(t,e){this.setAnimationCompletedCallback(t,e)},setCallFunc:function(t,e){this._keyframeCallFuncs[e]=t},debug:function(){},_getBaseValue:function(t,e){var i=this._baseValues.objectForKey(t);return i?i.objectForKey(e):null},_getSequenceId:function(t){for(var e=null,i=this._sequences,n=0,r=i.length;r>n;n++)if((e=i[n])&&e.getName()===t)return e.getSequenceId();return-1},_getSequence:function(t){for(var e=null,i=this._sequences,n=0,r=i.length;r>n;n++)if((e=i[n])&&e.getSequenceId()===t)return e;return null},_getAction:function(t,e,i,n){t=e.getTime()-(t?t.getTime():0);var r,o;return"rotation"===i?cc.BuilderRotateTo.create(t,e.getValue()):"rotationX"===i?cc.BuilderRotateXTo.create(t,e.getValue()):"rotationY"===i?cc.BuilderRotateYTo.create(t,e.getValue()):"opacity"===i?cc.fadeTo(t,e.getValue()):"color"===i?(i=e.getValue().getColor(),cc.tintTo(t,i.r,i.g,i.b)):"visible"===i?e.getValue()?cc.sequence(cc.delayTime(t),cc.show()):cc.sequence(cc.delayTime(t),cc.hide()):"displayFrame"===i?cc.sequence(cc.delayTime(t),cc.BuilderSetSpriteFrame.create(e.getValue())):"position"===i?(r=this._getBaseValue(n,i),r=r[2],o=e.getValue(),e=o[0],o=o[1],n=this.getContainerSize(n.getParent()),i=cc._getAbsolutePosition(e,o,r,n,i),cc.moveTo(t,i)):"scale"===i?(r=this._getBaseValue(n,i),r=r[2],o=e.getValue(),e=o[0],o=o[1],r===CCB_SCALETYPE_MULTIPLY_RESOLUTION&&(i=cc.BuilderReader.getResolutionScale(),e*=i,o*=i),cc.scaleTo(t,e,o)):"skew"===i?(o=e.getValue(),e=o[0],o=o[1],cc.skewTo(t,e,o)):(cc.log("BuilderReader: Failed to create animation for property: "+i),null)},_setAnimatedProperty:function(t,e,i,n){if(n>0){var r=new cc.BuilderKeyframe;r.setValue(i),r.setTime(n),r.setEasingType(CCB_KEYFRAME_EASING_LINEAR),t=this._getAction(null,r,t,e),e.runAction(t)}else"position"===t?(n=this._getBaseValue(e,t),n=n[2],r=i[0],i=i[1],e.setPosition(cc._getAbsolutePosition(r,i,n,this.getContainerSize(e.getParent()),t))):"scale"===t?(n=this._getBaseValue(e,t),n=n[2],r=i[0],i=i[1],cc.setRelativeScale(e,r,i,n,t)):"skew"===t?(r=i[0],i=i[1],e.setSkewX(r),e.setSkewY(i)):"rotation"===t?e.setRotation(i):"rotationX"===t?e.setRotationSkewX(i):"rotationY"===t?e.setRotationSkewY(i):"opacity"===t?e.setOpacity(i):"displayFrame"===t?e.setSpriteFrame(i):"color"===t?(t=i.getColor(),255===t.r&&255===t.g&&255===t.b||e.setColor(t)):"visible"===t?e.setVisible(i||!1):cc.log("unsupported property name is "+t)},_setFirstFrame:function(t,e,i){var n=e.getKeyframes();0===n.length?((n=this._getBaseValue(t,e.getName()))||cc.log("cc.BuilderAnimationManager._setFirstFrame(): No baseValue found for property"),this._setAnimatedProperty(e.getName(),t,n,i)):(n=n[0],this._setAnimatedProperty(e.getName(),t,n.getValue(),i))},_getEaseAction:function(t,e,i){return e===CCB_KEYFRAME_EASING_LINEAR||e===CCB_KEYFRAME_EASING_INSTANT?t:e===CCB_KEYFRAME_EASING_CUBIC_IN?t.easing(cc.easeIn(i)):e===CCB_KEYFRAME_EASING_CUBIC_OUT?t.easing(cc.easeOut(i)):e===CCB_KEYFRAME_EASING_CUBIC_INOUT?t.easing(cc.easeInOut(i)):e===CCB_KEYFRAME_EASING_BACK_IN?t.easing(cc.easeBackIn()):e===CCB_KEYFRAME_EASING_BACK_OUT?t.easing(cc.easeBackOut()):e===CCB_KEYFRAME_EASING_BACK_INOUT?t.easing(cc.easeBackInOut()):e===CCB_KEYFRAME_EASING_BOUNCE_IN?t.easing(cc.easeBounceIn()):e===CCB_KEYFRAME_EASING_BOUNCE_OUT?t.easing(cc.easeBounceOut()):e===CCB_KEYFRAME_EASING_BOUNCE_INOUT?t.easing(cc.easeBounceInOut()):e===CCB_KEYFRAME_EASING_ELASTIC_IN?t.easing(cc.easeElasticIn(i)):e===CCB_KEYFRAME_EASING_ELASTIC_OUT?t.easing(cc.easeElasticOut(i)):e===CCB_KEYFRAME_EASING_ELASTIC_INOUT?t.easing(cc.easeElasticInOut(i)):(cc.log("BuilderReader: Unkown easing type "+e),t)},_runAction:function(t,e,i){var n=e.getKeyframes(),r=n.length;if(r>1){var o=[];for(i=n[0].getTime()+i,i>0&&o.push(cc.delayTime(i)),i=0;r-1>i;++i){var s=n[i],c=this._getAction(s,n[i+1],e.getName(),t);c&&(c=this._getEaseAction(c,s.getEasingType(),s.getEasingOpt()),o.push(c))}t.runAction(cc.sequence(o))}},_sequenceCompleted:function(){var t=this._runningSequence,e=t.getName();this._lastCompletedSequenceName!=t.getName()&&(this._lastCompletedSequenceName=t.getName()),t=t.getChainedSequenceId(),this._runningSequence=null,-1!==t&&this.runAnimations(t,0),this._delegate&&this._delegate.completedAnimationSequenceNamed(e),this._target&&this._animationCompleteCallbackFunc&&this._animationCompleteCallbackFunc.call(this._target)}}),cc.BuilderSetSpriteFrame=cc.ActionInstant.extend({_spriteFrame:null,initWithSpriteFrame:function(t){return this._spriteFrame=t,!0},update:function(){this.target.setSpriteFrame(this._spriteFrame)}}),cc.BuilderSetSpriteFrame.create=function(t){var e=new cc.BuilderSetSpriteFrame;return e&&e.initWithSpriteFrame(t)?e:null},cc.BuilderRotateTo=cc.ActionInterval.extend({_startAngle:0,_dstAngle:0,_diffAngle:0,initWithDuration:function(t,e){return cc.ActionInterval.prototype.initWithDuration.call(this,t)?(this._dstAngle=e,!0):!1},update:function(t){this.target.setRotation(this._startAngle+this._diffAngle*t)},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._startAngle=this.target.getRotation(),this._diffAngle=this._dstAngle-this._startAngle}}),cc.BuilderRotateTo.create=function(t,e){var i=new cc.BuilderRotateTo;return i&&i.initWithDuration(t,e)?i:null},cc.BuilderRotateXTo=cc.ActionInterval.extend({}),cc.BuilderRotateXTo.create=function(){throw"rotationX has not been implemented in cocos2d-html5"},cc.BuilderRotateYTo=cc.ActionInterval.extend({}),cc.BuilderRotateYTo.create=function(){throw"rotationY has not been implemented in cocos2d-html5"},cc.BuilderSoundEffect=cc.ActionInstant.extend({init:function(t){return this._file=t,!0},update:function(){cc.audioEngine.playEffect(this._file)}}),cc.BuilderSoundEffect.create=function(t,e){return(e=new cc.BuilderSoundEffect)&&e.init(t)?e:null},cc.DOM={},cc.DOM._addMethods=function(t){for(var e in cc.DOM.methods)t[e]=cc.DOM.methods[e];cc.defineGetterSetter(t,"x",t.getPositionX,t.setPositionX),cc.defineGetterSetter(t,"y",t.getPositionY,t.setPositionY),cc.defineGetterSetter(t,"width",t._getWidth,t._setWidth),cc.defineGetterSetter(t,"height",t._getHeight,t._setHeight),cc.defineGetterSetter(t,"anchorX",t._getAnchorX,t._setAnchorX),cc.defineGetterSetter(t,"anchorY",t._getAnchorY,t._setAnchorY),cc.defineGetterSetter(t,"scale",t.getScale,t.setScale),cc.defineGetterSetter(t,"scaleX",t.getScaleX,t.setScaleX),cc.defineGetterSetter(t,"scaleY",t.getScaleY,t.setScaleY),cc.defineGetterSetter(t,"rotation",t.getRotation,t.setRotation),cc.defineGetterSetter(t,"skewX",t.getSkewX,t.setSkewX),cc.defineGetterSetter(t,"skewY",t.getSkewY,t.setSkewY),cc.defineGetterSetter(t,"visible",t.isVisible,t.setVisible),cc.defineGetterSetter(t,"parent",t.getParent,t.setParent),cc.defineGetterSetter(t,"opacity",t.getOpacity,t.setOpacity)},cc.DOM.methods={setPosition:function(t,e){void 0===e?(this._position.x=t.x,this._position.y=t.y):(this._position.x=t,this._position.y=e),this.setNodeDirty(),this.dom.translates(this._position.x,-this._position.y)},setPositionY:function(t){this._position.y=t,this.setNodeDirty(),this.dom.translates(this._position.x,-this._position.y)},setPositionX:function(t){this._position.x=t,this.setNodeDirty(),this.dom.translates(this._position.x,-this._position.y)},setScale:function(t,e){this._scaleX=t,this._scaleY=e||t,this.setNodeDirty(),this.dom.resize(this._scaleX,this._scaleY)},setScaleX:function(t){this._scaleX=t,this.setNodeDirty(),this.dom.resize(this._scaleX,this._scaleY)},setScaleY:function(t){this._scaleY=t,this.setNodeDirty(),this.dom.resize(this._scaleX,this._scaleY)},setAnchorPoint:function(t,e){var i=this._renderCmd,n=this._anchorPoint;void 0===e?(n.x=t.x,n.y=t.y):(n.x=t,n.y=e);var i=i._anchorPointInPoints,r=this._contentSize;i.x=r.width*n.x,i.y=r.height*n.y,this.dom.style[cc.$.pfx+"TransformOrigin"]=""+i.x+"px "+-i.y+"px",this.ignoreAnchor?(this.dom.style.marginLeft=0,this.dom.style.marginBottom=0):(this.dom.style.marginLeft=this.isToggler?0:-i.x+"px",this.dom.style.marginBottom=-i.y+"px"),this.setNodeDirty()},_setAnchorX:function(t){var e=this._anchorPoint,i=this._renderCmd;t!==e.x&&(e.x=t,t=i._anchorPointInPoints,t.x=this._contentSize.width*e.x,this.dom.style[cc.$.pfx+"TransformOrigin"]=""+t.x+"px "+-t.y+"px",this.ignoreAnchor?(this.dom.style.marginLeft=0,this.dom.style.marginBottom=0):this.dom.style.marginLeft=this.isToggler?0:-t.x+"px",this.setNodeDirty())},_setAnchorY:function(t){var e=this._anchorPoint,i=this._renderCmd;t!==e.y&&(e.y=t,t=i._anchorPointInPoints,t.y=this._contentSize.height*e.y,this.dom.style[cc.$.pfx+"TransformOrigin"]=""+t.x+"px "+-t.y+"px",this.ignoreAnchor?(this.dom.style.marginLeft=0,this.dom.style.marginBottom=0):this.dom.style.marginBottom=-t.y+"px",this.setNodeDirty())},setContentSize:function(t,e){var i=this._renderCmd,n=this._contentSize;void 0===e?(n.width=t.width,n.height=t.height):(n.width=t,n.height=e);var i=i._anchorPointInPoints,r=this._anchorPoint;i.x=n.width*r.x,i.y=n.height*r.y,this.dom.width=n.width,this.dom.height=n.height,this.setAnchorPoint(this.getAnchorPoint()),this.canvas&&(this.canvas.width=n.width,this.canvas.height=n.height),this.setNodeDirty(),this.redraw()},_setWidth:function(t){var e=this._contentSize,i=this._renderCmd;t!==e.width&&(e.width=t,t=this._anchorPoint,i._anchorPointInPoints.x=e.width*t.x,this.dom.width=e.width,this.anchorX=t.x,this.canvas&&(this.canvas.width=e.width),this.setNodeDirty(),this.redraw())},_setHeight:function(t){var e=this._contentSize,i=this._renderCmd;t!==e.height&&(e.height=t,t=this._anchorPoint,i._anchorPointInPoints.y=e.height*t.y,this.dom.height=e.height,this.anchorY=t.y,this.canvas&&(this.canvas.height=e.height),this.setNodeDirty(),this.redraw())},setRotation:function(t){this._rotation!==t&&(this._rotationX=this._rotationY=t,this.setNodeDirty(),this.dom.rotate(t))},setSkewX:function(t){this._skewX=t,this.setNodeDirty(),this.dom.setSkew(this._skewX,this._skewY)},setSkewY:function(t){this._skewY=t,this.setNodeDirty(),this.dom.setSkew(this._skewX,this._skewY)},setVisible:function(t){this._visible=t,this.setNodeDirty(),this.dom&&(this.dom.style.display=t?"block":"none")},_setLocalZOrder:function(t){this._localZOrder=t,this.setNodeDirty(),this.dom&&(this.dom.zIndex=t)},setParent:function(t){this._parent=t,null!==t&&(t.setAnchorPoint(t.getAnchorPoint()),this.setNodeDirty(),cc.DOM.parentDOM(this))},resume:function(){this.getScheduler().resumeTarget(this),this.getActionManager().resumeTarget(this),cc.eventManager.resumeTarget(this),this.dom&&!this.dom.parentNode&&(this.getParent()?cc.DOM.parentDOM(this):""===this.dom.id?cc.DOM._createEGLViewDiv(this):this.dom.appendTo(cc.container)),this.dom&&(this.dom.style.visibility="visible")},pause:function(){this.getScheduler().pauseTarget(this),this.getActionManager().pauseTarget(this),cc.eventManager.pauseTarget(this),this.dom&&(this.dom.style.visibility="hidden")},cleanup:function(){this.stopAllActions(),this.unscheduleAllCallbacks(),this._arrayMakeObjectsPerformSelector(this._children,cc.Node._stateCallbackType.cleanup),this.dom&&this.dom.remove()},removeFromParentAndCleanup:function(){this.dom.remove()},setOpacity:function(t){this._opacity=t,this.dom.style.opacity=t/255},redraw:function(){if(this.isSprite){var t=this._children;this._children=[],cc.Sprite.prototype.visit.call(this,this.ctx),this._children=t}else cc.Sprite.prototype.visit.call(this,this.ctx)}},cc.DOM._resetEGLViewDiv=function(){var t=cc.$("#EGLViewDiv");if(t){var e=cc.view,i=e.getDesignResolutionSize();e.getViewPortRect();var n=e.getFrameSize(),r=e.getDevicePixelRatio(),o=i.width,s=i.height;0===i.width&&0===i.height&&(o=n.width,s=n.height),t.style.position="absolute",t.style.width=o+"px",t.style.maxHeight=s+"px",t.style.margin=0,t.resize(e.getScaleX()/r,e.getScaleY()/r),e.getResolutionPolicy()===e._rpNoBorder?(t.style.left=(e.getFrameSize().width-o)/2+"px",t.style.bottom=(e.getFrameSize().height-s*e.getScaleY()/r)/2+"px"):(t.style.left=(o*e.getScaleX()/r-o)/2+"px",t.style.bottom="0px")
}},cc.DOM.parentDOM=function(t){var e=t.getParent();return e&&t.dom?(e.dom||(cc.DOM.placeHolder(e),e.setParent=cc.DOM.methods.setParent),t.dom.appendTo(e.dom),e.setAnchorPoint(e.getAnchorPoint()),e.getParent()?cc.DOM.parentDOM(e):e.isRunning()&&((t=cc.$("#EGLViewDiv"))?e.dom.appendTo(t):cc.DOM._createEGLViewDiv(e)),!0):!1},cc.DOM._createEGLViewDiv=function(t){var e=cc.$("#EGLViewDiv");e||(e=cc.$new("div"),e.id="EGLViewDiv");var i=cc.view,n=i.getDesignResolutionSize();i.getViewPortRect();var r=i.getFrameSize(),o=i.getDevicePixelRatio(),s=n.width,c=n.height;0===n.width&&0===n.height&&(s=r.width,c=r.height),e.style.position="absolute",e.style.width=s+"px",e.style.maxHeight=c+"px",e.style.margin=0,e.resize(i.getScaleX()/o,i.getScaleY()/o),i.getResolutionPolicy()===i._rpNoBorder?(e.style.left=(r.width-s)/2+"px",e.style.bottom=(r.height-c*i.getScaleY()/o)/2+"px"):(e.style.left=(s*i.getScaleX()/o-s)/2+"px",e.style.bottom="0px"),t.dom.appendTo(e),e.appendTo(cc.container)},cc.DOM.setTransform=function(t){if(t.ctx)if(t.ctx.translate(t.getAnchorPointInPoints().x,t.getAnchorPointInPoints().y),t.isSprite){var e=t._children;t._children=[],cc.Sprite.prototype.visit.call(t),t._children=e}else cc.Sprite.prototype.visit.call(t);t.dom&&(t.dom.position.x=t.getPositionX(),t.dom.position.y=-t.getPositionY(),t.dom.rotation=t.getRotation(),t.dom.scale={x:t.getScaleX(),y:t.getScaleY()},t.dom.skew={x:t.getSkewX(),y:t.getSkewY()},t.setAnchorPoint&&t.setAnchorPoint(t.getAnchorPoint()),t.dom.transforms())},cc.DOM.forSprite=function(t){t.dom=cc.$new("div"),t.canvas=cc.$new("canvas");var e=t.getContentSize();t.canvas.width=e.width,t.canvas.height=e.height,t.dom.style.position="absolute",t.dom.style.bottom=0,t.ctx=t.canvas.getContext("2d"),t.dom.appendChild(t.canvas),t.getParent()&&cc.DOM.parentDOM(t),t.isSprite=!0},cc.DOM.placeHolder=function(t){t.dom=cc.$new("div"),t.placeholder=!0,t.dom.style.position="absolute",t.dom.style.bottom=0,t.dom.style.width=(t.getContentSize().width||cc.director.getWinSize().width)+"px",t.dom.style.maxHeight=(t.getContentSize().height||cc.director.getWinSize().height)+"px",t.dom.style.margin=0,cc.DOM.setTransform(t),t.dom.transforms(),cc.DOM._addMethods(t)},cc.DOM.convert=function(){if(1<arguments.length)cc.DOM.convert(arguments);else if(1!==arguments.length||arguments[0].length)for(var t=arguments[0],e=0;e<t.length;e++)t[e]instanceof cc.Sprite?t[e].dom||cc.DOM.forSprite(t[e]):cc.log("DOM converter only supports sprite and menuitems yet"),cc.DOM._addMethods(t[e]),t[e].visit=function(){},t[e].transform=function(){},cc.DOM.setTransform(t[e]),t[e].setVisible(t[e].isVisible());else cc.DOM.convert([arguments[0]])},cc.KEYBOARD_RETURNTYPE_DEFAULT=0,cc.KEYBOARD_RETURNTYPE_DONE=1,cc.KEYBOARD_RETURNTYPE_SEND=2,cc.KEYBOARD_RETURNTYPE_SEARCH=3,cc.KEYBOARD_RETURNTYPE_GO=4,cc.EDITBOX_INPUT_MODE_ANY=0,cc.EDITBOX_INPUT_MODE_EMAILADDR=1,cc.EDITBOX_INPUT_MODE_NUMERIC=2,cc.EDITBOX_INPUT_MODE_PHONENUMBER=3,cc.EDITBOX_INPUT_MODE_URL=4,cc.EDITBOX_INPUT_MODE_DECIMAL=5,cc.EDITBOX_INPUT_MODE_SINGLELINE=6,cc.EDITBOX_INPUT_FLAG_PASSWORD=0,cc.EDITBOX_INPUT_FLAG_SENSITIVE=1,cc.EDITBOX_INPUT_FLAG_INITIAL_CAPS_WORD=2,cc.EDITBOX_INPUT_FLAG_INITIAL_CAPS_SENTENCE=3,cc.EDITBOX_INPUT_FLAG_INITIAL_CAPS_ALL_CHARACTERS=4,cc.EditBoxDelegate=cc.Class.extend({editBoxEditingDidBegin:function(){},editBoxEditingDidEnd:function(){},editBoxTextChanged:function(){},editBoxReturn:function(){}}),cc.EditBox=cc.ControlButton.extend({_domInputSprite:null,_delegate:null,_editBoxInputMode:cc.EDITBOX_INPUT_MODE_ANY,_editBoxInputFlag:cc.EDITBOX_INPUT_FLAG_SENSITIVE,_keyboardReturnType:cc.KEYBOARD_RETURNTYPE_DEFAULT,_text:"",_placeholderText:"",_textColor:null,_placeholderColor:null,_maxLength:50,_adjustHeight:18,_edTxt:null,_edFontSize:14,_edFontName:"Arial",_placeholderFontName:"",_placeholderFontSize:14,_tooltip:!1,_className:"EditBox",ctor:function(t,e,i,n){cc.ControlButton.prototype.ctor.call(this),this._textColor=cc.color.WHITE,this._placeholderColor=cc.color.GRAY,this.setContentSize(t);var r=this._domInputSprite=new cc.Sprite;r.draw=function(){},this.addChild(r);var o=this,s=this._edTxt=cc.newElement("input");s.type="text",s.style.fontSize=this._edFontSize+"px",s.style.color="#000000",s.style.border=0,s.style.background="transparent",s.style.width="100%",s.style.height="100%",s.style.active=0,s.style.outline="medium",s.style.padding="0";var c=function(){s.blur()};cc._addEventListener(s,"input",function(){o._delegate&&o._delegate.editBoxTextChanged&&o._delegate.editBoxTextChanged(o,this.value)}),cc._addEventListener(s,"keypress",function(t){t.keyCode===cc.KEY.enter&&(t.stopPropagation(),t.preventDefault(),cc._canvas.focus())}),cc._addEventListener(s,"focus",function(){this.value===o._placeholderText&&(this.value="",this.style.fontSize=o._edFontSize+"px",this.style.color=cc.colorToHex(o._textColor),o._edTxt.type=o._editBoxInputFlag===cc.EDITBOX_INPUT_FLAG_PASSWORD?"password":"text"),o._delegate&&o._delegate.editBoxEditingDidBegin&&o._delegate.editBoxEditingDidBegin(o),cc._addEventListener(cc._canvas,"click",c)}),cc._addEventListener(s,"blur",function(){""===this.value&&(this.value=o._placeholderText,this.style.fontSize=o._placeholderFontSize+"px",this.style.color=cc.colorToHex(o._placeholderColor),o._edTxt.type="text"),o._delegate&&o._delegate.editBoxEditingDidEnd&&o._delegate.editBoxEditingDidEnd(o),o._delegate&&o._delegate.editBoxReturn&&o._delegate.editBoxReturn(o),cc._canvas.removeEventListener("click",c)}),cc.DOM.convert(r),r.dom.appendChild(s),r.dom.showTooltipDiv=!1,r.dom.style.width=t.width-6+"px",r.dom.style.height=t.height-6+"px",r.canvas.remove(),this.initWithSizeAndBackgroundSprite(t,e)&&(i&&this.setBackgroundSpriteForState(i,cc.CONTROL_STATE_HIGHLIGHTED),n&&this.setBackgroundSpriteForState(n,cc.CONTROL_STATE_DISABLED))},setFont:function(t,e){this._edFontSize=e,this._edFontName=t,this._setFontToEditBox()},_setFont:function(t){(t=cc.LabelTTF._fontStyleRE.exec(t))&&(this._edFontSize=parseInt(t[1]),this._edFontName=t[2],this._setFontToEditBox())},setFontName:function(t){this._edFontName=t,this._setFontToEditBox()},setFontSize:function(t){this._edFontSize=t,this._setFontToEditBox()},_setFontToEditBox:function(){this._edTxt.value!==this._placeholderText&&(this._edTxt.style.fontFamily=this._edFontName,this._edTxt.style.fontSize=this._edFontSize+"px",this._edTxt.type=this._editBoxInputFlag===cc.EDITBOX_INPUT_FLAG_PASSWORD?"password":"text")},setText:function(t){cc.log("Please use the setString"),this.setString(t)},setString:function(t){null!=t&&(""===t?(this._edTxt.value=this._placeholderText,this._edTxt.style.color=cc.colorToHex(this._placeholderColor),this._edTxt.type="text"):(this._edTxt.value=t,this._edTxt.style.color=cc.colorToHex(this._textColor),this._edTxt.type=this._editBoxInputFlag===cc.EDITBOX_INPUT_FLAG_PASSWORD?"password":"text"))},setFontColor:function(t){this._textColor=t,this._edTxt.value!==this._placeholderText&&(this._edTxt.style.color=cc.colorToHex(t))},setMaxLength:function(t){!isNaN(t)&&t>0&&(this._maxLength=t,this._edTxt.maxLength=t)},getMaxLength:function(){return this._maxLength},setPlaceHolder:function(t){if(null!=t){var e=this._placeholderText;this._placeholderText=t,this._edTxt.value===e&&(this._edTxt.value=t,this._edTxt.style.color=cc.colorToHex(this._placeholderColor),this._setPlaceholderFontToEditText())}},setPlaceholderFont:function(t,e){this._placeholderFontName=t,this._placeholderFontSize=e,this._setPlaceholderFontToEditText()},_setPlaceholderFont:function(t){(t=cc.LabelTTF._fontStyleRE.exec(t))&&(this._placeholderFontName=t[2],this._placeholderFontSize=parseInt(t[1]),this._setPlaceholderFontToEditText())},setPlaceholderFontName:function(t){this._placeholderFontName=t,this._setPlaceholderFontToEditText()},setPlaceholderFontSize:function(t){this._placeholderFontSize=t,this._setPlaceholderFontToEditText()},_setPlaceholderFontToEditText:function(){this._edTxt.value===this._placeholderText&&(this._edTxt.style.fontFamily=this._placeholderFontName,this._edTxt.style.fontSize=this._placeholderFontSize+"px",this._edTxt.type="text")},setPlaceholderFontColor:function(t){this._placeholderColor=t,this._edTxt.value===this._placeholderText&&(this._edTxt.style.color=cc.colorToHex(t))},setInputFlag:function(t){this._editBoxInputFlag=t,this._edTxt.type=this._edTxt.value!==this._placeholderText&&t===cc.EDITBOX_INPUT_FLAG_PASSWORD?"password":"text"},getText:function(){return cc.log("Please use the getString"),this._edTxt.value},getString:function(){return this._edTxt.value===this._placeholderText?"":this._edTxt.value},initWithSizeAndBackgroundSprite:function(t,e){return this.initWithBackgroundSprite(e)?(this._domInputSprite.x=3,this._domInputSprite.y=3,this.setZoomOnTouchDown(!1),this.setPreferredSize(t),this.y=this.x=0,this._addTargetWithActionForControlEvent(this,this.touchDownAction,cc.CONTROL_EVENT_TOUCH_UP_INSIDE),!0):!1},setDelegate:function(t){this._delegate=t},getPlaceHolder:function(){return this._placeholderText},setInputMode:function(t){this._editBoxInputMode=t},setReturnType:function(t){this._keyboardReturnType=t},keyboardWillShow:function(t){var e=cc.EditBox.getRect(this);e.y-=4,e.intersectsRect(t.end)?this._adjustHeight=t.end.getMaxY()-e.getMinY():cc.log("needn't to adjust view layout.")},keyboardDidShow:function(){},keyboardWillHide:function(){},keyboardDidHide:function(){},touchDownAction:function(){},initWithBackgroundColor:function(t,e){this._edWidth=t.width,this.dom.style.width=this._edWidth.toString()+"px",this._edHeight=t.height,this.dom.style.height=this._edHeight.toString()+"px",this.dom.style.backgroundColor=cc.colorToHex(e)}}),_p=cc.EditBox.prototype,cc.defineGetterSetter(_p,"font",null,_p._setFont),cc.defineGetterSetter(_p,"fontName",null,_p.setFontName),cc.defineGetterSetter(_p,"fontSize",null,_p.setFontSize),cc.defineGetterSetter(_p,"fontColor",null,_p.setFontColor),cc.defineGetterSetter(_p,"string",_p.getString,_p.setString),cc.defineGetterSetter(_p,"maxLength",_p.getMaxLength,_p.setMaxLength),cc.defineGetterSetter(_p,"placeHolder",_p.getPlaceHolder,_p.setPlaceHolder),cc.defineGetterSetter(_p,"placeHolderFont",null,_p._setPlaceholderFont),cc.defineGetterSetter(_p,"placeHolderFontName",null,_p.setPlaceholderFontName),cc.defineGetterSetter(_p,"placeHolderFontSize",null,_p.setPlaceholderFontSize),cc.defineGetterSetter(_p,"placeHolderFontColor",null,_p.setPlaceholderFontColor),cc.defineGetterSetter(_p,"inputFlag",null,_p.setInputFlag),cc.defineGetterSetter(_p,"delegate",null,_p.setDelegate),cc.defineGetterSetter(_p,"inputMode",null,_p.setInputMode),cc.defineGetterSetter(_p,"returnType",null,_p.setReturnType),_p=null,cc.EditBox.getRect=function(t){var e=t.getContentSize(),e=cc.rect(0,0,e.width,e.height);return cc.rectApplyAffineTransform(e,t.getNodeToWorldTransform())},cc.EditBox.create=function(t,e,i,n){return new cc.EditBox(t,e,i,n)},cc.ProtectedNode=cc.Node.extend({_protectedChildren:null,_reorderProtectedChildDirty:!1,_insertProtectedChild:function(t,e){this._reorderProtectedChildDirty=!0,this._protectedChildren.push(t),t._setLocalZOrder(e)},ctor:function(){cc.Node.prototype.ctor.call(this),this._protectedChildren=[]},addProtectedChild:function(t,e,i){cc.assert(null!=t,"child must be non-nil"),cc.assert(!t.parent,"child already added. It can't be added again"),e=e||t.getLocalZOrder(),i&&t.setTag(i),this._insertProtectedChild(t,e),t.setParent(this),t.setOrderOfArrival(cc.s_globalOrderOfArrival),this._running&&(t.onEnter(),this._isTransitionFinished)&&t.onEnterTransitionDidFinish(),this._cascadeColorEnabled&&this._renderCmd.setCascadeColorEnabledDirty(),this._cascadeOpacityEnabled&&this._renderCmd.setCascadeOpacityEnabledDirty()},getProtectedChildByTag:function(t){cc.assert(t!==cc.NODE_TAG_INVALID,"Invalid tag");for(var e=this._protectedChildren,i=0,n=e.length;n>i;i++)if(e.getTag()===t)return e[i];return null},removeProtectedChild:function(t,e){null==e&&(e=!0);var i=this._protectedChildren;if(0!==i.length){var n=i.indexOf(t);n>-1&&(this._running&&(t.onExitTransitionDidStart(),t.onExit()),e&&t.cleanup(),t.setParent(null),i.splice(n,1))}},removeProtectedChildByTag:function(t,e){cc.assert(t!==cc.NODE_TAG_INVALID,"Invalid tag"),null==e&&(e=!0);var i=this.getProtectedChildByTag(t);null==i?cc.log("cocos2d: removeChildByTag(tag = %d): child not found!",t):this.removeProtectedChild(i,e)},removeAllProtectedChildren:function(){this.removeAllProtectedChildrenWithCleanup(!0)},removeAllProtectedChildrenWithCleanup:function(t){null==t&&(t=!0);for(var e=this._protectedChildren,i=0,n=e.length;n>i;i++){var r=e[i];this._running&&(r.onExitTransitionDidStart(),r.onExit()),t&&r.cleanup(),r.setParent(null)}e.length=0},reorderProtectedChild:function(t,e){cc.assert(null!=t,"Child must be non-nil"),this._reorderProtectedChildDirty=!0,t.setOrderOfArrival(cc.s_globalOrderOfArrival++),t._setLocalZOrder(e)},sortAllProtectedChildren:function(){if(this._reorderProtectedChildDirty){var t,e,i,n=this._protectedChildren,r=n.length;for(t=1;r>t;t++){for(i=n[t],e=t-1;e>=0;){if(i._localZOrder<n[e]._localZOrder)n[e+1]=n[e];else{if(!(i._localZOrder===n[e]._localZOrder&&i.arrivalOrder<n[e].arrivalOrder))break;n[e+1]=n[e]}e--}n[e+1]=i}this._reorderProtectedChildDirty=!1}},_changePosition:function(){},cleanup:function(){cc.Node.prototype.cleanup.call(this);for(var t=this._protectedChildren,e=0,i=t.length;i>e;e++)t[e].cleanup()},onEnter:function(){cc.Node.prototype.onEnter.call(this);for(var t=this._protectedChildren,e=0,i=t.length;i>e;e++)t[e].onEnter()},onEnterTransitionDidFinish:function(){cc.Node.prototype.onEnterTransitionDidFinish.call(this);for(var t=this._protectedChildren,e=0,i=t.length;i>e;e++)t[e].onEnterTransitionDidFinish()},onExit:function(){cc.Node.prototype.onExit.call(this);for(var t=this._protectedChildren,e=0,i=t.length;i>e;e++)t[e].onExit()},onExitTransitionDidStart:function(){cc.Node.prototype.onExitTransitionDidStart.call(this);for(var t=this._protectedChildren,e=0,i=t.length;i>e;e++)t[e].onExitTransitionDidStart()},_createRenderCmd:function(){return cc._renderType===cc._RENDER_TYPE_CANVAS?new cc.ProtectedNode.CanvasRenderCmd(this):new cc.ProtectedNode.WebGLRenderCmd(this)}}),cc.ProtectedNode.create=function(){return new cc.ProtectedNode},function(){cc.ProtectedNode.RenderCmd={_updateDisplayColor:function(t){var e,i,n=this._node,r=this._displayedColor,o=n._realColor;if(this._cascadeColorEnabledDirty&&!n._cascadeColorEnabled){for(r.r=o.r,r.g=o.g,r.b=o.b,r=new cc.Color(255,255,255,255),e=n._children,o=0,t=e.length;t>o;o++)(i=e[o])&&i._renderCmd&&i._renderCmd._updateDisplayColor(r);this._cascadeColorEnabledDirty=!1}else{if(void 0===t&&(t=(t=n._parent)&&t._cascadeColorEnabled?t.getDisplayedColor():cc.color.WHITE),r.r=0|o.r*t.r/255,r.g=0|o.g*t.g/255,r.b=0|o.b*t.b/255,n._cascadeColorEnabled)for(e=n._children,o=0,t=e.length;t>o;o++)(i=e[o])&&i._renderCmd&&(i._renderCmd._updateDisplayColor(r),i._renderCmd._updateColor());for(e=n._protectedChildren,o=0,t=e.length;t>o;o++)(i=e[o])&&i._renderCmd&&(i._renderCmd._updateDisplayColor(r),i._renderCmd._updateColor())}this._dirtyFlag^=this._dirtyFlag&cc.Node._dirtyFlags.colorDirty},_updateDisplayOpacity:function(t){var e,i,n,r=this._node;if(this._cascadeOpacityEnabledDirty&&!r._cascadeOpacityEnabled){for(this._displayedOpacity=r._realOpacity,i=r._children,t=0,e=i.length;e>t;t++)(n=i[t])&&n._renderCmd&&n._renderCmd._updateDisplayOpacity(255);this._cascadeOpacityEnabledDirty=!1}else{if(void 0===t&&(e=r._parent,t=255,e&&e._cascadeOpacityEnabled&&(t=e.getDisplayedOpacity())),this._displayedOpacity=r._realOpacity*t/255,r._cascadeOpacityEnabled)for(i=r._children,t=0,e=i.length;e>t;t++)(n=i[t])&&n._renderCmd&&(n._renderCmd._updateDisplayOpacity(this._displayedOpacity),n._renderCmd._updateColor());for(i=r._protectedChildren,t=0,e=i.length;e>t;t++)(n=i[t])&&n._renderCmd&&(n._renderCmd._updateDisplayOpacity(this._displayedOpacity),n._renderCmd._updateColor())}this._dirtyFlag^=this._dirtyFlag&cc.Node._dirtyFlags.opacityDirty},_changeProtectedChild:function(t){t=t._renderCmd;var e=t._dirtyFlag,i=cc.Node._dirtyFlags;this._dirtyFlag&i.colorDirty&&(e|=i.colorDirty),this._dirtyFlag&i.opacityDirty&&(e|=i.opacityDirty);var n=e&i.colorDirty,e=e&i.opacityDirty;n&&t._updateDisplayColor(this._displayedColor),e&&t._updateDisplayOpacity(this._displayedOpacity),(n||e)&&t._updateColor()}},cc.ProtectedNode.CanvasRenderCmd=function(t){cc.Node.CanvasRenderCmd.call(this,t),this._cachedParent=null,this._cacheDirty=!1};var t=cc.ProtectedNode.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);cc.inject(cc.ProtectedNode.RenderCmd,t),t.constructor=cc.ProtectedNode.CanvasRenderCmd,t.visit=function(t){var e=this._node;if(e._visible){var i=e._children,n=e._protectedChildren,r=e._children.length,o=n.length;this._syncStatus(t),e.sortAllChildren(),e.sortAllProtectedChildren();var s;for(t=0;r>t&&(e=i[t],0>e._localZOrder);t++)e.visit(this);for(e=0;o>e&&((s=n[e])&&0>s._localZOrder);e++)this._changeProtectedChild(s),s.visit(this);for(cc.renderer.pushRenderCommand(this);r>t;t++)i[t]&&i[t].visit(this);for(;o>e;e++)(s=n[e])&&(this._changeProtectedChild(s),s.visit(this));this._dirtyFlag=0,this._cacheDirty=!1}},t.transform=function(t,e){var i=this._node;i._changePosition&&i._changePosition();var n=i.getNodeToParentTransform(),r=this._worldTransform;if(t){var o=t._worldTransform;r.a=n.a*o.a+n.b*o.c,r.b=n.a*o.b+n.b*o.d,r.c=n.c*o.a+n.d*o.c,r.d=n.c*o.b+n.d*o.d,r.tx=o.a*n.tx+o.c*n.ty+o.tx,r.ty=o.d*n.ty+o.ty+o.b*n.tx}else r.a=n.a,r.b=n.b,r.c=n.c,r.d=n.d,r.tx=n.tx,r.ty=n.ty;if(o=i._children,e&&o&&0!==o.length)for(n=0,r=o.length;r>n;n++)o[n]._renderCmd.transform(this,e);if(o=i._protectedChildren,e&&o&&0!==o.length)for(n=0,r=o.length;r>n;n++)o[n]._renderCmd.transform(this,e)}}(),function(){if(cc.Node.WebGLRenderCmd){cc.ProtectedNode.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t)};var t=cc.ProtectedNode.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);cc.inject(cc.ProtectedNode.RenderCmd,t),t.constructor=cc.ProtectedNode.WebGLRenderCmd,t.visit=function(t){var e=this._node;if(e._visible){var i,n=cc.current_stack;n.stack.push(n.top),this._syncStatus(t),n.top=this._stackMatrix;var r=e.grid;r&&r._active&&r.beforeDraw();var o=e._children,s=e._protectedChildren,c=o.length,a=s.length;e.sortAllChildren(),e.sortAllProtectedChildren();var l;for(t=0;c>t&&(o[t]&&0>o[t]._localZOrder);t++)o[t].visit(this);for(i=0;a>i&&((l=s[i])&&0>l._localZOrder);i++)this._changeProtectedChild(l),l.visit(this);for(cc.renderer.pushRenderCommand(this);c>t;t++)o[t]&&o[t].visit(this);for(;a>i;i++)(l=s[i])&&(this._changeProtectedChild(l),l.visit(this));r&&r._active&&r.afterDraw(e),this._dirtyFlag=0,n.top=n.stack.pop()}},t.transform=function(t,e){var i=this._node,n=this._transform4x4,r=this._stackMatrix,o=t?t._stackMatrix:cc.current_stack.top,s=i.getNodeToParentTransform();i._changePosition&&i._changePosition(),this._dirtyFlag^=this._dirtyFlag&cc.Node._dirtyFlags.transformDirty;var c=n.mat;if(c[0]=s.a,c[4]=s.c,c[12]=s.tx,c[1]=s.b,c[5]=s.d,c[13]=s.ty,c[14]=i._vertexZ,cc.kmMat4Multiply(r,o,n),null!==i._camera&&(null===i.grid||!i.grid.isActive()))if(o=this._anchorPointInPoints.x,s=this._anchorPointInPoints.y,c=0!==o||0!==s){cc.SPRITEBATCHNODE_RENDER_SUBPIXEL||(o|=0,s|=0);var a=cc.math.Matrix4.createByTranslation(o,s,0,n);r.multiply(c),i._camera._locateForRenderer(r),a=cc.math.Matrix4.createByTranslation(-o,-s,0,a),r.multiply(a),n.identity()}else i._camera._locateForRenderer(r);if(o=i._children,e&&o&&0!==o.length)for(n=0,r=o.length;r>n;n++)o[n]._renderCmd.transform(this,e);if(o=i._protectedChildren,e&&o&&0!==o.length)for(n=0,r=o.length;r>n;n++)o[n]._renderCmd.transform(this,e)}}}();var ccui=ccui||{};ccui.Class=ccui.Class||cc.Class,ccui.Class.extend=ccui.Class.extend||cc.Class.extend,ccui.Node=ccui.Node||cc.Node,ccui.Node.extend=ccui.Node.extend||cc.Node.extend,ccui.ProtectedNode=ccui.ProtectedNode||cc.ProtectedNode,ccui.ProtectedNode.extend=ccui.ProtectedNode.extend||cc.ProtectedNode.extend,ccui.cocosGUIVersion="CocosGUI v1.0.0.0",ccui._FocusNavigationController=cc.Class.extend({_keyboardListener:null,_firstFocusedWidget:null,_enableFocusNavigation:!1,_keyboardEventPriority:1,enableFocusNavigation:function(t){this._enableFocusNavigation!==t&&((this._enableFocusNavigation=t)?this._addKeyboardEventListener():this._removeKeyboardEventListener())},_setFirstFocsuedWidget:function(t){this._firstFocusedWidget=t},_onKeyPressed:function(t){this._enableFocusNavigation&&this._firstFocusedWidget&&(t===cc.KEY.dpadDown&&(this._firstFocusedWidget=this._firstFocusedWidget.findNextFocusedWidget(ccui.Widget.DOWN,this._firstFocusedWidget)),t===cc.KEY.dpadUp&&(this._firstFocusedWidget=this._firstFocusedWidget.findNextFocusedWidget(ccui.Widget.UP,this._firstFocusedWidget)),t===cc.KEY.dpadLeft&&(this._firstFocusedWidget=this._firstFocusedWidget.findNextFocusedWidget(ccui.Widget.LEFT,this._firstFocusedWidget)),t===cc.KEY.dpadRight&&(this._firstFocusedWidget=this._firstFocusedWidget.findNextFocusedWidget(ccui.Widget.RIGHT,this._firstFocusedWidget)))},_addKeyboardEventListener:function(){this._keyboardListener||(this._keyboardListener=cc.EventListener.create({event:cc.EventListener.KEYBOARD,onKeyReleased:this._onKeyPressed.bind(this)}),cc.eventManager.addListener(this._keyboardListener,this._keyboardEventPriority))},_removeKeyboardEventListener:function(){this._keyboardListener&&(cc.eventManager.removeEventListener(this._keyboardListener),this._keyboardListener=null)}}),ccui.__LAYOUT_COMPONENT_NAME="__ui_layout",ccui.Widget=ccui.ProtectedNode.extend({_enabled:!0,_bright:!0,_touchEnabled:!1,_brightStyle:null,_touchBeganPosition:null,_touchMovePosition:null,_touchEndPosition:null,_touchEventListener:null,_touchEventSelector:null,_name:"default",_widgetType:null,_actionTag:0,_customSize:null,_layoutParameterDictionary:null,_layoutParameterType:0,_focused:!1,_focusEnabled:!0,_ignoreSize:!1,_affectByClipping:!1,_sizeType:null,_sizePercent:null,_positionType:null,_positionPercent:null,_hit:!1,_nodes:null,_touchListener:null,_className:"Widget",_flippedX:!1,_flippedY:!1,_opacity:255,_highlight:!1,_touchEventCallback:null,_clickEventListener:null,_propagateTouchEvents:!0,_unifySize:!1,_callbackName:null,_callbackType:null,_usingLayoutComponent:!1,ctor:function(){cc.ProtectedNode.prototype.ctor.call(this),this._brightStyle=ccui.Widget.BRIGHT_STYLE_NONE,this._touchBeganPosition=cc.p(0,0),this._touchMovePosition=cc.p(0,0),this._touchEndPosition=cc.p(0,0),this._widgetType=ccui.Widget.TYPE_WIDGET,this._customSize=cc.size(0,0),this._layoutParameterDictionary={},this._sizeType=ccui.Widget.SIZE_ABSOLUTE,this._sizePercent=cc.p(0,0),this._positionType=ccui.Widget.POSITION_ABSOLUTE,this._positionPercent=cc.p(0,0),this._nodes=[],this._layoutParameterType=ccui.LayoutParameter.NONE,this.init()},init:function(){return cc.ProtectedNode.prototype.init.call(this)?(this._layoutParameterDictionary={},this._initRenderer(),this.setBright(!0),this.onFocusChanged=this.onFocusChange.bind(this),this.onNextFocusedWidget=null,this.setAnchorPoint(cc.p(.5,.5)),this.ignoreContentAdaptWithSize(!0),!0):!1},onEnter:function(){var t=this._touchListener;t&&!t._isRegistered()&&this._touchEnabled&&cc.eventManager.addListener(t,this),this._usingLayoutComponent||this.updateSizeAndPosition(),cc.ProtectedNode.prototype.onEnter.call(this)},onExit:function(){this.unscheduleUpdate(),cc.ProtectedNode.prototype.onExit.call(this)},_getOrCreateLayoutComponent:function(){var t=this.getComponent(ccui.__LAYOUT_COMPONENT_NAME);return null==t&&(t=new ccui.LayoutComponent,this.addComponent(t)),t},getWidgetParent:function(){var t=this.getParent();return t instanceof ccui.Widget?t:null},_updateContentSizeWithTextureSize:function(t){this.setContentSize(this._unifySize?t:this._ignoreSize?t:this._customSize)},_isAncestorsEnabled:function(){var t=this._getAncensterWidget(this);return null==t?!0:t&&!t.isEnabled()?!1:t._isAncestorsEnabled()},setPropagateTouchEvents:function(t){this._propagateTouchEvents=t},isPropagateTouchEvents:function(){return this._propagateTouchEvents},setSwallowTouches:function(t){this._touchListener&&this._touchListener.setSwallowTouches(t)},isSwallowTouches:function(){return this._touchListener?this._touchListener.isSwallowTouches():!1},_getAncensterWidget:function(t){return null==t?null:(t=t.getParent(),null==t?null:t instanceof ccui.Widget?t:this._getAncensterWidget(t.getParent()))},_isAncestorsVisible:function(t){return null==t?!0:(t=t.getParent())&&!t.isVisible()?!1:this._isAncestorsVisible(t)},_cleanupWidget:function(){this._eventDispatcher.removeEventListener(this._touchListener),this._touchEnabled=!1,this._touchListener=null,ccui.Widget._focusedWidget===this&&(ccui.Widget._focusedWidget=null,ccui.Widget._focusNavigationController=null)},setEnabled:function(t){this._enabled=t},_initRenderer:function(){},setContentSize:function(t,e){var i=void 0===e?t.width:t,n=void 0===e?t.height:e;if(cc.Node.prototype.setContentSize.call(this,i,n),this._customSize.width=i,this._customSize.height=n,!this._unifySize&&this._ignoreSize&&(this._contentSize=this.getVirtualRendererSize()),!this._usingLayoutComponent&&this._running){var r=this.getWidgetParent(),r=r?r.getContentSize():this._parent.getContentSize();this._sizePercent.x=0<r.width?i/r.width:0,this._sizePercent.y=0<r.height?n/r.height:0}this._onSizeChanged()},_setWidth:function(t){cc.Node.prototype._setWidth.call(this,t),this._customSize.width=t,!this._unifySize&&this._ignoreSize&&(this._contentSize=this.getVirtualRendererSize()),!this._usingLayoutComponent&&this._running&&(t=(t=this.getWidgetParent())?t.width:this._parent.width,this._sizePercent.x=t>0?this._customSize.width/t:0),this._onSizeChanged()},_setHeight:function(t){cc.Node.prototype._setHeight.call(this,t),this._customSize.height=t,!this._unifySize&&this._ignoreSize&&(this._contentSize=this.getVirtualRendererSize()),!this._usingLayoutComponent&&this._running&&(t=(t=this.getWidgetParent())?t.height:this._parent.height,this._sizePercent.y=t>0?this._customSize.height/t:0),this._onSizeChanged()},setSizePercent:function(t){if(this._usingLayoutComponent){var e=this._getOrCreateLayoutComponent();e.setUsingPercentContentSize(!0),e.setPercentContentSize(t),e.refreshLayout()}else{this._sizePercent.x=t.x,this._sizePercent.y=t.y;var e=this._customSize.width,i=this._customSize.height;this._running&&((i=this.getWidgetParent())?(e=i.width*t.x,i=i.height*t.y):(e=this._parent.width*t.x,i=this._parent.height*t.y)),this._ignoreSize?this.setContentSize(this.getVirtualRendererSize()):this.setContentSize(e,i),this._customSize.width=e,this._customSize.height=i}},_setWidthPercent:function(t){this._sizePercent.x=t;var e=this._customSize.width;this._running&&(e=this.getWidgetParent(),e=(e?e.width:this._parent.width)*t),this._setWidth(this._ignoreSize?this.getVirtualRendererSize().width:e),this._customSize.width=e},_setHeightPercent:function(t){this._sizePercent.y=t;var e=this._customSize.height;this._running&&(e=this.getWidgetParent(),e=(e?e.height:this._parent.height)*t),this._setHeight(this._ignoreSize?this.getVirtualRendererSize().height:e),this._customSize.height=e},updateSizeAndPosition:function(t){switch(t||(t=(t=this.getWidgetParent())?t.getLayoutSize():this._parent.getContentSize()),this._sizeType){case ccui.Widget.SIZE_ABSOLUTE:this.setContentSize(this._ignoreSize?this.getVirtualRendererSize():this._customSize),this._sizePercent.x=0<t.width?this._customSize.width/t.width:0,this._sizePercent.y=0<t.height?this._customSize.height/t.height:0;break;case ccui.Widget.SIZE_PERCENT:var e=cc.size(t.width*this._sizePercent.x,t.height*this._sizePercent.y);this.setContentSize(this._ignoreSize?this.getVirtualRendererSize():e),this._customSize.width=e.width,this._customSize.height=e.height}switch(this._onSizeChanged(),e=this.getPosition(),this._positionType){case ccui.Widget.POSITION_ABSOLUTE:0>=t.width||0>=t.height?this._positionPercent.x=this._positionPercent.y=0:(this._positionPercent.x=e.x/t.width,this._positionPercent.y=e.y/t.height);break;case ccui.Widget.POSITION_PERCENT:e=cc.p(t.width*this._positionPercent.x,t.height*this._positionPercent.y)}this._parent instanceof ccui.ImageView&&(t=this._parent._imageRenderer)&&!t._textureLoaded||this.setPosition(e)},setSizeType:function(t){this._sizeType=t,this._usingLayoutComponent&&this._getOrCreateLayoutComponent().setUsingPercentContentSize(this._sizeType===ccui.SIZE_PERCENT)},getSizeType:function(){return this._sizeType},ignoreContentAdaptWithSize:function(t){this._unifySize?this.setContentSize(this._customSize):this._ignoreSize!==t&&(this._ignoreSize=t,this.setContentSize(t?this.getVirtualRendererSize():this._customSize))},isIgnoreContentAdaptWithSize:function(){return this._ignoreSize},getCustomSize:function(){return cc.size(this._customSize)},getLayoutSize:function(){return cc.size(this._contentSize)},getSizePercent:function(){return this._usingLayoutComponent&&(this._sizePercent=this._getOrCreateLayoutComponent().getPercentContentSize()),this._sizePercent},_getWidthPercent:function(){return this._sizePercent.x},_getHeightPercent:function(){return this._sizePercent.y},getWorldPosition:function(){return this.convertToWorldSpace(cc.p(this._anchorPoint.x*this._contentSize.width,this._anchorPoint.y*this._contentSize.height))},getVirtualRenderer:function(){return this},getVirtualRendererSize:function(){return cc.size(this._contentSize)},_onSizeChanged:function(){if(!this._usingLayoutComponent)for(var t=this.getChildren(),e=0,i=t.length;i>e;e++){var n=t[e];n instanceof ccui.Widget&&n.updateSizeAndPosition()}},setTouchEnabled:function(t){this._touchEnabled!==t&&((this._touchEnabled=t)?(this._touchListener||(this._touchListener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:this.onTouchBegan.bind(this),onTouchMoved:this.onTouchMoved.bind(this),onTouchEnded:this.onTouchEnded.bind(this)})),cc.eventManager.addListener(this._touchListener,this)):cc.eventManager.removeListener(this._touchListener))},isTouchEnabled:function(){return this._touchEnabled},isHighlighted:function(){return this._highlight},setHighlighted:function(t){t!==this._highlight&&(this._highlight=t,this._bright?this.setBrightStyle(this._highlight?ccui.Widget.BRIGHT_STYLE_HIGH_LIGHT:ccui.Widget.BRIGHT_STYLE_NORMAL):this._onPressStateChangedToDisabled())},isFocused:function(){return this._focused},setFocused:function(t){(this._focused=t)&&(ccui.Widget._focusedWidget=this,ccui.Widget._focusNavigationController&&ccui.Widget._focusNavigationController._setFirstFocsuedWidget(this))},isFocusEnabled:function(){return this._focusEnabled},setFocusEnabled:function(t){this._focusEnabled=t},findNextFocusedWidget:function(t,e){if(null===this.onNextFocusedWidget||null==this.onNextFocusedWidget(t)){var i=e instanceof ccui.Layout;if(this.isFocused()||i){var n=this.getParent();return null!==n&&n instanceof ccui.Layout?n.findNextFocusedWidget(t,e):i?e.findNextFocusedWidget(t,e):e}return e}return i=this.onNextFocusedWidget(t),this.dispatchFocusEvent(this,i),i},requestFocus:function(){this!==ccui.Widget._focusedWidget&&this.dispatchFocusEvent(ccui.Widget._focusedWidget,this)},getCurrentFocusedWidget:function(){return ccui.Widget._focusedWidget},onFocusChanged:null,onNextFocusedWidget:null,interceptTouchEvent:function(t,e,i){var n=this.getWidgetParent();n&&n.interceptTouchEvent(t,e,i)},onFocusChange:function(t,e){t&&t.setFocused(!1),e&&e.setFocused(!0)},dispatchFocusEvent:function(t,e){t&&!t.isFocused()&&(t=ccui.Widget._focusedWidget),e!==t&&(e&&e.onFocusChanged&&e.onFocusChanged(t,e),t&&e.onFocusChanged&&t.onFocusChanged(t,e),cc.eventManager.dispatchEvent(new cc.EventFocus(t,e)))},setBright:function(t){(this._bright=t)?(this._brightStyle=ccui.Widget.BRIGHT_STYLE_NONE,this.setBrightStyle(ccui.Widget.BRIGHT_STYLE_NORMAL)):this._onPressStateChangedToDisabled()},setBrightStyle:function(t){if(this._brightStyle!==t)switch(this._brightStyle=t=t||ccui.Widget.BRIGHT_STYLE_NORMAL,this._brightStyle){case ccui.Widget.BRIGHT_STYLE_NORMAL:this._onPressStateChangedToNormal();break;case ccui.Widget.BRIGHT_STYLE_HIGH_LIGHT:this._onPressStateChangedToPressed()
}},_onPressStateChangedToNormal:function(){},_onPressStateChangedToPressed:function(){},_onPressStateChangedToDisabled:function(){},_updateChildrenDisplayedRGBA:function(){this.setColor(this.getColor()),this.setOpacity(this.getOpacity())},didNotSelectSelf:function(){},onTouchBegan:function(t){if(this._hit=!1,this.isVisible()&&this.isEnabled()&&this._isAncestorsEnabled()&&this._isAncestorsVisible(this)){var e=t.getLocation();this._touchBeganPosition.x=e.x,this._touchBeganPosition.y=e.y,this.hitTest(this._touchBeganPosition)&&this.isClippingParentContainsPoint(this._touchBeganPosition)&&(this._hit=!0)}return this._hit?(this.setHighlighted(!0),this._propagateTouchEvents&&this.propagateTouchEvent(ccui.Widget.TOUCH_BEGAN,this,t),this._pushDownEvent(),!0):!1},propagateTouchEvent:function(t,e,i){var n=this.getWidgetParent();n&&n.interceptTouchEvent(t,e,i)},onTouchMoved:function(t){var e=t.getLocation();this._touchMovePosition.x=e.x,this._touchMovePosition.y=e.y,this.setHighlighted(this.hitTest(e)),this._propagateTouchEvents&&this.propagateTouchEvent(ccui.Widget.TOUCH_MOVED,this,t),this._moveEvent()},onTouchEnded:function(t){var e=t.getLocation();this._touchEndPosition.x=e.x,this._touchEndPosition.y=e.y,this._propagateTouchEvents&&this.propagateTouchEvent(ccui.Widget.TOUCH_ENDED,this,t),e=this._highlight,this.setHighlighted(!1),e?this._releaseUpEvent():this._cancelUpEvent()},onTouchCancelled:function(){this.setHighlighted(!1),this._cancelUpEvent()},onTouchLongClicked:function(){this.longClickEvent()},_pushDownEvent:function(){this._touchEventCallback&&this._touchEventCallback(this,ccui.Widget.TOUCH_BEGAN),this._touchEventListener&&this._touchEventSelector&&this._touchEventSelector.call(this._touchEventListener,this,ccui.Widget.TOUCH_BEGAN)},_moveEvent:function(){this._touchEventCallback&&this._touchEventCallback(this,ccui.Widget.TOUCH_MOVED),this._touchEventListener&&this._touchEventSelector&&this._touchEventSelector.call(this._touchEventListener,this,ccui.Widget.TOUCH_MOVED)},_releaseUpEvent:function(){this._touchEventCallback&&this._touchEventCallback(this,ccui.Widget.TOUCH_ENDED),this._touchEventListener&&this._touchEventSelector&&this._touchEventSelector.call(this._touchEventListener,this,ccui.Widget.TOUCH_ENDED),this._clickEventListener&&this._clickEventListener(this)},_cancelUpEvent:function(){this._touchEventCallback&&this._touchEventCallback(this,ccui.Widget.TOUCH_CANCELED),this._touchEventListener&&this._touchEventSelector&&this._touchEventSelector.call(this._touchEventListener,this,ccui.Widget.TOUCH_CANCELED)},longClickEvent:function(){},addTouchEventListener:function(t,e){void 0===e?this._touchEventCallback=t:(this._touchEventSelector=t,this._touchEventListener=e)},addClickEventListener:function(t){this._clickEventListener=t},hitTest:function(t){var e=cc.rect(0,0,this._contentSize.width,this._contentSize.height);return cc.rectContainsPoint(e,this.convertToNodeSpace(t))},isClippingParentContainsPoint:function(t){this._affectByClipping=!1;for(var e=this.getParent(),i=null;e;){if(e instanceof ccui.Layout&&e.isClippingEnabled()){this._affectByClipping=!0,i=e;break}e=e.getParent()}return this._affectByClipping&&i?i.hitTest(t)?i.isClippingParentContainsPoint(t):!1:!0},checkChildInfo:function(t,e,i){var n=this.getWidgetParent();n&&n.checkChildInfo(t,e,i)},setPosition:function(t,e){if(!this._usingLayoutComponent&&this._running){var i=this.getWidgetParent();i&&(i=i.getContentSize(),0>=i.width||0>=i.height?(this._positionPercent.x=0,this._positionPercent.y=0):void 0===e?(this._positionPercent.x=t.x/i.width,this._positionPercent.y=t.y/i.height):(this._positionPercent.x=t/i.width,this._positionPercent.y=e/i.height))}cc.Node.prototype.setPosition.call(this,t,e)},setPositionX:function(t){if(this._running){var e=this.getWidgetParent();e&&(e=e.width,this._positionPercent.x=0>=e?0:t/e)}cc.Node.prototype.setPositionX.call(this,t)},setPositionY:function(t){if(this._running){var e=this.getWidgetParent();e&&(e=e.height,this._positionPercent.y=0>=e?0:t/e)}cc.Node.prototype.setPositionY.call(this,t)},setPositionPercent:function(t){if(this._usingLayoutComponent){var e=this._getOrCreateLayoutComponent();e.setPositionPercentX(t.x),e.setPositionPercentY(t.y),e.refreshLayout()}else this._setXPercent(t.x),this._setYPercent(t.y),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},_setXPercent:function(t){if(this._usingLayoutComponent){var e=this._getOrCreateLayoutComponent();e.setPositionPercentX(t.x),e.refreshLayout()}else this._positionPercent.x=t},_setYPercent:function(t){if(this._usingLayoutComponent){var e=this._getOrCreateLayoutComponent();e.setPositionPercentY(t.x),e.refreshLayout()}else this._positionPercent.y=t},getPositionPercent:function(){if(this._usingLayoutComponent){var t=this._getOrCreateLayoutComponent();this._positionPercent.x=t.getPositionPercentX(),this._positionPercent.y=t.getPositionPercentY()}return cc.p(this._positionPercent)},_getXPercent:function(){if(this._usingLayoutComponent){var t=this._getOrCreateLayoutComponent();this._positionPercent.x=t.getPositionPercentX(),this._positionPercent.y=t.getPositionPercentY()}return this._positionPercent.x},_getYPercent:function(){if(this._usingLayoutComponent){var t=this._getOrCreateLayoutComponent();this._positionPercent.x=t.getPositionPercentX(),this._positionPercent.y=t.getPositionPercentY()}return this._positionPercent.y},setPositionType:function(t){if(this._positionType=t,this._usingLayoutComponent){var e=this._getOrCreateLayoutComponent();t===ccui.POSITION_ABSOLUTE?(e.setPositionPercentXEnabled(!1),e.setPositionPercentYEnabled(!1)):(e.setPositionPercentXEnabled(!0),e.setPositionPercentYEnabled(!0))}this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getPositionType:function(){return this._positionType},setFlippedX:function(t){var e=this.getScaleX();this._flippedX=t,this.setScaleX(e)},isFlippedX:function(){return this._flippedX},setFlippedY:function(t){var e=this.getScaleY();this._flippedY=t,this.setScaleY(e)},isFlippedY:function(){return this._flippedY},_adaptRenderers:function(){},isBright:function(){return this._bright},isEnabled:function(){return this._enabled},getLeftBoundary:function(){return this.getPositionX()-this._getAnchorX()*this._contentSize.width},getBottomBoundary:function(){return this.getPositionY()-this._getAnchorY()*this._contentSize.height},getRightBoundary:function(){return this.getLeftBoundary()+this._contentSize.width},getTopBoundary:function(){return this.getBottomBoundary()+this._contentSize.height},getTouchBeganPosition:function(){return cc.p(this._touchBeganPosition)},getTouchMovePosition:function(){return cc.p(this._touchMovePosition)},getTouchEndPosition:function(){return cc.p(this._touchEndPosition)},getWidgetType:function(){return this._widgetType},setLayoutParameter:function(t){t&&(this._layoutParameterDictionary[t.getLayoutType()]=t,this._layoutParameterType=t.getLayoutType())},getLayoutParameter:function(t){return t=t||this._layoutParameterType,this._layoutParameterDictionary[t]},getDescription:function(){return"Widget"},clone:function(){var t=this._createCloneInstance();return t._copyProperties(this),t._copyClonedWidgetChildren(this),t},_createCloneInstance:function(){return new ccui.Widget},_copyClonedWidgetChildren:function(t){t=t.getChildren();for(var e=0;e<t.length;e++){var i=t[e];i instanceof ccui.Widget&&this.addChild(i.clone())}},_copySpecialProperties:function(){},_copyProperties:function(t){this.setEnabled(t.isEnabled()),this.setVisible(t.isVisible()),this.setBright(t.isBright()),this.setTouchEnabled(t.isTouchEnabled()),this.setLocalZOrder(t.getLocalZOrder()),this.setTag(t.getTag()),this.setName(t.getName()),this.setActionTag(t.getActionTag()),this._ignoreSize=t._ignoreSize,this.setContentSize(t._contentSize),this._customSize.width=t._customSize.width,this._customSize.height=t._customSize.height,this._copySpecialProperties(t),this._sizeType=t.getSizeType(),this._sizePercent.x=t._sizePercent.x,this._sizePercent.y=t._sizePercent.y,this._positionType=t._positionType,this._positionPercent.x=t._positionPercent.x,this._positionPercent.y=t._positionPercent.y,this.setPosition(t.getPosition()),this.setAnchorPoint(t.getAnchorPoint()),this.setScaleX(t.getScaleX()),this.setScaleY(t.getScaleY()),this.setRotation(t.getRotation()),this.setRotationX(t.getRotationX()),this.setRotationY(t.getRotationY()),this.setFlippedX(t.isFlippedX()),this.setFlippedY(t.isFlippedY()),this.setColor(t.getColor()),this.setOpacity(t.getOpacity()),this._touchEventCallback=t._touchEventCallback,this._touchEventListener=t._touchEventListener,this._touchEventSelector=t._touchEventSelector,this._clickEventListener=t._clickEventListener,this._focused=t._focused,this._focusEnabled=t._focusEnabled,this._propagateTouchEvents=t._propagateTouchEvents;for(var e in t._layoutParameterDictionary){var i=t._layoutParameterDictionary[e];i&&this.setLayoutParameter(i.clone())}this._onSizeChanged()},setActionTag:function(t){this._actionTag=t},getActionTag:function(){return this._actionTag},getLeftInParent:function(){return cc.log("getLeftInParent is deprecated. Please use getLeftBoundary instead."),this.getLeftBoundary()},getBottomInParent:function(){return cc.log("getBottomInParent is deprecated. Please use getBottomBoundary instead."),this.getBottomBoundary()},getRightInParent:function(){return cc.log("getRightInParent is deprecated. Please use getRightBoundary instead."),this.getRightBoundary()},getTopInParent:function(){return cc.log("getTopInParent is deprecated. Please use getTopBoundary instead."),this.getTopBoundary()},getTouchEndPos:function(){return cc.log("getTouchEndPos is deprecated. Please use getTouchEndPosition instead."),this.getTouchEndPosition()},getTouchMovePos:function(){return cc.log("getTouchMovePos is deprecated. Please use getTouchMovePosition instead."),this.getTouchMovePosition()},clippingParentAreaContainPoint:function(t){cc.log("clippingParentAreaContainPoint is deprecated. Please use isClippingParentContainsPoint instead."),this.isClippingParentContainsPoint(t)},getTouchStartPos:function(){return cc.log("getTouchStartPos is deprecated. Please use getTouchBeganPosition instead."),this.getTouchBeganPosition()},setSize:function(t){this.setContentSize(t)},getSize:function(){return this.getContentSize()},addNode:function(t,e,i){t instanceof ccui.Widget?cc.log("Please use addChild to add a Widget."):(cc.Node.prototype.addChild.call(this,t,e,i),this._nodes.push(t))},getNodeByTag:function(t){for(var e=this._nodes,i=0;i<e.length;i++){var n=e[i];if(n&&n.getTag()===t)return n}return null},getNodes:function(){return this._nodes},removeNode:function(t,e){cc.Node.prototype.removeChild.call(this,t,e),cc.arrayRemoveObject(this._nodes,t)},removeNodeByTag:function(t,e){var i=this.getChildByTag(t);i?this.removeChild(i,e):cc.log("cocos2d: removeNodeByTag(tag = %d): child not found!",t)},removeAllNodes:function(){for(var t=0;t<this._nodes.length;t++)cc.Node.prototype.removeChild.call(this,this._nodes[t]);this._nodes.length=0},_findLayout:function(){cc.renderer.childrenOrderDirty=!0;for(var t=this._parent;t;){if(t._doLayout){t._doLayoutDirty=!0;break}t=t._parent}},isUnifySizeEnabled:function(){return this._unifySize},setUnifySizeEnabled:function(t){this._unifySize=t},_ccEventCallback:null,addCCSEventListener:function(t){this._ccEventCallback=t},setScaleX:function(t){this._flippedX&&(t*=-1),cc.Node.prototype.setScaleX.call(this,t)},setScaleY:function(t){this._flippedY&&(t*=-1),cc.Node.prototype.setScaleY.call(this,t)},setScale:function(t,e){void 0===e&&(e=t),this.setScaleX(t),this.setScaleY(e)},getScaleX:function(){var t=cc.Node.prototype.getScaleX.call(this);return this._flippedX&&(t*=-1),t},getScaleY:function(){var t=cc.Node.prototype.getScaleY.call(this);return this._flippedY&&(t*=-1),t},getScale:function(){return this.getScaleX()!==this.getScaleY()&&cc.log("Widget#scale. ScaleX != ScaleY. Don't know which one to return"),this.getScaleX()},setCallbackName:function(t){this._callbackName=t},getCallbackName:function(){return this._callbackName},setCallbackType:function(t){this._callbackType=t},getCallbackType:function(){return this._callbackType},setLayoutComponentEnabled:function(t){this._usingLayoutComponent=t},isLayoutComponentEnabled:function(){return this._usingLayoutComponent},_createRenderCmd:function(){return cc._renderType===cc._RENDER_TYPE_WEBGL?new ccui.Widget.WebGLRenderCmd(this):new ccui.Widget.CanvasRenderCmd(this)}}),_p=ccui.Widget.prototype,cc.defineGetterSetter(_p,"xPercent",_p._getXPercent,_p._setXPercent),cc.defineGetterSetter(_p,"yPercent",_p._getYPercent,_p._setYPercent),cc.defineGetterSetter(_p,"widthPercent",_p._getWidthPercent,_p._setWidthPercent),cc.defineGetterSetter(_p,"heightPercent",_p._getHeightPercent,_p._setHeightPercent),cc.defineGetterSetter(_p,"widgetParent",_p.getWidgetParent),cc.defineGetterSetter(_p,"enabled",_p.isEnabled,_p.setEnabled),cc.defineGetterSetter(_p,"focused",_p.isFocused,_p.setFocused),cc.defineGetterSetter(_p,"sizeType",_p.getSizeType,_p.setSizeType),cc.defineGetterSetter(_p,"widgetType",_p.getWidgetType),cc.defineGetterSetter(_p,"touchEnabled",_p.isTouchEnabled,_p.setTouchEnabled),cc.defineGetterSetter(_p,"updateEnabled",_p.isUpdateEnabled,_p.setUpdateEnabled),cc.defineGetterSetter(_p,"bright",_p.isBright,_p.setBright),cc.defineGetterSetter(_p,"name",_p.getName,_p.setName),cc.defineGetterSetter(_p,"actionTag",_p.getActionTag,_p.setActionTag),cc.defineGetterSetter(_p,"opacity",_p.getOpacity,_p.setOpacity),_p=null,ccui.Widget.create=function(){return new ccui.Widget},ccui.Widget._focusedWidget=null,ccui.Widget._focusNavigationController=null,ccui.Widget.enableDpadNavigation=function(t){t?(null==ccui.Widget._focusNavigationController&&(ccui.Widget._focusNavigationController=new ccui._FocusNavigationController,ccui.Widget._focusedWidget&&ccui.Widget._focusNavigationController._setFirstFocsuedWidget(ccui.Widget._focusedWidget)),ccui.Widget._focusNavigationController.enableFocusNavigation(!0)):ccui.Widget._focusNavigationController&&(ccui.Widget._focusNavigationController.enableFocusNavigation(!1),ccui.Widget._focusNavigationController=null)},ccui.Widget.getCurrentFocusedWidget=function(){return ccui.Widget._focusedWidget},ccui.Widget.BRIGHT_STYLE_NONE=-1,ccui.Widget.BRIGHT_STYLE_NORMAL=0,ccui.Widget.BRIGHT_STYLE_HIGH_LIGHT=1,ccui.Widget.TYPE_WIDGET=0,ccui.Widget.TYPE_CONTAINER=1,ccui.Widget.LEFT=0,ccui.Widget.RIGHT=1,ccui.Widget.UP=2,ccui.Widget.DOWN=3,ccui.Widget.LOCAL_TEXTURE=0,ccui.Widget.PLIST_TEXTURE=1,ccui.Widget.TOUCH_BEGAN=0,ccui.Widget.TOUCH_MOVED=1,ccui.Widget.TOUCH_ENDED=2,ccui.Widget.TOUCH_CANCELED=3,ccui.Widget.SIZE_ABSOLUTE=0,ccui.Widget.SIZE_PERCENT=1,ccui.Widget.POSITION_ABSOLUTE=0,ccui.Widget.POSITION_PERCENT=1,cc._renderType===cc._RENDER_TYPE_CANVAS?function(){ccui.Widget.CanvasRenderCmd=function(t){cc.ProtectedNode.CanvasRenderCmd.call(this,t),this._needDraw=!1};var t=ccui.Widget.CanvasRenderCmd.prototype=Object.create(cc.ProtectedNode.CanvasRenderCmd.prototype);t.constructor=ccui.Widget.CanvasRenderCmd,t.visit=function(t){var e=this._node;e._visible&&(e._adaptRenderers(),cc.ProtectedNode.CanvasRenderCmd.prototype.visit.call(this,t))},t.transform=function(t,e){var i=this._node;if(i._visible){if(i._adaptRenderers(),!this._usingLayoutComponent){var n=i.getWidgetParent();n&&(n=n.getContentSize(),0!==n.width&&0!==n.height&&(i._position.x=n.width*i._positionPercent.x,i._position.y=n.height*i._positionPercent.y))}cc.ProtectedNode.CanvasRenderCmd.prototype.transform.call(this,t,e)}}}():function(){ccui.Widget.WebGLRenderCmd=function(t){cc.ProtectedNode.WebGLRenderCmd.call(this,t),this._needDraw=!1};var t=ccui.Widget.WebGLRenderCmd.prototype=Object.create(cc.ProtectedNode.WebGLRenderCmd.prototype);t.constructor=ccui.Widget.WebGLRenderCmd,t.visit=function(t){var e=this._node;e._visible&&(e._adaptRenderers(),cc.ProtectedNode.WebGLRenderCmd.prototype.visit.call(this,t))},t.transform=function(t,e){var i=this._node;if(i._visible){if(i._adaptRenderers(),!this._usingLayoutComponent){var n=i.getWidgetParent();n&&(n=n.getContentSize(),0!==n.width&&0!==n.height&&(i._position.x=n.width*i._positionPercent.x,i._position.y=n.height*i._positionPercent.y))}cc.ProtectedNode.WebGLRenderCmd.prototype.transform.call(this,t,e)}}}(),ccui.Scale9Sprite=cc.Node.extend({_spriteRect:null,_capInsetsInternal:null,_positionsAreDirty:!1,_scale9Image:null,_topLeft:null,_top:null,_topRight:null,_left:null,_centre:null,_right:null,_bottomLeft:null,_bottom:null,_bottomRight:null,_scale9Dirty:!0,_opacityModifyRGB:!1,_originalSize:null,_preferredSize:null,_opacity:0,_color:null,_capInsets:null,_insetLeft:0,_insetTop:0,_insetRight:0,_insetBottom:0,_spritesGenerated:!1,_spriteFrameRotated:!1,_textureLoaded:!1,_className:"Scale9Sprite",_flippedX:!1,_flippedY:!1,textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(t,e){this.addEventListener("load",t,e)},_updateCapInset:function(){var t;t=this._insetLeft;var e=this._insetTop,i=this._insetRight,n=this._spriteRect,r=this._insetBottom;t=0===t&&0===e&&0===i&&0===r?cc.rect(0,0,0,0):this._spriteFrameRotated?cc.rect(r,t,n.width-i-t,n.height-e-r):cc.rect(t,e,n.width-t-i,n.height-e-r),this.setCapInsets(t)},_updatePositions:function(){if(this._topLeft&&this._topRight&&this._bottomRight&&this._bottomLeft&&this._centre){var t=this._contentSize,e=this._topLeft,i=this._topRight,n=this._bottomRight,r=this._bottomLeft,o=this._centre,s=this._centre.getContentSize(),c=e.getContentSize(),a=r.getContentSize(),l=t.width-c.width-i.getContentSize().width,t=t.height-c.height-n.getContentSize().height,l=l/s.width,t=t/s.height,c=s.width*l,h=s.height*t,u=a.width,a=a.height;if(cc._renderType===cc._RENDER_TYPE_WEBGL){var d=Math.round(c);c!==d&&(c=d,l=c/s.width),d=Math.round(h),h!==d&&(h=d,t=h/s.height)}o.setScaleX(l),o.setScaleY(t);var s=this._left,d=this._right,_=this._top,p=this._bottom,f=cc.p(0,0);r.setAnchorPoint(f),n.setAnchorPoint(f),e.setAnchorPoint(f),i.setAnchorPoint(f),s.setAnchorPoint(f),d.setAnchorPoint(f),_.setAnchorPoint(f),p.setAnchorPoint(f),o.setAnchorPoint(f),r.setPosition(0,0),n.setPosition(u+c,0),e.setPosition(0,a+h),i.setPosition(u+c,a+h),s.setPosition(0,a),s.setScaleY(t),d.setPosition(u+c,a),d.setScaleY(t),p.setPosition(u,0),p.setScaleX(l),_.setPosition(u,a+h),_.setScaleX(l),o.setPosition(u,a)}},ctor:function(t,e,i){if(cc.Node.prototype.ctor.call(this),this._spriteRect=cc.rect(0,0,0,0),this._capInsetsInternal=cc.rect(0,0,0,0),this._originalSize=cc.size(0,0),this._preferredSize=cc.size(0,0),this._capInsets=cc.rect(0,0,0,0),void 0!=t)if(t instanceof cc.SpriteFrame)this.initWithSpriteFrame(t,e);else{var n=cc.spriteFrameCache.getSpriteFrame(t);null!=n?this.initWithSpriteFrame(n,e):this.initWithFile(t,e,i)}else this.init()},getSprite:function(){return this._scale9Image},getOriginalSize:function(){return cc.size(this._originalSize)},getPreferredSize:function(){return cc.size(this._preferredSize)},_getPreferredWidth:function(){return this._preferredSize.width},_getPreferredHeight:function(){return this._preferredSize.height},setPreferredSize:function(t){this.setContentSize(t),this._preferredSize=t,this._positionsAreDirty&&(this._updatePositions(),this._positionsAreDirty=!1,this._scale9Dirty=!0)},_setPreferredWidth:function(t){this._setWidth(t),this._preferredSize.width=t},_setPreferredHeight:function(t){this._setHeight(t),this._preferredSize.height=t},setOpacity:function(t){if(this._scale9Image){cc.Node.prototype.setOpacity.call(this,t);for(var e=this._scale9Image.getChildren(),i=0;i<e.length;i++){var n=e[i];n&&n.setOpacity(t)}this._scale9Dirty=!0}},setColor:function(t){if(this._scale9Image){cc.Node.prototype.setColor.call(this,t);for(var e=this._scale9Image.getChildren(),i=0;i<e.length;i++){var n=e[i];n&&n.setColor(t)}this._scale9Dirty=!0}},getCapInsets:function(){return cc.rect(this._capInsets)},setCapInsets:function(t){if(this._scale9Image){var e=this._contentSize,i=e.width,e=e.height;this.updateWithBatchNode(this._scale9Image,this._spriteRect,this._spriteFrameRotated,t),this.setContentSize(i,e)}},getInsetLeft:function(){return this._insetLeft},setInsetLeft:function(t){this._insetLeft=t,this._updateCapInset()},getInsetTop:function(){return this._insetTop},setInsetTop:function(t){this._insetTop=t,this._updateCapInset()},getInsetRight:function(){return this._insetRight},setInsetRight:function(t){this._insetRight=t,this._updateCapInset()},getInsetBottom:function(){return this._insetBottom},setInsetBottom:function(t){this._insetBottom=t,this._updateCapInset()},setContentSize:function(t,e){cc.Node.prototype.setContentSize.call(this,t,e),this._positionsAreDirty=!0},_setWidth:function(t){cc.Node.prototype._setWidth.call(this,t),this._positionsAreDirty=!0},_setHeight:function(t){cc.Node.prototype._setHeight.call(this,t),this._positionsAreDirty=!0},init:function(){return this.initWithBatchNode(null,cc.rect(0,0,0,0),!1,cc.rect(0,0,0,0))},initWithBatchNode:function(t,e,i,n){return void 0===n&&(n=i,i=!1),t&&this.updateWithBatchNode(t,e,i,n),this.setCascadeColorEnabled(!0),this.setCascadeOpacityEnabled(!0),this.setAnchorPoint(.5,.5),this._positionsAreDirty=!0},initWithFile:function(t,e,i){if(t instanceof cc.Rect?(i=t=e,e=cc.rect(0,0,0,0)):(e=e||cc.rect(0,0,0,0),i=i||cc.rect(0,0,0,0)),!t)throw"ccui.Scale9Sprite.initWithFile(): file should be non-null";var n=cc.textureCache.getTextureForKey(t);n||(n=cc.textureCache.addImage(t));var r=n.isLoaded();return(this._textureLoaded=r)||n.addEventListener("load",function(t){var e=this._preferredSize,i=0!==e.width&&0!==e.height;i&&(e=cc.size(e.width,e.height)),t=t.getContentSize(),this.updateWithBatchNode(this._scale9Image,cc.rect(0,0,t.width,t.height),!1,this._capInsets),i&&this.setPreferredSize(e),this._positionsAreDirty=!0,this.dispatchEvent("load")},this),this.initWithBatchNode(new cc.SpriteBatchNode(t,9),e,!1,i)},initWithSpriteFrame:function(t,e){if(!t||!t.getTexture())throw"ccui.Scale9Sprite.initWithSpriteFrame(): spriteFrame should be non-null and its texture should be non-null";e=e||cc.rect(0,0,0,0);var i=t.textureLoaded();return(this._textureLoaded=i)||t.addEventListener("load",function(t){var e=this._preferredSize,i=0!==e.width&&0!==e.height;i&&(e=cc.size(e.width,e.height)),this.updateWithBatchNode(this._scale9Image,t.getRect(),cc._renderType===cc._RENDER_TYPE_WEBGL&&t.isRotated(),this._capInsets),i&&this.setPreferredSize(e),this._positionsAreDirty=!0,this.dispatchEvent("load")},this),i=new cc.SpriteBatchNode(t.getTexture(),9),this.initWithBatchNode(i,t.getRect(),cc._renderType===cc._RENDER_TYPE_WEBGL&&t.isRotated(),e)},initWithSpriteFrameName:function(t,e){if(!t)throw"ccui.Scale9Sprite.initWithSpriteFrameName(): spriteFrameName should be non-null";e=e||cc.rect(0,0,0,0);var i=cc.spriteFrameCache.getSpriteFrame(t);return null==i?(cc.log("ccui.Scale9Sprite.initWithSpriteFrameName(): can't find the sprite frame by spriteFrameName"),!1):this.initWithSpriteFrame(i,e)},resizableSpriteWithCapInsets:function(t){var e=new ccui.Scale9Sprite;return e&&e.initWithBatchNode(this._scale9Image,this._spriteRect,!1,t)?e:null},setOpacityModifyRGB:function(t){if(this._scale9Image){this._opacityModifyRGB=t;var e=this._scale9Image.getChildren();if(e)for(var i=0,n=e.length;n>i;i++)e[i].setOpacityModifyRGB(t)}},isOpacityModifyRGB:function(){return this._opacityModifyRGB},updateWithBatchNode:function(t,e,i,n){var r=this.getOpacity(),o=this.getColor();if(e=cc.rect(e.x,e.y,e.width,e.height),this.removeAllChildren(!0),this._scale9Image!==t&&(this._scale9Image=t),!this._scale9Image)return!1;t=t.getTexture();var s=t.isLoaded();this._textureLoaded=s;var c=this._capInsets;if(c.x=n.x,c.y=n.y,c.width=n.width,c.height=n.height,!s)return t.addEventListener("load",function(){this._positionsAreDirty=!0,this.dispatchEvent("load")},this),!0;t=this._scale9Image,t.removeAllChildren(!0),this._spriteFrameRotated=i,s=t.getTexture(),cc._rectEqualToZero(e)&&(e=s.getContentSize(),e=cc.rect(0,0,e.width,e.height)),c=this._spriteRect=e,c.x=e.x,c.y=e.y,c.width=e.width,c.height=e.height,this._originalSize.width=e.width,this._originalSize.height=e.height,c=this._preferredSize,0===c.width&&0===c.height&&(c.width=e.width,c.height=e.height),c=this._capInsetsInternal,n&&(c.x=n.x,c.y=n.y,c.width=n.width,c.height=n.height);var a=e.width;n=e.height,cc._rectEqualToZero(c)&&(c.x=a/3,c.y=n/3,c.width=a/3,c.height=n/3);var l=c.x,h=c.width,u=a-(l+h),d=c.y,_=c.height,p=n-(d+_),f=0,m=0;n=cc.rect(f+.5|0,m+.5|0,l+.5|0,d+.5|0);var f=f+l,c=cc.rect(f+.5|0,m+.5|0,h+.5|0,d+.5|0),a=cc.rect(f+h+.5|0,m+.5|0,u+.5|0,d+.5|0),f=0,m=0+d,g=cc.rect(f+.5|0,m+.5|0,l+.5|0,_+.5|0),f=f+l,y=cc.rect(f+.5|0,m+.5|0,h+.5|0,_+.5|0),f=f+h,T=cc.rect(f+.5|0,m+.5|0,u+.5|0,_+.5|0),f=0,m=0+d+_,d=cc.rect(f+.5|0,m+.5|0,l+.5|0,p+.5|0),f=f+l,l=cc.rect(f+.5|0,m+.5|0,h+.5|0,p+.5|0),f=f+h,h=cc.rect(f+.5|0,m+.5|0,u+.5|0,p+.5|0),u=cc.affineTransformMakeIdentity();if(i){i=y;var p=h,f=d,m=a,_=n,S=T,C=g,v=l,x=c,u=cc.affineTransformTranslate(u,e.height+e.x,e.y),u=cc.affineTransformRotate(u,1.57079633),y=cc.rectApplyAffineTransform(y,u),h=cc.rectApplyAffineTransform(h,u),d=cc.rectApplyAffineTransform(d,u),a=cc.rectApplyAffineTransform(a,u);n=cc.rectApplyAffineTransform(n,u),T=cc.rectApplyAffineTransform(T,u),g=cc.rectApplyAffineTransform(g,u),l=cc.rectApplyAffineTransform(l,u),c=cc.rectApplyAffineTransform(c,u),i.x=y.x,i.y=y.y,p.x=h.x,p.y=h.y,f.x=d.x,f.y=d.y,m.x=a.x,m.y=a.y,_.x=n.x,_.y=n.y,S.x=T.x,S.y=T.y,C.x=g.x,C.y=g.y,v.x=l.x,v.y=l.y,x.x=c.x,x.y=c.y,this._centre=new cc.Sprite,this._centre.initWithTexture(s,i,!0),t.addChild(this._centre,0,ccui.Scale9Sprite.POSITIONS_CENTRE),this._top=new cc.Sprite,this._top.initWithTexture(s,x,!0),t.addChild(this._top,1,ccui.Scale9Sprite.POSITIONS_TOP),this._bottom=new cc.Sprite,this._bottom.initWithTexture(s,v,!0),t.addChild(this._bottom,1,ccui.Scale9Sprite.POSITIONS_BOTTOM),this._left=new cc.Sprite,this._left.initWithTexture(s,C,!0),t.addChild(this._left,1,ccui.Scale9Sprite.POSITIONS_LEFT),this._right=new cc.Sprite,this._right.initWithTexture(s,S,!0),t.addChild(this._right,1,ccui.Scale9Sprite.POSITIONS_RIGHT),this._topLeft=new cc.Sprite,this._topLeft.initWithTexture(s,_,!0),t.addChild(this._topLeft,2,ccui.Scale9Sprite.POSITIONS_TOPLEFT),this._topRight=new cc.Sprite,this._topRight.initWithTexture(s,m,!0),t.addChild(this._topRight,2,ccui.Scale9Sprite.POSITIONS_TOPRIGHT),this._bottomLeft=new cc.Sprite,this._bottomLeft.initWithTexture(s,f,!0),t.addChild(this._bottomLeft,2,ccui.Scale9Sprite.POSITIONS_BOTTOMLEFT),this._bottomRight=new cc.Sprite,this._bottomRight.initWithTexture(s,p,!0)}else u=cc.affineTransformTranslate(u,e.x,e.y),cc._rectApplyAffineTransformIn(y,u),cc._rectApplyAffineTransformIn(h,u),cc._rectApplyAffineTransformIn(d,u),cc._rectApplyAffineTransformIn(a,u),cc._rectApplyAffineTransformIn(n,u),cc._rectApplyAffineTransformIn(T,u),cc._rectApplyAffineTransformIn(g,u),cc._rectApplyAffineTransformIn(l,u),cc._rectApplyAffineTransformIn(c,u),this._centre=new cc.Sprite,this._centre.initWithTexture(s,y),t.addChild(this._centre,0,ccui.Scale9Sprite.POSITIONS_CENTRE),this._top=new cc.Sprite,this._top.initWithTexture(s,c),t.addChild(this._top,1,ccui.Scale9Sprite.POSITIONS_TOP),this._bottom=new cc.Sprite,this._bottom.initWithTexture(s,l),t.addChild(this._bottom,1,ccui.Scale9Sprite.POSITIONS_BOTTOM),this._left=new cc.Sprite,this._left.initWithTexture(s,g),t.addChild(this._left,1,ccui.Scale9Sprite.POSITIONS_LEFT),this._right=new cc.Sprite,this._right.initWithTexture(s,T),t.addChild(this._right,1,ccui.Scale9Sprite.POSITIONS_RIGHT),this._topLeft=new cc.Sprite,this._topLeft.initWithTexture(s,n),t.addChild(this._topLeft,2,ccui.Scale9Sprite.POSITIONS_TOPLEFT),this._topRight=new cc.Sprite,this._topRight.initWithTexture(s,a),t.addChild(this._topRight,2,ccui.Scale9Sprite.POSITIONS_TOPRIGHT),this._bottomLeft=new cc.Sprite,this._bottomLeft.initWithTexture(s,d),t.addChild(this._bottomLeft,2,ccui.Scale9Sprite.POSITIONS_BOTTOMLEFT),this._bottomRight=new cc.Sprite,this._bottomRight.initWithTexture(s,h);return t.addChild(this._bottomRight,2,ccui.Scale9Sprite.POSITIONS_BOTTOMRIGHT),this.setContentSize(e.width,e.height),cc._renderType===cc._RENDER_TYPE_WEBGL&&this.addChild(t),this._spritesGenerated&&(this.setOpacity(r),this.setColor(o)),this._spritesGenerated=!0},setSpriteFrame:function(t){var e=new cc.SpriteBatchNode(t.getTexture(),9),i=t.textureLoaded();(this._textureLoaded=i)||t.addEventListener("load",function(t){var e=this._preferredSize,i=0!==e.width&&0!==e.height;i&&(e=cc.size(e.width,e.height)),this.updateWithBatchNode(this._scale9Image,t.getRect(),cc._renderType===cc._RENDER_TYPE_WEBGL&&t.isRotated(),this._capInsets),i&&this.setPreferredSize(e),this._positionsAreDirty=!0,this.dispatchEvent("load")},this),this.updateWithBatchNode(e,t.getRect(),cc._renderType===cc._RENDER_TYPE_WEBGL&&t.isRotated(),cc.rect(0,0,0,0)),this._insetBottom=this._insetRight=this._insetTop=this._insetLeft=0},setState:function(t){this._renderCmd.setState(t)},setFlippedX:function(t){var e=this.getScaleX();this._flippedX=t,this.setScaleX(e)},isFlippedX:function(){return this._flippedX},setFlippedY:function(t){var e=this.getScaleY();this._flippedY=t,this.setScaleY(e)},isFlippedY:function(){return this._flippedY},setScaleX:function(t){this._flippedX&&(t*=-1),cc.Node.prototype.setScaleX.call(this,t)},setScaleY:function(t){this._flippedY&&(t*=-1),cc.Node.prototype.setScaleY.call(this,t)},setScale:function(t,e){void 0===e&&(e=t),this.setScaleX(t),this.setScaleY(e)},getScaleX:function(){var t=cc.Node.prototype.getScaleX.call(this);return this._flippedX&&(t*=-1),t},getScaleY:function(){var t=cc.Node.prototype.getScaleY.call(this);return this._flippedY&&(t*=-1),t},getScale:function(){return this.getScaleX()!==this.getScaleY()&&cc.log("Scale9Sprite#scale. ScaleX != ScaleY. Don't know which one to return"),this.getScaleX()},_createRenderCmd:function(){return cc._renderType===cc._RENDER_TYPE_CANVAS?new ccui.Scale9Sprite.CanvasRenderCmd(this):new ccui.Scale9Sprite.WebGLRenderCmd(this)}}),_p=ccui.Scale9Sprite.prototype,cc.EventHelper.prototype.apply(_p),cc.defineGetterSetter(_p,"preferredSize",_p.getPreferredSize,_p.setPreferredSize),cc.defineGetterSetter(_p,"capInsets",_p.getCapInsets,_p.setCapInsets),cc.defineGetterSetter(_p,"insetLeft",_p.getInsetLeft,_p.setInsetLeft),cc.defineGetterSetter(_p,"insetTop",_p.getInsetTop,_p.setInsetTop),cc.defineGetterSetter(_p,"insetRight",_p.getInsetRight,_p.setInsetRight),cc.defineGetterSetter(_p,"insetBottom",_p.getInsetBottom,_p.setInsetBottom),_p=null,ccui.Scale9Sprite.create=function(t,e,i){return new ccui.Scale9Sprite(t,e,i)},ccui.Scale9Sprite.createWithSpriteFrame=function(t,e){return new ccui.Scale9Sprite(t,e)},ccui.Scale9Sprite.createWithSpriteFrameName=function(t,e){return new ccui.Scale9Sprite(t,e)},ccui.Scale9Sprite.POSITIONS_CENTRE=0,ccui.Scale9Sprite.POSITIONS_TOP=1,ccui.Scale9Sprite.POSITIONS_LEFT=2,ccui.Scale9Sprite.POSITIONS_RIGHT=3,ccui.Scale9Sprite.POSITIONS_BOTTOM=4,ccui.Scale9Sprite.POSITIONS_TOPRIGHT=5,ccui.Scale9Sprite.POSITIONS_TOPLEFT=6,ccui.Scale9Sprite.POSITIONS_BOTTOMRIGHT=7,ccui.Scale9Sprite.state={NORMAL:0,GRAY:1},function(){ccui.Scale9Sprite.CanvasRenderCmd=function(t){cc.Node.CanvasRenderCmd.call(this,t),this._cachedParent=null,this._cacheDirty=!1,this._state=ccui.Scale9Sprite.state.NORMAL,t=this._node;var e=this._cacheCanvas=cc.newElement("canvas");e.width=1,e.height=1,this._cacheContext=new cc.CanvasContextWrapper(e.getContext("2d"));var i=this._cacheTexture=new cc.Texture2D;i.initWithElement(e),i.handleLoadedTexture(),this._cacheSprite=new cc.Sprite(i),this._cacheSprite.setAnchorPoint(0,0),t.addChild(this._cacheSprite)};var t=ccui.Scale9Sprite.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);t.constructor=ccui.Scale9Sprite.CanvasRenderCmd,t.visit=function(t){var e=this._node;e._visible&&(e._positionsAreDirty&&(e._updatePositions(),e._positionsAreDirty=!1,e._scale9Dirty=!0),e._scale9Dirty=!1,this._cacheScale9Sprite(),cc.Node.CanvasRenderCmd.prototype.visit.call(this,t))},t.transform=function(t){var e=this._node;for(cc.Node.CanvasRenderCmd.prototype.transform.call(this,t),e._positionsAreDirty&&(e._updatePositions(),e._positionsAreDirty=!1,e._scale9Dirty=!0),this._cacheScale9Sprite(),t=e._children,e=0;e<t.length;e++)t[e].transform(this,!0)
},t._updateDisplayColor=function(t){cc.Node.CanvasRenderCmd.prototype._updateDisplayColor.call(this,t);var e=this._node._scale9Image;if(e){for(var e=e.getChildren(),i=0;i<e.length;i++){var n=e[i];n&&(n._renderCmd._updateDisplayColor(t),n._renderCmd._updateColor())}this._cacheScale9Sprite()}},t._cacheScale9Sprite=function(){var t=this._node;if(t._scale9Image){var e=cc.contentScaleFactor(),i=t._contentSize,n=cc.size(i.width*e,i.height*e),r=this._cacheCanvas,o=this._cacheContext,s=o.getContext(),c=!1;(r.width!==n.width||r.height!==n.height)&&(r.width=n.width,r.height=n.height,c=!0),cc.renderer._turnToCacheMode(t.__instanceId),t._scale9Image.visit(),(r=t._scale9Image.getTexture())&&this._state===ccui.Scale9Sprite.state.GRAY&&r._switchToGray(!0),s.setTransform(1,0,0,1,0,0),s.clearRect(0,0,n.width,n.height),cc.renderer._renderingToCacheCanvas(o,t.__instanceId,e,e),r&&this._state===ccui.Scale9Sprite.state.GRAY&&r._switchToGray(!1),c&&this._cacheSprite.setTextureRect(cc.rect(0,0,i.width,i.height)),this._cacheSprite.getParent()||t.addChild(this._cacheSprite,-1)}},t.setState=function(t){this._node._scale9Image&&(this._state=t,this._cacheScale9Sprite())}}(),function(){if(cc.Node.WebGLRenderCmd){ccui.Scale9Sprite.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t),this._cachedParent=null,this._cacheDirty=!1};var t=ccui.Scale9Sprite.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);t.constructor=ccui.Scale9Sprite.WebGLRenderCmd,t.visit=function(t){var e=this._node;e._visible&&(e._positionsAreDirty&&(e._updatePositions(),e._positionsAreDirty=!1,e._scale9Dirty=!0),cc.Node.WebGLRenderCmd.prototype.visit.call(this,t))},t.transform=function(t,e){var i=this._node;cc.Node.WebGLRenderCmd.prototype.transform.call(this,t,e),i._positionsAreDirty&&(i._updatePositions(),i._positionsAreDirty=!1,i._scale9Dirty=!0)},t._updateDisplayColor=function(t){cc.Node.WebGLRenderCmd.prototype._updateDisplayColor.call(this,t);var e=this._node._scale9Image;if(e)for(var e=e.getChildren(),i=0;i<e.length;i++){var n=e[i];n&&(n._renderCmd._updateDisplayColor(t),n._renderCmd._updateColor())}},t._updateDisplayOpacity=function(t){cc.Node.WebGLRenderCmd.prototype._updateDisplayOpacity.call(this,t);var e=this._node._scale9Image;if(e)for(var e=e.getChildren(),i=0;i<e.length;i++){var n=e[i];n&&(n._renderCmd._updateDisplayOpacity(t),n._renderCmd._updateColor())}},t.setState=function(t){var e=this._node._scale9Image;null!=e&&(t===ccui.Scale9Sprite.state.NORMAL?e.setShaderProgram(cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURECOLOR)):t===ccui.Scale9Sprite.state.GRAY&&e.setShaderProgram(ccui.Scale9Sprite.WebGLRenderCmd._getGrayShaderProgram()))},ccui.Scale9Sprite.WebGLRenderCmd._grayShaderProgram=null,ccui.Scale9Sprite.WebGLRenderCmd._getGrayShaderProgram=function(){var t=ccui.Scale9Sprite.WebGLRenderCmd._grayShaderProgram;return t?t:(t=new cc.GLProgram,t.initWithVertexShaderByteArray(cc.SHADER_POSITION_TEXTURE_COLOR_VERT,ccui.Scale9Sprite.WebGLRenderCmd._grayShaderFragment),t.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),t.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR),t.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS),t.link(),t.updateUniforms(),ccui.Scale9Sprite.WebGLRenderCmd._grayShaderProgram=t)},ccui.Scale9Sprite.WebGLRenderCmd._grayShaderFragment="precision lowp float;\nvarying vec4 v_fragmentColor; \nvarying vec2 v_texCoord; \nvoid main() \n{ \n    vec4 c = texture2D(CC_Texture0, v_texCoord); \n    gl_FragColor.xyz = vec3(0.2126*c.r + 0.7152*c.g + 0.0722*c.b); \n     gl_FragColor.w = c.w ; \n}"}}(),ccui.Layout=ccui.Widget.extend({_clippingEnabled:!1,_backGroundScale9Enabled:null,_backGroundImage:null,_backGroundImageFileName:null,_backGroundImageCapInsets:null,_colorType:null,_bgImageTexType:ccui.Widget.LOCAL_TEXTURE,_colorRender:null,_gradientRender:null,_color:null,_startColor:null,_endColor:null,_alongVector:null,_opacity:255,_backGroundImageTextureSize:null,_layoutType:null,_doLayoutDirty:!0,_clippingRectDirty:!0,_clippingType:null,_clippingStencil:null,_scissorRectDirty:!1,_clippingRect:null,_clippingParent:null,_className:"Layout",_backGroundImageColor:null,_finalPositionX:0,_finalPositionY:0,_backGroundImageOpacity:0,_loopFocus:!1,__passFocusToChild:!0,_isFocusPassing:!1,_isInterceptTouch:!1,ctor:function(){this._layoutType=ccui.Layout.ABSOLUTE,this._widgetType=ccui.Widget.TYPE_CONTAINER,this._clippingType=ccui.Layout.CLIPPING_STENCIL,this._colorType=ccui.Layout.BG_COLOR_NONE,ccui.Widget.prototype.ctor.call(this),this._backGroundImageCapInsets=cc.rect(0,0,0,0),this._color=cc.color(255,255,255,255),this._startColor=cc.color(255,255,255,255),this._endColor=cc.color(255,255,255,255),this._alongVector=cc.p(0,-1),this._backGroundImageTextureSize=cc.size(0,0),this._clippingRect=cc.rect(0,0,0,0),this._backGroundImageColor=cc.color(255,255,255,255)},onEnter:function(){ccui.Widget.prototype.onEnter.call(this),this._clippingStencil&&this._clippingStencil.onEnter(),this._clippingRectDirty=this._doLayoutDirty=!0},onExit:function(){ccui.Widget.prototype.onExit.call(this),this._clippingStencil&&this._clippingStencil.onExit()},setLoopFocus:function(t){this._loopFocus=t},isLoopFocus:function(){return this._loopFocus},setPassFocusToChild:function(t){this.__passFocusToChild=t},isPassFocusToChild:function(){return this.__passFocusToChild},findNextFocusedWidget:function(t,e){if(this._isFocusPassing||this.isFocused()){var i=this.getParent();if(this._isFocusPassing=!1,this.__passFocusToChild){var n=this._passFocusToChild(t,e);return n instanceof ccui.Layout&&i?(i._isFocusPassing=!0,i.findNextFocusedWidget(t,this)):n}return null!=i&&i instanceof ccui.Layout?(i._isFocusPassing=!0,i.findNextFocusedWidget(t,this)):this}if(!(e.isFocused()||e instanceof ccui.Layout))return e;if(this._layoutType===ccui.Layout.LINEAR_HORIZONTAL)switch(t){case ccui.Widget.LEFT:return this._getPreviousFocusedWidget(t,e);case ccui.Widget.RIGHT:return this._getNextFocusedWidget(t,e);case ccui.Widget.DOWN:case ccui.Widget.UP:return this._isLastWidgetInContainer(this,t)?this._isWidgetAncestorSupportLoopFocus(e,t)?ccui.Widget.prototype.findNextFocusedWidget.call(this,t,this):e:ccui.Widget.prototype.findNextFocusedWidget.call(this,t,this);default:return cc.assert(0,"Invalid Focus Direction"),e}else{if(this._layoutType!==ccui.Layout.LINEAR_VERTICAL)return cc.assert(0,"Un Supported Layout type, please use VBox and HBox instead!!!"),e;switch(t){case ccui.Widget.LEFT:case ccui.Widget.RIGHT:return this._isLastWidgetInContainer(this,t)?this._isWidgetAncestorSupportLoopFocus(e,t)?ccui.Widget.prototype.findNextFocusedWidget.call(this,t,this):e:ccui.Widget.prototype.findNextFocusedWidget.call(this,t,this);case ccui.Widget.DOWN:return this._getNextFocusedWidget(t,e);case ccui.Widget.UP:return this._getPreviousFocusedWidget(t,e);default:return cc.assert(0,"Invalid Focus Direction"),e}}},onPassFocusToChild:null,init:function(){return ccui.Widget.prototype.init.call(this)?(this.ignoreContentAdaptWithSize(!1),this.setContentSize(cc.size(0,0)),this.setAnchorPoint(0,0),this.onPassFocusToChild=this._findNearestChildWidgetIndex.bind(this),!0):!1},addChild:function(t,e,i){t instanceof ccui.Widget&&this._supplyTheLayoutParameterLackToChild(t),ccui.Widget.prototype.addChild.call(this,t,e,i),this._doLayoutDirty=!0},removeChild:function(t,e){ccui.Widget.prototype.removeChild.call(this,t,e),this._doLayoutDirty=!0},removeAllChildren:function(t){ccui.Widget.prototype.removeAllChildren.call(this,t),this._doLayoutDirty=!0},removeAllChildrenWithCleanup:function(t){ccui.Widget.prototype.removeAllChildrenWithCleanup.call(this,t),this._doLayoutDirty=!0},isClippingEnabled:function(){return this._clippingEnabled},visit:function(t){if(this._visible)if(this._adaptRenderers(),this._doLayout(),this._clippingEnabled)switch(this._clippingType){case ccui.Layout.CLIPPING_STENCIL:this._renderCmd.stencilClippingVisit(t);break;case ccui.Layout.CLIPPING_SCISSOR:this._renderCmd.scissorClippingVisit(t)}else ccui.Widget.prototype.visit.call(this,t)},setClippingEnabled:function(t){if(t!==this._clippingEnabled)switch(this._clippingEnabled=t,this._clippingType){case ccui.Layout.CLIPPING_STENCIL:t?(this._clippingStencil=new cc.DrawNode,this._renderCmd.rebindStencilRendering(this._clippingStencil),this._running&&this._clippingStencil.onEnter(),this._setStencilClippingSize(this._contentSize)):(this._running&&this._clippingStencil&&this._clippingStencil.onExit(),this._clippingStencil=null)}},setClippingType:function(t){if(t!==this._clippingType)if(cc._renderType===cc._RENDER_TYPE_CANVAS&&t===ccui.Layout.CLIPPING_SCISSOR)cc.log("Only supports STENCIL on canvas mode.");else{var e=this.isClippingEnabled();this.setClippingEnabled(!1),this._clippingType=t,this.setClippingEnabled(e)}},getClippingType:function(){return this._clippingType},_setStencilClippingSize:function(t){if(this._clippingEnabled&&this._clippingType===ccui.Layout.CLIPPING_STENCIL){var e=[];e[0]=cc.p(0,0),e[1]=cc.p(t.width,0),e[2]=cc.p(t.width,t.height),e[3]=cc.p(0,t.height),t=cc.color.GREEN,this._clippingStencil.clear(),this._clippingStencil.drawPoly(e,4,t,0,t)}},_getClippingRect:function(){if(this._clippingRectDirty){for(var t=this.convertToWorldSpace(cc.p(0,0)),e=this.getNodeToWorldTransform(),i=this._contentSize.width*e.a,n=this._contentSize.height*e.d,e=this;e;)if((e=e.getParent())&&e instanceof ccui.Layout&&e.isClippingEnabled()){this._clippingParent=e;break}if(this._clippingParent){var e=this._clippingParent._getClippingRect(),r=t.x-i*this._anchorPoint.x,o=t.y-n*this._anchorPoint.y,s=i,c=n,a=t.x-e.x;0>a&&(r=e.x,s+=a),i=t.x+i-(e.x+e.width),i>0&&(s-=i),i=t.y+n-(e.y+e.height),i>0&&(c-=i),t=t.y-e.y,0>t&&(o=e.x,c+=t),0>s&&(s=0),0>c&&(c=0),this._clippingRect.x=r,this._clippingRect.y=o,this._clippingRect.width=s,this._clippingRect.height=c}else this._clippingRect.x=t.x-i*this._anchorPoint.x,this._clippingRect.y=t.y-n*this._anchorPoint.y,this._clippingRect.width=i,this._clippingRect.height=n;this._clippingRectDirty=!1}return this._clippingRect},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this);var t=this._contentSize;this._setStencilClippingSize(t),this._clippingRectDirty=this._doLayoutDirty=!0,this._backGroundImage&&(this._backGroundImage.setPosition(.5*t.width,.5*t.height),this._backGroundScale9Enabled&&this._backGroundImage instanceof ccui.Scale9Sprite&&this._backGroundImage.setPreferredSize(t)),this._colorRender&&this._colorRender.setContentSize(t),this._gradientRender&&this._gradientRender.setContentSize(t)},setBackGroundImageScale9Enabled:function(t){this._backGroundScale9Enabled!==t&&(this.removeProtectedChild(this._backGroundImage),this._backGroundImage=null,this._backGroundScale9Enabled=t,this._addBackGroundImage(),this.setBackGroundImage(this._backGroundImageFileName,this._bgImageTexType),this.setBackGroundImageCapInsets(this._backGroundImageCapInsets))},isBackGroundImageScale9Enabled:function(){return this._backGroundScale9Enabled},setBackGroundImage:function(t,e){if(t){e=e||ccui.Widget.LOCAL_TEXTURE,null===this._backGroundImage&&(this._addBackGroundImage(),this.setBackGroundImageScale9Enabled(this._backGroundScale9Enabled)),this._backGroundImageFileName=t,this._bgImageTexType=e;var i=this._backGroundImage;switch(this._bgImageTexType){case ccui.Widget.LOCAL_TEXTURE:i.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:i.initWithSpriteFrameName(t)}this._backGroundScale9Enabled&&i.setPreferredSize(this._contentSize),this._backGroundImageTextureSize=i.getContentSize(),i.setPosition(.5*this._contentSize.width,.5*this._contentSize.height),this._updateBackGroundImageColor()}},setBackGroundImageCapInsets:function(t){if(t){var e=this._backGroundImageCapInsets;e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,this._backGroundScale9Enabled&&this._backGroundImage.setCapInsets(t)}},getBackGroundImageCapInsets:function(){return cc.rect(this._backGroundImageCapInsets)},_supplyTheLayoutParameterLackToChild:function(t){if(t)switch(this._layoutType){case ccui.Layout.LINEAR_HORIZONTAL:case ccui.Layout.LINEAR_VERTICAL:var e=t.getLayoutParameter(ccui.LayoutParameter.LINEAR);e||t.setLayoutParameter(new ccui.LinearLayoutParameter);break;case ccui.Layout.RELATIVE:(e=t.getLayoutParameter(ccui.LayoutParameter.RELATIVE))||t.setLayoutParameter(new ccui.RelativeLayoutParameter)}},_addBackGroundImage:function(){var t=this._contentSize;this._backGroundScale9Enabled?(this._backGroundImage=new ccui.Scale9Sprite,this._backGroundImage.setPreferredSize(t)):this._backGroundImage=new cc.Sprite,this.addProtectedChild(this._backGroundImage,ccui.Layout.BACKGROUND_IMAGE_ZORDER,-1),this._backGroundImage.setPosition(.5*t.width,.5*t.height)},removeBackGroundImage:function(){this._backGroundImage&&(this.removeProtectedChild(this._backGroundImage),this._backGroundImage=null,this._backGroundImageFileName="",this._backGroundImageTextureSize.width=0,this._backGroundImageTextureSize.height=0)},setBackGroundColorType:function(t){if(this._colorType!==t){switch(this._colorType){case ccui.Layout.BG_COLOR_NONE:this._colorRender&&(this.removeProtectedChild(this._colorRender),this._colorRender=null),this._gradientRender&&(this.removeProtectedChild(this._gradientRender),this._gradientRender=null);break;case ccui.Layout.BG_COLOR_SOLID:this._colorRender&&(this.removeProtectedChild(this._colorRender),this._colorRender=null);break;case ccui.Layout.BG_COLOR_GRADIENT:this._gradientRender&&(this.removeProtectedChild(this._gradientRender),this._gradientRender=null)}switch(this._colorType=t,this._colorType){case ccui.Layout.BG_COLOR_SOLID:this._colorRender=new cc.LayerColor,this._colorRender.setContentSize(this._contentSize),this._colorRender.setOpacity(this._opacity),this._colorRender.setColor(this._color),this.addProtectedChild(this._colorRender,ccui.Layout.BACKGROUND_RENDERER_ZORDER,-1);break;case ccui.Layout.BG_COLOR_GRADIENT:this._gradientRender=new cc.LayerGradient(cc.color(255,0,0,255),cc.color(0,255,0,255)),this._gradientRender.setContentSize(this._contentSize),this._gradientRender.setOpacity(this._opacity),this._gradientRender.setStartColor(this._startColor),this._gradientRender.setEndColor(this._endColor),this._gradientRender.setVector(this._alongVector),this.addProtectedChild(this._gradientRender,ccui.Layout.BACKGROUND_RENDERER_ZORDER,-1)}}},getBackGroundColorType:function(){return this._colorType},setBackGroundColor:function(t,e){e?(this._startColor.r=t.r,this._startColor.g=t.g,this._startColor.b=t.b,this._gradientRender&&this._gradientRender.setStartColor(t),this._endColor.r=e.r,this._endColor.g=e.g,this._endColor.b=e.b,this._gradientRender&&this._gradientRender.setEndColor(e)):(this._color.r=t.r,this._color.g=t.g,this._color.b=t.b,this._colorRender&&this._colorRender.setColor(t))},getBackGroundColor:function(){var t=this._color;return cc.color(t.r,t.g,t.b,t.a)},getBackGroundStartColor:function(){var t=this._startColor;return cc.color(t.r,t.g,t.b,t.a)},getBackGroundEndColor:function(){var t=this._endColor;return cc.color(t.r,t.g,t.b,t.a)},setBackGroundColorOpacity:function(t){switch(this._opacity=t,this._colorType){case ccui.Layout.BG_COLOR_SOLID:this._colorRender.setOpacity(t);break;case ccui.Layout.BG_COLOR_GRADIENT:this._gradientRender.setOpacity(t)}},getBackGroundColorOpacity:function(){return this._opacity},setBackGroundColorVector:function(t){this._alongVector.x=t.x,this._alongVector.y=t.y,this._gradientRender&&this._gradientRender.setVector(t)},getBackGroundColorVector:function(){return this._alongVector},setBackGroundImageColor:function(t){this._backGroundImageColor.r=t.r,this._backGroundImageColor.g=t.g,this._backGroundImageColor.b=t.b,this._updateBackGroundImageColor()},setBackGroundImageOpacity:function(t){this._backGroundImageColor.a=t,this.getBackGroundImageColor()},getBackGroundImageColor:function(){var t=this._backGroundImageColor;return cc.color(t.r,t.g,t.b,t.a)},getBackGroundImageOpacity:function(){return this._backGroundImageColor.a},_updateBackGroundImageColor:function(){this._backGroundImage&&this._backGroundImage.setColor(this._backGroundImageColor)},getBackGroundImageTextureSize:function(){return this._backGroundImageTextureSize},setLayoutType:function(t){this._layoutType=t,t=this._children;for(var e=null,i=0;i<t.length;i++)e=t[i],e instanceof ccui.Widget&&this._supplyTheLayoutParameterLackToChild(e);this._doLayoutDirty=!0},getLayoutType:function(){return this._layoutType},requestDoLayout:function(){this._doLayoutDirty=!0},_doLayout:function(){if(this._doLayoutDirty){this.sortAllChildren();var t=ccui.getLayoutManager(this._layoutType);t&&t._doLayout(this),this._doLayoutDirty=!1}},_getLayoutContentSize:function(){return this.getContentSize()},_getLayoutElements:function(){return this.getChildren()},_updateBackGroundImageOpacity:function(){this._backGroundImage&&this._backGroundImage.setOpacity(this._backGroundImageOpacity)},_updateBackGroundImageRGBA:function(){this._backGroundImage&&(this._backGroundImage.setColor(this._backGroundImageColor),this._backGroundImage.setOpacity(this._backGroundImageOpacity))},_getLayoutAccumulatedSize:function(){for(var t,e=this.getChildren(),i=cc.size(0,0),n=0,r=0,o=e.length;o>r;r++)if(t=e[r],null!==t&&t instanceof ccui.Layout)t=t._getLayoutAccumulatedSize(),i.width+=t.width,i.height+=t.height;else if(t instanceof ccui.Widget){n++;var s=t.getLayoutParameter().getMargin();t=t.getContentSize(),i.width+=t.width+.5*(s.right+s.left),i.height+=t.height+.5*(s.top+s.bottom)}return e=this.getLayoutType(),e===ccui.Layout.LINEAR_HORIZONTAL&&(i.height-=i.height/n*(n-1)),e===ccui.Layout.LINEAR_VERTICAL&&(i.width-=i.width/n*(n-1)),i},_findNearestChildWidgetIndex:function(t,e){if(null==e||e===this)return this._findFirstFocusEnabledWidgetIndex();var i,n=0,r=this.getChildren(),o=r.length,s=cc.FLT_MAX,c=0;if(t===ccui.Widget.LEFT||t===ccui.Widget.RIGHT||t===ccui.Widget.DOWN||t===ccui.Widget.UP){for(i=this._getWorldCenterPoint(e);o>n;){var a=r[n];a&&a instanceof ccui.Widget&&a.isFocusEnabled()&&(a=a instanceof ccui.Layout?a._calculateNearestDistance(e):cc.pLength(cc.pSub(this._getWorldCenterPoint(a),i)),s>a&&(c=n,s=a)),n++}return c}return cc.log("invalid focus direction!"),0},_findFarthestChildWidgetIndex:function(t,e){if(null==e||e===this)return this._findFirstFocusEnabledWidgetIndex();var i=0,n=this.getChildren(),r=n.length,o=-cc.FLT_MAX,s=0;if(t===ccui.Widget.LEFT||t===ccui.Widget.RIGHT||t===ccui.Widget.DOWN||t===ccui.Widget.UP){for(var c=this._getWorldCenterPoint(e);r>i;){var a=n[i];a&&a instanceof ccui.Widget&&a.isFocusEnabled()&&(a=a instanceof ccui.Layout?a._calculateFarthestDistance(e):cc.pLength(cc.pSub(this._getWorldCenterPoint(a),c)),a>o&&(s=i,o=a)),i++}return s}return cc.log("invalid focus direction!!!"),0},_calculateNearestDistance:function(t){for(var e=cc.FLT_MAX,i=this._getWorldCenterPoint(t),n=this._children,r=0,o=n.length;o>r;r++){var s=n[r];if(s instanceof ccui.Layout)s=s._calculateNearestDistance(t);else{if(!(s instanceof ccui.Widget&&s.isFocusEnabled()))continue;s=cc.pLength(cc.pSub(this._getWorldCenterPoint(s),i))}e>s&&(e=s)}return e},_calculateFarthestDistance:function(t){for(var e=-cc.FLT_MAX,i=this._getWorldCenterPoint(t),n=this._children,r=0,o=n.length;o>r;r++){var s=n[r];if(s instanceof ccui.Layout)s=s._calculateFarthestDistance(t);else{if(!(s instanceof ccui.Widget&&s.isFocusEnabled()))continue;s=this._getWorldCenterPoint(s),s=cc.pLength(cc.pSub(s,i))}s>e&&(e=s)}return e},_findProperSearchingFunctor:function(t,e){if(null!=e){var i=this._getWorldCenterPoint(e),n=this._getWorldCenterPoint(this._findFirstNonLayoutWidget());t===ccui.Widget.LEFT?this.onPassFocusToChild=i.x>n.x?this._findNearestChildWidgetIndex.bind(this):this._findFarthestChildWidgetIndex.bind(this):t===ccui.Widget.RIGHT?this.onPassFocusToChild=i.x>n.x?this._findFarthestChildWidgetIndex.bind(this):this._findNearestChildWidgetIndex.bind(this):t===ccui.Widget.DOWN?this.onPassFocusToChild=i.y>n.y?this._findNearestChildWidgetIndex.bind(this):this._findFarthestChildWidgetIndex.bind(this):t===ccui.Widget.UP?this.onPassFocusToChild=i.y<n.y?this._findNearestChildWidgetIndex.bind(this):this._findFarthestChildWidgetIndex.bind(this):cc.log("invalid direction!")}},_findFirstNonLayoutWidget:function(){for(var t=this._children,e=0,i=t.length;i>e;e++){var n=t[e];if(n instanceof ccui.Layout){if(n=n._findFirstNonLayoutWidget())return n}else if(n instanceof ccui.Widget)return n}return null},_findFirstFocusEnabledWidgetIndex:function(){for(var t=0,e=this.getChildren(),i=e.length;i>t;){var n=e[t];if(n&&n instanceof ccui.Widget&&n.isFocusEnabled())return t;t++}return 0},_findFocusEnabledChildWidgetByIndex:function(t){var e=this._getChildWidgetByIndex(t);return e?e.isFocusEnabled()?e:this._findFocusEnabledChildWidgetByIndex(t+1):null},_getWorldCenterPoint:function(t){var e=t instanceof ccui.Layout?t._getLayoutAccumulatedSize():t.getContentSize();return t.convertToWorldSpace(cc.p(e.width/2,e.height/2))},_getNextFocusedWidget:function(t,e){var i=null,i=this._children,n=i.indexOf(e),n=n+1;return n<i.length?(i=this._getChildWidgetByIndex(n))?i.isFocusEnabled()?i instanceof ccui.Layout?(i._isFocusPassing=!0,i.findNextFocusedWidget(t,i)):(this.dispatchFocusEvent(e,i),i):this._getNextFocusedWidget(t,i):e:this._loopFocus?this._checkFocusEnabledChild()?(i=this._getChildWidgetByIndex(0),i.isFocusEnabled()?i instanceof ccui.Layout?(i._isFocusPassing=!0,i.findNextFocusedWidget(t,i)):(this.dispatchFocusEvent(e,i),i):this._getNextFocusedWidget(t,i)):e instanceof ccui.Layout?e:ccui.Widget._focusedWidget:this._isLastWidgetInContainer(e,t)?this._isWidgetAncestorSupportLoopFocus(this,t)?ccui.Widget.prototype.findNextFocusedWidget.call(this,t,this):e instanceof ccui.Layout?e:ccui.Widget._focusedWidget:ccui.Widget.prototype.findNextFocusedWidget.call(this,t,this)},_getPreviousFocusedWidget:function(t,e){var i=null,i=this._children,n=i.indexOf(e),n=n-1;return n>=0?(i=this._getChildWidgetByIndex(n),i.isFocusEnabled()?i instanceof ccui.Layout?(i._isFocusPassing=!0,i.findNextFocusedWidget(t,i)):(this.dispatchFocusEvent(e,i),i):this._getPreviousFocusedWidget(t,i)):this._loopFocus?this._checkFocusEnabledChild()?(n=i.length-1,i=this._getChildWidgetByIndex(n),i.isFocusEnabled()?i instanceof ccui.Layout?(i._isFocusPassing=!0,i.findNextFocusedWidget(t,i)):(this.dispatchFocusEvent(e,i),i):this._getPreviousFocusedWidget(t,i)):e instanceof ccui.Layout?e:ccui.Widget._focusedWidget:this._isLastWidgetInContainer(e,t)?this._isWidgetAncestorSupportLoopFocus(this,t)?ccui.Widget.prototype.findNextFocusedWidget.call(this,t,this):e instanceof ccui.Layout?e:ccui.Widget._focusedWidget:ccui.Widget.prototype.findNextFocusedWidget.call(this,t,this)},_getChildWidgetByIndex:function(t){for(var e=this._children,i=e.length,n=0,r=t;i>t;){var o=e[t];if(o&&o instanceof ccui.Widget)return o;n++,t++}for(t=0;r>t;){if((i=e[t])&&i instanceof ccui.Widget)return i;n++,t++}return null},_isLastWidgetInContainer:function(t,e){var i=t.getParent();if(null==i||!(i instanceof ccui.Layout))return!0;var n=i.getChildren(),r=n.indexOf(t);if(i.getLayoutType()===ccui.Layout.LINEAR_HORIZONTAL){if(e===ccui.Widget.LEFT)return 0===r?this._isLastWidgetInContainer(i,e):!1;if(e===ccui.Widget.RIGHT)return r===n.length-1?this._isLastWidgetInContainer(i,e):!1;if(e===ccui.Widget.DOWN||e===ccui.Widget.UP)return this._isLastWidgetInContainer(i,e)}else{if(i.getLayoutType()!==ccui.Layout.LINEAR_VERTICAL)return cc.log("invalid layout Type"),!1;if(e===ccui.Widget.UP)return 0===r?this._isLastWidgetInContainer(i,e):!1;if(e===ccui.Widget.DOWN)return r===n.length-1?this._isLastWidgetInContainer(i,e):!1;if(e===ccui.Widget.LEFT||e===ccui.Widget.RIGHT)return this._isLastWidgetInContainer(i,e)}},_isWidgetAncestorSupportLoopFocus:function(t,e){var i=t.getParent();if(null==i||!(i instanceof ccui.Layout))return!1;if(i.isLoopFocus()){var n=i.getLayoutType();return n===ccui.Layout.LINEAR_HORIZONTAL?e===ccui.Widget.LEFT||e===ccui.Widget.RIGHT?!0:this._isWidgetAncestorSupportLoopFocus(i,e):n===ccui.Layout.LINEAR_VERTICAL?e===ccui.Widget.DOWN||e===ccui.Widget.UP?!0:this._isWidgetAncestorSupportLoopFocus(i,e):(cc.assert(0,"invalid layout type"),!1)}return this._isWidgetAncestorSupportLoopFocus(i,e)},_passFocusToChild:function(t,e){if(this._checkFocusEnabledChild()){var i=ccui.Widget.getCurrentFocusedWidget();return this._findProperSearchingFunctor(t,i),i=this.onPassFocusToChild(t,i),i=this._getChildWidgetByIndex(i),i instanceof ccui.Layout?(i._isFocusPassing=!0,i.findNextFocusedWidget(t,i)):(this.dispatchFocusEvent(e,i),i)}return this},_checkFocusEnabledChild:function(){for(var t=this._children,e=0,i=t.length;i>e;e++){var n=t[e];if(n&&n instanceof ccui.Widget&&n.isFocusEnabled())return!0}return!1},getDescription:function(){return"Layout"},_createCloneInstance:function(){return new ccui.Layout},_copyClonedWidgetChildren:function(t){ccui.Widget.prototype._copyClonedWidgetChildren.call(this,t)},_copySpecialProperties:function(t){t instanceof ccui.Layout&&(this.setBackGroundImageScale9Enabled(t._backGroundScale9Enabled),this.setBackGroundImage(t._backGroundImageFileName,t._bgImageTexType),this.setBackGroundImageCapInsets(t._backGroundImageCapInsets),this.setBackGroundColorType(t._colorType),this.setBackGroundColor(t._color),this.setBackGroundColor(t._startColor,t._endColor),this.setBackGroundColorOpacity(t._opacity),this.setBackGroundColorVector(t._alongVector),this.setLayoutType(t._layoutType),this.setClippingEnabled(t._clippingEnabled),this.setClippingType(t._clippingType),this._loopFocus=t._loopFocus,this.__passFocusToChild=t.__passFocusToChild,this._isInterceptTouch=t._isInterceptTouch)},forceDoLayout:function(){this.requestDoLayout(),this._doLayout()},_createRenderCmd:function(){return cc._renderType===cc._RENDER_TYPE_WEBGL?new ccui.Layout.WebGLRenderCmd(this):new ccui.Layout.CanvasRenderCmd(this)}}),_p=ccui.Layout.prototype,cc.defineGetterSetter(_p,"clippingEnabled",_p.isClippingEnabled,_p.setClippingEnabled),cc.defineGetterSetter(_p,"clippingType",null,_p.setClippingType),cc.defineGetterSetter(_p,"layoutType",_p.getLayoutType,_p.setLayoutType),_p=null,ccui.Layout.create=function(){return new ccui.Layout},ccui.Layout.BG_COLOR_NONE=0,ccui.Layout.BG_COLOR_SOLID=1,ccui.Layout.BG_COLOR_GRADIENT=2,ccui.Layout.ABSOLUTE=0,ccui.Layout.LINEAR_VERTICAL=1,ccui.Layout.LINEAR_HORIZONTAL=2,ccui.Layout.RELATIVE=3,ccui.Layout.CLIPPING_STENCIL=0,ccui.Layout.CLIPPING_SCISSOR=1,ccui.Layout.BACKGROUND_IMAGE_ZORDER=-1,ccui.Layout.BACKGROUND_RENDERER_ZORDER=-2,function(){ccui.Layout.CanvasRenderCmd=function(t){ccui.ProtectedNode.CanvasRenderCmd.call(this,t),this._clipElemType=this._needDraw=!1,this._locCache=null,this._rendererSaveCmd=new cc.CustomRenderCmd(this,this._onRenderSaveCmd),this._rendererSaveCmdSprite=new cc.CustomRenderCmd(this,this._onRenderSaveSpriteCmd),this._rendererClipCmd=new cc.CustomRenderCmd(this,this._onRenderClipCmd),this._rendererRestoreCmd=new cc.CustomRenderCmd(this,this._onRenderRestoreCmd)};var t=ccui.Layout.CanvasRenderCmd.prototype=Object.create(ccui.ProtectedNode.CanvasRenderCmd.prototype);t.constructor=ccui.Layout.CanvasRenderCmd,t.visit=function(t){var e=this._node;if(e._visible)if(e._adaptRenderers(),e._doLayout(),e._clippingEnabled)switch(e._clippingType){case ccui.Layout.CLIPPING_STENCIL:this.stencilClippingVisit(t);break;case ccui.Layout.CLIPPING_SCISSOR:this.scissorClippingVisit(t)}else ccui.Widget.CanvasRenderCmd.prototype.visit.call(this,t)},t._onRenderSaveCmd=function(t,e,i){t=t||cc._renderContext;var n=t.getContext();this._clipElemType?(e=n.canvas,this._locCache=ccui.Layout.CanvasRenderCmd._getSharedCache(),this._locCache.width=e.width,this._locCache.height=e.height,this._locCache.getContext("2d").drawImage(e,0,0)):(t.save(),t.save(),t.setTransform(this._worldTransform,e,i))},t._onRenderSaveSpriteCmd=function(t){t=t||cc._renderContext,this._clipElemType&&t.setCompositeOperation("destination-in")},t._onRenderClipCmd=function(t){t=t||cc._renderContext;var e=t.getContext();this._clipElemType||(t.restore(),e.clip())},t._onRenderRestoreCmd=function(t){t=t||cc._renderContext;var e=t.getContext();this._clipElemType?(e.save(),e.setTransform(1,0,0,1,0,0),e.globalCompositeOperation="destination-over",e.drawImage(this._locCache,0,0),e.restore()):t.restore()},t.rebindStencilRendering=function(t){t._renderCmd.rendering=this.__stencilDraw},t.__stencilDraw=function(t,e,i){t=(t||cc._renderContext).getContext();for(var n=this._buffer,r=0,o=n.length;o>r;r++){var s=n[r].verts,c=s[0];t.beginPath(),t.moveTo(c.x*e,-c.y*i);for(var c=1,a=s.length;a>c;c++)t.lineTo(s[c].x*e,-s[c].y*i);t.closePath()}},t.stencilClippingVisit=t.scissorClippingVisit=function(t){var e=this._node;if(e._clippingStencil&&e._clippingStencil.isVisible()){if(this._clipElemType=e._stencil instanceof cc.Sprite,this._syncStatus(t),cc.renderer.pushRenderCommand(this._rendererSaveCmd),this._clipElemType&&(cc.ProtectedNode.prototype.visit.call(e,t),cc.renderer.pushRenderCommand(this._rendererSaveCmdSprite)),e._clippingStencil.visit(this),cc.renderer.pushRenderCommand(this._rendererClipCmd),!this._clipElemType){e.sortAllChildren(),e.sortAllProtectedChildren(),t=e._children;for(var i,n=0,e=e._protectedChildren,r=0,o=t.length,s=e.length;o>r&&((i=t[r])&&0>i.getLocalZOrder());r++)i.visit(this);for(;s>n&&((i=e[n])&&0>i.getLocalZOrder());n++)i.visit(this);for(;o>r;r++)t[r].visit(this);for(;s>n;n++)e[n].visit(this);cc.renderer.pushRenderCommand(this._rendererRestoreCmd)}this._dirtyFlag=0}},ccui.Layout.CanvasRenderCmd._getSharedCache=function(){return cc.ClippingNode._sharedCache||(cc.ClippingNode._sharedCache=cc.newElement("canvas"))}}(),function(){if(ccui.ProtectedNode.WebGLRenderCmd){ccui.Layout.WebGLRenderCmd=function(t){ccui.ProtectedNode.WebGLRenderCmd.call(this,t),this._needDraw=!1,this._currentStencilPassDepthPass=this._currentStencilPassDepthFail=this._currentStencilFail=this._currentStencilValueMask=this._currentStencilRef=this._currentStencilFunc=this._currentStencilWriteMask=this._currentStencilEnabled=0,this._currentDepthWriteMask=!1,this._mask_layer_le=0,this._beforeVisitCmdStencil=new cc.CustomRenderCmd(this,this._onBeforeVisitStencil),this._afterDrawStencilCmd=new cc.CustomRenderCmd(this,this._onAfterDrawStencil),this._afterVisitCmdStencil=new cc.CustomRenderCmd(this,this._onAfterVisitStencil),this._beforeVisitCmdScissor=new cc.CustomRenderCmd(this,this._onBeforeVisitScissor),this._afterVisitCmdScissor=new cc.CustomRenderCmd(this,this._onAfterVisitScissor)};var t=ccui.Layout.WebGLRenderCmd.prototype=Object.create(ccui.ProtectedNode.WebGLRenderCmd.prototype);t.constructor=ccui.Layout.WebGLRenderCmd,t.visit=function(t){var e=this._node;if(e._visible)if(e._adaptRenderers(),e._doLayout(),e._clippingEnabled)switch(e._clippingType){case ccui.Layout.CLIPPING_STENCIL:this.stencilClippingVisit(t);break;case ccui.Layout.CLIPPING_SCISSOR:this.scissorClippingVisit(t)}else ccui.Widget.WebGLRenderCmd.prototype.visit.call(this,t)},t._onBeforeVisitStencil=function(t){t=t||cc._renderContext,ccui.Layout.WebGLRenderCmd._layer++;var e=1<<ccui.Layout.WebGLRenderCmd._layer;this._mask_layer_le=e|e-1,this._currentStencilEnabled=t.isEnabled(t.STENCIL_TEST),this._currentStencilWriteMask=t.getParameter(t.STENCIL_WRITEMASK),this._currentStencilFunc=t.getParameter(t.STENCIL_FUNC),this._currentStencilRef=t.getParameter(t.STENCIL_REF),this._currentStencilValueMask=t.getParameter(t.STENCIL_VALUE_MASK),this._currentStencilFail=t.getParameter(t.STENCIL_FAIL),this._currentStencilPassDepthFail=t.getParameter(t.STENCIL_PASS_DEPTH_FAIL),this._currentStencilPassDepthPass=t.getParameter(t.STENCIL_PASS_DEPTH_PASS),t.enable(t.STENCIL_TEST),t.stencilMask(e),this._currentDepthWriteMask=t.getParameter(t.DEPTH_WRITEMASK),t.depthMask(!1),t.stencilFunc(t.NEVER,e,e),t.stencilOp(t.ZERO,t.KEEP,t.KEEP),this._drawFullScreenQuadClearStencil(),t.stencilFunc(t.NEVER,e,e),t.stencilOp(t.REPLACE,t.KEEP,t.KEEP)},t._onAfterDrawStencil=function(t){t=t||cc._renderContext,t.depthMask(this._currentDepthWriteMask),t.stencilFunc(t.EQUAL,this._mask_layer_le,this._mask_layer_le),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)
},t._onAfterVisitStencil=function(t){t=t||cc._renderContext,t.stencilFunc(this._currentStencilFunc,this._currentStencilRef,this._currentStencilValueMask),t.stencilOp(this._currentStencilFail,this._currentStencilPassDepthFail,this._currentStencilPassDepthPass),t.stencilMask(this._currentStencilWriteMask),this._currentStencilEnabled||t.disable(t.STENCIL_TEST),ccui.Layout.WebGLRenderCmd._layer--},t._onBeforeVisitScissor=function(t){var e=this._getClippingRect();t=t||cc._renderContext,t.enable(t.SCISSOR_TEST),cc.view.setScissorInPoints(e.x,e.y,e.width,e.height)},t._onAfterVisitScissor=function(t){t=t||cc._renderContext,t.disable(t.SCISSOR_TEST)},t._drawFullScreenQuadClearStencil=function(){cc.kmGLMatrixMode(cc.KM_GL_PROJECTION),cc.kmGLPushMatrix(),cc.kmGLLoadIdentity(),cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW),cc.kmGLPushMatrix(),cc.kmGLLoadIdentity(),cc._drawingUtil.drawSolidRect(cc.p(-1,-1),cc.p(1,1),cc.color(255,255,255,255)),cc.kmGLMatrixMode(cc.KM_GL_PROJECTION),cc.kmGLPopMatrix(),cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW),cc.kmGLPopMatrix()},t.rebindStencilRendering=function(){},t.transform=function(t,e){var i=this._node;ccui.ProtectedNode.WebGLRenderCmd.prototype.transform.call(this,t,e),i._clippingStencil&&i._clippingStencil._renderCmd.transform(this,e)},t.stencilClippingVisit=function(t){var e=this._node;if(e._clippingStencil&&e._clippingStencil.isVisible())if(ccui.Layout.WebGLRenderCmd._layer+1===cc.stencilBits)ccui.Layout.WebGLRenderCmd._visit_once=!0,ccui.Layout.WebGLRenderCmd._visit_once&&(cc.log("Nesting more than "+cc.stencilBits+"stencils is not supported. Everything will be drawn without stencil for this node and its childs."),ccui.Layout.WebGLRenderCmd._visit_once=!1),cc.Node.prototype.visit.call(e,t);else{cc.renderer.pushRenderCommand(this._beforeVisitCmdStencil);var i=cc.current_stack;i.stack.push(i.top),this._syncStatus(t),this._dirtyFlag=0,i.top=this._stackMatrix,e._clippingStencil.visit(this),cc.renderer.pushRenderCommand(this._afterDrawStencilCmd);var n=t=0;e.sortAllChildren(),e.sortAllProtectedChildren();for(var r,o=e._children,e=e._protectedChildren,s=o.length,c=e.length;s>t&&((r=o[t])&&0>r.getLocalZOrder());t++)r.visit(this);for(;c>n&&((r=e[n])&&0>r.getLocalZOrder());n++)r.visit(this);for(;s>t;t++)o[t].visit(this);for(;c>n;n++)e[n].visit(this);cc.renderer.pushRenderCommand(this._afterVisitCmdStencil),i.top=i.stack.pop()}},t.scissorClippingVisit=function(t){cc.renderer.pushRenderCommand(this._beforeVisitCmdScissor),cc.ProtectedNode.prototype.visit.call(this._node,t),cc.renderer.pushRenderCommand(this._afterVisitCmdScissor)},ccui.Layout.WebGLRenderCmd._layer=-1,ccui.Layout.WebGLRenderCmd._visit_once=null}}(),ccui.Margin=ccui.Class.extend({left:0,top:0,right:0,bottom:0,ctor:function(t,e,i,n){void 0!==t&&void 0===e&&(this.left=t.left,this.top=t.top,this.right=t.right,this.bottom=t.bottom),void 0!==n&&(this.left=t,this.top=e,this.right=i,this.bottom=n)},setMargin:function(t,e,i,n){this.left=t,this.top=e,this.right=i,this.bottom=n},equals:function(t){return this.left===t.left&&this.top===t.top&&this.right===t.right&&this.bottom===t.bottom}}),ccui.MarginZero=function(){return new ccui.Margin(0,0,0,0)},ccui.LayoutParameter=ccui.Class.extend({_margin:null,_layoutParameterType:null,ctor:function(){this._margin=new ccui.Margin,this._layoutParameterType=ccui.LayoutParameter.NONE},setMargin:function(t,e,i,n){cc.isObject(t)?(this._margin.left=t.left,this._margin.top=t.top,this._margin.right=t.right,this._margin.bottom=t.bottom):(this._margin.left=t,this._margin.top=e,this._margin.right=i,this._margin.bottom=n)},getMargin:function(){return this._margin},getLayoutType:function(){return this._layoutParameterType},clone:function(){var t=this._createCloneInstance();return t._copyProperties(this),t},_createCloneInstance:function(){return new ccui.LayoutParameter},_copyProperties:function(t){this._margin.bottom=t._margin.bottom,this._margin.left=t._margin.left,this._margin.right=t._margin.right,this._margin.top=t._margin.top}}),ccui.LayoutParameter.create=function(){return new ccui.LayoutParameter},ccui.LayoutParameter.NONE=0,ccui.LayoutParameter.LINEAR=1,ccui.LayoutParameter.RELATIVE=2,ccui.LinearLayoutParameter=ccui.LayoutParameter.extend({_linearGravity:null,ctor:function(){ccui.LayoutParameter.prototype.ctor.call(this),this._linearGravity=ccui.LinearLayoutParameter.NONE,this._layoutParameterType=ccui.LayoutParameter.LINEAR},setGravity:function(t){this._linearGravity=t},getGravity:function(){return this._linearGravity},_createCloneInstance:function(){return new ccui.LinearLayoutParameter},_copyProperties:function(t){ccui.LayoutParameter.prototype._copyProperties.call(this,t),t instanceof ccui.LinearLayoutParameter&&this.setGravity(t._linearGravity)}}),ccui.LinearLayoutParameter.create=function(){return new ccui.LinearLayoutParameter},ccui.LinearLayoutParameter.NONE=0,ccui.LinearLayoutParameter.LEFT=1,ccui.LinearLayoutParameter.TOP=2,ccui.LinearLayoutParameter.RIGHT=3,ccui.LinearLayoutParameter.BOTTOM=4,ccui.LinearLayoutParameter.CENTER_VERTICAL=5,ccui.LinearLayoutParameter.CENTER_HORIZONTAL=6,ccui.RelativeLayoutParameter=ccui.LayoutParameter.extend({_relativeAlign:null,_relativeWidgetName:"",_relativeLayoutName:"",_put:!1,ctor:function(){ccui.LayoutParameter.prototype.ctor.call(this),this._relativeAlign=ccui.RelativeLayoutParameter.NONE,this._relativeLayoutName=this._relativeWidgetName="",this._put=!1,this._layoutParameterType=ccui.LayoutParameter.RELATIVE},setAlign:function(t){this._relativeAlign=t},getAlign:function(){return this._relativeAlign},setRelativeToWidgetName:function(t){this._relativeWidgetName=t},getRelativeToWidgetName:function(){return this._relativeWidgetName},setRelativeName:function(t){this._relativeLayoutName=t},getRelativeName:function(){return this._relativeLayoutName},_createCloneInstance:function(){return new ccui.RelativeLayoutParameter},_copyProperties:function(t){ccui.LayoutParameter.prototype._copyProperties.call(this,t),t instanceof ccui.RelativeLayoutParameter&&(this.setAlign(t._relativeAlign),this.setRelativeToWidgetName(t._relativeWidgetName),this.setRelativeName(t._relativeLayoutName))}}),ccui.RelativeLayoutParameter.create=function(){return new ccui.RelativeLayoutParameter},ccui.RelativeLayoutParameter.NONE=0,ccui.RelativeLayoutParameter.PARENT_TOP_LEFT=1,ccui.RelativeLayoutParameter.PARENT_TOP_CENTER_HORIZONTAL=2,ccui.RelativeLayoutParameter.PARENT_TOP_RIGHT=3,ccui.RelativeLayoutParameter.PARENT_LEFT_CENTER_VERTICAL=4,ccui.RelativeLayoutParameter.CENTER_IN_PARENT=5,ccui.RelativeLayoutParameter.PARENT_RIGHT_CENTER_VERTICAL=6,ccui.RelativeLayoutParameter.PARENT_LEFT_BOTTOM=7,ccui.RelativeLayoutParameter.PARENT_BOTTOM_CENTER_HORIZONTAL=8,ccui.RelativeLayoutParameter.PARENT_RIGHT_BOTTOM=9,ccui.RelativeLayoutParameter.LOCATION_ABOVE_LEFTALIGN=10,ccui.RelativeLayoutParameter.LOCATION_ABOVE_CENTER=11,ccui.RelativeLayoutParameter.LOCATION_ABOVE_RIGHTALIGN=12,ccui.RelativeLayoutParameter.LOCATION_LEFT_OF_TOPALIGN=13,ccui.RelativeLayoutParameter.LOCATION_LEFT_OF_CENTER=14,ccui.RelativeLayoutParameter.LOCATION_LEFT_OF_BOTTOMALIGN=15,ccui.RelativeLayoutParameter.LOCATION_RIGHT_OF_TOPALIGN=16,ccui.RelativeLayoutParameter.LOCATION_RIGHT_OF_CENTER=17,ccui.RelativeLayoutParameter.LOCATION_RIGHT_OF_BOTTOMALIGN=18,ccui.RelativeLayoutParameter.LOCATION_BELOW_LEFTALIGN=19,ccui.RelativeLayoutParameter.LOCATION_BELOW_CENTER=20,ccui.RelativeLayoutParameter.LOCATION_BELOW_RIGHTALIGN=21,ccui.LINEAR_GRAVITY_NONE=0,ccui.LINEAR_GRAVITY_LEFT=1,ccui.LINEAR_GRAVITY_TOP=2,ccui.LINEAR_GRAVITY_RIGHT=3,ccui.LINEAR_GRAVITY_BOTTOM=4,ccui.LINEAR_GRAVITY_CENTER_VERTICAL=5,ccui.LINEAR_GRAVITY_CENTER_HORIZONTAL=6,ccui.RELATIVE_ALIGN_NONE=0,ccui.RELATIVE_ALIGN_PARENT_TOP_LEFT=1,ccui.RELATIVE_ALIGN_PARENT_TOP_CENTER_HORIZONTAL=2,ccui.RELATIVE_ALIGN_PARENT_TOP_RIGHT=3,ccui.RELATIVE_ALIGN_PARENT_LEFT_CENTER_VERTICAL=4,ccui.RELATIVE_ALIGN_PARENT_CENTER=5,ccui.RELATIVE_ALIGN_PARENT_RIGHT_CENTER_VERTICAL=6,ccui.RELATIVE_ALIGN_PARENT_LEFT_BOTTOM=7,ccui.RELATIVE_ALIGN_PARENT_BOTTOM_CENTER_HORIZONTAL=8,ccui.RELATIVE_ALIGN_PARENT_RIGHT_BOTTOM=9,ccui.RELATIVE_ALIGN_LOCATION_ABOVE_LEFT=10,ccui.RELATIVE_ALIGN_LOCATION_ABOVE_CENTER=11,ccui.RELATIVE_ALIGN_LOCATION_ABOVE_RIGHT=12,ccui.RELATIVE_ALIGN_LOCATION_LEFT_TOP=13,ccui.RELATIVE_ALIGN_LOCATION_LEFT_CENTER=14,ccui.RELATIVE_ALIGN_LOCATION_LEFT_BOTTOM=15,ccui.RELATIVE_ALIGN_LOCATION_RIGHT_TOP=16,ccui.RELATIVE_ALIGN_LOCATION_RIGHT_CENTER=17,ccui.RELATIVE_ALIGN_LOCATION_RIGHT_BOTTOM=18,ccui.RELATIVE_ALIGN_LOCATION_BELOW_TOP=19,ccui.RELATIVE_ALIGN_LOCATION_BELOW_CENTER=20,ccui.RELATIVE_ALIGN_LOCATION_BELOW_BOTTOM=21,ccui.getLayoutManager=function(t){switch(t){case ccui.Layout.LINEAR_VERTICAL:return ccui.linearVerticalLayoutManager;case ccui.Layout.LINEAR_HORIZONTAL:return ccui.linearHorizontalLayoutManager;case ccui.Layout.RELATIVE:return ccui.relativeLayoutManager}return null},ccui.linearVerticalLayoutManager={_doLayout:function(t){var e=t._getLayoutContentSize();t=t._getLayoutElements();for(var i=e.height,n=0,r=t.length;r>n;n++){var o=t[n];if(o){var s=o.getLayoutParameter();if(s){var c=s.getGravity(),a=o.getAnchorPoint(),l=o.getContentSize(),h=a.x*l.width,i=i-(1-a.y)*l.height;switch(c){case ccui.LinearLayoutParameter.RIGHT:h=e.width-(1-a.x)*l.width;break;case ccui.LinearLayoutParameter.CENTER_HORIZONTAL:h=e.width/2-l.width*(.5-a.x)}s=s.getMargin(),h+=s.left,i-=s.top,o.setPosition(h,i),i=o.getPositionY()-a.y*l.height-s.bottom}}}}},ccui.linearHorizontalLayoutManager={_doLayout:function(t){var e=t._getLayoutContentSize();t=t._getLayoutElements();for(var i=0,n=0,r=t.length;r>n;n++){var o=t[n];if(o){var s=o.getLayoutParameter();if(s){var c=s.getGravity(),a=o.getAnchorPoint(),l=o.getContentSize(),i=i+a.x*l.width,h=e.height-(1-a.y)*l.height;switch(c){case ccui.LinearLayoutParameter.BOTTOM:h=a.y*l.height;break;case ccui.LinearLayoutParameter.CENTER_VERTICAL:h=e.height/2-l.height*(.5-a.y)}s=s.getMargin(),i+=s.left,h-=s.top,o.setPosition(i,h),i=o.getRightBoundary()+s.right}}}}},ccui.relativeLayoutManager={_unlayoutChildCount:0,_widgetChildren:[],_widget:null,_finalPositionX:0,_finalPositionY:0,_relativeWidgetLP:null,_doLayout:function(t){for(var e=this._widgetChildren=this._getAllWidgets(t);0<this._unlayoutChildCount;){for(var i=0,n=e.length;n>i;i++){this._widget=e[i];var r=this._widget.getLayoutParameter();r&&!r._put&&this._calculateFinalPositionWithRelativeWidget(t)&&(this._calculateFinalPositionWithRelativeAlign(),this._widget.setPosition(this._finalPositionX,this._finalPositionY),r._put=!0)}this._unlayoutChildCount--}this._widgetChildren.length=0},_getAllWidgets:function(t){t=t._getLayoutElements();for(var e=this._widgetChildren,i=e.length=0,n=t.length;n>i;i++){var r=t[i];r&&(r.getLayoutParameter()._put=!1,this._unlayoutChildCount++,e.push(r))}return e},_getRelativeWidget:function(t){var e=null;if((t=t.getLayoutParameter().getRelativeToWidgetName())&&0!==t.length)for(var i=this._widgetChildren,n=0,r=i.length;r>n;n++){var o=i[n];if(o){var s=o.getLayoutParameter();if(s&&s.getRelativeName()===t){e=o,this._relativeWidgetLP=s;break}}}return e},_calculateFinalPositionWithRelativeWidget:function(t){var e=this._widget,i=e.getAnchorPoint(),n=e.getContentSize();this._finalPositionY=this._finalPositionX=0;var r=this._getRelativeWidget(e),e=e.getLayoutParameter().getAlign();switch(t=t._getLayoutContentSize(),e){case ccui.RelativeLayoutParameter.NONE:case ccui.RelativeLayoutParameter.PARENT_TOP_LEFT:this._finalPositionX=i.x*n.width,this._finalPositionY=t.height-(1-i.y)*n.height;break;case ccui.RelativeLayoutParameter.PARENT_TOP_CENTER_HORIZONTAL:this._finalPositionX=.5*t.width-n.width*(.5-i.x),this._finalPositionY=t.height-(1-i.y)*n.height;break;case ccui.RelativeLayoutParameter.PARENT_TOP_RIGHT:this._finalPositionX=t.width-(1-i.x)*n.width,this._finalPositionY=t.height-(1-i.y)*n.height;break;case ccui.RelativeLayoutParameter.PARENT_LEFT_CENTER_VERTICAL:this._finalPositionX=i.x*n.width,this._finalPositionY=.5*t.height-n.height*(.5-i.y);break;case ccui.RelativeLayoutParameter.CENTER_IN_PARENT:this._finalPositionX=.5*t.width-n.width*(.5-i.x),this._finalPositionY=.5*t.height-n.height*(.5-i.y);break;case ccui.RelativeLayoutParameter.PARENT_RIGHT_CENTER_VERTICAL:this._finalPositionX=t.width-(1-i.x)*n.width,this._finalPositionY=.5*t.height-n.height*(.5-i.y);break;case ccui.RelativeLayoutParameter.PARENT_LEFT_BOTTOM:this._finalPositionX=i.x*n.width,this._finalPositionY=i.y*n.height;break;case ccui.RelativeLayoutParameter.PARENT_BOTTOM_CENTER_HORIZONTAL:this._finalPositionX=.5*t.width-n.width*(.5-i.x),this._finalPositionY=i.y*n.height;break;case ccui.RelativeLayoutParameter.PARENT_RIGHT_BOTTOM:this._finalPositionX=t.width-(1-i.x)*n.width,this._finalPositionY=i.y*n.height;break;case ccui.RelativeLayoutParameter.LOCATION_ABOVE_LEFTALIGN:if(r){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;this._finalPositionY=r.getTopBoundary()+i.y*n.height,this._finalPositionX=r.getLeftBoundary()+i.x*n.width}break;case ccui.RelativeLayoutParameter.LOCATION_ABOVE_CENTER:if(r){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;t=r.getContentSize(),this._finalPositionY=r.getTopBoundary()+i.y*n.height,this._finalPositionX=r.getLeftBoundary()+.5*t.width+i.x*n.width-.5*n.width}break;case ccui.RelativeLayoutParameter.LOCATION_ABOVE_RIGHTALIGN:if(r){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;this._finalPositionY=r.getTopBoundary()+i.y*n.height,this._finalPositionX=r.getRightBoundary()-(1-i.x)*n.width}break;case ccui.RelativeLayoutParameter.LOCATION_LEFT_OF_TOPALIGN:if(r){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;this._finalPositionY=r.getTopBoundary()-(1-i.y)*n.height,this._finalPositionX=r.getLeftBoundary()-(1-i.x)*n.width}break;case ccui.RelativeLayoutParameter.LOCATION_LEFT_OF_CENTER:if(r){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;t=r.getContentSize(),this._finalPositionX=r.getLeftBoundary()-(1-i.x)*n.width,this._finalPositionY=r.getBottomBoundary()+.5*t.height+i.y*n.height-.5*n.height}break;case ccui.RelativeLayoutParameter.LOCATION_LEFT_OF_BOTTOMALIGN:if(r){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;this._finalPositionY=r.getBottomBoundary()+i.y*n.height,this._finalPositionX=r.getLeftBoundary()-(1-i.x)*n.width}break;case ccui.RelativeLayoutParameter.LOCATION_RIGHT_OF_TOPALIGN:if(r){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;this._finalPositionY=r.getTopBoundary()-(1-i.y)*n.height,this._finalPositionX=r.getRightBoundary()+i.x*n.width}break;case ccui.RelativeLayoutParameter.LOCATION_RIGHT_OF_CENTER:if(r){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;t=r.getContentSize(),this._finalPositionX=r.getRightBoundary()+i.x*n.width,this._finalPositionY=r.getBottomBoundary()+.5*t.height+i.y*n.height-.5*n.height}break;case ccui.RelativeLayoutParameter.LOCATION_RIGHT_OF_BOTTOMALIGN:if(r){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;this._finalPositionY=r.getBottomBoundary()+i.y*n.height,this._finalPositionX=r.getRightBoundary()+i.x*n.width}break;case ccui.RelativeLayoutParameter.LOCATION_BELOW_LEFTALIGN:if(r){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;this._finalPositionY=r.getBottomBoundary()-(1-i.y)*n.height,this._finalPositionX=r.getLeftBoundary()+i.x*n.width}break;case ccui.RelativeLayoutParameter.LOCATION_BELOW_CENTER:if(r){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;t=r.getContentSize(),this._finalPositionY=r.getBottomBoundary()-(1-i.y)*n.height,this._finalPositionX=r.getLeftBoundary()+.5*t.width+i.x*n.width-.5*n.width}break;case ccui.RelativeLayoutParameter.LOCATION_BELOW_RIGHTALIGN:if(r){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;this._finalPositionY=r.getBottomBoundary()-(1-i.y)*n.height,this._finalPositionX=r.getRightBoundary()-(1-i.x)*n.width}}return!0},_calculateFinalPositionWithRelativeAlign:function(){var t=this._widget.getLayoutParameter(),e=t.getMargin();switch(t.getAlign()){case ccui.RelativeLayoutParameter.NONE:case ccui.RelativeLayoutParameter.PARENT_TOP_LEFT:this._finalPositionX+=e.left,this._finalPositionY-=e.top;break;case ccui.RelativeLayoutParameter.PARENT_TOP_CENTER_HORIZONTAL:this._finalPositionY-=e.top;break;case ccui.RelativeLayoutParameter.PARENT_TOP_RIGHT:this._finalPositionX-=e.right,this._finalPositionY-=e.top;break;case ccui.RelativeLayoutParameter.PARENT_LEFT_CENTER_VERTICAL:this._finalPositionX+=e.left;break;case ccui.RelativeLayoutParameter.PARENT_RIGHT_CENTER_VERTICAL:this._finalPositionX-=e.right;break;case ccui.RelativeLayoutParameter.PARENT_LEFT_BOTTOM:this._finalPositionX+=e.left,this._finalPositionY+=e.bottom;break;case ccui.RelativeLayoutParameter.PARENT_BOTTOM_CENTER_HORIZONTAL:this._finalPositionY+=e.bottom;break;case ccui.RelativeLayoutParameter.PARENT_RIGHT_BOTTOM:this._finalPositionX-=e.right,this._finalPositionY+=e.bottom;break;case ccui.RelativeLayoutParameter.LOCATION_ABOVE_LEFTALIGN:this._finalPositionY+=e.bottom,this._finalPositionX+=e.left;break;case ccui.RelativeLayoutParameter.LOCATION_ABOVE_RIGHTALIGN:this._finalPositionY+=e.bottom,this._finalPositionX-=e.right;break;case ccui.RelativeLayoutParameter.LOCATION_ABOVE_CENTER:this._finalPositionY+=e.bottom;break;case ccui.RelativeLayoutParameter.LOCATION_LEFT_OF_TOPALIGN:this._finalPositionX-=e.right,this._finalPositionY-=e.top;break;case ccui.RelativeLayoutParameter.LOCATION_LEFT_OF_BOTTOMALIGN:this._finalPositionX-=e.right,this._finalPositionY+=e.bottom;break;case ccui.RelativeLayoutParameter.LOCATION_LEFT_OF_CENTER:this._finalPositionX-=e.right;break;case ccui.RelativeLayoutParameter.LOCATION_RIGHT_OF_TOPALIGN:this._finalPositionX+=e.left,this._finalPositionY-=e.top;break;case ccui.RelativeLayoutParameter.LOCATION_RIGHT_OF_BOTTOMALIGN:this._finalPositionX+=e.left,this._finalPositionY+=e.bottom;break;case ccui.RelativeLayoutParameter.LOCATION_RIGHT_OF_CENTER:this._finalPositionX+=e.left;break;case ccui.RelativeLayoutParameter.LOCATION_BELOW_LEFTALIGN:this._finalPositionY-=e.top,this._finalPositionX+=e.left;break;case ccui.RelativeLayoutParameter.LOCATION_BELOW_RIGHTALIGN:this._finalPositionY-=e.top,this._finalPositionX-=e.right;break;case ccui.RelativeLayoutParameter.LOCATION_BELOW_CENTER:this._finalPositionY-=e.top}}},ccui.HBox=ccui.Layout.extend({ctor:function(t){ccui.Layout.prototype.ctor.call(this,t),void 0!==t?this.initWithSize(t):this.init()},init:function(){return ccui.Layout.prototype.init.call(this)?(this.setLayoutType(ccui.Layout.LINEAR_HORIZONTAL),!0):!1},initWithSize:function(t){return this.init()?(this.setContentSize(t),!0):!1}}),ccui.HBox.create=function(t){return new ccui.HBox(t)},ccui.RelativeBox=ccui.Layout.extend({ctor:function(t){t?this.initWithSize(t):this.init()},init:function(){return ccui.Layout.prototype.init.call(this)?(this.setLayoutType(ccui.Layout.RELATIVE),!0):!1},initWithSize:function(t){return this.init()?(this.setContentSize(t),!0):!1}}),ccui.RelativeBox.create=function(t){return new ccui.RelativeBox(t)},ccui.VBox=ccui.Layout.extend({ctor:function(t){ccui.Layout.prototype.ctor.call(this,t),void 0!==t?this.initWithSize(t):this.init()},init:function(){return ccui.Layout.prototype.init.call(this)?(this.setLayoutType(ccui.Layout.LINEAR_VERTICAL),!0):!1},initWithSize:function(t){return this.init()?(this.setContentSize(t),!0):!1}}),ccui.VBox.create=function(t){return new ccui.VBox(t)},ccui.helper={seekWidgetByTag:function(t,e){if(!t)return null;if(t.getTag()===e)return t;for(var i=t.getChildren(),n=i.length,r=0;n>r;r++){var o=ccui.helper.seekWidgetByTag(i[r],e);if(null!==o)return o}return null},seekWidgetByName:function(t,e){if(!t)return null;if(t.getName()===e)return t;for(var i=t.getChildren(),n=i.length,r=0;n>r;r++){var o=ccui.helper.seekWidgetByName(i[r],e);if(null!==o)return o}return null},seekWidgetByRelativeName:function(t,e){if(!t)return null;for(var i=t.getChildren(),n=i.length,r=0;n>r;r++){var o=i[r],s=o.getLayoutParameter(ccui.LayoutParameter.RELATIVE);if(s&&s.getRelativeName()===e)return o}return null},seekActionWidgetByActionTag:function(t,e){if(!t)return null;if(t.getActionTag()===e)return t;for(var i=t.getChildren(),n=0;n<i.length;n++){var r=ccui.helper.seekActionWidgetByActionTag(i[n],e);if(null!==r)return r}return null},_activeLayout:!0,doLayout:function(t){if(this._activeLayout){t=t.getChildren();for(var e,i=0,n=t.length;n>i;i++){e=t[i];var r=e.getComponent(ccui.LayoutComponent.NAME);e=e.getParent(),null!=r&&null!==e&&r.refreshLayout&&r.refreshLayout()}}},changeLayoutSystemActiveState:function(t){this._activeLayout=t},restrictCapInsetRect:function(t,e){var i=t.x,n=t.y,r=t.width,o=t.height;return e.width<r&&(r=i=0),e.height<o&&(o=n=0),cc.rect(i,n,r,o)}},ccui.Button=ccui.Widget.extend({_buttonNormalRenderer:null,_buttonClickedRenderer:null,_buttonDisableRenderer:null,_titleRenderer:null,_normalFileName:"",_clickedFileName:"",_disabledFileName:"",_prevIgnoreSize:!0,_scale9Enabled:!1,_capInsetsNormal:null,_capInsetsPressed:null,_capInsetsDisabled:null,_normalTexType:ccui.Widget.LOCAL_TEXTURE,_pressedTexType:ccui.Widget.LOCAL_TEXTURE,_disabledTexType:ccui.Widget.LOCAL_TEXTURE,_normalTextureSize:null,_pressedTextureSize:null,_disabledTextureSize:null,pressedActionEnabled:!1,_titleColor:null,_normalTextureScaleXInSize:1,_normalTextureScaleYInSize:1,_pressedTextureScaleXInSize:1,_pressedTextureScaleYInSize:1,_zoomScale:.1,_normalTextureLoaded:!1,_pressedTextureLoaded:!1,_disabledTextureLoaded:!1,_className:"Button",_normalTextureAdaptDirty:!0,_pressedTextureAdaptDirty:!0,_disabledTextureAdaptDirty:!0,_fontName:"Thonburi",_fontSize:12,_type:0,ctor:function(t,e,i,n){this._capInsetsNormal=cc.rect(0,0,0,0),this._capInsetsPressed=cc.rect(0,0,0,0),this._capInsetsDisabled=cc.rect(0,0,0,0),this._normalTextureSize=cc.size(0,0),this._pressedTextureSize=cc.size(0,0),this._disabledTextureSize=cc.size(0,0),this._titleColor=cc.color.WHITE,ccui.Widget.prototype.ctor.call(this),this.setTouchEnabled(!0),this.init(t,e,i,n)},init:function(t,e,i,n){if(ccui.Widget.prototype.init.call(this)){if(void 0===t)return!0;this.loadTextures(t,e,i,n)}return!1},_initRenderer:function(){this._buttonNormalRenderer=new cc.Sprite,this._buttonClickedRenderer=new cc.Sprite,this._buttonDisableRenderer=new cc.Sprite,this._titleRenderer=new cc.LabelTTF(""),this._titleRenderer.setAnchorPoint(.5,.5),this.addProtectedChild(this._buttonNormalRenderer,ccui.Button.NORMAL_RENDERER_ZORDER,-1),this.addProtectedChild(this._buttonClickedRenderer,ccui.Button.PRESSED_RENDERER_ZORDER,-1),this.addProtectedChild(this._buttonDisableRenderer,ccui.Button.DISABLED_RENDERER_ZORDER,-1),this.addProtectedChild(this._titleRenderer,ccui.Button.TITLE_RENDERER_ZORDER,-1)},setScale9Enabled:function(t){this._scale9Enabled!==t&&(this._brightStyle=ccui.Widget.BRIGHT_STYLE_NONE,this._scale9Enabled=t,this.removeProtectedChild(this._buttonNormalRenderer),this.removeProtectedChild(this._buttonClickedRenderer),this.removeProtectedChild(this._buttonDisableRenderer),this._scale9Enabled?(this._buttonNormalRenderer=new ccui.Scale9Sprite,this._buttonClickedRenderer=new ccui.Scale9Sprite,this._buttonDisableRenderer=new ccui.Scale9Sprite):(this._buttonNormalRenderer=new cc.Sprite,this._buttonClickedRenderer=new cc.Sprite,this._buttonDisableRenderer=new cc.Sprite),this._buttonClickedRenderer.setVisible(!1),this._buttonDisableRenderer.setVisible(!1),this.loadTextureNormal(this._normalFileName,this._normalTexType),this.loadTexturePressed(this._clickedFileName,this._pressedTexType),this.loadTextureDisabled(this._disabledFileName,this._disabledTexType),this.addProtectedChild(this._buttonNormalRenderer,ccui.Button.NORMAL_RENDERER_ZORDER,-1),this.addProtectedChild(this._buttonClickedRenderer,ccui.Button.PRESSED_RENDERER_ZORDER,-1),this.addProtectedChild(this._buttonDisableRenderer,ccui.Button.DISABLED_RENDERER_ZORDER,-1),this._scale9Enabled?(t=this._ignoreSize,this.ignoreContentAdaptWithSize(!1),this._prevIgnoreSize=t):this.ignoreContentAdaptWithSize(this._prevIgnoreSize),this.setCapInsetsNormalRenderer(this._capInsetsNormal),this.setCapInsetsPressedRenderer(this._capInsetsPressed),this.setCapInsetsDisabledRenderer(this._capInsetsDisabled),this.setBright(this._bright),this._disabledTextureAdaptDirty=this._pressedTextureAdaptDirty=this._normalTextureAdaptDirty=!0)},isScale9Enabled:function(){return this._scale9Enabled},ignoreContentAdaptWithSize:function(t){this._unifySize?this._updateContentSize():(!this._scale9Enabled||this._scale9Enabled&&!t)&&(ccui.Widget.prototype.ignoreContentAdaptWithSize.call(this,t),this._prevIgnoreSize=t)},getVirtualRendererSize:function(){return this._unifySize?this._getNormalSize():!this._normalTextureLoaded&&0<this._titleRenderer.getString().length?this._titleRenderer.getContentSize():cc.size(this._normalTextureSize)},loadTextures:function(t,e,i,n){this.loadTextureNormal(t,n),this.loadTexturePressed(e,n),this.loadTextureDisabled(i,n)},loadTextureNormal:function(t,e){if(t){e=e||ccui.Widget.LOCAL_TEXTURE,this._normalFileName=t,this._normalTexType=e;var i=this,n=this._buttonNormalRenderer;switch(n._textureLoaded||n.addEventListener("load",function(){i.loadTextureNormal(i._normalFileName,i._normalTexType)}),this._normalTexType){case ccui.Widget.LOCAL_TEXTURE:n.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:n.initWithSpriteFrameName(t)}this._normalTextureSize=this._buttonNormalRenderer.getContentSize(),this._updateChildrenDisplayedRGBA(),this._unifySize?this._scale9Enabled&&(n.setCapInsets(this._capInsetsNormal),this._updateContentSizeWithTextureSize(this._getNormalSize())):this._updateContentSizeWithTextureSize(this._normalTextureSize),this._normalTextureAdaptDirty=this._normalTextureLoaded=!0,this._findLayout()}},loadTexturePressed:function(t,e){if(t){e=e||ccui.Widget.LOCAL_TEXTURE,this._clickedFileName=t,this._pressedTexType=e;var i=this,n=this._buttonClickedRenderer;switch(n._textureLoaded||n.addEventListener("load",function(){i.loadTexturePressed(i._clickedFileName,i._pressedTexType)}),this._pressedTexType){case ccui.Widget.LOCAL_TEXTURE:n.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:n.initWithSpriteFrameName(t)}this._scale9Enabled&&n.setCapInsets(this._capInsetsPressed),this._pressedTextureSize=this._buttonClickedRenderer.getContentSize(),this._updateChildrenDisplayedRGBA(),this._pressedTextureAdaptDirty=this._pressedTextureLoaded=!0,this._findLayout()}},loadTextureDisabled:function(t,e){if(t){e=e||ccui.Widget.LOCAL_TEXTURE,this._disabledFileName=t,this._disabledTexType=e;var i=this,n=this._buttonDisableRenderer;switch(n._textureLoaded||n.addEventListener("load",function(){i.loadTextureDisabled(i._disabledFileName,i._disabledTexType)}),this._disabledTexType){case ccui.Widget.LOCAL_TEXTURE:n.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:n.initWithSpriteFrameName(t)}this._scale9Enabled&&n.setCapInsets(this._capInsetsDisabled),this._disabledTextureSize=this._buttonDisableRenderer.getContentSize(),this._updateChildrenDisplayedRGBA(),this._disabledTextureAdaptDirty=this._disabledTextureLoaded=!0,this._findLayout()}},setCapInsets:function(t){this.setCapInsetsNormalRenderer(t),this.setCapInsetsPressedRenderer(t),this.setCapInsetsDisabledRenderer(t)},setCapInsetsNormalRenderer:function(t){if(t){var e=t.x,i=t.y,n=t.width;t=t.height,this._normalTextureSize.width<n&&(n=e=0),this._normalTextureSize.height<t&&(t=i=0);var r=this._capInsetsNormal;r.x=e,r.y=i,r.width=n,r.height=t,this._scale9Enabled&&this._buttonNormalRenderer.setCapInsets(r)}},getCapInsetsNormalRenderer:function(){return cc.rect(this._capInsetsNormal)},setCapInsetsPressedRenderer:function(t){if(t&&this._scale9Enabled){var e=t.x,i=t.y,n=t.width;t=t.height,this._pressedTextureSize.width<n&&(n=e=0),this._pressedTextureSize.height<t&&(t=i=0);var r=this._capInsetsPressed;r.x=e,r.y=i,r.width=n,r.height=t,this._buttonClickedRenderer.setCapInsets(r)}},getCapInsetsPressedRenderer:function(){return cc.rect(this._capInsetsPressed)},setCapInsetsDisabledRenderer:function(t){if(t&&this._scale9Enabled){var e=t.x,i=t.y,n=t.width;t=t.height,this._disabledTextureSize.width<n&&(n=e=0),this._disabledTextureSize.height<t&&(t=i=0);var r=this._capInsetsDisabled;r.x=e,r.y=i,r.width=n,r.height=t,this._buttonDisableRenderer.setCapInsets(r)}},getCapInsetsDisabledRenderer:function(){return cc.rect(this._capInsetsDisabled)},_onPressStateChangedToNormal:function(){if(this._buttonNormalRenderer.setVisible(!0),this._buttonClickedRenderer.setVisible(!1),this._buttonDisableRenderer.setVisible(!1),this._scale9Enabled&&this._buttonNormalRenderer.setState(ccui.Scale9Sprite.state.NORMAL),this._pressedTextureLoaded){if(this.pressedActionEnabled)if(this._buttonNormalRenderer.stopAllActions(),this._buttonClickedRenderer.stopAllActions(),this._buttonNormalRenderer.setScale(this._normalTextureScaleXInSize,this._normalTextureScaleYInSize),this._buttonClickedRenderer.setScale(this._pressedTextureScaleXInSize,this._pressedTextureScaleYInSize),this._titleRenderer.stopAllActions(),this._unifySize){var t=cc.scaleTo(ccui.Button.ZOOM_ACTION_TIME_STEP,1,1);this._titleRenderer.runAction(t)}else this._titleRenderer.setScaleX(1),this._titleRenderer.setScaleY(1)}else this._buttonNormalRenderer.stopAllActions(),this._buttonNormalRenderer.setScale(this._normalTextureScaleXInSize,this._normalTextureScaleYInSize),this._titleRenderer.stopAllActions(),this._scale9Enabled&&this._buttonNormalRenderer.setColor(cc.color.WHITE),this._titleRenderer.setScaleX(1),this._titleRenderer.setScaleY(1)},_onPressStateChangedToPressed:function(){var t=this._buttonNormalRenderer;if(this._scale9Enabled&&t.setState(ccui.Scale9Sprite.state.NORMAL),this._pressedTextureLoaded){if(t.setVisible(!1),this._buttonClickedRenderer.setVisible(!0),this._buttonDisableRenderer.setVisible(!1),this.pressedActionEnabled){t.stopAllActions(),this._buttonClickedRenderer.stopAllActions();var e=cc.scaleTo(ccui.Button.ZOOM_ACTION_TIME_STEP,this._pressedTextureScaleXInSize+this._zoomScale,this._pressedTextureScaleYInSize+this._zoomScale);this._buttonClickedRenderer.runAction(e),t.setScale(this._pressedTextureScaleXInSize+this._zoomScale,this._pressedTextureScaleYInSize+this._zoomScale),this._titleRenderer.stopAllActions(),this._titleRenderer.runAction(cc.scaleTo(ccui.Button.ZOOM_ACTION_TIME_STEP,1+this._zoomScale,1+this._zoomScale))}}else t.setVisible(!0),this._buttonClickedRenderer.setVisible(!0),this._buttonDisableRenderer.setVisible(!1),t.stopAllActions(),t.setScale(this._normalTextureScaleXInSize+this._zoomScale,this._normalTextureScaleYInSize+this._zoomScale),this._titleRenderer.stopAllActions(),this._titleRenderer.setScaleX(1+this._zoomScale),this._titleRenderer.setScaleY(1+this._zoomScale)},_onPressStateChangedToDisabled:function(){this._disabledTextureLoaded?(this._buttonNormalRenderer.setVisible(!1),this._buttonDisableRenderer.setVisible(!0)):this._normalTextureLoaded&&this._scale9Enabled&&this._buttonNormalRenderer.setState(ccui.Scale9Sprite.state.GRAY),this._buttonClickedRenderer.setVisible(!1),this._buttonNormalRenderer.setScale(this._normalTextureScaleXInSize,this._normalTextureScaleYInSize),this._buttonClickedRenderer.setScale(this._pressedTextureScaleXInSize,this._pressedTextureScaleYInSize)},_updateContentSize:function(){if(this._unifySize){if(this._scale9Enabled)ccui.ProtectedNode.setContentSize(this._customSize);else{var t=this._getNormalSize();ccui.ProtectedNode.setContentSize(t)}this._onSizeChanged()}else this._ignoreSize&&this.setContentSize(this.getVirtualRendererSize())},_updateTexturesRGBA:function(){this._buttonNormalRenderer.setColor(this.getColor()),this._buttonClickedRenderer.setColor(this.getColor()),this._buttonDisableRenderer.setColor(this.getColor()),this._buttonNormalRenderer.setOpacity(this.getOpacity()),this._buttonClickedRenderer.setOpacity(this.getOpacity()),this._buttonDisableRenderer.setOpacity(this.getOpacity())},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this),this._updateTitleLocation(),this._disabledTextureAdaptDirty=this._pressedTextureAdaptDirty=this._normalTextureAdaptDirty=!0
},getVirtualRenderer:function(){if(!this._bright)return this._buttonDisableRenderer;switch(this._brightStyle){case ccui.Widget.BRIGHT_STYLE_NORMAL:return this._buttonNormalRenderer;case ccui.Widget.BRIGHT_STYLE_HIGH_LIGHT:return this._buttonClickedRenderer;default:return null}},_normalTextureScaleChangedWithSize:function(){if(this._ignoreSize&&!this._unifySize)this._scale9Enabled||(this._buttonNormalRenderer.setScale(1),this._normalTextureScaleXInSize=this._normalTextureScaleYInSize=1);else if(this._scale9Enabled)this._buttonNormalRenderer.setPreferredSize(this._contentSize),this._normalTextureScaleXInSize=this._normalTextureScaleYInSize=1,this._buttonNormalRenderer.setScale(this._normalTextureScaleXInSize,this._normalTextureScaleYInSize);else{var t=this._normalTextureSize;if(0>=t.width||0>=t.height)return void this._buttonNormalRenderer.setScale(1);var e=this._contentSize.width/t.width,t=this._contentSize.height/t.height;this._buttonNormalRenderer.setScaleX(e),this._buttonNormalRenderer.setScaleY(t),this._normalTextureScaleXInSize=e,this._normalTextureScaleYInSize=t}this._buttonNormalRenderer.setPosition(this._contentSize.width/2,this._contentSize.height/2)},_pressedTextureScaleChangedWithSize:function(){if(this._ignoreSize&&!this._unifySize)this._scale9Enabled||(this._buttonClickedRenderer.setScale(1),this._pressedTextureScaleXInSize=this._pressedTextureScaleYInSize=1);else if(this._scale9Enabled)this._buttonClickedRenderer.setPreferredSize(this._contentSize),this._pressedTextureScaleXInSize=this._pressedTextureScaleYInSize=1,this._buttonClickedRenderer.setScale(this._pressedTextureScaleXInSize,this._pressedTextureScaleYInSize);else{var t=this._pressedTextureSize;if(0>=t.width||0>=t.height)return void this._buttonClickedRenderer.setScale(1);var e=this._contentSize.width/t.width,t=this._contentSize.height/t.height;this._buttonClickedRenderer.setScaleX(e),this._buttonClickedRenderer.setScaleY(t),this._pressedTextureScaleXInSize=e,this._pressedTextureScaleYInSize=t}this._buttonClickedRenderer.setPosition(this._contentSize.width/2,this._contentSize.height/2)},_disabledTextureScaleChangedWithSize:function(){if(this._ignoreSize&&!this._unifySize)this._scale9Enabled&&this._buttonDisableRenderer.setScale(1);else if(this._scale9Enabled)this._buttonDisableRenderer.setScale(1),this._buttonDisableRenderer.setPreferredSize(this._contentSize);else{var t=this._disabledTextureSize;if(0>=t.width||0>=t.height)return void this._buttonDisableRenderer.setScale(1);var e=this._contentSize.height/t.height;this._buttonDisableRenderer.setScaleX(this._contentSize.width/t.width),this._buttonDisableRenderer.setScaleY(e)}this._buttonDisableRenderer.setPosition(this._contentSize.width/2,this._contentSize.height/2)},_adaptRenderers:function(){this._normalTextureAdaptDirty&&(this._normalTextureScaleChangedWithSize(),this._normalTextureAdaptDirty=!1),this._pressedTextureAdaptDirty&&(this._pressedTextureScaleChangedWithSize(),this._pressedTextureAdaptDirty=!1),this._disabledTextureAdaptDirty&&(this._disabledTextureScaleChangedWithSize(),this._disabledTextureAdaptDirty=!1)},_updateTitleLocation:function(){this._titleRenderer.setPosition(.5*this._contentSize.width,.5*this._contentSize.height)},setPressedActionEnabled:function(t){this.pressedActionEnabled=t},setTitleText:function(t){t!==this.getTitleText()&&(this._titleRenderer.setString(t),this._ignoreSize?(t=this.getVirtualRendererSize(),this.setContentSize(t)):this._titleRenderer._renderCmd._updateTTF())},getTitleText:function(){return this._titleRenderer.getString()},setTitleColor:function(t){this._titleRenderer.setFontFillColor(t)},getTitleColor:function(){return this._titleRenderer._getFillStyle()},setTitleFontSize:function(t){this._titleRenderer.setFontSize(t),this._fontSize=t},getTitleFontSize:function(){return this._titleRenderer.getFontSize()},setZoomScale:function(t){this._zoomScale=t},getZoomScale:function(){return this._zoomScale},getNormalTextureSize:function(){return this._normalTextureSize},setTitleFontName:function(t){this._titleRenderer.setFontName(t),this._fontName=t},getTitleRenderer:function(){return this._titleRenderer},getTitleFontName:function(){return this._titleRenderer.getFontName()},_setTitleFont:function(t){this._titleRenderer.font=t},_getTitleFont:function(){return this._titleRenderer.font},getDescription:function(){return"Button"},_createCloneInstance:function(){return new ccui.Button},_copySpecialProperties:function(t){this._prevIgnoreSize=t._prevIgnoreSize,this.setScale9Enabled(t._scale9Enabled),this.loadTextureNormal(t._normalFileName,t._normalTexType),this.loadTexturePressed(t._clickedFileName,t._pressedTexType),this.loadTextureDisabled(t._disabledFileName,t._disabledTexType),this.setCapInsetsNormalRenderer(t._capInsetsNormal),this.setCapInsetsPressedRenderer(t._capInsetsPressed),this.setCapInsetsDisabledRenderer(t._capInsetsDisabled),this.setTitleText(t.getTitleText()),this.setTitleFontName(t.getTitleFontName()),this.setTitleFontSize(t.getTitleFontSize()),this.setTitleColor(t.getTitleColor()),this.setPressedActionEnabled(t.pressedActionEnabled),this.setZoomScale(t._zoomScale)},setColor:function(t){cc.ProtectedNode.prototype.setColor.call(this,t),this._updateTexturesRGBA()},_getNormalSize:function(){var t;null!==this._titleRenderer&&(t=this._titleRenderer.getContentSize());var e;return null!==this._buttonNormalRenderer&&(e=this._buttonNormalRenderer.getContentSize()),cc.size(t.width>e.width?t.width:e.width,t.height>e.height?t.height:e.height)}}),_p=ccui.Button.prototype,cc.defineGetterSetter(_p,"titleText",_p.getTitleText,_p.setTitleText),cc.defineGetterSetter(_p,"titleFont",_p._getTitleFont,_p._setTitleFont),cc.defineGetterSetter(_p,"titleFontSize",_p.getTitleFontSize,_p.setTitleFontSize),cc.defineGetterSetter(_p,"titleFontName",_p.getTitleFontName,_p.setTitleFontName),cc.defineGetterSetter(_p,"titleColor",_p.getTitleColor,_p.setTitleColor),_p=null,ccui.Button.create=function(t,e,i,n){return new ccui.Button(t,e,i,n)},ccui.Button.NORMAL_RENDERER_ZORDER=-2,ccui.Button.PRESSED_RENDERER_ZORDER=-2,ccui.Button.DISABLED_RENDERER_ZORDER=-2,ccui.Button.TITLE_RENDERER_ZORDER=-1,ccui.Button.ZOOM_ACTION_TIME_STEP=.05,ccui.Button.SYSTEM=0,ccui.Button.TTF=1,ccui.CheckBox=ccui.Widget.extend({_backGroundBoxRenderer:null,_backGroundSelectedBoxRenderer:null,_frontCrossRenderer:null,_backGroundBoxDisabledRenderer:null,_frontCrossDisabledRenderer:null,_isSelected:!0,_checkBoxEventListener:null,_checkBoxEventSelector:null,_backGroundTexType:ccui.Widget.LOCAL_TEXTURE,_backGroundSelectedTexType:ccui.Widget.LOCAL_TEXTURE,_frontCrossTexType:ccui.Widget.LOCAL_TEXTURE,_backGroundDisabledTexType:ccui.Widget.LOCAL_TEXTURE,_frontCrossDisabledTexType:ccui.Widget.LOCAL_TEXTURE,_backGroundFileName:"",_backGroundSelectedFileName:"",_frontCrossFileName:"",_backGroundDisabledFileName:"",_frontCrossDisabledFileName:"",_className:"CheckBox",_zoomScale:.1,_backgroundTextureScaleX:.1,_backgroundTextureScaleY:.1,_backGroundBoxRendererAdaptDirty:!0,_backGroundSelectedBoxRendererAdaptDirty:!0,_frontCrossRendererAdaptDirty:!0,_backGroundBoxDisabledRendererAdaptDirty:!0,_frontCrossDisabledRendererAdaptDirty:!0,ctor:function(t,e,i,n,r,o){ccui.Widget.prototype.ctor.call(this),this.setTouchEnabled(!0);for(var s=0,c=0;c<arguments.length;c++){var a=typeof arguments[c];"string"===a?isNaN(arguments[c]-0)?s++:(o=arguments[c],arguments[c]=void 0):"number"===a&&s++}switch(s){case 2:o=i,i=e,e=void 0}this.init(t,e,i,n,r,void 0===o?0:o)},init:function(t,e,i,n,r,o){return ccui.Widget.prototype.init.call(this)?(this._isSelected=!0,this.setSelected(!1),this.loadTextures(t,e,i,n,r,o),!0):!1},_initRenderer:function(){this._backGroundBoxRenderer=new cc.Sprite,this._backGroundSelectedBoxRenderer=new cc.Sprite,this._frontCrossRenderer=new cc.Sprite,this._backGroundBoxDisabledRenderer=new cc.Sprite,this._frontCrossDisabledRenderer=new cc.Sprite,this.addProtectedChild(this._backGroundBoxRenderer,ccui.CheckBox.BOX_RENDERER_ZORDER,-1),this.addProtectedChild(this._backGroundSelectedBoxRenderer,ccui.CheckBox.BOX_SELECTED_RENDERER_ZORDER,-1),this.addProtectedChild(this._frontCrossRenderer,ccui.CheckBox.FRONT_CROSS_RENDERER_ZORDER,-1),this.addProtectedChild(this._backGroundBoxDisabledRenderer,ccui.CheckBox.BOX_DISABLED_RENDERER_ZORDER,-1),this.addProtectedChild(this._frontCrossDisabledRenderer,ccui.CheckBox.FRONT_CROSS_DISABLED_RENDERER_ZORDER,-1)},loadTextures:function(t,e,i,n,r,o){t&&this.loadTextureBackGround(t,o),e&&this.loadTextureBackGroundSelected(e,o),i&&this.loadTextureFrontCross(i,o),n&&this.loadTextureBackGroundDisabled(n,o),r&&this.loadTextureFrontCrossDisabled(r,o)},loadTextureBackGround:function(t,e){if(t){e=e||ccui.Widget.LOCAL_TEXTURE,this._backGroundFileName=t,this._backGroundTexType=e;var i=this._backGroundBoxRenderer;switch(i._textureLoaded?this._backGroundBoxRenderer.setContentSize(this._customSize):i.addEventListener("load",function(){this._updateContentSizeWithTextureSize(this._backGroundBoxRenderer.getContentSize()),this.loadTextureBackGround(this._backGroundFileName,this._backGroundTexType)},this),this._backGroundTexType){case ccui.Widget.LOCAL_TEXTURE:i.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:i.initWithSpriteFrameName(t)}this._updateChildrenDisplayedRGBA(),this._updateContentSizeWithTextureSize(this._backGroundBoxRenderer.getContentSize()),this._backGroundBoxRendererAdaptDirty=!0,this._findLayout()}},loadTextureBackGroundSelected:function(t,e){if(t){e=e||ccui.Widget.LOCAL_TEXTURE,this._backGroundSelectedFileName=t,this._backGroundSelectedTexType=e;var i=this._backGroundSelectedBoxRenderer;switch(i._textureLoaded||i.addEventListener("load",function(){this.loadTextureBackGroundSelected(this._backGroundSelectedFileName,this._backGroundSelectedTexType)},this),this._backGroundSelectedTexType){case ccui.Widget.LOCAL_TEXTURE:i.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:i.initWithSpriteFrameName(t)}this._updateChildrenDisplayedRGBA(),this._backGroundSelectedBoxRendererAdaptDirty=!0,this._findLayout()}},loadTextureFrontCross:function(t,e){if(t){e=e||ccui.Widget.LOCAL_TEXTURE,this._frontCrossFileName=t,this._frontCrossTexType=e;var i=this._frontCrossRenderer;switch(i._textureLoaded||i.addEventListener("load",function(){this.loadTextureFrontCross(this._frontCrossFileName,this._frontCrossTexType)},this),this._frontCrossTexType){case ccui.Widget.LOCAL_TEXTURE:i.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:i.initWithSpriteFrameName(t)}this._updateChildrenDisplayedRGBA(),this._frontCrossRendererAdaptDirty=!0,this._findLayout()}},loadTextureBackGroundDisabled:function(t,e){if(t){e=e||ccui.Widget.LOCAL_TEXTURE,this._backGroundDisabledFileName=t,this._backGroundDisabledTexType=e;var i=this._backGroundBoxDisabledRenderer;switch(i._textureLoaded||i.addEventListener("load",function(){this.loadTextureBackGroundDisabled(this._backGroundDisabledFileName,this._backGroundDisabledTexType)},this),this._backGroundDisabledTexType){case ccui.Widget.LOCAL_TEXTURE:i.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:i.initWithSpriteFrameName(t)}this._updateChildrenDisplayedRGBA(),this._backGroundBoxDisabledRendererAdaptDirty=!0,this._findLayout()}},loadTextureFrontCrossDisabled:function(t,e){if(t){e=e||ccui.Widget.LOCAL_TEXTURE,this._frontCrossDisabledFileName=t,this._frontCrossDisabledTexType=e;var i=this._frontCrossDisabledRenderer;switch(i._textureLoaded||i.addEventListener("load",function(){this.loadTextureFrontCrossDisabled(this._frontCrossDisabledFileName,this._frontCrossDisabledTexType)},this),this._frontCrossDisabledTexType){case ccui.Widget.LOCAL_TEXTURE:i.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:i.initWithSpriteFrameName(t)}this._updateChildrenDisplayedRGBA(),this._frontCrossDisabledRendererAdaptDirty=!0,this._findLayout()}},_onPressStateChangedToNormal:function(){this._backGroundBoxRenderer.setVisible(!0),this._backGroundSelectedBoxRenderer.setVisible(!1),this._backGroundBoxDisabledRenderer.setVisible(!1),this._frontCrossDisabledRenderer.setVisible(!1),this._backGroundBoxRenderer.setScale(this._backgroundTextureScaleX,this._backgroundTextureScaleY),this._frontCrossRenderer.setScale(this._backgroundTextureScaleX,this._backgroundTextureScaleY),this._isSelected&&(this._frontCrossRenderer.setVisible(!0),this._frontCrossRendererAdaptDirty=!0)},_onPressStateChangedToPressed:function(){this._backGroundSelectedFileName?(this._backGroundBoxRenderer.setVisible(!1),this._backGroundSelectedBoxRenderer.setVisible(!0),this._backGroundBoxDisabledRenderer.setVisible(!1),this._frontCrossDisabledRenderer.setVisible(!1)):(this._backGroundBoxRenderer.setScale(this._backgroundTextureScaleX+this._zoomScale,this._backgroundTextureScaleY+this._zoomScale),this._frontCrossRenderer.setScale(this._backgroundTextureScaleX+this._zoomScale,this._backgroundTextureScaleY+this._zoomScale))},_onPressStateChangedToDisabled:function(){this._backGroundDisabledFileName&&this._frontCrossDisabledFileName&&(this._backGroundBoxRenderer.setVisible(!1),this._backGroundBoxDisabledRenderer.setVisible(!0)),this._backGroundSelectedBoxRenderer.setVisible(!1),this._frontCrossRenderer.setVisible(!1),this._backGroundBoxRenderer.setScale(this._backgroundTextureScaleX,this._backgroundTextureScaleY),this._frontCrossRenderer.setScale(this._backgroundTextureScaleX,this._backgroundTextureScaleY),this._isSelected&&(this._frontCrossDisabledRenderer.setVisible(!0),this._frontCrossDisabledRendererAdaptDirty=!0)},setZoomScale:function(t){this._zoomScale=t},getZoomScale:function(){return this._zoomScale},setSelectedState:function(t){this.setSelected(t)},setSelected:function(t){t!==this._isSelected&&(this._isSelected=t,this._frontCrossRenderer.setVisible(this._isSelected))},getSelectedState:function(){return this.isSelected()},isSelected:function(){return this._isSelected},_selectedEvent:function(){this._checkBoxEventSelector&&(this._checkBoxEventListener?this._checkBoxEventSelector.call(this._checkBoxEventListener,this,ccui.CheckBox.EVENT_SELECTED):this._checkBoxEventSelector(this,ccui.CheckBox.EVENT_SELECTED))},_unSelectedEvent:function(){this._checkBoxEventSelector&&(this._checkBoxEventListener?this._checkBoxEventSelector.call(this._checkBoxEventListener,this,ccui.CheckBox.EVENT_UNSELECTED):this._checkBoxEventSelector(this,ccui.CheckBox.EVENT_UNSELECTED))},_releaseUpEvent:function(){ccui.Widget.prototype._releaseUpEvent.call(this),this._isSelected?(this.setSelected(!1),this._unSelectedEvent()):(this.setSelected(!0),this._selectedEvent())},addEventListenerCheckBox:function(t,e){this.addEventListener(t,e)},addEventListener:function(t,e){this._checkBoxEventSelector=t,this._checkBoxEventListener=e},getVirtualRendererSize:function(){return this._backGroundBoxRenderer.getContentSize()},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this),this._frontCrossDisabledRendererAdaptDirty=this._backGroundBoxDisabledRendererAdaptDirty=this._frontCrossRendererAdaptDirty=this._backGroundSelectedBoxRendererAdaptDirty=this._backGroundBoxRendererAdaptDirty=!0},getVirtualRenderer:function(){return this._backGroundBoxRenderer},_backGroundTextureScaleChangedWithSize:function(){var t=this._backGroundBoxRenderer,e=this._contentSize;if(this._ignoreSize)t.setScale(1),this._backgroundTextureScaleX=this._backgroundTextureScaleY=1;else{var i=t.getContentSize();if(0>=i.width||0>=i.height)return t.setScale(1),void(this._backgroundTextureScaleX=this._backgroundTextureScaleY=1);var n=e.width/i.width,i=e.height/i.height;this._backgroundTextureScaleX=n,this._backgroundTextureScaleY=i,t.setScaleX(n),t.setScaleY(i)}t.setPosition(.5*e.width,.5*e.height)},_backGroundSelectedTextureScaleChangedWithSize:function(){var t=this._backGroundSelectedBoxRenderer,e=this._contentSize;if(this._ignoreSize)t.setScale(1);else{var i=t.getContentSize();if(0>=i.width||0>=i.height)return void t.setScale(1);var n=e.height/i.height;t.setScaleX(e.width/i.width),t.setScaleY(n)}t.setPosition(.5*e.width,.5*e.height)},_frontCrossTextureScaleChangedWithSize:function(){var t=this._frontCrossRenderer,e=this._contentSize;if(this._ignoreSize)t.setScale(1);else{var i=t.getContentSize();if(0>=i.width||0>=i.height)return void t.setScale(1);var n=e.height/i.height;t.setScaleX(e.width/i.width),t.setScaleY(n)}t.setPosition(.5*e.width,.5*e.height)},_backGroundDisabledTextureScaleChangedWithSize:function(){var t=this._backGroundBoxDisabledRenderer,e=this._contentSize;if(this._ignoreSize)t.setScale(1);else{var i=t.getContentSize();if(0>=i.width||0>=i.height)return void t.setScale(1);var n=e.height/i.height;t.setScaleX(e.width/i.width),t.setScaleY(n)}t.setPosition(.5*e.width,.5*e.height)},_frontCrossDisabledTextureScaleChangedWithSize:function(){var t=this._frontCrossDisabledRenderer,e=this._contentSize;if(this._ignoreSize)t.setScale(1);else{var i=t.getContentSize();if(0>=i.width||0>=i.height)return void t.setScale(1);var n=e.height/i.height;t.setScaleX(e.width/i.width),t.setScaleY(n)}t.setPosition(.5*e.width,.5*e.height)},getDescription:function(){return"CheckBox"},_createCloneInstance:function(){return new ccui.CheckBox},_copySpecialProperties:function(t){t instanceof ccui.CheckBox&&(this.loadTextureBackGround(t._backGroundFileName,t._backGroundTexType),this.loadTextureBackGroundSelected(t._backGroundSelectedFileName,t._backGroundSelectedTexType),this.loadTextureFrontCross(t._frontCrossFileName,t._frontCrossTexType),this.loadTextureBackGroundDisabled(t._backGroundDisabledFileName,t._backGroundDisabledTexType),this.loadTextureFrontCrossDisabled(t._frontCrossDisabledFileName,t._frontCrossDisabledTexType),this.setSelected(t._isSelected),this._checkBoxEventListener=t._checkBoxEventListener,this._checkBoxEventSelector=t._checkBoxEventSelector,this._ccEventCallback=t._ccEventCallback,this._zoomScale=t._zoomScale,this._backgroundTextureScaleX=t._backgroundTextureScaleX,this._backgroundTextureScaleY=t._backgroundTextureScaleY)},_adaptRenderers:function(){this._backGroundBoxRendererAdaptDirty&&(this._backGroundTextureScaleChangedWithSize(),this._backGroundBoxRendererAdaptDirty=!1),this._backGroundSelectedBoxRendererAdaptDirty&&(this._backGroundSelectedTextureScaleChangedWithSize(),this._backGroundSelectedBoxRendererAdaptDirty=!1),this._frontCrossRendererAdaptDirty&&(this._frontCrossTextureScaleChangedWithSize(),this._frontCrossRendererAdaptDirty=!1),this._backGroundBoxDisabledRendererAdaptDirty&&(this._backGroundDisabledTextureScaleChangedWithSize(),this._backGroundBoxDisabledRendererAdaptDirty=!1),this._frontCrossDisabledRendererAdaptDirty&&(this._frontCrossDisabledTextureScaleChangedWithSize(),this._frontCrossDisabledRendererAdaptDirty=!1)}}),_p=ccui.CheckBox.prototype,cc.defineGetterSetter(_p,"selected",_p.isSelected,_p.setSelected),_p=null,ccui.CheckBox.create=function(t,e,i,n,r,o){return new ccui.CheckBox(t,e,i,n,r,o)},ccui.CheckBox.EVENT_SELECTED=0,ccui.CheckBox.EVENT_UNSELECTED=1,ccui.CheckBox.BOX_RENDERER_ZORDER=-1,ccui.CheckBox.BOX_SELECTED_RENDERER_ZORDER=-1,ccui.CheckBox.BOX_DISABLED_RENDERER_ZORDER=-1,ccui.CheckBox.FRONT_CROSS_RENDERER_ZORDER=-1,ccui.CheckBox.FRONT_CROSS_DISABLED_RENDERER_ZORDER=-1,ccui.ImageView=ccui.Widget.extend({_scale9Enabled:!1,_prevIgnoreSize:!0,_capInsets:null,_imageRenderer:null,_textureFile:"",_imageTexType:ccui.Widget.LOCAL_TEXTURE,_imageTextureSize:null,_className:"ImageView",_imageRendererAdaptDirty:!0,ctor:function(t,e){this._capInsets=cc.rect(0,0,0,0),this._imageTextureSize=cc.size(this._capInsets.width,this._capInsets.height),ccui.Widget.prototype.ctor.call(this),this.init(t,void 0===e?0:e)},init:function(t,e){return ccui.Widget.prototype.init.call(this)?(void 0===t?this._imageTexType=ccui.Widget.LOCAL_TEXTURE:this.loadTexture(t,e),!0):!1},_initRenderer:function(){this._imageRenderer=new cc.Sprite,this.addProtectedChild(this._imageRenderer,ccui.ImageView.RENDERER_ZORDER,-1)},setRotation:function(t){this._imageRenderer.setRotation(t)},loadTexture:function(t,e){if(t){var i=this;e=e||ccui.Widget.LOCAL_TEXTURE,this._textureFile=t,this._imageTexType=e;var n=i._imageRenderer;switch(n._textureLoaded||n.addEventListener("load",function(){i.loadTexture(i._textureFile,i._imageTexType)}),i._imageTexType){case ccui.Widget.LOCAL_TEXTURE:i._scale9Enabled?(n.initWithFile(t),n.setCapInsets(i._capInsets)):n.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:i._scale9Enabled?(n.initWithSpriteFrameName(t),n.setCapInsets(i._capInsets)):n.initWithSpriteFrameName(t)}i._imageTextureSize=n.getContentSize(),this._updateChildrenDisplayedRGBA(),i._updateContentSizeWithTextureSize(i._imageTextureSize),i._imageRendererAdaptDirty=!0,i._findLayout()}},setTextureRect:function(t){this._scale9Enabled||this._imageRenderer.setTextureRect(t)},setScale9Enabled:function(t){this._scale9Enabled!==t&&(this._scale9Enabled=t,this.removeProtectedChild(this._imageRenderer),this._imageRenderer=null,this._imageRenderer=this._scale9Enabled?new ccui.Scale9Sprite:new cc.Sprite,this.loadTexture(this._textureFile,this._imageTexType),this.addProtectedChild(this._imageRenderer,ccui.ImageView.RENDERER_ZORDER,-1),this._scale9Enabled?(t=this._ignoreSize,this.ignoreContentAdaptWithSize(!1),this._prevIgnoreSize=t):this.ignoreContentAdaptWithSize(this._prevIgnoreSize),this.setCapInsets(this._capInsets),this._imageRendererAdaptDirty=!0)},isScale9Enabled:function(){return this._scale9Enabled},ignoreContentAdaptWithSize:function(t){(!this._scale9Enabled||this._scale9Enabled&&!t)&&(ccui.Widget.prototype.ignoreContentAdaptWithSize.call(this,t),this._prevIgnoreSize=t)},setCapInsets:function(t){if(t){var e=this._capInsets;e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,this._scale9Enabled&&this._imageRenderer.setCapInsets(t)}},getCapInsets:function(){return cc.rect(this._capInsets)},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this),this._imageRendererAdaptDirty=!0},_adaptRenderers:function(){this._imageRendererAdaptDirty&&(this._imageTextureScaleChangedWithSize(),this._imageRendererAdaptDirty=!1)},getVirtualRendererSize:function(){return cc.size(this._imageTextureSize)},getVirtualRenderer:function(){return this._imageRenderer},_imageTextureScaleChangedWithSize:function(){if(this._ignoreSize)this._scale9Enabled||this._imageRenderer.setScale(1);else if(this._scale9Enabled)this._imageRenderer.setPreferredSize(this._contentSize),this._imageRenderer.setScale(1);else{var t=this._imageTextureSize;if(0>=t.width||0>=t.height)return void this._imageRenderer.setScale(1);this._imageRenderer.setScaleX(this._contentSize.width/t.width),this._imageRenderer.setScaleY(this._contentSize.height/t.height)}this._imageRenderer.setPosition(this._contentSize.width/2,this._contentSize.height/2)},getDescription:function(){return"ImageView"},_createCloneInstance:function(){return new ccui.ImageView},_copySpecialProperties:function(t){t instanceof ccui.ImageView&&(this._prevIgnoreSize=t._prevIgnoreSize,this.setScale9Enabled(t._scale9Enabled),this.loadTexture(t._textureFile,t._imageTexType),this.setCapInsets(t._capInsets))},setContentSize:function(t,e){if(null!=e&&(t=cc.size(t,e)),ccui.Widget.prototype.setContentSize.call(this,t),this._scale9Enabled)this._imageRenderer.setContentSize(t);else{var i=this._imageRenderer.getContentSize();this._imageRenderer.setScaleX(t.width/i.width),this._imageRenderer.setScaleY(t.height/i.height)}}}),ccui.ImageView.create=function(t,e){return new ccui.ImageView(t,e)},ccui.ImageView.RENDERER_ZORDER=-1,ccui.LoadingBar=ccui.Widget.extend({_direction:null,_percent:100,_totalLength:0,_barRenderer:null,_renderBarTexType:ccui.Widget.LOCAL_TEXTURE,_barRendererTextureSize:null,_scale9Enabled:!1,_prevIgnoreSize:!0,_capInsets:null,_textureFile:"",_isTextureLoaded:!1,_className:"LoadingBar",_barRendererAdaptDirty:!0,ctor:function(t,e){this._direction=ccui.LoadingBar.TYPE_LEFT,this._barRendererTextureSize=cc.size(0,0),this._capInsets=cc.rect(0,0,0,0),ccui.Widget.prototype.ctor.call(this),void 0!==t&&this.loadTexture(t),void 0!==e&&this.setPercent(e)},_initRenderer:function(){this._barRenderer=new cc.Sprite,this.addProtectedChild(this._barRenderer,ccui.LoadingBar.RENDERER_ZORDER,-1),this._barRenderer.setAnchorPoint(0,.5)},setDirection:function(t){if(this._direction!==t)switch(this._direction=t,this._direction){case ccui.LoadingBar.TYPE_LEFT:this._barRenderer.setAnchorPoint(0,.5),this._barRenderer.setPosition(0,.5*this._contentSize.height),this._scale9Enabled||this._barRenderer.setFlippedX(!1);break;case ccui.LoadingBar.TYPE_RIGHT:this._barRenderer.setAnchorPoint(1,.5),this._barRenderer.setPosition(this._totalLength,.5*this._contentSize.height),this._scale9Enabled||this._barRenderer.setFlippedX(!0)}},getDirection:function(){return this._direction},loadTexture:function(t,e){if(t){this._renderBarTexType=e=e||ccui.Widget.LOCAL_TEXTURE,this._textureFile=t;var i=this._barRenderer,n=this;switch(i._textureLoaded||i.addEventListener("load",function(){n.loadTexture(n._textureFile,n._renderBarTexType),n._setPercent(n._percent)}),this._renderBarTexType){case ccui.Widget.LOCAL_TEXTURE:i.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:i.initWithSpriteFrameName(t)}var r=i.getContentSize();switch(this._barRendererTextureSize.width=r.width,this._barRendererTextureSize.height=r.height,this._direction){case ccui.LoadingBar.TYPE_LEFT:i.setAnchorPoint(0,.5),this._scale9Enabled||i.setFlippedX(!1);break;case ccui.LoadingBar.TYPE_RIGHT:i.setAnchorPoint(1,.5),this._scale9Enabled||i.setFlippedX(!0)}this._scale9Enabled&&i.setCapInsets(this._capInsets),this._updateChildrenDisplayedRGBA(),this._barRendererScaleChangedWithSize(),this._updateContentSizeWithTextureSize(this._barRendererTextureSize),this._barRendererAdaptDirty=!0,this._findLayout()}},setScale9Enabled:function(t){this._scale9Enabled!==t&&(this._scale9Enabled=t,this.removeProtectedChild(this._barRenderer),this._barRenderer=this._scale9Enabled?new ccui.Scale9Sprite:new cc.Sprite,this.loadTexture(this._textureFile,this._renderBarTexType),this.addProtectedChild(this._barRenderer,ccui.LoadingBar.RENDERER_ZORDER,-1),this._scale9Enabled?(t=this._ignoreSize,this.ignoreContentAdaptWithSize(!1),this._prevIgnoreSize=t):this.ignoreContentAdaptWithSize(this._prevIgnoreSize),this.setCapInsets(this._capInsets),this.setPercent(this._percent),this._barRendererAdaptDirty=!0)},isScale9Enabled:function(){return this._scale9Enabled},setCapInsets:function(t){if(t){var e=this._capInsets;e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,this._scale9Enabled&&this._barRenderer.setCapInsets(t)}},getCapInsets:function(){return cc.rect(this._capInsets)},setPercent:function(t){t>100&&(t=100),0>t&&(t=0),t!==this._percent&&(this._percent=t,this._setPercent(t))},_setPercent:function(){var t,e,i,n;0>=this._totalLength||(t=this._percent/100,this._scale9Enabled?this._setScale9Scale():(i=this._barRenderer,n=this._barRendererTextureSize,e=i.getTextureRect(),e.width=n.width*t,i.setTextureRect(cc.rect(e.x,e.y,n.width*t,n.height),i._rectRotated)))},setContentSize:function(t,e){ccui.Widget.prototype.setContentSize.call(this,t,e),this._totalLength=void 0===e?t.width:t},getPercent:function(){return this._percent},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this),this._barRendererAdaptDirty=!0},_adaptRenderers:function(){this._barRendererAdaptDirty&&(this._barRendererScaleChangedWithSize(),this._barRendererAdaptDirty=!1)},ignoreContentAdaptWithSize:function(t){(!this._scale9Enabled||this._scale9Enabled&&!t)&&(ccui.Widget.prototype.ignoreContentAdaptWithSize.call(this,t),this._prevIgnoreSize=t)},getVirtualRendererSize:function(){return cc.size(this._barRendererTextureSize)},getVirtualRenderer:function(){return this._barRenderer},_barRendererScaleChangedWithSize:function(){var t=this._barRenderer,e=this._contentSize;if(this._unifySize)this._totalLength=this._contentSize.width,this.setPercent(this._percent);else if(this._ignoreSize)this._scale9Enabled||(this._totalLength=this._barRendererTextureSize.width,t.setScale(1));else if(this._totalLength=e.width,this._scale9Enabled)this._setScale9Scale(),t.setScale(1);else{var i=this._barRendererTextureSize;if(0>=i.width||0>=i.height)return void t.setScale(1);var n=e.height/i.height;t.setScaleX(e.width/i.width),t.setScaleY(n)}switch(this._direction){case ccui.LoadingBar.TYPE_LEFT:t.setPosition(0,.5*e.height);break;case ccui.LoadingBar.TYPE_RIGHT:t.setPosition(this._totalLength,.5*e.height)}},_setScale9Scale:function(){this._barRenderer.setPreferredSize(cc.size(this._percent/100*this._totalLength,this._contentSize.height))},getDescription:function(){return"LoadingBar"},_createCloneInstance:function(){return new ccui.LoadingBar},_copySpecialProperties:function(t){t instanceof ccui.LoadingBar&&(this._prevIgnoreSize=t._prevIgnoreSize,this.setScale9Enabled(t._scale9Enabled),this.loadTexture(t._textureFile,t._renderBarTexType),this.setCapInsets(t._capInsets),this.setPercent(t._percent),this.setDirection(t._direction))}}),_p=ccui.LoadingBar.prototype,cc.defineGetterSetter(_p,"direction",_p.getDirection,_p.setDirection),cc.defineGetterSetter(_p,"percent",_p.getPercent,_p.setPercent),_p=null,ccui.LoadingBar.create=function(t,e){return new ccui.LoadingBar(t,e)},ccui.LoadingBar.TYPE_LEFT=0,ccui.LoadingBar.TYPE_RIGHT=1,ccui.LoadingBar.RENDERER_ZORDER=-1,ccui.Slider=ccui.Widget.extend({_barRenderer:null,_progressBarRenderer:null,_barTextureSize:null,_progressBarTextureSize:null,_slidBallNormalRenderer:null,_slidBallPressedRenderer:null,_slidBallDisabledRenderer:null,_slidBallRenderer:null,_barLength:0,_percent:0,_scale9Enabled:!1,_prevIgnoreSize:!0,_textureFile:"",_progressBarTextureFile:"",_slidBallNormalTextureFile:"",_slidBallPressedTextureFile:"",_slidBallDisabledTextureFile:"",_capInsetsBarRenderer:null,_capInsetsProgressBarRenderer:null,_sliderEventListener:null,_sliderEventSelector:null,_barTexType:ccui.Widget.LOCAL_TEXTURE,_progressBarTexType:ccui.Widget.LOCAL_TEXTURE,_ballNTexType:ccui.Widget.LOCAL_TEXTURE,_ballPTexType:ccui.Widget.LOCAL_TEXTURE,_ballDTexType:ccui.Widget.LOCAL_TEXTURE,_isTextureLoaded:!1,_className:"Slider",_barRendererAdaptDirty:!0,_progressBarRendererDirty:!0,_unifySize:!1,_zoomScale:.1,_sliderBallNormalTextureScaleX:1,_sliderBallNormalTextureScaleY:1,ctor:function(t,e,i){this._barTextureSize=cc.size(0,0),this._progressBarTextureSize=cc.size(0,0),this._capInsetsBarRenderer=cc.rect(0,0,0,0),this._capInsetsProgressBarRenderer=cc.rect(0,0,0,0),ccui.Widget.prototype.ctor.call(this),i=null==i?0:i,this.setTouchEnabled(!0),t&&this.loadBarTexture(t,i),e&&this.loadSlidBallTextures(e,i)},init:function(){return ccui.Widget.prototype.init.call(this)},_initRenderer:function(){this._barRenderer=new cc.Sprite,this._progressBarRenderer=new cc.Sprite,this._progressBarRenderer.setAnchorPoint(0,.5),this.addProtectedChild(this._barRenderer,ccui.Slider.BASEBAR_RENDERER_ZORDER,-1),this.addProtectedChild(this._progressBarRenderer,ccui.Slider.PROGRESSBAR_RENDERER_ZORDER,-1),this._slidBallNormalRenderer=new cc.Sprite,this._slidBallPressedRenderer=new cc.Sprite,this._slidBallPressedRenderer.setVisible(!1),this._slidBallDisabledRenderer=new cc.Sprite,this._slidBallDisabledRenderer.setVisible(!1),this._slidBallRenderer=new cc.Node,this._slidBallRenderer.addChild(this._slidBallNormalRenderer),this._slidBallRenderer.addChild(this._slidBallPressedRenderer),this._slidBallRenderer.addChild(this._slidBallDisabledRenderer),this._slidBallRenderer.setCascadeColorEnabled(!0),this._slidBallRenderer.setCascadeOpacityEnabled(!0),this.addProtectedChild(this._slidBallRenderer,ccui.Slider.BALL_RENDERER_ZORDER,-1)},loadBarTexture:function(t,e){if(t){e=e||ccui.Widget.LOCAL_TEXTURE,this._textureFile=t,this._barTexType=e;var i=this._barRenderer,n=this;switch(i._textureLoaded||i.addEventListener("load",function(){n.loadBarTexture(n._textureFile,n._barTexType)}),this._barTexType){case ccui.Widget.LOCAL_TEXTURE:i.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:i.initWithSpriteFrameName(t)}this._updateChildrenDisplayedRGBA(),this._progressBarRendererDirty=this._barRendererAdaptDirty=!0,this._updateContentSizeWithTextureSize(this._barRenderer.getContentSize()),this._findLayout(),this._barTextureSize=this._barRenderer.getContentSize()
}},loadProgressBarTexture:function(t,e){if(t){e=e||ccui.Widget.LOCAL_TEXTURE,this._progressBarTextureFile=t,this._progressBarTexType=e;var i=this._progressBarRenderer,n=this;switch(i._textureLoaded||i.addEventListener("load",function(){n.loadProgressBarTexture(n._progressBarTextureFile,n._progressBarTexType)}),this._progressBarTexType){case ccui.Widget.LOCAL_TEXTURE:i.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:i.initWithSpriteFrameName(t)}this._updateChildrenDisplayedRGBA(),this._progressBarRenderer.setAnchorPoint(cc.p(0,.5)),i=this._progressBarRenderer.getContentSize(),this._progressBarTextureSize={width:i.width,height:i.height},this._progressBarRendererDirty=!0,this._findLayout()}},setScale9Enabled:function(t){this._scale9Enabled!==t&&(this._scale9Enabled=t,this.removeProtectedChild(this._barRenderer,!0),this.removeProtectedChild(this._progressBarRenderer,!0),this._progressBarRenderer=this._barRenderer=null,this._scale9Enabled?(this._barRenderer=new ccui.Scale9Sprite,this._progressBarRenderer=new ccui.Scale9Sprite):(this._barRenderer=new cc.Sprite,this._progressBarRenderer=new cc.Sprite),this.loadBarTexture(this._textureFile,this._barTexType),this.loadProgressBarTexture(this._progressBarTextureFile,this._progressBarTexType),this.addProtectedChild(this._barRenderer,ccui.Slider.BASEBAR_RENDERER_ZORDER,-1),this.addProtectedChild(this._progressBarRenderer,ccui.Slider.PROGRESSBAR_RENDERER_ZORDER,-1),this._scale9Enabled?(t=this._ignoreSize,this.ignoreContentAdaptWithSize(!1),this._prevIgnoreSize=t):this.ignoreContentAdaptWithSize(this._prevIgnoreSize),this.setCapInsetsBarRenderer(this._capInsetsBarRenderer),this.setCapInsetProgressBarRenderer(this._capInsetsProgressBarRenderer),this._progressBarRendererDirty=this._barRendererAdaptDirty=!0)},isScale9Enabled:function(){return this._scale9Enabled},ignoreContentAdaptWithSize:function(t){(!this._scale9Enabled||this._scale9Enabled&&!t)&&(ccui.Widget.prototype.ignoreContentAdaptWithSize.call(this,t),this._prevIgnoreSize=t)},setCapInsets:function(t){this.setCapInsetsBarRenderer(t),this.setCapInsetProgressBarRenderer(t)},setCapInsetsBarRenderer:function(t){if(t){var e=this._capInsetsBarRenderer;e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,this._scale9Enabled&&this._barRenderer.setCapInsets(t)}},getCapInsetsBarRenderer:function(){return cc.rect(this._capInsetsBarRenderer)},setCapInsetProgressBarRenderer:function(t){if(t){var e=this._capInsetsProgressBarRenderer;e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,this._scale9Enabled&&this._progressBarRenderer.setCapInsets(t)}},getCapInsetsProgressBarRenderer:function(){return cc.rect(this._capInsetsProgressBarRenderer)},loadSlidBallTextures:function(t,e,i,n){this.loadSlidBallTextureNormal(t,n),this.loadSlidBallTexturePressed(e,n),this.loadSlidBallTextureDisabled(i,n)},loadSlidBallTextureNormal:function(t,e){if(t){e=e||ccui.Widget.LOCAL_TEXTURE,this._slidBallNormalTextureFile=t,this._ballNTexType=e;var i=this;switch(this._slidBallNormalRenderer._textureLoaded||this._slidBallNormalRenderer.addEventListener("load",function(){i.loadSlidBallTextureNormal(i._slidBallNormalTextureFile,i._ballNTexType)}),this._ballNTexType){case ccui.Widget.LOCAL_TEXTURE:this._slidBallNormalRenderer.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:this._slidBallNormalRenderer.initWithSpriteFrameName(t)}this._updateChildrenDisplayedRGBA(),this._findLayout()}},loadSlidBallTexturePressed:function(t,e){if(t){e=e||ccui.Widget.LOCAL_TEXTURE,this._slidBallPressedTextureFile=t,this._ballPTexType=e;var i=this;switch(this._slidBallPressedRenderer._textureLoaded||this._slidBallPressedRenderer.addEventListener("load",function(){i.loadSlidBallTexturePressed(i._slidBallPressedTextureFile,i._ballPTexType)}),this._ballPTexType){case ccui.Widget.LOCAL_TEXTURE:this._slidBallPressedRenderer.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:this._slidBallPressedRenderer.initWithSpriteFrameName(t)}this._updateChildrenDisplayedRGBA(),this._findLayout()}},loadSlidBallTextureDisabled:function(t,e){if(t){e=e||ccui.Widget.LOCAL_TEXTURE,this._slidBallDisabledTextureFile=t,this._ballDTexType=e;var i=this;switch(this._slidBallDisabledRenderer._textureLoaded||this._slidBallDisabledRenderer.addEventListener("load",function(){i.loadSlidBallTextureDisabled(i._slidBallDisabledTextureFile,i._ballDTexType)}),this._ballDTexType){case ccui.Widget.LOCAL_TEXTURE:this._slidBallDisabledRenderer.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:this._slidBallDisabledRenderer.initWithSpriteFrameName(t)}this._updateChildrenDisplayedRGBA(),this._findLayout()}},setPercent:function(t){if(t>100&&(t=100),0>t&&(t=0),this._percent=t,t=t/100*this._barLength,this._slidBallRenderer.setPosition(t,this._contentSize.height/2),this._scale9Enabled)this._progressBarRenderer.setPreferredSize(cc.size(t,this._contentSize.height));else{var e=this._progressBarRenderer,i=e.getTextureRect();e.setTextureRect(cc.rect(i.x,i.y,t/e._scaleX,i.height),e.isTextureRectRotated())}},hitTest:function(t){t=this._slidBallNormalRenderer.convertToNodeSpace(t);var e=this._slidBallNormalRenderer.getContentSize(),e=cc.rect(0,0,e.width,e.height);return t.x>=e.x&&t.x<=e.x+e.width&&t.y>=e.y&&t.y<=e.y+e.height},onTouchBegan:function(t,e){var i=ccui.Widget.prototype.onTouchBegan.call(this,t,e);if(this._hit){var n=this.convertToNodeSpace(this._touchBeganPosition);this.setPercent(this._getPercentWithBallPos(n.x)),this._percentChangedEvent()}return i},onTouchMoved:function(t){var e=t.getLocation(),e=this.convertToNodeSpace(e);this.setPercent(this._getPercentWithBallPos(e.x)),this._percentChangedEvent()},onTouchEnded:function(t,e){ccui.Widget.prototype.onTouchEnded.call(this,t,e)},onTouchCancelled:function(t,e){ccui.Widget.prototype.onTouchCancelled.call(this,t,e)},_getPercentWithBallPos:function(t){return t/this._barLength*100},addEventListenerSlider:function(t,e){this.addEventListener(t,e)},addEventListener:function(t,e){this._sliderEventSelector=t,this._sliderEventListener=e},_percentChangedEvent:function(){this._sliderEventSelector&&(this._sliderEventListener?this._sliderEventSelector.call(this._sliderEventListener,this,ccui.Slider.EVENT_PERCENT_CHANGED):this._sliderEventSelector(this,ccui.Slider.EVENT_PERCENT_CHANGED)),this._ccEventCallback&&this._ccEventCallback(this,ccui.Slider.EVENT_PERCENT_CHANGED)},getPercent:function(){return this._percent},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this),this._progressBarRendererDirty=this._barRendererAdaptDirty=!0},_adaptRenderers:function(){this._barRendererAdaptDirty&&(this._barRendererScaleChangedWithSize(),this._barRendererAdaptDirty=!1),this._progressBarRendererDirty&&(this._progressBarRendererScaleChangedWithSize(),this._progressBarRendererDirty=!1)},getVirtualRendererSize:function(){return this._barRenderer.getContentSize()},getVirtualRenderer:function(){return this._barRenderer},_barRendererScaleChangedWithSize:function(){if(this._unifySize)this._barLength=this._contentSize.width,this._barRenderer.setPreferredSize(this._contentSize);else if(this._ignoreSize)this._barRenderer.setScale(1),this._barLength=this._contentSize.width;else if(this._barLength=this._contentSize.width,this._scale9Enabled)this._barRenderer.setPreferredSize(this._contentSize),this._barRenderer.setScale(1);else{var t=this._barTextureSize;if(0>=t.width||0>=t.height)this._barRenderer.setScale(1);else{var e=this._contentSize.height/t.height;this._barRenderer.setScaleX(this._contentSize.width/t.width),this._barRenderer.setScaleY(e)}}this._barRenderer.setPosition(this._contentSize.width/2,this._contentSize.height/2),this.setPercent(this._percent)},_progressBarRendererScaleChangedWithSize:function(){if(this._unifySize)this._progressBarRenderer.setPreferredSize(this._contentSize);else if(this._ignoreSize){if(!this._scale9Enabled){var t=this._progressBarTextureSize,e=this._contentSize.width/t.width,t=this._contentSize.height/t.height;this._progressBarRenderer.setScaleX(e),this._progressBarRenderer.setScaleY(t)}}else if(this._scale9Enabled)this._progressBarRenderer.setPreferredSize(this._contentSize),this._progressBarRenderer.setScale(1);else{if(t=this._progressBarTextureSize,0>=t.width||0>=t.height)return void this._progressBarRenderer.setScale(1);e=this._contentSize.width/t.width,t=this._contentSize.height/t.height,this._progressBarRenderer.setScaleX(e),this._progressBarRenderer.setScaleY(t)}this._progressBarRenderer.setPosition(0,this._contentSize.height/2),this.setPercent(this._percent)},_onPressStateChangedToNormal:function(){this._slidBallNormalRenderer.setVisible(!0),this._slidBallPressedRenderer.setVisible(!1),this._slidBallDisabledRenderer.setVisible(!1),this._slidBallNormalRenderer.setScale(this._sliderBallNormalTextureScaleX,this._sliderBallNormalTextureScaleY)},_onPressStateChangedToPressed:function(){this._slidBallPressedTextureFile?(this._slidBallNormalRenderer.setVisible(!1),this._slidBallPressedRenderer.setVisible(!0),this._slidBallDisabledRenderer.setVisible(!1)):this._slidBallNormalRenderer.setScale(this._sliderBallNormalTextureScaleX+this._zoomScale,this._sliderBallNormalTextureScaleY+this._zoomScale)},_onPressStateChangedToDisabled:function(){this._slidBallDisabledTextureFile&&(this._slidBallNormalRenderer.setVisible(!1),this._slidBallDisabledRenderer.setVisible(!0)),this._slidBallNormalRenderer.setScale(this._sliderBallNormalTextureScaleX,this._sliderBallNormalTextureScaleY),this._slidBallPressedRenderer.setVisible(!1)},setZoomScale:function(t){this._zoomScale=t},getZoomScale:function(){return this._zoomScale},getDescription:function(){return"Slider"},_createCloneInstance:function(){return new ccui.Slider},_copySpecialProperties:function(t){this._prevIgnoreSize=t._prevIgnoreSize,this.setScale9Enabled(t._scale9Enabled),this.loadBarTexture(t._textureFile,t._barTexType),this.loadProgressBarTexture(t._progressBarTextureFile,t._progressBarTexType),this.loadSlidBallTextureNormal(t._slidBallNormalTextureFile,t._ballNTexType),this.loadSlidBallTexturePressed(t._slidBallPressedTextureFile,t._ballPTexType),this.loadSlidBallTextureDisabled(t._slidBallDisabledTextureFile,t._ballDTexType),this.setPercent(t.getPercent()),this._sliderEventListener=t._sliderEventListener,this._sliderEventSelector=t._sliderEventSelector,this._zoomScale=t._zoomScale,this._ccEventCallback=t._ccEventCallback}}),_p=ccui.Slider.prototype,cc.defineGetterSetter(_p,"percent",_p.getPercent,_p.setPercent),_p=null,ccui.Slider.create=function(t,e,i){return new ccui.Slider(t,e,i)},ccui.Slider.EVENT_PERCENT_CHANGED=0,ccui.Slider.BASEBAR_RENDERER_ZORDER=-3,ccui.Slider.PROGRESSBAR_RENDERER_ZORDER=-2,ccui.Slider.BALL_RENDERER_ZORDER=-1,ccui.Text=ccui.Widget.extend({_touchScaleChangeEnabled:!1,_normalScaleValueX:1,_normalScaleValueY:1,_fontName:"Thonburi",_fontSize:10,_onSelectedScaleOffset:.5,_labelRenderer:"",_textAreaSize:null,_textVerticalAlignment:0,_textHorizontalAlignment:0,_className:"Text",_type:null,_labelRendererAdaptDirty:!0,ctor:function(t,e,i){this._type=ccui.Text.Type.SYSTEM,this._textAreaSize=cc.size(0,0),ccui.Widget.prototype.ctor.call(this),void 0!==i&&this.init(t,e,i)},init:function(t,e,i){return ccui.Widget.prototype.init.call(this)?(0<arguments.length?(this.setFontName(e),this.setFontSize(i),this.setString(t)):this.setFontName(this._fontName),!0):!1},_initRenderer:function(){this._labelRenderer=new cc.LabelTTF,this.addProtectedChild(this._labelRenderer,ccui.Text.RENDERER_ZORDER,-1)},setText:function(t){cc.log("Please use the setString"),this.setString(t)},setString:function(t){t!==this._labelRenderer.getString()&&(this._labelRenderer.setString(t),this._updateContentSizeWithTextureSize(this._labelRenderer.getContentSize()),this._labelRendererAdaptDirty=!0)},getStringValue:function(){return cc.log("Please use the getString"),this._labelRenderer.getString()},getString:function(){return this._labelRenderer.getString()},getStringLength:function(){return this._labelRenderer.getStringLength()},setFontSize:function(t){this._labelRenderer.setFontSize(t),this._fontSize=t,this._updateContentSizeWithTextureSize(this._labelRenderer.getContentSize()),this._labelRendererAdaptDirty=!0},getFontSize:function(){return this._fontSize},setFontName:function(t){this._fontName=t,this._labelRenderer.setFontName(t),this._updateContentSizeWithTextureSize(this._labelRenderer.getContentSize()),this._labelRendererAdaptDirty=!0},getFontName:function(){return this._fontName},_setFont:function(t){var e=cc.LabelTTF._fontStyleRE.exec(t);e&&(this._fontSize=parseInt(e[1]),this._fontName=e[2],this._labelRenderer._setFont(t),this._labelScaleChangedWithSize())},_getFont:function(){return this._labelRenderer._getFont()},getType:function(){return this._type},setTextAreaSize:function(t){this._labelRenderer.setDimensions(t),this._ignoreSize||(this._customSize=t),this._updateContentSizeWithTextureSize(this._labelRenderer.getContentSize()),this._labelRendererAdaptDirty=!0},getTextAreaSize:function(){return this._labelRenderer.getDimensions()},setTextHorizontalAlignment:function(t){this._labelRenderer.setHorizontalAlignment(t),this._updateContentSizeWithTextureSize(this._labelRenderer.getContentSize()),this._labelRendererAdaptDirty=!0},getTextHorizontalAlignment:function(){return this._labelRenderer.getHorizontalAlignment()},setTextVerticalAlignment:function(t){this._labelRenderer.setVerticalAlignment(t),this._updateContentSizeWithTextureSize(this._labelRenderer.getContentSize()),this._labelRendererAdaptDirty=!0},getTextVerticalAlignment:function(){return this._labelRenderer.getVerticalAlignment()},setTouchScaleChangeEnabled:function(t){this._touchScaleChangeEnabled=t},isTouchScaleChangeEnabled:function(){return this._touchScaleChangeEnabled},_onPressStateChangedToNormal:function(){this._touchScaleChangeEnabled&&(this._labelRenderer.setScaleX(this._normalScaleValueX),this._labelRenderer.setScaleY(this._normalScaleValueY))},_onPressStateChangedToPressed:function(){this._touchScaleChangeEnabled&&(this._labelRenderer.setScaleX(this._normalScaleValueX+this._onSelectedScaleOffset),this._labelRenderer.setScaleY(this._normalScaleValueY+this._onSelectedScaleOffset))},_onPressStateChangedToDisabled:function(){},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this),this._labelRendererAdaptDirty=!0},_adaptRenderers:function(){this._labelRendererAdaptDirty&&(this._labelScaleChangedWithSize(),this._labelRendererAdaptDirty=!1)},getVirtualRendererSize:function(){return this._labelRenderer.getContentSize()},getVirtualRenderer:function(){return this._labelRenderer},getAutoRenderSize:function(){var t=this._labelRenderer.getContentSize();return this._ignoreSize||(this._labelRenderer.setDimensions(0,0),t=this._labelRenderer.getContentSize(),this._labelRenderer.setDimensions(this._contentSize.width,this._contentSize.height)),t},_labelScaleChangedWithSize:function(){var t=this._contentSize;if(this._ignoreSize)this._labelRenderer.setDimensions(0,0),this._labelRenderer.setScale(1),this._normalScaleValueX=this._normalScaleValueY=1;else{this._labelRenderer.setDimensions(cc.size(t.width,t.height));var e=this._labelRenderer.getContentSize();if(0>=e.width||0>=e.height)return void this._labelRenderer.setScale(1);var i=t.width/e.width,e=t.height/e.height;this._labelRenderer.setScaleX(i),this._labelRenderer.setScaleY(e),this._normalScaleValueX=i,this._normalScaleValueY=e}this._labelRenderer.setPosition(t.width/2,t.height/2)},getDescription:function(){return"Label"},enableShadow:function(t,e,i){this._labelRenderer.enableShadow(t,e,i)},enableOutline:function(t,e){this._labelRenderer.enableStroke(t,e)},enableGlow:function(t){this._type===ccui.Text.Type.TTF&&this._labelRenderer.enableGlow(t)},disableEffect:function(){this._labelRenderer.disableEffect&&this._labelRenderer.disableEffect()},_createCloneInstance:function(){return new ccui.Text},_copySpecialProperties:function(t){t instanceof ccui.Text&&(this.setFontName(t._fontName),this.setFontSize(t.getFontSize()),this.setString(t.getString()),this.setTouchScaleChangeEnabled(t.touchScaleEnabled),this.setTextAreaSize(t._textAreaSize),this.setTextHorizontalAlignment(t._labelRenderer.getHorizontalAlignment()),this.setTextVerticalAlignment(t._labelRenderer.getVerticalAlignment()),this.setContentSize(t.getContentSize()))},_setBoundingWidth:function(t){this._textAreaSize.width=t,this._labelRenderer._setBoundingWidth(t),this._labelScaleChangedWithSize()},_setBoundingHeight:function(t){this._textAreaSize.height=t,this._labelRenderer._setBoundingHeight(t),this._labelScaleChangedWithSize()},_getBoundingWidth:function(){return this._textAreaSize.width},_getBoundingHeight:function(){return this._textAreaSize.height},_changePosition:function(){this._adaptRenderers()},setColor:function(t){cc.ProtectedNode.prototype.setColor.call(this,t),this._labelRenderer.setColor(t)},setTextColor:function(t){this._labelRenderer.setFontFillColor(t)},getTextColor:function(){return this._labelRenderer._getFillStyle()}}),_p=ccui.Text.prototype,cc.defineGetterSetter(_p,"boundingWidth",_p._getBoundingWidth,_p._setBoundingWidth),cc.defineGetterSetter(_p,"boundingHeight",_p._getBoundingHeight,_p._setBoundingHeight),cc.defineGetterSetter(_p,"string",_p.getString,_p.setString),cc.defineGetterSetter(_p,"stringLength",_p.getStringLength),cc.defineGetterSetter(_p,"font",_p._getFont,_p._setFont),cc.defineGetterSetter(_p,"fontSize",_p.getFontSize,_p.setFontSize),cc.defineGetterSetter(_p,"fontName",_p.getFontName,_p.setFontName),cc.defineGetterSetter(_p,"textAlign",_p.getTextHorizontalAlignment,_p.setTextHorizontalAlignment),cc.defineGetterSetter(_p,"verticalAlign",_p.getTextVerticalAlignment,_p.setTextVerticalAlignment),_p=null,ccui.Label=ccui.Text.create=function(t,e,i){return new ccui.Text(t,e,i)},ccui.Text.RENDERER_ZORDER=-1,ccui.Text.Type={SYSTEM:0,TTF:1},ccui.TextAtlas=ccui.Widget.extend({_labelAtlasRenderer:null,_stringValue:"",_charMapFileName:"",_itemWidth:0,_itemHeight:0,_startCharMap:"",_className:"TextAtlas",_labelAtlasRendererAdaptDirty:null,ctor:function(t,e,i,n,r){ccui.Widget.prototype.ctor.call(this),void 0!==r&&this.setProperty(t,e,i,n,r)},_initRenderer:function(){this._labelAtlasRenderer=new cc.LabelAtlas,this._labelAtlasRenderer.setAnchorPoint(cc.p(.5,.5)),this.addProtectedChild(this._labelAtlasRenderer,ccui.TextAtlas.RENDERER_ZORDER,-1)},setProperty:function(t,e,i,n,r){this._stringValue=t,this._charMapFileName=e,this._itemWidth=i,this._itemHeight=n,this._startCharMap=r,this._labelAtlasRenderer.initWithString(t,this._charMapFileName,this._itemWidth,this._itemHeight,this._startCharMap[0]),this._updateContentSizeWithTextureSize(this._labelAtlasRenderer.getContentSize()),this._labelAtlasRendererAdaptDirty=!0},setString:function(t){t!==this._labelAtlasRenderer.getString()&&(this._stringValue=t,this._labelAtlasRenderer.setString(t),this._updateContentSizeWithTextureSize(this._labelAtlasRenderer.getContentSize()),this._labelAtlasRendererAdaptDirty=!0)},setStringValue:function(t){cc.log("Please use the setString"),this.setString(t)},getStringValue:function(){return cc.log("Please use the getString"),this.getString()},getString:function(){return this._labelAtlasRenderer.getString()},getStringLength:function(){return this._labelAtlasRenderer.getStringLength()},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this),this._labelAtlasRendererAdaptDirty=!0},_adaptRenderers:function(){this._labelAtlasRendererAdaptDirty&&(this._labelAtlasScaleChangedWithSize(),this._labelAtlasRendererAdaptDirty=!1)},getVirtualRendererSize:function(){return this._labelAtlasRenderer.getContentSize()},getVirtualRenderer:function(){return this._labelAtlasRenderer},_labelAtlasScaleChangedWithSize:function(){var t=this._labelAtlasRenderer;if(this._ignoreSize)t.setScale(1);else{var e=t.getContentSize();if(0>=e.width||0>=e.height)return void t.setScale(1);t.setScaleX(this._contentSize.width/e.width),t.setScaleY(this._contentSize.height/e.height)}t.setPosition(this._contentSize.width/2,this._contentSize.height/2)},getDescription:function(){return"LabelAtlas"},_copySpecialProperties:function(t){t&&this.setProperty(t._stringValue,t._charMapFileName,t._itemWidth,t._itemHeight,t._startCharMap)},_createCloneInstance:function(){return new ccui.TextAtlas}}),_p=ccui.TextAtlas.prototype,cc.defineGetterSetter(_p,"string",_p.getString,_p.setString),_p=null,ccui.TextAtlas.create=function(t,e,i,n,r){return new ccui.TextAtlas(t,e,i,n,r)},ccui.TextAtlas.RENDERER_ZORDER=-1,ccui.LabelBMFont=ccui.TextBMFont=ccui.Widget.extend({_labelBMFontRenderer:null,_fntFileHasInit:!1,_fntFileName:"",_stringValue:"",_className:"TextBMFont",_labelBMFontRendererAdaptDirty:!0,ctor:function(t,e){ccui.Widget.prototype.ctor.call(this),void 0!=e&&(this.setFntFile(e),this.setString(t))},_initRenderer:function(){this._labelBMFontRenderer=new cc.LabelBMFont,this.addProtectedChild(this._labelBMFontRenderer,ccui.TextBMFont.RENDERER_ZORDER,-1)},setFntFile:function(t){if(t){this._fntFileName=t,this._fntFileHasInit=!0,this._labelBMFontRenderer.initWithString(this._stringValue,t),this._updateContentSizeWithTextureSize(this._labelBMFontRenderer.getContentSize()),this._labelBMFontRendererAdaptDirty=!0;var e=this;t=e._labelBMFontRenderer,t._textureLoaded||t.addEventListener("load",function(){e.setFntFile(e._fntFileName)})}},setText:function(t){cc.log("Please use the setString"),this.setString(t)},setString:function(t){t!==this._labelBMFontRenderer.getString()&&(this._stringValue=t,this._labelBMFontRenderer.setString(t),this._fntFileHasInit&&(this._updateContentSizeWithTextureSize(this._labelBMFontRenderer.getContentSize()),this._labelBMFontRendererAdaptDirty=!0))},getString:function(){return this._stringValue},getStringLength:function(){return this._labelBMFontRenderer.getStringLength()},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this),this._labelBMFontRendererAdaptDirty=!0},_adaptRenderers:function(){this._labelBMFontRendererAdaptDirty&&(this._labelBMFontScaleChangedWithSize(),this._labelBMFontRendererAdaptDirty=!1)},getVirtualRendererSize:function(){return this._labelBMFontRenderer.getContentSize()},getVirtualRenderer:function(){return this._labelBMFontRenderer},_labelBMFontScaleChangedWithSize:function(){var t=this._labelBMFontRenderer;if(this._ignoreSize)t.setScale(1);else{var e=t.getContentSize();if(0>=e.width||0>=e.height)return void t.setScale(1);t.setScaleX(this._contentSize.width/e.width),t.setScaleY(this._contentSize.height/e.height)}t.setPosition(this._contentSize.width/2,this._contentSize.height/2)},getDescription:function(){return"TextBMFont"},_createCloneInstance:function(){return new ccui.TextBMFont},_copySpecialProperties:function(t){this.setFntFile(t._fntFileName),this.setString(t._stringValue)}}),_p=ccui.TextBMFont.prototype,cc.defineGetterSetter(_p,"string",_p.getString,_p.setString),_p=null,ccui.TextBMFont.create=function(t,e){return new ccui.TextBMFont(t,e)},ccui.TextBMFont.RENDERER_ZORDER=-1,ccui._TextFieldRenderer=cc.TextFieldTTF.extend({_maxLengthEnabled:!1,_maxLength:0,_passwordEnabled:!1,_passwordStyleText:"",_attachWithIME:!1,_detachWithIME:!1,_insertText:!1,_deleteBackward:!1,_className:"_TextFieldRenderer",ctor:function(){cc.TextFieldTTF.prototype.ctor.call(this),this._maxLengthEnabled=!1,this._maxLength=0,this._passwordEnabled=!1,this._passwordStyleText="*",this._deleteBackward=this._insertText=this._detachWithIME=this._attachWithIME=!1},onEnter:function(){cc.TextFieldTTF.prototype.onEnter.call(this),cc.TextFieldTTF.prototype.setDelegate.call(this,this)},onTextFieldAttachWithIME:function(){return this.setAttachWithIME(!0),!1},onTextFieldInsertText:function(t,e,i){return 1===i&&"\n"===e?!1:(this.setInsertText(!0),this._maxLengthEnabled&&cc.TextFieldTTF.prototype.getCharCount.call(this)>=this._maxLength)},onTextFieldDeleteBackward:function(){return this.setDeleteBackward(!0),!1},onTextFieldDetachWithIME:function(){return this.setDetachWithIME(!0),!1},insertText:function(t,e){"\n"!==t&&this._maxLengthEnabled&&this.getString().length>=this._maxLength?this._passwordEnabled&&this.setPasswordText(this.getString()):(cc.TextFieldTTF.prototype.insertText.call(this,t,e),this._passwordEnabled&&0<cc.TextFieldTTF.prototype.getCharCount.call(this)&&this.setPasswordText(this.getString()))},deleteBackward:function(){cc.TextFieldTTF.prototype.deleteBackward.call(this),0<cc.TextFieldTTF.prototype.getCharCount.call(this)&&this._passwordEnabled&&this.setPasswordText(this._inputText)},openIME:function(){cc.TextFieldTTF.prototype.attachWithIME.call(this)},closeIME:function(){cc.TextFieldTTF.prototype.detachWithIME.call(this)},setMaxLengthEnabled:function(t){this._maxLengthEnabled=t},isMaxLengthEnabled:function(){return this._maxLengthEnabled},setMaxLength:function(t){this._maxLength=t},getMaxLength:function(){return this._maxLength},getCharCount:function(){return cc.TextFieldTTF.prototype.getCharCount.call(this)},setPasswordEnabled:function(t){this._passwordEnabled=t},isPasswordEnabled:function(){return this._passwordEnabled},setPasswordStyleText:function(t){if(!(1<t.length)){var e=t.charCodeAt(0);33>e||e>126||(this._passwordStyleText=t)}},setPasswordText:function(t){var e="",i=t.length;for(t=i,this._maxLengthEnabled&&i>this._maxLength&&(t=this._maxLength),i=0;t>i;++i)e+=this._passwordStyleText;cc.LabelTTF.prototype.setString.call(this,e)},setAttachWithIME:function(t){this._attachWithIME=t},getAttachWithIME:function(){return this._attachWithIME},setDetachWithIME:function(t){this._detachWithIME=t},getDetachWithIME:function(){return this._detachWithIME},setInsertText:function(t){this._insertText=t},getInsertText:function(){return this._insertText},setDeleteBackward:function(t){this._deleteBackward=t},getDeleteBackward:function(){return this._deleteBackward},onDraw:function(){return!1}}),ccui._TextFieldRenderer.create=function(t,e,i){var n=new ccui._TextFieldRenderer;return n&&n.initWithString("",e,i)?(t&&n.setPlaceHolder(t),n):null},ccui.TextField=ccui.Widget.extend({_textFieldRenderer:null,_touchWidth:0,_touchHeight:0,_useTouchArea:!1,_textFieldEventListener:null,_textFieldEventSelector:null,_passwordStyleText:"",_textFieldRendererAdaptDirty:!0,_fontName:"",_fontSize:12,_ccEventCallback:null,ctor:function(t,e,i){ccui.Widget.prototype.ctor.call(this),e&&this.setFontName(e),i&&this.setFontSize(i),t&&this.setPlaceHolder(t)},init:function(){return ccui.Widget.prototype.init.call(this)?(this.setTouchEnabled(!0),!0):!1},onEnter:function(){ccui.Widget.prototype.onEnter.call(this),this.scheduleUpdate()},_initRenderer:function(){this._textFieldRenderer=ccui._TextFieldRenderer.create("input words here","Thonburi",20),this.addProtectedChild(this._textFieldRenderer,ccui.TextField.RENDERER_ZORDER,-1)},setTouchSize:function(t){this._touchWidth=t.width,this._touchHeight=t.height},setTouchAreaEnabled:function(t){this._useTouchArea=t},hitTest:function(t){if(this._useTouchArea){t=this.convertToNodeSpace(t);var e=cc.rect(-this._touchWidth*this._anchorPoint.x,-this._touchHeight*this._anchorPoint.y,this._touchWidth,this._touchHeight);return t.x>=e.x&&t.x<=e.x+e.width&&t.y>=e.y&&t.y<=e.y+e.height}return ccui.Widget.prototype.hitTest.call(this,t)},getTouchSize:function(){return cc.size(this._touchWidth,this._touchHeight)},setText:function(t){cc.log("Please use the setString"),this.setString(t)},setString:function(t){null!=t&&(t=String(t),this.isMaxLengthEnabled()&&(t=t.substr(0,this.getMaxLength())),this.isPasswordEnabled()?(this._textFieldRenderer.setPasswordText(t),this._textFieldRenderer.setString(""),this._textFieldRenderer.insertText(t,t.length)):this._textFieldRenderer.setString(t),this._textFieldRendererAdaptDirty=!0,this._updateContentSizeWithTextureSize(this._textFieldRenderer.getContentSize()))},setPlaceHolder:function(t){this._textFieldRenderer.setPlaceHolder(t),this._textFieldRendererAdaptDirty=!0,this._updateContentSizeWithTextureSize(this._textFieldRenderer.getContentSize())},getPlaceHolder:function(){return this._textFieldRenderer.getPlaceHolder()},getPlaceHolderColor:function(){return this._textFieldRenderer.getPlaceHolderColor()},setPlaceHolderColor:function(t){this._textFieldRenderer.setColorSpaceHolder(t)},setTextColor:function(t){this._textFieldRenderer.setTextColor(t)},setFontSize:function(t){this._textFieldRenderer.setFontSize(t),this._fontSize=t,this._textFieldRendererAdaptDirty=!0,this._updateContentSizeWithTextureSize(this._textFieldRenderer.getContentSize())},getFontSize:function(){return this._fontSize},setFontName:function(t){this._textFieldRenderer.setFontName(t),this._fontName=t,this._textFieldRendererAdaptDirty=!0,this._updateContentSizeWithTextureSize(this._textFieldRenderer.getContentSize())},getFontName:function(){return this._fontName},didNotSelectSelf:function(){this._textFieldRenderer.detachWithIME()},getStringValue:function(){return cc.log("Please use the getString"),this.getString()},getString:function(){return this._textFieldRenderer.getString()},getStringLength:function(){return this._textFieldRenderer.getStringLength()},onTouchBegan:function(t,e){var i=this,n=ccui.Widget.prototype.onTouchBegan.call(i,t,e);return i._hit?setTimeout(function(){i._textFieldRenderer.attachWithIME()},0):setTimeout(function(){i._textFieldRenderer.detachWithIME()},0),n},setMaxLengthEnabled:function(t){this._textFieldRenderer.setMaxLengthEnabled(t)},isMaxLengthEnabled:function(){return this._textFieldRenderer.isMaxLengthEnabled()},setMaxLength:function(t){this._textFieldRenderer.setMaxLength(t),this.setString(this.getString())},getMaxLength:function(){return this._textFieldRenderer.getMaxLength()},setPasswordEnabled:function(t){this._textFieldRenderer.setPasswordEnabled(t)},isPasswordEnabled:function(){return this._textFieldRenderer.isPasswordEnabled()},setPasswordStyleText:function(t){this._textFieldRenderer.setPasswordStyleText(t),this._passwordStyleText=t,this.setString(this.getString())},getPasswordStyleText:function(){return this._passwordStyleText},update:function(){this.getDetachWithIME()&&(this._detachWithIMEEvent(),this.setDetachWithIME(!1)),this.getAttachWithIME()&&(this._attachWithIMEEvent(),this.setAttachWithIME(!1)),this.getInsertText()&&(this._textFieldRendererAdaptDirty=!0,this._updateContentSizeWithTextureSize(this._textFieldRenderer.getContentSize()),this._insertTextEvent(),this.setInsertText(!1)),this.getDeleteBackward()&&(this._textFieldRendererAdaptDirty=!0,this._updateContentSizeWithTextureSize(this._textFieldRenderer.getContentSize()),this._deleteBackwardEvent(),this.setDeleteBackward(!1))},getAttachWithIME:function(){return this._textFieldRenderer.getAttachWithIME()},setAttachWithIME:function(t){this._textFieldRenderer.setAttachWithIME(t)},getDetachWithIME:function(){return this._textFieldRenderer.getDetachWithIME()},setDetachWithIME:function(t){this._textFieldRenderer.setDetachWithIME(t)},getInsertText:function(){return this._textFieldRenderer.getInsertText()},setInsertText:function(t){this._textFieldRenderer.setInsertText(t)},getDeleteBackward:function(){return this._textFieldRenderer.getDeleteBackward()},setDeleteBackward:function(t){this._textFieldRenderer.setDeleteBackward(t)},_attachWithIMEEvent:function(){this._textFieldEventSelector&&(this._textFieldEventListener?this._textFieldEventSelector.call(this._textFieldEventListener,this,ccui.TextField.EVENT_ATTACH_WITH_IME):this._textFieldEventSelector(this,ccui.TextField.EVENT_ATTACH_WITH_IME)),this._ccEventCallback&&this._ccEventCallback(this,ccui.TextField.EVENT_ATTACH_WITH_IME)},_detachWithIMEEvent:function(){this._textFieldEventSelector&&(this._textFieldEventListener?this._textFieldEventSelector.call(this._textFieldEventListener,this,ccui.TextField.EVENT_DETACH_WITH_IME):this._textFieldEventSelector(this,ccui.TextField.EVENT_DETACH_WITH_IME)),this._ccEventCallback&&this._ccEventCallback(this,ccui.TextField.EVENT_DETACH_WITH_IME)},_insertTextEvent:function(){this._textFieldEventSelector&&(this._textFieldEventListener?this._textFieldEventSelector.call(this._textFieldEventListener,this,ccui.TextField.EVENT_INSERT_TEXT):this._textFieldEventSelector(this,ccui.TextField.EVENT_INSERT_TEXT)),this._ccEventCallback&&this._ccEventCallback(this,ccui.TextField.EVENT_INSERT_TEXT)
},_deleteBackwardEvent:function(){this._textFieldEventSelector&&(this._textFieldEventListener?this._textFieldEventSelector.call(this._textFieldEventListener,this,ccui.TextField.EVENT_DELETE_BACKWARD):this._textFieldEventSelector(this,ccui.TextField.EVENT_DELETE_BACKWARD)),this._ccEventCallback&&this._ccEventCallback(this,ccui.TextField.EVENT_DELETE_BACKWARD)},addEventListenerTextField:function(t,e){this.addEventListener(t,e)},addEventListener:function(t,e){this._textFieldEventSelector=t,this._textFieldEventListener=e},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this),this._textFieldRendererAdaptDirty=!0},_adaptRenderers:function(){this._textFieldRendererAdaptDirty&&(this._textfieldRendererScaleChangedWithSize(),this._textFieldRendererAdaptDirty=!1)},_textfieldRendererScaleChangedWithSize:function(){this._ignoreSize||this._textFieldRenderer.setDimensions(this._contentSize),this._textFieldRenderer.setPosition(this._contentSize.width/2,this._contentSize.height/2)},getAutoRenderSize:function(){var t=this._textFieldRenderer.getContentSize();return this._ignoreSize||(this._textFieldRenderer.setDimensions(0,0),t=this._textFieldRenderer.getContentSize(),this._textFieldRenderer.setDimensions(this._contentSize.width,this._contentSize.height)),t},getVirtualRendererSize:function(){return this._textFieldRenderer.getContentSize()},getVirtualRenderer:function(){return this._textFieldRenderer},getDescription:function(){return"TextField"},attachWithIME:function(){this._textFieldRenderer.attachWithIME()},_createCloneInstance:function(){return new ccui.TextField},_copySpecialProperties:function(t){this.setString(t._textFieldRenderer.getString()),this.setPlaceHolder(t.getString()),this.setFontSize(t._textFieldRenderer.getFontSize()),this.setFontName(t._textFieldRenderer.getFontName()),this.setMaxLengthEnabled(t.isMaxLengthEnabled()),this.setMaxLength(t.getMaxLength()),this.setPasswordEnabled(t.isPasswordEnabled()),this.setPasswordStyleText(t._passwordStyleText),this.setAttachWithIME(t.getAttachWithIME()),this.setDetachWithIME(t.getDetachWithIME()),this.setInsertText(t.getInsertText()),this.setDeleteBackward(t.getDeleteBackward()),this._ccEventCallback=t._ccEventCallback,this._textFieldEventListener=t._textFieldEventListener,this._textFieldEventSelector=t._textFieldEventSelector},setTextAreaSize:function(t){this.setContentSize(t)},setTextHorizontalAlignment:function(t){this._textFieldRenderer.setHorizontalAlignment(t)},setTextVerticalAlignment:function(t){this._textFieldRenderer.setVerticalAlignment(t)},_setFont:function(t){this._textFieldRenderer._setFont(t),this._textFieldRendererAdaptDirty=!0},_getFont:function(){return this._textFieldRenderer._getFont()},_changePosition:function(){this._adaptRenderers()}}),ccui.TextField.create=function(t,e,i){return new ccui.TextField(t,e,i)},_p=ccui.TextField.prototype,cc.defineGetterSetter(_p,"string",_p.getString,_p.setString),cc.defineGetterSetter(_p,"placeHolder",_p.getPlaceHolder,_p.setPlaceHolder),cc.defineGetterSetter(_p,"font",_p._getFont,_p._setFont),cc.defineGetterSetter(_p,"fontSize",_p.getFontSize,_p.setFontSize),cc.defineGetterSetter(_p,"fontName",_p.getFontName,_p.setFontName),cc.defineGetterSetter(_p,"maxLengthEnabled",_p.isMaxLengthEnabled,_p.setMaxLengthEnabled),cc.defineGetterSetter(_p,"maxLength",_p.getMaxLength,_p.setMaxLength),cc.defineGetterSetter(_p,"passwordEnabled",_p.isPasswordEnabled,_p.setPasswordEnabled),_p=null,ccui.TextField.EVENT_ATTACH_WITH_IME=0,ccui.TextField.EVENT_DETACH_WITH_IME=1,ccui.TextField.EVENT_INSERT_TEXT=2,ccui.TextField.EVENT_DELETE_BACKWARD=3,ccui.TextField.RENDERER_ZORDER=-1,ccui.VideoPlayer=ccui.Widget.extend({_played:!1,_playing:!1,_stopped:!0,ctor:function(t){ccui.Widget.prototype.ctor.call(this),this._EventList={},t&&this.setURL(t)},_createRenderCmd:function(){return new ccui.VideoPlayer.RenderCmd(this)},setURL:function(t){this._renderCmd.updateURL(t)},getURL:function(){return this._renderCmd._url},play:function(){var t=this,e=this._renderCmd._video;e&&(this._played=!0,e.pause(),(!1!==this._stopped||!1!==this._playing||!0!==this._played)&&(e.currentTime=0),ccui.VideoPlayer._polyfill.autoplayAfterOperation?setTimeout(function(){e.play(),t._playing=!0,t._stopped=!1},20):(e.play(),this._playing=!0,this._stopped=!1))},pause:function(){var t=this._renderCmd._video;t&&!0===this._playing&&!1===this._stopped&&(t.pause(),this._playing=!1)},resume:function(){!1===this._stopped&&!1===this._playing&&!0===this._played&&this.play()},stop:function(){var t=this,e=this._renderCmd._video;e&&(e.pause(),e.currentTime=0,this._playing=!1,this._stopped=!0),setTimeout(function(){t._dispatchEvent(ccui.VideoPlayer.EventType.STOPPED)},0)},seekTo:function(t){var e=this._renderCmd._video;e&&(e.currentTime=t,ccui.VideoPlayer._polyfill.autoplayAfterOperation&&this.isPlaying()&&setTimeout(function(){e.play()},20))},isPlaying:function(){return ccui.VideoPlayer._polyfill.autoplayAfterOperation&&this._playing&&setTimeout(function(){video.play()},20),this._playing},setKeepAspectRatioEnabled:function(){cc.log("On the web is always keep the aspect ratio")},isKeepAspectRatioEnabled:function(){return!1},setFullScreenEnabled:function(t){var e=this._renderCmd._video;e&&(t?cc.screen.requestFullScreen(e):cc.screen.exitFullScreen(e))},isFullScreenEnabled:function(){cc.log("Can't know status")},setEventListener:function(t,e){this._EventList[t]=e},removeEventListener:function(t){this._EventList[t]=null},_dispatchEvent:function(t){(t=this._EventList[t])&&t.call(this,this,this._renderCmd._video.src)},onPlayEvent:function(){var t=this._EventList[ccui.VideoPlayer.EventType.PLAYING];if(t)for(var e=0;e<t.length;e++)t[e].call(this,this,this._renderCmd._video.src)},setContentSize:function(t,e){ccui.Widget.prototype.setContentSize.call(this,t,e),void 0===e&&(e=t.height,t=t.width),this._renderCmd.changeSize(t,e)},cleanup:function(){this._renderCmd.removeDom(),this.stopAllActions(),this.unscheduleAllCallbacks()}}),ccui.VideoPlayer.EventType={PLAYING:"play",PAUSED:"pause",STOPPED:"stop",COMPLETED:"complete"},function(t){t._polyfill={devicePixelRatio:!1,event:"canplay",canPlayType:[]};var e=document.createElement("video");e.canPlayType("video/ogg")&&(t._polyfill.canPlayType.push(".ogg"),t._polyfill.canPlayType.push(".ogv")),e.canPlayType("video/mp4")&&t._polyfill.canPlayType.push(".mp4"),e.canPlayType("video/webm")&&t._polyfill.canPlayType.push(".webm"),cc.sys.OS_IOS===cc.sys.os&&(t._polyfill.devicePixelRatio=!0,t._polyfill.event="progress"),cc.sys.browserType===cc.sys.BROWSER_TYPE_FIREFOX&&(t._polyfill.autoplayAfterOperation=!0),t=document.createElement("style"),t.innerHTML=".cocosVideo:-moz-full-screen{transform:matrix(1,0,0,1,0,0) !important;}.cocosVideo:full-screen{transform:matrix(1,0,0,1,0,0) !important;}.cocosVideo:-webkit-full-screen{transform:matrix(1,0,0,1,0,0) !important;}",document.head.appendChild(t)}(ccui.VideoPlayer),function(t){ccui.VideoPlayer.RenderCmd=function(t){cc.Node.CanvasRenderCmd.call(this,t),this._listener=null,this._url="",this.initStyle()};var e=ccui.VideoPlayer.RenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);e.constructor=ccui.VideoPlayer.RenderCmd,e.visit=function(){var t=this,e=cc.container,i=cc.eventManager;if(this._node._visible)e.appendChild(this._video),null===this._listener&&(this._listener=cc.eventManager.addCustomListener(cc.game.EVENT_RESIZE,function(){t.resize()}));else{var n=!1;(n="contains"in e?e.contains(this._video):e.compareDocumentPosition(this._video)%16)&&e.removeChild(this._video),e=i._listenersMap[cc.game.EVENT_RESIZE].getFixedPriorityListeners(),i._removeListenerInVector(e,this._listener),this._listener=null}this.updateStatus()},e.updateStatus=function(){t.devicePixelRatio=cc.view.isRetinaEnabled(),this._dirtyFlag&cc.Node._dirtyFlags.transformDirty&&(this.transform(this.getParentRenderCmd(),!0),this.updateMatrix(this._worldTransform,cc.view._scaleX,cc.view._scaleY),this._dirtyFlag^=this._dirtyFlag&cc.Node._dirtyFlags.transformDirty)},e.resize=function(t){t=t||cc.view;var e=this._node,i=cc.eventManager;e._parent&&e._visible?this.updateMatrix(this._worldTransform,t._scaleX,t._scaleY):(t=i._listenersMap[cc.game.EVENT_RESIZE].getFixedPriorityListeners(),i._removeListenerInVector(t,this._listener),this._listener=null)},e.updateMatrix=function(e,i,n){var r=this._node;if(t.devicePixelRatio){var o=window.devicePixelRatio;i/=o,n/=o}if(!1!==this._loaded){var o=r._contentSize.width,s=r._contentSize.height;e="matrix("+e.a*i+","+e.b+","+e.c+","+e.d*n+","+(e.tx*i-o/2+o*r._scaleX/2*i)+","+-(e.ty*n-s/2+s*r._scaleY/2*n)+")",this._video.style.transform=e,this._video.style["-webkit-transform"]=e}},e.updateURL=function(e){var i,n,r,o=this._node;if(this._url!=e){this._url=e,cc.loader.resPath&&!/^http/.test(e)&&(e=cc.path.join(cc.loader.resPath,e)),i=!1,r=cc.container,(i="contains"in r?r.contains(this._video):r.compareDocumentPosition(this._video)%16)&&r.removeChild(this._video),n=this._video=document.createElement("video"),this.bindEvent();var s=this,c=function(){1!=s._loaded&&(s._loaded=!0,s.changeSize(),s.setDirtyFlag(cc.Node._dirtyFlags.transformDirty),n.removeEventListener(t.event,c),n.currentTime=0,n.style.visibility="visible",n.play(),o._played||(n.pause(),n.currentTime=0))};n.addEventListener(t.event,c),n.preload="metadata",n.style.visibility="hidden",this._loaded=!1,o._played=!1,o._playing=!1,o._stopped=!0,this.initStyle(),this.visit(),i=document.createElement("source"),i.src=e,n.appendChild(i),r=cc.path.extname(e);for(var a=0;a<t.canPlayType.length;a++)r!==t.canPlayType[a]&&(i=document.createElement("source"),i.src=e.replace(r,t.canPlayType[a]),n.appendChild(i))}},e.bindEvent=function(){var t=this,e=this._node,i=this._video;i.addEventListener("ended",function(){e._renderCmd.updateMatrix(t._worldTransform,cc.view._scaleX,cc.view._scaleY),e._playing=!1,e._dispatchEvent(ccui.VideoPlayer.EventType.COMPLETED)}),i.addEventListener("play",function(){e._dispatchEvent(ccui.VideoPlayer.EventType.PLAYING)}),i.addEventListener("pause",function(){e._dispatchEvent(ccui.VideoPlayer.EventType.PAUSED)})},e.initStyle=function(){if(this._video){var t=this._video;t.style.position="absolute",t.style.bottom="0px",t.style.left="0px",t.className="cocosVideo"}},e.changeSize=function(t,e){var i=this._node._contentSize;t=t||i.width,e=e||i.height,(i=this._video)&&(0!==t&&(i.width=t),0!==e&&(i.height=e))},e.removeDom=function(){var t=this._video;if(t){var e=!1;(e="contains"in cc.container?cc.container.contains(t):cc.container.compareDocumentPosition(t)%16)&&cc.container.removeChild(t)}}}(ccui.VideoPlayer._polyfill),ccui.RichElement=ccui.Class.extend({_type:0,_tag:0,_color:null,_opacity:0,ctor:function(){this._tag=this._type=0,this._color=cc.color(255,255,255,255)},init:function(t,e,i){this._tag=t,this._color.r=e.r,this._color.g=e.g,this._color.b=e.b,this._opacity=i,this._color.a=void 0===i?e.a:i}}),ccui.RichElementText=ccui.RichElement.extend({_text:"",_fontName:"",_fontSize:0,_fontDefinition:null,ctor:function(t,e,i,n,r,o){ccui.RichElement.prototype.ctor.call(this),this._type=ccui.RichElement.TEXT,this._fontName=this._text="",this._fontSize=0,e&&e instanceof cc.FontDefinition?this.initWithStringAndTextDefinition(t,n,e,i):o&&this.init(t,e,i,n,r,o)},init:function(t,e,i,n,r,o){ccui.RichElement.prototype.init.call(this,t,e,i),this._text=n,this._fontName=r,this._fontSize=o},initWithStringAndTextDefinition:function(t,e,i,n){ccui.RichElement.prototype.init.call(this,t,i.fillStyle,n),this._fontDefinition=i,this._text=e,this._fontName=i.fontName,this._fontSize=i.fontSize}}),ccui.RichElementText.create=function(t,e,i,n,r,o){return new ccui.RichElementText(t,e,i,n,r,o)},ccui.RichElementImage=ccui.RichElement.extend({_filePath:"",_textureRect:null,_textureType:0,ctor:function(t,e,i,n){ccui.RichElement.prototype.ctor.call(this),this._type=ccui.RichElement.IMAGE,this._filePath="",this._textureRect=cc.rect(0,0,0,0),this._textureType=0,void 0!==n&&this.init(t,e,i,n)},init:function(t,e,i,n){ccui.RichElement.prototype.init.call(this,t,e,i),this._filePath=n}}),ccui.RichElementImage.create=function(t,e,i,n){return new ccui.RichElementImage(t,e,i,n)},ccui.RichElementCustomNode=ccui.RichElement.extend({_customNode:null,ctor:function(t,e,i,n){ccui.RichElement.prototype.ctor.call(this),this._type=ccui.RichElement.CUSTOM,this._customNode=null,void 0!==n&&this.init(t,e,i,n)},init:function(t,e,i,n){ccui.RichElement.prototype.init.call(this,t,e,i),this._customNode=n}}),ccui.RichElementCustomNode.create=function(t,e,i,n){return new ccui.RichElementCustomNode(t,e,i,n)},ccui.RichText=ccui.Widget.extend({_formatTextDirty:!1,_richElements:null,_elementRenders:null,_leftSpaceWidth:0,_verticalSpace:0,_elementRenderersContainer:null,_lineBreakOnSpace:!1,_textHorizontalAlignment:null,_textVerticalAlignment:null,ctor:function(){ccui.Widget.prototype.ctor.call(this),this._formatTextDirty=!1,this._richElements=[],this._elementRenders=[],this._verticalSpace=this._leftSpaceWidth=0,this._textHorizontalAlignment=cc.TEXT_ALIGNMENT_LEFT,this._textVerticalAlignment=cc.VERTICAL_TEXT_ALIGNMENT_TOP},_initRenderer:function(){this._elementRenderersContainer=new cc.Node,this._elementRenderersContainer.setAnchorPoint(.5,.5),this.addProtectedChild(this._elementRenderersContainer,0,-1)},insertElement:function(t,e){this._richElements.splice(e,0,t),this._formatTextDirty=!0},pushBackElement:function(t){this._richElements.push(t),this._formatTextDirty=!0},removeElement:function(t){cc.isNumber(t)?this._richElements.splice(t,1):cc.arrayRemoveObject(this._richElements,t),this._formatTextDirty=!0},formatText:function(){if(this._formatTextDirty){this._elementRenderersContainer.removeAllChildren(),this._elementRenders.length=0;var t,e,i=this._richElements;if(this._ignoreSize)for(this._addNewLine(),t=0;t<i.length;t++){e=i[t];var n=null;switch(e._type){case ccui.RichElement.TEXT:n=e._fontDefinition?new cc.LabelTTF(e._text,e._fontDefinition):new cc.LabelTTF(e._text,e._fontName,e._fontSize);break;case ccui.RichElement.IMAGE:n=new cc.Sprite(e._filePath);break;case ccui.RichElement.CUSTOM:n=e._customNode}n.setColor(e._color),n.setOpacity(e._color.a),this._pushToContainer(n)}else for(this._addNewLine(),t=0;t<i.length;t++)switch(e=i[t],e._type){case ccui.RichElement.TEXT:e._fontDefinition?this._handleTextRenderer(e._text,e._fontDefinition,e._fontDefinition.fontSize,e._fontDefinition.fillStyle):this._handleTextRenderer(e._text,e._fontName,e._fontSize,e._color);break;case ccui.RichElement.IMAGE:this._handleImageRenderer(e._filePath,e._color,e._color.a);break;case ccui.RichElement.CUSTOM:this._handleCustomRenderer(e._customNode)}this.formatRenderers(),this._formatTextDirty=!1}},_handleTextRenderer:function(t,e,i,n){if(""!==t)if("\n"===t)this._addNewLine();else{var r=e instanceof cc.FontDefinition?new cc.LabelTTF(t,e):new cc.LabelTTF(t,e,i),o=r.getContentSize().width;if(this._leftSpaceWidth-=o,0>this._leftSpaceWidth){var r=t.length*(1- -this._leftSpaceWidth/o),o=t.substr(0,r),s=t.substr(r,t.length-1),c=r>0;this._lineBreakOnSpace&&(s=o.lastIndexOf(" "),r=-1===s?r:s+1,s=t.substr(r,t.length-1),c=r>0&&" "!==s),c&&(t=null,e instanceof cc.FontDefinition?(t=new cc.LabelTTF(o.substr(0,r),e),t.setOpacity(e.fillStyle.a)):(t=new cc.LabelTTF(o.substr(0,r),e,i),t.setColor(n),t.setOpacity(n.a)),this._pushToContainer(t)),this._addNewLine(),this._handleTextRenderer(s,e,i,n)}else e instanceof cc.FontDefinition?r.setOpacity(e.fillStyle.a):(r.setColor(n),r.setOpacity(n.a)),this._pushToContainer(r)}},_handleImageRenderer:function(t){t=new cc.Sprite(t),this._handleCustomRenderer(t)},_handleCustomRenderer:function(t){var e=t.getContentSize();this._leftSpaceWidth-=e.width,0>this._leftSpaceWidth?(this._addNewLine(),this._pushToContainer(t),this._leftSpaceWidth-=e.width):this._pushToContainer(t)},_addNewLine:function(){this._leftSpaceWidth=this._customSize.width,this._elementRenders.push([])},formatRenderers:function(){var t,e,i,n,r,o,s=0,c=this._elementRenderersContainer,a=this._elementRenders;if(this._ignoreSize){for(t=0,i=a[0],e=n=0;e<i.length;e++)r=i[e],r.setAnchorPoint(cc.p(0,0)),r.setPosition(n,0),c.addChild(r,1,e),o=r.getLineHeight?r.getLineHeight():s,r=r.getContentSize(),t+=r.width,s=Math.max(Math.min(s,o),r.height),n+=r.width;if(this._textHorizontalAlignment!==cc.TEXT_ALIGNMENT_LEFT)for(o=0,this._textHorizontalAlignment===cc.TEXT_ALIGNMENT_RIGHT?o=this._contentSize.width-n:this._textHorizontalAlignment===cc.TEXT_ALIGNMENT_CENTER&&(o=(this._contentSize.width-n)/2),e=0;e<i.length;e++)i[e].x+=o;c.setContentSize(t,s)}else{var l=[];for(t=0;t<a.length;t++){for(i=a[t],e=n=0;e<i.length;e++)r=i[e],o=r.getLineHeight?r.getLineHeight():r.getContentSize().height,n=Math.max(Math.min(r.getContentSize().height,o),n);l[t]=n,s+=l[t]}var h=this._customSize.height;for(t=0;t<a.length;t++){for(i=a[t],n=0,h-=l[t]+this._verticalSpace,e=0;e<i.length;e++)r=i[e],r.setAnchorPoint(cc.p(0,0)),r.setPosition(cc.p(n,h)),c.addChild(r,1),n+=r.getContentSize().width;if(this._textHorizontalAlignment!==cc.TEXT_ALIGNMENT_LEFT||this._textVerticalAlignment!==cc.VERTICAL_TEXT_ALIGNMENT_TOP)for(o=0,this._textHorizontalAlignment===cc.TEXT_ALIGNMENT_RIGHT?o=this._contentSize.width-n:this._textHorizontalAlignment===cc.TEXT_ALIGNMENT_CENTER&&(o=(this._contentSize.width-n)/2),n=0,this._textVerticalAlignment===cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM?n=this._customSize.height-s:this._textVerticalAlignment===cc.VERTICAL_TEXT_ALIGNMENT_CENTER&&(n=(this._customSize.height-s)/2),e=0;e<i.length;e++)r=i[e],r.x+=o,r.y-=n}c.setContentSize(this._contentSize)}for(s=a.length,t=0;s>t;t++)a[t].length=0;this._elementRenders.length=0,this.setContentSize(this._ignoreSize?this.getVirtualRendererSize():this._customSize),this._updateContentSizeWithTextureSize(this._contentSize),c.setPosition(.5*this._contentSize.width,.5*this._contentSize.height)},_pushToContainer:function(t){0>=this._elementRenders.length||this._elementRenders[this._elementRenders.length-1].push(t)},_adaptRenderers:function(){this.formatText()},setVerticalSpace:function(t){this._verticalSpace=t},setAnchorPoint:function(t){ccui.Widget.prototype.setAnchorPoint.call(this,t),this._elementRenderersContainer.setAnchorPoint(t)},_setAnchorX:function(t){ccui.Widget.prototype._setAnchorX.call(this,t),this._elementRenderersContainer._setAnchorX(t)},_setAnchorY:function(t){ccui.Widget.prototype._setAnchorY.call(this,t),this._elementRenderersContainer._setAnchorY(t)},getVirtualRendererSize:function(){return this._elementRenderersContainer.getContentSize()},ignoreContentAdaptWithSize:function(t){this._ignoreSize!==t&&(this._formatTextDirty=!0,ccui.Widget.prototype.ignoreContentAdaptWithSize.call(this,t))},getContentSize:function(){return this.formatText(),cc.Node.prototype.getContentSize.call(this)},_getWidth:function(){return this.formatText(),cc.Node.prototype._getWidth.call(this)},_getHeight:function(){return this.formatText(),cc.Node.prototype._getHeight.call(this)},setContentSize:function(t,e){ccui.Widget.prototype.setContentSize.call(this,void 0===e?t.width:t,void 0===e?t.height:e),this._formatTextDirty=!0},getDescription:function(){return"RichText"},setCascadeOpacityEnabled:function(t){this._super(t),this._elementRenderersContainer.setCascadeOpacityEnabled(t)},setLineBreakOnSpace:function(t){this._lineBreakOnSpace=t,this._formatTextDirty=!0,this.formatText()},setTextHorizontalAlignment:function(t){t!==this._textHorizontalAlignment&&(this._textHorizontalAlignment=t,this.formatText())},setTextVerticalAlignment:function(t){t!==this._textVerticalAlignment&&(this._textVerticalAlignment=t,this.formatText())}}),ccui.RichText.create=function(){return new ccui.RichText},ccui.RichElement.TEXT=0,ccui.RichElement.IMAGE=1,ccui.RichElement.CUSTOM=2,ccui.WebView=ccui.Widget.extend({ctor:function(t){ccui.Widget.prototype.ctor.call(this),this._EventList={},t&&this.loadURL(t)},setJavascriptInterfaceScheme:function(){},loadData:function(){},loadHTMLString:function(){},loadURL:function(t){this._renderCmd.updateURL(t),this._dispatchEvent(ccui.WebView.EventType.LOADING)},stopLoading:function(){cc.log("Web does not support loading")},reload:function(){var t=this._renderCmd._iframe;t&&(t=t.contentWindow)&&t.location&&t.location.reload()},canGoBack:function(){return cc.log("Web does not support query history"),!0},canGoForward:function(){return cc.log("Web does not support query history"),!0},goBack:function(){try{if(ccui.WebView._polyfill.closeHistory)return cc.log("The current browser does not support the GoBack");var t=this._renderCmd._iframe;if(t){var e=t.contentWindow;e&&e.location&&e.history.back.call(e)}}catch(i){cc.log(i)}},goForward:function(){try{if(ccui.WebView._polyfill.closeHistory)return cc.log("The current browser does not support the GoForward");var t=this._renderCmd._iframe;if(t){var e=t.contentWindow;e&&e.location&&e.history.forward.call(e)}}catch(i){cc.log(i)}},evaluateJS:function(t){var e=this._renderCmd._iframe;if(e){e=e.contentWindow;try{e.eval(t),this._dispatchEvent(ccui.WebView.EventType.JS_EVALUATED)}catch(i){console.error(i)}}},setScalesPageToFit:function(){cc.log("Web does not support zoom")},setEventListener:function(t,e){this._EventList[t]=e},removeEventListener:function(t){this._EventList[t]=null},_dispatchEvent:function(t){(t=this._EventList[t])&&t.call(this,this,this._renderCmd._iframe.src)},_createRenderCmd:function(){return new ccui.WebView.RenderCmd(this)},setContentSize:function(t,e){ccui.Widget.prototype.setContentSize.call(this,t,e),void 0===e&&(e=t.height,t=t.width),this._renderCmd.changeSize(t,e)},cleanup:function(){this._renderCmd.removeDom(),this.stopAllActions(),this.unscheduleAllCallbacks()}}),ccui.WebView.EventType={LOADING:"loading",LOADED:"load",ERROR:"error",JS_EVALUATED:"js"},function(){var t=ccui.WebView._polyfill={devicePixelRatio:!1,enableDiv:!1};cc.sys.os===cc.sys.OS_IOS&&(t.enableDiv=!0),cc.sys.isMobile?cc.sys.browserType===cc.sys.BROWSER_TYPE_FIREFOX&&(t.enableBG=!0):cc.sys.browserType===cc.sys.BROWSER_TYPE_IE&&(t.closeHistory=!0)}(),function(t){ccui.WebView.RenderCmd=function(e){cc.Node.CanvasRenderCmd.call(this,e),this._iframe=this._div=null,t.enableDiv?(this._div=document.createElement("div"),this._div.style["-webkit-overflow"]="auto",this._div.style["-webkit-overflow-scrolling"]="touch",this._iframe=document.createElement("iframe"),this._div.appendChild(this._iframe)):this._div=this._iframe=document.createElement("iframe"),t.enableBG&&(this._div.style.background="#FFF"),this._iframe.addEventListener("load",function(){e._dispatchEvent(ccui.WebView.EventType.LOADED)}),this._iframe.addEventListener("error",function(){e._dispatchEvent(ccui.WebView.EventType.ERROR)}),this._div.style.background="#FFF",this._div.style.height="200px",this._div.style.width="300px",this._div.style.overflow="scroll",this._listener=null,this.initStyle()};var e=ccui.WebView.RenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);e.constructor=ccui.WebView.RenderCmd,e.updateStatus=function(){t.devicePixelRatio=cc.view.isRetinaEnabled(),this._dirtyFlag&cc.Node._dirtyFlags.transformDirty&&(this.transform(this.getParentRenderCmd(),!0),this.updateMatrix(this._worldTransform,cc.view._scaleX,cc.view._scaleY),this._dirtyFlag^=this._dirtyFlag&cc.Node._dirtyFlags.transformDirty)},e.visit=function(){var t=this,e=cc.container,i=cc.eventManager;if(this._node._visible)e.appendChild(this._div),null===this._listener&&(this._listener=i.addCustomListener(cc.game.EVENT_RESIZE,function(){t.resize()}));else{var n=!1;(n="contains"in e?e.contains(this._div):e.compareDocumentPosition(this._div)%16)&&e.removeChild(this._div),e=i._listenersMap[cc.game.EVENT_RESIZE].getFixedPriorityListeners(),i._removeListenerInVector(e,this._listener),this._listener=null}this.updateStatus(),this.resize(cc.view)},e.resize=function(t){t=t||cc.view;var e=this._node,i=cc.eventManager;e._parent&&e._visible?this.updateMatrix(this._worldTransform,t._scaleX,t._scaleY):(t=i._listenersMap[cc.game.EVENT_RESIZE].getFixedPriorityListeners(),i._removeListenerInVector(t,this._listener),this._listener=null)},e.updateMatrix=function(e,i,n){var r=this._node;if(t.devicePixelRatio&&1!==i&&1!==i){var o=window.devicePixelRatio;i/=o,n/=o}if(!1!==this._loaded){var o=r._contentSize.width,s=r._contentSize.height;e="matrix("+e.a*i+","+e.b+","+e.c+","+e.d*n+","+(e.tx*i-o/2+o*r._scaleX/2*i)+","+-(e.ty*n-s/2+s*r._scaleY/2*n)+")",this._div.style.transform=e,this._div.style["-webkit-transform"]=e}},e.initStyle=function(){if(this._div){var t=this._div;t.style.position="absolute",t.style.bottom="0px",t.style.left="0px"}},e.updateURL=function(t){var e=this._iframe;e.src=t;var i=this,n=function(){i._loaded=!0,e.removeEventListener("load",n)};e.addEventListener("load",n)},e.changeSize=function(t,e){var i=this._div;i&&(i.style.width=t+"px",i.style.height=e+"px")},e.removeDom=function(){var t=this._div;if(t){var e=!1;(e="contains"in cc.container?cc.container.contains(t):cc.container.compareDocumentPosition(t)%16)&&cc.container.removeChild(t)}}}(ccui.WebView._polyfill),ccui.ScrollView=ccui.Layout.extend({_innerContainer:null,direction:null,_autoScrollDir:null,_topBoundary:0,_bottomBoundary:0,_leftBoundary:0,_rightBoundary:0,_bounceTopBoundary:0,_bounceBottomBoundary:0,_bounceLeftBoundary:0,_bounceRightBoundary:0,_autoScroll:!1,_autoScrollAddUpTime:0,_autoScrollOriginalSpeed:0,_autoScrollAcceleration:0,_isAutoScrollSpeedAttenuated:!1,_needCheckAutoScrollDestination:!1,_autoScrollDestination:null,_bePressed:!1,_slidTime:0,_moveChildPoint:null,_childFocusCancelOffset:0,_leftBounceNeeded:!1,_topBounceNeeded:!1,_rightBounceNeeded:!1,_bottomBounceNeeded:!1,bounceEnabled:!1,_bouncing:!1,_bounceDir:null,_bounceOriginalSpeed:0,inertiaScrollEnabled:!1,_scrollViewEventListener:null,_scrollViewEventSelector:null,_className:"ScrollView",ctor:function(){ccui.Layout.prototype.ctor.call(this),this.direction=ccui.ScrollView.DIR_NONE,this._autoScrollDir=cc.p(0,0),this._autoScrollAcceleration=-1e3,this._autoScrollDestination=cc.p(0,0),this._slidTime=0,this._moveChildPoint=cc.p(0,0),this._childFocusCancelOffset=5,this._bounceDir=cc.p(0,0),this._bounceOriginalSpeed=0,this.inertiaScrollEnabled=!0,this.setTouchEnabled(!0)},init:function(){return ccui.Layout.prototype.init.call(this)?(this.setClippingEnabled(!0),this._innerContainer.setTouchEnabled(!1),!0):!1},onEnter:function(){ccui.Layout.prototype.onEnter.call(this),this.scheduleUpdate(!0)},findNextFocusedWidget:function(t,e){return this.getLayoutType()===ccui.Layout.LINEAR_VERTICAL||this.getLayoutType()===ccui.Layout.LINEAR_HORIZONTAL?this._innerContainer.findNextFocusedWidget(t,e):ccui.Widget.prototype.findNextFocusedWidget.call(this,t,e)},_initRenderer:function(){ccui.Layout.prototype._initRenderer.call(this),this._innerContainer=new ccui.Layout,this._innerContainer.setColor(cc.color(255,255,255)),this._innerContainer.setOpacity(255),this._innerContainer.setCascadeColorEnabled(!0),this._innerContainer.setCascadeOpacityEnabled(!0),this.addProtectedChild(this._innerContainer,1,1)},_onSizeChanged:function(){ccui.Layout.prototype._onSizeChanged.call(this);var t=this._contentSize;this._topBoundary=t.height,this._rightBoundary=t.width;var e=t.width/3,i=t.height/3;this._bounceTopBoundary=t.height-i,this._bounceBottomBoundary=i,this._bounceLeftBoundary=e,this._bounceRightBoundary=t.width-e,e=this._innerContainer.getContentSize(),this._innerContainer.setContentSize(cc.size(Math.max(e.width,t.width),Math.max(e.height,t.height))),this._innerContainer.setPosition(0,t.height-this._innerContainer.getContentSize().height)},setInnerContainerSize:function(t){var e=this._innerContainer,i=this._contentSize,n=i.width,r=i.height,o=e.getContentSize();switch(t.width<i.width?cc.log("Inner width <= ScrollView width, it will be force sized!"):n=t.width,t.height<i.height?cc.log("Inner height <= ScrollView height, it will be force sized!"):r=t.height,e.setContentSize(cc.size(n,r)),this.direction){case ccui.ScrollView.DIR_VERTICAL:n=e.getContentSize(),o=o.height-n.height,this._scrollChildren(0,o);break;case ccui.ScrollView.DIR_HORIZONTAL:e.getRightBoundary()<=i.width&&(n=e.getContentSize(),o=o.width-n.width,this._scrollChildren(o,0));break;case ccui.ScrollView.DIR_BOTH:n=e.getContentSize(),t=o.height-n.height,o=e.getRightBoundary()<=i.width?o.width-n.width:0,this._scrollChildren(o,t)}o=e.getContentSize(),t=e.getPosition(),n=e.getAnchorPoint(),0<e.getLeftBoundary()&&e.setPosition(n.x*o.width,t.y),e.getRightBoundary()<i.width&&e.setPosition(i.width-(1-n.x)*o.width,t.y),0<t.y&&e.setPosition(t.x,n.y*o.height),e.getTopBoundary()<i.height&&e.setPosition(t.x,i.height-(1-n.y)*o.height)},_setInnerWidth:function(t){var e=this._contentSize.width,i=e,n=this._innerContainer,r=n.width;switch(e>t?cc.log("Inner width <= scrollview width, it will be force sized!"):i=t,n.width=i,this.direction){case ccui.ScrollView.DIR_HORIZONTAL:case ccui.ScrollView.DIR_BOTH:n.getRightBoundary()<=e&&this._scrollChildren(r-n.width,0)}t=n.anchorX,0<n.getLeftBoundary()&&(n.x=t*i),n.getRightBoundary()<e&&(n.x=e-(1-t)*i)},_setInnerHeight:function(t){var e=this._contentSize.height,i=e,n=this._innerContainer,r=n.height;switch(e>t?cc.log("Inner height <= scrollview height, it will be force sized!"):i=t,n.height=i,this.direction){case ccui.ScrollView.DIR_VERTICAL:case ccui.ScrollView.DIR_BOTH:this._scrollChildren(0,r-i)}t=n.anchorY,0<n.getLeftBoundary()&&(n.y=t*i),n.getRightBoundary()<e&&(n.y=e-(1-t)*i)},getInnerContainerSize:function(){return this._innerContainer.getContentSize()},_getInnerWidth:function(){return this._innerContainer.width},_getInnerHeight:function(){return this._innerContainer.height},addChild:function(t,e,i){return t?(e=e||t.getLocalZOrder(),i=i||t.getTag(),this._innerContainer.addChild(t,e,i)):!1},removeAllChildren:function(){this.removeAllChildrenWithCleanup(!0)},removeAllChildrenWithCleanup:function(t){this._innerContainer.removeAllChildrenWithCleanup(t)},removeChild:function(t,e){return this._innerContainer.removeChild(t,e)},getChildren:function(){return this._innerContainer.getChildren()},getChildrenCount:function(){return this._innerContainer.getChildrenCount()},getChildByTag:function(t){return this._innerContainer.getChildByTag(t)},getChildByName:function(t){return this._innerContainer.getChildByName(t)},_moveChildren:function(t,e){var i=this._innerContainer;this._moveChildPoint.x=i.x+t,this._moveChildPoint.y=i.y+e,this._innerContainer.setPosition(this._moveChildPoint)},_autoScrollChildren:function(t){var e=this._autoScrollAddUpTime;if(this._autoScrollAddUpTime+=t,this._isAutoScrollSpeedAttenuated)0>=this._autoScrollOriginalSpeed+this._autoScrollAcceleration*this._autoScrollAddUpTime?(this._stopAutoScrollChildren(),this._checkNeedBounce()):(e=(this._autoScrollOriginalSpeed+this._autoScrollAcceleration*(2*e+t)*.5)*t,this._scrollChildren(e*this._autoScrollDir.x,e*this._autoScrollDir.y)||(this._stopAutoScrollChildren(),this._checkNeedBounce()));else if(this._needCheckAutoScrollDestination){var e=this._autoScrollDir.x*t*this._autoScrollOriginalSpeed,i=this._autoScrollDir.y*t*this._autoScrollOriginalSpeed;t=this._checkCustomScrollDestination(e,i),e=this._scrollChildren(e,i),t&&e||(this._stopAutoScrollChildren(),this._checkNeedBounce())}else this._scrollChildren(this._autoScrollDir.x*t*this._autoScrollOriginalSpeed,this._autoScrollDir.y*t*this._autoScrollOriginalSpeed)||(this._stopAutoScrollChildren(),this._checkNeedBounce())},_bounceChildren:function(t){var e=this._bounceOriginalSpeed,i=this._bounceDir;0>=e&&this._stopBounceChildren(),this._bounceScrollChildren(i.x*t*e,i.y*t*e)||this._stopBounceChildren()},_checkNeedBounce:function(){if(!this.bounceEnabled)return!1;this._checkBounceBoundary();var t=this._topBounceNeeded,e=this._bottomBounceNeeded,i=this._leftBounceNeeded,n=this._rightBounceNeeded;if(t||e||i||n){var r=this._contentSize,o=this._innerContainer;return t&&i?(t=cc.pSub(cc.p(0,r.height),cc.p(o.getLeftBoundary(),o.getTopBoundary())),e=cc.pLength(t)/.2,this._bounceDir=cc.pNormalize(t),this._startBounceChildren(e)):t&&n?(t=cc.pSub(cc.p(r.width,r.height),cc.p(o.getRightBoundary(),o.getTopBoundary())),e=cc.pLength(t)/.2,this._bounceDir=cc.pNormalize(t),this._startBounceChildren(e)):e&&i?(t=cc.pSub(cc.p(0,0),cc.p(o.getLeftBoundary(),o.getBottomBoundary())),e=cc.pLength(t)/.2,this._bounceDir=cc.pNormalize(t),this._startBounceChildren(e)):e&&n?(t=cc.pSub(cc.p(r.width,0),cc.p(o.getRightBoundary(),o.getBottomBoundary())),e=cc.pLength(t)/.2,this._bounceDir=cc.pNormalize(t),this._startBounceChildren(e)):t?(t=cc.pSub(cc.p(0,r.height),cc.p(0,o.getTopBoundary())),e=cc.pLength(t)/.2,this._bounceDir=cc.pNormalize(t),this._startBounceChildren(e)):e?(t=cc.pSub(cc.p(0,0),cc.p(0,o.getBottomBoundary())),e=cc.pLength(t)/.2,this._bounceDir=cc.pNormalize(t),this._startBounceChildren(e)):i?(t=cc.pSub(cc.p(0,0),cc.p(o.getLeftBoundary(),0)),e=cc.pLength(t)/.2,this._bounceDir=cc.pNormalize(t),this._startBounceChildren(e)):n&&(t=cc.pSub(cc.p(r.width,0),cc.p(o.getRightBoundary(),0)),e=cc.pLength(t)/.2,this._bounceDir=cc.pNormalize(t),this._startBounceChildren(e)),!0
}return!1},_checkBounceBoundary:function(){var t=this._innerContainer;t.getBottomBoundary()>this._bottomBoundary?(this._scrollToBottomEvent(),this._bottomBounceNeeded=!0):this._bottomBounceNeeded=!1,t.getTopBoundary()<this._topBoundary?(this._scrollToTopEvent(),this._topBounceNeeded=!0):this._topBounceNeeded=!1,t.getRightBoundary()<this._rightBoundary?(this._scrollToRightEvent(),this._rightBounceNeeded=!0):this._rightBounceNeeded=!1,t.getLeftBoundary()>this._leftBoundary?(this._scrollToLeftEvent(),this._leftBounceNeeded=!0):this._leftBounceNeeded=!1},_startBounceChildren:function(t){this._bounceOriginalSpeed=t,this._bouncing=!0},_stopBounceChildren:function(){this._bouncing=!1,this._bounceOriginalSpeed=0,this._bottomBounceNeeded=this._topBounceNeeded=this._rightBounceNeeded=this._leftBounceNeeded=!1},_startAutoScrollChildrenWithOriginalSpeed:function(t,e,i,n){this._stopAutoScrollChildren(),this._autoScrollDir.x=t.x,this._autoScrollDir.y=t.y,this._isAutoScrollSpeedAttenuated=i,this._autoScrollOriginalSpeed=e,this._autoScroll=!0,this._autoScrollAcceleration=n},_startAutoScrollChildrenWithDestination:function(t,e,i){this._needCheckAutoScrollDestination=!1,this._autoScrollDestination=t;var n=cc.pSub(t,this._innerContainer.getPosition());t=cc.pNormalize(n);var r=0,o=-1e3,n=cc.pLength(n);i?(o=-(2*n)/(e*e),r=2*n/e):(this._needCheckAutoScrollDestination=!0,r=n/e),this._startAutoScrollChildrenWithOriginalSpeed(t,r,i,o)},_jumpToDestination:function(t,e){void 0!==t.x&&(e=t.y,t=t.x);var i=t,n=e;switch(this.direction){case ccui.ScrollView.DIR_VERTICAL:0>=e&&(n=Math.max(e,this._contentSize.height-this._innerContainer.getContentSize().height));break;case ccui.ScrollView.DIR_HORIZONTAL:0>=t&&(i=Math.max(t,this._contentSize.width-this._innerContainer.getContentSize().width));break;case ccui.ScrollView.DIR_BOTH:0>=e&&(n=Math.max(e,this._contentSize.height-this._innerContainer.getContentSize().height)),0>=t&&(i=Math.max(t,this._contentSize.width-this._innerContainer.getContentSize().width))}this._innerContainer.setPosition(i,n)},_stopAutoScrollChildren:function(){this._autoScroll=!1,this._autoScrollAddUpTime=this._autoScrollOriginalSpeed=0},_bounceScrollChildren:function(t,e){var i,n,r,o,s=!0;return o=this._innerContainer,t>0&&e>0?(i=t,n=e,r=o.getRightBoundary(),r+i>=this._rightBoundary&&(i=this._rightBoundary-r,this._bounceRightEvent(),s=!1),o=o.getTopBoundary(),o+e>=this._topBoundary&&(n=this._topBoundary-o,this._bounceTopEvent(),s=!1),this._moveChildren(i,n)):0>t&&e>0?(i=t,n=e,r=o.getLeftBoundary(),r+i<=this._leftBoundary&&(i=this._leftBoundary-r,this._bounceLeftEvent(),s=!1),o=o.getTopBoundary(),o+e>=this._topBoundary&&(n=this._topBoundary-o,this._bounceTopEvent(),s=!1),this._moveChildren(i,n)):0>t&&0>e?(i=t,n=e,r=o.getLeftBoundary(),r+i<=this._leftBoundary&&(i=this._leftBoundary-r,this._bounceLeftEvent(),s=!1),o=o.getBottomBoundary(),o+e<=this._bottomBoundary&&(n=this._bottomBoundary-o,this._bounceBottomEvent(),s=!1),this._moveChildren(i,n)):t>0&&0>e?(i=t,n=e,r=o.getRightBoundary(),r+i>=this._rightBoundary&&(i=this._rightBoundary-r,this._bounceRightEvent(),s=!1),o=o.getBottomBoundary(),o+e<=this._bottomBoundary&&(n=this._bottomBoundary-o,this._bounceBottomEvent(),s=!1),this._moveChildren(i,n)):0===t&&e>0?(n=e,o=o.getTopBoundary(),o+e>=this._topBoundary&&(n=this._topBoundary-o,this._bounceTopEvent(),s=!1),this._moveChildren(0,n)):0===t&&0>e?(n=e,o=o.getBottomBoundary(),o+e<=this._bottomBoundary&&(n=this._bottomBoundary-o,this._bounceBottomEvent(),s=!1),this._moveChildren(0,n)):t>0&&0===e?(i=t,r=o.getRightBoundary(),r+i>=this._rightBoundary&&(i=this._rightBoundary-r,this._bounceRightEvent(),s=!1),this._moveChildren(i,0)):0>t&&0===e&&(i=t,n=o.getLeftBoundary(),n+i<=this._leftBoundary&&(i=this._leftBoundary-n,this._bounceLeftEvent(),s=!1),this._moveChildren(i,0)),s},_checkCustomScrollDestination:function(t,e){var i,n,r=!0;i=this._innerContainer;var o=this._autoScrollDestination;switch(this.direction){case ccui.ScrollView.DIR_VERTICAL:0<this._autoScrollDir.y?(i=i.getBottomBoundary(),i+e>=o.y&&(r=!1)):(i=i.getBottomBoundary(),i+e<=o.y&&(r=!1));break;case ccui.ScrollView.DIR_HORIZONTAL:0<this._autoScrollDir.x?(n=i.getLeftBoundary(),n+t>=o.x&&(r=!1)):(n=i.getLeftBoundary(),n+t<=o.x&&(r=!1));break;case ccui.ScrollView.DIR_BOTH:t>0&&e>0?(n=i.getLeftBoundary(),n+t>=o.x&&(r=!1),i=i.getBottomBoundary(),i+e>=o.y&&(r=!1)):0>t&&e>0?(n=i.getRightBoundary(),n+t<=o.x&&(r=!1),i=i.getBottomBoundary(),i+e>=o.y&&(r=!1)):0>t&&0>e?(n=i.getRightBoundary(),n+t<=o.x&&(r=!1),i=i.getTopBoundary(),i+e<=o.y&&(r=!1)):t>0&&0>e?(n=i.getLeftBoundary(),n+t>=o.x&&(r=!1),i=i.getTopBoundary(),i+e<=o.y&&(r=!1)):0===t&&e>0?(i=i.getBottomBoundary(),i+e>=o.y&&(r=!1)):0>t&&0===e?(n=i.getRightBoundary(),n+t<=o.x&&(r=!1)):0===t&&0>e?(i=i.getTopBoundary(),i+e<=o.y&&(r=!1)):t>0&&0===e&&(n=i.getLeftBoundary(),n+t>=o.x&&(r=!1))}return r},_scrollChildren:function(t,e){var i=!0;switch(this._scrollingEvent(),this.direction){case ccui.ScrollView.DIR_VERTICAL:i=this._scrollChildrenVertical(t,e);break;case ccui.ScrollView.DIR_HORIZONTAL:i=this._scrollChildrenHorizontal(t,e);break;case ccui.ScrollView.DIR_BOTH:i=this._scrollChildrenBoth(t,e)}return i},_scrollChildrenVertical:function(t,e){var i,n=e,r=!0,o=this._innerContainer;return this.bounceEnabled?(i=o.getBottomBoundary(),i+e>=this._bounceBottomBoundary&&(n=this._bounceBottomBoundary-i,this._scrollToBottomEvent(),r=!1),i=o.getTopBoundary(),i+e<=this._bounceTopBoundary&&(n=this._bounceTopBoundary-i,this._scrollToTopEvent(),r=!1)):(i=o.getBottomBoundary(),i+e>=this._bottomBoundary&&(n=this._bottomBoundary-i,this._scrollToBottomEvent(),r=!1),i=o.getTopBoundary(),i+e<=this._topBoundary&&(n=this._topBoundary-i,this._scrollToTopEvent(),r=!1)),this._moveChildren(0,n),r},_scrollChildrenHorizontal:function(t){var e,i=!0,n=t,r=this._innerContainer;return this.bounceEnabled?(e=r.getRightBoundary(),e+t<=this._bounceRightBoundary&&(n=this._bounceRightBoundary-e,this._scrollToRightEvent(),i=!1),e=r.getLeftBoundary(),e+t>=this._bounceLeftBoundary&&(n=this._bounceLeftBoundary-e,this._scrollToLeftEvent(),i=!1)):(e=r.getRightBoundary(),e+t<=this._rightBoundary&&(n=this._rightBoundary-e,this._scrollToRightEvent(),i=!1),e=r.getLeftBoundary(),e+t>=this._leftBoundary&&(n=this._leftBoundary-e,this._scrollToLeftEvent(),i=!1)),this._moveChildren(n,0),i},_scrollChildrenBoth:function(t,e){var i,n,r=!0,o=t,s=e;return n=this._innerContainer,this.bounceEnabled?t>0&&e>0?(i=n.getLeftBoundary(),i+t>=this._bounceLeftBoundary&&(o=this._bounceLeftBoundary-i,this._scrollToLeftEvent(),r=!1),n=n.getBottomBoundary(),n+e>=this._bounceBottomBoundary&&(s=this._bounceBottomBoundary-n,this._scrollToBottomEvent(),r=!1)):0>t&&e>0?(i=n.getRightBoundary(),i+t<=this._bounceRightBoundary&&(o=this._bounceRightBoundary-i,this._scrollToRightEvent(),r=!1),n=n.getBottomBoundary(),n+e>=this._bounceBottomBoundary&&(s=this._bounceBottomBoundary-n,this._scrollToBottomEvent(),r=!1)):0>t&&0>e?(i=n.getRightBoundary(),i+t<=this._bounceRightBoundary&&(o=this._bounceRightBoundary-i,this._scrollToRightEvent(),r=!1),n=n.getTopBoundary(),n+e<=this._bounceTopBoundary&&(s=this._bounceTopBoundary-n,this._scrollToTopEvent(),r=!1)):t>0&&0>e?(i=n.getLeftBoundary(),i+t>=this._bounceLeftBoundary&&(o=this._bounceLeftBoundary-i,this._scrollToLeftEvent(),r=!1),n=n.getTopBoundary(),n+e<=this._bounceTopBoundary&&(s=this._bounceTopBoundary-n,this._scrollToTopEvent(),r=!1)):0===t&&e>0?(n=n.getBottomBoundary(),n+e>=this._bounceBottomBoundary&&(s=this._bounceBottomBoundary-n,this._scrollToBottomEvent(),r=!1)):0>t&&0===e?(i=n.getRightBoundary(),i+t<=this._bounceRightBoundary&&(o=this._bounceRightBoundary-i,this._scrollToRightEvent(),r=!1)):0===t&&0>e?(n=n.getTopBoundary(),n+e<=this._bounceTopBoundary&&(s=this._bounceTopBoundary-n,this._scrollToTopEvent(),r=!1)):t>0&&0===e&&(i=n.getLeftBoundary(),i+t>=this._bounceLeftBoundary&&(o=this._bounceLeftBoundary-i,this._scrollToLeftEvent(),r=!1)):t>0&&e>0?(i=n.getLeftBoundary(),i+t>=this._leftBoundary&&(o=this._leftBoundary-i,this._scrollToLeftEvent(),r=!1),n=n.getBottomBoundary(),n+e>=this._bottomBoundary&&(s=this._bottomBoundary-n,this._scrollToBottomEvent(),r=!1)):0>t&&e>0?(i=n.getRightBoundary(),i+t<=this._rightBoundary&&(o=this._rightBoundary-i,this._scrollToRightEvent(),r=!1),n=n.getBottomBoundary(),n+e>=this._bottomBoundary&&(s=this._bottomBoundary-n,this._scrollToBottomEvent(),r=!1)):0>t&&0>e?(i=n.getRightBoundary(),i+t<=this._rightBoundary&&(o=this._rightBoundary-i,this._scrollToRightEvent(),r=!1),n=n.getTopBoundary(),n+e<=this._topBoundary&&(s=this._topBoundary-n,this._scrollToTopEvent(),r=!1)):t>0&&0>e?(i=n.getLeftBoundary(),i+t>=this._leftBoundary&&(o=this._leftBoundary-i,this._scrollToLeftEvent(),r=!1),n=this._innerContainer.getTopBoundary(),n+e<=this._topBoundary&&(s=this._topBoundary-n,this._scrollToTopEvent(),r=!1)):0===t&&e>0?(n=this._innerContainer.getBottomBoundary(),n+e>=this._bottomBoundary&&(s=this._bottomBoundary-n,this._scrollToBottomEvent(),r=!1)):0>t&&0===e?(i=this._innerContainer.getRightBoundary(),i+t<=this._rightBoundary&&(o=this._rightBoundary-i,this._scrollToRightEvent(),r=!1)):0===t&&0>e?(n=this._innerContainer.getTopBoundary(),n+e<=this._topBoundary&&(s=this._topBoundary-n,this._scrollToTopEvent(),r=!1)):t>0&&0===e&&(i=this._innerContainer.getLeftBoundary(),i+t>=this._leftBoundary&&(o=this._leftBoundary-i,this._scrollToLeftEvent(),r=!1)),this._moveChildren(o,s),r},scrollToBottom:function(t,e){this._startAutoScrollChildrenWithDestination(cc.p(this._innerContainer.getPositionX(),0),t,e)},scrollToTop:function(t,e){this._startAutoScrollChildrenWithDestination(cc.p(this._innerContainer.getPositionX(),this._contentSize.height-this._innerContainer.getContentSize().height),t,e)},scrollToLeft:function(t,e){this._startAutoScrollChildrenWithDestination(cc.p(0,this._innerContainer.getPositionY()),t,e)},scrollToRight:function(t,e){this._startAutoScrollChildrenWithDestination(cc.p(this._contentSize.width-this._innerContainer.getContentSize().width,this._innerContainer.getPositionY()),t,e)},scrollToTopLeft:function(t,e){this.direction!==ccui.ScrollView.DIR_BOTH?cc.log("Scroll direction is not both!"):this._startAutoScrollChildrenWithDestination(cc.p(0,this._contentSize.height-this._innerContainer.getContentSize().height),t,e)},scrollToTopRight:function(t,e){if(this.direction!==ccui.ScrollView.DIR_BOTH)cc.log("Scroll direction is not both!");else{var i=this._innerContainer.getContentSize();this._startAutoScrollChildrenWithDestination(cc.p(this._contentSize.width-i.width,this._contentSize.height-i.height),t,e)}},scrollToBottomLeft:function(t,e){this.direction!==ccui.ScrollView.DIR_BOTH?cc.log("Scroll direction is not both!"):this._startAutoScrollChildrenWithDestination(cc.p(0,0),t,e)},scrollToBottomRight:function(t,e){this.direction!==ccui.ScrollView.DIR_BOTH?cc.log("Scroll direction is not both!"):this._startAutoScrollChildrenWithDestination(cc.p(this._contentSize.width-this._innerContainer.getContentSize().width,0),t,e)},scrollToPercentVertical:function(t,e,i){var n=this._contentSize.height-this._innerContainer.getContentSize().height,r=-n;this._startAutoScrollChildrenWithDestination(cc.p(this._innerContainer.getPositionX(),n+t*r/100),e,i)},scrollToPercentHorizontal:function(t,e,i){var n=this._innerContainer.getContentSize().width-this._contentSize.width;this._startAutoScrollChildrenWithDestination(cc.p(-(t*n/100),this._innerContainer.getPositionY()),e,i)},scrollToPercentBothDirection:function(t,e,i){if(this.direction===ccui.ScrollView.DIR_BOTH){var n=this._contentSize.height-this._innerContainer.getContentSize().height,r=-n,o=this._innerContainer.getContentSize().width-this._contentSize.width;this._startAutoScrollChildrenWithDestination(cc.p(-(t.x*o/100),n+t.y*r/100),e,i)}},jumpToBottom:function(){this._jumpToDestination(this._innerContainer.getPositionX(),0)},jumpToTop:function(){this._jumpToDestination(this._innerContainer.getPositionX(),this._contentSize.height-this._innerContainer.getContentSize().height)},jumpToLeft:function(){this._jumpToDestination(0,this._innerContainer.getPositionY())},jumpToRight:function(){this._jumpToDestination(this._contentSize.width-this._innerContainer.getContentSize().width,this._innerContainer.getPositionY())},jumpToTopLeft:function(){this.direction!==ccui.ScrollView.DIR_BOTH?cc.log("Scroll direction is not both!"):this._jumpToDestination(0,this._contentSize.height-this._innerContainer.getContentSize().height)},jumpToTopRight:function(){if(this.direction!==ccui.ScrollView.DIR_BOTH)cc.log("Scroll direction is not both!");else{var t=this._innerContainer.getContentSize();this._jumpToDestination(this._contentSize.width-t.width,this._contentSize.height-t.height)}},jumpToBottomLeft:function(){this.direction!==ccui.ScrollView.DIR_BOTH?cc.log("Scroll direction is not both!"):this._jumpToDestination(0,0)},jumpToBottomRight:function(){this.direction!==ccui.ScrollView.DIR_BOTH?cc.log("Scroll direction is not both!"):this._jumpToDestination(this._contentSize.width-this._innerContainer.getContentSize().width,0)},jumpToPercentVertical:function(t){var e=this._contentSize.height-this._innerContainer.getContentSize().height,i=-e;this._jumpToDestination(this._innerContainer.getPositionX(),e+t*i/100)},jumpToPercentHorizontal:function(t){var e=this._innerContainer.getContentSize().width-this._contentSize.width;this._jumpToDestination(-(t*e/100),this._innerContainer.getPositionY())},jumpToPercentBothDirection:function(t){if(this.direction===ccui.ScrollView.DIR_BOTH){var e=this._innerContainer.getContentSize(),i=this._contentSize.height-e.height;this._jumpToDestination(-(t.x*(e.width-this._contentSize.width)/100),i+t.y*-i/100)}},_startRecordSlidAction:function(){this._autoScroll&&this._stopAutoScrollChildren(),this._bouncing&&this._stopBounceChildren(),this._slidTime=0},_endRecordSlidAction:function(){if(!this._checkNeedBounce()&&this.inertiaScrollEnabled&&!(.016>=this._slidTime)){var t,e=0;t=this.convertToNodeSpace(this._touchEndPosition);var i=this.convertToNodeSpace(this._touchBeganPosition);switch(this.direction){case ccui.ScrollView.DIR_VERTICAL:e=t.y-i.y,t=0>e?ccui.ScrollView.SCROLLDIR_DOWN:ccui.ScrollView.SCROLLDIR_UP;break;case ccui.ScrollView.DIR_HORIZONTAL:e=t.x-i.x,t=0>e?ccui.ScrollView.SCROLLDIR_LEFT:ccui.ScrollView.SCROLLDIR_RIGHT;break;case ccui.ScrollView.DIR_BOTH:t=cc.pSub(t,i),e=cc.pLength(t),t=cc.pNormalize(t);break;default:t=cc.p(0,0)}e=Math.min(Math.abs(e)/this._slidTime,ccui.ScrollView.AUTO_SCROLL_MAX_SPEED),this._startAutoScrollChildrenWithOriginalSpeed(t,e,!0,-1e3),this._slidTime=0}},_handlePressLogic:function(){this._startRecordSlidAction(),this._bePressed=!0},_handleMoveLogic:function(t){var e=this.convertToNodeSpace(t.getLocation());switch(t=this.convertToNodeSpace(t.getPreviousLocation()),e=cc.pSub(e,t),this.direction){case ccui.ScrollView.DIR_VERTICAL:this._scrollChildren(0,e.y);break;case ccui.ScrollView.DIR_HORIZONTAL:this._scrollChildren(e.x,0);break;case ccui.ScrollView.DIR_BOTH:this._scrollChildren(e.x,e.y)}},_handleReleaseLogic:function(){this._endRecordSlidAction(),this._bePressed=!1},onTouchBegan:function(t,e){var i=ccui.Layout.prototype.onTouchBegan.call(this,t,e);return this._isInterceptTouch||this._hit&&this._handlePressLogic(t),i},onTouchMoved:function(t,e){ccui.Layout.prototype.onTouchMoved.call(this,t,e),this._isInterceptTouch||this._handleMoveLogic(t)},onTouchEnded:function(t,e){ccui.Layout.prototype.onTouchEnded.call(this,t,e),this._isInterceptTouch||this._handleReleaseLogic(t),this._isInterceptTouch=!1},onTouchCancelled:function(t,e){ccui.Layout.prototype.onTouchCancelled.call(this,t,e),this._isInterceptTouch||this.handleReleaseLogic(t),this._isInterceptTouch=!1},update:function(t){this._autoScroll&&this._autoScrollChildren(t),this._bouncing&&this._bounceChildren(t),this._recordSlidTime(t)},_recordSlidTime:function(t){this._bePressed&&(this._slidTime+=t)},interceptTouchEvent:function(t,e,i){var n=i.getLocation();switch(t){case ccui.Widget.TOUCH_BEGAN:this._isInterceptTouch=!0,this._touchBeganPosition.x=n.x,this._touchBeganPosition.y=n.y,this._handlePressLogic(i);break;case ccui.Widget.TOUCH_MOVED:t=cc.pLength(cc.pSub(e.getTouchBeganPosition(),n)),this._touchMovePosition.x=n.x,this._touchMovePosition.y=n.y,t>this._childFocusCancelOffset&&(e.setHighlighted(!1),this._handleMoveLogic(i));break;case ccui.Widget.TOUCH_CANCELED:case ccui.Widget.TOUCH_ENDED:this._touchEndPosition.x=n.x,this._touchEndPosition.y=n.y,this._handleReleaseLogic(i),e.isSwallowTouches()&&(this._isInterceptTouch=!1)}},_scrollToTopEvent:function(){this._scrollViewEventSelector&&(this._scrollViewEventListener?this._scrollViewEventSelector.call(this._scrollViewEventListener,this,ccui.ScrollView.EVENT_SCROLL_TO_TOP):this._scrollViewEventSelector(this,ccui.ScrollView.EVENT_SCROLL_TO_TOP)),this._ccEventCallback&&this._ccEventCallback(this,ccui.ScrollView.EVENT_SCROLL_TO_TOP)},_scrollToBottomEvent:function(){this._scrollViewEventSelector&&(this._scrollViewEventListener?this._scrollViewEventSelector.call(this._scrollViewEventListener,this,ccui.ScrollView.EVENT_SCROLL_TO_BOTTOM):this._scrollViewEventSelector(this,ccui.ScrollView.EVENT_SCROLL_TO_BOTTOM)),this._ccEventCallback&&this._ccEventCallback(this,ccui.ScrollView.EVENT_SCROLL_TO_BOTTOM)},_scrollToLeftEvent:function(){this._scrollViewEventSelector&&(this._scrollViewEventListener?this._scrollViewEventSelector.call(this._scrollViewEventListener,this,ccui.ScrollView.EVENT_SCROLL_TO_LEFT):this._scrollViewEventSelector(this,ccui.ScrollView.EVENT_SCROLL_TO_LEFT)),this._ccEventCallback&&this._ccEventCallback(this,ccui.ScrollView.EVENT_SCROLL_TO_LEFT)},_scrollToRightEvent:function(){this._scrollViewEventSelector&&(this._scrollViewEventListener?this._scrollViewEventSelector.call(this._scrollViewEventListener,this,ccui.ScrollView.EVENT_SCROLL_TO_RIGHT):this._scrollViewEventSelector(this,ccui.ScrollView.EVENT_SCROLL_TO_RIGHT)),this._ccEventCallback&&this._ccEventCallback(this,ccui.ScrollView.EVENT_SCROLL_TO_RIGHT)},_scrollingEvent:function(){this._scrollViewEventSelector&&(this._scrollViewEventListener?this._scrollViewEventSelector.call(this._scrollViewEventListener,this,ccui.ScrollView.EVENT_SCROLLING):this._scrollViewEventSelector(this,ccui.ScrollView.EVENT_SCROLLING)),this._ccEventCallback&&this._ccEventCallback(this,ccui.ScrollView.EVENT_SCROLLING)},_bounceTopEvent:function(){this._scrollViewEventSelector&&(this._scrollViewEventListener?this._scrollViewEventSelector.call(this._scrollViewEventListener,this,ccui.ScrollView.EVENT_BOUNCE_TOP):this._scrollViewEventSelector(this,ccui.ScrollView.EVENT_BOUNCE_TOP)),this._ccEventCallback&&this._ccEventCallback(this,ccui.ScrollView.EVENT_BOUNCE_TOP)},_bounceBottomEvent:function(){this._scrollViewEventSelector&&(this._scrollViewEventListener?this._scrollViewEventSelector.call(this._scrollViewEventListener,this,ccui.ScrollView.EVENT_BOUNCE_BOTTOM):this._scrollViewEventSelector(this,ccui.ScrollView.EVENT_BOUNCE_BOTTOM)),this._ccEventCallback&&this._ccEventCallback(this,ccui.ScrollView.EVENT_BOUNCE_BOTTOM)},_bounceLeftEvent:function(){this._scrollViewEventSelector&&(this._scrollViewEventListener?this._scrollViewEventSelector.call(this._scrollViewEventListener,this,ccui.ScrollView.EVENT_BOUNCE_LEFT):this._scrollViewEventSelector(this,ccui.ScrollView.EVENT_BOUNCE_LEFT)),this._ccEventCallback&&this._ccEventCallback(this,ccui.ScrollView.EVENT_BOUNCE_LEFT)},_bounceRightEvent:function(){this._scrollViewEventSelector&&(this._scrollViewEventListener?this._scrollViewEventSelector.call(this._scrollViewEventListener,this,ccui.ScrollView.EVENT_BOUNCE_RIGHT):this._scrollViewEventSelector(this,ccui.ScrollView.EVENT_BOUNCE_RIGHT)),this._ccEventCallback&&this._ccEventCallback(this,ccui.ScrollView.EVENT_BOUNCE_RIGHT)},addEventListenerScrollView:function(t,e){this.addEventListener(t,e)},addEventListener:function(t,e){this._scrollViewEventSelector=t,this._scrollViewEventListener=e},setDirection:function(t){this.direction=t},getDirection:function(){return this.direction},setBounceEnabled:function(t){this.bounceEnabled=t},isBounceEnabled:function(){return this.bounceEnabled},setInertiaScrollEnabled:function(t){this.inertiaScrollEnabled=t},isInertiaScrollEnabled:function(){return this.inertiaScrollEnabled},getInnerContainer:function(){return this._innerContainer},setLayoutType:function(t){this._innerContainer.setLayoutType(t)},getLayoutType:function(){return this._innerContainer.getLayoutType()},_doLayout:function(){this._doLayoutDirty&&(this._doLayoutDirty=!1)},getDescription:function(){return"ScrollView"},_createCloneInstance:function(){return new ccui.ScrollView},_copyClonedWidgetChildren:function(t){ccui.Layout.prototype._copyClonedWidgetChildren.call(this,t)},_copySpecialProperties:function(t){t instanceof ccui.ScrollView&&(ccui.Layout.prototype._copySpecialProperties.call(this,t),this.setInnerContainerSize(t.getInnerContainerSize()),this.setDirection(t.direction),this.setBounceEnabled(t.bounceEnabled),this.setInertiaScrollEnabled(t.inertiaScrollEnabled),this._scrollViewEventListener=t._scrollViewEventListener,this._scrollViewEventSelector=t._scrollViewEventSelector,this._ccEventCallback=t._ccEventCallback)},getNodeByTag:function(t){return this._innerContainer.getNodeByTag(t)},getNodes:function(){return this._innerContainer.getNodes()},removeNode:function(t){this._innerContainer.removeNode(t)},removeNodeByTag:function(t){this._innerContainer.removeNodeByTag(t)},removeAllNodes:function(){this._innerContainer.removeAllNodes()},addNode:function(t,e,i){this._innerContainer.addNode(t,e,i)}}),_p=ccui.ScrollView.prototype,cc.defineGetterSetter(_p,"innerWidth",_p._getInnerWidth,_p._setInnerWidth),cc.defineGetterSetter(_p,"innerHeight",_p._getInnerHeight,_p._setInnerHeight),_p=null,ccui.ScrollView.create=function(){return new ccui.ScrollView},ccui.ScrollView.DIR_NONE=0,ccui.ScrollView.DIR_VERTICAL=1,ccui.ScrollView.DIR_HORIZONTAL=2,ccui.ScrollView.DIR_BOTH=3,ccui.ScrollView.EVENT_SCROLL_TO_TOP=0,ccui.ScrollView.EVENT_SCROLL_TO_BOTTOM=1,ccui.ScrollView.EVENT_SCROLL_TO_LEFT=2,ccui.ScrollView.EVENT_SCROLL_TO_RIGHT=3,ccui.ScrollView.EVENT_SCROLLING=4,ccui.ScrollView.EVENT_BOUNCE_TOP=5,ccui.ScrollView.EVENT_BOUNCE_BOTTOM=6,ccui.ScrollView.EVENT_BOUNCE_LEFT=7,ccui.ScrollView.EVENT_BOUNCE_RIGHT=8,ccui.ScrollView.AUTO_SCROLL_MAX_SPEED=1e3,ccui.ScrollView.SCROLLDIR_UP=cc.p(0,1),ccui.ScrollView.SCROLLDIR_DOWN=cc.p(0,-1),ccui.ScrollView.SCROLLDIR_LEFT=cc.p(-1,0),ccui.ScrollView.SCROLLDIR_RIGHT=cc.p(1,0),ccui.ListView=ccui.ScrollView.extend({_model:null,_items:null,_gravity:null,_itemsMargin:0,_curSelectedIndex:0,_refreshViewDirty:!0,_listViewEventListener:null,_listViewEventSelector:null,ctor:function(){ccui.ScrollView.prototype.ctor.call(this),this._items=[],this._gravity=ccui.ListView.GRAVITY_CENTER_VERTICAL,this.setTouchEnabled(!0),this.init()},init:function(){return ccui.ScrollView.prototype.init.call(this)?(this.setLayoutType(ccui.Layout.LINEAR_VERTICAL),!0):!1},setItemModel:function(t){t?this._model=t:cc.log("Can't set a null to item model!")},_updateInnerContainerSize:function(){var t,e,i=this._items;switch(this.direction){case ccui.ScrollView.DIR_VERTICAL:t=i.length;var n=(t-1)*this._itemsMargin;for(e=0;t>e;e++)n+=i[e].getContentSize().height;this.setInnerContainerSize(cc.size(this._contentSize.width,n));break;case ccui.ScrollView.DIR_HORIZONTAL:for(t=i.length,n=(t-1)*this._itemsMargin,e=0;t>e;e++)n+=i[e].getContentSize().width;this.setInnerContainerSize(cc.size(n,this._contentSize.height))}},_remedyLayoutParameter:function(t){cc.assert(null!=t,"ListView Item can't be nil!");var e=t.getLayoutParameter(),i=!0;e||(e=new ccui.LinearLayoutParameter,i=!1);var n=this.getIndex(t);switch(this.direction){case ccui.ScrollView.DIR_VERTICAL:this._remedyVerticalLayoutParameter(e,n);break;case ccui.ScrollView.DIR_HORIZONTAL:this._remedyHorizontalLayoutParameter(e,n)}i||t.setLayoutParameter(e)},_remedyVerticalLayoutParameter:function(t,e){switch(cc.assert(null!=t,"Layout parameter can't be nil!"),this._gravity){case ccui.ListView.GRAVITY_LEFT:t.setGravity(ccui.LinearLayoutParameter.LEFT);break;case ccui.ListView.GRAVITY_RIGHT:t.setGravity(ccui.LinearLayoutParameter.RIGHT);break;case ccui.ListView.GRAVITY_CENTER_HORIZONTAL:t.setGravity(ccui.LinearLayoutParameter.CENTER_HORIZONTAL)}t.setMargin(0===e?ccui.MarginZero():new ccui.Margin(0,this._itemsMargin,0,0))},_remedyHorizontalLayoutParameter:function(t,e){switch(cc.assert(null!=t,"Layout parameter can't be nil!"),this._gravity){case ccui.ListView.GRAVITY_TOP:t.setGravity(ccui.LinearLayoutParameter.TOP);break;case ccui.ListView.GRAVITY_BOTTOM:t.setGravity(ccui.LinearLayoutParameter.BOTTOM);break;case ccui.ListView.GRAVITY_CENTER_VERTICAL:t.setGravity(ccui.LinearLayoutParameter.CENTER_VERTICAL)}t.setMargin(0===e?ccui.MarginZero():new ccui.Margin(this._itemsMargin,0,0,0))},pushBackDefaultItem:function(){if(null!=this._model){var t=this._model.clone();this._remedyLayoutParameter(t),this.addChild(t),this._refreshViewDirty=!0}},insertDefaultItem:function(t){if(null!=this._model){var e=this._model.clone();this._items.splice(t,0,e),ccui.ScrollView.prototype.addChild.call(this,e),this._remedyLayoutParameter(e),this._refreshViewDirty=!0}},pushBackCustomItem:function(t){this._remedyLayoutParameter(t),this.addChild(t),this._refreshViewDirty=!0},addChild:function(t,e,i){t&&(e=e||t.getLocalZOrder(),i=i||t.getName(),ccui.ScrollView.prototype.addChild.call(this,t,e,i),t instanceof ccui.Widget&&this._items.push(t))},removeChild:function(t,e){if(t){var i=this._items.indexOf(t);i>-1&&this._items.splice(i,1),ccui.ScrollView.prototype.removeChild.call(this,t,e)}},removeAllChildren:function(){this.removeAllChildrenWithCleanup(!0)},removeAllChildrenWithCleanup:function(t){ccui.ScrollView.prototype.removeAllChildrenWithCleanup.call(this,t),this._items=[]},insertCustomItem:function(t,e){this._items.splice(e,0,t),ccui.ScrollView.prototype.addChild.call(this,t),this._remedyLayoutParameter(t),this._refreshViewDirty=!0},removeItem:function(t){t=this.getItem(t),null!=t&&(this.removeChild(t,!0),this._refreshViewDirty=!0)},removeLastItem:function(){this.removeItem(this._items.length-1)},removeAllItems:function(){this.removeAllChildren()},getItem:function(t){return 0>t||t>=this._items.length?null:this._items[t]},getItems:function(){return this._items},getIndex:function(t){return null==t?-1:this._items.indexOf(t)},setGravity:function(t){this._gravity!==t&&(this._gravity=t,this._refreshViewDirty=!0)},setItemsMargin:function(t){this._itemsMargin!==t&&(this._itemsMargin=t,this._refreshViewDirty=!0)},getItemsMargin:function(){return this._itemsMargin},setDirection:function(t){switch(t){case ccui.ScrollView.DIR_VERTICAL:this.setLayoutType(ccui.Layout.LINEAR_VERTICAL);break;case ccui.ScrollView.DIR_HORIZONTAL:this.setLayoutType(ccui.Layout.LINEAR_HORIZONTAL);break;case ccui.ScrollView.DIR_BOTH:return;default:return}ccui.ScrollView.prototype.setDirection.call(this,t)},requestRefreshView:function(){this._refreshViewDirty=!0},refreshView:function(){for(var t=this._items,e=0;e<t.length;e++){var i=t[e];i.setLocalZOrder(e),this._remedyLayoutParameter(i)}this._updateInnerContainerSize()},doLayout:function(){this._doLayout()},_doLayout:function(){ccui.Layout.prototype._doLayout.call(this),this._refreshViewDirty&&(this.refreshView(),this._refreshViewDirty=!1)},addEventListenerListView:function(t,e){this.addEventListener(t,e)},addEventListener:function(t,e){this._listViewEventListener=e,this._listViewEventSelector=t},_selectedItemEvent:function(t){t=t===ccui.Widget.TOUCH_BEGAN?ccui.ListView.ON_SELECTED_ITEM_START:ccui.ListView.ON_SELECTED_ITEM_END,this._listViewEventSelector&&(this._listViewEventListener?this._listViewEventSelector.call(this._listViewEventListener,this,t):this._listViewEventSelector(this,t)),this._ccEventCallback&&this._ccEventCallback(this,t)},interceptTouchEvent:function(t,e,i){if(ccui.ScrollView.prototype.interceptTouchEvent.call(this,t,e,i),t!==ccui.Widget.TOUCH_MOVED){for(i=e;i;){if(i&&i.getParent()===this._innerContainer){this._curSelectedIndex=this.getIndex(i);break}i=i.getParent()}e.isHighlighted()&&this._selectedItemEvent(t)}},getCurSelectedIndex:function(){return this._curSelectedIndex},_onSizeChanged:function(){ccui.ScrollView.prototype._onSizeChanged.call(this),this._refreshViewDirty=!0},getDescription:function(){return"ListView"},_createCloneInstance:function(){return new ccui.ListView},_copyClonedWidgetChildren:function(t){t=t.getItems();for(var e=0;e<t.length;e++)this.pushBackCustomItem(t[e].clone())},_copySpecialProperties:function(t){t instanceof ccui.ListView&&(ccui.ScrollView.prototype._copySpecialProperties.call(this,t),this.setItemModel(t._model),this.setItemsMargin(t._itemsMargin),this.setGravity(t._gravity),this._listViewEventListener=t._listViewEventListener,this._listViewEventSelector=t._listViewEventSelector)},forceDoLayout:function(){this._refreshViewDirty&&(this.refreshView(),this._refreshViewDirty=!1),this._innerContainer.forceDoLayout()}}),ccui.ListView.create=function(){return new ccui.ListView},ccui.ListView.EVENT_SELECTED_ITEM=0,ccui.ListView.ON_SELECTED_ITEM_START=0,ccui.ListView.ON_SELECTED_ITEM_END=1,ccui.ListView.GRAVITY_LEFT=0,ccui.ListView.GRAVITY_RIGHT=1,ccui.ListView.GRAVITY_CENTER_HORIZONTAL=2,ccui.ListView.GRAVITY_TOP=3,ccui.ListView.GRAVITY_BOTTOM=4,ccui.ListView.GRAVITY_CENTER_VERTICAL=5,ccui.PageView=ccui.Layout.extend({_curPageIdx:0,_pages:null,_touchMoveDirection:null,_touchStartLocation:0,_touchMoveStartLocation:0,_movePagePoint:null,_leftBoundaryChild:null,_rightBoundaryChild:null,_leftBoundary:0,_rightBoundary:0,_isAutoScrolling:!1,_autoScrollDistance:0,_autoScrollSpeed:0,_autoScrollDirection:0,_childFocusCancelOffset:0,_pageViewEventListener:null,_pageViewEventSelector:null,_className:"PageView",_customScrollThreshold:0,_usingCustomScrollThreshold:!1,ctor:function(){ccui.Layout.prototype.ctor.call(this),this._pages=[],this._touchMoveDirection=ccui.PageView.TOUCH_DIR_LEFT,this._rightBoundaryChild=this._leftBoundaryChild=this._movePagePoint=null,this._childFocusCancelOffset=5,this._pageViewEventSelector=this._pageViewEventListener=null,this.setTouchEnabled(!0)},init:function(){return ccui.Layout.prototype.init.call(this)?(this.setClippingEnabled(!0),!0):!1},onEnter:function(){ccui.Layout.prototype.onEnter.call(this),this.scheduleUpdate(!0)},addWidgetToPage:function(t,e,i){if(t&&!(0>e)){var n=this._getPageCount();0>e||e>=n?i&&(e>n&&cc.log("pageIdx is %d, it will be added as page id [%d]",e,n),e=this._createPage(),e.addChild(t),this.addPage(e)):(e=this._pages[e])&&e.addChild(t)}},_createPage:function(){var t=new ccui.Layout;return t.setContentSize(this.getContentSize()),t},addPage:function(t){t&&-1===this._pages.indexOf(t)&&(this.addChild(t),this._pages.push(t),this._doLayoutDirty=!0)},insertPage:function(t,e){if(!(0>e)&&t&&-1===this._pages.indexOf(t)){var i=this._getPageCount();e>=i?this.addPage(t):(this._pages[e]=t,this.addChild(t)),this._doLayoutDirty=!0}},removePage:function(t){t&&(this.removeChild(t),t=this._pages.indexOf(t),t>-1&&this._pages.splice(t,1),this._doLayoutDirty=!0)},removePageAtIndex:function(t){0>t||t>=this._pages.length||(t=this._pages[t])&&this.removePage(t)},removeAllPages:function(){for(var t=this._pages,e=0,i=t.length;i>e;e++)this.removeChild(t[e]);this._pages.length=0},_updateBoundaryPages:function(){var t=this._pages;0>=t.length?this._rightBoundaryChild=this._leftBoundaryChild=null:(this._leftBoundaryChild=t[0],this._rightBoundaryChild=t[t.length-1])},_getPageCount:function(){return this._pages.length},_getPositionXByIndex:function(t){return this.getContentSize().width*(t-this._curPageIdx)},_onSizeChanged:function(){ccui.Layout.prototype._onSizeChanged.call(this),this._rightBoundary=this.getContentSize().width,this._doLayoutDirty=!0},_updateAllPagesSize:function(){for(var t=this.getContentSize(),e=this._pages,i=0,n=e.length;n>i;i++)e[i].setContentSize(t)},_updateAllPagesPosition:function(){var t=this._getPageCount();if(0>=t)this._curPageIdx=0;else{this._curPageIdx>=t&&(this._curPageIdx=t-1);
for(var e=this.getContentSize().width,i=this._pages,n=0;t>n;n++)i[n].setPosition(cc.p((n-this._curPageIdx)*e,0))}},scrollToPage:function(t){0>t||t>=this._pages.length||(this._curPageIdx=t,this._autoScrollDistance=-this._pages[t].getPosition().x,this._autoScrollSpeed=Math.abs(this._autoScrollDistance)/.2,this._autoScrollDirection=0<this._autoScrollDistance?ccui.PageView.DIRECTION_RIGHT:ccui.PageView.DIRECTION_LEFT,this._isAutoScrolling=!0)},update:function(t){this._isAutoScrolling&&this._autoScroll(t)},setLayoutType:function(){},getLayoutType:function(){return ccui.Layout.ABSOLUTE},_autoScroll:function(t){switch(this._autoScrollDirection){case ccui.PageView.DIRECTION_LEFT:t*=this._autoScrollSpeed,0<=this._autoScrollDistance+t?(t=-this._autoScrollDistance,this._autoScrollDistance=0,this._isAutoScrolling=!1):this._autoScrollDistance+=t,this._scrollPages(-t),this._isAutoScrolling||this._pageTurningEvent();break;case ccui.PageView.DIRECTION_RIGHT:t*=this._autoScrollSpeed,0>=this._autoScrollDistance-t?(t=this._autoScrollDistance,this._autoScrollDistance=0,this._isAutoScrolling=!1):this._autoScrollDistance-=t,this._scrollPages(t),this._isAutoScrolling||this._pageTurningEvent()}},onTouchMoved:function(t,e){ccui.Layout.prototype.onTouchMoved.call(this,t,e),this._isInterceptTouch||this._handleMoveLogic(t)},onTouchEnded:function(t,e){ccui.Layout.prototype.onTouchEnded.call(this,t,e),this._isInterceptTouch||this._handleReleaseLogic(t),this._isInterceptTouch=!1},onTouchCancelled:function(t,e){ccui.Layout.prototype.onTouchCancelled.call(this,t,e),this._isInterceptTouch||this._handleReleaseLogic(t),this._isInterceptTouch=!1},_doLayout:function(){this._doLayoutDirty&&(this._updateAllPagesPosition(),this._updateAllPagesSize(),this._updateBoundaryPages(),this._doLayoutDirty=!1)},_movePages:function(t){for(var e=this._pages,i=e.length,n=0;i>n;n++){var r=e[n];r.setPositionX(r.getPositionX()+t)}},_scrollPages:function(t){if(0>=this._pages.length||!this._leftBoundaryChild||!this._rightBoundaryChild)return!1;var e=t;switch(this._touchMoveDirection){case ccui.PageView.TOUCH_DIR_LEFT:var i=this._rightBoundaryChild.getRightBoundary();if(i+t<=this._rightBoundary)return e=this._rightBoundary-i,this._movePages(e),!1;break;case ccui.PageView.TOUCH_DIR_RIGHT:if(i=this._leftBoundaryChild.getLeftBoundary(),i+t>=this._leftBoundary)return e=this._leftBoundary-i,this._movePages(e),!1}return this._movePages(e),!0},_handleMoveLogic:function(t){t=t.getLocation().x-t.getPreviousLocation().x,0>t?this._touchMoveDirection=ccui.PageView.TOUCH_DIR_LEFT:t>0&&(this._touchMoveDirection=ccui.PageView.TOUCH_DIR_RIGHT),this._scrollPages(t)},setCustomScrollThreshold:function(t){cc.assert(t>0,"Invalid threshold!"),this._customScrollThreshold=t,this.setUsingCustomScrollThreshold(!0)},getCustomScrollThreshold:function(){return this._customScrollThreshold},setUsingCustomScrollThreshold:function(t){this._usingCustomScrollThreshold=t},isUsingCustomScrollThreshold:function(){return this._usingCustomScrollThreshold},_handleReleaseLogic:function(t){if(!(0>=this._pages.length)&&(t=this._pages[this._curPageIdx])){var e=t.getPosition();t=this._pages.length;var e=e.x,i=this.getSize().width;this._usingCustomScrollThreshold||(this._customScrollThreshold=i/2),i=this._customScrollThreshold,-i>=e?this._curPageIdx>=t-1?this._scrollPages(-e):this.scrollToPage(this._curPageIdx+1):e>=i?0>=this._curPageIdx?this._scrollPages(-e):this.scrollToPage(this._curPageIdx-1):this.scrollToPage(this._curPageIdx)}},interceptTouchEvent:function(t,e,i){var n=i.getLocation();switch(t){case ccui.Widget.TOUCH_BEGAN:this._touchBeganPosition.x=n.x,this._touchBeganPosition.y=n.y,this._isInterceptTouch=!0;break;case ccui.Widget.TOUCH_MOVED:this._touchMovePosition.x=n.x,this._touchMovePosition.y=n.y,t=0,t=Math.abs(e.getTouchBeganPosition().x-n.x),t>this._childFocusCancelOffset&&(e.setHighlighted(!1),this._handleMoveLogic(i));break;case ccui.Widget.TOUCH_ENDED:case ccui.Widget.TOUCH_CANCELED:this._touchEndPosition.x=n.x,this._touchEndPosition.y=n.y,this._handleReleaseLogic(i),e.isSwallowTouches()&&(this._isInterceptTouch=!1)}},_pageTurningEvent:function(){this._pageViewEventSelector&&(this._pageViewEventListener?this._pageViewEventSelector.call(this._pageViewEventListener,this,ccui.PageView.EVENT_TURNING):this._pageViewEventSelector(this,ccui.PageView.EVENT_TURNING)),this._ccEventCallback&&this._ccEventCallback(this,ccui.PageView.EVENT_TURNING)},addEventListenerPageView:function(t,e){this.addEventListener(t,e)},addEventListener:function(t,e){this._pageViewEventSelector=t,this._pageViewEventListener=e},getCurPageIndex:function(){return this._curPageIdx},getPages:function(){return this._pages},getPage:function(t){return 0>t||t>=this._pages.length?null:this._pages[t]},getDescription:function(){return"PageView"},_createCloneInstance:function(){return new ccui.PageView},_copyClonedWidgetChildren:function(t){t=t.getPages();for(var e=0;e<t.length;e++)this.addPage(t[e].clone())},_copySpecialProperties:function(t){ccui.Layout.prototype._copySpecialProperties.call(this,t),this._ccEventCallback=t._ccEventCallback,this._pageViewEventListener=t._pageViewEventListener,this._pageViewEventSelector=t._pageViewEventSelector,this._usingCustomScrollThreshold=t._usingCustomScrollThreshold,this._customScrollThreshold=t._customScrollThreshold}}),ccui.PageView.create=function(){return new ccui.PageView},ccui.PageView.EVENT_TURNING=0,ccui.PageView.TOUCH_DIR_LEFT=0,ccui.PageView.TOUCH_DIR_RIGHT=1,ccui.PageView.DIRECTION_LEFT=0,ccui.PageView.DIRECTION_RIGHT=1,cc.Component=cc.Class.extend({_owner:null,_name:"",_enabled:!0,ctor:function(){this._owner=null,this._name="",this._enabled=!0},init:function(){return!0},onEnter:function(){},onExit:function(){},update:function(){},serialize:function(){},isEnabled:function(){return this._enabled},setEnabled:function(t){this._enabled=t},getName:function(){return this._name},setName:function(t){this._name=t},setOwner:function(t){this._owner=t},getOwner:function(){return this._owner}}),cc.Component.create=function(){return new cc.Component},cc.ComponentContainer=cc.Class.extend({_components:null,_owner:null,ctor:function(t){this._components=null,this._owner=t},getComponent:function(t){if(!t)throw"cc.ComponentContainer.getComponent(): name should be non-null";return t=t.trim(),this._components||(this._components={}),this._components[t]},add:function(t){if(!t)throw"cc.ComponentContainer.add(): component should be non-null";return t.getOwner()?(cc.log("cc.ComponentContainer.add(): Component already added. It can't be added again"),!1):(null==this._components&&(this._components={},this._owner.scheduleUpdate()),this._components[t.getName()]?(cc.log("cc.ComponentContainer.add(): Component already added. It can't be added again"),!1):(t.setOwner(this._owner),this._components[t.getName()]=t,t.onEnter(),!0))},remove:function(t){if(!t)throw"cc.ComponentContainer.remove(): name should be non-null";return this._components?t instanceof cc.Component?this._removeByComponent(t):(t=t.trim(),this._removeByComponent(this._components[t])):!1},_removeByComponent:function(t){return t?(t.onExit(),t.setOwner(null),delete this._components[t.getName()],!0):!1},removeAll:function(){if(this._components){var t,e=this._components;for(t in e){var i=e[t];i.onExit(),i.setOwner(null),delete e[t]}this._owner.unscheduleUpdate(),this._components=null}},_alloc:function(){this._components={}},visit:function(t){if(this._components){var e,i=this._components;for(e in i)i[e].update(t)}},isEmpty:function(){return this._components?0===this._components.length:!0}}),ccui.LayoutComponent_ReferencePoint={BOTTOM_LEFT:0,TOP_LEFT:1,BOTTOM_RIGHT:2,TOP_RIGHT:3},ccui.LayoutComponent_PositionType={Position:0,RelativePosition:1,PreRelativePosition:2,PreRelativePositionEnable:3},ccui.LayoutComponent_SizeType={Size:0,PreSize:1,PreSizeEnable:2},ccui.LayoutComponent=cc.Component.extend({_horizontalEdge:0,_verticalEdge:0,_leftMargin:0,_rightMargin:0,_bottomMargin:0,_topMargin:0,_usingPositionPercentX:!1,_positionPercentX:0,_usingPositionPercentY:!1,_positionPercentY:0,_usingStretchWidth:!1,_usingStretchHeight:!1,_percentWidth:0,_usingPercentWidth:!1,_percentHeight:0,_usingPercentHeight:!1,_actived:!0,_isPercentOnly:!1,ctor:function(){this._name=ccui.LayoutComponent.NAME},init:function(){return cc.Component.prototype.init.call(this)?!0:!1},getPercentContentSize:function(){return cc.p(this._percentWidth,this._percentHeight)},setPercentContentSize:function(t){this.setPercentWidth(t.x),this.setPercentHeight(t.y)},setUsingPercentContentSize:function(t){this._usingPercentWidth=this._usingPercentHeight=t},SetActiveEnable:function(t){this._actived=t},getUsingPercentContentSize:function(){return this._usingPercentWidth&&this._usingPercentHeight},getAnchorPosition:function(){return this._owner.getAnchorPoint()},setAnchorPosition:function(t,e){var i=this._owner.getBoundingBox();this._owner.setAnchorPoint(t,e);var n=this._owner.getBoundingBox(),r=i.x-n.x,i=i.y-n.y,n=this._owner.getPosition();n.x+=r,n.y+=i,this.setPosition(n)},getPosition:function(){return this._owner.getPosition()},setPosition:function(t,e){var i,n=this._getOwnerParent();null!=n?(void 0===e?(i=t.x,e=t.y):i=t,n=n.getContentSize(),0!==n.width?this._positionPercentX=i/n.width:(this._positionPercentX=0,this._usingPositionPercentX&&(i=0)),0!==n.height?this._positionPercentY=e/n.height:(this._positionPercentY=0,this._usingPositionPercentY&&(e=0)),this._owner.setPosition(i,e),this._refreshHorizontalMargin(),this._refreshVerticalMargin()):this._owner.setPosition(t,e)},isPositionPercentXEnabled:function(){return this._usingPositionPercentX},setPositionPercentXEnabled:function(t){(this._usingPositionPercentX=t)&&(this._horizontalEdge=ccui.LayoutComponent.horizontalEdge.NONE)},getPositionPercentX:function(){return this._positionPercentX},setPositionPercentX:function(t){this._positionPercentX=t,t=this._getOwnerParent(),null!==t&&(this._owner.setPositionX(t.width*this._positionPercentX),this._refreshHorizontalMargin())},isPositionPercentYEnabled:function(){return this._usingPositionPercentY},setPositionPercentYEnabled:function(t){(this._usingPositionPercentY=t)&&(this._verticalEdge=ccui.LayoutComponent.verticalEdge.NONE)},getPositionPercentY:function(){return this._positionPercentY},setPositionPercentY:function(t){this._positionPercentY=t,t=this._getOwnerParent(),null!==t&&(this._owner.setPositionY(t.height*this._positionPercentY),this._refreshVerticalMargin())},getHorizontalEdge:function(){return this._horizontalEdge},setHorizontalEdge:function(t){this._horizontalEdge=t,this._horizontalEdge!==ccui.LayoutComponent.horizontalEdge.NONE&&(this._usingPositionPercentX=!1);var e=this._getOwnerParent();null!==e&&(t=this._owner.getPosition(),e=e.getContentSize(),0!==e.width?this._positionPercentX=t.x/e.width:(this._positionPercentX=0,t.x=0,this._usingPositionPercentX&&this._owner.setPosition(t)),this._refreshHorizontalMargin())},getVerticalEdge:function(){return this._verticalEdge},setVerticalEdge:function(t){this._verticalEdge=t,this._verticalEdge!==ccui.LayoutComponent.verticalEdge.NONE&&(this._usingPositionPercentY=!1);var e=this._getOwnerParent();null!==e&&(t=this._owner.getPosition(),e=e.getContentSize(),0!==e.height?this._positionPercentY=t.y/e.height:(this._positionPercentY=0,t.y=0,this._usingPositionPercentY&&this._owner.setPosition(t)),this._refreshVerticalMargin())},getLeftMargin:function(){return this._leftMargin},setLeftMargin:function(t){this._leftMargin=t},getRightMargin:function(){return this._rightMargin},setRightMargin:function(t){this._rightMargin=t},getTopMargin:function(){return this._topMargin},setTopMargin:function(t){this._topMargin=t},getBottomMargin:function(){return this._bottomMargin},setBottomMargin:function(t){this._bottomMargin=t},getSize:function(){return this.getOwner().getContentSize()},setSize:function(t){var e=this._getOwnerParent();null!==e?(e=e.getContentSize(),0!==e.width?this._percentWidth=t.width/e.width:(this._percentWidth=0,this._usingPercentWidth&&(t.width=0)),0!==e.height?this._percentHeight=t.height/e.height:(this._percentHeight=0,this._usingPercentHeight&&(t.height=0)),this._owner.setContentSize(t),this._refreshHorizontalMargin(),this._refreshVerticalMargin()):this._owner.setContentSize(t)},isPercentWidthEnabled:function(){return this._usingPercentWidth},setPercentWidthEnabled:function(t){(this._usingPercentWidth=t)&&(this._usingStretchWidth=!1)},getSizeWidth:function(){return this._owner.width},setSizeWidth:function(t){var e=this._owner.getContentSize();e.width=t,t=this._getOwnerParent(),null!==t?(t=t.getContentSize(),0!==t.width?this._percentWidth=e.width/t.width:(this._percentWidth=0,this._usingPercentWidth&&(e.width=0)),this._owner.setContentSize(e),this._refreshHorizontalMargin()):this._owner.setContentSize(e)},getPercentWidth:function(){return this._percentWidth},setPercentWidth:function(t){if(this._percentWidth=t,t=this._getOwnerParent(),null!==t){var e=this._owner.getContentSize();e.width=t.width*this._percentWidth,this._owner.setContentSize(e),this._refreshHorizontalMargin()}},isPercentHeightEnabled:function(){return this._usingPercentHeight},setPercentHeightEnabled:function(t){(this._usingPercentHeight=t)&&(this._usingStretchHeight=!1)},getSizeHeight:function(){return this._owner.height},setSizeHeight:function(t){var e=this._owner.getContentSize();e.height=t,t=this._getOwnerParent(),null!==t?(t=t.getContentSize(),0!==t.height?this._percentHeight=e.height/t.height:(this._percentHeight=0,this._usingPercentHeight&&(e.height=0)),this._owner.setContentSize(e),this._refreshVerticalMargin()):this._owner.setContentSize(e)},getPercentHeight:function(){return this._percentHeight},setPercentHeight:function(t){if(this._percentHeight=t,t=this._getOwnerParent(),null!==t){var e=this._owner.getContentSize();e.height=t.height*this._percentHeight,this._owner.setContentSize(e),this._refreshVerticalMargin()}},isStretchWidthEnabled:function(){return this._usingStretchWidth},setStretchWidthEnabled:function(t){(this._usingStretchWidth=t)&&(this._usingPercentWidth=!1)},isStretchHeightEnabled:function(){return this._usingStretchHeight},setStretchHeightEnabled:function(t){(this._usingStretchHeight=t)&&(this._usingPercentHeight=!1)},setPercentOnlyEnabled:function(t){this._isPercentOnly=t},setActiveEnabled:function(t){this._actived=t},refreshLayout:function(){if(this._actived){var t=this._getOwnerParent();if(null!==t){var t=t.getContentSize(),e=this._owner,i=e.getAnchorPoint(),n=e.getContentSize(),r=e.getPosition();switch(this._horizontalEdge){case ccui.LayoutComponent.horizontalEdge.NONE:this._usingStretchWidth&&!this._isPercentOnly?(n.width=t.width*this._percentWidth,r.x=this._leftMargin+i.x*n.width):(this._usingPositionPercentX&&(r.x=t.width*this._positionPercentX),this._usingPercentWidth&&(n.width=t.width*this._percentWidth));break;case ccui.LayoutComponent.horizontalEdge.LEFT:if(this._isPercentOnly)break;(this._usingPercentWidth||this._usingStretchWidth)&&(n.width=t.width*this._percentWidth),r.x=this._leftMargin+i.x*n.width;break;case ccui.LayoutComponent.horizontalEdge.RIGHT:if(this._isPercentOnly)break;(this._usingPercentWidth||this._usingStretchWidth)&&(n.width=t.width*this._percentWidth),r.x=t.width-(this._rightMargin+(1-i.x)*n.width);break;case ccui.LayoutComponent.horizontalEdge.CENTER:if(this._isPercentOnly)break;this._usingStretchWidth?(n.width=t.width-this._leftMargin-this._rightMargin,0>n.width&&(n.width=0),r.x=this._leftMargin+i.x*n.width):(this._usingPercentWidth&&(n.width=t.width*this._percentWidth),r.x=t.width*this._positionPercentX)}switch(this._verticalEdge){case ccui.LayoutComponent.verticalEdge.NONE:this._usingStretchHeight&&!this._isPercentOnly?(n.height=t.height*this._percentHeight,r.y=this._bottomMargin+i.y*n.height):(this._usingPositionPercentY&&(r.y=t.height*this._positionPercentY),this._usingPercentHeight&&(n.height=t.height*this._percentHeight));break;case ccui.LayoutComponent.verticalEdge.BOTTOM:if(this._isPercentOnly)break;(this._usingPercentHeight||this._usingStretchHeight)&&(n.height=t.height*this._percentHeight),r.y=this._bottomMargin+i.y*n.height;break;case ccui.LayoutComponent.verticalEdge.TOP:if(this._isPercentOnly)break;(this._usingPercentHeight||this._usingStretchHeight)&&(n.height=t.height*this._percentHeight),r.y=t.height-(this._topMargin+(1-i.y)*n.height);break;case ccui.LayoutComponent.verticalEdge.CENTER:if(this._isPercentOnly)break;this._usingStretchHeight?(n.height=t.height-this._topMargin-this._bottomMargin,0>n.height&&(n.height=0),r.y=this._bottomMargin+i.y*n.height):(this._usingPercentHeight&&(n.height=t.height*this._percentHeight),r.y=t.height*this._positionPercentY)}if(e.setPosition(r),e.setContentSize(n),e instanceof ccui.PageView)for(e.forceDoLayout(),t=e.getPages(),e=0;e<t.length;e++)ccui.helper.doLayout(t[e]);else ccui.helper.doLayout(e)}}},_getOwnerParent:function(){return this._owner?this._owner.getParent():null},_refreshHorizontalMargin:function(){var t=this._getOwnerParent();if(null!==t){var e=this._owner.getPosition(),i=this._owner.getAnchorPoint(),n=this._owner.getContentSize(),t=t.getContentSize();this._leftMargin=e.x-i.x*n.width,this._rightMargin=t.width-(e.x+(1-i.x)*n.width)}},_refreshVerticalMargin:function(){var t=this._getOwnerParent();if(null!==t){var e=this._owner.getPosition(),i=this._owner.getAnchorPoint(),n=this._owner.getContentSize(),t=t.getContentSize();this._bottomMargin=e.y-i.y*n.height,this._topMargin=t.height-(e.y+(1-i.y)*n.height)}}}),ccui.LayoutComponent.horizontalEdge={NONE:0,LEFT:1,RIGHT:2,CENTER:3},ccui.LayoutComponent.verticalEdge={NONE:0,BOTTOM:1,TOP:2,CENTER:3},ccui.LayoutComponent.NAME="__ui_layout",ccui.LayoutComponent.bindLayoutComponent=function(t){var e=t.getComponent(ccui.LayoutComponent.NAME);return void 0!==e?e:(e=new ccui.LayoutComponent)&&e.init()?(t.addComponent(e),e):null};var ccs=ccs||{};ccs.Class=ccs.Class||cc.Class,ccs.Class.extend=ccs.Class.extend||cc.Class.extend,ccs.Node=ccs.Node||cc.Node,ccs.Node.extend=ccs.Node.extend||cc.Node.extend,ccs.Sprite=ccs.Sprite||cc.Sprite,ccs.Sprite.extend=ccs.Sprite.extend||cc.Sprite.extend,ccs.Component=ccs.Component||cc.Component,ccs.Component.extend=ccs.Component.extend||cc.Component.extend,ccs.cocostudioVersion="v1.3.0.0",ccs.VERSION_COMBINED=.3,ccs.VERSION_CHANGE_ROTATION_RANGE=1,ccs.VERSION_COLOR_READING=1.1,ccs.MAX_VERTEXZ_VALUE=5e6,ccs.ARMATURE_MAX_CHILD=50,ccs.ARMATURE_MAX_ZORDER=100,ccs.ARMATURE_MAX_COUNT=ccs.MAX_VERTEXZ_VALUE/ccs.ARMATURE_MAX_CHILD/ccs.ARMATURE_MAX_ZORDER,ccs.AUTO_ADD_SPRITE_FRAME_NAME_PREFIX=!1,ccs.ENABLE_PHYSICS_CHIPMUNK_DETECT=!1,ccs.ENABLE_PHYSICS_SAVE_CALCULATED_VERTEX=!1,ccs.armatureVersion=function(){return"v1.1.0.0"},ccs.CONST_VERSION="version",ccs.CONST_VERSION_2_0=2,ccs.CONST_VERSION_COMBINED=.3,ccs.CONST_ARMATURES="armatures",ccs.CONST_ARMATURE="armature",ccs.CONST_BONE="b",ccs.CONST_DISPLAY="d",ccs.CONST_ANIMATIONS="animations",ccs.CONST_ANIMATION="animation",ccs.CONST_MOVEMENT="mov",ccs.CONST_FRAME="f",ccs.CONST_TEXTURE_ATLAS="TextureAtlas",ccs.CONST_SUB_TEXTURE="SubTexture",ccs.CONST_SKELETON="skeleton",ccs.CONST_A_NAME="name",ccs.CONST_A_DURATION="dr",ccs.CONST_A_FRAME_INDEX="fi",ccs.CONST_A_DURATION_TO="to",ccs.CONST_A_DURATION_TWEEN="drTW",ccs.CONST_A_LOOP="lp",ccs.CONST_A_MOVEMENT_SCALE="sc",ccs.CONST_A_MOVEMENT_DELAY="dl",ccs.CONST_A_DISPLAY_INDEX="dI",ccs.CONST_A_PLIST="plist",ccs.CONST_A_PARENT="parent",ccs.CONST_A_SKEW_X="kX",ccs.CONST_A_SKEW_Y="kY",ccs.CONST_A_SCALE_X="cX",ccs.CONST_A_SCALE_Y="cY",ccs.CONST_A_Z="z",ccs.CONST_A_EVENT="evt",ccs.CONST_A_SOUND="sd",ccs.CONST_A_SOUND_EFFECT="sdE",ccs.CONST_A_TWEEN_EASING="twE",ccs.CONST_A_EASING_PARAM="twEP",ccs.CONST_A_TWEEN_ROTATE="twR",ccs.CONST_A_IS_ARMATURE="isArmature",ccs.CONST_A_DISPLAY_TYPE="displayType",ccs.CONST_A_MOVEMENT="mov",ccs.CONST_A_X="x",ccs.CONST_A_Y="y",ccs.CONST_A_COCOS2DX_X="cocos2d_x",ccs.CONST_A_COCOS2DX_Y="cocos2d_y",ccs.CONST_A_WIDTH="width",ccs.CONST_A_HEIGHT="height",ccs.CONST_A_PIVOT_X="pX",ccs.CONST_A_PIVOT_Y="pY",ccs.CONST_A_COCOS2D_PIVOT_X="cocos2d_pX",ccs.CONST_A_COCOS2D_PIVOT_Y="cocos2d_pY",ccs.CONST_A_BLEND_TYPE="bd",ccs.CONST_A_BLEND_SRC="bd_src",ccs.CONST_A_BLEND_DST="bd_dst",ccs.CONST_A_ALPHA="a",ccs.CONST_A_RED="r",ccs.CONST_A_GREEN="g",ccs.CONST_A_BLUE="b",ccs.CONST_A_ALPHA_OFFSET="aM",ccs.CONST_A_RED_OFFSET="rM",ccs.CONST_A_GREEN_OFFSET="gM",ccs.CONST_A_BLUE_OFFSET="bM",ccs.CONST_A_COLOR_TRANSFORM="colorTransform",ccs.CONST_A_TWEEN_FRAME="tweenFrame",ccs.CONST_CONTOUR="con",ccs.CONST_CONTOUR_VERTEX="con_vt",ccs.CONST_FL_NAN="NaN",ccs.CONST_FRAME_DATA="frame_data",ccs.CONST_MOVEMENT_BONE_DATA="mov_bone_data",ccs.CONST_MOVEMENT_DATA="mov_data",ccs.CONST_ANIMATION_DATA="animation_data",ccs.CONST_DISPLAY_DATA="display_data",ccs.CONST_SKIN_DATA="skin_data",ccs.CONST_BONE_DATA="bone_data",ccs.CONST_ARMATURE_DATA="armature_data",ccs.CONST_CONTOUR_DATA="contour_data",ccs.CONST_TEXTURE_DATA="texture_data",ccs.CONST_VERTEX_POINT="vertex",ccs.CONST_COLOR_INFO="color",ccs.CONST_CONFIG_FILE_PATH="config_file_path",ccs.CONST_CONTENT_SCALE="content_scale",ccs.DataInfo=function(){this.asyncStruct=null,this.configFileQueue=[],this.contentScale=1,this.baseFilePath=this.filename="",this.cocoStudioVersion=this.flashToolVersion=0},ccs.dataReaderHelper={ConfigType:{DragonBone_XML:0,CocoStudio_JSON:1,CocoStudio_Binary:2},_configFileList:[],_flashToolVersion:ccs.CONST_VERSION_2_0,_positionReadScale:1,_asyncRefCount:0,_asyncRefTotalCount:0,_dataQueue:null,setPositionReadScale:function(t){this._positionReadScale=t},getPositionReadScale:function(){return this._positionReadScale},addDataFromFile:function(t){if(-1===this._configFileList.indexOf(t)){this._configFileList.push(t);var e=this._initBaseFilePath(t),i=cc.path.extname(t).toLowerCase(),n=new ccs.DataInfo;n.filename=t,n.basefilePath=e,".xml"===i?ccs.dataReaderHelper.addDataFromXML(t,n):".json"===i||".exportjson"===i?ccs.dataReaderHelper.addDataFromJson(t,n):".csb"===i&&ccs.dataReaderHelper.addDataFromBinaryCache(t,n)}},addDataFromFileAsync:function(t,e,i,n,r){if(-1!==this._configFileList.indexOf(i))r&&n&&(0===this._asyncRefTotalCount&&0===this._asyncRefCount?this._asyncCallBack(n,r,1):this._asyncCallBack(n,r,(this._asyncRefTotalCount-this._asyncRefCount)/this._asyncRefTotalCount));else{this._asyncRefTotalCount++,this._asyncRefCount++;var o=this;cc.director.getScheduler().schedule(function(){o.addDataFromFile(i),o._asyncRefCount--,o._asyncCallBack(n,r,(o._asyncRefTotalCount-o._asyncRefCount)/o._asyncRefTotalCount)},this,.1,!1,0,!1,"armatrueDataHelper")}},removeConfigFile:function(t){for(var e=this._configFileList,i=e.length,n=e[i],r=0;i>r;r++)e[r]===t&&(n=r);n!==e[i]&&cc.arrayRemoveObject(e,t)},addDataFromCache:function(t,e){if(t){e.flashToolVersion=parseFloat(t.getAttribute(ccs.CONST_VERSION));var i,n=t.querySelectorAll(ccs.CONST_SKELETON+" > "+ccs.CONST_ARMATURES+" >  "+ccs.CONST_ARMATURE),r=ccs.armatureDataManager;for(i=0;i<n.length;i++){var o=this.decodeArmature(n[i],e);r.addArmatureData(o.name,o,e.filename)}for(n=t.querySelectorAll(ccs.CONST_SKELETON+" > "+ccs.CONST_ANIMATIONS+" >  "+ccs.CONST_ANIMATION),i=0;i<n.length;i++)o=this.decodeAnimation(n[i],e),r.addAnimationData(o.name,o,e.filename);for(n=t.querySelectorAll(ccs.CONST_SKELETON+" > "+ccs.CONST_TEXTURE_ATLAS+" >  "+ccs.CONST_SUB_TEXTURE),i=0;i<n.length;i++)o=this.decodeTexture(n[i],e),r.addTextureData(o.name,o,e.filename)}else cc.log("XML error  or  XML is empty.")},decodeArmature:function(t,e){var i=new ccs.ArmatureData;i.init(),i.name=t.getAttribute(ccs.CONST_A_NAME);for(var n=t.querySelectorAll(ccs.CONST_ARMATURE+" > "+ccs.CONST_BONE),r=0;r<n.length;r++){var o=n[r],s=o.getAttribute(ccs.CONST_A_PARENT),c=null;if(s)for(var a=0;a<n.length&&(c=n[a],s!=n[a].getAttribute(ccs.CONST_A_NAME));a++);o=this.decodeBone(o,c,e),i.addBoneData(o)}return i},decodeArmatureFromJSON:function(t,e){var i=new ccs.ArmatureData;i.init();var n=t[ccs.CONST_A_NAME];n&&(i.name=n),e.cocoStudioVersion=i.dataVersion=t[ccs.CONST_VERSION]||.1;for(var n=t[ccs.CONST_BONE_DATA],r=0;r<n.length;r++){var o=this.decodeBoneFromJson(n[r],e);i.addBoneData(o)}return i},decodeBone:function(t,e,i){e=new ccs.BoneData,e.init(),e.name=t.getAttribute(ccs.CONST_A_NAME),e.parentName=t.getAttribute(ccs.CONST_A_PARENT)||"",e.zOrder=parseInt(t.getAttribute(ccs.CONST_A_Z))||0,t=t.querySelectorAll(ccs.CONST_BONE+" > "+ccs.CONST_DISPLAY);for(var n=0;n<t.length;n++){var r=this.decodeBoneDisplay(t[n],i);e.addDisplayData(r)}return e},decodeBoneFromJson:function(t,e){var i=new ccs.BoneData;i.init(),this.decodeNodeFromJson(i,t,e),i.name=t[ccs.CONST_A_NAME]||"",i.parentName=t[ccs.CONST_A_PARENT]||"";for(var n=t[ccs.CONST_DISPLAY_DATA]||[],r=0;r<n.length;r++){var o=this.decodeBoneDisplayFromJson(n[r],e);i.addDisplayData(o)}return i},decodeBoneDisplay:function(t){var e=null;1===(parseFloat(t.getAttribute(ccs.CONST_A_IS_ARMATURE))||0)?(e=new ccs.ArmatureDisplayData,e.displayType=ccs.DISPLAY_TYPE_ARMATURE):(e=new ccs.SpriteDisplayData,e.displayType=ccs.DISPLAY_TYPE_SPRITE);var i=t.getAttribute(ccs.CONST_A_NAME)||"";return i&&(e.displayName=i),e},decodeBoneDisplayFromJson:function(t,e){var i=t[ccs.CONST_A_DISPLAY_TYPE]||ccs.DISPLAY_TYPE_SPRITE,n=null;switch(i){case ccs.DISPLAY_TYPE_SPRITE:var n=new ccs.SpriteDisplayData,r=t[ccs.CONST_A_NAME];if(null!=r&&(n.displayName=r),r=(t[ccs.CONST_SKIN_DATA]||[])[0]){var o=n.skinData;o.x=r[ccs.CONST_A_X]*this._positionReadScale,o.y=r[ccs.CONST_A_Y]*this._positionReadScale,o.scaleX=null==r[ccs.CONST_A_SCALE_X]?1:r[ccs.CONST_A_SCALE_X],o.scaleY=null==r[ccs.CONST_A_SCALE_Y]?1:r[ccs.CONST_A_SCALE_Y],o.skewX=null==r[ccs.CONST_A_SKEW_X]?1:r[ccs.CONST_A_SKEW_X],o.skewY=null==r[ccs.CONST_A_SKEW_Y]?1:r[ccs.CONST_A_SKEW_Y],o.x*=e.contentScale,o.y*=e.contentScale}break;case ccs.DISPLAY_TYPE_ARMATURE:n=new ccs.ArmatureDisplayData,r=t[ccs.CONST_A_NAME],null!=r&&(n.displayName=t[ccs.CONST_A_NAME]);break;case ccs.DISPLAY_TYPE_PARTICLE:n=new ccs.ParticleDisplayData,r=t[ccs.CONST_A_PLIST],null!=r&&(n.displayName=e.asyncStruct?e.asyncStruct.basefilePath+r:e.basefilePath+r);break;default:n=new ccs.SpriteDisplayData}return n.displayType=i,n},decodeAnimation:function(t,e){var i=new ccs.AnimationData,n=t.getAttribute(ccs.CONST_A_NAME),r=ccs.armatureDataManager.getArmatureData(n);i.name=n;for(var n=t.querySelectorAll(ccs.CONST_ANIMATION+" > "+ccs.CONST_MOVEMENT),o=null,s=0;s<n.length;s++)o=n[s],o=this.decodeMovement(o,r,e),i.addMovement(o);return i},decodeAnimationFromJson:function(t,e){var i=new ccs.AnimationData;t[ccs.CONST_A_NAME]&&(i.name=t[ccs.CONST_A_NAME]);for(var n=t[ccs.CONST_MOVEMENT_DATA]||[],r=0;r<n.length;r++){var o=this.decodeMovementFromJson(n[r],e);i.addMovement(o)}return i},decodeMovement:function(t,e,i){var n=new ccs.MovementData;n.name=t.getAttribute(ccs.CONST_A_NAME);var r;r=0,r=t.getAttribute(ccs.CONST_A_DURATION),n.duration=null==r?0:parseFloat(r),r=t.getAttribute(ccs.CONST_A_DURATION_TO),n.durationTo=null==r?0:parseFloat(r),r=t.getAttribute(ccs.CONST_A_DURATION_TWEEN),n.durationTween=null==r?0:parseFloat(r),r=t.getAttribute(ccs.CONST_A_LOOP),n.loop=r?Boolean(parseFloat(r)):!0,(r=t.getAttribute(ccs.CONST_A_TWEEN_EASING))&&(r!=ccs.CONST_FL_NAN?(r=null==r?0:parseFloat(r),n.tweenEasing=2===r?ccs.TweenType.SINE_EASEINOUT:r):n.tweenEasing=ccs.TweenType.LINEAR),t=t.querySelectorAll(ccs.CONST_MOVEMENT+" > "+ccs.CONST_BONE);var o=null;for(r=0;r<t.length;r++){var o=t[r],s=o.getAttribute(ccs.CONST_A_NAME);if(!n.getMovementBoneData(s)){var s=e.getBoneData(s),c=s.parentName,a=null;if(""!==c)for(var l=0;l<t.length&&(a=t[l],c!==a.getAttribute(ccs.CONST_A_NAME));l++);o=this.decodeMovementBone(o,a,s,i),n.addMovementBoneData(o)}}return n},decodeMovementFromJson:function(t,e){var i=new ccs.MovementData;i.loop=null==t[ccs.CONST_A_LOOP]?!1:t[ccs.CONST_A_LOOP],i.durationTween=t[ccs.CONST_A_DURATION_TWEEN]||0,i.durationTo=t[ccs.CONST_A_DURATION_TO]||0,i.duration=t[ccs.CONST_A_DURATION]||0,i.scale=null==t[ccs.CONST_A_DURATION]?1:null==t[ccs.CONST_A_MOVEMENT_SCALE]?1:t[ccs.CONST_A_MOVEMENT_SCALE],i.tweenEasing=null==t[ccs.CONST_A_TWEEN_EASING]?ccs.TweenType.LINEAR:t[ccs.CONST_A_TWEEN_EASING];var n=t[ccs.CONST_A_NAME];n&&(i.name=n);for(var n=t[ccs.CONST_MOVEMENT_BONE_DATA]||[],r=0;r<n.length;r++){var o=this.decodeMovementBoneFromJson(n[r],e);i.addMovementBoneData(o)}return i},decodeMovementBone:function(t,e,i,n){var r=new ccs.MovementBoneData;r.init();var o;t&&(o=parseFloat(t.getAttribute(ccs.CONST_A_MOVEMENT_SCALE))||0,r.scale=o,o=parseFloat(t.getAttribute(ccs.CONST_A_MOVEMENT_DELAY))||0,o>0&&(o-=1),r.delay=o);var s=0,c=o=0,a=null,l=[];if(null!=e){for(var h=e.querySelectorAll(ccs.CONST_BONE+" > "+ccs.CONST_FRAME),s=0;s<h.length;s++)l.push(h[s]);s=l.length}r.name=t.getAttribute(ccs.CONST_A_NAME),t=t.querySelectorAll(ccs.CONST_BONE+" > "+ccs.CONST_FRAME);for(var u=h=0,d=0;d<t.length;d++){var _=t[d];if(e)for(;s>h&&(a?o>u||u>=o+c:1);)a=l[h],o+=c,c=parseFloat(a.getAttribute(ccs.CONST_A_DURATION)),h++;_=this.decodeFrame(_,a,i,n),r.addFrameData(_),_.frameID=u,u+=_.duration,r.duration=u}for(e=r.frameList,i=Math.PI,s=e.length-1;s>=0;s--)s>0&&(n=e[s].skewX-e[s-1].skewX,o=e[s].skewY-e[s-1].skewY,(-i>n||n>i)&&(e[s-1].skewX=0>n?e[s-1].skewX-2*i:e[s-1].skewX+2*i),(-i>o||o>i)&&(e[s-1].skewY=0>o?e[s-1].skewY-2*i:e[s-1].skewY+2*i));return e=new ccs.FrameData,e.copy(r.frameList[r.frameList.length-1]),e.frameID=r.duration,r.addFrameData(e),r},decodeMovementBoneFromJson:function(t,e){var i=new ccs.MovementBoneData;i.init(),i.delay=t[ccs.CONST_A_MOVEMENT_DELAY]||0;var n=t[ccs.CONST_A_NAME];n&&(i.name=n);for(var r=(t[ccs.CONST_FRAME_DATA]||[]).length,n=0;r>n;n++){var o=this.decodeFrameFromJson(t[ccs.CONST_FRAME_DATA][n],e);i.addFrameData(o),e.cocoStudioVersion<ccs.CONST_VERSION_COMBINED&&(o.frameID=i.duration,i.duration+=o.duration)}if(e.cocoStudioVersion<ccs.VERSION_CHANGE_ROTATION_RANGE)for(r=i.frameList,o=Math.PI,n=r.length-1;n>=0;n--)if(n>0){var s=r[n].skewX-r[n-1].skewX,c=r[n].skewY-r[n-1].skewY;(-o>s||s>o)&&(r[n-1].skewX=0>s?r[n-1].skewX-2*o:r[n-1].skewX+2*o),(-o>c||c>o)&&(r[n-1].skewY=0>c?r[n-1].skewY-2*o:r[n-1].skewY+2*o)}return e.cocoStudioVersion<ccs.CONST_VERSION_COMBINED&&0<i.frameList.length&&(o=new ccs.FrameData,o.copy(i.frameList[i.frameList.length-1]),i.addFrameData(o),o.frameID=i.duration),i},decodeFrame:function(t,e,i,n){var r=0,r=r=r=r=r=r=r=r=r=r=r=0;if(i=new ccs.FrameData,i.strMovement=t.getAttribute(ccs.CONST_A_MOVEMENT)||"",i.movement=i.strMovement,i.strEvent=t.getAttribute(ccs.CONST_A_EVENT)||"",i.event=i.strEvent,i.strSound=t.getAttribute(ccs.CONST_A_SOUND)||"",i.sound=i.strSound,i.strSoundEffect=t.getAttribute(ccs.CONST_A_SOUND_EFFECT)||"",i.soundEffect=i.strSoundEffect,r=t.getAttribute(ccs.CONST_A_TWEEN_FRAME),i.isTween=!(void 0!=r&&"false"===r),n.flashToolVersion>=ccs.CONST_VERSION_2_0?((r=t.getAttribute(ccs.CONST_A_COCOS2DX_X))&&(i.x=parseFloat(r),i.x*=this._positionReadScale),r=t.getAttribute(ccs.CONST_A_COCOS2DX_Y)):((r=t.getAttribute(ccs.CONST_A_X))&&(i.x=parseFloat(r),i.x*=this._positionReadScale),r=t.getAttribute(ccs.CONST_A_Y)),r&&(i.y=-parseFloat(r),i.y*=this._positionReadScale),r=t.getAttribute(ccs.CONST_A_SCALE_X),null!=r&&(i.scaleX=parseFloat(r)),r=t.getAttribute(ccs.CONST_A_SCALE_Y),null!=r&&(i.scaleY=parseFloat(r)),r=t.getAttribute(ccs.CONST_A_SKEW_X),null!=r&&(i.skewX=cc.degreesToRadians(parseFloat(r))),r=t.getAttribute(ccs.CONST_A_SKEW_Y),null!=r&&(i.skewY=cc.degreesToRadians(-parseFloat(r))),r=t.getAttribute(ccs.CONST_A_DURATION),null!=r&&(i.duration=parseFloat(r)),r=t.getAttribute(ccs.CONST_A_DISPLAY_INDEX),null!=r&&(i.displayIndex=parseFloat(r)),r=t.getAttribute(ccs.CONST_A_Z),null!=r&&(i.zOrder=parseInt(r)),r=t.getAttribute(ccs.CONST_A_TWEEN_ROTATE),null!=r&&(i.tweenRotate=parseFloat(r)),r=t.getAttribute(ccs.CONST_A_BLEND_TYPE),null!=r){var o=i.blendFunc;switch(r){case ccs.BLEND_TYPE_NORMAL:o.src=cc.BLEND_SRC,o.dst=cc.BLEND_DST;break;case ccs.BLEND_TYPE_ADD:o.src=cc.SRC_ALPHA,o.dst=cc.ONE;break;case ccs.BLEND_TYPE_MULTIPLY:o.src=cc.DST_COLOR,o.dst=cc.ONE_MINUS_SRC_ALPHA;break;case ccs.BLEND_TYPE_SCREEN:o.src=cc.ONE,o.dst=cc.ONE_MINUS_DST_COLOR;
break;default:i.blendFunc.src=cc.BLEND_SRC,i.blendFunc.dst=cc.BLEND_DST}}var s=t.querySelectorAll(ccs.CONST_FRAME+" > "+ccs.CONST_A_COLOR_TRANSFORM);if(s&&0<s.length){var c,a,l,h,u,s=s[0],r=parseFloat(s.getAttribute(ccs.CONST_A_ALPHA))||0,o=parseFloat(s.getAttribute(ccs.CONST_A_RED))||0;c=parseFloat(s.getAttribute(ccs.CONST_A_GREEN))||0,a=parseFloat(s.getAttribute(ccs.CONST_A_BLUE))||0,l=parseFloat(s.getAttribute(ccs.CONST_A_ALPHA_OFFSET))||0,h=parseFloat(s.getAttribute(ccs.CONST_A_RED_OFFSET))||0,u=parseFloat(s.getAttribute(ccs.CONST_A_GREEN_OFFSET))||0,s=parseFloat(s.getAttribute(ccs.CONST_A_BLUE_OFFSET))||0,i.a=2.55*l+r,i.r=2.55*h+o,i.g=2.55*u+c,i.b=2.55*s+a,i.isUseColorInfo=!0}return r=t.getAttribute(ccs.CONST_A_TWEEN_EASING),null!=r&&(r!=ccs.CONST_FL_NAN?(r=t.getAttribute(ccs.CONST_A_TWEEN_EASING))&&(i.tweenEasing=2===r?ccs.TweenType.SINE_EASEINOUT:r):i.tweenEasing=ccs.TweenType.LINEAR),e&&(t=new ccs.BaseData,n.flashToolVersion>=ccs.CONST_VERSION_2_0?(t.x=parseFloat(e.getAttribute(ccs.CONST_A_COCOS2DX_X)),t.y=parseFloat(e.getAttribute(ccs.CONST_A_COCOS2DX_Y))):(t.x=parseFloat(e.getAttribute(ccs.CONST_A_X)),t.y=parseFloat(e.getAttribute(ccs.CONST_A_Y))),t.skewX=parseFloat(e.getAttribute(ccs.CONST_A_SKEW_X)),t.skewY=parseFloat(e.getAttribute(ccs.CONST_A_SKEW_Y)),t.y=-t.y,t.skewX=cc.degreesToRadians(t.skewX),t.skewY=cc.degreesToRadians(-t.skewY),ccs.TransformHelp.transformFromParent(i,t)),i},decodeFrameFromJson:function(t,e){var i=new ccs.FrameData;this.decodeNodeFromJson(i,t,e),i.tweenEasing=t[ccs.CONST_A_TWEEN_EASING]||ccs.TweenType.LINEAR,i.displayIndex=t[ccs.CONST_A_DISPLAY_INDEX];var n=null==t[ccs.CONST_A_BLEND_DST]?cc.BLEND_DST:t[ccs.CONST_A_BLEND_DST];i.blendFunc.src=null==t[ccs.CONST_A_BLEND_SRC]?cc.BLEND_SRC:t[ccs.CONST_A_BLEND_SRC],i.blendFunc.dst=n,i.isTween=null==t[ccs.CONST_A_TWEEN_FRAME]?!0:t[ccs.CONST_A_TWEEN_FRAME],n=t[ccs.CONST_A_EVENT],null!=n&&(i.strEvent=n,i.event=n),e.cocoStudioVersion<ccs.CONST_VERSION_COMBINED?i.duration=null==t[ccs.CONST_A_DURATION]?1:t[ccs.CONST_A_DURATION]:i.frameID=t[ccs.CONST_A_FRAME_INDEX];for(var n=t[ccs.CONST_A_EASING_PARAM]||[],r=0;r<n.length;r++)i.easingParams[r]=n[r];return i},decodeTexture:function(t,e){var i=new ccs.TextureData;i.init(),t.getAttribute(ccs.CONST_A_NAME)&&(i.name=t.getAttribute(ccs.CONST_A_NAME));var n,r;e.flashToolVersion>=ccs.CONST_VERSION_2_0?(n=parseFloat(t.getAttribute(ccs.CONST_A_COCOS2D_PIVOT_X))||0,r=parseFloat(t.getAttribute(ccs.CONST_A_COCOS2D_PIVOT_Y))||0):(n=parseFloat(t.getAttribute(ccs.CONST_A_PIVOT_X))||0,r=parseFloat(t.getAttribute(ccs.CONST_A_PIVOT_Y))||0);var o=parseFloat(t.getAttribute(ccs.CONST_A_WIDTH))||0,s=parseFloat(t.getAttribute(ccs.CONST_A_HEIGHT))||0;for(i.pivotX=n/o,i.pivotY=(s-r)/s,n=t.querySelectorAll(ccs.CONST_SUB_TEXTURE+" > "+ccs.CONST_CONTOUR),r=0;r<n.length;r++)i.addContourData(this.decodeContour(n[r],e));return i},decodeTextureFromJson:function(t){var e=new ccs.TextureData;e.init();var i=t[ccs.CONST_A_NAME];for(null!=i&&(e.name=i),e.width=t[ccs.CONST_A_WIDTH]||0,e.height=t[ccs.CONST_A_HEIGHT]||0,e.pivotX=t[ccs.CONST_A_PIVOT_X]||0,e.pivotY=t[ccs.CONST_A_PIVOT_Y]||0,t=t[ccs.CONST_CONTOUR_DATA]||[],i=0;i<t.length;i++)e.contourDataList.push(this.decodeContourFromJson(t[i]));return e},decodeContour:function(t){var e=new ccs.ContourData;e.init();for(var i,n=t.querySelectorAll(ccs.CONST_CONTOUR+" > "+ccs.CONST_CONTOUR_VERTEX),r=0;r<n.length;r++){i=n[r];var o=cc.p(0,0);o.x=parseFloat(i.getAttribute(ccs.CONST_A_X))||0,o.y=parseFloat(i.getAttribute(ccs.CONST_A_Y))||0,o.y=-o.y,e.vertexList.push(o)}return e},decodeContourFromJson:function(t){var e=new ccs.ContourData;e.init(),t=t[ccs.CONST_VERTEX_POINT]||[];for(var i=t.length,n=0;i>n;n++){var r=t[n],o=cc.p(0,0);o.x=r[ccs.CONST_A_X]||0,o.y=r[ccs.CONST_A_Y]||0,e.vertexList.push(o)}return e},addDataFromJsonCache:function(t,e){e.contentScale=null==t[ccs.CONST_CONTENT_SCALE]?1:t[ccs.CONST_CONTENT_SCALE];var i,n,r=t[ccs.CONST_ARMATURE_DATA]||[];for(i=0;i<r.length;i++)n=this.decodeArmatureFromJSON(r[i],e),ccs.armatureDataManager.addArmatureData(n.name,n,e.filename);for(r=t[ccs.CONST_ANIMATION_DATA]||[],i=0;i<r.length;i++)n=this.decodeAnimationFromJson(r[i],e),ccs.armatureDataManager.addAnimationData(n.name,n,e.filename);for(r=t[ccs.CONST_TEXTURE_DATA]||[],i=0;i<r.length;i++)n=this.decodeTextureFromJson(r[i],e),ccs.armatureDataManager.addTextureData(n.name,n,e.filename);if(null==e.asyncStruct?ccs.armatureDataManager.isAutoLoadSpriteFile():e.asyncStruct.autoLoadSpriteFile){var o,r=t[ccs.CONST_CONFIG_FILE_PATH]||[];for(i=0;i<r.length;i++)n=r[i],o=n.lastIndexOf("."),n=n.substring(0,o),o=e.basefilePath+n+".plist",n=e.basefilePath+n+".png",ccs.armatureDataManager.addSpriteFrameFromFile(o,n,e.filename)}},decodeNodeFromJson:function(t,e,i){t.x=e[ccs.CONST_A_X]*this._positionReadScale,t.y=e[ccs.CONST_A_Y]*this._positionReadScale,t.x*=i.contentScale,t.y*=i.contentScale,t.zOrder=e[ccs.CONST_A_Z],t.skewX=e[ccs.CONST_A_SKEW_X]||0,t.skewY=e[ccs.CONST_A_SKEW_Y]||0,t.scaleX=null==e[ccs.CONST_A_SCALE_X]?1:e[ccs.CONST_A_SCALE_X],t.scaleY=null==e[ccs.CONST_A_SCALE_Y]?1:e[ccs.CONST_A_SCALE_Y],(e=i.cocoStudioVersion<ccs.VERSION_COLOR_READING?e[0]:e[ccs.CONST_COLOR_INFO]||null)&&(t.a=null==e[ccs.CONST_A_ALPHA]?255:e[ccs.CONST_A_ALPHA],t.r=null==e[ccs.CONST_A_RED]?255:e[ccs.CONST_A_RED],t.g=null==e[ccs.CONST_A_GREEN]?255:e[ccs.CONST_A_GREEN],t.b=null==e[ccs.CONST_A_BLUE]?255:e[ccs.CONST_A_BLUE],t.isUseColorInfo=!0)},clear:function(){this._configFileList=[],this._asyncRefTotalCount=this._asyncRefCount=0},_asyncCallBack:function(t,e,i){t&&cc.isFunction(t)&&t.call(e,i),e&&t&&"string"==typeof t&&e[t](i)},_initBaseFilePath:function(t){var e=t.lastIndexOf("/");return t=e>-1?t.substr(0,e+1):""},addDataFromXML:function(t,e){var i=cc.loader.getRes(t);if(!i)throw"Please load the resource first : "+t;(i=cc.saxParser.parse(i).documentElement)&&this.addDataFromCache(i,e)},addDataFromJson:function(t,e){var i=cc.loader.getRes(t);this.addDataFromJsonCache(i,e)}},ccs.spriteFrameCacheHelper={_textureAtlasDic:{},_imagePaths:[],addSpriteFrameFromFile:function(t,e){cc.spriteFrameCache.addSpriteFrames(t,e)},getTextureAtlasWithTexture:function(){return null},clear:function(){this._textureAtlasDic={},this._imagePaths=[]}},ccs.TransformHelp=ccs.TransformHelp||ccs.Class.extend({}),ccs.TransformHelp.helpMatrix1=cc.affineTransformMake(1,0,0,1,0,0),ccs.TransformHelp.helpMatrix2=cc.affineTransformMake(1,0,0,1,0,0),ccs.TransformHelp.helpPoint1=cc.p(0,0),ccs.TransformHelp.helpPoint2=cc.p(0,0),ccs.TransformHelp.helpParentNode={},ccs.TransformHelp.transformFromParent=function(t,e){this.nodeToMatrix(t,this.helpMatrix1),this.nodeToMatrix(e,this.helpMatrix2),this.helpMatrix2=cc.affineTransformInvert(this.helpMatrix2),this.helpMatrix1=cc.affineTransformConcat(this.helpMatrix1,this.helpMatrix2),this.matrixToNode(this.helpMatrix1,t)},ccs.TransformHelp.transformToParent=function(t,e){this.nodeToMatrix(t,this.helpMatrix1),this.nodeToMatrix(e,this.helpMatrix2),this.helpMatrix1=cc.affineTransformConcat(this.helpMatrix1,this.helpMatrix2),this.matrixToNode(this.helpMatrix1,t)},ccs.TransformHelp.transformFromParentWithoutScale=function(t,e){for(var i in e)this.helpParentNode[i]=e[i];this.helpParentNode.scaleX=1,this.helpParentNode.scaleY=1,this.nodeToMatrix(t,this.helpMatrix1),this.nodeToMatrix(this.helpParentNode,this.helpMatrix2),this.helpMatrix2=cc.affineTransformInvert(this.helpMatrix2),this.helpMatrix1=cc.affineTransformConcat(this.helpMatrix1,this.helpMatrix2),this.matrixToNode(this.helpMatrix1,t)},ccs.TransformHelp.transformToParentWithoutScale=function(t,e){for(var i in e)this.helpParentNode[i]=e[i];this.helpParentNode.scaleX=1,this.helpParentNode.scaleY=1,this.nodeToMatrix(t,this.helpMatrix1),this.nodeToMatrix(this.helpParentNode,this.helpMatrix2),this.helpMatrix1=cc.affineTransformConcat(this.helpMatrix1,this.helpMatrix2),this.matrixToNode(this.helpMatrix1,t)},ccs.TransformHelp.nodeToMatrix=function(t,e){if(t.skewX===-t.skewY){var i=Math.sin(t.skewX),n=Math.cos(t.skewX);e.a=t.scaleX*n,e.b=t.scaleX*-i,e.c=t.scaleY*i,e.d=t.scaleY*n}else e.a=t.scaleX*Math.cos(t.skewY),e.b=t.scaleX*Math.sin(t.skewY),e.c=t.scaleY*Math.sin(t.skewX),e.d=t.scaleY*Math.cos(t.skewX);e.tx=t.x,e.ty=t.y},ccs.TransformHelp.matrixToNode=function(t,e){this.helpPoint1.x=0,this.helpPoint1.y=1,this.helpPoint1=cc.pointApplyAffineTransform(this.helpPoint1,t),this.helpPoint1.x-=t.tx,this.helpPoint1.y-=t.ty,this.helpPoint2.x=1,this.helpPoint2.y=0,this.helpPoint2=cc.pointApplyAffineTransform(this.helpPoint2,t),this.helpPoint2.x-=t.tx,this.helpPoint2.y-=t.ty,e.skewX=-(Math.atan2(this.helpPoint1.y,this.helpPoint1.x)-1.5707964),e.skewY=Math.atan2(this.helpPoint2.y,this.helpPoint2.x),e.scaleX=Math.sqrt(t.a*t.a+t.b*t.b),e.scaleY=Math.sqrt(t.c*t.c+t.d*t.d),e.x=t.tx,e.y=t.ty},ccs.TransformHelp.nodeConcat=function(t,e){t.x+=e.x,t.y+=e.y,t.skewX+=e.skewX,t.skewY+=e.skewY,t.scaleX+=e.scaleX,t.scaleY+=e.scaleY},ccs.TransformHelp.nodeSub=function(t,e){t.x-=e.x,t.y-=e.y,t.skewX-=e.skewX,t.skewY-=e.skewY,t.scaleX-=e.scaleX,t.scaleY-=e.scaleY},ccs.TweenType={CUSTOM_EASING:-1,LINEAR:0,SINE_EASEIN:1,SINE_EASEOUT:2,SINE_EASEINOUT:3,QUAD_EASEIN:4,QUAD_EASEOUT:5,QUAD_EASEINOUT:6,CUBIC_EASEIN:7,CUBIC_EASEOUT:8,CUBIC_EASEINOUT:9,QUART_EASEIN:10,QUART_EASEOUT:11,QUART_EASEINOUT:12,QUINT_EASEIN:13,QUINT_EASEOUT:14,QUINT_EASEINOUT:15,EXPO_EASEIN:16,EXPO_EASEOUT:17,EXPO_EASEINOUT:18,CIRC_EASEIN:19,CIRC_EASEOUT:20,CIRC_EASEINOUT:21,ELASTIC_EASEIN:22,ELASTIC_EASEOUT:23,ELASTIC_EASEINOUT:24,BACK_EASEIN:25,BACK_EASEOUT:26,BACK_EASEINOUT:27,BOUNCE_EASEIN:28,BOUNCE_EASEOUT:29,BOUNCE_EASEINOUT:30,TWEEN_EASING_MAX:1e4},ccs.TweenFunction=ccs.TweenFunction||ccs.Class.extend({}),ccs.DOUBLE_PI=ccs.M_PI_X_2=2*Math.PI,ccs.HALF_PI=ccs.M_PI_2=Math.PI/2,ccs.M_PI=Math.PI,ccs.TweenFunction.tweenTo=function(t,e,i){var n=0;switch(e){case ccs.TweenType.CUSTOM_EASING:n=this.customEase(t,i);break;case ccs.TweenType.LINEAR:n=this.linear(t);break;case ccs.TweenType.SINE_EASEIN:n=this.sineEaseIn(t);break;case ccs.TweenType.SINE_EASEOUT:n=this.sineEaseOut(t);break;case ccs.TweenType.SINE_EASEINOUT:n=this.sineEaseInOut(t);break;case ccs.TweenType.QUAD_EASEIN:n=this.quadEaseIn(t);break;case ccs.TweenType.QUAD_EASEOUT:n=this.quadEaseOut(t);break;case ccs.TweenType.QUAD_EASEINOUT:n=this.quadEaseInOut(t);break;case ccs.TweenType.CUBIC_EASEIN:n=this.cubicEaseIn(t);break;case ccs.TweenType.CUBIC_EASEOUT:n=this.cubicEaseOut(t);break;case ccs.TweenType.CUBIC_EASEINOUT:n=this.cubicEaseInOut(t);break;case ccs.TweenType.QUART_EASEIN:n=this.quartEaseIn(t);break;case ccs.TweenType.QUART_EASEOUT:n=this.quartEaseOut(t);break;case ccs.TweenType.QUART_EASEINOUT:n=this.quartEaseInOut(t);break;case ccs.TweenType.QUINT_EASEIN:n=this.quintEaseIn(t);break;case ccs.TweenType.QUINT_EASEOUT:n=this.quintEaseOut(t);break;case ccs.TweenType.QUINT_EASEINOUT:n=this.quintEaseInOut(t);break;case ccs.TweenType.EXPO_EASEIN:n=this.expoEaseIn(t);break;case ccs.TweenType.EXPO_EASEOUT:n=this.expoEaseOut(t);break;case ccs.TweenType.EXPO_EASEINOUT:n=this.expoEaseInOut(t);break;case ccs.TweenType.CIRC_EASEIN:n=this.circEaseIn(t);break;case ccs.TweenType.CIRC_EASEOUT:n=this.circEaseOut(t);break;case ccs.TweenType.CIRC_EASEINOUT:n=this.circEaseInOut(t);break;case ccs.TweenType.ELASTIC_EASEIN:e=.3,null!=i&&0<i.length&&(e=i[0]),n=this.elasticEaseIn(t,e);break;case ccs.TweenType.ELASTIC_EASEOUT:e=.3,null!=i&&0<i.length&&(e=i[0]),n=this.elasticEaseOut(t,e);break;case ccs.TweenType.ELASTIC_EASEINOUT:e=.3,null!=i&&0<i.length&&(e=i[0]),n=this.elasticEaseInOut(t,e);break;case ccs.TweenType.BACK_EASEIN:n=this.backEaseIn(t);break;case ccs.TweenType.BACK_EASEOUT:n=this.backEaseOut(t);break;case ccs.TweenType.BACK_EASEINOUT:n=this.backEaseInOut(t);break;case ccs.TweenType.BOUNCE_EASEIN:n=this.bounceEaseIn(t);break;case ccs.TweenType.BOUNCE_EASEOUT:n=this.bounceEaseOut(t);break;case ccs.TweenType.BOUNCE_EASEINOUT:n=this.bounceEaseInOut(t);break;default:n=this.sineEaseInOut(t)}return n},ccs.TweenFunction.linear=function(t){return t},ccs.TweenFunction.sineEaseIn=function(t){return-1*Math.cos(t*ccs.HALF_PI)+1},ccs.TweenFunction.sineEaseOut=function(t){return Math.sin(t*ccs.HALF_PI)},ccs.TweenFunction.sineEaseInOut=function(t){return-.5*(Math.cos(ccs.M_PI*t)-1)},ccs.TweenFunction.quadEaseIn=function(t){return t*t},ccs.TweenFunction.quadEaseOut=function(t){return-1*t*(t-2)},ccs.TweenFunction.quadEaseInOut=function(t){return t*=2,1>t?.5*t*t:(--t,-.5*(t*(t-2)-1))},ccs.TweenFunction.cubicEaseIn=function(t){return t*t*t},ccs.TweenFunction.cubicEaseOut=function(t){return t-=1,t*t*t+1},ccs.TweenFunction.cubicEaseInOut=function(t){return t*=2,1>t?.5*t*t*t:(t-=2,.5*(t*t*t+2))},ccs.TweenFunction.quartEaseIn=function(t){return t*t*t*t},ccs.TweenFunction.quartEaseOut=function(t){return t-=1,-(t*t*t*t-1)},ccs.TweenFunction.quartEaseInOut=function(t){return t*=2,1>t?.5*t*t*t*t:(t-=2,-.5*(t*t*t*t-2))},ccs.TweenFunction.quintEaseIn=function(t){return t*t*t*t*t},ccs.TweenFunction.quintEaseOut=function(t){return t-=1,t*t*t*t*t+1},ccs.TweenFunction.quintEaseInOut=function(t){return t*=2,1>t?.5*t*t*t*t*t:(t-=2,.5*(t*t*t*t*t+2))},ccs.TweenFunction.expoEaseIn=function(t){return 0===t?0:Math.pow(2,10*(t-1))-.001},ccs.TweenFunction.expoEaseOut=function(t){return 1===t?1:-Math.pow(2,-10*t)+1},ccs.TweenFunction.expoEaseInOut=function(t){return t/=.5,t=1>t?.5*Math.pow(2,10*(t-1)):.5*(-Math.pow(2,-10*(t-1))+2)},ccs.TweenFunction.circEaseIn=function(t){return-1*(Math.sqrt(1-t*t)-1)},ccs.TweenFunction.circEaseOut=function(t){return t-=1,Math.sqrt(1-t*t)},ccs.TweenFunction.circEaseInOut=function(t){return t*=2,1>t?-.5*(Math.sqrt(1-t*t)-1):(t-=2,.5*(Math.sqrt(1-t*t)+1))},ccs.TweenFunction.elasticEaseIn=function(t,e){var i=.3;0<e.length&&(i=e[0]);var n=0;return 0===t||1===t?n=t:(n=i/4,t-=1,n=-Math.pow(2,10*t)*Math.sin((t-n)*ccs.DOUBLE_PI/i)),n},ccs.TweenFunction.elasticEaseOut=function(t,e){var i=.3;0<e.length&&(i=e[0]);var n=0;return 0===t||1===t?n=t:(n=i/4,n=Math.pow(2,-10*t)*Math.sin((t-n)*ccs.DOUBLE_PI/i)+1),n},ccs.TweenFunction.elasticEaseInOut=function(t,e){var i=.3;0<e.length&&(i=e[0]);var n=0;return 0===t||1===t?n=t:(i||(i=.3*1.5),n=i/4,t=2*t-1,n=0>t?-.5*Math.pow(2,10*t)*Math.sin((t-n)*ccs.DOUBLE_PI/i):Math.pow(2,-10*t)*Math.sin((t-n)*ccs.DOUBLE_PI/i)*.5+1),n},ccs.TweenFunction.backEaseIn=function(t){return t*t*(2.70158*t-1.70158)},ccs.TweenFunction.backEaseOut=function(t){return t-=1,t*t*(2.70158*t+1.70158)+1},ccs.TweenFunction.backEaseInOut=function(t){return t*=2,1>t?t*t*(3.5949095*t-2.5949095)/2:(t-=2,t*t*(3.5949095*t+2.5949095)/2+1)},ccs.bounceTime=function(t){return 1/2.75>t?7.5625*t*t:2/2.75>t?(t-=1.5/2.75,7.5625*t*t+.75):2.5/2.75>t?(t-=2.25/2.75,7.5625*t*t+.9375):(t-=2.625/2.75,7.5625*t*t+.984375)},ccs.TweenFunction.bounceEaseIn=function(t){return 1-ccs.bounceTime(1-t)},ccs.TweenFunction.bounceEaseOut=function(t){return ccs.bounceTime(t)},ccs.TweenFunction.bounceEaseInOut=function(t){var e=0;return e=.5>t?.5*(1-ccs.bounceTime(1-2*t)):.5*ccs.bounceTime(2*t-1)+.5},ccs.TweenFunction.customEase=function(t,e){if(0<e.length){var i=1-t;return e[1]*i*i*i+3*e[3]*t*i*i+3*e[5]*t*t*i+e[7]*t*t*t}return t},ccs.TweenFunction.easeIn=function(t,e){return Math.pow(t,e)},ccs.TweenFunction.easeOut=function(t,e){return Math.pow(t,1/e)},ccs.TweenFunction.easeInOut=function(t,e){return t*=2,1>t?.5*Math.pow(t,e):1-.5*Math.pow(2-t,e)},ccs.TweenFunction.quadraticIn=function(t){return Math.pow(t,2)},ccs.TweenFunction.quadraticOut=function(t){return-t*(t-2)},ccs.TweenFunction.bezieratFunction=function(t,e,i,n,r){return Math.pow(1-r,3)*t+3*r*Math.pow(1-r,2)*e+3*Math.pow(r,2)*(1-r)*i+Math.pow(r,3)*n};var ENABLE_PHYSICS_DETECT=!1;ccs.fmodf=function(t,e){for(;t>e;)t-=e;return t};var CC_SAFE_RELEASE=function(t){t&&t.release&&t.release()};ccs.isSpriteContainPoint=function(t,e,i){return e=t.convertToNodeSpace(e),i&&(i.x=e.x,i.y=e.y),t=t.getContentSize(),cc.rectContainsPoint(cc.rect(0,0,t.width,t.height),e)},ccs.SPRITE_CONTAIN_POINT=ccs.isSpriteContainPoint,ccs.SPRITE_CONTAIN_POINT_WITH_RETURN=ccs.isSpriteContainPoint,ccs.extBezierTo=function(t,e,i,n,r){var o=cc.p(0,0);return n&&!r&&(o.x=Math.pow(1-t,2)*e.x+2*t*(1-t)*i.x+Math.pow(t,2)*n.x,o.y=Math.pow(1-t,2)*e.y+2*t*(1-t)*i.y+Math.pow(t,2)*n.y),r&&(o.x=e.x*Math.pow(1-t,3)+3*t*i.x*Math.pow(1-t,2)+3*n.x*Math.pow(t,2)*(1-t)+r.x*Math.pow(t,3),o.y=e.y*Math.pow(1-t,3)+3*t*i.y*Math.pow(1-t,2)+3*n.y*Math.pow(t,2)*(1-t)+r.y*Math.pow(t,3)),o},ccs.extCircleTo=function(t,e,i,n,r){var o=cc.p(0,0);return o.x=e.x+i*Math.cos(n+r*t),o.y=e.y+i*Math.sin(n+r*t),o},ccs.RelativeData=function(){this.plistFiles=[],this.armatures=[],this.animations=[],this.textures=[]},ccs.armatureDataManager={_animationDatas:{},_armatureDatas:{},_textureDatas:{},_autoLoadSpriteFile:!1,_relativeDatas:{},s_sharedArmatureDataManager:null,removeArmatureFileInfo:function(t){var e=this.getRelativeData(t);if(e){var i,n;for(i=0;i<e.armatures.length;i++)n=e.armatures[i],this.removeArmatureData(n);for(i=0;i<e.animations.length;i++)n=e.animations[i],this.removeAnimationData(n);for(i=0;i<e.textures.length;i++)n=e.textures[i],this.removeTextureData(n);for(i=0;i<e.plistFiles.length;i++)n=e.plistFiles[i],cc.spriteFrameCache.removeSpriteFramesFromFile(n);delete this._relativeDatas[t],ccs.dataReaderHelper.removeConfigFile(t)}},addArmatureData:function(t,e,i){(i=this.getRelativeData(i))&&i.armatures.push(t),this._armatureDatas[t]=e},getArmatureData:function(t){var e=null;return this._armatureDatas&&(e=this._armatureDatas[t]),e},removeArmatureData:function(t){this._armatureDatas[t]&&delete this._armatureDatas[t]},addAnimationData:function(t,e,i){(i=this.getRelativeData(i))&&i.animations.push(t),this._animationDatas[t]=e},getAnimationData:function(t){var e=null;return this._animationDatas[t]&&(e=this._animationDatas[t]),e},removeAnimationData:function(t){this._animationDatas[t]&&delete this._animationDatas[t]},addTextureData:function(t,e,i){(i=this.getRelativeData(i))&&i.textures.push(t),this._textureDatas[t]=e},getTextureData:function(t){var e=null;return this._textureDatas&&(e=this._textureDatas[t]),e},removeTextureData:function(t){this._textureDatas[t]&&delete this._textureDatas[t]},addArmatureFileInfo:function(){var t,e,i;switch(arguments.length){case 1:i=arguments[0],this.addRelativeData(i),this._autoLoadSpriteFile=!0,ccs.dataReaderHelper.addDataFromFile(i);break;case 3:t=arguments[0],e=arguments[1],i=arguments[2],this.addRelativeData(i),this._autoLoadSpriteFile=!1,ccs.dataReaderHelper.addDataFromFile(i),this.addSpriteFrameFromFile(e,t)}},addArmatureFileInfoAsync:function(){var t,e,i,n,r;switch(arguments.length){case 3:i=arguments[0],n=arguments[2],r=arguments[1],this.addRelativeData(i),this._autoLoadSpriteFile=!0,ccs.dataReaderHelper.addDataFromFileAsync("","",i,r,n);break;case 5:t=arguments[0],e=arguments[1],i=arguments[2],n=arguments[4],r=arguments[3],this.addRelativeData(i),this._autoLoadSpriteFile=!1,ccs.dataReaderHelper.addDataFromFileAsync(t,e,i,r,n),this.addSpriteFrameFromFile(e,t)}},addSpriteFrameFromFile:function(t,e,i){(i=this.getRelativeData(i))&&i.plistFiles.push(t),ccs.spriteFrameCacheHelper.addSpriteFrameFromFile(t,e)},isAutoLoadSpriteFile:function(){return this._autoLoadSpriteFile},getArmatureDatas:function(){return this._armatureDatas},getAnimationDatas:function(){return this._animationDatas},getTextureDatas:function(){return this._textureDatas},addRelativeData:function(t){this._relativeDatas[t]||(this._relativeDatas[t]=new ccs.RelativeData)},getRelativeData:function(t){return this._relativeDatas[t]},clear:function(){this._animationDatas={},this._armatureDatas={},this._textureDatas={},ccs.spriteFrameCacheHelper.clear(),ccs.dataReaderHelper.clear()}},ccs.BLEND_TYPE_NORMAL=0,ccs.BLEND_TYPE_LAYER=1,ccs.BLEND_TYPE_DARKEN=2,ccs.BLEND_TYPE_MULTIPLY=3,ccs.BLEND_TYPE_LIGHTEN=4,ccs.BLEND_TYPE_SCREEN=5,ccs.BLEND_TYPE_OVERLAY=6,ccs.BLEND_TYPE_HIGHLIGHT=7,ccs.BLEND_TYPE_ADD=8,ccs.BLEND_TYPE_SUBTRACT=9,ccs.BLEND_TYPE_DIFFERENCE=10,ccs.BLEND_TYPE_INVERT=11,ccs.BLEND_TYPE_ALPHA=12,ccs.BLEND_TYPE_ERASE=13,ccs.DISPLAY_TYPE_SPRITE=0,ccs.DISPLAY_TYPE_ARMATURE=1,ccs.DISPLAY_TYPE_PARTICLE=2,ccs.DISPLAY_TYPE_MAX=3,ccs.BaseData=ccs.Class.extend({x:0,y:0,zOrder:0,skewX:0,skewY:0,scaleX:1,scaleY:1,tweenRotate:0,isUseColorInfo:!1,r:255,g:255,b:255,a:255,ctor:function(){this.skewY=this.skewX=this.zOrder=this.y=this.x=0,this.scaleY=this.scaleX=1,this.tweenRotate=0,this.isUseColorInfo=!1,this.a=this.b=this.g=this.r=255},copy:function(t){this.x=t.x,this.y=t.y,this.zOrder=t.zOrder,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.skewX=t.skewX,this.skewY=t.skewY,this.tweenRotate=t.tweenRotate,this.isUseColorInfo=t.isUseColorInfo,this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a},setColor:function(t){this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a},getColor:function(){return cc.color(this.r,this.g,this.b,this.a)},subtract:function(t,e,i){this.x=e.x-t.x,this.y=e.y-t.y,this.scaleX=e.scaleX-t.scaleX,this.scaleY=e.scaleY-t.scaleY,this.skewX=e.skewX-t.skewX,this.skewY=e.skewY-t.skewY,this.isUseColorInfo||t.isUseColorInfo||e.isUseColorInfo?(this.a=e.a-t.a,this.r=e.r-t.r,this.g=e.g-t.g,this.b=e.b-t.b,this.isUseColorInfo=!0):(this.a=this.r=this.g=this.b=0,this.isUseColorInfo=!1),i&&(this.skewX>ccs.M_PI&&(this.skewX-=ccs.DOUBLE_PI),this.skewX<-ccs.M_PI&&(this.skewX+=ccs.DOUBLE_PI),this.skewY>ccs.M_PI&&(this.skewY-=ccs.DOUBLE_PI),this.skewY<-ccs.M_PI&&(this.skewY+=ccs.DOUBLE_PI)),e.tweenRotate&&(this.skewX+=e.tweenRotate*ccs.PI*2,this.skewY-=e.tweenRotate*ccs.PI*2)}}),ccs.DisplayData=ccs.Class.extend({displayType:ccs.DISPLAY_TYPE_MAX,displayName:"",ctor:function(){this.displayType=ccs.DISPLAY_TYPE_MAX},changeDisplayToTexture:function(t){var e=t.lastIndexOf(".");return-1!==e&&(t=t.substring(0,e)),t},copy:function(t){this.displayName=t.displayName,this.displayType=t.displayType}}),ccs.SpriteDisplayData=ccs.DisplayData.extend({skinData:null,ctor:function(){this.skinData=new ccs.BaseData,this.displayType=ccs.DISPLAY_TYPE_SPRITE},copy:function(t){ccs.DisplayData.prototype.copy.call(this,t),this.skinData=t.skinData}}),ccs.ArmatureDisplayData=ccs.DisplayData.extend({ctor:function(){this.displayName="",this.displayType=ccs.DISPLAY_TYPE_ARMATURE}}),ccs.ParticleDisplayData=ccs.DisplayData.extend({ctor:function(){this.displayType=ccs.DISPLAY_TYPE_PARTICLE}}),ccs.BoneData=ccs.BaseData.extend({displayDataList:null,name:"",parentName:"",boneDataTransform:null,ctor:function(){this.displayDataList=[],this.parentName=this.name="",this.boneDataTransform=null},init:function(){return this.displayDataList.length=0,!0},addDisplayData:function(t){this.displayDataList.push(t)},getDisplayData:function(t){return this.displayDataList[t]}}),ccs.ArmatureData=ccs.Class.extend({boneDataDic:null,name:"",dataVersion:.1,ctor:function(){this.boneDataDic={},this.name="",this.dataVersion=.1},init:function(){return!0},addBoneData:function(t){this.boneDataDic[t.name]=t},getBoneDataDic:function(){return this.boneDataDic},getBoneData:function(t){return this.boneDataDic[t]}}),ccs.FrameData=ccs.BaseData.extend({duration:0,tweenEasing:0,easingParamNumber:0,easingParams:null,displayIndex:-1,movement:"",event:"",sound:"",soundEffect:"",blendFunc:null,frameID:0,isTween:!0,ctor:function(){ccs.BaseData.prototype.ctor.call(this),this.duration=1,this.tweenEasing=ccs.TweenType.LINEAR,this.easingParamNumber=0,this.easingParams=[],this.displayIndex=0,this.soundEffect=this.sound=this.event=this.movement="",this.blendFunc=new cc.BlendFunc(cc.BLEND_SRC,cc.BLEND_DST),this.frameID=0,this.isTween=!0},copy:function(t){if(ccs.BaseData.prototype.copy.call(this,t),this.duration=t.duration,this.displayIndex=t.displayIndex,this.tweenEasing=t.tweenEasing,this.easingParamNumber=t.easingParamNumber,0!==this.easingParamNumber)for(var e=this.easingParams.length=0;e<this.easingParamNumber;e++)this.easingParams[e]=t.easingParams[e];this.blendFunc=t.blendFunc,this.isTween=t.isTween}}),ccs.MovementBoneData=ccs.Class.extend({delay:0,scale:1,duration:0,frameList:null,name:"",ctor:function(){this.delay=0,this.scale=1,this.duration=0,this.frameList=[],this.name=""},init:function(){return!0},addFrameData:function(t){this.frameList.push(t)},getFrameData:function(t){return this.frameList[t]}}),ccs.MovementData=function(){this.name="",this.duration=0,this.scale=1,this.durationTween=this.durationTo=0,this.loop=!0,this.tweenEasing=ccs.TweenType.LINEAR,this.movBoneDataDic={}},ccs.MovementData.prototype.addMovementBoneData=function(t){this.movBoneDataDic[t.name]=t},ccs.MovementData.prototype.getMovementBoneData=function(t){return this.movBoneDataDic[t]},ccs.AnimationData=function(){this.movementDataDic={},this.movementNames=[],this.name=""},ccs.AnimationData.prototype.addMovement=function(t){this.movementDataDic[t.name]=t,this.movementNames.push(t.name)},ccs.AnimationData.prototype.getMovement=function(t){return this.movementDataDic[t]},ccs.AnimationData.prototype.getMovementCount=function(){return Object.keys(this.movementDataDic).length},ccs.ContourVertex2=function(t,e){this.x=t||0,this.y=e||0},ccs.ContourData=function(){this.vertexList=[]},ccs.ContourData.prototype.init=function(){return this.vertexList.length=0,!0},ccs.ContourData.prototype.addVertex=function(t){this.vertexList.push(t)},ccs.TextureData=function(){this.width=this.height=0,this.pivotY=this.pivotX=.5,this.name="",this.contourDataList=[]},ccs.TextureData.prototype.init=function(){this.contourDataList.length=0},ccs.TextureData.prototype.addContourData=function(t){this.contourDataList.push(t)},ccs.TextureData.prototype.getContourData=function(t){return this.contourDataList[t]},ccs.DecorativeDisplay=ccs.Class.extend({_display:null,_colliderDetector:null,_displayData:null,ctor:function(){this._displayData=this._colliderDetector=this._display=null},init:function(){return!0},setDisplay:function(t){t._parent&&(t._parent.removeChild(t),delete t._parent),this._display=t},getDisplay:function(){return this._display},setColliderDetector:function(t){this._colliderDetector=t},getColliderDetector:function(){return this._colliderDetector},setDisplayData:function(t){this._displayData=t},getDisplayData:function(){return this._displayData},release:function(){this._colliderDetector=this._displayData=this._display=null}}),ccs.DecorativeDisplay.create=function(){return new ccs.DecorativeDisplay},ccs.displayFactory={addDisplay:function(t,e,i){switch(i.displayType){case ccs.DISPLAY_TYPE_SPRITE:this.addSpriteDisplay(t,e,i);break;case ccs.DISPLAY_TYPE_PARTICLE:this.addParticleDisplay(t,e,i);break;case ccs.DISPLAY_TYPE_ARMATURE:this.addArmatureDisplay(t,e,i)}},createDisplay:function(t,e){switch(e.getDisplayData().displayType){case ccs.DISPLAY_TYPE_SPRITE:this.createSpriteDisplay(t,e);break;case ccs.DISPLAY_TYPE_PARTICLE:this.createParticleDisplay(t,e);break;case ccs.DISPLAY_TYPE_ARMATURE:this.createArmatureDisplay(t,e)}},_helpTransform:{a:1,b:0,c:0,d:1,tx:0,ty:0},updateDisplay:function(t,e,i){var n=t.getDisplayRenderNode();if(n){switch(t.getDisplayRenderNodeType()){case ccs.DISPLAY_TYPE_SPRITE:i&&n.updateArmatureTransform();break;case ccs.DISPLAY_TYPE_PARTICLE:this.updateParticleDisplay(t,n,e);break;case ccs.DISPLAY_TYPE_ARMATURE:this.updateArmatureDisplay(t,n,e);break;default:e=t.getNodeToArmatureTransform(),n.setAdditionalTransform(e)}if((ccs.ENABLE_PHYSICS_CHIPMUNK_DETECT||ccs.ENABLE_PHYSICS_SAVE_CALCULATED_VERTEX)&&i&&(n=t.getDisplayManager().getCurrentDecorativeDisplay(),i=n.getColliderDetector())){e=n.getDisplay();var r=e.getNodeToParentTransform(),n=this._helpTransform;n.a=r.a,n.b=r.b,n.c=r.c,n.d=r.d,n.tx=r.tx,n.ty=r.ty,e=cc.pointApplyAffineTransform(e.getAnchorPointInPoints(),n),n.tx=e.x,n.ty=e.y,t=cc.affineTransformConcat(n,t.getArmature().getNodeToParentTransform()),i.updateTransform(t)}}},addSpriteDisplay:function(t,e,i){var n=new ccs.SpriteDisplayData;n.copy(i),e.setDisplayData(n),this.createSpriteDisplay(t,e)},createSpriteDisplay:function(t,e){var i=null,n=e.getDisplayData(),i=n.displayName,r=i.lastIndexOf(".");-1!==r&&(i=i.substring(0,r)),i=""===i?new ccs.Skin:new ccs.Skin("#"+i+".png"),e.setDisplay(i),i.setBone(t),this.initSpriteDisplay(t,e,n.displayName,i),(r=t.getArmature())&&i.setSkinData(r.getArmatureData().dataVersion>=ccs.CONST_VERSION_COMBINED?n.skinData:t.boneData)},initSpriteDisplay:function(t,e,i,n){var r=i.lastIndexOf(".");-1!==r&&(i=i.substring(0,r)),(i=ccs.armatureDataManager.getTextureData(i))&&n.setAnchorPoint(cc.p(i.pivotX,i.pivotY)),(ccs.ENABLE_PHYSICS_CHIPMUNK_DETECT||ccs.ENABLE_PHYSICS_SAVE_CALCULATED_VERTEX)&&i&&0<i.contourDataList.length&&(t=new ccs.ColliderDetector(t),t.addContourDataList(i.contourDataList),e.setColliderDetector(t))},addArmatureDisplay:function(t,e,i){var n=new ccs.ArmatureDisplayData;n.copy(i),e.setDisplayData(n),this.createArmatureDisplay(t,e)},createArmatureDisplay:function(t,e){var i=e.getDisplayData(),i=new ccs.Armature(i.displayName,t);e.setDisplay(i)},updateArmatureDisplay:function(t,e,i){e&&(e.sortAllChildren(),e.update(i))},addParticleDisplay:function(t,e,i){var n=new ccs.ParticleDisplayData;n.copy(i),e.setDisplayData(n),this.createParticleDisplay(t,e)},createParticleDisplay:function(t,e){var i=e.getDisplayData(),i=new cc.ParticleSystem(i.displayName);i.removeFromParent(),i.cleanup(),t.getArmature()&&i.setParent(t.getArmature()),e.setDisplay(i)},updateParticleDisplay:function(t,e,i){var n=new ccs.BaseData;ccs.TransformHelp.matrixToNode(t.nodeToArmatureTransform(),n),e.setPosition(n.x,n.y),e.setScaleX(n.scaleX),e.setScaleY(n.scaleY),e.update(i)}},ccs.DisplayManager=ccs.Class.extend({_decoDisplayList:null,_currentDecoDisplay:null,_displayRenderNode:null,_displayIndex:null,_forceChangeDisplay:!1,_bone:null,_visible:!0,_displayType:null,ctor:function(t){this._decoDisplayList=[],this._displayIndex=this._displayRenderNode=this._currentDecoDisplay=null,this._forceChangeDisplay=!1,this._bone=null,this._visible=!0,this._displayType=ccs.DISPLAY_TYPE_MAX,t&&ccs.DisplayManager.prototype.init.call(this,t)},init:function(t){return this._bone=t,this.initDisplayList(t.getBoneData()),!0},addDisplay:function(t,e){var i,n=this._decoDisplayList;if(e>=0&&e<n.length?i=n[e]:(i=new ccs.DecorativeDisplay,n.push(i)),t instanceof ccs.DisplayData)ccs.displayFactory.addDisplay(this._bone,i,t);else{var r=null;if(t instanceof ccs.Skin){t.setBone(this._bone),r=new ccs.SpriteDisplayData,ccs.displayFactory.initSpriteDisplay(this._bone,i,t.getDisplayName(),t);var o=i.getDisplayData();if(o instanceof ccs.SpriteDisplayData)t.setSkinData(o.skinData),r.skinData=o.skinData;else{for(var o=!1,s=n.length-2;s>=0;s--){var c=n[s].getDisplayData();if(c instanceof ccs.SpriteDisplayData){o=!0,t.setSkinData(c.skinData),r.skinData=c.skinData;break}}o||t.setSkinData(new ccs.BaseData)}}else t instanceof cc.ParticleSystem?(r=new ccs.ParticleDisplayData,t.removeFromParent(),t.cleanup(),(n=this._bone.getArmature())&&t.setParent(n)):t instanceof ccs.Armature?(r=new ccs.ArmatureDisplayData,r.displayName=t.getName(),t.setParentBone(this._bone)):r=new ccs.DisplayData;i.setDisplay(t),i.setDisplayData(r)}e===this._displayIndex&&(this._displayIndex=-1,this.changeDisplayWithIndex(e,!1))},_addDisplayOther:function(t,e){var i=null;if(e instanceof ccs.Skin){e.setBone(this._bone),i=new ccs.SpriteDisplayData,i.displayName=e.getDisplayName(),ccs.displayFactory.initSpriteDisplay(this._bone,t,e.getDisplayName(),e);var n=t.getDisplayData();if(n instanceof ccs.SpriteDisplayData)e.setSkinData(n.skinData);else{for(var n=!1,r=this._decoDisplayList.length-2;r>=0;r--){var o=this._decoDisplayList[r].getDisplayData();if(o){n=!0,e.setSkinData(o.skinData),i.skinData=o.skinData;break}}n||e.setSkinData(new ccs.BaseData),e.setSkinData(new ccs.BaseData)}}else e instanceof cc.ParticleSystem?(i=new ccs.ParticleDisplayData,i.displayName=e._plistFile):e instanceof ccs.Armature?(i=new ccs.ArmatureDisplayData,i.displayName=e.getName(),e.setParentBone(this._bone)):i=new ccs.DisplayData;t.setDisplay(e),t.setDisplayData(i)},removeDisplay:function(t){this._decoDisplayList.splice(t,1),t===this._displayIndex&&(this.setCurrentDecorativeDisplay(null),this._displayIndex=-1)},getDecorativeDisplayList:function(){return this._decoDisplayList
},changeDisplayWithIndex:function(t,e){t>=this._decoDisplayList.length?cc.log("the index value is out of range"):(this._forceChangeDisplay=e,this._displayIndex!==t&&(this._displayIndex=t,0>t?this._displayRenderNode&&(this._displayRenderNode.removeFromParent(!0),this.setCurrentDecorativeDisplay(null)):this.setCurrentDecorativeDisplay(this._decoDisplayList[t])))},changeDisplayWithName:function(t,e){for(var i=this._decoDisplayList,n=0;n<i.length;n++)if(i[n].getDisplayData().displayName===t){this.changeDisplayWithIndex(n,e);break}},setCurrentDecorativeDisplay:function(t){var e=this._currentDecoDisplay;(ccs.ENABLE_PHYSICS_CHIPMUNK_DETECT||ccs.ENABLE_PHYSICS_SAVE_CALCULATED_VERTEX)&&e&&e.getColliderDetector()&&e.getColliderDetector().setActive(!1),e=this._currentDecoDisplay=t,(ccs.ENABLE_PHYSICS_CHIPMUNK_DETECT||ccs.ENABLE_PHYSICS_SAVE_CALCULATED_VERTEX)&&e&&e.getColliderDetector()&&e.getColliderDetector().setActive(!0),t=e?e.getDisplay():null;var e=this._displayRenderNode,i=this._bone;e&&(e instanceof ccs.Armature&&i.setChildArmature(null),e.removeFromParent(!0)),(this._displayRenderNode=t)?(t instanceof ccs.Armature?(this._bone.setChildArmature(t),t.setParentBone(this._bone)):t instanceof cc.ParticleSystem&&(t instanceof ccs.Armature?(i.setChildArmature(t),t.setParentBone(i)):t instanceof cc.ParticleSystem&&t.resetSystem()),t.setColor(i.getDisplayedColor()),t.setOpacity(i.getDisplayedOpacity()),this._displayRenderNode.setVisible(this._visible),this._displayType=this._currentDecoDisplay.getDisplayData().displayType):this._displayType=ccs.DISPLAY_TYPE_MAX,cc.renderer.childrenOrderDirty=!0},getDisplayRenderNode:function(){return this._displayRenderNode},getDisplayRenderNodeType:function(){return this._displayType},getCurrentDisplayIndex:function(){return this._displayIndex},getCurrentDecorativeDisplay:function(){return this._currentDecoDisplay},getDecorativeDisplayByIndex:function(t){return this._decoDisplayList[t]},initDisplayList:function(t){if(this._decoDisplayList.length=0,t){t=t.displayDataList;for(var e=this._decoDisplayList,i=this._bone,n=0;n<t.length;n++){var r=t[n],o=new ccs.DecorativeDisplay;o.setDisplayData(r),ccs.displayFactory.createDisplay(i,o),e.push(o)}}},containPoint:function(t,e){if(!this._visible||0>this._displayIndex)return!1;if(void 0!==e&&(t=cc.p(t,e)),this._currentDecoDisplay.getDisplayData().displayType===ccs.DISPLAY_TYPE_SPRITE){var i=this._currentDecoDisplay.getDisplay(),i=i.getChildByTag(0);return ccs.SPRITE_CONTAIN_POINT_WITH_RETURN(i,t)}return!1},setVisible:function(t){this._displayRenderNode&&(this._visible=t,this._displayRenderNode.setVisible(t))},isVisible:function(){return this._visible},getContentSize:function(){return this._displayRenderNode?this._displayRenderNode.getContentSize():cc.size(0,0)},getBoundingBox:function(){return this._displayRenderNode?this._displayRenderNode.getBoundingBox():cc.rect(0,0,0,0)},getAnchorPoint:function(){return this._displayRenderNode?this._displayRenderNode.getAnchorPoint():cc.p(0,0)},getAnchorPointInPoints:function(){return this._displayRenderNode?this._displayRenderNode.getAnchorPointInPoints():cc.p(0,0)},getForceChangeDisplay:function(){return this._forceChangeDisplay},release:function(){this._decoDisplayList=null,this._displayRenderNode&&(this._displayRenderNode.removeFromParent(!0),this._displayRenderNode=null)}}),ccs.DisplayManager.create=function(t){return new ccs.DisplayManager(t)},ccs.Skin=ccs.Sprite.extend({_skinData:null,bone:null,_skinTransform:null,_displayName:"",_armature:null,_className:"Skin",ctor:function(t,e){cc.Sprite.prototype.ctor.call(this),this.bone=this._skinData=null,this._displayName="",this._skinTransform=cc.affineTransformIdentity(),this._armature=null,null==t||""===t?ccs.Skin.prototype.init.call(this):"#"===t[0]?ccs.Skin.prototype.initWithSpriteFrameName.call(this,t.substr(1)):ccs.Skin.prototype.initWithFile.call(this,t,e)},initWithSpriteFrameName:function(t){if(""===t)return!1;var e=cc.spriteFrameCache.getSpriteFrame(t),i=!0;return e?this.initWithSpriteFrame(e):(cc.log("Can't find CCSpriteFrame with %s. Please check your .plist file",t),i=!1),this._displayName=t,i},initWithFile:function(t,e){var i=e?cc.Sprite.prototype.initWithFile.call(this,t,e):cc.Sprite.prototype.initWithFile.call(this,t);return this._displayName=t,i},setSkinData:function(t){this._skinData=t,this.setScaleX(t.scaleX),this.setScaleY(t.scaleY),this.setRotationX(cc.radiansToDegrees(t.skewX)),this.setRotationY(cc.radiansToDegrees(-t.skewY)),this.setPosition(t.x,t.y),t=this.getNodeToParentTransform?this.getNodeToParentTransform():this.nodeToParentTransform();var e=this._skinTransform;e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e.tx=t.tx,e.ty=t.ty,this.updateArmatureTransform()},getSkinData:function(){return this._skinData},updateArmatureTransform:function(){this._renderCmd.updateArmatureTransform()},getNodeToWorldTransform:function(){return this._renderCmd.getNodeToWorldTransform()},getNodeToWorldTransformAR:function(){return this._renderCmd.getNodeToWorldTransformAR()},setBone:function(t){this.bone=t,(t=this.bone.getArmature())&&(this._armature=t)},getBone:function(){return this.bone},getDisplayName:function(){return this._displayName},_createRenderCmd:function(){return cc._renderType===cc._RENDER_TYPE_CANVAS?new ccs.Skin.CanvasRenderCmd(this):new ccs.Skin.WebGLRenderCmd(this)}}),_p=ccs.Skin.prototype,cc.defineGetterSetter(_p,"skinData",_p.getSkinData,_p.setSkinData),cc.defineGetterSetter(_p,"displayName",_p.getDisplayName),_p=null,ccs.Skin.create=function(t,e){return new ccs.Skin(t,e)},ccs.Skin.createWithSpriteFrameName=function(t){return new ccs.Skin("#"+t)},function(){ccs.Skin.RenderCmd={updateArmatureTransform:function(){var t=this._node;this._transform=cc.affineTransformConcat(t._skinTransform,t.bone.getNodeToArmatureTransform()),this._dirtyFlag^=this._dirtyFlag&cc.Node._dirtyFlags.transformDirty},getNodeToWorldTransform:function(){return cc.affineTransformConcat(this._transform,this._node.bone.getArmature().getNodeToWorldTransform())},getNodeToWorldTransformAR:function(){var t=this._transform,e=this._node;return this._anchorPointInPoints=cc.pointApplyAffineTransform(this._anchorPointInPoints,t),t.tx=this._anchorPointInPoints.x,t.ty=this._anchorPointInPoints.y,cc.affineTransformConcat(t,e.bone.getArmature().getNodeToWorldTransform())}},ccs.Skin.CanvasRenderCmd=function(t){cc.Sprite.CanvasRenderCmd.call(this,t),this._needDraw=!0};var t=ccs.Skin.CanvasRenderCmd.prototype=Object.create(cc.Sprite.CanvasRenderCmd.prototype);cc.inject(ccs.Skin.RenderCmd,t),t.constructor=ccs.Skin.CanvasRenderCmd}(),function(){ccs.Skin.WebGLRenderCmd=function(t){cc.Sprite.WebGLRenderCmd.call(this,t)};var t=ccs.Skin.WebGLRenderCmd.prototype=Object.create(cc.Sprite.WebGLRenderCmd.prototype);cc.inject(ccs.Skin.RenderCmd,t),t.constructor=ccs.Skin.WebGLRenderCmd,t.updateTransform=function(){var t=this._node,e=this._quad;if(t._visible){var i=this.getNodeToParentTransform(),n=t._rect,r=t._offsetPosition.x,o=t._offsetPosition.y,s=r+n.width,c=o+n.height,a=i.tx,l=i.ty,h=i.a,u=i.b,d=i.d,_=-i.c,i=r*h-o*_+a,n=r*u+o*d+l,p=s*h-o*_+a,o=s*u+o*d+l,f=s*h-c*_+a,s=s*u+c*d+l,a=r*h-c*_+a,r=r*u+c*d+l,c=t._vertexZ;cc.SPRITEBATCHNODE_RENDER_SUBPIXEL||(i|=0,n|=0,p|=0,o|=0,f|=0,s|=0,a|=0,r|=0),this.SET_VERTEX3F(e.bl.vertices,i,n,c),this.SET_VERTEX3F(e.br.vertices,p,o,c),this.SET_VERTEX3F(e.tl.vertices,a,r,c),this.SET_VERTEX3F(e.tr.vertices,f,s,c)}else e.br.vertices=e.tl.vertices=e.tr.vertices=e.bl.vertices={x:0,y:0,z:0};t.textureAtlas&&t.textureAtlas.updateQuad(e,t.textureAtlas.getTotalQuads()),this._quadDirty=!0},t.SET_VERTEX3F=function(t,e,i,n){t.x=e,t.y=i,t.z=n},t.rendering=function(t){var e=this._node;if(e._textureLoaded){t=t||cc._renderContext;var i=e._texture;i&&i._textureLoaded&&(this._shaderProgram.use(),this._shaderProgram.setUniformForModelViewAndProjectionMatrixWithMat4(),cc.glBlendFunc(e._blendFunc.src,e._blendFunc.dst),cc.glBindTexture2DN(0,i),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX),t.bindBuffer(t.ARRAY_BUFFER,this._quadWebBuffer),this._quadDirty&&(t.bufferData(t.ARRAY_BUFFER,this._quad.arrayBuffer,t.DYNAMIC_DRAW),this._quadDirty=!1),t.vertexAttribPointer(0,3,t.FLOAT,!1,24,0),t.vertexAttribPointer(1,4,t.UNSIGNED_BYTE,!0,24,12),t.vertexAttribPointer(2,2,t.FLOAT,!1,24,16),t.drawArrays(t.TRIANGLE_STRIP,0,4)),cc.g_NumberOfDraws++,(0!==cc.SPRITE_DEBUG_DRAW||e._showNode)&&(1===cc.SPRITE_DEBUG_DRAW||e._showNode?(e=this._quad,e=[cc.p(e.tl.vertices.x,e.tl.vertices.y),cc.p(e.bl.vertices.x,e.bl.vertices.y),cc.p(e.br.vertices.x,e.br.vertices.y),cc.p(e.tr.vertices.x,e.tr.vertices.y)],cc._drawingUtil.drawPoly(e,4,!0)):2===cc.SPRITE_DEBUG_DRAW&&(t=e.getTextureRect(),e=e.getOffsetPosition(),e=[cc.p(e.x,e.y),cc.p(e.x+t.width,e.y),cc.p(e.x+t.width,e.y+t.height),cc.p(e.x,e.y+t.height)],cc._drawingUtil.drawPoly(e,4,!0)))}}}(),ccs.ANIMATION_TYPE_SINGLE_FRAME=-4,ccs.ANIMATION_TYPE_NO_LOOP=-3,ccs.ANIMATION_TYPE_TO_LOOP_FRONT=-2,ccs.ANIMATION_TYPE_TO_LOOP_BACK=-1,ccs.ANIMATION_TYPE_LOOP_FRONT=0,ccs.ANIMATION_TYPE_LOOP_BACK=1,ccs.ANIMATION_TYPE_MAX=2,ccs.ProcessBase=ccs.Class.extend({_processScale:1,_isComplete:!0,_isPause:!0,_isPlaying:!1,_currentPercent:0,_rawDuration:0,_loopType:0,_tweenEasing:0,animationInternal:null,_currentFrame:0,_durationTween:0,_nextFrameIndex:0,_curFrameIndex:null,_isLoopBack:!1,ctor:function(){this._processScale=1,this._isPause=this._isComplete=!0,this._isPlaying=!1,this._rawDuration=this._durationTween=this._currentPercent=this._currentFrame=0,this._loopType=ccs.ANIMATION_TYPE_LOOP_BACK,this._tweenEasing=ccs.TweenType.LINEAR,this.animationInternal=1/60,this._durationTween=this._curFrameIndex=0,this._isLoopBack=!1},pause:function(){this._isPause=!0,this._isPlaying=!1},resume:function(){this._isPause=!1,this._isPlaying=!0},stop:function(){this._isComplete=!0,this._isPlaying=!1},play:function(t,e,i,n){this._isPause=this._isComplete=!1,this._isPlaying=!0,this._currentFrame=0,this._nextFrameIndex=t,this._tweenEasing=n},update:function(t){if(!(this._isComplete||this._isPause||0>=this._rawDuration||t>1)){var e=void 0===this._nextFrameIndex?0:this._nextFrameIndex,i=this._currentFrame;0>=e?(this._currentPercent=1,i=0):(i+=t/this.animationInternal*this._processScale,this._currentPercent=i/e,i=ccs.fmodf(i,e)),this._currentFrame=i,this.updateHandler()}},gotoFrame:function(t){var e=this._loopType;e===ccs.ANIMATION_TYPE_NO_LOOP?e=ccs.ANIMATION_TYPE_MAX:e===ccs.ANIMATION_TYPE_TO_LOOP_FRONT&&(e=ccs.ANIMATION_TYPE_LOOP_FRONT),this._loopType=e,this._curFrameIndex=t,this._nextFrameIndex=this._durationTween},getCurrentFrameIndex:function(){return this._curFrameIndex=(this._rawDuration-1)*this._currentPercent},updateHandler:function(){},isPause:function(){return this._isPause},isComplete:function(){return this._isComplete},getCurrentPercent:function(){return this._currentPercent},getRawDuration:function(){return this._rawDuration},getLoop:function(){return this._loopType},getTweenEasing:function(){return this._tweenEasing},getAnimationInternal:function(){return this.animationInternal},setAnimationInternal:function(t){this.animationInternal=t},getProcessScale:function(){return this._processScale},setProcessScale:function(t){this._processScale=t},isPlaying:function(){return this._isPlaying}}),_p=ccs.ProcessBase.prototype,cc.defineGetterSetter(_p,"currentFrameIndex",_p.getCurrentFrameIndex),cc.defineGetterSetter(_p,"paused",_p.isPause),cc.defineGetterSetter(_p,"completed",_p.isComplete),cc.defineGetterSetter(_p,"currentPercent",_p.getCurrentPercent),cc.defineGetterSetter(_p,"rawDuration",_p.getRawDuration),cc.defineGetterSetter(_p,"loop",_p.getLoop),cc.defineGetterSetter(_p,"tweenEasing",_p.getTweenEasing),cc.defineGetterSetter(_p,"playing",_p.isPlaying),_p=null,ccs.MovementEventType={start:0,complete:1,loopComplete:2},ccs.AnimationEvent=ccs.Class.extend({_arguments:null,_callFunc:null,_selectorTarget:null,ctor:function(t,e,i){this._data=i,this._callFunc=t,this._selectorTarget=e},call:function(){this._callFunc&&this._callFunc.apply(this._selectorTarget,this._arguments)},setArguments:function(t){this._arguments=t}}),ccs.MovementEvent=function(){this.armature=null,this.movementType=ccs.MovementEventType.start,this.movementID=""},ccs.FrameEvent=function(){this.bone=null,this.frameEventName="",this.currentFrameIndex=this.originFrameIndex=0},ccs.ArmatureAnimation=ccs.ProcessBase.extend({_animationData:null,_movementData:null,_armature:null,_movementID:"",_toIndex:0,_tweenList:null,_speedScale:1,_ignoreFrameEvent:!1,_frameEventQueue:null,_movementEventQueue:null,_movementList:null,_onMovementList:!1,_movementListLoop:!1,_movementIndex:0,_movementListDurationTo:-1,_movementEventCallFunc:null,_frameEventCallFunc:null,_movementEventTarget:null,_frameEventTarget:null,_movementEventListener:null,_frameEventListener:null,ctor:function(t){ccs.ProcessBase.prototype.ctor.call(this),this._tweenList=[],this._movementList=[],this._frameEventQueue=[],this._movementEventQueue=[],this._armature=null,t&&ccs.ArmatureAnimation.prototype.init.call(this,t)},init:function(t){return this._armature=t,this._tweenList.length=0,!0},pause:function(){for(var t=this._tweenList,e=0;e<t.length;e++)t[e].pause();ccs.ProcessBase.prototype.pause.call(this)},resume:function(){for(var t=this._tweenList,e=0;e<t.length;e++)t[e].resume();ccs.ProcessBase.prototype.resume.call(this)},stop:function(){for(var t=this._tweenList,e=0;e<t.length;e++)t[e].stop();t.length=0,ccs.ProcessBase.prototype.stop.call(this)},setAnimationScale:function(t){this.setSpeedScale(t)},getAnimationScale:function(){return this.getSpeedScale()},setSpeedScale:function(t){if(t!==this._speedScale){this._speedScale=t,this._processScale=this._movementData?this._speedScale*this._movementData.scale:this._speedScale,t=this._armature.getBoneDic();for(var e in t){var i=t[e];i.getTween().setProcessScale(this._processScale),i.getChildArmature()&&i.getChildArmature().getAnimation().setSpeedScale(this._processScale)}}},getSpeedScale:function(){return this._speedScale},play:function(t,e,i){cc.assert(this._animationData,"this.animationData can not be null"),this._movementData=this._animationData.getMovement(t),cc.assert(this._movementData,"this._movementData can not be null"),e=void 0===e?-1:e,i=void 0===i?-1:i,this._rawDuration=this._movementData.duration,this._movementID=t,this._processScale=this._speedScale*this._movementData.scale,e=-1===e?this._movementData.durationTo:e,t=0===this._movementData.durationTween?this._rawDuration:this._movementData.durationTween;var n=this._movementData.tweenEasing;i=0>i?this._movementData.loop:i,this._onMovementList=!1,ccs.ProcessBase.prototype.play.call(this,e,t,i,n),0===this._rawDuration?this._loopType=ccs.ANIMATION_TYPE_SINGLE_FRAME:(this._loopType=i?ccs.ANIMATION_TYPE_TO_LOOP_FRONT:ccs.ANIMATION_TYPE_NO_LOOP,this._durationTween=t),this._tweenList.length=0;var r,o,s=this._armature.getBoneDic();for(o in s){var c=s[o];r=this._movementData.movBoneDataDic[c.getName()];var a=c.getTween();r&&0<r.frameList.length?(this._tweenList.push(a),r.duration=this._movementData.duration,a.play(r,e,t,i,n),a.setProcessScale(this._processScale),c.getChildArmature()&&c.getChildArmature().getAnimation().setSpeedScale(this._processScale)):c.isIgnoreMovementBoneData()||(c.getDisplayManager().changeDisplayWithIndex(-1,!1),a.stop())}this._armature.update(0)},playByIndex:function(t,e,i,n){cc.log("playByIndex is deprecated. Use playWithIndex instead."),this.playWithIndex(t,e,n)},playWithIndex:function(t,e,i){var n=this._animationData.movementNames;cc.assert(t>-1&&t<n.length),this.play(n[t],e,i)},playWithNames:function(t,e,i){this._movementListLoop=void 0===i?!0:i,this._movementListDurationTo=void 0===e?-1:e,this._onMovementList=!0,this._movementIndex=0,t instanceof Array?this._movementList=t:this._movementList.length=0,this.updateMovementList()},playWithIndexes:function(t,e,i){for(this._movementList.length=0,this._movementListLoop=void 0===i?!0:i,this._movementListDurationTo=void 0===e?-1:e,this._onMovementList=!0,this._movementIndex=0,e=this._animationData.movementNames,i=0;i<t.length;i++)this._movementList.push(e[t[i]]);this.updateMovementList()},gotoAndPlay:function(t){if(!this._movementData||0>t||t>=this._movementData.duration)cc.log("Please ensure you have played a movement, and the frameIndex is in the range.");else{var e=this._ignoreFrameEvent;this._isPlaying=this._ignoreFrameEvent=!0,this._isComplete=this._isPause=!1,ccs.ProcessBase.prototype.gotoFrame.call(this,t),this._currentPercent=this._curFrameIndex/(this._movementData.duration-1),this._currentFrame=this._nextFrameIndex*this._currentPercent;for(var i=this._tweenList,n=0;n<i.length;n++)i[n].gotoAndPlay(t);this._armature.update(0),this._ignoreFrameEvent=e}},gotoAndPause:function(t){this.gotoAndPlay(t),this.pause()},getMovementCount:function(){return this._animationData.getMovementCount()},update:function(t){ccs.ProcessBase.prototype.update.call(this,t);for(var e=this._tweenList,i=0;i<e.length;i++)e[i].update(t);for(e=this._frameEventQueue;0<e.length;)t=e.shift(),this._ignoreFrameEvent=!0,this._frameEventCallFunc&&this._frameEventCallFunc.call(this._frameEventTarget,t.bone,t.frameEventName,t.originFrameIndex,t.currentFrameIndex),this._frameEventListener&&this._frameEventListener(t.bone,t.frameEventName,t.originFrameIndex,t.currentFrameIndex),this._ignoreFrameEvent=!1;for(e=this._movementEventQueue;0<e.length;)t=e.shift(),this._movementEventCallFunc&&this._movementEventCallFunc.call(this._movementEventTarget,t.armature,t.movementType,t.movementID),this._movementEventListener&&this._movementEventListener(t.armature,t.movementType,t.movementID)},updateHandler:function(){var t=this._currentPercent;if(t>=1){switch(this._loopType){case ccs.ANIMATION_TYPE_NO_LOOP:if(this._loopType=ccs.ANIMATION_TYPE_MAX,this._currentFrame=(t-1)*this._nextFrameIndex,t=this._currentFrame/this._durationTween,1>t){this._nextFrameIndex=this._durationTween,this.movementEvent(this._armature,ccs.MovementEventType.start,this._movementID);break}break;case ccs.ANIMATION_TYPE_MAX:case ccs.ANIMATION_TYPE_SINGLE_FRAME:t=1,this._isComplete=!0,this._isPlaying=!1,this.movementEvent(this._armature,ccs.MovementEventType.complete,this._movementID),this.updateMovementList();break;case ccs.ANIMATION_TYPE_TO_LOOP_FRONT:this._loopType=ccs.ANIMATION_TYPE_LOOP_FRONT,t=ccs.fmodf(t,1),this._currentFrame=0===this._nextFrameIndex?0:ccs.fmodf(this._currentFrame,this._nextFrameIndex),this._nextFrameIndex=0<this._durationTween?this._durationTween:1,this.movementEvent(this,ccs.MovementEventType.start,this._movementID);break;default:this._currentFrame=ccs.fmodf(this._currentFrame,this._nextFrameIndex),this._toIndex=0,this.movementEvent(this._armature,ccs.MovementEventType.loopComplete,this._movementID)}this._currentPercent=t}},getCurrentMovementID:function(){return this._isComplete?"":this._movementID},setMovementEventCallFunc:function(t,e){1===arguments.length?this._movementEventListener=t:2===arguments.length&&(this._movementEventTarget=e,this._movementEventCallFunc=t)},setFrameEventCallFunc:function(t,e){1===arguments.length?this._frameEventListener=t:2===arguments.length&&(this._frameEventTarget=e,this._frameEventCallFunc=t)},setUserObject:function(t){this._userObject=t},frameEvent:function(t,e,i,n){if(this._frameEventTarget&&this._frameEventCallFunc||this._frameEventListener){var r=new ccs.FrameEvent;r.bone=t,r.frameEventName=e,r.originFrameIndex=i,r.currentFrameIndex=n,this._frameEventQueue.push(r)}},movementEvent:function(t,e,i){if(this._movementEventTarget&&this._movementEventCallFunc||this._movementEventListener){var n=new ccs.MovementEvent;n.armature=t,n.movementType=e,n.movementID=i,this._movementEventQueue.push(n)}},updateMovementList:function(){if(this._onMovementList){var t,e=this._movementList;this._movementListLoop?(t=e[this._movementIndex],this.play(t,t.durationTo,0),this._movementIndex++,this._movementIndex>=e.length&&(this._movementIndex=0)):this._movementIndex<e.length?(t=e[this._movementIndex],this.play(t,t.durationTo,0),this._movementIndex++):this._onMovementList=!1,this._onMovementList=!0}},setAnimationData:function(t){this._animationData!==t&&(this._animationData=t)},getAnimationData:function(){return this._animationData},getUserObject:function(){return this._userObject},isIgnoreFrameEvent:function(){return this._ignoreFrameEvent}}),_p=ccs.ArmatureAnimation.prototype,cc.defineGetterSetter(_p,"speedScale",_p.getSpeedScale,_p.setSpeedScale),cc.defineGetterSetter(_p,"animationScale",_p.getAnimationScale,_p.setAnimationScale),_p=null,ccs.ArmatureAnimation.create=function(t){return new ccs.ArmatureAnimation(t)},ccs.Tween=ccs.ProcessBase.extend({_tweenData:null,_to:null,_from:null,_between:null,_movementBoneData:null,_bone:null,_frameTweenEasing:0,_betweenDuration:0,_totalDuration:0,_toIndex:0,_fromIndex:0,_animation:null,_passLastFrame:!1,ctor:function(t){ccs.ProcessBase.prototype.ctor.call(this),this._frameTweenEasing=ccs.TweenType.LINEAR,ccs.Tween.prototype.init.call(this,t)},init:function(t){return this._from=new ccs.FrameData,this._between=new ccs.FrameData,this._bone=t,this._tweenData=this._bone.getTweenData(),this._tweenData.displayIndex=-1,this._animation=null!==this._bone&&null!==this._bone.getArmature()?this._bone.getArmature().getAnimation():null,!0},play:function(t,e,i,n,r){ccs.ProcessBase.prototype.play.call(this,e,i,n,r),this._loopType=n?ccs.ANIMATION_TYPE_TO_LOOP_FRONT:ccs.ANIMATION_TYPE_NO_LOOP,this._fromIndex=this._toIndex=this._betweenDuration=this._totalDuration=0,r=t!==this._movementBoneData,this.setMovementBoneData(t),this._rawDuration=this._movementBoneData.duration,t=this._movementBoneData.getFrameData(0),this._tweenData.displayIndex=t.displayIndex,this._bone.getArmature().getArmatureData().dataVersion>=ccs.CONST_VERSION_COMBINED&&(ccs.TransformHelp.nodeSub(this._tweenData,this._bone.getBoneData()),this._tweenData.scaleX+=1,this._tweenData.scaleY+=1),0===this._rawDuration?(this._loopType=ccs.ANIMATION_TYPE_SINGLE_FRAME,0===e?this.setBetween(t,t):this.setBetween(this._tweenData,t),this._frameTweenEasing=ccs.TweenType.LINEAR):1<this._movementBoneData.frameList.length&&(this._durationTween=i*this._movementBoneData.scale,n&&0!==this._movementBoneData.delay?this.setBetween(this._tweenData,this.tweenNodeTo(this.updateFrameData(1-this._movementBoneData.delay),this._between)):r&&0!==e?this.setBetween(this._tweenData,t):this.setBetween(t,t)),this.tweenNodeTo(0)},gotoAndPlay:function(t){ccs.ProcessBase.prototype.gotoFrame.call(this,t),this._fromIndex=this._toIndex=this._betweenDuration=this._totalDuration=0,this._isPlaying=!0,this._isComplete=this._isPause=!1,this._currentPercent=this._curFrameIndex/(this._rawDuration-1),this._currentFrame=this._nextFrameIndex*this._currentPercent},gotoAndPause:function(t){this.gotoAndPlay(t),this.pause()},updateHandler:function(){var t=null==this._currentPercent?1:this._currentPercent,e=this._loopType;if(t>=1)switch(e){case ccs.ANIMATION_TYPE_SINGLE_FRAME:t=1,this._isComplete=!0,this._isPlaying=!1;break;case ccs.ANIMATION_TYPE_NO_LOOP:e=ccs.ANIMATION_TYPE_MAX,t=0>=this._durationTween?1:(t-1)*this._nextFrameIndex/this._durationTween,t>=1?(t=1,this._isComplete=!0,this._isPlaying=!1):(this._nextFrameIndex=this._durationTween,this._currentFrame=t*this._nextFrameIndex,this._fromIndex=this._toIndex=this._betweenDuration=this._totalDuration=0);break;case ccs.ANIMATION_TYPE_TO_LOOP_FRONT:e=ccs.ANIMATION_TYPE_LOOP_FRONT,this._nextFrameIndex=0<this._durationTween?this._durationTween:1,0!==this._movementBoneData.delay?(this._currentFrame=(1-this._movementBoneData.delay)*this._nextFrameIndex,t=this._currentFrame/this._nextFrameIndex):this._currentFrame=t=0,this._fromIndex=this._toIndex=this._betweenDuration=this._totalDuration=0;break;case ccs.ANIMATION_TYPE_MAX:t=1,this._isComplete=!0,this._isPlaying=!1;break;default:this._currentFrame=ccs.fmodf(this._currentFrame,this._nextFrameIndex)}1>t&&e<ccs.ANIMATION_TYPE_TO_LOOP_BACK&&(t=Math.sin(t*cc.PI/2)),this._currentPercent=t,this._loopType=e,e>ccs.ANIMATION_TYPE_TO_LOOP_BACK&&(t=this.updateFrameData(t)),this._frameTweenEasing!==ccs.TweenType.TWEEN_EASING_MAX&&this.tweenNodeTo(t)},setBetween:function(t,e,i){void 0===i&&(i=!0),0>t.displayIndex&&0<=e.displayIndex?(this._from.copy(e),this._between.subtract(e,e,i)):0>e.displayIndex&&0<=t.displayIndex?(this._from.copy(t),this._between.subtract(e,e,i)):(this._from.copy(t),this._between.subtract(t,e,i)),t.isTween||(this._tweenData.copy(t),this._tweenData.isTween=!0),this.arriveKeyFrame(t)},arriveKeyFrame:function(t){if(t){var e=this._bone,i=e.getDisplayManager(),n=t.displayIndex;i.getForceChangeDisplay()||i.changeDisplayWithIndex(n,!1),this._tweenData.zOrder=t.zOrder,e.updateZOrder(),this._bone.setBlendFunc(t.blendFunc),(e=e.getChildArmature())&&""!==t.movement&&e.getAnimation().play(t.movement)}},tweenNodeTo:function(t,e){e||(e=this._tweenData);var i=this._from,n=this._between;return i.isTween||(t=0),e.x=i.x+t*n.x,e.y=i.y+t*n.y,e.scaleX=i.scaleX+t*n.scaleX,e.scaleY=i.scaleY+t*n.scaleY,e.skewX=i.skewX+t*n.skewX,e.skewY=i.skewY+t*n.skewY,this._bone.setTransformDirty(!0),e&&n.isUseColorInfo&&this.tweenColorTo(t,e),e},tweenColorTo:function(t,e){var i=this._from,n=this._between;e.a=i.a+t*n.a,e.r=i.r+t*n.r,e.g=i.g+t*n.g,e.b=i.b+t*n.b,this._bone.updateColor()},updateFrameData:function(t){t>1&&0!==this._movementBoneData.delay&&(t=ccs.fmodf(t,1)),t*=this._rawDuration-1;var e,i,n=this._totalDuration,r=this._betweenDuration,o=this._toIndex;if(n>t||t>=n+r){var r=this._movementBoneData.frameList,s=r.length;if(t<r[0].frameID)return e=i=r[0],this.setBetween(e,i),this._currentPercent;if(t>=r[s-1].frameID){if(this._passLastFrame)return e=i=r[s-1],this.setBetween(e,i),this._currentPercent;this._passLastFrame=!0}else this._passLastFrame=!1;do if(this._fromIndex=o,e=r[this._fromIndex],n=e.frameID,o=this._fromIndex+1,o>=s&&(o=0),i=r[o],e.strEvent&&!this._animation.isIgnoreFrameEvent()&&this._animation.frameEvent(this._bone,e.strEvent,e.frameID,t),t===e.frameID||this._passLastFrame&&this._fromIndex===s-1)break;while(t<e.frameID||t>=i.frameID);r=i.frameID-e.frameID,this._frameTweenEasing=e.tweenEasing,this.setBetween(e,i,!1),this._totalDuration=n,this._betweenDuration=r,this._toIndex=o}return t=0===r?0:(t-this._totalDuration)/this._betweenDuration,e=this._frameTweenEasing!==ccs.TweenType.LINEAR?this._frameTweenEasing:this._tweenEasing,e===ccs.TweenType.TWEEN_EASING_MAX||e===ccs.TweenType.LINEAR||this._passLastFrame||(t=ccs.TweenFunction.tweenTo(t,e,this._from.easingParams)),t},setAnimation:function(t){this._animation=t},getAnimation:function(){return this._animation},setMovementBoneData:function(t){this._movementBoneData=t}}),_p=ccs.Tween.prototype,cc.defineGetterSetter(_p,"animation",_p.getAnimation,_p.setAnimation),_p=null,ccs.Tween.create=function(t){return new ccs.Tween(t)},ccs.PT_RATIO=32,ccs.ColliderFilter=ccs.Class.extend({_collisionType:0,_group:0,_categoryBits:0,_groupIndex:0,_maskBits:0,ctor:function(t,e){this._collisionType=t||0,this._group=e||0},updateShape:function(t){if(t instanceof cp.Shape)t.collision_type=this._collisionType,t.group=this._group;else if(t instanceof Box2D.b2FilterData){var e=new Box2D.b2FilterData;e.categoryBits=this._categoryBits,e.groupIndex=this._groupIndex,e.maskBits=this._maskBits,t.SetFilterData(e)}}}),ccs.ColliderBody=ccs.Class.extend({shape:null,coutourData:null,colliderFilter:null,_calculatedVertexList:null,ctor:function(t){this.shape=null,this.coutourData=t,this.colliderFilter=new ccs.ColliderFilter,ccs.ENABLE_PHYSICS_SAVE_CALCULATED_VERTEX&&(this._calculatedVertexList=[])},getContourData:function(){return this.coutourData},setColliderFilter:function(t){this.colliderFilter=t},getCalculatedVertexList:function(){return this._calculatedVertexList},setB2Fixture:function(t){this._fixture=t},getB2Fixture:function(){return this._fixture},setShape:function(t){this.shape=t},getShape:function(){return this.shape},setContourData:function(t){this.coutourData=t},getColliderFilter:function(){return this.colliderFilter}}),ccs.ColliderDetector=ccs.Class.extend({_colliderBodyList:null,_bone:null,_body:null,_active:!1,_filter:null,helpPoint:cc.p(0,0),ctor:function(t){this._colliderBodyList=[],this._body=this._bone=null,this._active=!1,this._filter=null,ccs.ColliderDetector.prototype.init.call(this,t)},init:function(t){return this._colliderBodyList.length=0,t&&(this._bone=t),this._filter=new ccs.ColliderFilter,!0},addContourData:function(t){var e=new ccs.ColliderBody(t);if(this._colliderBodyList.push(e),ccs.ENABLE_PHYSICS_SAVE_CALCULATED_VERTEX){e=e.getCalculatedVertexList(),t=t.vertexList;for(var i=0;i<t.length;i++){var n=new ccs.ContourVertex2(0,0);e.push(n)}}},addContourDataList:function(t){for(var e=0;e<t.length;e++)this.addContourData(t[e])},removeContourData:function(t){var e,i=[],n=this._colliderBodyList;for(e=0;e<n.length;e++){var r=n[e];r&&r.getContourData()===t&&i.push(r)}for(e=0;e<i.length;e++)cc.arrayRemoveObject(n,i[e])},removeAll:function(){this._colliderBodyList.length=0},setActive:function(t){if(this._active!==t){this._active=t,t=this._body;var e;if(t)if(e=null,this._active)for(var i=0;i<this._colliderBodyList.length;i++)e=this._colliderBodyList[i],e=e.getShape(),t.space.addShape(e);else for(i=0;i<this._colliderBodyList.length;i++)e=this._colliderBodyList[i],e=e.getShape(),t.space.removeShape(e)}},getActive:function(){return this._active},getColliderBodyList:function(){return this._colliderBodyList},setColliderFilter:function(t){this._filter=t;for(var e=this._colliderBodyList,i=0;i<e.length;i++){var n=e[i];n.setColliderFilter(t),n.getShape()&&n.getColliderFilter().updateShape(n.getShape())}},getColliderFilter:function(){return this._filter},updateTransform:function(t){if(this._active)for(var e=null,i=this._body,n=this.helpPoint,r=0;r<this._colliderBodyList.length;r++){var e=this._colliderBodyList[r],o=e.getContourData(),s=null;i&&(s=e.getShape());for(var o=o.vertexList,c=e.getCalculatedVertexList(),e=0;e<o.length;e++){if(n.x=o[e].x,n.y=o[e].y,n=cc.pointApplyAffineTransform(n,t),ccs.ENABLE_PHYSICS_SAVE_CALCULATED_VERTEX){var a=cc.p(0,0);a.x=n.x,a.y=n.y,c[e]=a}s&&(s.verts[2*e]=n.x,s.verts[2*e+1]=n.y)}if(s)for(e=0;e<o.length;e++)c=cp.v.normalize(cp.v.perp(cp.v.sub(s.verts[(e+1)%s.verts.length],s.verts[e]))),s.planes&&(s.planes[e].n=c,s.planes[e].d=cp.v.dot(c,s.verts[e]))}},setBody:function(t){this._body=t;for(var e=this._colliderBodyList,i=0;i<e.length;i++){t=e[i];for(var n=[],r=t.getContourData().vertexList,o=0;o<r.length;o++){var s=r[o];n.push(s.x),n.push(s.y)}n=new cp.PolyShape(this._body,n,cp.vzero),n.sensor=!0,n.data=this._bone,this._active&&this._body.space.addShape(n),t.setShape(n),t.getColliderFilter().updateShape(n)}},getBody:function(){return this._body}}),_p=ccs.ColliderDetector.prototype,cc.defineGetterSetter(_p,"colliderFilter",_p.getColliderFilter,_p.setColliderFilter),cc.defineGetterSetter(_p,"active",_p.getActive,_p.setActive),cc.defineGetterSetter(_p,"body",_p.getBody,_p.setBody),_p=null,ccs.ColliderDetector.create=function(t){return new ccs.ColliderDetector(t)},ccs.Armature=ccs.Node.extend({animation:null,armatureData:null,batchNode:null,_textureAtlas:null,_parentBone:null,_boneDic:null,_topBoneList:null,_armatureIndexDic:null,_offsetPoint:null,version:0,_armatureTransformDirty:!0,_body:null,_blendFunc:null,_className:"Armature",ctor:function(t,e){cc.Node.prototype.ctor.call(this),this._name="",this._topBoneList=[],this._armatureIndexDic={},this._offsetPoint=cc.p(0,0),this._armatureTransformDirty=!0,this._blendFunc={src:cc.BLEND_SRC,dst:cc.BLEND_DST},t&&ccs.Armature.prototype.init.call(this,t,e)},init:function(t,e){cc.Node.prototype.init.call(this),e&&(this._parentBone=e),this.removeAllChildren(),this.animation=new ccs.ArmatureAnimation,this.animation.init(this),this._boneDic={},this._topBoneList.length=0;var i,n=ccs.armatureDataManager;if(""!==t){i=n.getAnimationData(t),cc.assert(i,"AnimationData not exist!"),this.animation.setAnimationData(i),n=n.getArmatureData(t),cc.assert(n,"ArmatureData not exist!"),this.armatureData=n;var r,n=n.getBoneDataDic();for(r in n){var n=this.createBone(String(r)),o=i.getMovement(i.movementNames[0]);
o&&(o=o.getMovementBoneData(n.getName()))&&!(0>=o.frameList.length)&&(o=o.getFrameData(0))&&(n.getTweenData().copy(o),n.changeDisplayWithIndex(o.displayIndex,!1))}this.update(0),this.updateOffsetPoint()}else t="new_armature",this.armatureData=new ccs.ArmatureData,this.armatureData.name=t,i=new ccs.AnimationData,i.name=t,n.addArmatureData(t,this.armatureData),n.addAnimationData(t,i),this.animation.setAnimationData(i);return this._renderCmd.initShaderCache(),this.setCascadeOpacityEnabled(!0),this.setCascadeColorEnabled(!0),!0},addChild:function(t,e,i){t instanceof ccui.Widget?cc.log("Armature doesn't support to add Widget as its child, it will be fix soon."):cc.Node.prototype.addChild.call(this,t,e,i)},createBone:function(t){var e=this.getBone(t);if(e)return e;var e=this.armatureData.getBoneData(t),i=e.parentName,n=null;return i?(this.createBone(i),n=new ccs.Bone(t),this.addBone(n,i)):(n=new ccs.Bone(t),this.addBone(n,"")),n.setBoneData(e),n.getDisplayManager().changeDisplayWithIndex(-1,!1),n},addBone:function(t,e){cc.assert(t,"Argument must be non-nil");var i=this._boneDic;if(t.getName()&&cc.assert(!i[t.getName()],"bone already added. It can't be added again"),e){var n=i[e];n?n.addChildBone(t):this._topBoneList.push(t)}else this._topBoneList.push(t);t.setArmature(this),i[t.getName()]=t,this.addChild(t)},removeBone:function(t,e){cc.assert(t,"bone must be added to the bone dictionary!"),t.setArmature(null),t.removeFromParent(e),cc.arrayRemoveObject(this._topBoneList,t),delete this._boneDic[t.getName()],this.removeChild(t,!0)},getBone:function(t){return this._boneDic[t]},changeBoneParent:function(t,e){cc.assert(t,"bone must be added to the bone dictionary!");var i=t.getParentBone();i&&(cc.arrayRemoveObject(i.getChildren(),t),t.setParentBone(null)),e&&((i=this._boneDic[e])?(i.addChildBone(t),cc.arrayRemoveObject(this._topBoneList,t)):this._topBoneList.push(t))},getBoneDic:function(){return this._boneDic},updateOffsetPoint:function(){var t=this.getBoundingBox();this.setContentSize(t);var e=this._offsetPoint;e.x=-t.x,e.y=-t.y,0!==t.width&&0!==t.height&&this.setAnchorPoint(e.x/t.width,e.y/t.height)},getOffsetPoints:function(){return{x:this._offsetPoint.x,y:this._offsetPoint.y}},setAnimation:function(t){this.animation=t},getAnimation:function(){return this.animation},getArmatureTransformDirty:function(){return this._armatureTransformDirty},update:function(t){this.animation.update(t);for(var e=this._topBoneList,i=0;i<e.length;i++)e[i].update(t);this._armatureTransformDirty=!1},onEnter:function(){cc.Node.prototype.onEnter.call(this),this.scheduleUpdate()},onExit:function(){cc.Node.prototype.onExit.call(this),this.unscheduleUpdate()},getBoundingBox:function(){for(var t,e,i,n=0,r=!0,o=cc.rect(0,0,0,0),s=this._children,c=s.length,a=0;c>a;a++)(t=s[a])&&(n=t.getDisplayManager().getBoundingBox(),(0!==n.x||0!==n.y||0!==n.width||0!==n.height)&&(r?(t=n.x,e=n.y,i=n.x+n.width,n=n.y+n.height,r=!1):(t=n.x<o.x?n.x:o.x,e=n.y<o.y?n.y:o.y,i=n.x+n.width>o.x+o.width?n.x+n.width:o.x+o.width,n=n.y+n.height>o.y+o.height?n.y+n.height:o.y+o.height),o.x=t,o.y=e,o.width=i-t,o.height=n-e));return cc.rectApplyAffineTransform(o,this.getNodeToParentTransform())},getBoneAtPoint:function(t,e){for(var i=this._children,n=i.length-1;n>=0;n--){var r=i[n];if(r instanceof ccs.Bone&&r.getDisplayManager().containPoint(t,e))return r}return null},setParentBone:function(t){this._parentBone=t,t=this._boneDic;for(var e in t)t[e].setArmature(this)},getParentBone:function(){return this._parentBone},drawContour:function(){cc._drawingUtil.setDrawColor(255,255,255,255),cc._drawingUtil.setLineWidth(1);var t,e=this._boneDic;for(t in e){var i=e[t].getColliderDetector();if(i)for(var i=i.getColliderBodyList(),n=0;n<i.length;n++){var r=i[n].getCalculatedVertexList();cc._drawingUtil.drawPoly(r,r.length,!0)}}},setBody:function(t){if(this._body!==t){this._body=t,this._body.data=this;var e,i;t=this._children;for(var n=0;n<t.length;n++)if(e=t[n],e instanceof ccs.Bone){e=e.getDisplayManager().getDecorativeDisplayList();for(var r=0;r<e.length;r++)i=e[r],(i=i.getColliderDetector())&&i.setBody(this._body)}}},getShapeList:function(){return this._body?this._body.shapeList:null},getBody:function(){return this._body},setBlendFunc:function(t,e){void 0===e?(this._blendFunc.src=t.src,this._blendFunc.dst=t.dst):(this._blendFunc.src=t,this._blendFunc.dst=e)},getBlendFunc:function(){return new cc.BlendFunc(this._blendFunc.src,this._blendFunc.dst)},setColliderFilter:function(t){var e,i=this._boneDic;for(e in i)i[e].setColliderFilter(t)},getArmatureData:function(){return this.armatureData},setArmatureData:function(t){this.armatureData=t},getBatchNode:function(){return this.batchNode},setBatchNode:function(t){this.batchNode=t},getVersion:function(){return this.version},setVersion:function(t){this.version=t},_createRenderCmd:function(){return cc._renderType===cc._RENDER_TYPE_CANVAS?new ccs.Armature.CanvasRenderCmd(this):new ccs.Armature.WebGLRenderCmd(this)}}),_p=ccs.Armature.prototype,cc.defineGetterSetter(_p,"parentBone",_p.getParentBone,_p.setParentBone),cc.defineGetterSetter(_p,"body",_p.getBody,_p.setBody),cc.defineGetterSetter(_p,"colliderFilter",null,_p.setColliderFilter),_p=null,ccs.Armature.create=function(t,e){return new ccs.Armature(t,e)},function(){ccs.Armature.RenderCmd={_updateAnchorPointInPoint:function(){var t=this._node,e=t._contentSize,i=t._anchorPoint,t=t._offsetPoint;this._anchorPointInPoints.x=e.width*i.x-t.x,this._anchorPointInPoints.y=e.height*i.y-t.y,this._realAnchorPointInPoints.x=e.width*i.x,this._realAnchorPointInPoints.y=e.height*i.y,this.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getAnchorPointInPoints:function(){return cc.p(this._realAnchorPointInPoints)}}}(),function(){ccs.Armature.CanvasRenderCmd=function(t){cc.Node.CanvasRenderCmd.call(this,t),this._needDraw=!0,this._realAnchorPointInPoints=new cc.Point(0,0),this._startRenderCmd=new cc.CustomRenderCmd(this,this._startCmdCallback),this._RestoreRenderCmd=new cc.CustomRenderCmd(this,this._RestoreCmdCallback)};var t=ccs.Armature.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);cc.inject(ccs.Armature.RenderCmd,t),t.constructor=ccs.Armature.CanvasRenderCmd,t._startCmdCallback=function(t,e,i){var n=this._node._parent;this.transform(n?n._renderCmd:null),t=t||cc._renderContext,t.save(),t._switchToArmatureMode(!0,this._worldTransform,e,i)},t.transform=function(t,e){ccs.Node.CanvasRenderCmd.prototype.transform.call(this,t,e);for(var i=this._node._children,n=0,r=i.length;r>n;n++){var o=i[n];if(o&&o.getDisplayRenderNode){var s=o.getDisplayRenderNode();if(s&&s._renderCmd){s=s._renderCmd,s.transform(null);var c=o._renderCmd._displayedColor,o=o._renderCmd._displayedOpacity,a=cc.Node._dirtyFlags,l=s._dirtyFlag,h=l&a.opacityDirty;l&a.colorDirty&&s._updateDisplayColor(c),h&&s._updateDisplayOpacity(o)}}}},t._RestoreCmdCallback=function(t){this._cacheDirty=!1,t._switchToArmatureMode(!1),t.restore()},t.initShaderCache=function(){},t.setShaderProgram=function(){},t.updateChildPosition=function(t,e){cc.renderer.pushRenderCommand(e._renderCmd)},t.rendering=function(t,e,i){for(var n=this._node._children,r=cc.BlendFunc.ALPHA_PREMULTIPLIED,o=cc.BlendFunc.ALPHA_NON_PREMULTIPLIED,s=0,c=n.length;c>s;s++){var a=n[s];if(a&&a.getDisplayRenderNode){var l=a.getDisplayRenderNode();if(null!==l)switch(a.getDisplayRenderNodeType()){case ccs.DISPLAY_TYPE_SPRITE:l instanceof ccs.Skin&&this.updateChildPosition(t,l,a,r,o);break;case ccs.DISPLAY_TYPE_ARMATURE:l._renderCmd.rendering(t,e,i);break;default:l.visit(this)}}else a instanceof cc.Node&&this._visitNormalChild(a)}},t._visitNormalChild=function(t){if(null!=t){var e=t._renderCmd;if(t._visible){e._curLevel=this._curLevel+1;var i,n=t._children;e._syncStatus(this),e.transform(null);var r=n.length;if(r>0){for(t.sortAllChildren(),t=0;r>t&&(i=n[t],0>i._localZOrder);t++)i._renderCmd.visit(e);for(cc.renderer.pushRenderCommand(e);r>t;t++)n[t]._renderCmd.visit(e)}else cc.renderer.pushRenderCommand(e);this._dirtyFlag=0}}},t.visit=function(t){var e=this._node;e._visible&&(this.updateStatus(t),e.sortAllChildren(),cc.renderer.pushRenderCommand(this._startRenderCmd),this.rendering(),cc.renderer.pushRenderCommand(this._RestoreRenderCmd),this._cacheDirty=!1)}}(),function(){ccs.Armature.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._realAnchorPointInPoints=new cc.Point(0,0)};var t=ccs.Armature.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);cc.inject(ccs.Armature.RenderCmd,t),t.constructor=ccs.Armature.WebGLRenderCmd,t.rendering=function(t,e){var i=this._node;e||(cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW),cc.kmGLPushMatrix(),cc.kmGLLoadMatrix(this._stackMatrix));for(var n=i._children,r=cc.BlendFunc.ALPHA_PREMULTIPLIED,o=cc.BlendFunc.ALPHA_NON_PREMULTIPLIED,s=0,c=n.length;c>s;s++){var a=n[s];if(a&&a.getDisplayRenderNode){var l=a.getDisplayRenderNode();if(null!==l)switch(l.setShaderProgram(this._shaderProgram),a.getDisplayRenderNodeType()){case ccs.DISPLAY_TYPE_SPRITE:if(l instanceof ccs.Skin){this._updateColorAndOpacity(l._renderCmd,a),l.updateTransform();var h=a.getBlendFunc();l.setBlendFunc(h.src!==r.src||h.dst!==r.dst?a.getBlendFunc():i._blendFunc.src!==r.src||i._blendFunc.dst!==r.dst||l.getTexture().hasPremultipliedAlpha()?i._blendFunc:o),l._renderCmd.rendering(t)}break;case ccs.DISPLAY_TYPE_ARMATURE:l._renderCmd.rendering(t,!0);break;default:l._renderCmd.transform(),l._renderCmd.rendering(t)}}else a instanceof cc.Node&&(a.setShaderProgram(this._shaderProgram),a._renderCmd.transform(),a._renderCmd.rendering&&a._renderCmd.rendering(t))}e||cc.kmGLPopMatrix()},t.initShaderCache=function(){this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURECOLOR)},t.setShaderProgram=function(t){this._shaderProgram=t},t._updateColorAndOpacity=function(t,e){var i=e._renderCmd._displayedColor,n=e._renderCmd._displayedOpacity,r=cc.Node._dirtyFlags,o=t._dirtyFlag,s=o&r.colorDirty,r=o&r.opacityDirty;s&&t._updateDisplayColor(i),r&&t._updateDisplayOpacity(n),(s||r)&&t._updateColor()},t.updateChildPosition=function(t,e,i,n,r){var o=this._node;e.updateTransform();var s=i.getBlendFunc();e.setBlendFunc(s.src!==n.src||s.dst!==n.dst?i.getBlendFunc():o._blendFunc.src!==n.src||node_blendFunc.dst!==n.dst||e.getTexture().hasPremultipliedAlpha()?o._blendFunc:r),e.rendering(t)},t.updateStatus=function(){var t=cc.Node._dirtyFlags,e=this._dirtyFlag,i=e&t.colorDirty,t=e&t.opacityDirty;i&&this._updateDisplayColor(),t&&this._updateDisplayOpacity(),(i||t)&&this._updateColor(),this.transform(this.getParentRenderCmd(),!0)},t.visit=function(t){var e=this._node;if(e._visible){var i=cc.current_stack;i.stack.push(i.top),this.updateStatus(t),i.top=this._stackMatrix,e.sortAllChildren(),cc.renderer.pushRenderCommand(this),this._dirtyFlag=0,i.top=i.stack.pop()}}}(),ccs.Bone=ccs.Node.extend({_boneData:null,_armature:null,_childArmature:null,_displayManager:null,ignoreMovementBoneData:!1,_tween:null,_tweenData:null,_parentBone:null,_boneTransformDirty:!1,_worldTransform:null,_blendFunc:null,blendDirty:!1,_worldInfo:null,_armatureParentBone:null,_dataVersion:0,_className:"Bone",ctor:function(t){cc.Node.prototype.ctor.call(this),this._displayManager=this._tween=this._boneData=this._childArmature=this._armature=this._parentBone=this._tweenData=null,this.ignoreMovementBoneData=!1,this._worldTransform=cc.affineTransformMake(1,0,0,1,0,0),this._boneTransformDirty=!0,this._blendFunc=new cc.BlendFunc(cc.BLEND_SRC,cc.BLEND_DST),this.blendDirty=!1,this._armatureParentBone=this._worldInfo=null,this._dataVersion=0,ccs.Bone.prototype.init.call(this,t)},init:function(t){return t&&(this._name=t),this._tweenData=new ccs.FrameData,this._tween=new ccs.Tween(this),this._displayManager=new ccs.DisplayManager(this),this._worldInfo=new ccs.BaseData,this._boneData=new ccs.BaseData,!0},setBoneData:function(t){cc.assert(t,"_boneData must not be null"),this._boneData!==t&&(this._boneData=t),this.setName(this._boneData.name),this._localZOrder=this._boneData.zOrder,this._displayManager.initDisplayList(t)},getBoneData:function(){return this._boneData},setArmature:function(t){(this._armature=t)?(this._tween.setAnimation(this._armature.getAnimation()),this._dataVersion=this._armature.getArmatureData().dataVersion,this._armatureParentBone=this._armature.getParentBone()):this._armatureParentBone=null},getArmature:function(){return this._armature},update:function(t){if(this._parentBone&&(this._boneTransformDirty=this._boneTransformDirty||this._parentBone.isTransformDirty()),this._armatureParentBone&&!this._boneTransformDirty&&(this._boneTransformDirty=this._armatureParentBone.isTransformDirty()),this._boneTransformDirty){var e=this._tweenData;this._dataVersion>=ccs.CONST_VERSION_COMBINED&&(ccs.TransformHelp.nodeConcat(e,this._boneData),e.scaleX-=1,e.scaleY-=1);var i=this._worldInfo;i.copy(e),i.x=e.x+this._position.x,i.y=e.y+this._position.y,i.scaleX=e.scaleX*this._scaleX,i.scaleY=e.scaleY*this._scaleY,i.skewX=e.skewX+this._skewX+cc.degreesToRadians(this._rotationX),i.skewY=e.skewY+this._skewY-cc.degreesToRadians(this._rotationY),this._parentBone?this._applyParentTransform(this._parentBone):this._armatureParentBone&&this._applyParentTransform(this._armatureParentBone),ccs.TransformHelp.nodeToMatrix(i,this._worldTransform),this._armatureParentBone&&(this._worldTransform=cc.affineTransformConcat(this._worldTransform,this._armature.getNodeToParentTransform()))}for(ccs.displayFactory.updateDisplay(this,t,this._boneTransformDirty||this._armature.getArmatureTransformDirty()),e=0;e<this._children.length;e++)this._children[e].update(t);this._boneTransformDirty=!1},_applyParentTransform:function(t){var e=this._worldInfo,i=t._worldTransform;t=t._worldInfo;var n=e.x,r=e.y;e.x=n*i.a+r*i.c+t.x,e.y=n*i.b+r*i.d+t.y,e.scaleX*=t.scaleX,e.scaleY*=t.scaleY,e.skewX+=t.skewX,e.skewY+=t.skewY},setBlendFunc:function(t,e){var i,n,r=this._blendFunc;void 0===e?(i=t.src,n=t.dst):(i=t,n=e),(r.src!==i||r.dst!==n)&&(r.src=i,r.dst=n,this.blendDirty=!0)},updateColor:function(){var t=this._displayManager.getDisplayRenderNode();if(null!==t){var e=this._renderCmd;t.setColor(cc.color(e._displayedColor.r*this._tweenData.r/255,e._displayedColor.g*this._tweenData.g/255,e._displayedColor.b*this._tweenData.b/255)),t.setOpacity(e._displayedOpacity*this._tweenData.a/255)}},updateZOrder:function(){this.setLocalZOrder(this._armature.getArmatureData().dataVersion>=ccs.CONST_VERSION_COMBINED?this._tweenData.zOrder+this._boneData.zOrder:this._tweenData.zOrder)},addChildBone:function(t){cc.assert(t,"Argument must be non-nil"),cc.assert(!t.parentBone,"child already added. It can't be added again"),0>this._children.indexOf(t)&&(this._children.push(t),t.setParentBone(this))},removeChildBone:function(t,e){if(0<this._children.length&&-1!==this._children.getIndex(t)){if(e)for(var i=t._children,n=0;n<i.length;n++)t.removeChildBone(i[n],e);t.setParentBone(null),t.getDisplayManager().setCurrentDecorativeDisplay(null),cc.arrayRemoveObject(this._children,t)}},removeFromParent:function(t){this._parentBone&&this._parentBone.removeChildBone(this,t)},setParentBone:function(t){this._parentBone=t},getParentBone:function(){return this._parentBone},setChildArmature:function(t){this._childArmature!==t&&(null==t&&this._childArmature&&this._childArmature.setParentBone(null),this._childArmature=t)},getChildArmature:function(){return this._childArmature},getTween:function(){return this._tween},setLocalZOrder:function(t){this._localZOrder!==t&&cc.Node.prototype.setLocalZOrder.call(this,t)},getNodeToArmatureTransform:function(){return this._worldTransform},getNodeToWorldTransform:function(){return cc.affineTransformConcat(this._worldTransform,this._armature.getNodeToWorldTransform())},getDisplayRenderNode:function(){return this._displayManager.getDisplayRenderNode()},getDisplayRenderNodeType:function(){return this._displayManager.getDisplayRenderNodeType()},addDisplay:function(t,e){return this._displayManager.addDisplay(t,e||0)},removeDisplay:function(t){this._displayManager.removeDisplay(t)},changeDisplayByIndex:function(t,e){cc.log("changeDisplayByIndex is deprecated. Use changeDisplayWithIndex instead."),this.changeDisplayWithIndex(t,e)},changeDisplayByName:function(t,e){cc.log("changeDisplayByName is deprecated. Use changeDisplayWithName instead."),this.changeDisplayWithName(t,e)},changeDisplayWithIndex:function(t,e){this._displayManager.changeDisplayWithIndex(t,e)},changeDisplayWithName:function(t,e){this._displayManager.changeDisplayWithName(t,e)},getColliderDetector:function(){var t=this._displayManager.getCurrentDecorativeDisplay();return t&&(t=t.getColliderDetector())?t:null},setColliderFilter:function(t){for(var e=this._displayManager.getDecorativeDisplayList(),i=0;i<e.length;i++){var n=e[i].getColliderDetector();n&&n.setColliderFilter(t)}},getColliderFilter:function(){var t=this.displayManager.getCurrentDecorativeDisplay();return t&&(t=t.getColliderDetector())?t.getColliderFilter():null},setTransformDirty:function(t){this._boneTransformDirty=t},isTransformDirty:function(){return this._boneTransformDirty},getDisplayManager:function(){return this._displayManager},setIgnoreMovementBoneData:function(t){this._ignoreMovementBoneData=t},isIgnoreMovementBoneData:function(){return this._ignoreMovementBoneData},getBlendFunc:function(){return new cc.BlendFunc(this._blendFunc.src,this._blendFunc.dst)},setBlendDirty:function(t){this._blendDirty=t},isBlendDirty:function(){return this._blendDirty},getTweenData:function(){return this._tweenData},getWorldInfo:function(){return this._worldInfo},getChildrenBone:function(){return this._children},nodeToArmatureTransform:function(){return this.getNodeToArmatureTransform()},nodeToWorldTransform:function(){return this.getNodeToWorldTransform()},getColliderBodyList:function(){var t=this.getColliderDetector();return t?t.getColliderBodyList():null},getIgnoreMovementBoneData:function(){return this.isIgnoreMovementBoneData()},_createRenderCmd:function(){return cc._renderType===cc._RENDER_TYPE_CANVAS?new ccs.Bone.CanvasRenderCmd(this):new ccs.Bone.WebGLRenderCmd(this)}}),_p=ccs.Bone.prototype,cc.defineGetterSetter(_p,"boneData",_p.getBoneData,_p.setBoneData),cc.defineGetterSetter(_p,"armature",_p.getArmature,_p.setArmature),cc.defineGetterSetter(_p,"childArmature",_p.getChildArmature,_p.setChildArmature),cc.defineGetterSetter(_p,"childrenBone",_p.getChildrenBone),cc.defineGetterSetter(_p,"tween",_p.getTween),cc.defineGetterSetter(_p,"tweenData",_p.getTweenData),cc.defineGetterSetter(_p,"colliderFilter",_p.getColliderFilter,_p.setColliderFilter),_p=null,ccs.Bone.create=function(t){return new ccs.Bone(t)},ccs.Bone.RenderCmd={_updateColor:function(){var t=this._node,e=t._displayManager.getDisplayRenderNode();if(null!==e){var i=e._renderCmd;e.setColor(cc.color(t._tweenData.r,t._tweenData.g,t._tweenData.g)),e.setOpacity(t._tweenData.a),i._syncDisplayColor(this._displayedColor),i._syncDisplayOpacity(this._displayedOpacity),i._updateColor()}}},function(){ccs.Bone.CanvasRenderCmd=function(t){cc.Node.CanvasRenderCmd.call(this,t),this._needDraw=!1};var t=ccs.Bone.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);cc.inject(ccs.Bone.RenderCmd,t),t.constructor=ccs.Bone.CanvasRenderCmd}(),function(){if(cc.Node.WebGLRenderCmd){ccs.Bone.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t),this._needDraw=!1};var t=ccs.Bone.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);cc.inject(ccs.Bone.RenderCmd,t),t.constructor=ccs.Bone.WebGLRenderCmd}}(),ccs.FRAME_TYPE_MOVE=0,ccs.FRAME_TYPE_SCALE=1,ccs.FRAME_TYPE_ROTATE=2,ccs.FRAME_TYPE_TINT=3,ccs.FRAME_TYPE_FADE=4,ccs.FRAME_TYPE_MAX=5,ccs.FrameEaseType={CUSTOM:-1,LINEAR:0,SINE_EASEIN:1,SINE_EASEOUT:2,SINE_EASEINOUT:3,QUAD_EASEIN:4,QUAD_EASEOUT:5,QUAD_EASEINOUT:6,CUBIC_EASEIN:7,CUBIC_EASEOUT:8,CUBIC_EASEINOUT:9,QUART_EASEIN:10,QUART_EASEOUT:11,QUART_EASEINOUT:12,QUINT_EASEIN:13,QUINT_EASEOUT:14,QUINT_EASEINOUT:15,EXPO_EASEIN:16,EXPO_EASEOUT:17,EXPO_EASEINOUT:18,CIRC_EASEIN:19,CIRC_EASEOUT:20,CIRC_EASEINOUT:21,ELASTIC_EASEIN:22,ELASTIC_EASEOUT:23,ELASTIC_EASEINOUT:24,BACK_EASEIN:25,BACK_EASEOUT:26,BACK_EASEINOUT:27,BOUNCE_EASEIN:28,BOUNCE_EASEOUT:29,BOUNCE_EASEINOUT:30,TWEEN_EASING_MAX:1e3},ccs.ActionFrame=ccs.Class.extend({frameType:0,easingType:0,frameIndex:0,_Parameter:null,time:0,ctor:function(){this.frameType=0,this.easingType=ccs.FrameEaseType.LINEAR,this.time=this.frameIndex=0},getAction:function(){return cc.log("Need a definition of <getAction> for ActionFrame"),null},_getEasingAction:function(t){if(null===t)return console.error("Action cannot be null!"),null;var e;switch(this.easingType){case ccs.FrameEaseType.LINEAR:e=t;break;case ccs.FrameEaseType.SINE_EASEIN:e=t.easing(cc.easeSineIn());break;case ccs.FrameEaseType.SINE_EASEOUT:e=t.easing(cc.easeSineOut());break;case ccs.FrameEaseType.SINE_EASEINOUT:e=t.easing(cc.easeSineInOut());break;case ccs.FrameEaseType.QUAD_EASEIN:e=t.easing(cc.easeQuadraticActionIn());break;case ccs.FrameEaseType.QUAD_EASEOUT:e=t.easing(cc.easeQuadraticActionOut());break;case ccs.FrameEaseType.QUAD_EASEINOUT:e=t.easing(cc.easeQuadraticActionInOut());break;case ccs.FrameEaseType.CUBIC_EASEIN:e=t.easing(cc.easeCubicActionIn());break;case ccs.FrameEaseType.CUBIC_EASEOUT:e=t.easing(cc.easeCubicActionOut());break;case ccs.FrameEaseType.CUBIC_EASEINOUT:e=t.easing(cc.easeCubicActionInOut());break;case ccs.FrameEaseType.QUART_EASEIN:e=t.easing(cc.easeQuarticActionIn());break;case ccs.FrameEaseType.QUART_EASEOUT:e=t.easing(cc.easeQuarticActionOut());break;case ccs.FrameEaseType.QUART_EASEINOUT:e=t.easing(cc.easeQuarticActionInOut());break;case ccs.FrameEaseType.QUINT_EASEIN:e=t.easing(cc.easeQuinticActionIn());break;case ccs.FrameEaseType.QUINT_EASEOUT:e=t.easing(cc.easeQuinticActionOut());break;case ccs.FrameEaseType.QUINT_EASEINOUT:e=t.easing(cc.easeQuinticActionInOut());break;case ccs.FrameEaseType.EXPO_EASEIN:e=t.easing(cc.easeExponentialIn());break;case ccs.FrameEaseType.EXPO_EASEOUT:e=t.easing(cc.easeExponentialOut());break;case ccs.FrameEaseType.EXPO_EASEINOUT:e=t.easing(cc.easeExponentialInOut());break;case ccs.FrameEaseType.CIRC_EASEIN:e=t.easing(cc.easeCircleActionIn());break;case ccs.FrameEaseType.CIRC_EASEOUT:e=t.easing(cc.easeCircleActionOut());break;case ccs.FrameEaseType.CIRC_EASEINOUT:e=t.easing(cc.easeCircleActionInOut());break;case ccs.FrameEaseType.ELASTIC_EASEIN:e=t.easing(cc.easeElasticIn());break;case ccs.FrameEaseType.ELASTIC_EASEOUT:e=t.easing(cc.easeElasticOut());break;case ccs.FrameEaseType.ELASTIC_EASEINOUT:e=t.easing(cc.easeElasticInOut());break;case ccs.FrameEaseType.BACK_EASEIN:e=t.easing(cc.easeBackIn());break;case ccs.FrameEaseType.BACK_EASEOUT:e=t.easing(cc.easeBackOut());break;case ccs.FrameEaseType.BACK_EASEINOUT:e=t.easing(cc.easeBackInOut());break;case ccs.FrameEaseType.BOUNCE_EASEIN:e=t.easing(cc.easeBounceIn());break;case ccs.FrameEaseType.BOUNCE_EASEOUT:e=t.easing(cc.easeBounceOut());break;case ccs.FrameEaseType.BOUNCE_EASEINOUT:e=t.easing(cc.easeBounceInOut())}return e},setEasingParameter:function(t){this._Parameter=[];for(var e=0;e<t.length;e++)this._Parameter.push(t[e])},setEasingType:function(t){this.easingType=t}}),ccs.ActionMoveFrame=ccs.ActionFrame.extend({_position:null,ctor:function(){ccs.ActionFrame.prototype.ctor.call(this),this._position=cc.p(0,0),this.frameType=ccs.FRAME_TYPE_MOVE},setPosition:function(t,e){void 0===e?(this._position.x=t.x,this._position.y=t.y):(this._position.x=t,this._position.y=e)},getPosition:function(){return this._position},getAction:function(t){return this._getEasingAction(cc.moveTo(t,this._position))}}),ccs.ActionScaleFrame=ccs.ActionFrame.extend({_scaleX:1,_scaleY:1,ctor:function(){ccs.ActionFrame.prototype.ctor.call(this),this._scaleY=this._scaleX=1,this.frameType=ccs.FRAME_TYPE_SCALE},setScaleX:function(t){this._scaleX=t},getScaleX:function(){return this._scaleX},setScaleY:function(t){this._scaleY=t},getScaleY:function(){return this._scaleY},getAction:function(t){return this._getEasingAction(cc.scaleTo(t,this._scaleX,this._scaleY))}}),ccs.ActionRotationFrame=ccs.ActionFrame.extend({_rotation:0,ctor:function(){ccs.ActionFrame.prototype.ctor.call(this),this._rotation=0,this.frameType=ccs.FRAME_TYPE_ROTATE},setRotation:function(t){this._rotation=t},getRotation:function(){return this._rotation},getAction:function(t,e){return void 0===e?this._getEasingAction(cc.rotateTo(t,this._rotation)):e instanceof cc.ActionRotationFrame?this._getEasingAction(cc.rotateBy(t,this._rotation-e._rotation)):this.getAction(t)}}),ccs.ActionFadeFrame=ccs.ActionFrame.extend({_opacity:255,ctor:function(){ccs.ActionFrame.prototype.ctor.call(this),this._opacity=255,this.frameType=ccs.FRAME_TYPE_FADE},setOpacity:function(t){this._opacity=t},getOpacity:function(){return this._opacity},getAction:function(t){return this._getEasingAction(cc.fadeTo(t,this._opacity))}}),ccs.ActionTintFrame=ccs.ActionFrame.extend({_color:null,ctor:function(){ccs.ActionFrame.prototype.ctor.call(this),this._color=cc.color(255,255,255,255),this.frameType=ccs.FRAME_TYPE_TINT},setColor:function(t){var e=this._color;e.r=t.r,e.g=t.g,e.b=t.b},getColor:function(){var t=this._color;return cc.color(t.r,t.g,t.b,t.a)},getAction:function(t){return this._getEasingAction(cc.tintTo(t,this._color.r,this._color.g,this._color.b))}}),ccs.actionManager={_actionDic:{},initWithDictionary:function(t,e,i){var n=t.lastIndexOf("/");t=t.substr(n+1,t.length),e=e.actionlist;for(var n=[],r=0;r<e.length;r++){var o=new ccs.ActionObject;o.initWithDictionary(e[r],i),n.push(o)}this._actionDic[t]=n},getActionByName:function(t,e){var i=t.lastIndexOf("/"),i=t.substr(i+1,t.length),i=this._actionDic[i];if(!i)return null;for(var n=0;n<i.length;n++){var r=i[n];if(e===r.getName())return r}return null},playActionByName:function(t,e,i){(t=this.getActionByName(t,e))&&t.play(i)},stopActionByName:function(t,e){var i=this.getActionByName(t,e);i&&i.stop()},releaseActions:function(){this._actionDic={}},clear:function(){this._actionDic={}}},ccs.ActionNode=ccs.Class.extend({_currentFrameIndex:0,_destFrameIndex:0,_unitTime:0,_actionTag:0,_object:null,_actionSpawn:null,_action:null,_frameArray:null,_frameArrayNum:0,ctor:function(){this._destFrameIndex=this._currentFrameIndex=0,this._unitTime=.1,this._actionTag=0,this._action=this._actionSpawn=this._object=null,this._frameArray=[],this._frameArrayNum=ccs.FRAME_TYPE_MAX;for(var t=0;t<this._frameArrayNum;t++)this._frameArray.push([])},initWithDictionary:function(t,e){this.setActionTag(t.ActionTag);for(var i=t.actionframelist,n=0;n<i.length;n++){var r=i[n],o=r.frameid,s=r.tweenType;null==s&&(s=0);for(var c=r.tweenParameter,a=[],l=0;c>l;l++)a.push(r.tweenParameter[l]);if(void 0!==r.positionx){var l=r.positionx,h=r.positiony,c=new ccs.ActionMoveFrame;c.frameIndex=o,c.setEasingType(s),c.setEasingParameter(a),c.setPosition(l,h),l=this._frameArray[ccs.FRAME_TYPE_MOVE],l.push(c)}void 0!==r.scalex&&(l=r.scalex,h=r.scaley,c=new ccs.ActionScaleFrame,c.frameIndex=o,c.setEasingType(s),c.setEasingParameter(a),c.setScaleX(l),c.setScaleY(h),l=this._frameArray[ccs.FRAME_TYPE_SCALE],l.push(c)),void 0!==r.rotation&&(l=r.rotation,c=new ccs.ActionRotationFrame,c.frameIndex=o,c.setEasingType(s),c.setEasingParameter(a),c.setRotation(l),l=this._frameArray[ccs.FRAME_TYPE_ROTATE],l.push(c)),void 0!==r.opacity&&(l=r.opacity,c=new ccs.ActionFadeFrame,c.frameIndex=o,c.setEasingType(s),c.setEasingParameter(a),c.setOpacity(l),l=this._frameArray[ccs.FRAME_TYPE_FADE],l.push(c)),void 0!==r.colorr&&(l=r.colorr,h=r.colorg,r=r.colorb,c=new ccs.ActionTintFrame,c.frameIndex=o,c.setEasingType(s),c.setEasingParameter(a),c.setColor(cc.color(l,h,r)),l=this._frameArray[ccs.FRAME_TYPE_TINT],l.push(c))}this._initActionNodeFromRoot(e)},_initActionNodeFromRoot:function(t){t instanceof ccui.Widget&&(t=ccui.helper.seekActionWidgetByActionTag(t,this.getActionTag()))&&this.setObject(t)},setUnitTime:function(t){this._unitTime=t,this._refreshActionProperty()},getUnitTime:function(){return this._unitTime},setActionTag:function(t){this._actionTag=t},getActionTag:function(){return this._actionTag},setObject:function(t){this._object=t},getObject:function(){return this._object},getActionNode:function(){return this._object instanceof cc.Node?this._object:null},insertFrame:function(t,e){null!=e&&this._frameArray[e.frameType].splice(t,0,e)},addFrame:function(t){t&&this._frameArray[t.frameType].push(t)},deleteFrame:function(t){null!=t&&cc.arrayRemoveObject(this._frameArray[t.frameType],t)},clearAllFrame:function(){for(var t=0;t<this._frameArrayNum;t++)this._frameArray[t].length=0},_refreshActionProperty:function(){if(null===this._object)return null;for(var t=[],e=0;e<this._frameArrayNum;e++){var i=this._frameArray[e];if(!(0>=i.length)){for(var n=[],r=0;r<i.length;r++){var o=i[r],s=null;0!==r?(s=(o.frameIndex-i[r-1].frameIndex)*this.getUnitTime(),s=o.getAction(s)):s=o.getAction(0),s&&n.push(s)}n&&(i=cc.sequence(n),null!==i&&t.push(i))}}return this._action=null,this._actionSpawn=cc.spawn(t)},playAction:function(t){null!==this._object&&null!==this._actionSpawn&&(this._action=t?cc.sequence(this._actionSpawn,t):cc.sequence(this._actionSpawn),this._runAction())},_runAction:function(){var t=this.getActionNode();null!==t&&null!==this._action&&t.runAction(this._action)},stopAction:function(){var t=this.getActionNode();null!==t&&null!==this._action&&(this._action.isDone()||t.stopAction(this._action))},getFirstFrameIndex:function(){for(var t=99999,e=!1,i=this._frameArray,n=0,r=this._frameArrayNum;r>n;n++){var o=i[n];0>=o.length||(e=!0,o=o[0].frameIndex,t=t>o?o:t)}return e||(t=0),t},getLastFrameIndex:function(){for(var t=-1,e=!1,i=this._frameArray,n=0,r=this._frameArrayNum;r>n;n++){var o=i[n];0>=o.length||(e=!0,o=o[o.length-1].frameIndex,t=o>t?o:t)}return e||(t=0),t},updateActionToTimeLine:function(t){for(var e=!1,i=this.getUnitTime(),n=0;n<this._frameArrayNum;n++){var r=this._frameArray[n];if(null!==r)for(var o=0;o<r.length;o++){var s=r[o];if(s.frameIndex*i===t){this._easingToFrame(1,1,s),e=!0;break}if(s.frameIndex*i>t){0===o?(this._easingToFrame(1,1,s),e=!1):(e=r[o-1],r=(s.frameIndex-e.frameIndex)*i,o=t-e.frameIndex*i,this._easingToFrame(r,1,e),this._easingToFrame(r,o/r,s),e=!0);break}}}return e},_easingToFrame:function(t,e,i){t=i.getAction(t),i=this.getActionNode(),null!=t&&null!=i&&(t.startWithTarget(i),t.update(e))},isActionDoneOnce:function(){return null===this._action?!0:this._action.isDone()}}),ccs.ActionObject=ccs.Class.extend({_actionNodeList:null,_name:"",_loop:!1,_pause:!1,_playing:!1,_unitTime:0,_currentTime:0,_scheduler:null,_callback:null,_fTotalTime:0,ctor:function(){this._actionNodeList=[],this._name="",this._playing=this._pause=this._loop=!1,this._unitTime=.1,this._fTotalTime=this._currentTime=0,this._scheduler=cc.director.getScheduler()},setName:function(t){this._name=t},getName:function(){return this._name},setLoop:function(t){this._loop=t},getLoop:function(){return this._loop},setUnitTime:function(t){this._unitTime=t,t=this._actionNodeList.length;for(var e=0;t>e;e++)this._actionNodeList[e].setUnitTime(this._unitTime)},getUnitTime:function(){return this._unitTime},getCurrentTime:function(){return this._currentTime},setCurrentTime:function(t){this._currentTime=t},getTotalTime:function(){return this._fTotalTime},isPlaying:function(){return this._playing},initWithDictionary:function(t,e){this.setName(t.name),this.setLoop(t.loop),this.setUnitTime(t.unittime);for(var i=t.actionnodelist,n=0,r=0;r<i.length;r++){var o=new ccs.ActionNode;o.initWithDictionary(i[r],e),o.setUnitTime(this.getUnitTime()),this._actionNodeList.push(o),o=o.getLastFrameIndex()-o.getFirstFrameIndex(),o>n&&(n=o)}this._fTotalTime=n*this._unitTime},addActionNode:function(t){t&&(this._actionNodeList.push(t),t.setUnitTime(this._unitTime))},removeActionNode:function(t){null!=t&&cc.arrayRemoveObject(this._actionNodeList,t)},play:function(t){this.stop(),this.updateToFrameByTime(0);for(var e=this._actionNodeList,i=e.length,n=0;i>n;n++)e[n].playAction(t);this._loop&&this._scheduler.schedule(this.simulationActionUpdate,this,0,cc.REPEAT_FOREVER,0,!1,this.__instanceId+""),void 0!==t&&(this._callback=t)
},pause:function(){this._pause=!0,this._playing=!1},stop:function(){for(var t=this._actionNodeList,e=0;e<t.length;e++)t[e].stopAction();this._scheduler.unschedule(this.simulationActionUpdate,this),this._playing=this._pause=!1},updateToFrameByTime:function(t){this._currentTime=t;for(var e=0;e<this._actionNodeList.length;e++)this._actionNodeList[e].updateActionToTimeLine(t)},simulationActionUpdate:function(t){t=!0;for(var e=this._actionNodeList,i=0,n=e.length;n>i;i++)if(!e[i].isActionDoneOnce()){t=!1;break}t&&(null!==this._callback&&this._callback.execute(),this._loop?this.play():(this._playing=!1,this._scheduler.unschedule(this.simulationActionUpdate,this)))}}),ccs.ComAttribute=ccs.Component.extend({_jsonDict:null,_filePath:"",ctor:function(){cc.Component.prototype.ctor.call(this),this._jsonDict={},this._filePath="",this._name="CCComAttribute",ccs.ComAttribute.prototype.init.call(this)},init:function(){return this._jsonDict={},!0},setInt:function(t,e){t?this._jsonDict[t]=e:cc.log("Argument must be non-nil")},setDouble:function(t,e){t?this._jsonDict[t]=e:cc.log("Argument must be non-nil")},setFloat:function(t,e){t?this._jsonDict[t]=e:cc.log("Argument must be non-nil")},setBool:function(t,e){t?this._jsonDict[t]=e:cc.log("Argument must be non-nil")},setString:function(t,e){t?this._jsonDict[t]=e:cc.log("Argument must be non-nil")},setObject:function(t,e){t?this._jsonDict[t]=e:cc.log("Argument must be non-nil")},getInt:function(t){return parseInt(this._jsonDict[t]||0)},getDouble:function(t){return parseFloat(this._jsonDict[t]||0)},getFloat:function(t){return parseFloat(this._jsonDict[t]||0)},getBool:function(t){return Boolean(this._jsonDict[t]||!1)},getString:function(t){return this._jsonDict[t]||""},getObject:function(t){return this._jsonDict[t]},parse:function(t){this._jsonDict=cc.loader.getRes(t)}}),ccs.ComAttribute.create=function(){return new ccs.ComAttribute},ccs.ComAudio=ccs.Component.extend({_filePath:"",_loop:!1,ctor:function(){cc.Component.prototype.ctor.call(this),this._name="Audio",ccs.ComAudio.prototype.init.call(this)},init:function(){return!0},onExit:function(){this.stopBackgroundMusic(!0),this.stopAllEffects()},end:function(){cc.audioEngine.end()},preloadBackgroundMusic:function(t){cc.loader.load(t)},playBackgroundMusic:function(t,e){t?cc.audioEngine.playMusic(t,e):cc.audioEngine.playMusic(this._filePath,this._loop)},stopBackgroundMusic:function(t){cc.audioEngine.stopMusic(t)},pauseBackgroundMusic:function(){cc.audioEngine.pauseMusic()},resumeBackgroundMusic:function(){cc.audioEngine.resumeMusic()},rewindBackgroundMusic:function(){cc.audioEngine.rewindMusic()},willPlayBackgroundMusic:function(){return cc.audioEngine.willPlayMusic()},isBackgroundMusicPlaying:function(){return cc.audioEngine.isMusicPlaying()},getBackgroundMusicVolume:function(){return cc.audioEngine.getMusicVolume()},setBackgroundMusicVolume:function(t){cc.audioEngine.setMusicVolume(t)},getEffectsVolume:function(){return cc.audioEngine.getEffectsVolume()},setEffectsVolume:function(t){cc.audioEngine.setEffectsVolume(t)},playEffect:function(t,e){return t?cc.audioEngine.playEffect(t,e):cc.audioEngine.playEffect(this._filePath,this._loop)},pauseEffect:function(t){cc.audioEngine.pauseEffect(t)},pauseAllEffects:function(){cc.audioEngine.pauseAllEffects()},resumeEffect:function(t){cc.audioEngine.resumeEffect(t)},resumeAllEffects:function(){cc.audioEngine.resumeAllEffects()},stopEffect:function(t){cc.audioEngine.stopEffect(t)},stopAllEffects:function(){cc.audioEngine.stopAllEffects()},preloadEffect:function(t){cc.loader.getRes(t),this.setFile(t),this.setLoop(!1)},unloadEffect:function(t){cc.audioEngine.unloadEffect(t)},setFile:function(t){this._filePath=t},setLoop:function(t){this._loop=t},getFile:function(){return this._filePath},isLoop:function(){return this._loop}}),ccs.ComAudio.create=function(){return new ccs.ComAudio},ccs.ComController=ccs.Component.extend({ctor:function(){cc.Component.prototype.ctor.call(this),this._name="ComController",ccs.ComController.prototype.init.call(this)},onEnter:function(){null!==this._owner&&this._owner.scheduleUpdate()},isEnabled:function(){return this._enabled},setEnabled:function(t){this._enabled=t}}),ccs.ComController.create=function(){return new ccs.ComController},ccs.ComRender=ccs.Component.extend({_render:null,ctor:function(t,e){cc.Component.prototype.ctor.call(this),this._render=t,this._name=e,this.isRenderer=!0,ccs.ComRender.prototype.init.call(this)},onEnter:function(){this._owner&&this._owner.addChild(this._render)},onExit:function(){this._owner&&(this._owner.removeChild(this._render,!0),this._render=null)},getNode:function(){return this._render},setNode:function(t){this._render=t}}),ccs.ComRender.create=function(t,e){return new ccs.ComRender(t,e)},ccs.objectFactory={_typeMap:{},createObject:function(t){var e=null;return(t=this._typeMap[t])&&(e=cc.isFunction(t._fun)?new t._fun:t._fun),e},registerType:function(t){this._typeMap[t._className]=t},createGUI:function(t){var e=null;return"Panel"===t?t="Layout":"TextArea"===t?t="Label":"TextButton"===t&&(t="Button"),(t=this._typeMap[t])&&t._fun&&(e=t._fun),e},removeAll:function(){this._typeMap={}}},ccs.TInfo=ccs.Class.extend({_className:"",_fun:null,ctor:function(t,e){e?(this._className=t,this._fun=e):(this._className=t._className,this._fun=t._fun),ccs.objectFactory.registerType(this)}}),ccs.sendEvent=function(t){if(t=ccs.triggerManager.get(t),null!=t)for(var e=0;e<t.length;e++){var i=t[e];null!=i&&i.detect()&&i.done()}},ccs.registerTriggerClass=function(t,e){new ccs.TInfo(t,e)},ccs.triggerManager={_eventTriggers:{},_triggerObjs:{},_movementDispatches:[],parse:function(t){for(var e=0;e<t.length;++e){var i=t[e],n=new ccs.TriggerObj;n.serialize(i);for(var i=n.getEvents(),r=0;r<i.length;r++)this.add(i[r],n);this._triggerObjs[n.getId()]=n}},get:function(t){return this._eventTriggers[t]},getTriggerObj:function(t){return this._triggerObjs[t]},add:function(t,e){var i=this._eventTriggers[t];i||(i=[]),-1===i.indexOf(e)&&(i.push(e),this._eventTriggers[t]=i)},removeAll:function(){for(var t in this._eventTriggers)for(var e=this._eventTriggers[t],i=0;i<e.length;i++)e[i].removeAll();this._eventTriggers={}},remove:function(t,e){if(e)return this._removeObj(t,e);var i=!1,n=this._eventTriggers[t];if(n){for(i=0;i<n.length;i++){var r=n[i];r&&r.removeAll()}delete this._eventTriggers[t],i=!0}return i},_removeObj:function(t,e){var i=!1;do{var n=this._eventTriggers[t];if(n){for(i=0;i<n.length;i++){var r=n[i];if(r&&r==e){r.removeAll(),n.splice(i,1);break}}i=!0}}while(0);return i},removeTriggerObj:function(t){if(t=this.getTriggerObj(t),!t)return!1;for(var e=t.getEvents(),i=0;i<e.length;i++)this.remove(e[i],t);return!0},isEmpty:function(){return!this._eventTriggers||0>=this._eventTriggers.length},addArmatureMovementCallBack:function(t,e,i){if(null!=t&&null!=i&&null!=e){for(var n,r=!1,o=0;o<this._movementDispatches.length;o++)(n=this._movementDispatches[o])&&n[0]===t&&(n.addAnimationEventCallBack(e,i),r=!0);r||(n=new ccs.ArmatureMovementDispatcher,t.getAnimation().setMovementEventCallFunc(n.animationEvent,n),n.addAnimationEventCallBack(e,i),this._movementDispatches.push([t,n]))}},removeArmatureMovementCallBack:function(t,e,i){if(null!=t&&null!=e&&null!=i)for(var n,r=0;r<this._movementDispatches.length;r++)(n=this._movementDispatches[r])&&n[0]===t&&n.removeAnimationEventCallBack(i,e)},removeArmatureAllMovementCallBack:function(t){if(null!=t)for(var e,i=0;i<this._movementDispatches.length;i++)if((e=this._movementDispatches[i])&&e[0]===t){this._movementDispatches.splice(i,1);break}},removeAllArmatureMovementCallBack:function(){this._movementDispatches.length=0},version:function(){return"1.2.0.0"}},ccs.ArmatureMovementDispatcher=ccs.Class.extend({_mapEventAnimation:null,ctor:function(){this._mapEventAnimation=[]},animationEvent:function(t,e,i){for(var n,r,o=0;o<this._mapEventAnimation.length;o++)n=this._mapEventAnimation[o],r=n[0],(n=n[1])&&n.call(r,t,e,i)},addAnimationEventCallBack:function(t,e){this._mapEventAnimation.push([e,t])},removeAnimationEventCallBack:function(t,e){for(var i,n=0;n<this._mapEventAnimation.length;n++)i=this._mapEventAnimation[n],i[0]===e&&this._mapEventAnimation.splice(n,1)}}),ccs.BaseTriggerCondition=ccs.Class.extend({ctor:function(){},init:function(){return!0},detect:function(){return!0},serialize:function(){},removeAll:function(){}}),ccs.BaseTriggerAction=ccs.Class.extend({ctor:function(){},init:function(){return!0},done:function(){},serialize:function(){},removeAll:function(){}}),ccs.TriggerObj=ccs.Class.extend({_cons:null,_acts:null,_id:0,_enable:!0,_vInt:null,ctor:function(){this._id=0,this._enable=!0,ccs.TriggerObj.prototype.init.call(this)},init:function(){return this._cons=[],this._acts=[],this._vInt=[],!0},detect:function(){if(!this._enable||0===this._cons.length)return!0;for(var t=!0,e=null,i=0;i<this._cons.length;i++)(e=this._cons[i])&&e.detect&&(t=t&&e.detect());return t},done:function(){if(this._enable&&0!==this._acts.length)for(var t,e=0;e<this._acts.length;e++)(t=this._acts[e])&&t.done&&t.done()},removeAll:function(){for(var t=null,e=0;e<this._cons.length;e++)(t=this._cons[e])&&t.removeAll();for(this._cons=[],e=0;e<this._acts.length;e++)(t=this._acts[e])&&t.removeAll();this._acts=[]},serialize:function(t){this._id=t.id||0;for(var e=t.conditions||[],i=0;i<e.length;i++){var n=e[i],r=n.classname,o=ccs.objectFactory.createObject(r);o?(o.serialize(n),o.init(),this._cons.push(o)):cc.log("class named classname("+r+") can not implement!")}for(e=t.actions||[],i=0;i<e.length;i++)n=e[i],r=n.classname,(o=ccs.objectFactory.createObject(r))?(o.serialize(n),o.init(),this._acts.push(o)):cc.log("class named classname("+r+") can not implement!");for(t=t.events||[],i=0;i<t.length;i++)n=t[i],n=n.id,0>n||this._vInt.push(n)},getId:function(){return this._id},setEnable:function(t){this._enable=t},getEvents:function(){return this._vInt}}),ccs.TriggerObj.create=function(){return new ccs.TriggerObj},ccs.ActionTimelineData=ccs.Class.extend({_actionTag:0,ctor:function(t){this._init(t)},_init:function(t){return this._actionTag=t,!0},setActionTag:function(t){this._actionTag=t},getActionTag:function(){return this._actionTag}}),ccs.ObjectExtensionData=ccs.Class.extend({_customProperty:null,_timelineData:null,ctor:function(){return this._timelineData=new ccs.ActionTimelineData(0),!0},setActionTag:function(t){this._timelineData.setActionTag(t)},getActionTag:function(){return this._timelineData.getActionTag()},setCustomProperty:function(t){this._customProperty=t},getCustomProperty:function(){return this._customProperty}}),ccs.ObjectExtensionData.create=function(){return new ccs.ObjectExtensionData},ccs.ActionTimelineData.create=function(t){return new ccs.ActionTimelineData(t)},ccs.ActionTimeline=cc.Action.extend({_timelineMap:null,_timelineList:null,_duration:0,_time:null,_timeSpeed:1,_frameInternal:1/60,_playing:!1,_currentFrame:0,_startFrame:0,_endFrame:0,_loop:null,_frameEventListener:null,_animationInfos:null,_lastFrameListener:null,ctor:function(){cc.Action.prototype.ctor.call(this),this._timelineMap={},this._timelineList=[],this._animationInfos={},this.init()},_gotoFrame:function(t){for(var e=this._timelineList.length,i=0;e>i;i++)this._timelineList[i]._gotoFrame(t)},_stepToFrame:function(t){for(var e=this._timelineList.length,i=0;e>i;i++)this._timelineList[i]._stepToFrame(t)},_emitFrameEvent:function(t){this._frameEventListener&&this._frameEventListener(t)},init:function(){return!0},gotoFrameAndPlay:function(t,e,i){var n,r=0,o=arguments.length,s=[];for(r;o>r;r++)"boolean"==typeof arguments[r]?n=arguments[r]:s.push(arguments[r]);t=s[0],e=s[1]||this._duration,i=s[2]||t,this._startFrame=t,this._endFrame=e,this._currentFrame=i,this._loop=null!=n?n:!0,this._time=this._currentFrame*this._frameInternal,this.resume(),this._gotoFrame(this._currentFrame)},gotoFrameAndPause:function(t){this._startFrame=this._currentFrame=t,this._time=this._currentFrame*this._frameInternal,this.pause(),this._gotoFrame(this._currentFrame)},pause:function(){this._playing=!1},resume:function(){this._playing=!0},isPlaying:function(){return this._playing},setTimeSpeed:function(t){this._timeSpeed=t},getTimeSpeed:function(){return this._timeSpeed},setDuration:function(t){this._duration=t},getDuration:function(){return this._duration},getStartFrame:function(){return this._startFrame},getEndFrame:function(){return this._endFrame},setCurrentFrame:function(t){t>=this._startFrame&&t<=this._endFrame?(this._currentFrame=t,this._time=this._currentFrame*this._frameInternal):cc.log("frame index is not between start frame and end frame")},getCurrentFrame:function(){return this._currentFrame},addTimeline:function(t){var e=t.getActionTag();this._timelineMap[e]||(this._timelineMap[e]=[]),this._timelineMap[e].some(function(e){return e===t?!0:void 0})||(this._timelineList.push(t),this._timelineMap[e].push(t),t.setActionTimeline(this))},removeTimeline:function(t){var e=t.getActionTag();this._timelineMap[e]&&this._timelineMap[e].some(function(e){return e===t?!0:void 0})&&(cc.arrayRemoveObject(this._timelineMap[e],t),cc.arrayRemoveObject(this._timelineList,t),t.setActionTimeline(null))},getTimelines:function(){return this._timelineList},setFrameEventCallFunc:function(t){this._frameEventListener=t},clearFrameEventCallFunc:function(){this._frameEventListener=null},clone:function(){var t=new ccs.ActionTimeline;t.setDuration(this._duration),t.setTimeSpeed(this._timeSpeed);for(var e in this._timelineMap){var i,n=this._timelineMap[e];for(i in n){var r=n[i].clone();t.addTimeline(r)}}return t},reverse:function(){return null},step:function(t){this._playing&&0!==this._timelineMap.length&&0!==this._duration&&(this._time+=t*this._timeSpeed,t=this._time-this._endFrame*this._frameInternal,t<this._frameInternal?(this._currentFrame=this._time/this._frameInternal,this._stepToFrame(this._currentFrame),t>=0&&this._lastFrameListener&&this._lastFrameListener()):(this._playing=this._loop)?this.gotoFrameAndPlay(this._startFrame,this._endFrame,this._loop):(this._time=this._endFrame*this._frameInternal,this._currentFrame!=this._endFrame&&(this._currentFrame=this._endFrame,this._stepToFrame(this._currentFrame),this._lastFrameListener&&this._lastFrameListener())))},_foreachNodeDescendant:function(t,e){e(t);for(var i=t.getChildren(),n=0;n<i.length;n++)this._foreachNodeDescendant(i[n],e)},startWithTarget:function(t){cc.Action.prototype.startWithTarget.call(this,t);var e=this;this._foreachNodeDescendant(t,function(t){var i=t.getUserObject();if(i&&(i=i.getActionTag(),e._timelineMap[i]))for(var i=e._timelineMap[i],n=0;n<i.length;n++)i[n].setNode(t)})},isDone:function(){return!1},play:function(t,e){var i=this._animationInfos[t];return i?void this.gotoFrameAndPlay(i.startIndex,i.endIndex,e):cc.log("Can't find animation info for %s",t)},addAnimationInfo:function(t){this._animationInfos[t.name]=t},removeAnimationInfo:function(t){delete this._animationInfos[t]},isAnimationInfoExists:function(t){return this._animationInfos[t]},getAnimationInfo:function(t){return this._animationInfos[t]},setLastFrameCallFunc:function(t){this._lastFrameListener=t},clearLastFrameCallFunc:function(){this._lastFrameListener=null}}),ccs.ActionTimeline.create=function(){return new ccs.ActionTimeline},ccs.Frame=ccs.Class.extend({_frameIndex:null,_tween:null,_timeline:null,_node:null,_tweenType:null,_easingParam:null,_enterWhenPassed:null,ctor:function(){this._frameIndex=0,this._tween=!0,this._node=this._timeline=null,this._enterWhenPassed=!1,this._easingParam=[]},_emitEvent:function(){this._timeline&&this._timeline.getActionTimeline()._emitFrameEvent(this)},_cloneProperty:function(t){this._frameIndex=t.getFrameIndex(),this._tween=t.isTween(),this._tweenType=t.getTweenType(),this.setEasingParams(t.getEasingParams())},setFrameIndex:function(t){this._frameIndex=t},getFrameIndex:function(){return this._frameIndex},setTimeline:function(t){this._timeline=t},getTimeline:function(){return this._timeline},setNode:function(t){this._node=t},getNode:function(){return this._node},setTween:function(t){this._tween=t},isTween:function(){return this._tween},onEnter:function(){},apply:function(t){this._tween&&(this._tweenType!==ccs.FrameEaseType.TWEEN_EASING_MAX&&this._tweenType!==ccs.FrameEaseType.LINEAR&&(t=this.tweenPercent(t)),this._onApply(t))},_onApply:function(){},clone:function(){},tweenPercent:function(t){var e=ccs.Frame.tweenToMap[this._tweenType];return e?e(t,this._easingParam):t},setEasingParams:function(t){if(t)for(var e=this._easingParam.length=0;e<t.length;e++)this._easingParam[e]=t[e]},getEasingParams:function(){return this._easingParam},setTweenType:function(t){this._tweenType=t},getTweenType:function(){return this._tweenType},isEnterWhenPassed:function(){return this._enterWhenPassed}}),ccs.Frame.tweenToMap={"-1":function(t,e){if(e){var i=1-t;return e[1]*i*i*i+3*e[3]*t*i*i+3*e[5]*t*t*i+e[7]*t*t*t}return t},1:cc._easeSineInObj.easing,2:cc._easeSineOutObj.easing,3:cc._easeSineInOutObj.easing,4:cc._easeQuadraticActionIn.easing,5:cc._easeQuadraticActionOut.easing,6:cc._easeQuadraticActionInOut.easing,7:cc._easeCubicActionIn.easing,8:cc._easeCubicActionOut.easing,9:cc._easeCubicActionInOut.easing,10:cc._easeCubicActionIn.easing,11:cc._easeCubicActionOut.easing,12:cc._easeCubicActionInOut.easing,13:cc._easeQuinticActionIn.easing,14:cc._easeQuinticActionOut.easing,15:cc._easeQuinticActionInOut.easing,16:cc._easeExponentialInObj.easing,17:cc._easeExponentialOutObj.easing,18:cc._easeExponentialInOutObj.easing,19:cc._easeCircleActionIn.easing,20:cc._easeCircleActionOut.easing,21:cc._easeCircleActionInOut.easing,22:function(t,e){var i=.3;return null!=e&&(i=e[0]),cc.easeElasticIn(i).easing(t)},23:function(t,e){var i=.3;return null!=e&&(i=e[0]),cc.easeElasticOut(i).easing(t)},24:function(t,e){var i=.3;return null!=e&&(i=e[0]),cc.easeElasticInOut(i).easing(t)},25:cc._easeBackInObj.easing,26:cc._easeBackOutObj.easing,27:cc._easeBackInOutObj.easing,28:cc._easeBounceInObj.easing,29:cc._easeBounceOutObj.easing,30:cc._easeBounceInOutObj.easing},ccs.VisibleFrame=ccs.Frame.extend({_visible:!0,ctor:function(){ccs.Frame.prototype.ctor.call(this),this._visible=!0},onEnter:function(){this._node&&this._node.setVisible(this._visible)},clone:function(){var t=new ccs.VisibleFrame;return t.setVisible(this._visible),t._cloneProperty(this),t},setVisible:function(t){this._visible=t},isVisible:function(){return this._visible}}),ccs.VisibleFrame.create=function(){return new ccs.VisibleFrame},ccs.TextureFrame=ccs.Frame.extend({_sprite:null,_textureName:null,ctor:function(){ccs.Frame.prototype.ctor.call(this),this._textureName=""},setNode:function(t){ccs.Frame.prototype.setNode.call(this,t),this._sprite=t},onEnter:function(t){if(this._sprite){t=this._sprite.getBlendFunc();var e=cc.spriteFrameCache._spriteFrames[this._textureName];null!=e?this._sprite.setSpriteFrame(e):this._sprite.setTexture(this._textureName),this._sprite.getBlendFunc()!==t&&this._sprite.setBlendFunc(t)}},clone:function(){var t=new ccs.TextureFrame;return t.setTextureName(this._textureName),t._cloneProperty(this),t},setTextureName:function(t){this._textureName=t},getTextureName:function(){return this._textureName}}),ccs.TextureFrame.create=function(){return new ccs.TextureFrame},ccs.RotationFrame=ccs.Frame.extend({_rotation:null,_betwennRotation:null,ctor:function(){ccs.Frame.prototype.ctor.call(this),this._rotation=0},onEnter:function(t){this._node&&(this._node.setRotation(this._rotation),this._tween&&(this._betwennRotation=t._rotation-this._rotation))},_onApply:function(t){0!==this._betwennRotation&&this._node.setRotation(this._rotation+t*this._betwennRotation)},clone:function(){var t=new ccs.RotationFrame;return t.setRotation(this._rotation),t._cloneProperty(this),t},setRotation:function(t){this._rotation=t},getRotation:function(){return this._rotation}}),ccs.RotationFrame.create=function(){return new ccs.RotationFrame},ccs.SkewFrame=ccs.Frame.extend({_skewX:null,_skewY:null,_betweenSkewX:null,_betweenSkewY:null,ctor:function(){ccs.Frame.prototype.ctor.call(this),this._skewY=this._skewX=0},onEnter:function(t){this._node&&(this._node.setSkewX(this._skewX),this._node.setSkewY(this._skewY),this._tween&&(this._betweenSkewX=t._skewX-this._skewX,this._betweenSkewY=t._skewY-this._skewY))},_onApply:function(t){if(0!==this._betweenSkewX||0!==this._betweenSkewY){var e=this._skewY+t*this._betweenSkewY;this._node.setSkewX(this._skewX+t*this._betweenSkewX),this._node.setSkewY(e)}},clone:function(){var t=new ccs.SkewFrame;return t.setSkewX(this._skewX),t.setSkewY(this._skewY),t._cloneProperty(this),t},setSkewX:function(t){this._skewX=t},getSkewX:function(){return this._skewX},setSkewY:function(t){this._skewY=t},getSkewY:function(){return this._skewY}}),ccs.SkewFrame.create=function(){return new ccs.SkewFrame},ccs.RotationSkewFrame=ccs.SkewFrame.extend({onEnter:function(t){this._node&&(this._node.setRotationX(this._skewX),this._node.setRotationY(this._skewY),this._tween&&(this._betweenSkewX=t._skewX-this._skewX,this._betweenSkewY=t._skewY-this._skewY))},_onApply:function(t){if(this._node&&(0!==this._betweenSkewX||0!==this._betweenSkewY)){var e=this._skewY+t*this._betweenSkewY;this._node.setRotationX(this._skewX+t*this._betweenSkewX),this._node.setRotationY(e)}},clone:function(){var t=new ccs.RotationSkewFrame;return t.setSkewX(this._skewX),t.setSkewY(this._skewY),t._cloneProperty(this),t}}),ccs.RotationSkewFrame.create=function(){return new ccs.RotationSkewFrame},ccs.PositionFrame=ccs.Frame.extend({_position:null,_betweenX:null,_betweenY:null,ctor:function(){ccs.Frame.prototype.ctor.call(this),this._position=cc.p(0,0)},onEnter:function(t){this._node&&(this._node.setPosition(this._position),this._tween&&(this._betweenX=t._position.x-this._position.x,this._betweenY=t._position.y-this._position.y))},_onApply:function(t){if(this._node&&(0!==this._betweenX||0!==this._betweenY)){var e=cc.p(0,0);e.x=this._position.x+this._betweenX*t,e.y=this._position.y+this._betweenY*t,this._node.setPosition(e)}},clone:function(){var t=new ccs.PositionFrame;return t.setPosition(this._position),t._cloneProperty(this),t},setPosition:function(t){this._position=t},getPosition:function(){return this._position},setX:function(t){this._position.x=t},getX:function(){return this._position.x},setY:function(t){this._position.y=t},getY:function(){return this._position.y}}),ccs.PositionFrame.create=function(){return new ccs.PositionFrame},ccs.ScaleFrame=ccs.Frame.extend({_scaleX:null,_scaleY:null,_betweenScaleX:null,_betweenScaleY:null,ctor:function(){ccs.Frame.prototype.ctor.call(this),this._scaleY=this._scaleX=1},onEnter:function(t){this._node&&(this._node.setScaleX(this._scaleX),this._node.setScaleY(this._scaleY),this._tween&&(this._betweenScaleX=t._scaleX-this._scaleX,this._betweenScaleY=t._scaleY-this._scaleY))},_onApply:function(t){if(this._node&&(0!==this._betweenScaleX||0!==this._betweenScaleY)){var e=this._scaleY+this._betweenScaleY*t;this._node.setScaleX(this._scaleX+this._betweenScaleX*t),this._node.setScaleY(e)}},clone:function(){var t=new ccs.ScaleFrame;return t.setScaleX(this._scaleX),t.setScaleY(this._scaleY),t._cloneProperty(this),t},setScale:function(t){this._scaleY=this._scaleX=t},setScaleX:function(t){this._scaleX=t},getScaleX:function(){return this._scaleX},setScaleY:function(t){this._scaleY=t},getScaleY:function(){return this._scaleY}}),ccs.ScaleFrame.create=function(){return new ccs.ScaleFrame},ccs.AnchorPointFrame=ccs.Frame.extend({_anchorPoint:null,ctor:function(){ccs.Frame.prototype.ctor.call(this),this._anchorPoint=cc.p(0,0)},onEnter:function(){this._node&&this._node.setAnchorPoint(this._anchorPoint)},clone:function(){var t=new ccs.AnchorPointFrame;return t.setAnchorPoint(this._anchorPoint),t._cloneProperty(this),t},setAnchorPoint:function(t){this._anchorPoint=t},getAnchorPoint:function(){return this._anchorPoint}}),ccs.AnchorPointFrame.create=function(){return new ccs.AnchorPointFrame},ccs.InnerActionType={LoopAction:0,NoLoopAction:1,SingleFrame:2},ccs.InnerActionFrame=ccs.Frame.extend({_innerActionType:null,_startFrameIndex:null,_endFrameIndex:0,_singleFrameIndex:0,_enterWithName:null,_animationName:"",ctor:function(){ccs.Frame.prototype.ctor.call(this),this._enterWithName=!1,this._innerActionType=ccs.InnerActionType.LoopAction,this._startFrameIndex=0},onEnter:function(t){if(this._node&&(t=this._node.getActionByTag(this._node.getTag())))if(ccs.InnerActionType.SingleFrame===this._innerActionType)t.gotoFrameAndPause(this._singleFrameIndex);else{var e=this._startFrameIndex,i=this._endFrameIndex;this._enterWithName&&("-- ALL --"===this._animationName?(e=0,i=t.getDuration()):t.isAnimationInfoExists(this._animationName)?(i=t.getAnimationInfo(this._animationName),e=i.startIndex,i=i.endIndex):cc.log("Animation %s not exists!",this._animationName));var n=this._timeline.getActionTimeline().getDuration()-this._frameIndex-i+e;0>n&&(i+=n),ccs.InnerActionType.NoLoopAction===this._innerActionType?t.gotoFrameAndPlay(e,i,!1):ccs.InnerActionType.LoopAction===this._innerActionType&&t.gotoFrameAndPlay(e,i,!0)}},setAnimationName:function(t){this._animationName=t},setSingleFrameIndex:function(t){this._singleFrameIndex=t},getSingleFrameIndex:function(){return this._startFrameIndex},setEnterWithName:function(t){this._enterWithName=t},getEnterWithName:function(){return this._enterWithName},clone:function(){var t=new ccs.InnerActionFrame;return t.setInnerActionType(this._innerActionType),t.setStartFrameIndex(this._startFrameIndex),t.setEnterWithName(this._enterWithName),t.setAnimationName(this._animationName),t.setSingleFrameIndex(this._singleFrameIndex),t._cloneProperty(this),t},setInnerActionType:function(t){this._innerActionType=t},getInnerActionType:function(){return this._innerActionType},setStartFrameIndex:function(t){this._startFrameIndex=t},getStartFrameIndex:function(){return this._startFrameIndex}}),ccs.InnerActionFrame.create=function(){return new ccs.InnerActionFrame},ccs.ColorFrame=ccs.Frame.extend({_alpha:null,_color:null,_betweenAlpha:null,_betweenRed:null,_betweenGreen:null,_betweenBlue:null,ctor:function(){ccs.Frame.prototype.ctor.call(this),this._color=cc.color(255,255,255)},onEnter:function(t){this._node&&(this._node.setColor(this._color),this._tween&&(t=t._color,this._betweenRed=t.r-this._color.r,this._betweenGreen=t.g-this._color.g,this._betweenBlue=t.b-this._color.b))},_onApply:function(t){if(this._node&&this._tween&&(0!==this._betweenAlpha||0!==this._betweenRed||0!==this._betweenGreen||0!==this._betweenBlue)){var e=cc.color(255,255,255);e.r=this._color.r+this._betweenRed*t,e.g=this._color.g+this._betweenGreen*t,e.b=this._color.b+this._betweenBlue*t,this._node.setColor(e),null!==this._alpha&&this._node.setOpacity(this._alpha+this._betweenAlpha*t)}},clone:function(){var t=new ccs.ColorFrame;return t.setColor(this._color),t._cloneProperty(this),t},setColor:function(t){this._color=t},getColor:function(){return this._color}}),ccs.ColorFrame.create=function(){return new ccs.ColorFrame},ccs.AlphaFrame=ccs.Frame.extend({_alpha:null,_betweenAlpha:null,ctor:function(){ccs.Frame.prototype.ctor.call(this),this._alpha=255},onEnter:function(t){this._node&&(this._node.setOpacity(this._alpha),this._tween&&(this._betweenAlpha=t._alpha-this._alpha))},_onApply:function(t){this._node&&this._node.setOpacity(this._alpha+this._betweenAlpha*t)},setAlpha:function(t){this._alpha=t},getAlpha:function(){return this._alpha},clone:function(){var t=new ccs.AlphaFrame;return t.setAlpha(this._alpha),t._cloneProperty(this),t}}),ccs.EventFrame=ccs.Frame.extend({_event:null,ctor:function(){ccs.Frame.prototype.ctor.call(this),this._event="",this._enterWhenPassed=!0},onEnter:function(){this._emitEvent()},clone:function(){var t=new ccs.EventFrame;return t.setEvent(this._event),t._cloneProperty(this),t},setEvent:function(t){this._event=t},getEvent:function(){return this._event}}),ccs.EventFrame.create=function(){return new ccs.EventFrame},ccs.ZOrderFrame=ccs.Frame.extend({_zorder:null,onEnter:function(){this._node&&this._node.setLocalZOrder(this._zorder)},clone:function(){var t=new ccs.ZOrderFrame;return t.setZOrder(this._zorder),t._cloneProperty(this),t},setZOrder:function(t){this._zorder=t},getZOrder:function(){return this._zorder}}),ccs.ZOrderFrame.create=function(){return new ccs.ZOrderFrame},ccs.BlendFuncFrame=ccs.Frame.extend({onEnter:function(){this._node&&this._node.setBlendFunc(this._blendFunc)},clone:function(){var t=new ccs.BlendFuncFrame;return t.setBlendFunc(this._blendFunc),t.cloneProperty(this),t}}),ccs.BlendFuncFrame.create=function(){return new ccs.BlendFuncFrame},ccs.Timeline=ccs.Class.extend({_frames:null,_currentKeyFrame:null,_currentKeyFrameIndex:null,_fromIndex:null,_toIndex:null,_betweenDuration:null,_actionTag:null,_ActionTimeline:null,_node:null,ctor:function(){this._frames=[],this._currentKeyFrame=null,this._actionTag=this._betweenDuration=this._toIndex=this._fromIndex=this._currentKeyFrameIndex=0,this._node=this._ActionTimeline=null},_gotoFrame:function(t){0!==this._frames.length&&(this._binarySearchKeyFrame(t),this._apply(t))},_stepToFrame:function(t){0!==this._frames.length&&(this._updateCurrentKeyFrame(t),this._apply(t))},getFrames:function(){return this._frames},addFrame:function(t){this._frames.push(t),t.setTimeline(this)},insertFrame:function(t,e){this._frames.splice(e,0,t),t.setTimeline(this)},removeFrame:function(t){cc.arrayRemoveObject(this._frames,t),t.setTimeline(null)},setActionTag:function(t){this._actionTag=t},getActionTag:function(){return this._actionTag},setNode:function(t){for(var e=0;e<this._frames.length;e++)this._frames[e].setNode(t)},getNode:function(){return this._node},setActionTimeline:function(t){this._ActionTimeline=t},getActionTimeline:function(){return this._ActionTimeline},clone:function(){var t=new ccs.Timeline;t._actionTag=this._actionTag;for(var e=0;e<this._frames.length;e++){var i=this._frames[e].clone();t.addFrame(i)}return t},_apply:function(t){this._currentKeyFrame&&this._currentKeyFrame.apply(0>=this._betweenDuration?0:(t-this._currentKeyFrameIndex)/this._betweenDuration)},_binarySearchKeyFrame:function(t){var e=null,i=null,n=this._frames.length,r=!1;do if(t<=this._frames[0].getFrameIndex())this._currentKeyFrameIndex>=this._frames[0].getFrameIndex()&&(r=!0),this._fromIndex=0,this._toIndex=n>1?1:0,e=i=this._frames[0],this._currentKeyFrameIndex=0,this._betweenDuration=this._frames[0].getFrameIndex();else if(t>=this._frames[n-1].getFrameIndex())this._fromIndex=n-1,this._toIndex=0,e=i=this._frames[n-1],this._currentKeyFrameIndex=this._frames[n-1].getFrameIndex(),this._betweenDuration=0;else{for(var o=-1,e=0,i=n-1,s=0;i>=e;){if(s=Math.ceil((e+i)/2),t>=this._frames[s].getFrameIndex()&&t<this._frames[s+1].getFrameIndex()){o=s;break}this._frames[s].getFrameIndex()>t?i=s-1:e=s+1}this._fromIndex=o,this._toIndex=n>1?o+1|0:0|o,e=this._frames[o],i=this._frames[o+1],0===o&&this._currentKeyFrameIndex<e.getFrameIndex()&&(r=!0),this._currentKeyFrameIndex=e.getFrameIndex(),this._betweenDuration=i.getFrameIndex()-e.getFrameIndex()}while(0);(r||this._currentKeyFrame!=e)&&(this._currentKeyFrame=e,this._currentKeyFrame.onEnter(i))},_updateCurrentKeyFrame:function(t){if(t<this._currentKeyFrameIndex||t>=this._currentKeyFrameIndex+this._betweenDuration){var e=null,i=null;do{var n=this._frames.length;if(t<this._frames[0].getFrameIndex())e=i=this._frames[0],this._currentKeyFrameIndex=0,this._betweenDuration=this._frames[0].getFrameIndex();else{if(t>=this._frames[n-1].getFrameIndex()&&(t=this._frames[n-1].getFrameIndex(),this._currentKeyFrameIndex>=t))return;for(;;){if(this._fromIndex=this._toIndex,e=this._frames[this._fromIndex],this._currentKeyFrameIndex=e.getFrameIndex(),this._toIndex=this._fromIndex+1,this._toIndex>=n&&(this._toIndex=0),i=this._frames[this._toIndex],t===e.getFrameIndex())break;if(t>e.getFrameIndex()&&t<i.getFrameIndex())break;e.isEnterWhenPassed()&&e.onEnter(i)}this._betweenDuration=i.getFrameIndex()-e.getFrameIndex()}}while(0);this._currentKeyFrame=e,this._currentKeyFrame.onEnter(i)}}}),ccs.Timeline.create=function(){return new ccs.Timeline
},ccs._load=function(){var t=function(t,n,o){var s=cc.loader.getRes(t);if(!s)return cc.log("%s does not exist",t);var c=t.match(i),c=(c&&c[1]?c[1]:null).toLocaleLowerCase();if("json"!==c&&"exportjson"!==c)return cc.log("%s load error, must be json file",t);var a;return n?a=e[n]:s.widgetTree?a=e.ccui:s.nodeTree?a=e.timeline:s.Content&&s.Content.Content?a=e.timeline:s.gameobjects&&(a=e.scene),a?(n=s.version||s.Version,!n&&s.armature_data?(cc.warn("%s is armature. please use:",t),cc.warn("    ccs.armatureDataManager.addArmatureFileInfoAsync(%s);",t),cc.warn("    var armature = new ccs.Armature('name');"),new cc.Node):(a=r(a,n),a?a.parse(t,s,o)||null:(cc.log("Can't find the parser : %s",t),new cc.Node))):(cc.log("Can't find the parser : %s",t),new cc.Node)},e={ccui:{},timeline:{},action:{},scene:{}};t.registerParser=function(t,i,n){return t&&i&&n?(e[t]||(e[t]={}),void(e[t][i]=n)):cc.log("register parser error")},t.getParser=function(t,i){return t&&i?e[t]?e[t][i]:void 0:t?e[t]:e};var i=/\.([^\.]+)$/,n=/([^\.](\.\*)?)*$/,r=function(t,e){return t[e]?t[e]:"*"===e?null:r(t,e.replace(n,"*"))};return t}(),ccs._parser=cc.Class.extend({ctor:function(){this.parsers={}},_dirnameReg:/\S*\//,_dirname:function(t){return(t=t.match(this._dirnameReg))&&t[0]?t[0]:""},getClass:function(t){return t.classname},getNodeJson:function(t){return t.widgetTree},parse:function(t,e,i){i=i||this._dirname(t),this.pretreatment(e,i);var n=this.parseNode(this.getNodeJson(e),i,t);return n&&this.deferred(e,i,n,t),n},pretreatment:function(){},deferred:function(){},parseNode:function(t,e){var i=this.parsers[this.getClass(t)],n=null;return i?n=i.call(this,t,e):cc.log("Can't find the parser : %s",this.getClass(t)),n},registerParser:function(t,e){this.parsers[t]=e}}),ccs.load=function(t,e){var i={node:null,action:null};return i.node=ccs._load(t,null,e),i.action=ccs._load(t,"action",e),i.action&&-1===i.action.tag&&i.node&&(i.action.tag=i.node.tag),i},ccs.actionTimelineCache={createAction:function(t){return ccs._load(t,"action")}},ccs.csLoader={createNode:function(t){return ccs._load(t)}},cc._jsonLoader={load:function(t,e,i,n){cc.loader.loadJson(t,function(e,i){if(i&&i.Content&&i.Content.Content.UsedResources){for(var r=i.Content.Content.UsedResources,o=cc.path.dirname(t),s=0;s<r.length;s++)r[s]=cc.path.join(o,r[s]);cc.loader.load(r,function(){cc.loader.loadJson(t,n)})}else cc.loader.loadJson(t,n)})}},cc.loader.register(["json","ExportJson"],cc._jsonLoader),function(t,e){var i=new(e.extend({getNodeJson:function(t){return t},parseNode:function(t,e){var i=this.parsers[this.getClass(t)],n=null;return i?n=i.call(this,t,e):cc.log("Can't find the parser : %s",this.getClass(t)),n},deferred:function(t,e,i){ccs.triggerManager.parse(t.Triggers||[]),ccs.sceneReader&&(ccs.sceneReader._node=i)},setPropertyFromJsonDict:function(t,e){var i=cc.isUndefined(e.x)?0:e.x,n=cc.isUndefined(e.y)?0:e.y;t.setPosition(i,n),i=Boolean(cc.isUndefined(e.visible)?1:e.visible),t.setVisible(i),i=cc.isUndefined(e.objecttag)?-1:e.objecttag,t.setTag(i),i=cc.isUndefined(e.zorder)?0:e.zorder,t.setLocalZOrder(i),i=cc.isUndefined(e.scalex)?1:e.scalex,n=cc.isUndefined(e.scaley)?1:e.scaley,t.setScaleX(i),t.setScaleY(n),i=cc.isUndefined(e.rotation)?0:e.rotation,t.setRotation(i),t.setName(e.name||"")}}));i.parseChild=function(t,e,i){for(var n=0;n<e.length;n++){var r,o=e[n];o&&(r=this.parseNode(o,i)),r&&t.addChild(r)}};var n={CCSprite:function(t,e,i){var n=new cc.Sprite;return o(e.fileData,i,function(t,e){if(0===e)n.setTexture(t);else if(1===e){var i=cc.spriteFrameCache.getSpriteFrame(t);n.setSpriteFrame(i)}}),e=new ccs.ComRender(n,"CCSprite"),t.addComponent(e),e},CCTMXTiledMap:function(t,e,i){var n=null;return o(e.fileData,i,function(t,e){0===e&&(n=new cc.TMXTiledMap(t))}),e=new ccs.ComRender(n,"CCTMXTiledMap"),t.addComponent(e),e},CCParticleSystemQuad:function(t,e,i){var n=null;return o(e.fileData,i,function(t,e){0===e?n=new cc.ParticleSystem(t):cc.log("unknown resourcetype on CCParticleSystemQuad!"),n.setPosition(0,0)}),e=new ccs.ComRender(n,"CCParticleSystemQuad"),t.addComponent(e),e},CCArmature:function(t,e,i){var n=null;return o(e.fileData,i,function(t,e){if(0===e){var i=cc.loader.getRes(t);i||cc.log("Please load the resource [%s] first!",t),i=i.armature_data[0].name,ccs.armatureDataManager.addArmatureFileInfo(t),n=new ccs.Armature(i)}}),n?(i=new ccs.ComRender(n,"CCArmature"),t.addComponent(i),(t=e.selectedactionname)&&n.getAnimation()&&n.getAnimation().play(t),i):void 0},CCComAudio:function(t,e,i){var n=null;o(e.fileData,i,function(i,r){if(0===r){n=new ccs.ComAudio,n.preloadEffect(i);var o=e.name;o&&n.setName(o),t.addComponent(n)}})},CCComAttribute:function(t,e,i){var n=null;return o(e.fileData,i,function(e,i){0===i?(n=new ccs.ComAttribute,""!==e&&n.parse(e),t.addComponent(n)):cc.log("unknown resourcetype on CCComAttribute!")}),n},CCBackgroundAudio:function(t,e,i){var n=null;o(e.fileData,i,function(i,r){if(0===r){n=new ccs.ComAudio,n.preloadBackgroundMusic(i),n.setFile(i);var o=Boolean(e.loop||0);n.setLoop(o);var s=e.name;s&&n.setName(s),t.addComponent(n),n.playBackgroundMusic(i,o)}})},GUIComponent:function(t,e,i){var n=null;return o(e.fileData,i,function(t){n=ccs._load(t,"ccui")}),e=new ccs.ComRender(n,"GUIComponent"),t.addComponent(e),e},CCScene:function(){}},r={},o=function(t,e,i){if(null!=t){var n=t.path,o=t.resourceType;t=t.plist,n&&(t&&(cc.loader.getRes(e+t)?(r[e+t]=!0,cc.spriteFrameCache.addSpriteFrames(e+t)):r[e+t]||cc.log("%s need to be preloaded",e+t)),0!==o?i(n,o):i(e+n,o))}};i.parseComponents=function(t,e,i){t&&e&&e.forEach(function(e){var r=n[e.classname],o=null;r?o=r(t,e,i):cc.log("Can't find the component parser : %s",e.classname),e=e.name,o&&e&&o.setName(e)})},i.registerParser("CCNode",function(t,e){var i=new cc.Node;this.setPropertyFromJsonDict(i,t),this.parseChild.call(this,i,t.gameobjects,e),this.parseComponents(i,t.components,e);var n=t.CanvasSize;return n&&i.setContentSize(cc.size(n._width,n._height)),i}),t.registerParser("scene","*",i)}(ccs._load,ccs._parser),function(t,e){var i=new(e.extend({addSpriteFrame:function(t,e){if(t)for(var i=0;i<t.length;i++)cc.spriteFrameCache.addSpriteFrames(e+t[i])},pretreatment:function(t,e){this.addSpriteFrame(t.textures,e)},deferred:function(t,e,i,n){i&&(ccs.actionManager.initWithDictionary(n,t.animation,i),i.setContentSize(cc.size(t.designWidth,t.designHeight)))}}));i.generalAttributes=function(t,e){var i=e.ignoreSize;null!=i&&t.ignoreContentAdaptWithSize(i),e.sizeType&&t.setSizeType(e.sizeType),e.positionType&&t.setPositionType(e.positionType),t.setSizePercent(cc.p(e.sizePercentX,e.sizePercentY)),t.setPositionPercent(cc.p(e.positionPercentX,e.positionPercentY));var n=i=0;if(e.adaptScreen?(n=cc.director.getWinSize(),i=n.width,n=n.height):(i=e.width,n=e.height),t.setContentSize(i,n),t.setTag(e.tag),t.setActionTag(e.actiontag),t.setTouchEnabled(e.touchAble),i=e.name,t.setName(i?i:"default"),t.setPosition(e.x,e.y),t.setScaleX(null!=e.scaleX?e.scaleX:1),t.setScaleY(null!=e.scaleY?e.scaleY:1),t.setRotation(e.rotation||0),i=e.visible||!1,null!=i&&t.setVisible(i),t.setLocalZOrder(e.ZOrder),null!=e.layoutParameter){switch(i=e.layoutParameter,n=null,i.type){case 1:n=new ccui.LinearLayoutParameter,n.setGravity(i.gravity);break;case 2:var r=n=new ccui.RelativeLayoutParameter;r.setRelativeName(i.relativeName),r.setRelativeToWidgetName(i.relativeToName),r.setAlign(i.align)}null!=n&&(n.setMargin(i.marginLeft||0,i.marginTop||0,i.marginRight||0,i.marginDown||0),t.setLayoutParameter(n))}},i.colorAttributes=function(t,e){var i=e.opacity;null!=i&&t.setOpacity(i);var i=e.colorR,n=e.colorG,r=e.colorB;t.setColor(cc.color(null==i?255:i,null==n?255:n,null==r?255:r)),t.setFlippedX(e.flipX),t.setFlippedY(e.flipY)},i.anchorPointAttributes=function(t,e){var i,n=e.anchorPointX;i=null!=n?e.anchorPointX:t.getAnchorPoint().x;var r,o=e.anchorPointY;r=null!=o?e.anchorPointY:t.getAnchorPoint().y,null==n&&null==o||t.setAnchorPoint(cc.p(i,r))},i.parseChild=function(t,e,i){e=e.children;for(var n=0;n<e.length;n++){var r=this.parseNode(e[n],i);if(r)if(t instanceof ccui.PageView)t.addPage(r);else if(t instanceof ccui.ListView)t.pushBackCustomItem(r);else{if(!(t instanceof ccui.Layout)){if(r.getPositionType()===ccui.Widget.POSITION_PERCENT){var o=r.getPositionPercent(),s=t.getAnchorPoint();r.setPositionPercent(cc.p(o.x+s.x,o.y+s.y))}o=t.getAnchorPointInPoints(),r.setPosition(cc.p(r.getPositionX()+o.x,r.getPositionY()+o.y))}t.addChild(r)}}};var n=function(t,e,i,n){i&&(0===e?n(t+i,e):n(i,e))};i.LayoutAttributes=function(t,e,i){var r=0,o=0;e.adaptScreen?(o=cc.director.getWinSize(),r=o.width,o=o.height):(r=e.width,o=e.height),t.setSize(cc.size(r,o)),t.setClippingEnabled(e.clipAble),r=e.backGroundScale9Enable,t.setBackGroundImageScale9Enabled(r);var o=e.bgColorR,s=e.bgColorG,c=e.bgColorB,a=e.bgStartColorR,l=e.bgStartColorG,h=e.bgStartColorB,u=e.bgEndColorR,d=e.bgEndColorG,_=e.bgEndColorB;t.setBackGroundColorVector(cc.p(e.vectorX,e.vectorY));var p=e.bgColorOpacity;t.setBackGroundColorType(e.colorType),t.setBackGroundColor(cc.color(a,l,h),cc.color(u,d,_)),t.setBackGroundColor(cc.color(o,s,c)),t.setBackGroundColorOpacity(p),(o=e.backGroundImageData)&&n(i,o.resourceType,o.path,function(e,i){t.setBackGroundImage(e,i)}),r&&t.setBackGroundImageCapInsets(cc.rect(e.capInsetsX,e.capInsetsY,e.capInsetsWidth,e.capInsetsHeight)),e.layoutType&&t.setLayoutType(e.layoutType)},i.ButtonAttributes=function(t,e,i){var r=e.scale9Enable;t.setScale9Enabled(r);var o=e.normalData;n(i,o.resourceType,o.path,function(e,i){t.loadTextureNormal(e,i)}),o=e.pressedData,n(i,o.resourceType,o.path,function(e,i){t.loadTexturePressed(e,i)}),o=e.disabledData,n(i,o.resourceType,o.path,function(e,i){t.loadTextureDisabled(e,i)}),r&&(t.setCapInsets(cc.rect(e.capInsetsX,e.capInsetsY,e.capInsetsWidth,e.capInsetsHeight)),i=e.scale9Width,r=e.scale9Height,null!=i&&null!=r&&t.setSize(cc.size(i,r))),i=e.text,null!=i&&t.setTitleText(i),t.setTitleColor(cc.color(null!==e.textColorR?e.textColorR:255,null!==e.textColorG?e.textColorG:255,null!==e.textColorB?e.textColorB:255)),null!=e.fontSize&&t.setTitleFontSize(e.fontSize),e.fontName&&t.setTitleFontName(e.fontName)},i.CheckBoxAttributes=function(t,e,i){var r=e.backGroundBoxData;n(i,r.resourceType,r.path,function(e,i){t.loadTextureBackGround(e,i)});var o=e.backGroundBoxSelectedData;n(i,o.resourceType||r.resourceType,o.path||r.path,function(e,i){t.loadTextureBackGroundSelected(e,i)}),r=e.frontCrossData,n(i,r.resourceType,r.path,function(e,i){t.loadTextureFrontCross(e,i)}),o=e.backGroundBoxDisabledData,n(i,o.resourceType||r.resourceType,o.path||r.path,function(e,i){t.loadTextureBackGroundDisabled(e,i)}),r=e.frontCrossDisabledData,n(i,r.resourceType,r.path,function(e,i){t.loadTextureFrontCrossDisabled(e,i)}),e.selectedState&&t.setSelected(e.selectedState)},i.ImageViewAttributes=function(t,e,i){var r=e.fileNameData;n(i,r.resourceType,r.path,function(e,i){t.loadTexture(e,i)}),i=!1,e.scale9Enable&&(i=e.scale9Enable),t.setScale9Enabled(i),i&&(i=e.scale9Height,e.scale9Width&&i&&t.setSize(cc.size(e.scale9Width,e.scale9Height)),t.setCapInsets(cc.rect(e.capInsetsX,e.capInsetsY,e.capInsetsWidth,e.capInsetsHeight)))},i.TextAtlasAttributes=function(t,e,i){var n=e.stringValue,r=e.charMapFileData,o=e.itemWidth,s=e.itemHeight,c=e.startCharMap;if(null!=n&&r&&null!=o&&null!=s&&null!=c)switch(e=e.charMapFileData,e.resourceType){case 0:t.setProperty(n,i+e.path,o,s,c);break;case 1:cc.log("Wrong res type of LabelAtlas!")}},i.TextBMFontAttributes=function(t,e,i){var n=e.fileNameData;switch(n.resourceType){case 0:t.setFntFile(i+n.path);break;case 1:cc.log("Wrong res type of LabelAtlas!")}t.setString(e.text)};var r=/\.ttf$/;i.TextAttributes=function(t,e,i){t.setTouchScaleChangeEnabled(e.touchScaleEnable),t.setString(e.text),null!=e.fontSize&&t.setFontSize(e.fontSize);var n=e.fontName;null!=n&&t.setFontName(cc.sys.isNative?r.test(n)?cc.path.join(cc.loader.resPath,i,n):n:n.replace(r,"")),i=e.areaHeight,null!=e.areaWidth&&null!=i&&(i=cc.size(e.areaWidth,e.areaHeight),t.setTextAreaSize(i)),null!=e.hAlignment&&t.setTextHorizontalAlignment(e.hAlignment),null!=e.vAlignment&&t.setTextVerticalAlignment(e.vAlignment)},i.ListViewAttributes=function(t,e,n){i.ScrollViewAttributes(t,e,n),t.setDirection(e.direction),t.setGravity(e.gravity),t.setItemsMargin(e.itemMargin)},i.LoadingBarAttributes=function(t,e,i){var r=e.textureData;n(i,r.resourceType,r.path,function(e,i){t.loadTexture(e,i)}),i=e.scale9Enable,t.setScale9Enabled(i),i&&(t.setCapInsets(cc.rect(e.capInsetsX,e.capInsetsY,e.capInsetsWidth,e.capInsetsHeight)),t.setSize(cc.size(e.width,e.height))),t.setDirection(e.direction),t.setPercent(e.percent)},i.PageViewAttributes=i.LayoutAttributes,i.ScrollViewAttributes=function(t,e,n){i.LayoutAttributes(t,e,n),t.setInnerContainerSize(cc.size(null!=e.innerWidth?e.innerWidth:200,null!=e.innerHeight?e.innerHeight:200)),t.setDirection(null!=e.direction?e.direction:1),t.setBounceEnabled(e.bounceEnable)},i.SliderAttributes=function(t,e,i){var r=e.scale9Enable;t.setScale9Enabled(r);var o=e.length,s=e.barFileNameData,c=s.resourceType,s=s.path;null!=e.barFileName?r&&(n(i,c,s,function(e,i){t.loadBarTexture(e,i)}),t.setSize(cc.size(o,t.getContentSize().height))):n(i,c,s,function(e,i){t.loadBarTexture(e,i)}),r=e.ballNormalData,n(i,r.resourceType,r.path,function(e,i){t.loadSlidBallTextureNormal(e,i)}),o=e.ballPressedData,n(i,o.resourceType||r.resourceType,o.path||r.path,function(e,i){t.loadSlidBallTexturePressed(e,i)}),r=e.ballDisabledData,n(i,r.resourceType,r.path,function(e,i){t.loadSlidBallTextureDisabled(e,i)}),e=e.progressBarData,n(i,e.resourceType,e.path,function(e,i){t.loadProgressBarTexture(e,i)})},i.TextFieldAttributes=function(t,e,i){var n=e.placeHolder;n&&t.setPlaceHolder(n),t.setString(e.text||""),(n=e.fontSize1)&&t.setFontSize(n),n=e.fontName,null!=n&&t.setFontName(cc.sys.isNative?r.test(n)?cc.path.join(cc.loader.resPath,i,n):n:n.replace(r,"")),i=e.touchSizeWidth,n=e.touchSizeHeight,null!=i&&null!=n&&t.setTouchSize(i,n),i=e.maxLengthEnable,t.setMaxLengthEnabled(i),i&&t.setMaxLength(e.maxLength),i=e.passwordEnable,t.setPasswordEnabled(i),i&&t.setPasswordStyleText(e.passwordStyleText),i=e.areaWidth,n=e.areaHeight,i&&n&&(i=cc.size(i,n),t.setTextAreaSize(i)),(i=e.hAlignment)&&t.setTextHorizontalAlignment(i),(e=e.vAlignment)&&t.setTextVerticalAlignment(e)},[{name:"Panel",object:ccui.Layout,handle:i.LayoutAttributes},{name:"Button",object:ccui.Button,handle:i.ButtonAttributes},{name:"CheckBox",object:ccui.CheckBox,handle:i.CheckBoxAttributes},{name:"ImageView",object:ccui.ImageView,handle:i.ImageViewAttributes},{name:"LabelAtlas",object:ccui.TextAtlas,handle:i.TextAtlasAttributes},{name:"LabelBMFont",object:ccui.TextBMFont,handle:i.TextBMFontAttributes},{name:"Label",object:ccui.Text,handle:i.TextAttributes},{name:"ListView",object:ccui.ListView,handle:i.ListViewAttributes},{name:"LoadingBar",object:ccui.LoadingBar,handle:i.LoadingBarAttributes},{name:"PageView",object:ccui.PageView,handle:i.PageViewAttributes},{name:"ScrollView",object:ccui.ScrollView,handle:i.ScrollViewAttributes},{name:"Slider",object:ccui.Slider,handle:i.SliderAttributes},{name:"TextField",object:ccui.TextField,handle:i.TextFieldAttributes}].forEach(function(t){i.registerParser(t.name,function(e,n){var r=new t.object,o=e.options;return i.generalAttributes(r,o),t.handle(r,o,n),i.colorAttributes(r,o),i.anchorPointAttributes(r,o),i.parseChild.call(this,r,e,n),r})}),t.registerParser("ccui","*",i)}(ccs._load,ccs._parser),function(t,e){var i={},n=new(e.extend({getNodeJson:function(t){return t.action},parseNode:function(t,e,n){if(!t)return null;if(i[n])return i[n].clone();var r=this,o=new ccs.ActionTimeline;return o.setDuration(t.duration),o.setTimeSpeed(t.speed||1),t.timelines.forEach(function(t){var i,n=r.parsers[t.frameType];n?i=n.call(r,t,e):cc.log("parser does not exist : %s",t.frameType),i&&o.addTimeline(i),"ColorFrame"===t.frameType&&o.addTimeline(r.parsers.AlphaFrame.call(r,t,e))}),i[n]=o,i[n].retain(),o.clone()}}));[{name:"PositionFrame",handle:function(t){var e=new ccs.PositionFrame;return e.setPosition(cc.p(t.x,t.y)),e}},{name:"VisibleFrame",handle:function(t){var e=new ccs.VisibleFrame;return e.setVisible(t.value),e}},{name:"ScaleFrame",handle:function(t){var e=new ccs.ScaleFrame,i=t.y;return e.setScaleX(t.x),e.setScaleY(i),e}},{name:"RotationFrame",handle:function(t){var e=new ccs.RotationFrame;return e.setRotation(t.rotation),e}},{name:"SkewFrame",handle:function(t){var e=new ccs.SkewFrame,i=t.y;return e.setSkewX(t.x),e.setSkewY(i),e}},{name:"RotationSkewFrame",handle:function(t){var e=new ccs.RotationSkewFrame,i=t.y;return e.setSkewX(t.x),e.setSkewY(i),e}},{name:"AnchorFrame",handle:function(t){var e=new ccs.AnchorPointFrame;return e.setAnchorPoint(cc.p(t.x,t.y)),e}},{name:"InnerActionFrame",handle:function(t){var e=new ccs.InnerActionFrame,i=t.startFrame;return e.setInnerActionType(t.innerActionType),e.setStartFrameIndex(i),e}},{name:"ColorFrame",handle:function(t){var e=new ccs.ColorFrame;return e.setColor(cc.color(t.red,t.green,t.blue)),(new ccs.AlphaFrame).setAlpha(t.alpha),e}},{name:"AlphaFrame",handle:function(t){var e=new ccs.AlphaFrame;return e.setAlpha(t.alpha),e}},{name:"TextureFrame",handle:function(t){var e=new ccs.TextureFrame;if(t=t.value,null!=t){var i=t;null==cc.spriteFrameCache.getSpriteFrame(i)&&(i=ccs.csLoader.getJsonPath()+t),e.setTextureName(i)}return e}},{name:"EventFrame",handle:function(t){var e=new ccs.EventFrame;return t=t.value,null!=t&&e.setEvent(t),e}},{name:"ZOrderFrame",handle:function(t){var e=new ccs.ZOrderFrame;return e.setZOrder(t.value),e}}].forEach(function(t){n.registerParser(t.name,function(e){var i=new ccs.Timeline;i.setActionTag(e.actionTag);var n=e.frames;return n&&n.length&&n.forEach(function(e){var n=t.handle(e);n.setFrameIndex(e.frameIndex),n.setTween(e.tween),i.addFrame(n)}),i})}),t.registerParser("action","*",n)}(ccs._load,ccs._parser),function(t,e){var i={},n=new(e.extend({getNodeJson:function(t){return t.Content.Content.Animation},parseNode:function(t,e,n){if(!t)return null;if(i[n])return i[n].clone();var r=this,o=new ccs.ActionTimeline;return o.setDuration(t.Duration),o.setTimeSpeed(t.Speed||1),t.Timelines.forEach(function(t){var i,n=r.parsers[t.Property];n?i=n.call(r,t,e):cc.log("parser does not exist : %s",t.Property),i&&o.addTimeline(i)}),i[n]=o,i[n].retain(),o.clone()},deferred:function(t,e,i,n){for(e=(t=t.Content.Content.AnimationList)?t.length:0,n=0;e>n;n++){var r=t[n],o={name:null,startIndex:null,endIndex:null};o.name=r.Name,o.startIndex=r.StartIndex,o.endIndex=r.EndIndex,i.addAnimationInfo(o)}}})),r=function(t,e){t.setTweenType(e.Type);var i=e.Points,n=[];i&&(i.forEach(function(t){n.push(t.X),n.push(t.Y)}),t.setEasingParams(n))};[{name:"Position",handle:function(t){var e=new ccs.PositionFrame;return e.setPosition(cc.p(t.X,t.Y)),e}},{name:"VisibleForFrame",handle:function(t){var e=new ccs.VisibleFrame;return e.setVisible(t.Value),e}},{name:"Scale",handle:function(t){var e=new ccs.ScaleFrame,i=t.Y;return e.setScaleX(t.X),e.setScaleY(i),e}},{name:"Rotation",handle:function(t){var e=new ccs.RotationFrame;return e.setRotation(t.Rotation),e}},{name:"Skew",handle:function(t){var e=new ccs.SkewFrame,i=t.Y;return e.setSkewX(t.X),e.setSkewY(i),e}},{name:"RotationSkew",handle:function(t){var e=new ccs.RotationSkewFrame,i=t.Y;return e.setSkewX(t.X),e.setSkewY(i),e}},{name:"Anchor",handle:function(t){var e=new ccs.AnchorPointFrame;return e.setAnchorPoint(cc.p(t.X,t.Y)),e}},{name:"AnchorPoint",handle:function(t){var e=new ccs.AnchorPointFrame;return e.setAnchorPoint(cc.p(t.X,t.Y)),e}},{name:"InnerAction",handle:function(t){var e=new ccs.InnerActionFrame,i=t.StartFrame;return e.setInnerActionType(t.InnerActionType),e.setStartFrameIndex(i),e}},{name:"CColor",handle:function(t){var e=new ccs.ColorFrame;return(t=t.Color)||(t={}),t.R=void 0===t.R?255:t.R,t.G=void 0===t.G?255:t.G,t.B=void 0===t.B?255:t.B,e.setColor(cc.color(t.R,t.G,t.B)),e}},{name:"Alpha",handle:function(t){var e=new ccs.AlphaFrame;return e.setAlpha(t.Value),e}},{name:"FileData",handle:function(t,e){var i,n,r,o;return i=new ccs.TextureFrame,n=t.TextureFile,null!=n&&(r=n.Plist,n=n.Path,o=cc.spriteFrameCache.getSpriteFrame(n),!o&&r&&(cc.loader.getRes(e+r)?(cc.spriteFrameCache.addSpriteFrames(e+r),o=cc.spriteFrameCache.getSpriteFrame(n)):cc.log("%s need to be preloaded",e+r)),null==o&&(n=e+n),i.setTextureName(n)),i}},{name:"FrameEvent",handle:function(t){var e=new ccs.EventFrame;return t=t.Value,null!=t&&e.setEvent(t),e}},{name:"ZOrder",handle:function(t){var e=new ccs.ZOrderFrame;return e.setZOrder(t.Value),e}},{name:"ActionValue",handle:function(t){var e=new ccs.InnerActionFrame,i=t.InnerActionType,n=t.CurrentAniamtionName,r=t.SingleFrameIndex;return t=t.FrameIndex,void 0!==t&&e.setFrameIndex(t),e.setInnerActionType(ccs.InnerActionType[i]),e.setSingleFrameIndex(r),e.setEnterWithName(!0),n&&e.setAnimationName(n),e}}].forEach(function(t){n.registerParser(t.name,function(e,i){var n=new ccs.Timeline;n.setActionTag(e.ActionTag);var o=e.Frames;return o&&o.length&&o.forEach(function(e){var o=t.handle(e,i);o.setFrameIndex(e.FrameIndex),o.setTween(null!=e.Tween?e.Tween:!0),(e=e.EasingData)&&r(o,e),n.addFrame(o)}),n})}),t.registerParser("action","2.*",n)}(ccs._load,ccs._parser),function(t,e){var i={},n=new(e.extend({getNodeJson:function(t){return t.nodeTree},addSpriteFrame:function(t,e,n){if(t&&e&&t.length===e.length)for(var r=0;r<t.length;r++){var o=n+t[r];cc.loader.getRes(o)||i[o]?i[o]=!0:cc.log("%s need to be preloaded",o),cc.spriteFrameCache.addSpriteFrames(o,n+e[r])}},pretreatment:function(t,e){this.addSpriteFrame(t.textures,t.texturesPng,e)}}));n.generalAttributes=function(t,e){var i=null!=e.width?e.width:0,n=null!=e.height?e.height:0,r=null!=e.x?e.x:0,o=null!=e.y?e.y:0,s=null!=e.scaleX?e.scaleX:1,c=null!=e.scaleY?e.scaleY:1,a=null!=e.rotation?e.rotation:0,l=null!=e.rotationSkewX?e.rotationSkewX:0,h=null!=e.rotationSkewY?e.rotationSkewY:0,u=null!=e.skewX?e.skewX:0,d=null!=e.skewY?e.skewY:0,_=null!=e.anchorPointX?e.anchorPointX:.5,p=null!=e.anchorPointY?e.anchorPointY:.5,f=null!=e.opacity?e.opacity:255,m=null!=e.colorR?e.colorR:255,g=null!=e.colorG?e.colorG:255,y=null!=e.colorB?e.colorB:255,T=null!=e.colorR?e.colorR:0,S=null!=e.tag?e.tag:0,C=null!=e.actionTag?e.actionTag:0,v=null!=e.visible?e.visible:!0;0==r&&0==o||t.setPosition(cc.p(r,o)),1!=s&&t.setScaleX(s),1!=c&&t.setScaleY(c),0!=a&&t.setRotation(a),0!=l&&t.setRotationX(l),0!=h&&t.setRotationY(h),0!=u&&t.setSkewX(u),0!=d&&t.setSkewY(d),.5==_&&.5==p||t.setAnchorPoint(cc.p(_,p)),0==i&&0==n||t.setContentSize(cc.size(i,n)),0!=T&&t.setLocalZOrder(T),1!=v&&t.setVisible(v),255!=f&&t.setOpacity(f),255==m&&255==g&&255==y||t.setColor(cc.color(m,g,y)),t.setTag(S),t.setUserObject(new ccs.ActionTimelineData(C))},n.parseComponent=function(t,e){if(e)for(var i=0;i<e.length;++i){var n=this.loadComponent(e[i]);n&&t.addComponent(n)}},n.parseChild=function(t,e,i,n){for(t=i.children,i=0;i<t.length;i++){var r=this.parseNode(t[i],n);if(r)if(e instanceof ccui.PageView)r instanceof ccui.Layout&&e.addPage(r);else if(e instanceof ccui.ListView)r instanceof ccui.Widget&&e.pushBackCustomItem(r);else{if(!(e instanceof ccui.Layout)&&r instanceof ccui.Widget){if(r.getPositionType()===ccui.Widget.POSITION_PERCENT){var o=r.getPositionPercent(),s=e.getAnchorPoint();r.setPositionPercent(cc.p(o.x+s.x,o.y+s.y))}o=e.getAnchorPointInPoints(),r.setPosition(cc.p(r.getPositionX()+o.x,r.getPositionY()+o.y))}e.addChild(r)}}},n.initNode=function(t){var e=new cc.Node;return this.generalAttributes(e,t),e},n.initSubGraph=function(t){var e=t.fileName,e=e&&""!==e?this.createNode(e):new ccs.Node;return this.generalAttributes(e,t),e},n.initSprite=function(t,e){var i=t.fileName;if(null!=i){var n=cc.spriteFrameCache.getSpriteFrame(i),i=n?ccs.Sprite.createWithSpriteFrame(n):new ccs.Sprite(e+i);i||(i=new cc.Sprite,cc.log("filePath is empty. Create a sprite with no texture"))}else i=new ccs.Sprite;this.generalAttributes(i,t);var n=t.flipX,r=t.flipY;return 0!=n&&i.setFlippedX(n),0!=r&&i.setFlippedY(r),i},n.initParticle=function(t){var e=t.tmxFile,i=new cc.ParticleSystemQuad(t.plistFile);return i.setTotalParticles(e),this.generalAttributes(i,t),i},n.initTMXTiledMap=function(t){var e=t.tmxFile,i=t.tmxString,n=t.resourcePath,r=null;return e&&""!==e?r=new cc.TMXTiledMap(e):i&&""!==i&&n&&""!==n&&(r=new cc.TMXTiledMap(i,n)),r};var r=t.getParser("ccui")["*"];n.initWidget=function(t,e){var i=t.classname,n=r.parsers[i];if(!n)return cc.log("%s parser is not found",i);if(i=n.call(r,t,e)){var n=t.rotationSkewX,o=t.rotationSkewY,s=t.skewX,c=t.skewY;0!=n&&i.setRotationX(n),0!=o&&i.setRotationY(o),0!=s&&i.setSkewX(s),0!=c&&i.setSkewY(c),i.setUserObject(new ccs.ActionTimelineData(t.actionTag))}return i},[{name:"Node",handle:n.initNode},{name:"SubGraph",handle:n.initSubGraph},{name:"Sprite",handle:n.initSprite},{name:"Particle",handle:n.initParticle},{name:"TMXTiledMap",handle:n.initTMXTiledMap},{name:"Widget",handle:n.initWidget},{name:"Panel",handle:n.initWidget},{name:"Button",handle:n.initWidget},{name:"CheckBox",handle:n.initWidget},{name:"ImageView",handle:n.initWidget},{name:"LabelAtlas",handle:n.initWidget},{name:"LabelBMFont",handle:n.initWidget},{name:"Label",handle:n.initWidget},{name:"ListView",handle:n.initWidget},{name:"LoadingBar",handle:n.initWidget},{name:"PageView",handle:n.initWidget},{name:"ScrollView",handle:n.initWidget},{name:"Slider",handle:n.initWidget},{name:"TextField",handle:n.initWidget}].forEach(function(t){n.registerParser(t.name,function(e,i,n){var r=t.handle.call(this,e.options);return this.parseComponent(r,e.components),this.parseChild(i,r,e,n),r})}),t.registerParser("timeline","*",n)}(ccs._load,ccs._parser),function(t,e){var i=new(e.extend({parse:function(t,e,i){i=void 0!==i?i:this._dirname(t),this.pretreatment(e,i,t);var n=this.parseNode(this.getNodeJson(e),i);return this.deferred(e,i,n,t),n},getNodeJson:function(t){return t.Content.Content.ObjectData},getClass:function(t){return t.ctype}})),n=function(t,e){return void 0===t?e:t};i.generalAttributes=function(t,e){null!=e.Name&&t.setName(e.Name);var i=e.Position;null==i||null==i.X&&null==i.Y||t.setPosition(cc.p(i.X||0,i.Y||0)),i=e.Scale,null!=i&&(null!=i.ScaleX&&t.setScaleX(i.ScaleX),null!=i.ScaleY&&t.setScaleY(i.ScaleY)),i=e.RotationSkewX,null!=i&&t.setRotationX(i),i=e.RotationSkewY,null!=e.RotationSkewY&&t.setRotationY(i),i=e.AnchorPoint,null!=i&&(null==i.ScaleX&&(i.ScaleX=0),null==i.ScaleY&&(i.ScaleY=0),.5==i.ScaleX&&.5==i.ScaleY||t.setAnchorPoint(cc.p(i.ScaleX,i.ScaleY))),null!=e.ZOrder&&t.setLocalZOrder(e.ZOrder),i=n(e.VisibleForFrame,!0),t.setVisible(i),u(t,e.Size),null!=e.Alpha&&t.setOpacity(e.Alpha),t.setTag(e.Tag||0);var i=e.ActionTag||0,o=new ccs.ObjectExtensionData,s=e.UserData;void 0!==s&&o.setCustomProperty(s),o.setActionTag(i),t.setUserObject(o),t.setCascadeColorEnabled(!0),t.setCascadeOpacityEnabled(!0),r(t,e)},i.parseChild=function(t,e,i){if(t&&e)for(var n=0;n<e.length;n++){var r=this.parseNode(e[n],i);if(r)if(t instanceof ccui.PageView)r instanceof ccui.Layout&&t.addPage(r);else if(t instanceof ccui.ListView)r instanceof ccui.Widget&&t.pushBackCustomItem(r);else{if(!(t instanceof ccui.Layout)&&r instanceof ccui.Widget&&r.getPositionType()===ccui.Widget.POSITION_PERCENT){var o=r.getPositionPercent(),s=t.getAnchorPoint();r.setPositionPercent(cc.p(o.x+s.x,o.y+s.y))}t.addChild(r)}}},i.initSingleNode=function(t){var e=new cc.Node;return this.generalAttributes(e,t),t=t.CColor,null!=t&&e.setColor(h(t)),e},i.initSprite=function(t,e){var i=new cc.Sprite;l(t.FileData,e,function(t,e){if(0===e)i.setTexture(t);else if(1===e){var n=cc.spriteFrameCache.getSpriteFrame(t);n&&i.setSpriteFrame(n)}});var n=t.BlendFunc;if(t.BlendFunc){var r=cc.BlendFunc.ALPHA_PREMULTIPLIED;void 0!==n.Src&&(r.src=n.Src),void 0!==n.Dst&&(r.dst=n.Dst),i.setBlendFunc(r)}return t.FlipX&&i.setFlippedX(!0),t.FlipY&&i.setFlippedY(!0),this.generalAttributes(i,t),n=t.CColor,null!=n&&i.setColor(h(n)),i},i.initParticle=function(t,e){var i,n=this;return l(t.FileData,e,function(e){cc.loader.getRes(e)||cc.log("%s need to be preloaded",e),i=new cc.ParticleSystem(e),n.generalAttributes(i,t),i.setPositionType(cc.ParticleSystem.TYPE_GROUPED),!cc.sys.isNative&&i.setDrawMode(cc.ParticleSystem.TEXTURE_MODE);var r=t.BlendFunc;if(t.BlendFunc){var o=cc.BlendFunc.ALPHA_PREMULTIPLIED;void 0!==r.Src&&(o.src=r.Src),void 0!==r.Dst&&(o.dst=r.Dst),i.setBlendFunc(o)}}),i},i.widgetAttributes=function(t,e,i){t.setCascadeColorEnabled(!0),t.setCascadeOpacityEnabled(!0),t.setUnifySizeEnabled(!1),t.ignoreContentAdaptWithSize(!1),!i&&u(t,e.Size),(i=e.Name)&&t.setName(i),i=e.ActionTag||0,t.setActionTag(i);var o=new ccs.ObjectExtensionData,s=e.UserData;void 0!==s&&o.setCustomProperty(s),o.setActionTag(i),t.setUserObject(o),(i=e.RotationSkewX)&&t.setRotationX(i),(i=e.RotationSkewY)&&t.setRotationY(i),e.FlipX&&t.setFlippedX(!0),e.FlipY&&t.setFlippedY(!0),i=e.zOrder,null!=i&&t.setLocalZOrder(i),i=n(e.VisibleForFrame,!0),t.setVisible(i),i=e.Alpha,null!=i&&t.setOpacity(i),t.setTag(e.Tag||0),t.setTouchEnabled(e.TouchEnable||!1),i=e.CallBackType,null!=i&&t.setCallbackType(i),(i=e.CallBackName)&&t.setCallbackName(i),i=e.Position,null!=i&&t.setPosition(i.X||0,i.Y||0),o=e.Scale,null!=o&&(i=n(o.ScaleX,1),o=n(o.ScaleY,1),t.setScaleX(i),t.setScaleY(o)),i=e.AnchorPoint,null!=i&&t.setAnchorPoint(i.ScaleX||0,i.ScaleY||0),i=e.CColor,null!=i&&t.setColor(h(i)),r(t,e)};var r=function(t,e){var i=ccui.LayoutComponent.bindLayoutComponent(t);if(i){var n=e.PositionPercentXEnable||e.PositionPercentXEnabled||!1,r=e.PositionPercentYEnable||e.PositionPercentYEnabled||!1,o=0,s=0,c=e.PrePosition;null!=c&&(o=c.X||0,s=c.Y||0);var a=e.PercentWidthEnable||e.PercentWidthEnabled||!1,l=e.PercentHeightEnable||e.PercentHeightEnabled||!1,h=0,u=0,d=e.PreSize;null!=c&&(h=d.X||0,u=d.Y||0);var _=e.StretchWidthEnable||!1,p=e.StretchHeightEnable||!1,f=e.HorizontalEdge,c=e.VerticalEdge,d=e.LeftMargin||0,m=e.RightMargin||0,g=e.TopMargin||0,y=e.BottomMargin||0;i.setPositionPercentXEnabled(n),i.setPositionPercentYEnabled(r),i.setPositionPercentX(o),i.setPositionPercentY(s),i.setPercentWidthEnabled(a),i.setPercentHeightEnabled(l),i.setPercentWidth(h),i.setPercentHeight(u),i.setPercentWidthEnabled(a||l),i.setStretchWidthEnabled(_),i.setStretchHeightEnabled(p),n=ccui.LayoutComponent.horizontalEdge.NONE,"LeftEdge"===f?n=ccui.LayoutComponent.horizontalEdge.LEFT:"RightEdge"===f?n=ccui.LayoutComponent.horizontalEdge.RIGHT:"BothEdge"===f&&(n=ccui.LayoutComponent.horizontalEdge.CENTER),i.setHorizontalEdge(n),n=ccui.LayoutComponent.verticalEdge.NONE,"TopEdge"===c?n=ccui.LayoutComponent.verticalEdge.TOP:"BottomEdge"===c?n=ccui.LayoutComponent.verticalEdge.BOTTOM:"BothEdge"===c&&(n=ccui.LayoutComponent.verticalEdge.CENTER),i.setVerticalEdge(n),i.setTopMargin(g),i.setBottomMargin(y),i.setLeftMargin(d),i.setRightMargin(m),i.setVerticalEdge(n),i.setTopMargin(g),i.setBottomMargin(y),i.setLeftMargin(d),i.setRightMargin(m)}},o=function(t,e,i,n){2===t.getBackGroundColorType()?(i=i||{},n=n||{},t.setBackGroundColor(h(i),h(n))):(e=e||{},t.setBackGroundColor(h(e)))},s=function(t,e){t.setBackGroundColorVector(cc.p(e.ScaleX||0,e.ScaleY||0))};i.initPanel=function(t,e){var i=new ccui.Layout;this.widgetAttributes(i,t);var r=t.ClipAble;null!=r&&i.setClippingEnabled(r),r=n(t.ComboBoxIndex,0),i.setBackGroundColorType(r),r=n(t.BackColorAlpha,255),null!=r&&i.setBackGroundColorOpacity(r),r=t.Scale9Enable,null!=r&&i.setBackGroundImageScale9Enabled(r);var c=n(t.Alpha,255);return i.setOpacity(c),l(t.FileData,e,function(t,e){i.setBackGroundImage(t,e)}),r?(i.setBackGroundImageCapInsets(cc.rect(t.Scale9OriginX||0,t.Scale9OriginY||0,t.Scale9Width||0,t.Scale9Height||0)),u(i,t.Size)):i.isIgnoreContentAdaptWithSize()||u(i,t.Size),o(i,t.SingleColor,t.FirstColor,t.EndColor),s(i,t.ColorVector),i},i.initText=function(t,e){var i=new ccui.Text,r=t.TouchScaleChangeAble;null!=r&&i.setTouchScaleChangeEnabled(r),r=t.LabelText,null!=r&&i.setString(r),r=t.FontSize,null!=r&&i.setFontSize(r),r=t.FontName,null!=r&&i.setFontName(r);var r=t.AreaWidth,o=t.areaHeight;
switch(r&&o&&i.setTextAreaSize(cc.size(r,o)),r=t.HorizontalAlignmentType||"HT_Left"){case"HT_Right":r=2;break;case"HT_Center":r=1;break;default:r=0}switch(i.setTextHorizontalAlignment(r),r=t.VerticalAlignmentType||"VT_Top"){case"VT_Bottom":r=2;break;case"VT_Center":r=1;break;default:r=0}return i.setTextVerticalAlignment(r),r=t.FontResource,null!=r&&(r=r.Path,null!=r&&(r=cc.sys.isNative?cc.path.join(cc.loader.resPath,e,r):(r=r.match(/([^\/]+)\.(\S+)/))?r[1]:"",i.setFontName(r))),t.OutlineEnabled&&t.OutlineColor&&i.enableOutline&&i.enableOutline(h(t.OutlineColor),n(t.OutlineSize,1)),t.ShadowEnabled&&t.ShadowColor&&i.enableShadow&&i.enableShadow(h(t.ShadowColor),cc.size(n(t.ShadowOffsetX,2),n(t.ShadowOffsetY,-2)),t.ShadowBlurRadius||0),r=t.IsCustomSize,null!=r&&i.ignoreContentAdaptWithSize(!r),i.setUnifySizeEnabled(!1),r=t.CColor,t.CColor=null,i.setTextColor(h(r)),this.widgetAttributes(i,t,i.isIgnoreContentAdaptWithSize()),t.CColor=r,i},i.initButton=function(t,e){var i=new ccui.Button;l(t.NormalFileData,e,function(t,e){i.loadTextureNormal(t,e)}),l(t.PressedFileData,e,function(t,e){i.loadTexturePressed(t,e)}),l(t.DisabledFileData,e,function(t,e){i.loadTextureDisabled(t,e)});var r=n(t.Scale9Enable,!1);r&&i.setScale9Enabled(r);var o=t.ButtonText;return null!=o&&i.setTitleText(o),o=t.FontSize,null!=o&&i.setTitleFontSize(o),o=t.FontName,null!=o&&i.setTitleFontName(o),o=t.TextColor,null!=o&&i.setTitleColor(h(o)),o=n(t.DisplayState,!0),i.setBright(o),i.setEnabled(o),o=t.FontResource,null!=o&&(o=o.Path,null!=o&&(o=cc.sys.isNative?cc.path.join(cc.loader.resPath,e,o):(o=o.match(/([^\/]+)\.(\S+)/))?o[1]:"",i.setTitleFontName(o))),(o=i.getTitleRenderer())&&t.ShadowEnabled&&t.ShadowColor&&o.enableShadow&&o.enableShadow(h(t.ShadowColor),cc.size(n(t.ShadowOffsetX,2),n(t.ShadowOffsetY,-2)),t.ShadowBlurRadius||0),o&&t.OutlineEnabled&&t.OutlineColor&&o.enableStroke&&o.enableStroke(h(t.OutlineColor),n(t.OutlineSize,1)),this.widgetAttributes(i,t),r&&(i.setUnifySizeEnabled(!1),i.ignoreContentAdaptWithSize(!1),r=cc.rect(t.Scale9OriginX||0,t.Scale9OriginY||0,t.Scale9Width||0,t.Scale9Height||0),i.setCapInsets(r)),u(i,t.Size),i},i.initCheckBox=function(t,e){var i=new ccui.CheckBox;this.widgetAttributes(i,t),[{name:"NormalBackFileData",handle:i.loadTextureBackGround},{name:"PressedBackFileData",handle:i.loadTextureBackGroundSelected},{name:"NodeNormalFileData",handle:i.loadTextureFrontCross},{name:"DisableBackFileData",handle:i.loadTextureBackGroundDisabled},{name:"NodeDisableFileData",handle:i.loadTextureFrontCrossDisabled}].forEach(function(n){l(t[n.name],e,function(t,e){n.handle.call(i,t,e)})});var r=n(t.CheckedState,!1);return i.setSelected(r),r=n(t.DisplayState,!0),i.setBright(r),i.setEnabled(r),i},i.initScrollView=function(t,e){var i=new ccui.ScrollView;this.widgetAttributes(i,t),l(t.FileData,e,function(t,e){i.setBackGroundImage(t,e)}),i.setClippingEnabled(t.ClipAble);var r=n(t.ComboBoxIndex,0);return i.setBackGroundColorType(r),r=t.BackColorAlpha,null!=r&&i.setBackGroundColorOpacity(r),t.Scale9Enable?(i.setBackGroundImageScale9Enabled(!0),i.setBackGroundImageCapInsets(cc.rect(t.Scale9OriginX||0,t.Scale9OriginY||0,t.Scale9Width||0,t.Scale9Height||0)),u(i,t.Size)):i.isIgnoreContentAdaptWithSize()||u(i,t.Size),o(i,t.SingleColor,t.FirstColor,t.EndColor),s(i,t.ColorVector),r=t.InnerNodeSize,r=cc.size(r.Width||0,r.Height||0),i.setInnerContainerSize(r),r=0,"Vertical"===t.ScrollDirectionType&&(r=1),"Horizontal"===t.ScrollDirectionType&&(r=2),"Vertical_Horizontal"===t.ScrollDirectionType&&(r=3),i.setDirection(r),r=n(t.IsBounceEnabled,!1),i.setBounceEnabled(r),i},i.initImageView=function(t,e){var i=new ccui.ImageView;return l(t.FileData,e,function(t,e){i.loadTexture(t,e)}),l(t.ImageFileData,e,function(t,e){i.loadTexture(t,e)}),t.Scale9Enable?(i.setScale9Enabled(!0),i.setUnifySizeEnabled(!1),i.ignoreContentAdaptWithSize(!1),i.setCapInsets(cc.rect(t.Scale9OriginX||0,t.Scale9OriginY||0,t.Scale9Width||0,t.Scale9Height||0))):u(i,t.Size),this.widgetAttributes(i,t),i},i.initLoadingBar=function(t,e){var i=new ccui.LoadingBar;this.widgetAttributes(i,t),l(t.ImageFileData,e,function(t,e){i.loadTexture(t,e)}),i.setDirection("Right_To_Left"===t.ProgressType?1:0);var r=n(t.ProgressInfo,80);return null!=r&&i.setPercent(r),i},i.initSlider=function(t,e){var i=new ccui.Slider,r=cc.loader;this.widgetAttributes(i,t),[{name:"BackGroundData",handle:i.loadBarTexture},{name:"BallNormalData",handle:i.loadSlidBallTextureNormal},{name:"BallPressedData",handle:i.loadSlidBallTexturePressed},{name:"BallDisabledData",handle:i.loadSlidBallTextureDisabled},{name:"ProgressBarData",handle:i.loadProgressBarTexture}].forEach(function(n){l(t[n.name],e,function(t,e){0!==e||r.getRes(t)||cc.log("%s need to be preloaded",t),n.handle.call(i,t,e)})}),i.setPercent(t.PercentInfo||0);var o=n(t.DisplayState,!0);return i.setBright(o),i.setEnabled(o),i},i.initPageView=function(t,e){var i=new ccui.PageView;this.widgetAttributes(i,t),l(t.FileData,e,function(t,e){i.setBackGroundImage(t,e)}),i.setClippingEnabled(t.ClipAble||!1),t.Scale9Enable&&(i.setBackGroundImageScale9Enabled(!0),i.setBackGroundImageCapInsets(cc.rect(t.Scale9OriginX||0,t.Scale9OriginY||0,t.Scale9Width||0,t.Scale9Height||0)));var r=n(t.ComboBoxIndex,0);return i.setBackGroundColorType(r),o(i,t.SingleColor,t.FirstColor,t.EndColor),s(i,t.ColorVector),r=t.BackColorAlpha,null!=r&&i.setBackGroundColorOpacity(r),u(i,t.Size),i},i.initListView=function(t,e){var i=new ccui.ListView;this.widgetAttributes(i,t),l(t.FileData,e,function(t,e){i.setBackGroundImage(t,e)}),i.setClippingEnabled(t.ClipAble||!1);var r=n(t.ComboBoxIndex,0);i.setBackGroundColorType(r),r=n(t.BackColorAlpha,255),t.Scale9Enable&&(i.setBackGroundImageScale9Enabled(!0),i.setBackGroundImageCapInsets(cc.rect(t.Scale9OriginX||0,t.Scale9OriginY||0,t.Scale9Width||0,t.Scale9Height||0)));var c=n(t.DirectionType,ccui.ListView.DIR_HORIZONTAL),a=n(t.VerticalType,"Align_Left"),h=n(t.HorizontalType,"Align_Top");return c?"Vertical"===c&&(i.setDirection(ccui.ScrollView.DIR_VERTICAL),""===h?i.setGravity(ccui.ListView.GRAVITY_LEFT):"Align_Right"===h?i.setGravity(ccui.ListView.GRAVITY_RIGHT):"Align_HorizontalCenter"===h&&i.setGravity(ccui.ListView.GRAVITY_CENTER_HORIZONTAL)):(i.setDirection(ccui.ScrollView.DIR_HORIZONTAL),i.setGravity("Align_Bottom"===a?ccui.ListView.GRAVITY_BOTTOM:"Align_VerticalCenter"===a?ccui.ListView.GRAVITY_CENTER_VERTICAL:ccui.ListView.GRAVITY_TOP)),c=n(t.IsBounceEnabled,!1),i.setBounceEnabled(c),i.setItemsMargin(t.ItemMargin||0),c=t.InnerNodeSize,null!=c&&i.setInnerContainerSize(cc.size(c.Widget||0,c.Height||0)),o(i,t.SingleColor,t.FirstColor,t.EndColor),s(i,t.ColorVector),null!=r&&i.setBackGroundColorOpacity(r),u(i,t.Size),i},i.initTextAtlas=function(t,e){var i=new ccui.TextAtlas,n=t.LabelText,r=t.CharWidth,o=t.CharHeight,s=t.StartChar;return l(t.LabelAtlasFileImage_CNB,e,function(t,e){cc.loader.getRes(t)||cc.log("%s need to be preloaded",t),0===e&&i.setProperty(n,t,r,o,s)}),this.widgetAttributes(i,t),i},i.initTextBMFont=function(t,e){var i=new ccui.TextBMFont;return this.widgetAttributes(i,t),i.setString(t.LabelText),l(t.LabelBMFontFile_CNB,e,function(t){cc.loader.getRes(t)||cc.log("%s need to be pre loaded",t),i.setFntFile(t)}),i.ignoreContentAdaptWithSize(!0),i},i.initTextField=function(t,e){var i=new ccui.TextField;t.PasswordEnable&&(i.setPasswordEnabled(!0),i.setPasswordStyleText(t.PasswordStyleText||"*"));var n=t.PlaceHolderText;return null!=n&&i.setPlaceHolder(n),n=t.FontSize,null!=n&&i.setFontSize(n),n=t.FontName,null!=n&&i.setFontName(n),t.MaxLengthEnable&&(i.setMaxLengthEnabled(!0),i.setMaxLength(t.MaxLengthText||0)),this.widgetAttributes(i,t),n=t.LabelText,null!=n&&i.setString(n),n=t.FontResource,null!=n&&(n=n.Path,null!=n&&(n=cc.sys.isNative?cc.path.join(cc.loader.resPath,e,n):(n=n.match(/([^\/]+)\.(\S+)/))?n[1]:"",i.setFontName(n))),i.setUnifySizeEnabled(!1),i.ignoreContentAdaptWithSize(!1),n=t.CColor,null!=n&&i.setTextColor(h(n)),i.isIgnoreContentAdaptWithSize()||(u(i,t.Size),cc.sys.isNative&&i.getVirtualRenderer().setLineBreakWithoutSpace(!0)),i},i.initSimpleAudio=function(t,e){var i=t.Loop||!1;cc.audioEngine.setMusicVolume(t.Volume||0),l(t.FileData,e,function(t){cc.loader.load(t,function(){cc.audioEngine.playMusic(t,i)})})},i.initGameMap=function(t,e){var n=null;return l(t.FileData,e,function(e,r){0===r&&(n=new cc.TMXTiledMap(e)),i.generalAttributes(n,t)}),n},i.initProjectNode=function(t,e){var n=t.FileData;if(null!=n&&n.Path){if(n=e+n.Path,cc.loader.getRes(n)){if(n=ccs.load(n,e),i.generalAttributes(n.node,t),n.action&&n.node){n.action.tag=n.node.tag;var r=t.InnerActionSpeed;void 0!==r&&n.action.setTimeSpeed(r),n.node.runAction(n.action),n.action.gotoFrameAndPause(0)}return n.node}cc.log("%s need to be preloaded",n)}};var c=function(t){return t&&(t=t.match(/([^\/]+)\.[^\/]+$/))&&t[1]?t[1]:""};i.initArmature=function(t,e){var n=new ccs.Armature,r=t.IsLoop,o=t.IsAutoPlay,s=t.CurrentAnimationName;return l(t.FileData,e,function(t){var e,i,a=cc.loader.getRes(t);a?(e=a.config_file_path,i=a.config_png_path,e.forEach(function(t,e){i[e]&&cc.spriteFrameCache.addSpriteFrames(t,i[e])})):cc.log("%s need to be preloaded",t),ccs.armatureDataManager.addArmatureFileInfo(t),n.init(c(t)),o?n.getAnimation().play(s,-1,r):(n.getAnimation().play(s),n.getAnimation().gotoAndPause(0))}),i.generalAttributes(n,t),n.setColor(h(t.CColor)),n};var a={},l=function(t,e,i){if(null!=t){var n,r=t.Path;n="Default"===t.Type||"Normal"===t.Type?0:1,(t=t.Plist)&&(cc.loader.getRes(e+t)?(a[e+t]=!0,cc.spriteFrameCache.addSpriteFrames(e+t)):a[e+t]||cc.spriteFrameCache.getSpriteFrame(r)||cc.log("%s need to be preloaded",e+t)),0!==n?cc.spriteFrameCache.getSpriteFrame(r)?i(r,n):cc.log("failed to get spriteFrame: %s",r):i(e+r,n)}},h=function(t){return t?cc.color(null!=t.R?t.R:255,null!=t.G?t.G:255,null!=t.B?t.B:255,null!=t.A?t.A:255):void 0},u=function(t,e){var i=e.X||0,n=e.Y||0;e&&t.setContentSize(cc.size(i,n))};[{name:"SingleNodeObjectData",handle:i.initSingleNode},{name:"NodeObjectData",handle:i.initSingleNode},{name:"LayerObjectData",handle:i.initSingleNode},{name:"SpriteObjectData",handle:i.initSprite},{name:"ParticleObjectData",handle:i.initParticle},{name:"PanelObjectData",handle:i.initPanel},{name:"TextObjectData",handle:i.initText},{name:"ButtonObjectData",handle:i.initButton},{name:"CheckBoxObjectData",handle:i.initCheckBox},{name:"ScrollViewObjectData",handle:i.initScrollView},{name:"ImageViewObjectData",handle:i.initImageView},{name:"LoadingBarObjectData",handle:i.initLoadingBar},{name:"SliderObjectData",handle:i.initSlider},{name:"PageViewObjectData",handle:i.initPageView},{name:"ListViewObjectData",handle:i.initListView},{name:"TextAtlasObjectData",handle:i.initTextAtlas},{name:"TextBMFontObjectData",handle:i.initTextBMFont},{name:"TextFieldObjectData",handle:i.initTextField},{name:"SimpleAudioObjectData",handle:i.initSimpleAudio},{name:"GameMapObjectData",handle:i.initGameMap},{name:"ProjectNodeObjectData",handle:i.initProjectNode},{name:"ArmatureNodeObjectData",handle:i.initArmature}].forEach(function(t){i.registerParser(t.name,function(e,i){var n=t.handle.call(this,e,i);return this.parseChild(n,e.Children,i),n})}),t.registerParser("timeline","2.*",i)}(ccs._load,ccs._parser),function(){ccs.uiReader={_fileDesignSizes:{},widgetFromJsonFile:function(t){var e=cc.loader.getRes(t);e&&(this._fileDesignSizes[t]=cc.size(e.designWidth||0,e.designHeight||0));var e=e.Version||e.version,i=ccs.uiReader.getVersionInteger(e);return!e||i>=1700?(cc.warn("Not supported file types, Please try use the ccs.load"),null):ccs._load(t,"ccui")},registerTypeAndCallBack:function(t,e,i,n){var r=ccs._load.getParser("ccui")["*"],o=n.bind(i);r.registerParser(t,function(n,r){var s=new e,c=n.options;i.setPropsFromJsonDictionary&&i.setPropsFromJsonDictionary(s,c),this.generalAttributes(s,c);var a=c.customProperty,a=a?JSON.parse(a):{};return o(t,s,a),this.colorAttributes(s,c),this.anchorPointAttributes(s,c),this.parseChild.call(this,s,n,r),s})},getVersionInteger:function(t){if(!t||"string"!=typeof t)return 0;if(t=t.split("."),4!==t.length)return 0;var e=0;return t.forEach(function(t,i){e+=t*Math.pow(10,3-i)}),e},storeFileDesignSize:function(t,e){this._fileDesignSizes[t]=e},getFileDesignSize:function(t){return this._fileDesignSizes[t]},getFilePath:function(){return this._filePath},setFilePath:function(t){this._filePath=t},getParseObjectMap:function(){return ccs._load.getParser("ccui")["*"].parsers},getParseCallBackMap:function(){return ccs._load.getParser("ccui")["*"].parsers},clear:function(){}};var t=ccs._load.getParser("ccui")["*"];ccs.imageViewReader={setPropsFromJsonDictionary:t.ImageViewAttributes},ccs.buttonReader={setPropsFromJsonDictionary:t.ButtonAttributes},ccs.checkBoxReader={setPropsFromJsonDictionary:t.CheckBoxAttributes},ccs.labelAtlasReader={setPropsFromJsonDictionary:t.TextAtlasAttributes},ccs.labelBMFontReader={setPropsFromJsonDictionary:t.TextBMFontAttributes},ccs.labelReader={setPropsFromJsonDictionary:t.TextAttributes},ccs.layoutReader={setPropsFromJsonDictionary:t.LayoutAttributes},ccs.listViewReader={setPropsFromJsonDictionary:t.ListViewAttributes},ccs.loadingBarReader={setPropsFromJsonDictionary:t.LoadingBarAttributes},ccs.pageViewReader={setPropsFromJsonDictionary:t.PageViewAttributes},ccs.scrollViewReader={setPropsFromJsonDictionary:t.ScrollViewAttributes},ccs.sliderReader={setPropsFromJsonDictionary:t.SliderAttributes},ccs.textFieldReader={setPropsFromJsonDictionary:t.TextFieldAttributes}}(),function(){ccs.sceneReader={_node:null,createNodeWithSceneFile:function(t){return this._node=t=ccs._load(t,"scene")},getNodeByTag:function(t){return null==this._node?null:this._node.getTag()===t?this._node:this._nodeByTag(this._node,t)},_nodeByTag:function(t,e){if(null==t)return null;for(var i=null,n=t.getChildren(),r=0;r<n.length&&(!(i=n[r])||i.getTag()!==e)&&!(i=this._nodeByTag(i,e));r++);return i},version:function(){return"*"},setTarget:function(){},clear:function(){ccs.triggerManager.removeAll(),cc.audioEngine.end()}}}();var spine={radDeg:180/Math.PI,degRad:Math.PI/180,temp:[],Float32Array:"undefined"==typeof Float32Array?Array:Float32Array,Uint16Array:"undefined"==typeof Uint16Array?Array:Uint16Array,BoneData:function(t,e){this.name=t,this.parent=e}};spine.BoneData.prototype={length:0,x:0,y:0,rotation:0,scaleX:1,scaleY:1,inheritScale:!0,inheritRotation:!0,flipX:!1,flipY:!1},spine.SlotData=function(t,e){this.name=t,this.boneData=e},spine.SlotData.prototype={r:1,g:1,b:1,a:1,attachmentName:null,additiveBlending:!1},spine.IkConstraintData=function(t){this.name=t,this.bones=[]},spine.IkConstraintData.prototype={target:null,bendDirection:1,mix:1},spine.Bone=function(t,e,i){this.data=t,this.skeleton=e,this.parent=i,this.setToSetupPose()},spine.Bone.yDown=!1,spine.Bone.prototype={x:0,y:0,rotation:0,rotationIK:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,m00:0,m01:0,worldX:0,m10:0,m11:0,worldY:0,worldRotation:0,worldScaleX:1,worldScaleY:1,worldFlipX:!1,worldFlipY:!1,updateWorldTransform:function(){var t=this.parent;if(t)this.worldX=this.x*t.m00+this.y*t.m01+t.worldX,this.worldY=this.x*t.m10+this.y*t.m11+t.worldY,this.data.inheritScale?(this.worldScaleX=t.worldScaleX*this.scaleX,this.worldScaleY=t.worldScaleY*this.scaleY):(this.worldScaleX=this.scaleX,this.worldScaleY=this.scaleY),this.worldRotation=this.data.inheritRotation?t.worldRotation+this.rotationIK:this.rotationIK,this.worldFlipX=t.worldFlipX!=this.flipX,this.worldFlipY=t.worldFlipY!=this.flipY;else{var t=this.skeleton.flipX,e=this.skeleton.flipY;this.worldX=t?-this.x:this.x,this.worldY=e!=spine.Bone.yDown?-this.y:this.y,this.worldScaleX=this.scaleX,this.worldScaleY=this.scaleY,this.worldRotation=this.rotationIK,this.worldFlipX=t!=this.flipX,this.worldFlipY=e!=this.flipY}e=this.worldRotation*spine.degRad,t=Math.cos(e),e=Math.sin(e),this.worldFlipX?(this.m00=-t*this.worldScaleX,this.m01=e*this.worldScaleY):(this.m00=t*this.worldScaleX,this.m01=-e*this.worldScaleY),this.worldFlipY!=spine.Bone.yDown?(this.m10=-e*this.worldScaleX,this.m11=-t*this.worldScaleY):(this.m10=e*this.worldScaleX,this.m11=t*this.worldScaleY)},setToSetupPose:function(){var t=this.data;this.x=t.x,this.y=t.y,this.rotationIK=this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.flipX=t.flipX,this.flipY=t.flipY},worldToLocal:function(t){var e=t[0]-this.worldX,i=t[1]-this.worldY,n=this.m00,r=this.m10,o=this.m01,s=this.m11;this.worldFlipX!=(this.worldFlipY!=spine.Bone.yDown)&&(n=-n,s=-s);var c=1/(n*s-o*r);t[0]=e*n*c-i*o*c,t[1]=i*s*c-e*r*c},localToWorld:function(t){var e=t[0],i=t[1];t[0]=e*this.m00+i*this.m01+this.worldX,t[1]=e*this.m10+i*this.m11+this.worldY}},spine.Slot=function(t,e){this.data=t,this.bone=e,this.setToSetupPose()},spine.Slot.prototype={r:1,g:1,b:1,a:1,_attachmentTime:0,attachment:null,attachmentVertices:[],setAttachment:function(t){this.attachment=t,this._attachmentTime=this.bone.skeleton.time,this.attachmentVertices.length=0},setAttachmentTime:function(t){this._attachmentTime=this.bone.skeleton.time-t},getAttachmentTime:function(){return this.bone.skeleton.time-this._attachmentTime},setToSetupPose:function(){var t=this.data;this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a;for(var e=this.bone.skeleton.data.slots,i=0,n=e.length;n>i;i++)if(e[i]==t){this.setAttachment(t.attachmentName?this.bone.skeleton.getAttachmentBySlotIndex(i,t.attachmentName):null);break}}},spine.IkConstraint=function(t,e){this.data=t,this.mix=t.mix,this.bendDirection=t.bendDirection,this.bones=[];for(var i=0,n=t.bones.length;n>i;i++)this.bones.push(e.findBone(t.bones[i].name));this.target=e.findBone(t.target.name)},spine.IkConstraint.prototype={apply:function(){var t=this.target,e=this.bones;switch(e.length){case 1:spine.IkConstraint.apply1(e[0],t.worldX,t.worldY,this.mix);break;case 2:spine.IkConstraint.apply2(e[0],e[1],t.worldX,t.worldY,this.bendDirection,this.mix)}}},spine.IkConstraint.apply1=function(t,e,i,n){var r=t.data.inheritRotation&&t.parent?t.parent.worldRotation:0,o=t.rotation;e=Math.atan2(i-t.worldY,e-t.worldX)*spine.radDeg,t.worldFlipX!=(t.worldFlipY!=spine.Bone.yDown)&&(e=-e),t.rotationIK=o+(e-r-o)*n},spine.IkConstraint.apply2=function(t,e,i,n,r,o){var s=e.rotation,c=t.rotation;if(o){var a,l,h=spine.temp;(a=t.parent)?(h[0]=i,h[1]=n,a.worldToLocal(h),i=(h[0]-t.x)*a.worldScaleX,n=(h[1]-t.y)*a.worldScaleY):(i-=t.x,n-=t.y),e.parent==t?(a=e.x,l=e.y):(h[0]=e.x,h[1]=e.y,e.parent.localToWorld(h),t.worldToLocal(h),a=h[0],l=h[1]),h=a*t.worldScaleX,l*=t.worldScaleY,a=Math.atan2(l,h),l=Math.sqrt(h*h+l*l);var h=e.data.length*e.worldScaleX,u=2*l*h;1e-4>u?e.rotationIK=s+(Math.atan2(n,i)*spine.radDeg-c-s)*o:(u=(i*i+n*n-l*l-h*h)/u,-1>u?u=-1:u>1&&(u=1),r*=Math.acos(u),l+=h*u,h*=Math.sin(r),i=(Math.atan2(n*l-i*h,i*l+n*h)-a)*spine.radDeg-c,i>180?i-=360:-180>i&&(i+=360),t.rotationIK=c+i*o,i=(r+a)*spine.radDeg-s,i>180?i-=360:-180>i&&(i+=360),e.rotationIK=s+(i+t.worldRotation-e.parent.worldRotation)*o)}else e.rotationIK=s,t.rotationIK=c},spine.Skin=function(t){this.name=t,this.attachments={}},spine.Skin.prototype={addAttachment:function(t,e,i){this.attachments[t+":"+e]=i},getAttachment:function(t,e){return this.attachments[t+":"+e]},_attachAll:function(t,e){for(var i in e.attachments){var n=i.indexOf(":"),r=parseInt(i.substring(0,n)),o=i.substring(n+1),n=t.slots[r];n.attachment&&n.attachment.name==o&&(r=this.getAttachment(r,o))&&n.setAttachment(r)}}},spine.Animation=function(t,e,i){this.name=t,this.timelines=e,this.duration=i},spine.Animation.prototype={apply:function(t,e,i,n,r){n&&0!=this.duration&&(i%=this.duration,e%=this.duration),n=this.timelines;for(var o=0,s=n.length;s>o;o++)n[o].apply(t,e,i,r,1)},mix:function(t,e,i,n,r,o){n&&0!=this.duration&&(i%=this.duration,e%=this.duration),n=this.timelines;for(var s=0,c=n.length;c>s;s++)n[s].apply(t,e,i,r,o)}},spine.Animation.binarySearch=function(t,e,i){var n=0,r=Math.floor(t.length/i)-2;if(!r)return i;for(var o=r>>>1;;){if(t[(o+1)*i]<=e?n=o+1:r=o,n==r)return(n+1)*i;o=n+r>>>1}},spine.Animation.binarySearch1=function(t,e){var i=0,n=t.length-2;if(!n)return 1;for(var r=n>>>1;;){if(t[r+1]<=e?i=r+1:n=r,i==n)return i+1;r=i+n>>>1}},spine.Animation.linearSearch=function(t,e,i){for(var n=0,r=t.length-i;r>=n;n+=i)if(t[n]>e)return n;return-1},spine.Curves=function(){this.curves=[]},spine.Curves.prototype={setLinear:function(t){this.curves[19*t]=0},setStepped:function(t){this.curves[19*t]=1},setCurve:function(t,e,i,n,r){var o=.1*.1,s=.1*o,c=3*.1,a=3*o,l=6*o,o=6*s,h=2*-e+n,u=2*-i+r;for(n=3*(e-n)+1,r=3*(i-r)+1,e=e*c+h*a+n*s,i=i*c+u*a+r*s,s=h*l+n*o,l=u*l+r*o,u=n*o,o*=r,t*=19,n=this.curves,n[t++]=2,r=e,c=i,a=t+19-1;a>t;t+=2)n[t]=r,n[t+1]=c,e+=s,i+=l,s+=u,l+=o,r+=e,c+=i},getCurvePercent:function(t,e){e=0>e?0:e>1?1:e;var i=this.curves,n=19*t,r=i[n];if(0===r)return e;if(1==r)return 0;n++;for(var r=0,o=n,s=n+19-1;s>n;n+=2)if(r=i[n],r>=e)return n==o?s=o=0:(o=i[n-2],s=i[n-1]),s+(i[n+1]-s)*(e-o)/(r-o);return i=i[n-1],i+(1-i)*(e-r)/(1-r)}},spine.RotateTimeline=function(t){this.curves=new spine.Curves(t),this.frames=[],this.frames.length=2*t},spine.RotateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(t,e,i){t*=2,this.frames[t]=e,this.frames[t+1]=i},apply:function(t,e,i,n,r){if(e=this.frames,!(i<e[0])){if(t=t.bones[this.boneIndex],i>=e[e.length-2])e=t.data.rotation+e[e.length-1]-t.rotation;else{var o=spine.Animation.binarySearch(e,i,2);n=e[o-1];var s=e[o];for(i=1-(i-s)/(e[o-2]-s),i=this.curves.getCurvePercent(o/2-1,i),e=e[o+1]-n;e>180;)e-=360;for(;-180>e;)e+=360;e=t.data.rotation+(n+e*i)-t.rotation}for(;e>180;)e-=360;for(;-180>e;)e+=360;t.rotation+=e*r}}},spine.TranslateTimeline=function(t){this.curves=new spine.Curves(t),this.frames=[],this.frames.length=3*t},spine.TranslateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(t,e,i,n){t*=3,this.frames[t]=e,this.frames[t+1]=i,this.frames[t+2]=n},apply:function(t,e,i,n,r){if(e=this.frames,!(i<e[0]))if(t=t.bones[this.boneIndex],i>=e[e.length-3])t.x+=(t.data.x+e[e.length-2]-t.x)*r,t.y+=(t.data.y+e[e.length-1]-t.y)*r;else{n=spine.Animation.binarySearch(e,i,3);var o=e[n-2],s=e[n-1],c=e[n];i=1-(i-c)/(e[n+-3]-c),i=this.curves.getCurvePercent(n/3-1,i),t.x+=(t.data.x+o+(e[n+1]-o)*i-t.x)*r,t.y+=(t.data.y+s+(e[n+2]-s)*i-t.y)*r}}},spine.ScaleTimeline=function(t){this.curves=new spine.Curves(t),this.frames=[],this.frames.length=3*t},spine.ScaleTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(t,e,i,n){t*=3,this.frames[t]=e,this.frames[t+1]=i,this.frames[t+2]=n},apply:function(t,e,i,n,r){if(e=this.frames,!(i<e[0]))if(t=t.bones[this.boneIndex],i>=e[e.length-3])t.scaleX+=(t.data.scaleX*e[e.length-2]-t.scaleX)*r,t.scaleY+=(t.data.scaleY*e[e.length-1]-t.scaleY)*r;else{n=spine.Animation.binarySearch(e,i,3);var o=e[n-2],s=e[n-1],c=e[n];i=1-(i-c)/(e[n+-3]-c),i=this.curves.getCurvePercent(n/3-1,i),t.scaleX+=(t.data.scaleX*(o+(e[n+1]-o)*i)-t.scaleX)*r,t.scaleY+=(t.data.scaleY*(s+(e[n+2]-s)*i)-t.scaleY)*r}}},spine.ColorTimeline=function(t){this.curves=new spine.Curves(t),this.frames=[],this.frames.length=5*t},spine.ColorTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length/5},setFrame:function(t,e,i,n,r,o){t*=5,this.frames[t]=e,this.frames[t+1]=i,this.frames[t+2]=n,this.frames[t+3]=r,this.frames[t+4]=o},apply:function(t,e,i,n,r){if(e=this.frames,!(i<e[0])){var o,s;if(i>=e[e.length-5])n=e.length-1,i=e[n-3],o=e[n-2],s=e[n-1],e=e[n];else{n=spine.Animation.binarySearch(e,i,5);var c=e[n-4];o=e[n-3],s=e[n-2];var a=e[n-1],l=e[n],l=1-(i-l)/(e[n-5]-l),l=this.curves.getCurvePercent(n/5-1,l);i=c+(e[n+1]-c)*l,o+=(e[n+2]-o)*l,s+=(e[n+3]-s)*l,e=a+(e[n+4]-a)*l}t=t.slots[this.slotIndex],1>r?(t.r+=(i-t.r)*r,t.g+=(o-t.g)*r,t.b+=(s-t.b)*r,t.a+=(e-t.a)*r):(t.r=i,t.g=o,t.b=s,t.a=e)}}},spine.AttachmentTimeline=function(t){this.curves=new spine.Curves(t),this.frames=[],this.frames.length=t,this.attachmentNames=[],this.attachmentNames.length=t},spine.AttachmentTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length},setFrame:function(t,e,i){this.frames[t]=e,this.attachmentNames[t]=i},apply:function(t,e,i,n){n=this.frames,i<n[0]?e>i&&this.apply(t,e,Number.MAX_VALUE,null,0):(e>i&&(e=-1),i=i>=n[n.length-1]?n.length-1:spine.Animation.binarySearch1(n,i)-1,n[i]<e||(e=this.attachmentNames[i],t.slots[this.slotIndex].setAttachment(e?t.getAttachmentBySlotIndex(this.slotIndex,e):null)))}},spine.EventTimeline=function(t){this.frames=[],this.frames.length=t,this.events=[],this.events.length=t},spine.EventTimeline.prototype={getFrameCount:function(){return this.frames.length},setFrame:function(t,e,i){this.frames[t]=e,this.events[t]=i},apply:function(t,e,i,n,r){if(n){var o=this.frames,s=o.length;if(e>i)this.apply(t,e,Number.MAX_VALUE,n,r),e=-1;else if(e>=o[s-1])return;if(!(i<o[0])){if(e<o[0])t=0;else for(t=spine.Animation.binarySearch1(o,e),e=o[t];t>0&&o[t-1]==e;)t--;for(e=this.events;s>t&&i>=o[t];t++)n.push(e[t])}}}},spine.DrawOrderTimeline=function(t){this.frames=[],this.frames.length=t,this.drawOrders=[],this.drawOrders.length=t},spine.DrawOrderTimeline.prototype={getFrameCount:function(){return this.frames.length},setFrame:function(t,e,i){this.frames[t]=e,this.drawOrders[t]=i},apply:function(t,e,i,n,r){if(e=this.frames,!(i<e[0]))if(n=i>=e[e.length-1]?e.length-1:spine.Animation.binarySearch1(e,i)-1,i=t.drawOrder,e=t.slots,n=this.drawOrders[n])for(r=0,o=n.length;o>r;r++)i[r]=t.slots[n[r]];else{r=0;for(var o=e.length;o>r;r++)i[r]=e[r]}}},spine.FfdTimeline=function(t){this.curves=new spine.Curves(t),this.frames=[],this.frames.length=t,this.frameVertices=[],this.frameVertices.length=t},spine.FfdTimeline.prototype={slotIndex:0,attachment:0,getFrameCount:function(){return this.frames.length},setFrame:function(t,e,i){this.frames[t]=e,this.frameVertices[t]=i},apply:function(t,e,i,n,r){if(e=t.slots[this.slotIndex],e.attachment==this.attachment){var o=this.frames;if(!(i<o[0]))if(n=this.frameVertices,t=n[0].length,e=e.attachmentVertices,e.length!=t&&(r=1),e.length=t,i>=o[o.length-1])if(i=n[o.length-1],1>r)for(n=0;t>n;n++)e[n]+=(i[n]-e[n])*r;else for(n=0;t>n;n++)e[n]=i[n];else{var s=spine.Animation.binarySearch1(o,i),c=o[s];if(i=1-(i-c)/(o[s-1]-c),i=this.curves.getCurvePercent(s-1,0>i?0:i>1?1:i),o=n[s-1],s=n[s],1>r)for(n=0;t>n;n++)c=o[n],e[n]+=(c+(s[n]-c)*i-e[n])*r;else for(n=0;t>n;n++)c=o[n],e[n]=c+(s[n]-c)*i}}}},spine.IkConstraintTimeline=function(t){this.curves=new spine.Curves(t),this.frames=[],this.frames.length=3*t},spine.IkConstraintTimeline.prototype={ikConstraintIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(t,e,i,n){t*=3,this.frames[t]=e,this.frames[t+1]=i,this.frames[t+2]=n},apply:function(t,e,i,n,r){if(e=this.frames,!(i<e[0]))if(t=t.ikConstraints[this.ikConstraintIndex],i>=e[e.length-3])t.mix+=(e[e.length-2]-t.mix)*r,t.bendDirection=e[e.length-1];else{n=spine.Animation.binarySearch(e,i,3);var o=e[n+-2],s=e[n];i=1-(i-s)/(e[n+-3]-s),i=this.curves.getCurvePercent(n/3-1,i),t.mix+=(o+(e[n+1]-o)*i-t.mix)*r,t.bendDirection=e[n+-1]}}},spine.FlipXTimeline=function(t){this.curves=new spine.Curves(t),this.frames=[],this.frames.length=2*t},spine.FlipXTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(t,e,i){t*=2,this.frames[t]=e,this.frames[t+1]=i?1:0},apply:function(t,e,i,n){n=this.frames,i<n[0]?e>i&&this.apply(t,e,Number.MAX_VALUE,null,0):(e>i&&(e=-1),i=(i>=n[n.length-2]?n.length:spine.Animation.binarySearch(n,i,2))-2,n[i]<e||(t.bones[this.boneIndex].flipX=0!=n[i+1]))}},spine.FlipYTimeline=function(t){this.curves=new spine.Curves(t),this.frames=[],this.frames.length=2*t},spine.FlipYTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(t,e,i){t*=2,this.frames[t]=e,this.frames[t+1]=i?1:0},apply:function(t,e,i,n){n=this.frames,i<n[0]?e>i&&this.apply(t,e,Number.MAX_VALUE,null,0):(e>i&&(e=-1),i=(i>=n[n.length-2]?n.length:spine.Animation.binarySearch(n,i,2))-2,n[i]<e||(t.bones[this.boneIndex].flipY=0!=n[i+1]))}},spine.SkeletonData=function(){this.bones=[],this.slots=[],this.skins=[],this.events=[],this.animations=[],this.ikConstraints=[]},spine.SkeletonData.prototype={name:null,defaultSkin:null,width:0,height:0,version:null,hash:null,findBone:function(t){for(var e=this.bones,i=0,n=e.length;n>i;i++)if(e[i].name==t)return e[i];return null},findBoneIndex:function(t){for(var e=this.bones,i=0,n=e.length;n>i;i++)if(e[i].name==t)return i;return-1},findSlot:function(t){for(var e=this.slots,i=0,n=e.length;n>i;i++)if(e[i].name==t)return slot[i];return null},findSlotIndex:function(t){for(var e=this.slots,i=0,n=e.length;n>i;i++)if(e[i].name==t)return i;return-1},findSkin:function(t){for(var e=this.skins,i=0,n=e.length;n>i;i++)if(e[i].name==t)return e[i];return null},findEvent:function(t){for(var e=this.events,i=0,n=e.length;n>i;i++)if(e[i].name==t)return e[i];return null},findAnimation:function(t){for(var e=this.animations,i=0,n=e.length;n>i;i++)if(e[i].name==t)return e[i];return null},findIkConstraint:function(t){for(var e=this.ikConstraints,i=0,n=e.length;n>i;i++)if(e[i].name==t)return e[i];return null}},spine.Skeleton=function(t){this.data=t,this.bones=[];for(var e=0,i=t.bones.length;i>e;e++){var n=t.bones[e],r=n.parent?this.bones[t.bones.indexOf(n.parent)]:null;this.bones.push(new spine.Bone(n,this,r))}for(this.slots=[],this.drawOrder=[],e=0,i=t.slots.length;i>e;e++)n=t.slots[e],r=this.bones[t.bones.indexOf(n.boneData)],n=new spine.Slot(n,r),this.slots.push(n),this.drawOrder.push(n);for(this.ikConstraints=[],e=0,i=t.ikConstraints.length;i>e;e++)this.ikConstraints.push(new spine.IkConstraint(t.ikConstraints[e],this));this.boneCache=[],this.updateCache()},spine.Skeleton.prototype={x:0,y:0,skin:null,r:1,g:1,b:1,a:1,time:0,flipX:!1,flipY:!1,updateCache:function(){var t=this.ikConstraints,e=t.length,i=e+1,n=this.boneCache;n.length>i&&(n.length=i);for(var r=0,o=n.length;o>r;r++)n[r].length=0;for(;n.length<i;)n[n.length]=[];var i=n[0],s=this.bones,r=0,o=s.length;t:for(;o>r;r++){var c=s[r],a=c;do{for(var l=0;e>l;l++)for(var h=t[l],u=h.bones[0],h=h.bones[h.bones.length-1];;){if(a==h){n[l].push(c),n[l+1].push(c);continue t}if(h==u)break;h=h.parent}a=a.parent}while(a);i[i.length]=c}},updateWorldTransform:function(){for(var t=this.bones,e=0,i=t.length;i>e;e++){var n=t[e];n.rotationIK=n.rotation}for(e=0,t=this.boneCache.length-1;;){for(var i=this.boneCache[e],n=0,r=i.length;r>n;n++)i[n].updateWorldTransform();if(e==t)break;this.ikConstraints[e].apply(),e++}},setToSetupPose:function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()},setBonesToSetupPose:function(){for(var t=this.bones,e=0,i=t.length;i>e;e++)t[e].setToSetupPose();for(t=this.ikConstraints,e=0,i=t.length;i>e;e++){var n=t[e];n.bendDirection=n.data.bendDirection,n.mix=n.data.mix}},setSlotsToSetupPose:function(){for(var t=this.slots,e=this.drawOrder,i=0,n=t.length;n>i;i++)e[i]=t[i],t[i].setToSetupPose(i)},getRootBone:function(){return this.bones.length?this.bones[0]:null},findBone:function(t){for(var e=this.bones,i=0,n=e.length;n>i;i++)if(e[i].data.name==t)return e[i];return null},findBoneIndex:function(t){for(var e=this.bones,i=0,n=e.length;n>i;i++)if(e[i].data.name==t)return i;return-1},findSlot:function(t){for(var e=this.slots,i=0,n=e.length;n>i;i++)if(e[i].data.name==t)return e[i];return null},findSlotIndex:function(t){for(var e=this.slots,i=0,n=e.length;n>i;i++)if(e[i].data.name==t)return i;return-1},setSkinByName:function(t){var e=this.data.findSkin(t);if(!e)throw"Skin not found: "+t;this.setSkin(e)},setSkin:function(t){if(t)if(this.skin)t._attachAll(this,this.skin);else for(var e=this.slots,i=0,n=e.length;n>i;i++){var r=e[i],o=r.data.attachmentName;o&&(o=t.getAttachment(i,o))&&r.setAttachment(o)}this.skin=t},getAttachmentBySlotName:function(t,e){return this.getAttachmentBySlotIndex(this.data.findSlotIndex(t),e)},getAttachmentBySlotIndex:function(t,e){if(this.skin){var i=this.skin.getAttachment(t,e);if(i)return i}return this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null
},setAttachment:function(t,e){for(var i=this.slots,n=0,r=i.length;r>n;n++){var o=i[n];if(o.data.name==t){if(i=null,e&&(i=this.getAttachmentBySlotIndex(n,e),!i))throw"Attachment not found: "+e+", for slot: "+t;return void o.setAttachment(i)}}throw"Slot not found: "+t},findIkConstraint:function(t){for(var e=this.ikConstraints,i=0,n=e.length;n>i;i++)if(e[i].data.name==t)return e[i];return null},update:function(t){this.time+=t}},spine.EventData=function(t){this.name=t},spine.EventData.prototype={intValue:0,floatValue:0,stringValue:null},spine.Event=function(t){this.data=t},spine.Event.prototype={intValue:0,floatValue:0,stringValue:null},spine.AttachmentType={region:0,boundingbox:1,mesh:2,skinnedmesh:3},spine.RegionAttachment=function(t){this.name=t,this.offset=[],this.offset.length=8,this.uvs=[],this.uvs.length=8},spine.RegionAttachment.prototype={type:spine.AttachmentType.region,x:0,y:0,rotation:0,scaleX:1,scaleY:1,width:0,height:0,r:1,g:1,b:1,a:1,path:null,rendererObject:null,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,setUVs:function(t,e,i,n,r){var o=this.uvs;r?(o[2]=t,o[3]=n,o[4]=t,o[5]=e,o[6]=i,o[7]=e,o[0]=i,o[1]=n):(o[0]=t,o[1]=n,o[2]=t,o[3]=e,o[4]=i,o[5]=e,o[6]=i,o[7]=n)},updateOffset:function(){var t=this.width/this.regionOriginalWidth*this.scaleX,e=this.height/this.regionOriginalHeight*this.scaleY,i=-this.width/2*this.scaleX+this.regionOffsetX*t,n=-this.height/2*this.scaleY+this.regionOffsetY*e,r=i+this.regionWidth*t,t=n+this.regionHeight*e,e=this.rotation*spine.degRad,o=Math.cos(e),s=Math.sin(e),e=i*o+this.x,i=i*s,c=n*o+this.y,n=n*s,a=r*o+this.x,r=r*s,o=t*o+this.y,t=t*s,s=this.offset;s[0]=e-n,s[1]=c+i,s[2]=e-t,s[3]=o+i,s[4]=a-t,s[5]=o+r,s[6]=a-n,s[7]=c+r},computeVertices:function(t,e,i,n){t+=i.worldX,e+=i.worldY;var r=i.m00,o=i.m01,s=i.m10;i=i.m11;var c=this.offset;n[0]=c[0]*r+c[1]*o+t,n[1]=c[0]*s+c[1]*i+e,n[2]=c[2]*r+c[3]*o+t,n[3]=c[2]*s+c[3]*i+e,n[4]=c[4]*r+c[5]*o+t,n[5]=c[4]*s+c[5]*i+e,n[6]=c[6]*r+c[7]*o+t,n[7]=c[6]*s+c[7]*i+e}},spine.MeshAttachment=function(t){this.name=t},spine.MeshAttachment.prototype={type:spine.AttachmentType.mesh,vertices:null,uvs:null,regionUVs:null,triangles:null,hullLength:0,r:1,g:1,b:1,a:1,path:null,rendererObject:null,regionU:0,regionV:0,regionU2:0,regionV2:0,regionRotate:!1,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,edges:null,width:0,height:0,updateUVs:function(){var t=this.regionU2-this.regionU,e=this.regionV2-this.regionV,i=this.regionUVs.length;if(this.uvs&&this.uvs.length==i||(this.uvs=new spine.Float32Array(i)),this.regionRotate)for(var n=0;i>n;n+=2)this.uvs[n]=this.regionU+this.regionUVs[n+1]*t,this.uvs[n+1]=this.regionV+e-this.regionUVs[n]*e;else for(n=0;i>n;n+=2)this.uvs[n]=this.regionU+this.regionUVs[n]*t,this.uvs[n+1]=this.regionV+this.regionUVs[n+1]*e},computeWorldVertices:function(t,e,i,n){var r=i.bone;t+=r.worldX,e+=r.worldY;var o=r.m00,s=r.m01,c=r.m10,r=r.m11,a=this.vertices,l=a.length;for(i.attachmentVertices.length==l&&(a=i.attachmentVertices),i=0;l>i;i+=2){var h=a[i],u=a[i+1];n[i]=h*o+u*s+t,n[i+1]=h*c+u*r+e}}},spine.SkinnedMeshAttachment=function(t){this.name=t},spine.SkinnedMeshAttachment.prototype={type:spine.AttachmentType.skinnedmesh,bones:null,weights:null,uvs:null,regionUVs:null,triangles:null,hullLength:0,r:1,g:1,b:1,a:1,path:null,rendererObject:null,regionU:0,regionV:0,regionU2:0,regionV2:0,regionRotate:!1,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,edges:null,width:0,height:0,updateUVs:function(t,e,i,n){if(t=this.regionU2-this.regionU,e=this.regionV2-this.regionV,i=this.regionUVs.length,this.uvs&&this.uvs.length==i||(this.uvs=new spine.Float32Array(i)),this.regionRotate)for(n=0;i>n;n+=2)this.uvs[n]=this.regionU+this.regionUVs[n+1]*t,this.uvs[n+1]=this.regionV+e-this.regionUVs[n]*e;else for(n=0;i>n;n+=2)this.uvs[n]=this.regionU+this.regionUVs[n]*t,this.uvs[n+1]=this.regionV+this.regionUVs[n+1]*e},computeWorldVertices:function(t,e,i,n){var r,o,s,c,a,l,h=i.bone.skeleton.bones,u=this.weights,d=this.bones,_=0,p=0,f=0,m=0,g=d.length;if(i.attachmentVertices.length)for(var y=i.attachmentVertices;g>p;_+=2){for(o=r=0,i=d[p++]+p;i>p;p++,f+=3,m+=2)s=h[d[p]],c=u[f]+y[m],a=u[f+1]+y[m+1],l=u[f+2],r+=(c*s.m00+a*s.m01+s.worldX)*l,o+=(c*s.m10+a*s.m11+s.worldY)*l;n[_]=r+t,n[_+1]=o+e}else for(;g>p;_+=2){for(o=r=0,i=d[p++]+p;i>p;p++,f+=3)s=h[d[p]],c=u[f],a=u[f+1],l=u[f+2],r+=(c*s.m00+a*s.m01+s.worldX)*l,o+=(c*s.m10+a*s.m11+s.worldY)*l;n[_]=r+t,n[_+1]=o+e}}},spine.BoundingBoxAttachment=function(t){this.name=t,this.vertices=[]},spine.BoundingBoxAttachment.prototype={type:spine.AttachmentType.boundingbox,computeWorldVertices:function(t,e,i,n){t+=i.worldX,e+=i.worldY;var r=i.m00,o=i.m01,s=i.m10;i=i.m11;for(var c=this.vertices,a=0,l=c.length;l>a;a+=2){var h=c[a],u=c[a+1];n[a]=h*r+u*o+t,n[a+1]=h*s+u*i+e}}},spine.AnimationStateData=function(t){this.skeletonData=t,this.animationToMixTime={}},spine.AnimationStateData.prototype={defaultMix:0,setMixByName:function(t,e,i){var n=this.skeletonData.findAnimation(t);if(!n)throw"Animation not found: "+t;if(t=this.skeletonData.findAnimation(e),!t)throw"Animation not found: "+e;this.setMix(n,t,i)},setMix:function(t,e,i){this.animationToMixTime[t.name+":"+e.name]=i},getMix:function(t,e){var i=t.name+":"+e.name;return this.animationToMixTime.hasOwnProperty(i)?this.animationToMixTime[i]:this.defaultMix}},spine.TrackEntry=function(){},spine.TrackEntry.prototype={next:null,previous:null,animation:null,loop:!1,delay:0,time:0,lastTime:-1,endTime:0,timeScale:1,mixTime:0,mixDuration:0,mix:1,onStart:null,onEnd:null,onComplete:null,onEvent:null},spine.AnimationState=function(t){this.data=t,this.tracks=[],this.events=[]},spine.AnimationState.prototype={onStart:null,onEnd:null,onComplete:null,onEvent:null,timeScale:1,update:function(t){t*=this.timeScale;for(var e=0;e<this.tracks.length;e++){var i=this.tracks[e];if(i){if(i.time+=t*i.timeScale,i.previous){var n=t*i.previous.timeScale;i.previous.time+=n,i.mixTime+=n}(n=i.next)?(n.time=i.lastTime-n.delay,0<=n.time&&this.setCurrent(e,n)):!i.loop&&i.lastTime>=i.endTime&&this.clearTrack(e)}}},apply:function(t){for(var e=0;e<this.tracks.length;e++){var i=this.tracks[e];if(i){this.events.length=0;var n=i.time,r=i.lastTime,o=i.endTime,s=i.loop;!s&&n>o&&(n=o);var c=i.previous;if(c){var a=c.time;!c.loop&&a>c.endTime&&(a=c.endTime),c.animation.apply(t,a,a,c.loop,null),c=i.mixTime/i.mixDuration*i.mix,c>=1&&(c=1,i.previous=null),i.animation.mix(t,i.lastTime,n,s,this.events,c)}else 1==i.mix?i.animation.apply(t,i.lastTime,n,s,this.events):i.animation.mix(t,i.lastTime,n,s,this.events,i.mix);for(c=0,a=this.events.length;a>c;c++){var l=this.events[c];i.onEvent&&i.onEvent(e,l),this.onEvent&&this.onEvent(e,l)}(s?r%o>n%o:o>r&&n>=o)&&(n=Math.floor(n/o),i.onComplete&&i.onComplete(e,n),this.onComplete&&this.onComplete(e,n)),i.lastTime=i.time}}},clearTracks:function(){for(var t=0,e=this.tracks.length;e>t;t++)this.clearTrack(t);this.tracks.length=0},clearTrack:function(t){if(!(t>=this.tracks.length)){var e=this.tracks[t];e&&(e.onEnd&&e.onEnd(t),this.onEnd&&this.onEnd(t),this.tracks[t]=null)}},_expandToIndex:function(t){if(t<this.tracks.length)return this.tracks[t];for(;t>=this.tracks.length;)this.tracks.push(null);return null},setCurrent:function(t,e){var i=this._expandToIndex(t);if(i){var n=i.previous;i.previous=null,i.onEnd&&i.onEnd(t),this.onEnd&&this.onEnd(t),e.mixDuration=this.data.getMix(i.animation,e.animation),0<e.mixDuration&&(e.mixTime=0,e.previous=n&&.5>i.mixTime/i.mixDuration?n:i)}this.tracks[t]=e,e.onStart&&e.onStart(t),this.onStart&&this.onStart(t)},setAnimationByName:function(t,e,i){var n=this.data.skeletonData.findAnimation(e);if(!n)throw"Animation not found: "+e;return this.setAnimation(t,n,i)},setAnimation:function(t,e,i){var n=new spine.TrackEntry;return n.animation=e,n.loop=i,n.endTime=e.duration,this.setCurrent(t,n),n},addAnimationByName:function(t,e,i,n){var r=this.data.skeletonData.findAnimation(e);if(!r)throw"Animation not found: "+e;return this.addAnimation(t,r,i,n)},addAnimation:function(t,e,i,n){var r=new spine.TrackEntry;if(r.animation=e,r.loop=i,r.endTime=e.duration,i=this._expandToIndex(t)){for(;i.next;)i=i.next;i.next=r}else this.tracks[t]=r;return 0>=n&&(n=i?n+(i.endTime-this.data.getMix(i.animation,e)):0),r.delay=n,r},getCurrent:function(t){return t>=this.tracks.length?null:this.tracks[t]}},spine.SkeletonJson=function(t){this.attachmentLoader=t},spine.SkeletonJson.prototype={scale:1,readSkeletonData:function(t,e){var i=new spine.SkeletonData;i.name=e;var n=t.skeleton;n&&(i.hash=n.hash,i.version=n.spine,i.width=n.width||0,i.height=n.height||0);for(var r=t.bones,n=0,o=r.length;o>n;n++){var s=r[n],c=null;if(s.parent&&(c=i.findBone(s.parent),!c))throw"Parent bone not found: "+s.parent;c=new spine.BoneData(s.name,c),c.length=(s.length||0)*this.scale,c.x=(s.x||0)*this.scale,c.y=(s.y||0)*this.scale,c.rotation=s.rotation||0,c.scaleX=s.hasOwnProperty("scaleX")?s.scaleX:1,c.scaleY=s.hasOwnProperty("scaleY")?s.scaleY:1,c.inheritScale=s.hasOwnProperty("inheritScale")?s.inheritScale:!0,c.inheritRotation=s.hasOwnProperty("inheritRotation")?s.inheritRotation:!0,i.bones.push(c)}if(c=t.ik)for(n=0,o=c.length;o>n;n++){for(var s=c[n],a=new spine.IkConstraintData(s.name),r=s.bones,l=0,h=r.length;h>l;l++){var u=i.findBone(r[l]);if(!u)throw"IK bone not found: "+r[l];a.bones.push(u)}if(a.target=i.findBone(s.target),!a.target)throw"Target bone not found: "+s.target;a.bendDirection=!s.hasOwnProperty("bendPositive")||s.bendPositive?1:-1,a.mix=s.hasOwnProperty("mix")?s.mix:1,i.ikConstraints.push(a)}for(r=t.slots,n=0,o=r.length;o>n;n++){if(s=r[n],c=i.findBone(s.bone),!c)throw"Slot bone not found: "+s.bone;c=new spine.SlotData(s.name,c),(a=s.color)&&(c.r=this.toColor(a,0),c.g=this.toColor(a,1),c.b=this.toColor(a,2),c.a=this.toColor(a,3)),c.attachmentName=s.attachment,c.additiveBlending=s.additive&&"true"==s.additive,i.slots.push(c)}var d,n=t.skins;for(d in n)if(n.hasOwnProperty(d)){var _,o=n[d],r=new spine.Skin(d);for(_ in o)if(o.hasOwnProperty(_)){var p,c=i.findSlotIndex(_),s=o[_];for(p in s)s.hasOwnProperty(p)&&(a=this.readAttachment(r,p,s[p]))&&r.addAttachment(c,p,a)}i.skins.push(r),"default"==r.name&&(i.defaultSkin=r)}d=t.events;for(var f in d)d.hasOwnProperty(f)&&(_=d[f],p=new spine.EventData(f),p.intValue=_["int"]||0,p.floatValue=_["float"]||0,p.stringValue=_.string||null,i.events.push(p));f=t.animations;for(var m in f)f.hasOwnProperty(m)&&this.readAnimation(m,f[m],i);return i},readAttachment:function(t,e,i){e=i.name||e;var n=spine.AttachmentType[i.type||"region"],r=i.path||e,o=this.scale;if(n==spine.AttachmentType.region)return(t=this.attachmentLoader.newRegionAttachment(t,e,r))?(t.path=r,t.x=(i.x||0)*o,t.y=(i.y||0)*o,t.scaleX=i.hasOwnProperty("scaleX")?i.scaleX:1,t.scaleY=i.hasOwnProperty("scaleY")?i.scaleY:1,t.rotation=i.rotation||0,t.width=(i.width||0)*o,t.height=(i.height||0)*o,(r=i.color)&&(t.r=this.toColor(r,0),t.g=this.toColor(r,1),t.b=this.toColor(r,2),t.a=this.toColor(r,3)),t.updateOffset(),t):null;if(n==spine.AttachmentType.mesh)return(t=this.attachmentLoader.newMeshAttachment(t,e,r))?(t.path=r,t.vertices=this.getFloatArray(i,"vertices",o),t.triangles=this.getIntArray(i,"triangles"),t.regionUVs=this.getFloatArray(i,"uvs",1),t.updateUVs(),(r=i.color)&&(t.r=this.toColor(r,0),t.g=this.toColor(r,1),t.b=this.toColor(r,2),t.a=this.toColor(r,3)),t.hullLength=2*(i.hull||0),i.edges&&(t.edges=this.getIntArray(i,"edges")),t.width=(i.width||0)*o,t.height=(i.height||0)*o,t):null;if(n==spine.AttachmentType.skinnedmesh){if(t=this.attachmentLoader.newSkinnedMeshAttachment(t,e,r),!t)return null;t.path=r;var s=this.getFloatArray(i,"uvs",1),r=this.getFloatArray(i,"vertices",1),c=[],a=[];for(e=0,n=r.length;n>e;){var l=0|r[e++];for(a[a.length]=l,l=e+4*l;l>e;)a[a.length]=r[e],c[c.length]=r[e+1]*o,c[c.length]=r[e+2]*o,c[c.length]=r[e+3],e+=4}return t.bones=a,t.weights=c,t.triangles=this.getIntArray(i,"triangles"),t.regionUVs=s,t.updateUVs(),(r=i.color)&&(t.r=this.toColor(r,0),t.g=this.toColor(r,1),t.b=this.toColor(r,2),t.a=this.toColor(r,3)),t.hullLength=2*(i.hull||0),i.edges&&(t.edges=this.getIntArray(i,"edges")),t.width=(i.width||0)*o,t.height=(i.height||0)*o,t}if(n==spine.AttachmentType.boundingbox){for(t=this.attachmentLoader.newBoundingBoxAttachment(t,e),r=i.vertices,e=0,n=r.length;n>e;e++)t.vertices.push(r[e]*o);return t}throw"Unknown attachment type: "+n},readAnimation:function(t,e,i){var n,r=[],o=0,s=e.slots;for(n in s)if(s.hasOwnProperty(n)){var c,a=s[n],l=i.findSlotIndex(n);for(c in a)if(a.hasOwnProperty(c)){var h=a[c];if("color"==c){var u=new spine.ColorTimeline(h.length);u.slotIndex=l;for(var d=0,_=0,p=h.length;p>_;_++){var f=h[_],m=f.color,g=this.toColor(m,0),y=this.toColor(m,1),T=this.toColor(m,2),m=this.toColor(m,3);u.setFrame(d,f.time,g,y,T,m),this.readCurve(u,d,f),d++}r.push(u),o=Math.max(o,u.frames[5*u.getFrameCount()-5]||0)}else{if("attachment"!=c)throw"Invalid timeline type for a slot: "+c+" ("+n+")";for(u=new spine.AttachmentTimeline(h.length),u.slotIndex=l,_=d=0,p=h.length;p>_;_++)f=h[_],u.setFrame(d++,f.time,f.name);r.push(u),o=Math.max(o,u.frames[u.getFrameCount()-1]||0)}}}var S,l=e.bones;for(S in l)if(l.hasOwnProperty(S)){if(a=i.findBoneIndex(S),-1==a)throw"Bone not found: "+S;s=l[S];for(c in s)if(s.hasOwnProperty(c))if(h=s[c],"rotate"==c){for(u=new spine.RotateTimeline(h.length),u.boneIndex=a,_=d=0,p=h.length;p>_;_++)f=h[_],u.setFrame(d,f.time,f.angle),this.readCurve(u,d,f),d++;r.push(u),o=Math.max(o,u.frames[2*u.getFrameCount()-2]||0)}else if("translate"==c||"scale"==c){for(g=1,"scale"==c?u=new spine.ScaleTimeline(h.length):(u=new spine.TranslateTimeline(h.length),g=this.scale),u.boneIndex=a,_=d=0,p=h.length;p>_;_++)f=h[_],y=(f.x||0)*g,u.setFrame(d,f.time,y,(f.y||0)*g),this.readCurve(u,d,f),d++;r.push(u),o=Math.max(o,u.frames[3*u.getFrameCount()-3]||0)}else{if("flipX"!=c&&"flipY"!=c)throw"Invalid timeline type for a bone: "+c+" ("+S+")";for(u=(y="flipX"==c)?new spine.FlipXTimeline(h.length):new spine.FlipYTimeline(h.length),u.boneIndex=a,g=y?"x":"y",_=d=0,p=h.length;p>_;_++)f=h[_],u.setFrame(d,f.time,f[g]||!1),d++;r.push(u),o=Math.max(o,u.frames[2*u.getFrameCount()-2]||0)}}var C,l=e.ik;for(C in l)if(l.hasOwnProperty(C)){for(d=i.findIkConstraint(C),h=l[C],u=new spine.IkConstraintTimeline(h.length),u.ikConstraintIndex=i.ikConstraints.indexOf(d),_=d=0,p=h.length;p>_;_++)f=h[_],a=f.hasOwnProperty("mix")?f.mix:1,c=!f.hasOwnProperty("bendPositive")||f.bendPositive?1:-1,u.setFrame(d,f.time,a,c),this.readCurve(u,d,f),d++;r.push(u),o=Math.max(o,u.frames[3*u.frameCount-3]||0)}S=e.ffd;for(var v in S)for(n in s=i.findSkin(v),a=S[v]){var x,l=i.findSlotIndex(n),g=a[n];for(x in g){if(h=g[x],u=new spine.FfdTimeline(h.length),y=s.getAttachment(l,x),!y)throw"FFD attachment not found: "+x;for(u.slotIndex=l,u.attachment=y,m=(T=y.type==spine.AttachmentType.mesh)?y.vertices.length:y.weights.length/3*2,_=d=0,p=h.length;p>_;_++){var E,f=h[_];if(f.vertices){var b=f.vertices;E=[],E.length=m;var A=f.offset||0;if(C=b.length,1==this.scale)for(c=0;C>c;c++)E[c+A]=b[c];else for(c=0;C>c;c++)E[c+A]=b[c]*this.scale;if(T)for(b=y.vertices,c=0,C=E.length;C>c;c++)E[c]+=b[c]}else T?E=y.vertices:(E=[],E.length=m);u.setFrame(d,f.time,E),this.readCurve(u,d,f),d++}r[r.length]=u,o=Math.max(o,u.frames[u.frameCount-1]||0)}}if((n=e.drawOrder)||(n=e.draworder),n){for(u=new spine.DrawOrderTimeline(n.length),h=i.slots.length,_=d=0,p=n.length;p>_;_++){if(v=n[_],x=null,v.offsets){for(x=[],x.length=h,c=h-1;c>=0;c--)x[c]=-1;for(f=v.offsets,a=[],a.length=h-f.length,c=s=S=0,C=f.length;C>c;c++){if(g=f[c],l=i.findSlotIndex(g.slot),-1==l)throw"Slot not found: "+g.slot;for(;S!=l;)a[s++]=S++;x[S+g.offset]=S++}for(;h>S;)a[s++]=S++;for(c=h-1;c>=0;c--)-1==x[c]&&(x[c]=a[--s])}u.setFrame(d++,v.time,x)}r.push(u),o=Math.max(o,u.frames[u.getFrameCount()-1]||0)}if(e=e.events){for(u=new spine.EventTimeline(e.length),_=d=0,p=e.length;p>_;_++){if(n=e[_],h=i.findEvent(n.name),!h)throw"Event not found: "+n.name;v=new spine.Event(h),v.intValue=n.hasOwnProperty("int")?n["int"]:h.intValue,v.floatValue=n.hasOwnProperty("float")?n["float"]:h.floatValue,v.stringValue=n.hasOwnProperty("string")?n.string:h.stringValue,u.setFrame(d++,n.time,v)}r.push(u),o=Math.max(o,u.frames[u.getFrameCount()-1]||0)}i.animations.push(new spine.Animation(t,r,o))},readCurve:function(t,e,i){(i=i.curve)?"stepped"==i?t.curves.setStepped(e):i instanceof Array&&t.curves.setCurve(e,i[0],i[1],i[2],i[3]):t.curves.setLinear(e)},toColor:function(t,e){if(8!=t.length)throw"Color hexidecimal length must be 8, recieved: "+t;return parseInt(t.substring(2*e,2*e+2),16)/255},getFloatArray:function(t,e,i){t=t[e],e=new spine.Float32Array(t.length);var n=0,r=t.length;if(1==i)for(;r>n;n++)e[n]=t[n];else for(;r>n;n++)e[n]=t[n]*i;return e},getIntArray:function(t,e){for(var i=t[e],n=new spine.Uint16Array(i.length),r=0,o=i.length;o>r;r++)n[r]=0|i[r];return n}},spine.Atlas=function(t,e){this.textureLoader=e,this.pages=[],this.regions=[];var i=new spine.AtlasReader(t),n=[];n.length=4;for(var r=null;;){var o=i.readLine();if(null===o)break;if(o=i.trim(o),o.length)if(r){var s=new spine.AtlasRegion;s.name=o,s.page=r,s.rotate="true"==i.readValue(),i.readTuple(n);var o=parseInt(n[0]),c=parseInt(n[1]);i.readTuple(n);var a=parseInt(n[0]),l=parseInt(n[1]);s.u=o/r.width,s.v=c/r.height,s.rotate?(s.u2=(o+l)/r.width,s.v2=(c+a)/r.height):(s.u2=(o+a)/r.width,s.v2=(c+l)/r.height),s.x=o,s.y=c,s.width=Math.abs(a),s.height=Math.abs(l),4==i.readTuple(n)&&(s.splits=[parseInt(n[0]),parseInt(n[1]),parseInt(n[2]),parseInt(n[3])],4==i.readTuple(n)&&(s.pads=[parseInt(n[0]),parseInt(n[1]),parseInt(n[2]),parseInt(n[3])],i.readTuple(n))),s.originalWidth=parseInt(n[0]),s.originalHeight=parseInt(n[1]),i.readTuple(n),s.offsetX=parseInt(n[0]),s.offsetY=parseInt(n[1]),s.index=parseInt(i.readValue()),this.regions.push(s)}else r=new spine.AtlasPage,r.name=o,2==i.readTuple(n)&&(r.width=parseInt(n[0]),r.height=parseInt(n[1]),i.readTuple(n)),r.format=spine.Atlas.Format[n[0]],i.readTuple(n),r.minFilter=spine.Atlas.TextureFilter[n[0]],r.magFilter=spine.Atlas.TextureFilter[n[1]],s=i.readValue(),r.uWrap=spine.Atlas.TextureWrap.clampToEdge,r.vWrap=spine.Atlas.TextureWrap.clampToEdge,"x"==s?r.uWrap=spine.Atlas.TextureWrap.repeat:"y"==s?r.vWrap=spine.Atlas.TextureWrap.repeat:"xy"==s&&(r.uWrap=r.vWrap=spine.Atlas.TextureWrap.repeat),e.load(r,o,this),this.pages.push(r);else r=null}},spine.Atlas.prototype={findRegion:function(t){for(var e=this.regions,i=0,n=e.length;n>i;i++)if(e[i].name==t)return e[i];return null},dispose:function(){for(var t=this.pages,e=0,i=t.length;i>e;e++)this.textureLoader.unload(t[e].rendererObject)},updateUVs:function(t){for(var e=this.regions,i=0,n=e.length;n>i;i++){var r=e[i];r.page==t&&(r.u=r.x/t.width,r.v=r.y/t.height,r.rotate?(r.u2=(r.x+r.height)/t.width,r.v2=(r.y+r.width)/t.height):(r.u2=(r.x+r.width)/t.width,r.v2=(r.y+r.height)/t.height))}}},spine.Atlas.Format={alpha:0,intensity:1,luminanceAlpha:2,rgb565:3,rgba4444:4,rgb888:5,rgba8888:6},spine.Atlas.TextureFilter={nearest:0,linear:1,mipMap:2,mipMapNearestNearest:3,mipMapLinearNearest:4,mipMapNearestLinear:5,mipMapLinearLinear:6},spine.Atlas.TextureWrap={mirroredRepeat:0,clampToEdge:1,repeat:2},spine.AtlasPage=function(){},spine.AtlasPage.prototype={name:null,format:null,minFilter:null,magFilter:null,uWrap:null,vWrap:null,rendererObject:null,width:0,height:0},spine.AtlasRegion=function(){},spine.AtlasRegion.prototype={page:null,name:null,x:0,y:0,width:0,height:0,u:0,v:0,u2:0,v2:0,offsetX:0,offsetY:0,originalWidth:0,originalHeight:0,index:0,rotate:!1,splits:null,pads:null},spine.AtlasReader=function(t){this.lines=t.split(/\r\n|\r|\n/)},spine.AtlasReader.prototype={index:0,trim:function(t){return t.replace(/^\s+|\s+$/g,"")},readLine:function(){return this.index>=this.lines.length?null:this.lines[this.index++]},readValue:function(){var t=this.readLine(),e=t.indexOf(":");if(-1==e)throw"Invalid line: "+t;return this.trim(t.substring(e+1))},readTuple:function(t){var e=this.readLine(),i=e.indexOf(":");if(-1==i)throw"Invalid line: "+e;for(var n=0,i=i+1;3>n;n++){var r=e.indexOf(",",i);if(-1==r)break;t[n]=this.trim(e.substr(i,r-i)),i=r+1}return t[n]=this.trim(e.substring(i)),n+1}},spine.AtlasAttachmentLoader=function(t){this.atlas=t},spine.AtlasAttachmentLoader.prototype={newRegionAttachment:function(t,e,i){if(t=this.atlas.findRegion(i),!t)throw"Region not found in atlas: "+i+" (region attachment: "+e+")";return e=new spine.RegionAttachment(e),e.rendererObject=t,e.setUVs(t.u,t.v,t.u2,t.v2,t.rotate),e.regionOffsetX=t.offsetX,e.regionOffsetY=t.offsetY,e.regionWidth=t.width,e.regionHeight=t.height,e.regionOriginalWidth=t.originalWidth,e.regionOriginalHeight=t.originalHeight,e},newMeshAttachment:function(t,e,i){if(t=this.atlas.findRegion(i),!t)throw"Region not found in atlas: "+i+" (mesh attachment: "+e+")";return e=new spine.MeshAttachment(e),e.rendererObject=t,e.regionU=t.u,e.regionV=t.v,e.regionU2=t.u2,e.regionV2=t.v2,e.regionRotate=t.rotate,e.regionOffsetX=t.offsetX,e.regionOffsetY=t.offsetY,e.regionWidth=t.width,e.regionHeight=t.height,e.regionOriginalWidth=t.originalWidth,e.regionOriginalHeight=t.originalHeight,e},newSkinnedMeshAttachment:function(t,e,i){if(t=this.atlas.findRegion(i),!t)throw"Region not found in atlas: "+i+" (skinned mesh attachment: "+e+")";return e=new spine.SkinnedMeshAttachment(e),e.rendererObject=t,e.regionU=t.u,e.regionV=t.v,e.regionU2=t.u2,e.regionV2=t.v2,e.regionRotate=t.rotate,e.regionOffsetX=t.offsetX,e.regionOffsetY=t.offsetY,e.regionWidth=t.width,e.regionHeight=t.height,e.regionOriginalWidth=t.originalWidth,e.regionOriginalHeight=t.originalHeight,e},newBoundingBoxAttachment:function(t,e){return new spine.BoundingBoxAttachment(e)}},spine.SkeletonBounds=function(){this.polygonPool=[],this.polygons=[],this.boundingBoxes=[]},spine.SkeletonBounds.prototype={minX:0,minY:0,maxX:0,maxY:0,update:function(t,e){for(var i=t.slots,n=i.length,r=t.x,o=t.y,s=this.boundingBoxes,c=this.polygonPool,a=this.polygons,l=s.length=0,h=a.length;h>l;l++)c.push(a[l]);for(l=a.length=0;n>l;l++){var h=i[l],u=h.attachment;if(u.type==spine.AttachmentType.boundingbox){s.push(u);var d,_=c.length;_>0?(d=c[_-1],c.splice(_-1,1)):d=[],a.push(d),d.length=u.vertices.length,u.computeWorldVertices(r,o,h.bone,d)}}e&&this.aabbCompute()},aabbCompute:function(){for(var t=this.polygons,e=Number.MAX_VALUE,i=Number.MAX_VALUE,n=Number.MIN_VALUE,r=Number.MIN_VALUE,o=0,s=t.length;s>o;o++)for(var c=t[o],a=0,l=c.length;l>a;a+=2)var h=c[a],u=c[a+1],e=Math.min(e,h),i=Math.min(i,u),n=Math.max(n,h),r=Math.max(r,u);this.minX=e,this.minY=i,this.maxX=n,this.maxY=r},aabbContainsPoint:function(t,e){return t>=this.minX&&t<=this.maxX&&e>=this.minY&&e<=this.maxY},aabbIntersectsSegment:function(t,e,i,n){var r=this.minX,o=this.minY,s=this.maxX,c=this.maxY;return r>=t&&r>=i||o>=e&&o>=n||t>=s&&i>=s||e>=c&&n>=c?!1:(i=(n-e)/(i-t),n=i*(r-t)+e,n>o&&c>n?!0:(n=i*(s-t)+e,n>o&&c>n?!0:(o=(o-e)/i+t,o>r&&s>o?!0:(o=(c-e)/i+t,o>r&&s>o?!0:!1))))},aabbIntersectsSkeleton:function(t){return this.minX<t.maxX&&this.maxX>t.minX&&this.minY<t.maxY&&this.maxY>t.minY},containsPoint:function(t,e){for(var i=this.polygons,n=0,r=i.length;r>n;n++)if(this.polygonContainsPoint(i[n],t,e))return this.boundingBoxes[n];return null},intersectsSegment:function(t,e,i,n){for(var r=this.polygons,o=0,s=r.length;s>o;o++)if(r[o].intersectsSegment(t,e,i,n))return this.boundingBoxes[o];return null},polygonContainsPoint:function(t,e,i){for(var n=t.length,r=n-2,o=!1,s=0;n>s;s+=2){var c=t[s+1],a=t[r+1];if(i>c&&a>=i||i>a&&c>=i){var l=t[s];l+(i-c)/(a-c)*(t[r]-l)<e&&(o=!o)}r=s}return o},polygonIntersectsSegment:function(t,e,i,n,r){for(var o=t.length,s=e-n,c=i-r,a=e*r-i*n,l=t[o-2],h=t[o-1],u=0;o>u;u+=2){var d=t[u],_=t[u+1],p=l*_-h*d,f=l-d,m=h-_,g=s*m-c*f,f=(a*f-s*p)/g;if((f>=l&&d>=f||f>=d&&l>=f)&&(f>=e&&n>=f||f>=n&&e>=f)&&(l=(a*m-c*p)/g,(l>=h&&_>=l||l>=_&&h>=l)&&(l>=i&&r>=l||l>=r&&i>=l)))return!0;l=d,h=_}return!1},getPolygon:function(t){return t=this.boundingBoxes.indexOf(t),-1==t?null:this.polygons[t]},getWidth:function(){return this.maxX-this.minX},getHeight:function(){return this.maxY-this.minY}};var sp=sp||{};sp.VERTEX_INDEX={X1:0,Y1:1,X2:2,Y2:3,X3:4,Y3:5,X4:6,Y4:7},sp.ATTACHMENT_TYPE={REGION:0,BOUNDING_BOX:1,MESH:2,SKINNED_MESH:3},sp.Skeleton=cc.Node.extend({_skeleton:null,_rootBone:null,_timeScale:1,_debugSlots:!1,_debugBones:!1,_premultipliedAlpha:!1,_ownsSkeletonData:null,_atlas:null,_blendFunc:null,ctor:function(t,e,i){cc.Node.prototype.ctor.call(this),this._blendFunc={src:cc.BLEND_SRC,dst:cc.BLEND_DST},0===arguments.length?this.init():this.initWithArgs(t,e,i)},_createRenderCmd:function(){return cc._renderType===cc._RENDER_TYPE_CANVAS?new sp.Skeleton.CanvasRenderCmd(this):new sp.Skeleton.WebGLRenderCmd(this)},init:function(){cc.Node.prototype.init.call(this),this._blendFunc.src=cc.ONE,this._blendFunc.dst=cc.ONE_MINUS_SRC_ALPHA,this.scheduleUpdate()},setDebugSolots:function(t){this._debugSlots=t},setDebugBones:function(t){this._debugBones=t},setDebugSlotsEnabled:function(t){this._debugSlots=t},getDebugSlotsEnabled:function(){return this._debugSlots},setDebugBonesEnabled:function(t){this._debugBones=t},getDebugBonesEnabled:function(){return this._debugBones},setTimeScale:function(t){this._timeScale=t},getTimeScale:function(){return this._timeScale},initWithArgs:function(t,e,i){if(cc.isString(t)){if(cc.isString(e)){var n=cc.loader.getRes(e);sp._atlasLoader.setAtlasFile(e),e=new spine.Atlas(n,sp._atlasLoader)}i=i||1/cc.director.getContentScaleFactor(),n=new spine.AtlasAttachmentLoader(e),n=new spine.SkeletonJson(n),n.scale=i,t=cc.loader.getRes(t),t=n.readSkeletonData(t),e.dispose(n),i=!0}else i=e;this.setSkeletonData(t,i),this.init()},getBoundingBox:function(){for(var t=cc.FLT_MAX,e=cc.FLT_MAX,i=cc.FLT_MIN,n=cc.FLT_MIN,r=this.getScaleX(),o=this.getScaleY(),s=[],c=this._skeleton.slots,a=sp.VERTEX_INDEX,l=0,h=c.length;h>l;++l){var u=c[l];u.attachment&&u.attachment.type==sp.ATTACHMENT_TYPE.REGION&&(this._computeRegionAttachmentWorldVertices(u.attachment,u.bone.skeleton.x,u.bone.skeleton.y,u.bone,s),t=Math.min(t,s[a.X1]*r,s[a.X4]*r,s[a.X2]*r,s[a.X3]*r),e=Math.min(e,s[a.Y1]*o,s[a.Y4]*o,s[a.Y2]*o,s[a.Y3]*o),i=Math.max(i,s[a.X1]*r,s[a.X4]*r,s[a.X2]*r,s[a.X3]*r),n=Math.max(n,s[a.Y1]*o,s[a.Y4]*o,s[a.Y2]*o,s[a.Y3]*o))}return r=this.getPosition(),cc.rect(r.x+t,r.y+e,i-t,n-e)},_computeRegionAttachmentWorldVertices:function(t,e,i,n,r){t=t.offset;var o=sp.VERTEX_INDEX;e+=n.worldX,i+=n.worldY,r[o.X1]=t[o.X1]*n.m00+t[o.Y1]*n.m01+e,r[o.Y1]=t[o.X1]*n.m10+t[o.Y1]*n.m11+i,r[o.X2]=t[o.X2]*n.m00+t[o.Y2]*n.m01+e,r[o.Y2]=t[o.X2]*n.m10+t[o.Y2]*n.m11+i,r[o.X3]=t[o.X3]*n.m00+t[o.Y3]*n.m01+e,r[o.Y3]=t[o.X3]*n.m10+t[o.Y3]*n.m11+i,r[o.X4]=t[o.X4]*n.m00+t[o.Y4]*n.m01+e,r[o.Y4]=t[o.X4]*n.m10+t[o.Y4]*n.m11+i},updateWorldTransform:function(){this._skeleton.updateWorldTransform()},setToSetupPose:function(){this._skeleton.setToSetupPose()},setBonesToSetupPose:function(){this._skeleton.setBonesToSetupPose()},setSlotsToSetupPose:function(){this._skeleton.setSlotsToSetupPose()},findBone:function(t){return this._skeleton.findBone(t)},findSlot:function(t){return this._skeleton.findSlot(t)},setSkin:function(t){return this._skeleton.setSkinByName(t)},getAttachment:function(t,e){return this._skeleton.getAttachmentBySlotName(t,e)},setAttachment:function(t,e){this._skeleton.setAttachment(t,e)},setOpacityModifyRGB:function(t){this._premultipliedAlpha=t},isOpacityModifyRGB:function(){return this._premultipliedAlpha},setSkeletonData:function(t,e){null!=t.width&&null!=t.height&&this.setContentSize(t.width/cc.director.getContentScaleFactor(),t.height/cc.director.getContentScaleFactor()),this._skeleton=new spine.Skeleton(t),this._skeleton.updateWorldTransform(),this._rootBone=this._skeleton.getRootBone(),this._ownsSkeletonData=e,this._renderCmd._createChildFormSkeletonData()},getTextureAtlas:function(t){return t.rendererObject.page.rendererObject},getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(t,e){var i=this._blendFunc;void 0===e?(i.src=t.src,i.dst=t.dst):(i.src=t,i.dst=e)},update:function(t){this._skeleton.update(t)}}),sp.Skeleton.create=function(t,e,i){return new sp.Skeleton(t,e,i)},sp._atlasPage_createTexture_webGL=function(t,e){var i=cc.textureCache.addImage(e);t.rendererObject=new cc.TextureAtlas(i,128),t.width=i.getPixelsWide(),t.height=i.getPixelsHigh()},sp._atlasPage_createTexture_canvas=function(t,e){t._texture=cc.textureCache.addImage(e)},sp._atlasPage_disposeTexture=function(t){t.rendererObject.release()},sp._atlasLoader={spAtlasFile:null,setAtlasFile:function(t){this.spAtlasFile=t},load:function(t,e){e=cc.path.join(cc.path.dirname(this.spAtlasFile),e),cc._renderType===cc._RENDER_TYPE_WEBGL?sp._atlasPage_createTexture_webGL(t,e):sp._atlasPage_createTexture_canvas(t,e)},unload:function(){}},sp.ANIMATION_EVENT_TYPE={START:0,END:1,COMPLETE:2,EVENT:3},sp.TrackEntryListeners=function(t,e,i,n){this.startListener=t||null,this.endListener=e||null,this.completeListener=i||null,this.eventListener=n||null},sp.TrackEntryListeners.getListeners=function(t){return t.rendererObject||(t.rendererObject=new sp.TrackEntryListeners,t.listener=sp.trackEntryCallback),t.rendererObject},sp.trackEntryCallback=function(t,e,i,n,r){t.rendererObject.onTrackEntryEvent(e,i,n,r)},sp.SkeletonAnimation=sp.Skeleton.extend({_state:null,_target:null,_callback:null,_ownsAnimationStateData:!1,_startListener:null,_endListener:null,_completeListener:null,_eventListener:null,init:function(){sp.Skeleton.prototype.init.call(this),this._ownsAnimationStateData=!0,this.setAnimationStateData(new spine.AnimationStateData(this._skeleton.data))},setAnimationStateData:function(t){t=new spine.AnimationState(t),t.rendererObject=this,t.onStart=this._onAnimationStateStart.bind(this),t.onComplete=this._onAnimationStateComplete.bind(this),t.onEnd=this._onAnimationStateEnd.bind(this),t.onEvent=this._onAnimationStateEvent.bind(this),this._state=t},setMix:function(t,e,i){this._state.data.setMixByName(t,e,i)},setAnimationListener:function(t,e){this._target=t,this._callback=e},setAnimation:function(t,e,i){var n=this._skeleton.data.findAnimation(e);return n?this._state.setAnimation(t,n,i):(cc.log("Spine: Animation not found: "+e),null)},addAnimation:function(t,e,i,n){n=null==n?0:n;var r=this._skeleton.data.findAnimation(e);return r?this._state.addAnimation(t,r,i,n):(cc.log("Spine: Animation not found:"+e),null)},getCurrent:function(t){return this._state.getCurrent(t)},clearTracks:function(){this._state.clearTracks()},clearTrack:function(t){this._state.clearTrack(t)},update:function(t){this._super(t),t*=this._timeScale,this._state.update(t),this._state.apply(this._skeleton),this._skeleton.updateWorldTransform(),this._renderCmd._updateChild()},setStartListener:function(t){this._startListener=t},setEndListener:function(t){this._endListener=t},setCompleteListener:function(t){this._completeListener=t},setEventListener:function(t){this._eventListener=t},setTrackStartListener:function(t,e){sp.TrackEntryListeners.getListeners(t).startListener=e},setTrackEndListener:function(t,e){sp.TrackEntryListeners.getListeners(t).endListener=e},setTrackCompleteListener:function(t,e){sp.TrackEntryListeners.getListeners(t).completeListener=e},setTrackEventListener:function(t,e){sp.TrackEntryListeners.getListeners(t).eventListener=e},onTrackEntryEvent:function(t,e,i,n){var r=this._state.getCurrent(t);if(r.rendererObject)switch(r=r.rendererObject,e){case sp.ANIMATION_EVENT_TYPE.START:r.startListener&&r.startListener(t);break;case sp.ANIMATION_EVENT_TYPE.END:r.endListener&&r.endListener(t);break;case sp.ANIMATION_EVENT_TYPE.COMPLETE:r.completeListener&&r.completeListener(t,n);break;case sp.ANIMATION_EVENT_TYPE.EVENT:r.eventListener&&r.eventListener(t,i)}},onAnimationStateEvent:function(t,e,i,n){switch(e){case sp.ANIMATION_EVENT_TYPE.START:this._startListener&&this._startListener(t);break;case sp.ANIMATION_EVENT_TYPE.END:this._endListener&&this._endListener(t);break;case sp.ANIMATION_EVENT_TYPE.COMPLETE:this._completeListener&&this._completeListener(t,n);
break;case sp.ANIMATION_EVENT_TYPE.EVENT:this._eventListener&&this._eventListener(t,i)}},getState:function(){return this._state},_onAnimationStateStart:function(t){this._animationStateCallback(t,sp.ANIMATION_EVENT_TYPE.START,null,0)},_onAnimationStateEnd:function(t){this._animationStateCallback(t,sp.ANIMATION_EVENT_TYPE.END,null,0)},_onAnimationStateComplete:function(t,e){this._animationStateCallback(t,sp.ANIMATION_EVENT_TYPE.COMPLETE,null,e)},_onAnimationStateEvent:function(t,e){this._animationStateCallback(t,sp.ANIMATION_EVENT_TYPE.EVENT,e,0)},_animationStateCallback:function(t,e,i,n){this.onAnimationStateEvent(t,e,i,n),this._target&&this._callback&&this._callback.call(this._target,this,t,e,i,n)}}),sp.SkeletonAnimation.create=function(t,e,i){return new sp.SkeletonAnimation(t,e,i)},function(){sp.Skeleton.CanvasRenderCmd=function(t){cc.Node.CanvasRenderCmd.call(this,t),this._needDraw=!0};var t=sp.Skeleton.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);t.constructor=sp.Skeleton.CanvasRenderCmd,t.rendering=function(t,e,i){var n,r,o,s,c=this._node;t=t||cc._renderContext;var a=c._skeleton,l=a.drawOrder;for(n=0,r=l.length;r>n;n++)o=l[n],s=o._slotNode,s._visible&&s._renderCmd&&o.currentSprite&&(s._renderCmd.transform(this,!0),o.currentSprite._renderCmd.rendering(t,e,i),s._renderCmd._dirtyFlag=o.currentSprite._renderCmd._dirtyFlag=0);if(c._debugSlots||c._debugBones){if(t.setTransform(this._worldTransform,e,i),t.setGlobalAlpha(1),t=cc._drawingUtil,c._debugSlots)for(t.setDrawColor(0,0,255,255),t.setLineWidth(1),i=[],n=0,r=a.slots.length;r>n;n++)o=a.drawOrder[n],o.attachment&&o.attachment.type==sp.ATTACHMENT_TYPE.REGION&&(e=o.attachment,this._updateRegionAttachmentSlot(e,o,i),t.drawPoly(i,4,!0));if(c._debugBones){for(t.setLineWidth(2),t.setDrawColor(255,0,0,255),n=0,r=a.bones.length;r>n;n++)c=a.bones[n],t.drawLine({x:c.worldX,y:c.worldY},{x:c.data.length*c.m00+c.worldX,y:c.data.length*c.m10+c.worldY});for(t.setPointSize(4),t.setDrawColor(0,0,255,255),n=0,r=a.bones.length;r>n;n++)c=a.bones[n],t.drawPoint({x:c.worldX,y:c.worldY}),0===n&&t.setDrawColor(0,255,0,255)}}},t._updateRegionAttachmentSlot=function(t,e,i){if(i){var n={},r=sp.VERTEX_INDEX;e=e.bone,t.computeVertices(e.skeleton.x,e.skeleton.y,e,n),i.length=0,i.push(cc.p(n[r.X1],n[r.Y1])),i.push(cc.p(n[r.X4],n[r.Y4])),i.push(cc.p(n[r.X3],n[r.Y3])),i.push(cc.p(n[r.X2],n[r.Y2]))}},t._createChildFormSkeletonData=function(){for(var t,e,i=this._node._skeleton,n=0,r=i.slots.length;r>n;n++){var o=i.slots[n];e=o.attachment;var s=new cc.Node;o._slotNode=s,e instanceof spine.RegionAttachment&&(t=e.rendererObject.name,e=this._createSprite(o,e),o.currentSprite=e,o.currentSpriteName=t,s.addChild(e))}},t._createSprite=function(t,e){var i=e.rendererObject,n=new cc.Rect(i.x,i.y,i.width,i.height),r=new cc.Sprite;return r.initWithTexture(i.page._texture,n,i.rotate,!1),r._rect.width=e.width,r._rect.height=e.height,r.setContentSize(e.width,e.height),r.setRotation(-e.rotation),r.setScale(i.width/i.originalWidth*e.scaleX,i.height/i.originalHeight*e.scaleY),t.sprites=t.sprites||{},t.sprites[i.name]=r},t._updateChild=function(){var t,e,i,n,r,o,s=this._node._skeleton,c=s.slots;for(t=0,e=c.length;e>t;t++)if(n=c[t],r=n.attachment,o=n._slotNode,r){if(i=r.type,i===spine.AttachmentType.region){if(r.rendererObject&&(!n.currentSpriteName||n.currentSpriteName!==r.name)){if(i=r.rendererObject.name,void 0!==n.currentSprite&&n.currentSprite.setVisible(!1),n.sprites=n.sprites||{},void 0!==n.sprites[i])n.sprites[i].setVisible(!0);else{var a=this._createSprite(n,r);o.addChild(a)}n.currentSprite=n.sprites[i],n.currentSpriteName=i}a=n.bone,o.setPosition(a.worldX+r.x*a.m00+r.y*a.m01,a.worldY+r.x*a.m10+r.y*a.m11),o.setScale(a.worldScaleX,a.worldScaleY),i=n.currentSprite,i._flippedX=a.worldFlipX,i._flippedY=a.worldFlipY,i._flippedY||i._flippedX?(o.setRotation(a.worldRotation),i.setRotation(r.rotation)):(o.setRotation(-a.worldRotation),i.setRotation(-r.rotation)),i._renderCmd._displayedOpacity=0|s.a*n.a*255,i.setColor(cc.color(0|s.r*n.r*255,0|s.g*n.g*255,0|s.b*n.b*255)),i._renderCmd._updateColor()}else if(i!==spine.AttachmentType.skinnedmesh){o.setVisible(!1);continue}o.setVisible(!0)}else o.setVisible(!1)}}(),function(){sp.Skeleton.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0,this.setShaderProgram(cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURECOLOR)),this._tmpQuad=new cc.V3F_C4B_T2F_Quad};var t=sp.Skeleton.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);t.constructor=sp.Skeleton.WebGLRenderCmd,t.rendering=function(t){var e=this._node,i=this._tmpQuad;this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix);var n=e.getColor();t=e._skeleton,t.r=n.r/255,t.g=n.g/255,t.b=n.b/255,t.a=e.getOpacity()/255,e._premultipliedAlpha&&(t.r*=t.a,t.g*=t.a,t.b*=t.a);var r,o,s,c,a,l=e._blendFunc,n=0;for(a=t.drawOrder.length;a>n;n++)if(c=t.drawOrder[n],c.attachment){switch(s=c.attachment,c.attachment.type){case sp.ATTACHMENT_TYPE.REGION:this._updateRegionAttachmentQuad(s,c,i,e._premultipliedAlpha);break;case sp.ATTACHMENT_TYPE.MESH:this._updateMeshAttachmentQuad(s,c,i,e._premultipliedAlpha);break;case sp.ATTACHMENT_TYPE.SKINNED_MESH:break;default:continue}if(s=e.getTextureAtlas(s),c.data.additiveBlending!=r?(o&&(o.drawQuads(),o.removeAllQuads()),r=!r,cc.glBlendFunc(l.src,r?cc.ONE:l.dst)):s!=o&&o&&(o.drawQuads(),o.removeAllQuads()),o=s,c=o.getTotalQuads(),o.getCapacity()==c&&(o.drawQuads(),o.removeAllQuads(),!o.resizeCapacity(2*o.getCapacity())))return;o.updateQuad(i,c)}if(o&&(o.drawQuads(),o.removeAllQuads()),e._debugBones||e._debugSlots){if(cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW),cc.current_stack.stack.push(cc.current_stack.top),cc.current_stack.top=this._stackMatrix,r=cc._drawingUtil,e._debugSlots)for(r.setDrawColor(0,0,255,255),r.setLineWidth(1),n=0,a=t.slots.length;a>n;n++)c=t.drawOrder[n],c.attachment&&c.attachment.type==sp.ATTACHMENT_TYPE.REGION&&(s=c.attachment,this._updateRegionAttachmentQuad(s,c,i),o=[],o.push(cc.p(i.bl.vertices.x,i.bl.vertices.y)),o.push(cc.p(i.br.vertices.x,i.br.vertices.y)),o.push(cc.p(i.tr.vertices.x,i.tr.vertices.y)),o.push(cc.p(i.tl.vertices.x,i.tl.vertices.y)),r.drawPoly(o,4,!0));if(e._debugBones){for(r.setLineWidth(2),r.setDrawColor(255,0,0,255),n=0,a=t.bones.length;a>n;n++)e=t.bones[n],i=e.data.length*e.m00+e.worldX,o=e.data.length*e.m10+e.worldY,r.drawLine(cc.p(e.worldX,e.worldY),cc.p(i,o));for(r.setPointSize(4),r.setDrawColor(0,0,255,255),n=0,a=t.bones.length;a>n;n++)e=t.bones[n],r.drawPoint(cc.p(e.worldX,e.worldY)),0==n&&r.setDrawColor(0,255,0,255)}cc.kmGLPopMatrix()}},t._createChildFormSkeletonData=function(){},t._updateChild=function(){},t._updateRegionAttachmentQuad=function(t,e,i,n){var r={};t.computeVertices(e.bone.skeleton.x,e.bone.skeleton.y,e.bone,r);var o=e.bone.skeleton.r*e.r*255,s=e.bone.skeleton.g*e.g*255,c=e.bone.skeleton.b*e.b*255;e=e.bone.skeleton.a*e.a,n&&(o*=e,s*=e,c*=e),i.bl.colors.r=i.tl.colors.r=i.tr.colors.r=i.br.colors.r=o,i.bl.colors.g=i.tl.colors.g=i.tr.colors.g=i.br.colors.g=s,i.bl.colors.b=i.tl.colors.b=i.tr.colors.b=i.br.colors.b=c,i.bl.colors.a=i.tl.colors.a=i.tr.colors.a=i.br.colors.a=255*e,n=sp.VERTEX_INDEX,i.bl.vertices.x=r[n.X1],i.bl.vertices.y=r[n.Y1],i.tl.vertices.x=r[n.X2],i.tl.vertices.y=r[n.Y2],i.tr.vertices.x=r[n.X3],i.tr.vertices.y=r[n.Y3],i.br.vertices.x=r[n.X4],i.br.vertices.y=r[n.Y4],i.bl.texCoords.u=t.uvs[n.X1],i.bl.texCoords.v=t.uvs[n.Y1],i.tl.texCoords.u=t.uvs[n.X2],i.tl.texCoords.v=t.uvs[n.Y2],i.tr.texCoords.u=t.uvs[n.X3],i.tr.texCoords.v=t.uvs[n.Y3],i.br.texCoords.u=t.uvs[n.X4],i.br.texCoords.v=t.uvs[n.Y4]},t._updateMeshAttachmentQuad=function(t,e,i,n){var r={};t.computeWorldVertices(e.bone.x,e.bone.y,e,r);var o=e.bone.skeleton.r*e.r*255,s=e.bone.skeleton.g*e.g*255,c=e.bone.skeleton.b*e.b*255;e=e.bone.skeleton.a*e.a,n&&(o*=e,s*=e,c*=e),i.bl.colors.r=i.tl.colors.r=i.tr.colors.r=i.br.colors.r=o,i.bl.colors.g=i.tl.colors.g=i.tr.colors.g=i.br.colors.g=s,i.bl.colors.b=i.tl.colors.b=i.tr.colors.b=i.br.colors.b=c,i.bl.colors.a=i.tl.colors.a=i.tr.colors.a=i.br.colors.a=255*e,n=sp.VERTEX_INDEX,i.bl.vertices.x=r[n.X1],i.bl.vertices.y=r[n.Y1],i.tl.vertices.x=r[n.X2],i.tl.vertices.y=r[n.Y2],i.tr.vertices.x=r[n.X3],i.tr.vertices.y=r[n.Y3],i.br.vertices.x=r[n.X4],i.br.vertices.y=r[n.Y4],i.bl.texCoords.u=t.uvs[n.X1],i.bl.texCoords.v=t.uvs[n.Y1],i.tl.texCoords.u=t.uvs[n.X2],i.tl.texCoords.v=t.uvs[n.Y2],i.tr.texCoords.u=t.uvs[n.X3],i.tr.texCoords.v=t.uvs[n.Y3],i.br.texCoords.u=t.uvs[n.X4],i.br.texCoords.v=t.uvs[n.Y4]}}(),cc.pool={_pool:{},_releaseCB:function(){this.release()},_autoRelease:function(t){var e=void 0===t._running?!1:!t._running;cc.director.getScheduler().schedule(this._releaseCB,t,0,0,0,e)},putInPool:function(t){var e=t.constructor.prototype.__pid;if(!e){var i={writable:!0,enumerable:!1,configurable:!0};i.value=ClassManager.getNewID(),Object.defineProperty(t.constructor.prototype,"__pid",i)}this._pool[e]||(this._pool[e]=[]),t.retain&&t.retain(),t.unuse&&t.unuse(),this._pool[e].push(t)},hasObject:function(t){return(t=this._pool[t.prototype.__pid])&&0!==t.length?!0:!1},removeObject:function(t){var e=t.constructor.prototype.__pid;if(e&&(e=this._pool[e]))for(var i=0;i<e.length;i++)t===e[i]&&(t.release&&t.release(),e.splice(i,1))},getFromPool:function(t){if(this.hasObject(t)){var e=this._pool[t.prototype.__pid],i=Array.prototype.slice.call(arguments);return i.shift(),e=e.pop(),e.reuse&&e.reuse.apply(e,i),cc.sys.isNative&&e.release&&this._autoRelease(e),e}},drainAllPools:function(){for(var t in this._pool)for(var e=0;e<this._pool[t].length;e++){var i=this._pool[t][e];i.release&&i.release()}this._pool={}}},function(t,e){function i(t){var e=he[t]={};return q.each(t.split(Q),function(t,i){e[i]=!0}),e}function n(t,i,n){if(n===e&&1===t.nodeType)if(n="data-"+i.replace(de,"-$1").toLowerCase(),n=t.getAttribute(n),"string"==typeof n){try{n="true"===n?!0:"false"===n?!1:"null"===n?null:+n+""===n?+n:ue.test(n)?q.parseJSON(n):n}catch(r){}q.data(t,i,n)}else n=e;return n}function r(t){for(var e in t)if(("data"!==e||!q.isEmptyObject(t[e]))&&"toJSON"!==e)return!1;return!0}function o(){return!1}function s(){return!0}function c(t){return!t||!t.parentNode||11===t.parentNode.nodeType}function a(t,e){do t=t[e];while(t&&1!==t.nodeType);return t}function l(t,e,i){if(e=e||0,q.isFunction(e))return q.grep(t,function(t,n){return!!e.call(t,n,t)===i});if(e.nodeType)return q.grep(t,function(t){return t===e===i});if("string"==typeof e){var n=q.grep(t,function(t){return 1===t.nodeType});if(De.test(e))return q.filter(e,n,!i);e=q.filter(e,n)}return q.grep(t,function(t){return 0<=q.inArray(t,e)===i})}function h(t){var e=Be.split("|");if(t=t.createDocumentFragment(),t.createElement)for(;e.length;)t.createElement(e.pop());return t}function u(t,e){return t.getElementsByTagName(e)[0]||t.appendChild(t.ownerDocument.createElement(e))}function d(t,e){if(1===e.nodeType&&q.hasData(t)){var i,n,r;n=q._data(t);var o=q._data(e,n),s=n.events;if(s)for(i in delete o.handle,o.events={},s)for(n=0,r=s[i].length;r>n;n++)q.event.add(e,i,s[i][n]);o.data&&(o.data=q.extend({},o.data))}}function _(t,e){var i;1===e.nodeType&&(e.clearAttributes&&e.clearAttributes(),e.mergeAttributes&&e.mergeAttributes(t),i=e.nodeName.toLowerCase(),"object"===i?(e.parentNode&&(e.outerHTML=t.outerHTML),q.support.html5Clone&&t.innerHTML&&!q.trim(e.innerHTML)&&(e.innerHTML=t.innerHTML)):"input"===i&&Xe.test(t.type)?(e.defaultChecked=e.checked=t.checked,e.value!==t.value&&(e.value=t.value)):"option"===i?e.selected=t.defaultSelected:"input"===i||"textarea"===i?e.defaultValue=t.defaultValue:"script"===i&&e.text!==t.text&&(e.text=t.text),e.removeAttribute(q.expando))}function p(t){return"undefined"!=typeof t.getElementsByTagName?t.getElementsByTagName("*"):"undefined"!=typeof t.querySelectorAll?t.querySelectorAll("*"):[]}function f(t){Xe.test(t.type)&&(t.defaultChecked=t.checked)}function m(t,e){if(e in t)return e;for(var i=e.charAt(0).toUpperCase()+e.slice(1),n=e,r=_i.length;r--;)if(e=_i[r]+i,e in t)return e;return n}function g(t,e){return t=e||t,"none"===q.css(t,"display")||!q.contains(t.ownerDocument,t)}function y(t,e){for(var i,n,r=[],o=0,s=t.length;s>o;o++)i=t[o],i.style&&(r[o]=q._data(i,"olddisplay"),e?(!r[o]&&"none"===i.style.display&&(i.style.display=""),""===i.style.display&&g(i)&&(r[o]=q._data(i,"olddisplay",v(i.nodeName)))):(n=Ke(i,"display"),!r[o]&&"none"!==n&&q._data(i,"olddisplay",n)));for(o=0;s>o;o++)i=t[o],!i.style||e&&"none"!==i.style.display&&""!==i.style.display||(i.style.display=e?r[o]||"":"none");return t}function T(t,e,i){return(t=si.exec(e))?Math.max(0,t[1]-(i||0))+(t[2]||"px"):e}function S(t,e,i,n){e=i===(n?"border":"content")?4:"width"===e?1:0;for(var r=0;4>e;e+=2)"margin"===i&&(r+=q.css(t,i+di[e],!0)),n?("content"===i&&(r-=parseFloat(Ke(t,"padding"+di[e]))||0),"margin"!==i&&(r-=parseFloat(Ke(t,"border"+di[e]+"Width"))||0)):(r+=parseFloat(Ke(t,"padding"+di[e]))||0,"padding"!==i&&(r+=parseFloat(Ke(t,"border"+di[e]+"Width"))||0));return r}function C(t,e,i){var n="width"===e?t.offsetWidth:t.offsetHeight,r=!0,o=q.support.boxSizing&&"border-box"===q.css(t,"boxSizing");if(0>=n||null==n){if(n=Ke(t,e),(0>n||null==n)&&(n=t.style[e]),ci.test(n))return n;r=o&&(q.support.boxSizingReliable||n===t.style[e]),n=parseFloat(n)||0}return n+S(t,e,i||(o?"border":"content"),r)+"px"}function v(t){if(li[t])return li[t];var e=q("<"+t+">").appendTo(M.body),i=e.css("display");return e.remove(),("none"===i||""===i)&&($e=M.body.appendChild($e||q.extend(M.createElement("iframe"),{frameBorder:0,width:0,height:0})),ti&&$e.createElement||(ti=($e.contentWindow||$e.contentDocument).document,ti.write("<!doctype html><html><body>"),ti.close()),e=ti.body.appendChild(ti.createElement(t)),i=Ke(e,"display"),M.body.removeChild($e)),li[t]=i,i}function x(t,e,i,n){var r;if(q.isArray(e))q.each(e,function(e,r){i||mi.test(t)?n(t,r):x(t+"["+("object"==typeof r?e:"")+"]",r,i,n)});else if(i||"object"!==q.type(e))n(t,e);else for(r in e)x(t+"["+r+"]",e[r],i,n)}function E(t){return function(e,i){"string"!=typeof e&&(i=e,e="*");var n,r,o=e.toLowerCase().split(Q),s=0,c=o.length;if(q.isFunction(i))for(;c>s;s++)n=o[s],(r=/^\+/.test(n))&&(n=n.substr(1)||"*"),n=t[n]=t[n]||[],n[r?"unshift":"push"](i)}}function b(t,i,n,r,o,s){o=o||i.dataTypes[0],s=s||{},s[o]=!0;var c;o=t[o];for(var a=0,l=o?o.length:0,h=t===Li;l>a&&(h||!c);a++)c=o[a](i,n,r),"string"==typeof c&&(!h||s[c]?c=e:(i.dataTypes.unshift(c),c=b(t,i,n,r,c,s)));return(h||!c)&&!s["*"]&&(c=b(t,i,n,r,"*",s)),c}function A(t,i){var n,r,o=q.ajaxSettings.flatOptions||{};for(n in i)i[n]!==e&&((o[n]?t:r||(r={}))[n]=i[n]);r&&q.extend(!0,t,r)}function R(){try{return new t.XMLHttpRequest}catch(e){}}function P(){return setTimeout(function(){zi=e},0),zi=q.now()}function I(t,e){q.each(e,function(e,i){for(var n=(qi[e]||[]).concat(qi["*"]),r=0,o=n.length;o>r&&!n[r].call(t,e,i);r++);})}function w(t,e,i){var n=0,r=ji.length,o=q.Deferred().always(function(){delete s.elem}),s=function(){for(var e=zi||P(),e=Math.max(0,c.startTime+c.duration-e),i=1-(e/c.duration||0),n=0,r=c.tweens.length;r>n;n++)c.tweens[n].run(i);return o.notifyWith(t,[c,i,e]),1>i&&r?e:(o.resolveWith(t,[c]),!1)},c=o.promise({elem:t,props:q.extend({},e),opts:q.extend(!0,{specialEasing:{}},i),originalProperties:e,originalOptions:i,startTime:zi||P(),duration:i.duration,tweens:[],createTween:function(e,i){return e=q.Tween(t,c.opts,e,i,c.opts.specialEasing[e]||c.opts.easing),c.tweens.push(e),e},stop:function(e){for(var i=0,n=e?c.tweens.length:0;n>i;i++)c.tweens[i].run(1);return e?o.resolveWith(t,[c,e]):o.rejectWith(t,[c,e]),this}});for(i=c.props,L(i,c.opts.specialEasing);r>n;n++)if(e=ji[n].call(c,t,i,c.opts))return e;return I(c,i),q.isFunction(c.opts.start)&&c.opts.start.call(t,c),q.fx.timer(q.extend(s,{anim:c,queue:c.opts.queue,elem:t})),c.progress(c.opts.progress).done(c.opts.done,c.opts.complete).fail(c.opts.fail).always(c.opts.always)}function L(t,e){var i,n,r,o,s;for(i in t)if(n=q.camelCase(i),r=e[n],o=t[i],q.isArray(o)&&(r=o[1],o=t[i]=o[0]),i!==n&&(t[n]=o,delete t[i]),(s=q.cssHooks[n])&&"expand"in s)for(i in o=s.expand(o),delete t[n],o)i in t||(t[i]=o[i],e[i]=r);else e[n]=r}function D(t,e,i,n,r){return new D.prototype.init(t,e,i,n,r)}function O(t,e){var i,n={height:t},r=0;for(e=e?1:0;4>r;r+=2-e)i=di[r],n["margin"+i]=n["padding"+i]=t;return e&&(n.opacity=n.width=t),n}function N(t){return q.isWindow(t)?t:9===t.nodeType?t.defaultView||t.parentWindow:!1}var B,F,M=t.document,V=t.location,k=t.navigator,W=t.jQuery,G=t.$,z=Array.prototype.push,U=Array.prototype.slice,Y=Array.prototype.indexOf,X=Object.prototype.toString,H=Object.prototype.hasOwnProperty,j=String.prototype.trim,q=function(t,e){return new q.fn.init(t,e,B)},J=/[\-+]?(?:\d*\.|)\d+(?:[eE][\-+]?\d+|)/.source,Z=/\S/,Q=/\s+/,K=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,$=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,te=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,ee=/^[\],:{}\s]*$/,ie=/(?:^|:|,)(?:\s*\[)+/g,ne=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,re=/"[^"\\\r\n]*"|true|false|null|-?(?:\d\d*\.|)\d+(?:[eE][\-+]?\d+|)/g,oe=/^-ms-/,se=/-([\da-z])/gi,ce=function(t,e){return(e+"").toUpperCase()},ae=function(){M.addEventListener?(M.removeEventListener("DOMContentLoaded",ae,!1),q.ready()):"complete"===M.readyState&&(M.detachEvent("onreadystatechange",ae),q.ready())},le={};q.fn=q.prototype={constructor:q,init:function(t,i,n){var r,o;if(!t)return this;if(t.nodeType)return this.context=this[0]=t,this.length=1,this;if("string"==typeof t){if(r="<"===t.charAt(0)&&">"===t.charAt(t.length-1)&&3<=t.length?[null,t,null]:$.exec(t),r&&(r[1]||!i)){if(r[1])return i=i instanceof q?i[0]:i,o=i&&i.nodeType?i.ownerDocument||i:M,t=q.parseHTML(r[1],o,!0),te.test(r[1])&&q.isPlainObject(i)&&this.attr.call(t,i,!0),q.merge(this,t);if((i=M.getElementById(r[2]))&&i.parentNode){if(i.id!==r[2])return n.find(t);this.length=1,this[0]=i}return this.context=M,this.selector=t,this}return!i||i.jquery?(i||n).find(t):this.constructor(i).find(t)}return q.isFunction(t)?n.ready(t):(t.selector!==e&&(this.selector=t.selector,this.context=t.context),q.makeArray(t,this))},selector:"",jquery:"1.8.3",length:0,size:function(){return this.length},toArray:function(){return U.call(this)},get:function(t){return null==t?this.toArray():0>t?this[this.length+t]:this[t]},pushStack:function(t,e,i){return t=q.merge(this.constructor(),t),t.prevObject=this,t.context=this.context,"find"===e?t.selector=this.selector+(this.selector?" ":"")+i:e&&(t.selector=this.selector+"."+e+"("+i+")"),t},each:function(t,e){return q.each(this,t,e)},ready:function(t){return q.ready.promise().done(t),this},eq:function(t){return t=+t,-1===t?this.slice(t):this.slice(t,t+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(U.apply(this,arguments),"slice",U.call(arguments).join(","))},map:function(t){return this.pushStack(q.map(this,function(e,i){return t.call(e,i,e)}))},end:function(){return this.prevObject||this.constructor(null)},push:z,sort:[].sort,splice:[].splice},q.fn.init.prototype=q.fn,q.extend=q.fn.extend=function(){var t,i,n,r,o,s,c=arguments[0]||{},a=1,l=arguments.length,h=!1;for("boolean"==typeof c&&(h=c,c=arguments[1]||{},a=2),"object"!=typeof c&&!q.isFunction(c)&&(c={}),l===a&&(c=this,--a);l>a;a++)if(null!=(t=arguments[a]))for(i in t)n=c[i],r=t[i],c!==r&&(h&&r&&(q.isPlainObject(r)||(o=q.isArray(r)))?(o?(o=!1,s=n&&q.isArray(n)?n:[]):s=n&&q.isPlainObject(n)?n:{},c[i]=q.extend(h,s,r)):r!==e&&(c[i]=r));return c},q.extend({noConflict:function(e){return t.$===q&&(t.$=G),e&&t.jQuery===q&&(t.jQuery=W),q},isReady:!1,readyWait:1,holdReady:function(t){t?q.readyWait++:q.ready(!0)},ready:function(t){if(!0===t?!--q.readyWait:!q.isReady){if(!M.body)return setTimeout(q.ready,1);q.isReady=!0,!0!==t&&0<--q.readyWait||(F.resolveWith(M,[q]),q.fn.trigger&&q(M).trigger("ready").off("ready"))}},isFunction:function(t){return"function"===q.type(t)},isArray:Array.isArray||function(t){return"array"===q.type(t)},isWindow:function(t){return null!=t&&t==t.window},isNumeric:function(t){return!isNaN(parseFloat(t))&&isFinite(t)},type:function(t){return null==t?String(t):le[X.call(t)]||"object"},isPlainObject:function(t){if(!t||"object"!==q.type(t)||t.nodeType||q.isWindow(t))return!1;try{if(t.constructor&&!H.call(t,"constructor")&&!H.call(t.constructor.prototype,"isPrototypeOf"))return!1}catch(i){return!1}for(var n in t);return n===e||H.call(t,n)},isEmptyObject:function(t){for(var e in t)return!1;return!0},error:function(t){throw Error(t)},parseHTML:function(t,e,i){var n;return t&&"string"==typeof t?("boolean"==typeof e&&(i=e,e=0),e=e||M,(n=te.exec(t))?[e.createElement(n[1])]:(n=q.buildFragment([t],e,i?null:[]),q.merge([],(n.cacheable?q.clone(n.fragment):n.fragment).childNodes))):null},parseJSON:function(e){return e&&"string"==typeof e?(e=q.trim(e),t.JSON&&t.JSON.parse?t.JSON.parse(e):ee.test(e.replace(ne,"@").replace(re,"]").replace(ie,""))?new Function("return "+e)():void q.error("Invalid JSON: "+e)):null},parseXML:function(i){var n,r;if(!i||"string"!=typeof i)return null;try{t.DOMParser?(r=new DOMParser,n=r.parseFromString(i,"text/xml")):(n=new ActiveXObject("Microsoft.XMLDOM"),n.async="false",n.loadXML(i))}catch(o){n=e}return(!n||!n.documentElement||n.getElementsByTagName("parsererror").length)&&q.error("Invalid XML: "+i),n},noop:function(){},globalEval:function(e){e&&Z.test(e)&&(t.execScript||function(e){t.eval.call(t,e)})(e)},camelCase:function(t){return t.replace(oe,"ms-").replace(se,ce)},nodeName:function(t,e){return t.nodeName&&t.nodeName.toLowerCase()===e.toLowerCase()},each:function(t,i,n){var r,o=0,s=t.length,c=s===e||q.isFunction(t);if(n)if(c){for(r in t)if(!1===i.apply(t[r],n))break}else for(;s>o&&!1!==i.apply(t[o++],n););else if(c){for(r in t)if(!1===i.call(t[r],r,t[r]))break}else for(;s>o&&!1!==i.call(t[o],o,t[o++]););return t},trim:j&&!j.call("")?function(t){return null==t?"":j.call(t)}:function(t){return null==t?"":(t+"").replace(K,"")},makeArray:function(t,e){var i,n=e||[];return null!=t&&(i=q.type(t),null==t.length||"string"===i||"function"===i||"regexp"===i||q.isWindow(t)?z.call(n,t):q.merge(n,t)),n},inArray:function(t,e,i){var n;if(e){if(Y)return Y.call(e,t,i);for(n=e.length,i=i?0>i?Math.max(0,n+i):i:0;n>i;i++)if(i in e&&e[i]===t)return i}return-1},merge:function(t,i){var n=i.length,r=t.length,o=0;if("number"==typeof n)for(;n>o;o++)t[r++]=i[o];else for(;i[o]!==e;)t[r++]=i[o++];return t.length=r,t},grep:function(t,e,i){var n,r=[],o=0,s=t.length;for(i=!!i;s>o;o++)n=!!e(t[o],o),i!==n&&r.push(t[o]);return r},map:function(t,i,n){var r,o,s=[],c=0,a=t.length;if(t instanceof q||a!==e&&"number"==typeof a&&(a>0&&t[0]&&t[a-1]||0===a||q.isArray(t)))for(;a>c;c++)r=i(t[c],c,n),null!=r&&(s[s.length]=r);else for(o in t)r=i(t[o],o,n),null!=r&&(s[s.length]=r);return s.concat.apply([],s)},guid:1,proxy:function(t,i){var n,r,o;return"string"==typeof i&&(n=t[i],i=t,t=n),q.isFunction(t)?(r=U.call(arguments,2),o=function(){return t.apply(i,r.concat(U.call(arguments)))},o.guid=t.guid=t.guid||q.guid++,o):e},access:function(t,i,n,r,o,s,c){var a,l=null==n,h=0,u=t.length;if(n&&"object"==typeof n){for(h in n)q.access(t,i,h,n[h],1,s,r);o=1}else if(r!==e){if(a=c===e&&q.isFunction(r),l&&(a?(a=i,i=function(t,e,i){return a.call(q(t),i)}):(i.call(t,r),i=null)),i)for(;u>h;h++)i(t[h],n,a?r.call(t[h],h,i(t[h],n)):r,c);o=1}return o?t:l?i.call(t):u?i(t[0],n):s},now:function(){return(new Date).getTime()}}),q.ready.promise=function(e){if(!F)if(F=q.Deferred(),"complete"===M.readyState)setTimeout(q.ready,1);else if(M.addEventListener)M.addEventListener("DOMContentLoaded",ae,!1),t.addEventListener("load",q.ready,!1);else{M.attachEvent("onreadystatechange",ae),t.attachEvent("onload",q.ready);var i=!1;try{i=null==t.frameElement&&M.documentElement}catch(n){}i&&i.doScroll&&function r(){if(!q.isReady){try{i.doScroll("left")}catch(t){return setTimeout(r,50)}q.ready()}}()}return F.promise(e)},q.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(t,e){le["[object "+e+"]"]=e.toLowerCase()}),B=q(M);var he={};q.Callbacks=function(t){t="string"==typeof t?he[t]||i(t):q.extend({},t);var n,r,o,s,c,a,l=[],h=!t.once&&[],u=function(e){for(n=t.memory&&e,r=!0,a=s||0,s=0,c=l.length,o=!0;l&&c>a;a++)if(!1===l[a].apply(e[0],e[1])&&t.stopOnFalse){n=!1;break}o=!1,l&&(h?h.length&&u(h.shift()):n?l=[]:d.disable())},d={add:function(){if(l){var e=l.length;!function i(e){q.each(e,function(e,n){var r=q.type(n);"function"===r?(!t.unique||!d.has(n))&&l.push(n):n&&n.length&&"string"!==r&&i(n)})}(arguments),o?c=l.length:n&&(s=e,u(n))}return this},remove:function(){return l&&q.each(arguments,function(t,e){for(var i;-1<(i=q.inArray(e,l,i));)l.splice(i,1),o&&(c>=i&&c--,a>=i&&a--)}),this},has:function(t){return-1<q.inArray(t,l)},empty:function(){return l=[],this},disable:function(){return l=h=n=e,this},disabled:function(){return!l},lock:function(){return h=e,n||d.disable(),this},locked:function(){return!h},fireWith:function(t,e){return e=e||[],e=[t,e.slice?e.slice():e],l&&(!r||h)&&(o?h.push(e):u(e)),this},fire:function(){return d.fireWith(this,arguments),this},fired:function(){return!!r}};return d},q.extend({Deferred:function(t){var e=[["resolve","done",q.Callbacks("once memory"),"resolved"],["reject","fail",q.Callbacks("once memory"),"rejected"],["notify","progress",q.Callbacks("memory")]],i="pending",n={state:function(){return i},always:function(){return r.done(arguments).fail(arguments),this},then:function(){var t=arguments;return q.Deferred(function(i){q.each(e,function(e,n){var o=n[0],s=t[e];r[n[1]](q.isFunction(s)?function(){var t=s.apply(this,arguments);t&&q.isFunction(t.promise)?t.promise().done(i.resolve).fail(i.reject).progress(i.notify):i[o+"With"](this===r?i:this,[t])}:i[o])}),t=null}).promise()},promise:function(t){return null!=t?q.extend(t,n):n}},r={};return n.pipe=n.then,q.each(e,function(t,o){var s=o[2],c=o[3];n[o[1]]=s.add,c&&s.add(function(){i=c},e[1^t][2].disable,e[2][2].lock),r[o[0]]=s.fire,r[o[0]+"With"]=s.fireWith}),n.promise(r),t&&t.call(r,r),r},when:function(t){var e,i,n,r=0,o=U.call(arguments),s=o.length,c=1!==s||t&&q.isFunction(t.promise)?s:0,a=1===c?t:q.Deferred(),l=function(t,i,n){return function(r){i[t]=this,n[t]=1<arguments.length?U.call(arguments):r,n===e?a.notifyWith(i,n):--c||a.resolveWith(i,n)}};if(s>1)for(e=Array(s),i=Array(s),n=Array(s);s>r;r++)o[r]&&q.isFunction(o[r].promise)?o[r].promise().done(l(r,n,o)).fail(a.reject).progress(l(r,i,e)):--c;return c||a.resolveWith(n,o),a.promise()}}),q.support=function(){var e,i,n,r,o,s,c,a,l=M.createElement("div");if(l.setAttribute("className","t"),l.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",i=l.getElementsByTagName("*"),n=l.getElementsByTagName("a")[0],!i||!n||!i.length)return{};r=M.createElement("select"),o=r.appendChild(M.createElement("option")),i=l.getElementsByTagName("input")[0],n.style.cssText="top:1px;float:left;opacity:.5",e={leadingWhitespace:3===l.firstChild.nodeType,tbody:!l.getElementsByTagName("tbody").length,htmlSerialize:!!l.getElementsByTagName("link").length,style:/top/.test(n.getAttribute("style")),hrefNormalized:"/a"===n.getAttribute("href"),opacity:/^0.5/.test(n.style.opacity),cssFloat:!!n.style.cssFloat,checkOn:"on"===i.value,optSelected:o.selected,getSetAttribute:"t"!==l.className,enctype:!!M.createElement("form").enctype,html5Clone:"<:nav></:nav>"!==M.createElement("nav").cloneNode(!0).outerHTML,boxModel:"CSS1Compat"===M.compatMode,submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1},i.checked=!0,e.noCloneChecked=i.cloneNode(!0).checked,r.disabled=!0,e.optDisabled=!o.disabled;try{delete l.test}catch(h){e.deleteExpando=!1}if(!l.addEventListener&&l.attachEvent&&l.fireEvent&&(l.attachEvent("onclick",a=function(){e.noCloneEvent=!1}),l.cloneNode(!0).fireEvent("onclick"),l.detachEvent("onclick",a)),i=M.createElement("input"),i.value="t",i.setAttribute("type","radio"),e.radioValue="t"===i.value,i.setAttribute("checked","checked"),i.setAttribute("name","t"),l.appendChild(i),n=M.createDocumentFragment(),n.appendChild(l.lastChild),e.checkClone=n.cloneNode(!0).cloneNode(!0).lastChild.checked,e.appendChecked=i.checked,n.removeChild(i),n.appendChild(l),l.attachEvent)for(s in{submit:!0,change:!0,focusin:!0})i="on"+s,(c=i in l)||(l.setAttribute(i,"return;"),c="function"==typeof l[i]),e[s+"Bubbles"]=c;return q(function(){var i,n,r,o,s=M.getElementsByTagName("body")[0];s&&(i=M.createElement("div"),i.style.cssText="visibility:hidden;border:0;width:0;height:0;position:static;top:0;margin-top:1px",s.insertBefore(i,s.firstChild),n=M.createElement("div"),i.appendChild(n),n.innerHTML="<table><tr><td></td><td>t</td></tr></table>",r=n.getElementsByTagName("td"),r[0].style.cssText="padding:0;margin:0;border:0;display:none",c=0===r[0].offsetHeight,r[0].style.display="",r[1].style.display="none",e.reliableHiddenOffsets=c&&0===r[0].offsetHeight,n.innerHTML="",n.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",e.boxSizing=4===n.offsetWidth,e.doesNotIncludeMarginInBodyOffset=1!==s.offsetTop,t.getComputedStyle&&(e.pixelPosition="1%"!==(t.getComputedStyle(n,null)||{}).top,e.boxSizingReliable="4px"===(t.getComputedStyle(n,null)||{width:"4px"}).width,o=M.createElement("div"),o.style.cssText=n.style.cssText="padding:0;margin:0;border:0;display:block;overflow:hidden;",o.style.marginRight=o.style.width="0",n.style.width="1px",n.appendChild(o),e.reliableMarginRight=!parseFloat((t.getComputedStyle(o,null)||{}).marginRight)),"undefined"!=typeof n.style.zoom&&(n.innerHTML="",n.style.cssText="padding:0;margin:0;border:0;display:block;overflow:hidden;width:1px;padding:1px;display:inline;zoom:1",e.inlineBlockNeedsLayout=3===n.offsetWidth,n.style.display="block",n.style.overflow="visible",n.innerHTML="<div></div>",n.firstChild.style.width="5px",e.shrinkWrapBlocks=3!==n.offsetWidth,i.style.zoom=1),s.removeChild(i))}),n.removeChild(l),i=n=r=o=i=n=l=null,e}();var ue=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,de=/([A-Z])/g;q.extend({cache:{},deletedIds:[],uuid:0,expando:"jQuery"+(q.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(t){return t=t.nodeType?q.cache[t[q.expando]]:t[q.expando],!!t&&!r(t)},data:function(t,i,n,r){if(q.acceptData(t)){var o,s,c=q.expando,a="string"==typeof i,l=t.nodeType,h=l?q.cache:t,u=l?t[c]:t[c]&&c;if(u&&h[u]&&(r||h[u].data)||!a||n!==e)return u||(l?t[c]=u=q.deletedIds.pop()||q.guid++:u=c),h[u]||(h[u]={},l||(h[u].toJSON=q.noop)),("object"==typeof i||"function"==typeof i)&&(r?h[u]=q.extend(h[u],i):h[u].data=q.extend(h[u].data,i)),o=h[u],r||(o.data||(o.data={}),o=o.data),n!==e&&(o[q.camelCase(i)]=n),a?(s=o[i],null==s&&(s=o[q.camelCase(i)])):s=o,s}},removeData:function(t,e,i){if(q.acceptData(t)){var n,o,s,c=t.nodeType,a=c?q.cache:t,l=c?t[q.expando]:q.expando;if(a[l]){if(e&&(n=i?a[l]:a[l].data)){q.isArray(e)||(e in n?e=[e]:(e=q.camelCase(e),e=e in n?[e]:e.split(" "))),o=0;for(s=e.length;s>o;o++)delete n[e[o]];if(!(i?r:q.isEmptyObject)(n))return}if(!i&&(delete a[l].data,!r(a[l])))return;c?q.cleanData([t],!0):q.support.deleteExpando||a!=a.window?delete a[l]:a[l]=null}}},_data:function(t,e,i){return q.data(t,e,i,!0)},acceptData:function(t){var e=t.nodeName&&q.noData[t.nodeName.toLowerCase()];return!e||!0!==e&&t.getAttribute("classid")===e}}),q.fn.extend({data:function(t,i){var r,o,s,c,a,l=this[0],h=0,u=null;if(t===e){if(this.length&&(u=q.data(l),1===l.nodeType&&!q._data(l,"parsedAttrs"))){for(s=l.attributes,a=s.length;a>h;h++)c=s[h].name,c.indexOf("data-")||(c=q.camelCase(c.substring(5)),n(l,c,u[c]));q._data(l,"parsedAttrs",!0)}return u}return"object"==typeof t?this.each(function(){q.data(this,t)}):(r=t.split(".",2),r[1]=r[1]?"."+r[1]:"",o=r[1]+"!",q.access(this,function(i){return i===e?(u=this.triggerHandler("getData"+o,[r[0]]),u===e&&l&&(u=q.data(l,t),u=n(l,t,u)),u===e&&r[1]?this.data(r[0]):u):(r[1]=i,void this.each(function(){var e=q(this);
e.triggerHandler("setData"+o,r),q.data(this,t,i),e.triggerHandler("changeData"+o,r)}))},null,i,1<arguments.length,null,!1))},removeData:function(t){return this.each(function(){q.removeData(this,t)})}}),q.extend({queue:function(t,e,i){var n;return t?(e=(e||"fx")+"queue",n=q._data(t,e),i&&(!n||q.isArray(i)?n=q._data(t,e,q.makeArray(i)):n.push(i)),n||[]):void 0},dequeue:function(t,e){e=e||"fx";var i=q.queue(t,e),n=i.length,r=i.shift(),o=q._queueHooks(t,e),s=function(){q.dequeue(t,e)};"inprogress"===r&&(r=i.shift(),n--),r&&("fx"===e&&i.unshift("inprogress"),delete o.stop,r.call(t,s,o)),!n&&o&&o.empty.fire()},_queueHooks:function(t,e){var i=e+"queueHooks";return q._data(t,i)||q._data(t,i,{empty:q.Callbacks("once memory").add(function(){q.removeData(t,e+"queue",!0),q.removeData(t,i,!0)})})}}),q.fn.extend({queue:function(t,i){var n=2;return"string"!=typeof t&&(i=t,t="fx",n--),arguments.length<n?q.queue(this[0],t):i===e?this:this.each(function(){var e=q.queue(this,t,i);q._queueHooks(this,t),"fx"===t&&"inprogress"!==e[0]&&q.dequeue(this,t)})},dequeue:function(t){return this.each(function(){q.dequeue(this,t)})},delay:function(t,e){return t=q.fx?q.fx.speeds[t]||t:t,e=e||"fx",this.queue(e,function(e,i){var n=setTimeout(e,t);i.stop=function(){clearTimeout(n)}})},clearQueue:function(t){return this.queue(t||"fx",[])},promise:function(t,i){var n,r=1,o=q.Deferred(),s=this,c=this.length,a=function(){--r||o.resolveWith(s,[s])};for("string"!=typeof t&&(i=t,t=e),t=t||"fx";c--;)(n=q._data(s[c],t+"queueHooks"))&&n.empty&&(r++,n.empty.add(a));return a(),o.promise(i)}});var _e,pe,fe,me=/[\t\r\n]/g,ge=/\r/g,ye=/^(?:button|input)$/i,Te=/^(?:button|input|object|select|textarea)$/i,Se=/^a(?:rea|)$/i,Ce=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,ve=q.support.getSetAttribute;q.fn.extend({attr:function(t,e){return q.access(this,q.attr,t,e,1<arguments.length)},removeAttr:function(t){return this.each(function(){q.removeAttr(this,t)})},prop:function(t,e){return q.access(this,q.prop,t,e,1<arguments.length)},removeProp:function(t){return t=q.propFix[t]||t,this.each(function(){try{this[t]=e,delete this[t]}catch(i){}})},addClass:function(t){var e,i,n,r,o,s,c;if(q.isFunction(t))return this.each(function(e){q(this).addClass(t.call(this,e,this.className))});if(t&&"string"==typeof t)for(e=t.split(Q),i=0,n=this.length;n>i;i++)if(r=this[i],1===r.nodeType)if(r.className||1!==e.length){for(o=" "+r.className+" ",s=0,c=e.length;c>s;s++)0>o.indexOf(" "+e[s]+" ")&&(o+=e[s]+" ");r.className=q.trim(o)}else r.className=t;return this},removeClass:function(t){var i,n,r,o,s,c,a;if(q.isFunction(t))return this.each(function(e){q(this).removeClass(t.call(this,e,this.className))});if(t&&"string"==typeof t||t===e)for(i=(t||"").split(Q),c=0,a=this.length;a>c;c++)if(r=this[c],1===r.nodeType&&r.className){for(n=(" "+r.className+" ").replace(me," "),o=0,s=i.length;s>o;o++)for(;0<=n.indexOf(" "+i[o]+" ");)n=n.replace(" "+i[o]+" "," ");r.className=t?q.trim(n):""}return this},toggleClass:function(t,e){var i=typeof t,n="boolean"==typeof e;return this.each(q.isFunction(t)?function(i){q(this).toggleClass(t.call(this,i,this.className,e),e)}:function(){if("string"===i)for(var r,o=0,s=q(this),c=e,a=t.split(Q);r=a[o++];)c=n?c:!s.hasClass(r),s[c?"addClass":"removeClass"](r);else("undefined"===i||"boolean"===i)&&(this.className&&q._data(this,"__className__",this.className),this.className=this.className||!1===t?"":q._data(this,"__className__")||"")})},hasClass:function(t){t=" "+t+" ";for(var e=0,i=this.length;i>e;e++)if(1===this[e].nodeType&&0<=(" "+this[e].className+" ").replace(me," ").indexOf(t))return!0;return!1},val:function(t){var i,n,r,o=this[0];return arguments.length?(r=q.isFunction(t),this.each(function(n){var o,s=q(this);1===this.nodeType&&(o=r?t.call(this,n,s.val()):t,null==o?o="":"number"==typeof o?o+="":q.isArray(o)&&(o=q.map(o,function(t){return null==t?"":t+""})),(i=q.valHooks[this.type]||q.valHooks[this.nodeName.toLowerCase()])&&"set"in i&&i.set(this,o,"value")!==e||(this.value=o))})):o?(i=q.valHooks[o.type]||q.valHooks[o.nodeName.toLowerCase()],i&&"get"in i&&(n=i.get(o,"value"))!==e?n:(n=o.value,"string"==typeof n?n.replace(ge,""):null==n?"":n)):void 0}}),q.extend({valHooks:{option:{get:function(t){var e=t.attributes.value;return!e||e.specified?t.value:t.text}},select:{get:function(t){for(var e,i=t.options,n=t.selectedIndex,r=(t="select-one"===t.type||0>n)?null:[],o=t?n+1:i.length,s=0>n?o:t?n:0;o>s;s++)if(e=i[s],!(!e.selected&&s!==n||(q.support.optDisabled?e.disabled:null!==e.getAttribute("disabled"))||e.parentNode.disabled&&q.nodeName(e.parentNode,"optgroup"))){if(e=q(e).val(),t)return e;r.push(e)}return r},set:function(t,e){var i=q.makeArray(e);return q(t).find("option").each(function(){this.selected=0<=q.inArray(q(this).val(),i)}),i.length||(t.selectedIndex=-1),i}}},attrFn:{},attr:function(t,i,n,r){var o,s,c=t.nodeType;return t&&3!==c&&8!==c&&2!==c?r&&q.isFunction(q.fn[i])?q(t)[i](n):"undefined"==typeof t.getAttribute?q.prop(t,i,n):((r=1!==c||!q.isXMLDoc(t))&&(i=i.toLowerCase(),s=q.attrHooks[i]||(Ce.test(i)?pe:_e)),n!==e?null===n?void q.removeAttr(t,i):s&&"set"in s&&r&&(o=s.set(t,n,i))!==e?o:(t.setAttribute(i,n+""),n):s&&"get"in s&&r&&null!==(o=s.get(t,i))?o:(o=t.getAttribute(i),null===o?e:o)):void 0},removeAttr:function(t,e){var i,n,r,o,s=0;if(e&&1===t.nodeType)for(n=e.split(Q);s<n.length;s++)(r=n[s])&&(i=q.propFix[r]||r,o=Ce.test(r),o||q.attr(t,r,""),t.removeAttribute(ve?r:i),o&&i in t&&(t[i]=!1))},attrHooks:{type:{set:function(t,e){if(ye.test(t.nodeName)&&t.parentNode)q.error("type property can't be changed");else if(!q.support.radioValue&&"radio"===e&&q.nodeName(t,"input")){var i=t.value;return t.setAttribute("type",e),i&&(t.value=i),e}}},value:{get:function(t,e){return _e&&q.nodeName(t,"button")?_e.get(t,e):e in t?t.value:null},set:function(t,e,i){return _e&&q.nodeName(t,"button")?_e.set(t,e,i):void(t.value=e)}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(t,i,n){var r,o,s,c=t.nodeType;return t&&3!==c&&8!==c&&2!==c?(s=1!==c||!q.isXMLDoc(t),s&&(i=q.propFix[i]||i,o=q.propHooks[i]),n!==e?o&&"set"in o&&(r=o.set(t,n,i))!==e?r:t[i]=n:o&&"get"in o&&null!==(r=o.get(t,i))?r:t[i]):void 0},propHooks:{tabIndex:{get:function(t){var i=t.getAttributeNode("tabindex");return i&&i.specified?parseInt(i.value,10):Te.test(t.nodeName)||Se.test(t.nodeName)&&t.href?0:e}}}}),pe={get:function(t,i){var n,r=q.prop(t,i);return!0===r||"boolean"!=typeof r&&(n=t.getAttributeNode(i))&&!1!==n.nodeValue?i.toLowerCase():e},set:function(t,e,i){var n;return!1===e?q.removeAttr(t,i):(n=q.propFix[i]||i,n in t&&(t[n]=!0),t.setAttribute(i,i.toLowerCase())),i}},ve||(fe={name:!0,id:!0,coords:!0},_e=q.valHooks.button={get:function(t,i){var n;return n=t.getAttributeNode(i),n&&(fe[i]?""!==n.value:n.specified)?n.value:e},set:function(t,e,i){var n=t.getAttributeNode(i);return n||(n=M.createAttribute(i),t.setAttributeNode(n)),n.value=e+""}},q.each(["width","height"],function(t,e){q.attrHooks[e]=q.extend(q.attrHooks[e],{set:function(t,i){return""===i?(t.setAttribute(e,"auto"),i):void 0}})}),q.attrHooks.contenteditable={get:_e.get,set:function(t,e,i){""===e&&(e="false"),_e.set(t,e,i)}}),q.support.hrefNormalized||q.each(["href","src","width","height"],function(t,i){q.attrHooks[i]=q.extend(q.attrHooks[i],{get:function(t){return t=t.getAttribute(i,2),null===t?e:t}})}),q.support.style||(q.attrHooks.style={get:function(t){return t.style.cssText.toLowerCase()||e},set:function(t,e){return t.style.cssText=e+""}}),q.support.optSelected||(q.propHooks.selected=q.extend(q.propHooks.selected,{get:function(t){return t=t.parentNode,t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}})),q.support.enctype||(q.propFix.enctype="encoding"),q.support.checkOn||q.each(["radio","checkbox"],function(){q.valHooks[this]={get:function(t){return null===t.getAttribute("value")?"on":t.value}}}),q.each(["radio","checkbox"],function(){q.valHooks[this]=q.extend(q.valHooks[this],{set:function(t,e){return q.isArray(e)?t.checked=0<=q.inArray(q(t).val(),e):void 0}})});var xe=/^(?:textarea|input|select)$/i,Ee=/^([^\.]*|)(?:\.(.+)|)$/,be=/(?:^|\s)hover(\.\S+|)\b/,Ae=/^key/,Re=/^(?:mouse|contextmenu)|click/,Pe=/^(?:focusinfocus|focusoutblur)$/,Ie=function(t){return q.event.special.hover?t:t.replace(be,"mouseenter$1 mouseleave$1")};q.event={add:function(t,i,n,r,o){var s,c,a,l,h,u,d,_,p;if(3!==t.nodeType&&8!==t.nodeType&&i&&n&&(s=q._data(t))){for(n.handler&&(d=n,n=d.handler,o=d.selector),n.guid||(n.guid=q.guid++),(a=s.events)||(s.events=a={}),(c=s.handle)||(s.handle=c=function(t){return"undefined"==typeof q||t&&q.event.triggered===t.type?e:q.event.dispatch.apply(c.elem,arguments)},c.elem=t),i=q.trim(Ie(i)).split(" "),s=0;s<i.length;s++)l=Ee.exec(i[s])||[],h=l[1],u=(l[2]||"").split(".").sort(),p=q.event.special[h]||{},h=(o?p.delegateType:p.bindType)||h,p=q.event.special[h]||{},l=q.extend({type:h,origType:l[1],data:r,handler:n,guid:n.guid,selector:o,needsContext:o&&q.expr.match.needsContext.test(o),namespace:u.join(".")},d),_=a[h],_||(_=a[h]=[],_.delegateCount=0,p.setup&&!1!==p.setup.call(t,r,u,c)||(t.addEventListener?t.addEventListener(h,c,!1):t.attachEvent&&t.attachEvent("on"+h,c))),p.add&&(p.add.call(t,l),l.handler.guid||(l.handler.guid=n.guid)),o?_.splice(_.delegateCount++,0,l):_.push(l),q.event.global[h]=!0;t=null}},global:{},remove:function(t,e,i,n,r){var o,s,c,a,l,h,u,d,_,p,f=q.hasData(t)&&q._data(t);if(f&&(u=f.events)){for(e=q.trim(Ie(e||"")).split(" "),o=0;o<e.length;o++)if(s=Ee.exec(e[o])||[],c=a=s[1],s=s[2],c){for(d=q.event.special[c]||{},c=(n?d.delegateType:d.bindType)||c,_=u[c]||[],l=_.length,s=s?RegExp("(^|\\.)"+s.split(".").sort().join("\\.(?:.*\\.|)")+"(\\.|$)"):null,h=0;h<_.length;h++)p=_[h],!r&&a!==p.origType||i&&i.guid!==p.guid||s&&!s.test(p.namespace)||n&&!(n===p.selector||"**"===n&&p.selector)||(_.splice(h--,1),p.selector&&_.delegateCount--,!d.remove||d.remove.call(t,p));0===_.length&&l!==_.length&&((!d.teardown||!1===d.teardown.call(t,s,f.handle))&&q.removeEvent(t,c,f.handle),delete u[c])}else for(c in u)q.event.remove(t,c+e[o],i,n,!0);q.isEmptyObject(u)&&(delete f.handle,q.removeData(t,"events",!0))}},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(i,n,r,o){if(!r||3!==r.nodeType&&8!==r.nodeType){var s,c,a,l,h,u,d,_=i.type||i;if(l=[],!Pe.test(_+q.event.triggered)&&(0<=_.indexOf("!")&&(_=_.slice(0,-1),s=!0),0<=_.indexOf(".")&&(l=_.split("."),_=l.shift(),l.sort()),r&&!q.event.customEvent[_]||q.event.global[_]))if(i="object"==typeof i?i[q.expando]?i:new q.Event(_,i):new q.Event(_),i.type=_,i.isTrigger=!0,i.exclusive=s,i.namespace=l.join("."),i.namespace_re=i.namespace?RegExp("(^|\\.)"+l.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,l=0>_.indexOf(":")?"on"+_:"",r){if(i.result=e,i.target||(i.target=r),n=null!=n?q.makeArray(n):[],n.unshift(i),h=q.event.special[_]||{},!h.trigger||!1!==h.trigger.apply(r,n)){if(d=[[r,h.bindType||_]],!o&&!h.noBubble&&!q.isWindow(r)){for(c=h.delegateType||_,s=Pe.test(c+_)?r:r.parentNode,a=r;s;s=s.parentNode)d.push([s,c]),a=s;a===(r.ownerDocument||M)&&d.push([a.defaultView||a.parentWindow||t,c])}for(c=0;c<d.length&&!i.isPropagationStopped();c++)s=d[c][0],i.type=d[c][1],(u=(q._data(s,"events")||{})[i.type]&&q._data(s,"handle"))&&u.apply(s,n),(u=l&&s[l])&&q.acceptData(s)&&u.apply&&!1===u.apply(s,n)&&i.preventDefault();return i.type=_,!(o||i.isDefaultPrevented()||h._default&&!1!==h._default.apply(r.ownerDocument,n)||"click"===_&&q.nodeName(r,"a")||!q.acceptData(r)||!l||!r[_]||("focus"===_||"blur"===_)&&0===i.target.offsetWidth||q.isWindow(r)||(a=r[l],a&&(r[l]=null),q.event.triggered=_,r[_](),q.event.triggered=e,!a||!(r[l]=a))),i.result}}else for(c in r=q.cache)r[c].events&&r[c].events[_]&&q.event.trigger(i,n,r[c].handle.elem,!0)}},dispatch:function(i){i=q.event.fix(i||t.event);var n,r,o,s,c,a,l=(q._data(this,"events")||{})[i.type]||[],h=l.delegateCount,u=U.call(arguments),d=!i.exclusive&&!i.namespace,_=q.event.special[i.type]||{},p=[];if(u[0]=i,i.delegateTarget=this,!_.preDispatch||!1!==_.preDispatch.call(this,i)){if(h&&(!i.button||"click"!==i.type))for(r=i.target;r!=this;r=r.parentNode||this)if(!0!==r.disabled||"click"!==i.type){for(s={},c=[],n=0;h>n;n++)o=l[n],a=o.selector,s[a]===e&&(s[a]=o.needsContext?0<=q(a,this).index(r):q.find(a,this,null,[r]).length),s[a]&&c.push(o);c.length&&p.push({elem:r,matches:c})}for(l.length>h&&p.push({elem:this,matches:l.slice(h)}),n=0;n<p.length&&!i.isPropagationStopped();n++)for(s=p[n],i.currentTarget=s.elem,r=0;r<s.matches.length&&!i.isImmediatePropagationStopped();r++)o=s.matches[r],(d||!i.namespace&&!o.namespace||i.namespace_re&&i.namespace_re.test(o.namespace))&&(i.data=o.data,i.handleObj=o,o=((q.event.special[o.origType]||{}).handle||o.handler).apply(s.elem,u),o!==e&&(i.result=o,!1===o&&(i.preventDefault(),i.stopPropagation())));return _.postDispatch&&_.postDispatch.call(this,i),i.result}},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:["char","charCode","key","keyCode"],filter:function(t,e){return null==t.which&&(t.which=null!=e.charCode?e.charCode:e.keyCode),t}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(t,i){var n,r,o,s=i.button,c=i.fromElement;return null==t.pageX&&null!=i.clientX&&(n=t.target.ownerDocument||M,r=n.documentElement,o=n.body,t.pageX=i.clientX+(r&&r.scrollLeft||o&&o.scrollLeft||0)-(r&&r.clientLeft||o&&o.clientLeft||0),t.pageY=i.clientY+(r&&r.scrollTop||o&&o.scrollTop||0)-(r&&r.clientTop||o&&o.clientTop||0)),!t.relatedTarget&&c&&(t.relatedTarget=c===t.target?i.toElement:c),!t.which&&s!==e&&(t.which=1&s?1:2&s?3:4&s?2:0),t}},fix:function(t){if(t[q.expando])return t;var e,i,n=t,r=q.event.fixHooks[t.type]||{},o=r.props?this.props.concat(r.props):this.props;for(t=q.Event(n),e=o.length;e;)i=o[--e],t[i]=n[i];return t.target||(t.target=n.srcElement||M),3===t.target.nodeType&&(t.target=t.target.parentNode),t.metaKey=!!t.metaKey,r.filter?r.filter(t,n):t},special:{load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(t,e,i){q.isWindow(this)&&(this.onbeforeunload=i)},teardown:function(t,e){this.onbeforeunload===e&&(this.onbeforeunload=null)}}},simulate:function(t,e,i,n){t=q.extend(new q.Event,i,{type:t,isSimulated:!0,originalEvent:{}}),n?q.event.trigger(t,null,e):q.event.dispatch.call(e,t),t.isDefaultPrevented()&&i.preventDefault()}},q.event.handle=q.event.dispatch,q.removeEvent=M.removeEventListener?function(t,e,i){t.removeEventListener&&t.removeEventListener(e,i,!1)}:function(t,e,i){e="on"+e,t.detachEvent&&("undefined"==typeof t[e]&&(t[e]=null),t.detachEvent(e,i))},q.Event=function(t,e){return this instanceof q.Event?(t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented||!1===t.returnValue||t.getPreventDefault&&t.getPreventDefault()?s:o):this.type=t,e&&q.extend(this,e),this.timeStamp=t&&t.timeStamp||q.now(),void(this[q.expando]=!0)):new q.Event(t,e)},q.Event.prototype={preventDefault:function(){this.isDefaultPrevented=s;var t=this.originalEvent;t&&(t.preventDefault?t.preventDefault():t.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=s;var t=this.originalEvent;t&&(t.stopPropagation&&t.stopPropagation(),t.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=s,this.stopPropagation()},isDefaultPrevented:o,isPropagationStopped:o,isImmediatePropagationStopped:o},q.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(t,e){q.event.special[t]={delegateType:e,bindType:e,handle:function(t){var i,n=t.relatedTarget,r=t.handleObj;return(!n||n!==this&&!q.contains(this,n))&&(t.type=r.origType,i=r.handler.apply(this,arguments),t.type=e),i}}}),q.support.submitBubbles||(q.event.special.submit={setup:function(){return q.nodeName(this,"form")?!1:void q.event.add(this,"click._submit keypress._submit",function(t){t=t.target,(t=q.nodeName(t,"input")||q.nodeName(t,"button")?t.form:e)&&!q._data(t,"_submit_attached")&&(q.event.add(t,"submit._submit",function(t){t._submit_bubble=!0}),q._data(t,"_submit_attached",!0))})},postDispatch:function(t){t._submit_bubble&&(delete t._submit_bubble,this.parentNode&&!t.isTrigger&&q.event.simulate("submit",this.parentNode,t,!0))},teardown:function(){return q.nodeName(this,"form")?!1:void q.event.remove(this,"._submit")}}),q.support.changeBubbles||(q.event.special.change={setup:function(){return xe.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(q.event.add(this,"propertychange._change",function(t){"checked"===t.originalEvent.propertyName&&(this._just_changed=!0)}),q.event.add(this,"click._change",function(t){this._just_changed&&!t.isTrigger&&(this._just_changed=!1),q.event.simulate("change",this,t,!0)})),!1):void q.event.add(this,"beforeactivate._change",function(t){t=t.target,xe.test(t.nodeName)&&!q._data(t,"_change_attached")&&(q.event.add(t,"change._change",function(t){this.parentNode&&!t.isSimulated&&!t.isTrigger&&q.event.simulate("change",this.parentNode,t,!0)}),q._data(t,"_change_attached",!0))})},handle:function(t){var e=t.target;return this!==e||t.isSimulated||t.isTrigger||"radio"!==e.type&&"checkbox"!==e.type?t.handleObj.handler.apply(this,arguments):void 0},teardown:function(){return q.event.remove(this,"._change"),!xe.test(this.nodeName)}}),q.support.focusinBubbles||q.each({focus:"focusin",blur:"focusout"},function(t,e){var i=0,n=function(t){q.event.simulate(e,t.target,q.event.fix(t),!0)};q.event.special[e]={setup:function(){0===i++&&M.addEventListener(t,n,!0)},teardown:function(){0===--i&&M.removeEventListener(t,n,!0)}}}),q.fn.extend({on:function(t,i,n,r,s){var c,a;if("object"==typeof t){"string"!=typeof i&&(n=n||i,i=e);for(a in t)this.on(a,i,n,t[a],s);return this}if(null==n&&null==r?(r=i,n=i=e):null==r&&("string"==typeof i?(r=n,n=e):(r=n,n=i,i=e)),!1===r)r=o;else if(!r)return this;return 1===s&&(c=r,r=function(t){return q().off(t),c.apply(this,arguments)},r.guid=c.guid||(c.guid=q.guid++)),this.each(function(){q.event.add(this,t,r,n,i)})},one:function(t,e,i,n){return this.on(t,e,i,n,1)},off:function(t,i,n){var r,s;if(t&&t.preventDefault&&t.handleObj)return r=t.handleObj,q(t.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof t){for(s in t)this.off(s,i,t[s]);return this}return(!1===i||"function"==typeof i)&&(n=i,i=e),!1===n&&(n=o),this.each(function(){q.event.remove(this,t,n,i)})},bind:function(t,e,i){return this.on(t,null,e,i)},unbind:function(t,e){return this.off(t,null,e)},live:function(t,e,i){return q(this.context).on(t,this.selector,e,i),this},die:function(t,e){return q(this.context).off(t,this.selector||"**",e),this},delegate:function(t,e,i,n){return this.on(e,t,i,n)},undelegate:function(t,e,i){return 1===arguments.length?this.off(t,"**"):this.off(e,t||"**",i)},trigger:function(t,e){return this.each(function(){q.event.trigger(t,e,this)})},triggerHandler:function(t,e){return this[0]?q.event.trigger(t,e,this[0],!0):void 0},toggle:function(t){var e=arguments,i=t.guid||q.guid++,n=0,r=function(i){var r=(q._data(this,"lastToggle"+t.guid)||0)%n;return q._data(this,"lastToggle"+t.guid,r+1),i.preventDefault(),e[r].apply(this,arguments)||!1};for(r.guid=i;n<e.length;)e[n++].guid=i;return this.click(r)},hover:function(t,e){return this.mouseenter(t).mouseleave(e||t)}}),q.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(t,e){q.fn[e]=function(t,i){return null==i&&(i=t,t=null),0<arguments.length?this.on(e,null,t,i):this.trigger(e)},Ae.test(e)&&(q.event.fixHooks[e]=q.event.keyHooks),Re.test(e)&&(q.event.fixHooks[e]=q.event.mouseHooks)}),function(t,e){function i(t,e,i,n){i=i||[],e=e||I;var r,o,s,c,a=e.nodeType;if(!t||"string"!=typeof t)return i;if(1!==a&&9!==a)return[];if(s=S(e),!s&&!n&&(r=j.exec(t)))if(c=r[1]){if(9===a){if(o=e.getElementById(c),!o||!o.parentNode)return i;if(o.id===c)return i.push(o),i}else if(e.ownerDocument&&(o=e.ownerDocument.getElementById(c))&&C(e,o)&&o.id===c)return i.push(o),i}else{if(r[2])return N.apply(i,B.call(e.getElementsByTagName(t),0)),i;if((c=r[3])&&ne&&e.getElementsByClassName)return N.apply(i,B.call(e.getElementsByClassName(c),0)),i}return p(t.replace(U,"$1"),e,i,n,s)}function n(t){return function(e){return"input"===e.nodeName.toLowerCase()&&e.type===t}}function r(t){return function(e){var i=e.nodeName.toLowerCase();return("input"===i||"button"===i)&&e.type===t}}function o(t){return M(function(e){return e=+e,M(function(i,n){for(var r,o=t([],i.length,e),s=o.length;s--;)i[r=o[s]]&&(i[r]=!(n[r]=i[r]))})})}function s(t,e,i){if(t===e)return i;for(t=t.nextSibling;t;){if(t===e)return-1;t=t.nextSibling}return 1}function c(t,e){var n,r,o,s,c,a,l;if(c=W[R][t+" "])return e?0:c.slice(0);for(c=t,a=[],l=y.preFilter;c;){(!n||(r=Y.exec(c)))&&(r&&(c=c.slice(r[0].length)||c),a.push(o=[])),n=!1,(r=X.exec(c))&&(o.push(n=new P(r.shift())),c=c.slice(n.length),n.type=r[0].replace(U," "));for(s in y.filter)(r=$[s].exec(c))&&(!l[s]||(r=l[s](r)))&&(o.push(n=new P(r.shift())),c=c.slice(n.length),n.type=s,n.matches=r);if(!n)break}return e?c.length:c?i.error(t):W(t,a).slice(0)}function a(t,e,i){var n=e.dir,r=i&&"parentNode"===e.dir,o=D++;return e.first?function(e,i,o){for(;e=e[n];)if(r||1===e.nodeType)return t(e,i,o)}:function(e,i,s){if(s){for(;e=e[n];)if((r||1===e.nodeType)&&t(e,i,s))return e}else for(var c,a=L+" "+o+" ",l=a+m;e=e[n];)if(r||1===e.nodeType){if((c=e[R])===l)return e.sizset;if("string"==typeof c&&0===c.indexOf(a)){if(e.sizset)return e}else{if(e[R]=l,t(e,i,s))return e.sizset=!0,e;e.sizset=!1}}}}function l(t){return 1<t.length?function(e,i,n){for(var r=t.length;r--;)if(!t[r](e,i,n))return!1;return!0}:t[0]}function h(t,e,i,n,r){for(var o,s=[],c=0,a=t.length,l=null!=e;a>c;c++)(o=t[c])&&(!i||i(o,n,r))&&(s.push(o),l&&e.push(c));return s}function u(t,e,n,r,o,s){return r&&!r[R]&&(r=u(r)),o&&!o[R]&&(o=u(o,s)),M(function(s,c,a,l){var u,d,_,p=[],f=[],m=c.length;if(!(_=s)){_=e||"*";for(var g=a.nodeType?[a]:a,y=[],T=0,S=g.length;S>T;T++)i(_,g[T],y);_=y}if(_=!t||!s&&e?_:h(_,p,t,a,l),g=n?o||(s?t:m||r)?[]:c:_,n&&n(_,g,a,l),r)for(u=h(g,f),r(u,[],a,l),a=u.length;a--;)(d=u[a])&&(g[f[a]]=!(_[f[a]]=d));if(s){if(o||t){if(o){for(u=[],a=g.length;a--;)(d=g[a])&&u.push(_[a]=d);o(null,g=[],u,l)}for(a=g.length;a--;)(d=g[a])&&-1<(u=o?F.call(s,d):p[a])&&(s[u]=!(c[u]=d))}}else g=h(g===c?g.splice(m,g.length):g),o?o(null,c,g,l):N.apply(c,g)})}function d(t){var e,i,n,r=t.length,o=y.relative[t[0].type];i=o||y.relative[" "];for(var s=o?1:0,c=a(function(t){return t===e},i,!0),h=a(function(t){return-1<F.call(e,t)},i,!0),_=[function(t,i,n){return!o&&(n||i!==b)||((e=i).nodeType?c(t,i,n):h(t,i,n))}];r>s;s++)if(i=y.relative[t[s].type])_=[a(l(_),i)];else{if(i=y.filter[t[s].type].apply(null,t[s].matches),i[R]){for(n=++s;r>n&&!y.relative[t[n].type];n++);return u(s>1&&l(_),s>1&&t.slice(0,s-1).join("").replace(U,"$1"),i,n>s&&d(t.slice(s,n)),r>n&&d(t=t.slice(n)),r>n&&t.join(""))}_.push(i)}return l(_)}function _(t,e){var n=0<e.length,r=0<t.length,o=function(s,c,a,l,u){var d,_,p=[],f=0,g="0",T=s&&[],S=null!=u,C=b,v=s||r&&y.find.TAG("*",u&&c.parentNode||c),x=L+=null==C?1:Math.E;for(S&&(b=c!==I&&c,m=o.el);null!=(u=v[g]);g++){if(r&&u){for(d=0;_=t[d];d++)if(_(u,c,a)){l.push(u);break}S&&(L=x,m=++o.el)}n&&((u=!_&&u)&&f--,s&&T.push(u))}if(f+=g,n&&g!==f){for(d=0;_=e[d];d++)_(T,p,c,a);if(s){if(f>0)for(;g--;)T[g]||p[g]||(p[g]=O.call(l));p=h(p)}N.apply(l,p),S&&!s&&0<p.length&&1<f+e.length&&i.uniqueSort(l)}return S&&(L=x,b=C),T};return o.el=0,n?M(o):o}function p(t,e,i,n,r){var o,s,a,l,h=c(t);if(!n&&1===h.length){if(s=h[0]=h[0].slice(0),2<s.length&&"ID"===(a=s[0]).type&&9===e.nodeType&&!r&&y.relative[s[1].type]){if(e=y.find.ID(a.matches[0].replace(K,""),e,r)[0],!e)return i;t=t.slice(s.shift().length)}for(o=$.POS.test(t)?-1:s.length-1;o>=0&&(a=s[o],!y.relative[l=a.type]);o--)if((l=y.find[l])&&(n=l(a.matches[0].replace(K,""),J.test(s[0].type)&&e.parentNode||e,r))){if(s.splice(o,1),t=n.length&&s.join(""),!t)return N.apply(i,B.call(n,0)),i;break}}return v(t,h)(n,e,r,i,J.test(t)),i}function f(){}var m,g,y,T,S,C,v,x,E,b,A=!0,R=("sizcache"+Math.random()).replace(".",""),P=String,I=t.document,w=I.documentElement,L=0,D=0,O=[].pop,N=[].push,B=[].slice,F=[].indexOf||function(t){for(var e=0,i=this.length;i>e;e++)if(this[e]===t)return e;return-1},M=function(t,e){return t[R]=null==e||e,t},V=function(){var t={},e=[];return M(function(i,n){return e.push(i)>y.cacheLength&&delete t[e.shift()],t[i+" "]=n},t)},k=V(),W=V(),G=V(),V="\\[[\\x20\\t\\r\\n\\f]*((?:\\\\.|[-\\w]|[^\\x00-\\xa0])+)[\\x20\\t\\r\\n\\f]*(?:([*^$|!~]?=)[\\x20\\t\\r\\n\\f]*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+"(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+".replace("w","w#")+")|)|)[\\x20\\t\\r\\n\\f]*\\]",z=":((?:\\\\.|[-\\w]|[^\\x00-\\xa0])+)(?:\\((?:(['\"])((?:\\\\.|[^\\\\])*?)\\2|([^()[\\]]*|(?:(?:"+V+")|[^:]|\\\\.)*|.*))\\)|)",U=/^[\x20\t\r\n\f]+|((?:^|[^\\])(?:\\.)*)[\x20\t\r\n\f]+$/g,Y=/^[\x20\t\r\n\f]*,[\x20\t\r\n\f]*/,X=/^[\x20\t\r\n\f]*([\x20\t\r\n\f>+~])[\x20\t\r\n\f]*/,H=RegExp(z),j=/^(?:#([\w\-]+)|(\w+)|\.([\w\-]+))$/,J=/[\x20\t\r\n\f]*[+~]/,Z=/h\d/i,Q=/input|select|textarea|button/i,K=/\\(?!\\)/g,$={ID:/^#((?:\\.|[-\w]|[^\x00-\xa0])+)/,CLASS:/^\.((?:\\.|[-\w]|[^\x00-\xa0])+)/,NAME:/^\[name=['"]?((?:\\.|[-\w]|[^\x00-\xa0])+)['"]?\]/,TAG:RegExp("^("+"(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+".replace("w","w*")+")"),ATTR:RegExp("^"+V),PSEUDO:RegExp("^"+z),POS:/:(even|odd|eq|gt|lt|nth|first|last)(?:\([\x20\t\r\n\f]*((?:-\d)?\d*)[\x20\t\r\n\f]*\)|)(?=[^-]|$)/i,CHILD:RegExp("^:(only|nth|first|last)-child(?:\\([\\x20\\t\\r\\n\\f]*(even|odd|(([+-]|)(\\d*)n|)[\\x20\\t\\r\\n\\f]*(?:([+-]|)[\\x20\\t\\r\\n\\f]*(\\d+)|))[\\x20\\t\\r\\n\\f]*\\)|)","i"),needsContext:RegExp("^[\\x20\\t\\r\\n\\f]*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\([\\x20\\t\\r\\n\\f]*((?:-\\d)?\\d*)[\\x20\\t\\r\\n\\f]*\\)|)(?=[^-]|$)","i")},te=function(t){var e=I.createElement("div");try{return t(e)}catch(i){return!1}finally{}},V=te(function(t){return t.appendChild(I.createComment("")),!t.getElementsByTagName("*").length}),ee=te(function(t){return t.innerHTML="<a href='#'></a>",t.firstChild&&"undefined"!=typeof t.firstChild.getAttribute&&"#"===t.firstChild.getAttribute("href")}),ie=te(function(t){return t.innerHTML="<select></select>",t=typeof t.lastChild.getAttribute("multiple"),"boolean"!==t&&"string"!==t}),ne=te(function(t){return t.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",t.getElementsByClassName&&t.getElementsByClassName("e").length?(t.lastChild.className="e",2===t.getElementsByClassName("e").length):!1}),re=te(function(t){t.id=R+0,t.innerHTML="<a name='"+R+"'></a><div name='"+R+"'></div>",w.insertBefore(t,w.firstChild);var e=I.getElementsByName&&I.getElementsByName(R).length===2+I.getElementsByName(R+0).length;return g=!I.getElementById(R),w.removeChild(t),e});try{B.call(w.childNodes,0)[0].nodeType}catch(oe){B=function(t){for(var e,i=[];e=this[t];t++)i.push(e);return i}}i.matches=function(t,e){return i(t,null,null,e)},i.matchesSelector=function(t,e){return 0<i(e,null,null,[t]).length},T=i.getText=function(t){var e,i="",n=0;if(e=t.nodeType){if(1===e||9===e||11===e){if("string"==typeof t.textContent)return t.textContent;for(t=t.firstChild;t;t=t.nextSibling)i+=T(t)}else if(3===e||4===e)return t.nodeValue}else for(;e=t[n];n++)i+=T(e);return i},S=i.isXML=function(t){return(t=t&&(t.ownerDocument||t).documentElement)?"HTML"!==t.nodeName:!1},C=i.contains=w.contains?function(t,e){var i=9===t.nodeType?t.documentElement:t,n=e&&e.parentNode;return t===n||!!(n&&1===n.nodeType&&i.contains&&i.contains(n))}:w.compareDocumentPosition?function(t,e){return e&&!!(16&t.compareDocumentPosition(e))}:function(t,e){for(;e=e.parentNode;)if(e===t)return!0;return!1},i.attr=function(t,e){var i,n=S(t);return n||(e=e.toLowerCase()),(i=y.attrHandle[e])?i(t):n||ie?t.getAttribute(e):(i=t.getAttributeNode(e),i?"boolean"==typeof t[e]?t[e]?e:null:i.specified?i.value:null:null)},y=i.selectors={cacheLength:50,createPseudo:M,match:$,attrHandle:ee?{}:{href:function(t){return t.getAttribute("href",2)},type:function(t){return t.getAttribute("type")}},find:{ID:g?function(t,e,i){return"undefined"==typeof e.getElementById||i?void 0:(t=e.getElementById(t))&&t.parentNode?[t]:[]}:function(t,i,n){return"undefined"==typeof i.getElementById||n?void 0:(i=i.getElementById(t))?i.id===t||"undefined"!=typeof i.getAttributeNode&&i.getAttributeNode("id").value===t?[i]:e:[]},TAG:V?function(t,e){return"undefined"!=typeof e.getElementsByTagName?e.getElementsByTagName(t):void 0}:function(t,e){var i=e.getElementsByTagName(t);if("*"===t){for(var n,r=[],o=0;n=i[o];o++)1===n.nodeType&&r.push(n);return r}return i},NAME:re&&function(t,e){return"undefined"!=typeof e.getElementsByName?e.getElementsByName(name):void 0},CLASS:ne&&function(t,e,i){return"undefined"==typeof e.getElementsByClassName||i?void 0:e.getElementsByClassName(t)}},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(t){return t[1]=t[1].replace(K,""),t[3]=(t[4]||t[5]||"").replace(K,""),"~="===t[2]&&(t[3]=" "+t[3]+" "),t.slice(0,4)},CHILD:function(t){return t[1]=t[1].toLowerCase(),"nth"===t[1]?(t[2]||i.error(t[0]),t[3]=+(t[3]?t[4]+(t[5]||1):2*("even"===t[2]||"odd"===t[2])),t[4]=+(t[6]+t[7]||"odd"===t[2])):t[2]&&i.error(t[0]),t},PSEUDO:function(t){var e,i;return $.CHILD.test(t[0])?null:(t[3]?t[2]=t[3]:(e=t[4])&&(H.test(e)&&(i=c(e,!0))&&(i=e.indexOf(")",e.length-i)-e.length)&&(e=e.slice(0,i),t[0]=t[0].slice(0,i)),t[2]=e),t.slice(0,3))}},filter:{ID:g?function(t){return t=t.replace(K,""),function(e){return e.getAttribute("id")===t}}:function(t){return t=t.replace(K,""),function(e){return(e="undefined"!=typeof e.getAttributeNode&&e.getAttributeNode("id"))&&e.value===t}},TAG:function(t){return"*"===t?function(){return!0}:(t=t.replace(K,"").toLowerCase(),function(e){return e.nodeName&&e.nodeName.toLowerCase()===t})},CLASS:function(t){var e=k[R][t+" "];return e||(e=RegExp("(^|[\\x20\\t\\r\\n\\f])"+t+"([\\x20\\t\\r\\n\\f]|$)"))&&k(t,function(t){return e.test(t.className||"undefined"!=typeof t.getAttribute&&t.getAttribute("class")||"")})},ATTR:function(t,e,n){return function(r){var o=i.attr(r,t);return null==o?"!="===e:e?(o+="","="===e?o===n:"!="===e?o!==n:"^="===e?n&&0===o.indexOf(n):"*="===e?n&&-1<o.indexOf(n):"$="===e?n&&o.substr(o.length-n.length)===n:"~="===e?-1<(" "+o+" ").indexOf(n):"|="===e?o===n||o.substr(0,n.length+1)===n+"-":!1):!0}},CHILD:function(t,e,i,n){return"nth"===t?function(t){var e,r;if(e=t.parentNode,1===i&&0===n)return!0;if(e)for(r=0,e=e.firstChild;e&&(1!==e.nodeType||(r++,t!==e));e=e.nextSibling);return r-=n,r===i||0===r%i&&r/i>=0}:function(e){var i=e;switch(t){case"only":case"first":for(;i=i.previousSibling;)if(1===i.nodeType)return!1;if("first"===t)return!0;i=e;case"last":for(;i=i.nextSibling;)if(1===i.nodeType)return!1;return!0}}},PSEUDO:function(t,e){var n,r=y.pseudos[t]||y.setFilters[t.toLowerCase()]||i.error("unsupported pseudo: "+t);return r[R]?r(e):1<r.length?(n=[t,t,"",e],y.setFilters.hasOwnProperty(t.toLowerCase())?M(function(t,i){for(var n,o=r(t,e),s=o.length;s--;)n=F.call(t,o[s]),t[n]=!(i[n]=o[s])}):function(t){return r(t,0,n)}):r}},pseudos:{not:M(function(t){var e=[],i=[],n=v(t.replace(U,"$1"));return n[R]?M(function(t,e,i,r){r=n(t,null,r,[]);for(var o=t.length;o--;)(i=r[o])&&(t[o]=!(e[o]=i))}):function(t,r,o){return e[0]=t,n(e,null,o,i),!i.pop()}}),has:M(function(t){return function(e){return 0<i(t,e).length
}}),contains:M(function(t){return function(e){return-1<(e.textContent||e.innerText||T(e)).indexOf(t)}}),enabled:function(t){return!1===t.disabled},disabled:function(t){return!0===t.disabled},checked:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&!!t.checked||"option"===e&&!!t.selected},selected:function(t){return t.parentNode&&t.parentNode.selectedIndex,!0===t.selected},parent:function(t){return!y.pseudos.empty(t)},empty:function(t){var e;for(t=t.firstChild;t;){if("@"<t.nodeName||3===(e=t.nodeType)||4===e)return!1;t=t.nextSibling}return!0},header:function(t){return Z.test(t.nodeName)},text:function(t){var e,i;return"input"===t.nodeName.toLowerCase()&&"text"===(e=t.type)&&(null==(i=t.getAttribute("type"))||i.toLowerCase()===e)},radio:n("radio"),checkbox:n("checkbox"),file:n("file"),password:n("password"),image:n("image"),submit:r("submit"),reset:r("reset"),button:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&"button"===t.type||"button"===e},input:function(t){return Q.test(t.nodeName)},focus:function(t){var e=t.ownerDocument;return t===e.activeElement&&(!e.hasFocus||e.hasFocus())&&!!(t.type||t.href||~t.tabIndex)},active:function(t){return t===t.ownerDocument.activeElement},first:o(function(){return[0]}),last:o(function(t,e){return[e-1]}),eq:o(function(t,e,i){return[0>i?i+e:i]}),even:o(function(t,e){for(var i=0;e>i;i+=2)t.push(i);return t}),odd:o(function(t,e){for(var i=1;e>i;i+=2)t.push(i);return t}),lt:o(function(t,e,i){for(e=0>i?i+e:i;0<=--e;)t.push(e);return t}),gt:o(function(t,e,i){for(i=0>i?i+e:i;++i<e;)t.push(i);return t})}},x=w.compareDocumentPosition?function(t,e){return t===e?(E=!0,0):(t.compareDocumentPosition&&e.compareDocumentPosition?4&t.compareDocumentPosition(e):t.compareDocumentPosition)?-1:1}:function(t,e){if(t===e)return E=!0,0;if(t.sourceIndex&&e.sourceIndex)return t.sourceIndex-e.sourceIndex;var i,n,r=[],o=[];i=t.parentNode,n=e.parentNode;var c=i;if(i===n)return s(t,e);if(!i)return-1;if(!n)return 1;for(;c;)r.unshift(c),c=c.parentNode;for(c=n;c;)o.unshift(c),c=c.parentNode;for(i=r.length,n=o.length,c=0;i>c&&n>c;c++)if(r[c]!==o[c])return s(r[c],o[c]);return c===i?s(t,o[c],-1):s(r[c],e,1)},[0,0].sort(x),A=!E,i.uniqueSort=function(t){var e,i=[],n=1,r=0;if(E=A,t.sort(x),E){for(;e=t[n];n++)e===t[n-1]&&(r=i.push(n));for(;r--;)t.splice(i[r],1)}return t},i.error=function(t){throw Error("Syntax error, unrecognized expression: "+t)},v=i.compile=function(t,e){var i,n=[],r=[],o=G[R][t+" "];if(!o){for(e||(e=c(t)),i=e.length;i--;)o=d(e[i]),o[R]?n.push(o):r.push(o);o=G(t,_(r,n))}return o},I.querySelectorAll&&function(){var t,e=p,n=/'|\\/g,r=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,o=[":focus"],s=[":active"],a=w.matchesSelector||w.mozMatchesSelector||w.webkitMatchesSelector||w.oMatchesSelector||w.msMatchesSelector;te(function(t){t.innerHTML="<select><option selected=''></option></select>",t.querySelectorAll("[selected]").length||o.push("\\[[\\x20\\t\\r\\n\\f]*(?:checked|disabled|ismap|multiple|readonly|selected|value)"),t.querySelectorAll(":checked").length||o.push(":checked")}),te(function(t){t.innerHTML="<p test=''></p>",t.querySelectorAll("[test^='']").length&&o.push("[*^$]=[\\x20\\t\\r\\n\\f]*(?:\"\"|'')"),t.innerHTML="<input type='hidden'/>",t.querySelectorAll(":enabled").length||o.push(":enabled",":disabled")}),o=RegExp(o.join("|")),p=function(t,i,r,s,a){if(!s&&!a&&!o.test(t)){var l,h,u=!0,d=R;if(h=i,l=9===i.nodeType&&t,1===i.nodeType&&"object"!==i.nodeName.toLowerCase()){for(l=c(t),(u=i.getAttribute("id"))?d=u.replace(n,"\\$&"):i.setAttribute("id",d),d="[id='"+d+"'] ",h=l.length;h--;)l[h]=d+l[h].join("");h=J.test(t)&&i.parentNode||i,l=l.join(",")}if(l)try{return N.apply(r,B.call(h.querySelectorAll(l),0)),r}catch(_){}finally{u||i.removeAttribute("id")}}return e(t,i,r,s,a)},a&&(te(function(e){t=a.call(e,"div");try{a.call(e,"[test!='']:sizzle"),s.push("!=",z)}catch(i){}}),s=RegExp(s.join("|")),i.matchesSelector=function(e,n){if(n=n.replace(r,"='$1']"),!S(e)&&!s.test(n)&&!o.test(n))try{var c=a.call(e,n);if(c||t||e.document&&11!==e.document.nodeType)return c}catch(l){}return 0<i(n,null,null,[e]).length})}(),y.pseudos.nth=y.pseudos.eq,y.filters=f.prototype=y.pseudos,y.setFilters=new f,i.attr=q.attr,q.find=i,q.expr=i.selectors,q.expr[":"]=q.expr.pseudos,q.unique=i.uniqueSort,q.text=i.getText,q.isXMLDoc=i.isXML,q.contains=i.contains}(t);var we=/Until$/,Le=/^(?:parents|prev(?:Until|All))/,De=/^.[^:#\[\.,]*$/,Oe=q.expr.match.needsContext,Ne={children:!0,contents:!0,next:!0,prev:!0};q.fn.extend({find:function(t){var e,i,n,r,o,s,c=this;if("string"!=typeof t)return q(t).filter(function(){for(e=0,i=c.length;i>e;e++)if(q.contains(c[e],this))return!0});for(s=this.pushStack("","find",t),e=0,i=this.length;i>e;e++)if(n=s.length,q.find(t,this[e],s),e>0)for(r=n;r<s.length;r++)for(o=0;n>o;o++)if(s[o]===s[r]){s.splice(r--,1);break}return s},has:function(t){var e,i=q(t,this),n=i.length;return this.filter(function(){for(e=0;n>e;e++)if(q.contains(this,i[e]))return!0})},not:function(t){return this.pushStack(l(this,t,!1),"not",t)},filter:function(t){return this.pushStack(l(this,t,!0),"filter",t)},is:function(t){return!!t&&("string"==typeof t?Oe.test(t)?0<=q(t,this.context).index(this[0]):0<q.filter(t,this).length:0<this.filter(t).length)},closest:function(t,e){for(var i,n=0,r=this.length,o=[],s=Oe.test(t)||"string"!=typeof t?q(t,e||this.context):0;r>n;n++)for(i=this[n];i&&i.ownerDocument&&i!==e&&11!==i.nodeType;){if(s?-1<s.index(i):q.find.matchesSelector(i,t)){o.push(i);break}i=i.parentNode}return o=1<o.length?q.unique(o):o,this.pushStack(o,"closest",t)},index:function(t){return t?"string"==typeof t?q.inArray(this[0],q(t)):q.inArray(t.jquery?t[0]:t,this):this[0]&&this[0].parentNode?this.prevAll().length:-1},add:function(t,e){var i="string"==typeof t?q(t,e):q.makeArray(t&&t.nodeType?[t]:t),n=q.merge(this.get(),i);return this.pushStack(c(i[0])||c(n[0])?n:q.unique(n))},addBack:function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}}),q.fn.andSelf=q.fn.addBack,q.each({parent:function(t){return(t=t.parentNode)&&11!==t.nodeType?t:null},parents:function(t){return q.dir(t,"parentNode")},parentsUntil:function(t,e,i){return q.dir(t,"parentNode",i)},next:function(t){return a(t,"nextSibling")},prev:function(t){return a(t,"previousSibling")},nextAll:function(t){return q.dir(t,"nextSibling")},prevAll:function(t){return q.dir(t,"previousSibling")},nextUntil:function(t,e,i){return q.dir(t,"nextSibling",i)},prevUntil:function(t,e,i){return q.dir(t,"previousSibling",i)},siblings:function(t){return q.sibling((t.parentNode||{}).firstChild,t)},children:function(t){return q.sibling(t.firstChild)},contents:function(t){return q.nodeName(t,"iframe")?t.contentDocument||t.contentWindow.document:q.merge([],t.childNodes)}},function(t,e){q.fn[t]=function(i,n){var r=q.map(this,e,i);return we.test(t)||(n=i),n&&"string"==typeof n&&(r=q.filter(n,r)),r=1<this.length&&!Ne[t]?q.unique(r):r,1<this.length&&Le.test(t)&&(r=r.reverse()),this.pushStack(r,t,U.call(arguments).join(","))}}),q.extend({filter:function(t,e,i){return i&&(t=":not("+t+")"),1===e.length?q.find.matchesSelector(e[0],t)?[e[0]]:[]:q.find.matches(t,e)},dir:function(t,i,n){var r=[];for(t=t[i];t&&9!==t.nodeType&&(n===e||1!==t.nodeType||!q(t).is(n));)1===t.nodeType&&r.push(t),t=t[i];return r},sibling:function(t,e){for(var i=[];t;t=t.nextSibling)1===t.nodeType&&t!==e&&i.push(t);return i}});var Be="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",Fe=/ jQuery\d+="(?:null|\d+)"/g,Me=/^\s+/,Ve=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,ke=/<([\w:]+)/,We=/<tbody/i,Ge=/<|&#?\w+;/,ze=/<(?:script|style|link)/i,Ue=/<(?:script|object|embed|option|style)/i,Ye=RegExp("<(?:"+Be+")[\\s/>]","i"),Xe=/^(?:checkbox|radio)$/,He=/checked\s*(?:[^=]|=\s*.checked.)/i,je=/\/(java|ecma)script/i,qe=/^\s*<!(?:\[CDATA\[|\-\-)|[\]\-]{2}>\s*$/g,Je={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},Ze=h(M),Qe=Ze.appendChild(M.createElement("div"));Je.optgroup=Je.option,Je.tbody=Je.tfoot=Je.colgroup=Je.caption=Je.thead,Je.th=Je.td,q.support.htmlSerialize||(Je._default=[1,"X<div>","</div>"]),q.fn.extend({text:function(t){return q.access(this,function(t){return t===e?q.text(this):this.empty().append((this[0]&&this[0].ownerDocument||M).createTextNode(t))},null,t,arguments.length)},wrapAll:function(t){if(q.isFunction(t))return this.each(function(e){q(this).wrapAll(t.call(this,e))});if(this[0]){var e=q(t,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&e.insertBefore(this[0]),e.map(function(){for(var t=this;t.firstChild&&1===t.firstChild.nodeType;)t=t.firstChild;return t}).append(this)}return this},wrapInner:function(t){return this.each(q.isFunction(t)?function(e){q(this).wrapInner(t.call(this,e))}:function(){var e=q(this),i=e.contents();i.length?i.wrapAll(t):e.append(t)})},wrap:function(t){var e=q.isFunction(t);return this.each(function(i){q(this).wrapAll(e?t.call(this,i):t)})},unwrap:function(){return this.parent().each(function(){q.nodeName(this,"body")||q(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(t){1!==this.nodeType&&11!==this.nodeType||this.appendChild(t)})},prepend:function(){return this.domManip(arguments,!0,function(t){1!==this.nodeType&&11!==this.nodeType||this.insertBefore(t,this.firstChild)})},before:function(){if(!c(this[0]))return this.domManip(arguments,!1,function(t){this.parentNode.insertBefore(t,this)});if(arguments.length){var t=q.clean(arguments);return this.pushStack(q.merge(t,this),"before",this.selector)}},after:function(){if(!c(this[0]))return this.domManip(arguments,!1,function(t){this.parentNode.insertBefore(t,this.nextSibling)});if(arguments.length){var t=q.clean(arguments);return this.pushStack(q.merge(this,t),"after",this.selector)}},remove:function(t,e){for(var i,n=0;null!=(i=this[n]);n++)(!t||q.filter(t,[i]).length)&&(!e&&1===i.nodeType&&(q.cleanData(i.getElementsByTagName("*")),q.cleanData([i])),i.parentNode&&i.parentNode.removeChild(i));return this},empty:function(){for(var t,e=0;null!=(t=this[e]);e++)for(1===t.nodeType&&q.cleanData(t.getElementsByTagName("*"));t.firstChild;)t.removeChild(t.firstChild);return this},clone:function(t,e){return t=null==t?!1:t,e=null==e?t:e,this.map(function(){return q.clone(this,t,e)})},html:function(t){return q.access(this,function(t){var i=this[0]||{},n=0,r=this.length;if(t===e)return 1===i.nodeType?i.innerHTML.replace(Fe,""):e;if("string"==typeof t&&!(ze.test(t)||!q.support.htmlSerialize&&Ye.test(t)||!q.support.leadingWhitespace&&Me.test(t)||Je[(ke.exec(t)||["",""])[1].toLowerCase()])){t=t.replace(Ve,"<$1></$2>");try{for(;r>n;n++)i=this[n]||{},1===i.nodeType&&(q.cleanData(i.getElementsByTagName("*")),i.innerHTML=t);i=0}catch(o){}}i&&this.empty().append(t)},null,t,arguments.length)},replaceWith:function(t){return c(this[0])?this.length?this.pushStack(q(q.isFunction(t)?t():t),"replaceWith",t):this:q.isFunction(t)?this.each(function(e){var i=q(this),n=i.html();i.replaceWith(t.call(this,e,n))}):("string"!=typeof t&&(t=q(t).detach()),this.each(function(){var e=this.nextSibling,i=this.parentNode;q(this).remove(),e?q(e).before(t):q(i).append(t)}))},detach:function(t){return this.remove(t,!0)},domManip:function(t,i,n){t=[].concat.apply([],t);var r,o,s,c=0,a=t[0],l=[],h=this.length;if(!q.support.checkClone&&h>1&&"string"==typeof a&&He.test(a))return this.each(function(){q(this).domManip(t,i,n)});if(q.isFunction(a))return this.each(function(r){var o=q(this);t[0]=a.call(this,r,i?o.html():e),o.domManip(t,i,n)});if(this[0]){if(r=q.buildFragment(t,this,l),s=r.fragment,o=s.firstChild,1===s.childNodes.length&&(s=o),o)for(i=i&&q.nodeName(o,"tr"),r=r.cacheable||h-1;h>c;c++)n.call(i&&q.nodeName(this[c],"table")?u(this[c],"tbody"):this[c],c===r?s:q.clone(s,!0,!0));s=o=null,l.length&&q.each(l,function(t,e){e.src?q.ajax?q.ajax({url:e.src,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0}):q.error("no ajax"):q.globalEval((e.text||e.textContent||e.innerHTML||"").replace(qe,"")),e.parentNode&&e.parentNode.removeChild(e)})}return this}}),q.buildFragment=function(t,i,n){var r,o,s,c=t[0];return i=i||M,i=!i.nodeType&&i[0]||i,i=i.ownerDocument||i,1===t.length&&"string"==typeof c&&512>c.length&&i===M&&"<"===c.charAt(0)&&!Ue.test(c)&&(q.support.checkClone||!He.test(c))&&(q.support.html5Clone||!Ye.test(c))&&(o=!0,r=q.fragments[c],s=r!==e),r||(r=i.createDocumentFragment(),q.clean(t,i,r,n),o&&(q.fragments[c]=s&&r)),{fragment:r,cacheable:o}},q.fragments={},q.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(t,e){q.fn[t]=function(i){var n,r=0,o=[];i=q(i);var s=i.length;if(n=1===this.length&&this[0].parentNode,(null==n||n&&11===n.nodeType&&1===n.childNodes.length)&&1===s)return i[e](this[0]),this;for(;s>r;r++)n=(r>0?this.clone(!0):this).get(),q(i[r])[e](n),o=o.concat(n);return this.pushStack(o,t,i.selector)}}),q.extend({clone:function(t,e,i){var n,r,o,s;if(q.support.html5Clone||q.isXMLDoc(t)||!Ye.test("<"+t.nodeName+">")?s=t.cloneNode(!0):(Qe.innerHTML=t.outerHTML,Qe.removeChild(s=Qe.firstChild)),!(q.support.noCloneEvent&&q.support.noCloneChecked||1!==t.nodeType&&11!==t.nodeType||q.isXMLDoc(t)))for(_(t,s),n=p(t),r=p(s),o=0;n[o];++o)r[o]&&_(n[o],r[o]);if(e&&(d(t,s),i))for(n=p(t),r=p(s),o=0;n[o];++o)d(n[o],r[o]);return s},clean:function(t,e,i,n){var r,o,s,c,a,l,u,d=e===M&&Ze,_=[];for(e&&"undefined"!=typeof e.createDocumentFragment||(e=M),r=0;null!=(s=t[r]);r++)if("number"==typeof s&&(s+=""),s){if("string"==typeof s)if(Ge.test(s)){for(d=d||h(e),l=e.createElement("div"),d.appendChild(l),s=s.replace(Ve,"<$1></$2>"),o=(ke.exec(s)||["",""])[1].toLowerCase(),c=Je[o]||Je._default,a=c[0],l.innerHTML=c[1]+s+c[2];a--;)l=l.lastChild;if(!q.support.tbody)for(a=We.test(s),c="table"!==o||a?"<table>"!==c[1]||a?[]:l.childNodes:l.firstChild&&l.firstChild.childNodes,o=c.length-1;o>=0;--o)q.nodeName(c[o],"tbody")&&!c[o].childNodes.length&&c[o].parentNode.removeChild(c[o]);!q.support.leadingWhitespace&&Me.test(s)&&l.insertBefore(e.createTextNode(Me.exec(s)[0]),l.firstChild),s=l.childNodes,l.parentNode.removeChild(l)}else s=e.createTextNode(s);s.nodeType?_.push(s):q.merge(_,s)}if(l&&(s=l=d=null),!q.support.appendChecked)for(r=0;null!=(s=_[r]);r++)q.nodeName(s,"input")?f(s):"undefined"!=typeof s.getElementsByTagName&&q.grep(s.getElementsByTagName("input"),f);if(i)for(t=function(t){return!t.type||je.test(t.type)?n?n.push(t.parentNode?t.parentNode.removeChild(t):t):i.appendChild(t):void 0},r=0;null!=(s=_[r]);r++)q.nodeName(s,"script")&&t(s)||(i.appendChild(s),"undefined"!=typeof s.getElementsByTagName&&(u=q.grep(q.merge([],s.getElementsByTagName("script")),t),_.splice.apply(_,[r+1,0].concat(u)),r+=u.length));return _},cleanData:function(t,e){for(var i,n,r,o,s=0,c=q.expando,a=q.cache,l=q.support.deleteExpando,h=q.event.special;null!=(r=t[s]);s++)if((e||q.acceptData(r))&&(i=(n=r[c])&&a[n])){if(i.events)for(o in i.events)h[o]?q.event.remove(r,o):q.removeEvent(r,o,i.handle);a[n]&&(delete a[n],l?delete r[c]:r.removeAttribute?r.removeAttribute(c):r[c]=null,q.deletedIds.push(n))}}}),function(){var t,e;q.uaMatch=function(t){return t=t.toLowerCase(),t=/(chrome)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||0>t.indexOf("compatible")&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(t)||[],{browser:t[1]||"",version:t[2]||"0"}},t=q.uaMatch(k.userAgent),e={},t.browser&&(e[t.browser]=!0,e.version=t.version),e.chrome?e.webkit=!0:e.webkit&&(e.safari=!0),q.browser=e,q.sub=function(){function t(e,i){return new t.fn.init(e,i)}q.extend(!0,t,this),t.superclass=this,t.fn=t.prototype=this(),t.fn.constructor=t,t.sub=this.sub,t.fn.init=function(i,n){return n&&n instanceof q&&!(n instanceof t)&&(n=t(n)),q.fn.init.call(this,i,n,e)},t.fn.init.prototype=t.fn;var e=t(M);return t}}();var Ke,$e,ti,ei=/alpha\([^)]*\)/i,ii=/opacity=([^)]*)/,ni=/^(top|right|bottom|left)$/,ri=/^(none|table(?!-c[ea]).+)/,oi=/^margin/,si=RegExp("^("+J+")(.*)$","i"),ci=RegExp("^("+J+")(?!px)[a-z%]+$","i"),ai=RegExp("^([-+])=("+J+")","i"),li={BODY:"block"},hi={position:"absolute",visibility:"hidden",display:"block"},ui={letterSpacing:0,fontWeight:400},di=["Top","Right","Bottom","Left"],_i=["Webkit","O","Moz","ms"],pi=q.fn.toggle;q.fn.extend({css:function(t,i){return q.access(this,function(t,i,n){return n!==e?q.style(t,i,n):q.css(t,i)},t,i,1<arguments.length)},show:function(){return y(this,!0)},hide:function(){return y(this)},toggle:function(t,e){var i="boolean"==typeof t;return q.isFunction(t)&&q.isFunction(e)?pi.apply(this,arguments):this.each(function(){(i?t:g(this))?q(this).show():q(this).hide()})}}),q.extend({cssHooks:{opacity:{get:function(t,e){if(e){var i=Ke(t,"opacity");return""===i?"1":i}}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":q.support.cssFloat?"cssFloat":"styleFloat"},style:function(t,i,n,r){if(t&&3!==t.nodeType&&8!==t.nodeType&&t.style){var o,s,c,a=q.camelCase(i),l=t.style;if(i=q.cssProps[a]||(q.cssProps[a]=m(l,a)),c=q.cssHooks[i]||q.cssHooks[a],n===e)return c&&"get"in c&&(o=c.get(t,!1,r))!==e?o:l[i];if(s=typeof n,"string"===s&&(o=ai.exec(n))&&(n=(o[1]+1)*o[2]+parseFloat(q.css(t,i)),s="number"),!(null==n||"number"===s&&isNaN(n)||("number"===s&&!q.cssNumber[a]&&(n+="px"),c&&"set"in c&&(n=c.set(t,n,r))===e)))try{l[i]=n}catch(h){}}},css:function(t,i,n,r){var o,s,c,a=q.camelCase(i);return i=q.cssProps[a]||(q.cssProps[a]=m(t.style,a)),c=q.cssHooks[i]||q.cssHooks[a],c&&"get"in c&&(o=c.get(t,!0,r)),o===e&&(o=Ke(t,i)),"normal"===o&&i in ui&&(o=ui[i]),n||r!==e?(s=parseFloat(o),n||q.isNumeric(s)?s||0:o):o},swap:function(t,e,i){var n,r={};for(n in e)r[n]=t.style[n],t.style[n]=e[n];i=i.call(t);for(n in e)t.style[n]=r[n];return i}}),t.getComputedStyle?Ke=function(e,i){var n,r,o,s,c=t.getComputedStyle(e,null),a=e.style;return c&&(n=c.getPropertyValue(i)||c[i],""===n&&!q.contains(e.ownerDocument,e)&&(n=q.style(e,i)),ci.test(n)&&oi.test(i)&&(r=a.width,o=a.minWidth,s=a.maxWidth,a.minWidth=a.maxWidth=a.width=n,n=c.width,a.width=r,a.minWidth=o,a.maxWidth=s)),n}:M.documentElement.currentStyle&&(Ke=function(t,e){var i,n,r=t.currentStyle&&t.currentStyle[e],o=t.style;return null==r&&o&&o[e]&&(r=o[e]),ci.test(r)&&!ni.test(e)&&(i=o.left,n=t.runtimeStyle&&t.runtimeStyle.left,n&&(t.runtimeStyle.left=t.currentStyle.left),o.left="fontSize"===e?"1em":r,r=o.pixelLeft+"px",o.left=i,n&&(t.runtimeStyle.left=n)),""===r?"auto":r}),q.each(["height","width"],function(t,e){q.cssHooks[e]={get:function(t,i,n){return i?0===t.offsetWidth&&ri.test(Ke(t,"display"))?q.swap(t,hi,function(){return C(t,e,n)}):C(t,e,n):void 0},set:function(t,i,n){return T(t,i,n?S(t,e,n,q.support.boxSizing&&"border-box"===q.css(t,"boxSizing")):0)}}}),q.support.opacity||(q.cssHooks.opacity={get:function(t,e){return ii.test((e&&t.currentStyle?t.currentStyle.filter:t.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":e?"1":""},set:function(t,e){var i=t.style,n=t.currentStyle,r=q.isNumeric(e)?"alpha(opacity="+100*e+")":"",o=n&&n.filter||i.filter||"";i.zoom=1,e>=1&&""===q.trim(o.replace(ei,""))&&i.removeAttribute&&(i.removeAttribute("filter"),n&&!n.filter)||(i.filter=ei.test(o)?o.replace(ei,r):o+" "+r)}}),q(function(){q.support.reliableMarginRight||(q.cssHooks.marginRight={get:function(t,e){return q.swap(t,{display:"inline-block"},function(){return e?Ke(t,"marginRight"):void 0})}}),!q.support.pixelPosition&&q.fn.position&&q.each(["top","left"],function(t,e){q.cssHooks[e]={get:function(t,i){if(i){var n=Ke(t,e);return ci.test(n)?q(t).position()[e]+"px":n}}}})}),q.expr&&q.expr.filters&&(q.expr.filters.hidden=function(t){return 0===t.offsetWidth&&0===t.offsetHeight||!q.support.reliableHiddenOffsets&&"none"===(t.style&&t.style.display||Ke(t,"display"))},q.expr.filters.visible=function(t){return!q.expr.filters.hidden(t)}),q.each({margin:"",padding:"",border:"Width"},function(t,e){q.cssHooks[t+e]={expand:function(i){var n="string"==typeof i?i.split(" "):[i],r={};for(i=0;4>i;i++)r[t+di[i]+e]=n[i]||n[i-2]||n[0];return r}},oi.test(t)||(q.cssHooks[t+e].set=T)});var fi=/%20/g,mi=/\[\]$/,gi=/\r?\n/g,yi=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,Ti=/^(?:select|textarea)/i;q.fn.extend({serialize:function(){return q.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?q.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||Ti.test(this.nodeName)||yi.test(this.type))}).map(function(t,e){var i=q(this).val();return null==i?null:q.isArray(i)?q.map(i,function(t){return{name:e.name,value:t.replace(gi,"\r\n")}}):{name:e.name,value:i.replace(gi,"\r\n")}}).get()}}),q.param=function(t,i){var n,r=[],o=function(t,e){e=q.isFunction(e)?e():null==e?"":e,r[r.length]=encodeURIComponent(t)+"="+encodeURIComponent(e)};if(i===e&&(i=q.ajaxSettings&&q.ajaxSettings.traditional),q.isArray(t)||t.jquery&&!q.isPlainObject(t))q.each(t,function(){o(this.name,this.value)});else for(n in t)x(n,t[n],i,o);return r.join("&").replace(fi,"+")};var Si,Ci,vi=/#.*$/,xi=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Ei=/^(?:GET|HEAD)$/,bi=/^\/\//,Ai=/\?/,Ri=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,Pi=/([?&])_=[^&]*/,Ii=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,wi=q.fn.load,Li={},Di={},Oi=["*/"]+["*"];try{Ci=V.href}catch(Ni){Ci=M.createElement("a"),Ci.href="",Ci=Ci.href}Si=Ii.exec(Ci.toLowerCase())||[],q.fn.load=function(t,i,n){if("string"!=typeof t&&wi)return wi.apply(this,arguments);if(!this.length)return this;var r,o,s,c=this,a=t.indexOf(" ");return a>=0&&(r=t.slice(a,t.length),t=t.slice(0,a)),q.isFunction(i)?(n=i,i=e):i&&"object"==typeof i&&(o="POST"),q.ajax({url:t,type:o,dataType:"html",data:i,complete:function(t,e){n&&c.each(n,s||[t.responseText,e,t])}}).done(function(t){s=arguments,c.html(r?q("<div>").append(t.replace(Ri,"")).find(r):t)}),this},q.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(t,e){q.fn[e]=function(t){return this.on(e,t)}}),q.each(["get","post"],function(t,i){q[i]=function(t,n,r,o){return q.isFunction(n)&&(o=o||r,r=n,n=e),q.ajax({type:i,url:t,data:n,success:r,dataType:o})}}),q.extend({getScript:function(t,i){return q.get(t,e,i,"script")},getJSON:function(t,e,i){return q.get(t,e,i,"json")},ajaxSetup:function(t,e){return e?A(t,q.ajaxSettings):(e=t,t=q.ajaxSettings),A(t,e),t},ajaxSettings:{url:Ci,isLocal:/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/.test(Si[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":Oi},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":t.String,"text html":!0,"text json":q.parseJSON,"text xml":q.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:E(Li),ajaxTransport:E(Di),ajax:function(t,i){function n(t,i,n,s){var l,u,y,T,C,x=i;if(2!==S){if(S=2,a&&clearTimeout(a),c=e,o=s||"",v.readyState=t>0?4:0,n){T=d,s=v;var E,b,A,R,P=T.contents,I=T.dataTypes,w=T.responseFields;for(b in w)b in n&&(s[w[b]]=n[b]);for(;"*"===I[0];)I.shift(),E===e&&(E=T.mimeType||s.getResponseHeader("content-type"));if(E)for(b in P)if(P[b]&&P[b].test(E)){I.unshift(b);break}if(I[0]in n)A=I[0];else{for(b in n){if(!I[0]||T.converters[b+" "+I[0]]){A=b;break}R||(R=b)}A=A||R}n=A?(A!==I[0]&&I.unshift(A),n[A]):void 0,T=n}if(t>=200&&300>t||304===t)if(d.ifModified&&(C=v.getResponseHeader("Last-Modified"),C&&(q.lastModified[r]=C),C=v.getResponseHeader("Etag"),C&&(q.etag[r]=C)),304===t)x="notmodified",l=!0;else{var L;t:{l=d,u=T;var D,x=l.dataTypes.slice();if(n=x[0],E={},b=0,l.dataFilter&&(u=l.dataFilter(u,l.dataType)),x[1])for(L in l.converters)E[L.toLowerCase()]=l.converters[L];for(;y=x[++b];)if("*"!==y){if("*"!==n&&n!==y){if(L=E[n+" "+y]||E["* "+y],!L)for(D in E)if(C=D.split(" "),C[1]===y&&(L=E[n+" "+C[0]]||E["* "+C[0]])){!0===L?L=E[D]:!0!==E[D]&&(y=C[0],x.splice(b--,0,y));break}if(!0!==L)if(L&&l["throws"])u=L(u);else try{u=L(u)}catch(O){L={state:"parsererror",error:L?O:"No conversion from "+n+" to "+y};break t}}n=y}L={state:"success",data:u}}l=L,x=l.state,u=l.data,y=l.error,l=!y}else y=x,(!x||t)&&(x="error",0>t&&(t=0));v.status=t,v.statusText=(i||x)+"",l?f.resolveWith(_,[u,x,v]):f.rejectWith(_,[v,x,y]),v.statusCode(g),g=e,h&&p.trigger("ajax"+(l?"Success":"Error"),[v,d,l?u:y]),m.fireWith(_,[v,x]),h&&(p.trigger("ajaxComplete",[v,d]),--q.active||q.event.trigger("ajaxStop"))}}"object"==typeof t&&(i=t,t=e),i=i||{};var r,o,s,c,a,l,h,u,d=q.ajaxSetup({},i),_=d.context||d,p=_!==d&&(_.nodeType||_ instanceof q)?q(_):q.event,f=q.Deferred(),m=q.Callbacks("once memory"),g=d.statusCode||{},y={},T={},S=0,C="canceled",v={readyState:0,setRequestHeader:function(t,e){if(!S){var i=t.toLowerCase();t=T[i]=T[i]||t,y[t]=e}return this},getAllResponseHeaders:function(){return 2===S?o:null},getResponseHeader:function(t){var i;if(2===S){if(!s)for(s={};i=xi.exec(o);)s[i[1].toLowerCase()]=i[2];i=s[t.toLowerCase()]}return i===e?null:i},overrideMimeType:function(t){return S||(d.mimeType=t),this},abort:function(t){return t=t||C,c&&c.abort(t),n(0,t),this}};if(f.promise(v),v.success=v.done,v.error=v.fail,v.complete=m.add,v.statusCode=function(t){if(t){var e;if(2>S)for(e in t)g[e]=[g[e],t[e]];else e=t[v.status],v.always(e)}return this},d.url=((t||d.url)+"").replace(vi,"").replace(bi,Si[1]+"//"),d.dataTypes=q.trim(d.dataType||"*").toLowerCase().split(Q),null==d.crossDomain&&(l=Ii.exec(d.url.toLowerCase()),d.crossDomain=!(!l||l[1]===Si[1]&&l[2]===Si[2]&&(l[3]||("http:"===l[1]?80:443))==(Si[3]||("http:"===Si[1]?80:443)))),d.data&&d.processData&&"string"!=typeof d.data&&(d.data=q.param(d.data,d.traditional)),b(Li,d,i,v),2===S)return v;if(h=d.global,d.type=d.type.toUpperCase(),d.hasContent=!Ei.test(d.type),h&&0===q.active++&&q.event.trigger("ajaxStart"),!d.hasContent&&(d.data&&(d.url+=(Ai.test(d.url)?"&":"?")+d.data,delete d.data),r=d.url,!1===d.cache)){l=q.now();var x=d.url.replace(Pi,"$1_="+l);d.url=x+(x===d.url?(Ai.test(d.url)?"&":"?")+"_="+l:"")}(d.data&&d.hasContent&&!1!==d.contentType||i.contentType)&&v.setRequestHeader("Content-Type",d.contentType),d.ifModified&&(r=r||d.url,q.lastModified[r]&&v.setRequestHeader("If-Modified-Since",q.lastModified[r]),q.etag[r]&&v.setRequestHeader("If-None-Match",q.etag[r])),v.setRequestHeader("Accept",d.dataTypes[0]&&d.accepts[d.dataTypes[0]]?d.accepts[d.dataTypes[0]]+("*"!==d.dataTypes[0]?", "+Oi+"; q=0.01":""):d.accepts["*"]);for(u in d.headers)v.setRequestHeader(u,d.headers[u]);if(!d.beforeSend||!1!==d.beforeSend.call(_,v,d)&&2!==S){C="abort";for(u in{success:1,error:1,complete:1})v[u](d[u]);if(c=b(Di,d,i,v)){v.readyState=1,h&&p.trigger("ajaxSend",[v,d]),d.async&&0<d.timeout&&(a=setTimeout(function(){v.abort("timeout")},d.timeout));try{S=1,c.send(y,n)}catch(E){if(!(2>S))throw E;n(-1,E)}}else n(-1,"No Transport");return v}return v.abort()},active:0,lastModified:{},etag:{}});var Bi=[],Fi=/\?/,Mi=/(=)\?(?=&|$)|\?\?/,Vi=q.now();q.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var t=Bi.pop()||q.expando+"_"+Vi++;return this[t]=!0,t}}),q.ajaxPrefilter("json jsonp",function(i,n,r){var o,s,c,a=i.data,l=i.url,h=!1!==i.jsonp,u=h&&Mi.test(l),d=h&&!u&&"string"==typeof a&&!(i.contentType||"").indexOf("application/x-www-form-urlencoded")&&Mi.test(a);return"jsonp"===i.dataTypes[0]||u||d?(o=i.jsonpCallback=q.isFunction(i.jsonpCallback)?i.jsonpCallback():i.jsonpCallback,s=t[o],u?i.url=l.replace(Mi,"$1"+o):d?i.data=a.replace(Mi,"$1"+o):h&&(i.url+=(Fi.test(l)?"&":"?")+i.jsonp+"="+o),i.converters["script json"]=function(){return c||q.error(o+" was not called"),c[0]},i.dataTypes[0]="json",t[o]=function(){c=arguments},r.always(function(){t[o]=s,i[o]&&(i.jsonpCallback=n.jsonpCallback,Bi.push(o)),c&&q.isFunction(s)&&s(c[0]),c=s=e}),"script"):void 0}),q.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(t){return q.globalEval(t),t}}}),q.ajaxPrefilter("script",function(t){t.cache===e&&(t.cache=!1),t.crossDomain&&(t.type="GET",t.global=!1)}),q.ajaxTransport("script",function(t){if(t.crossDomain){var i,n=M.head||M.getElementsByTagName("head")[0]||M.documentElement;return{send:function(r,o){i=M.createElement("script"),i.async="async",t.scriptCharset&&(i.charset=t.scriptCharset),i.src=t.url,i.onload=i.onreadystatechange=function(t,r){(r||!i.readyState||/loaded|complete/.test(i.readyState))&&(i.onload=i.onreadystatechange=null,n&&i.parentNode&&n.removeChild(i),i=e,r||o(200,"success"))},n.insertBefore(i,n.firstChild)},abort:function(){i&&i.onload(0,1)}}}});var ki,Wi=t.ActiveXObject?function(){for(var t in ki)ki[t](0,1)}:!1,Gi=0;q.ajaxSettings.xhr=t.ActiveXObject?function(){var e;if(!(e=!this.isLocal&&R()))t:{try{e=new t.ActiveXObject("Microsoft.XMLHTTP");break t}catch(i){}e=void 0}return e}:R,function(t){q.extend(q.support,{ajax:!!t,cors:!!t&&"withCredentials"in t})}(q.ajaxSettings.xhr()),q.support.ajax&&q.ajaxTransport(function(i){if(!i.crossDomain||q.support.cors){var n;return{send:function(r,o){var s,c,a=i.xhr();if(i.username?a.open(i.type,i.url,i.async,i.username,i.password):a.open(i.type,i.url,i.async),i.xhrFields)for(c in i.xhrFields)a[c]=i.xhrFields[c];i.mimeType&&a.overrideMimeType&&a.overrideMimeType(i.mimeType),i.crossDomain||r["X-Requested-With"]||(r["X-Requested-With"]="XMLHttpRequest");try{for(c in r)a.setRequestHeader(c,r[c])}catch(l){}a.send(i.hasContent&&i.data||null),n=function(t,r){var c,l,h,u,d;try{if(n&&(r||4===a.readyState))if(n=e,s&&(a.onreadystatechange=q.noop,Wi&&delete ki[s]),r)4!==a.readyState&&a.abort();else{c=a.status,h=a.getAllResponseHeaders(),u={},(d=a.responseXML)&&d.documentElement&&(u.xml=d);try{u.text=a.responseText}catch(_){}try{l=a.statusText}catch(p){l=""}c||!i.isLocal||i.crossDomain?1223===c&&(c=204):c=u.text?200:404}}catch(f){r||o(-1,f)}u&&o(c,l,u,h)},i.async?4===a.readyState?setTimeout(n,0):(s=++Gi,Wi&&(ki||(ki={},q(t).unload(Wi)),ki[s]=n),a.onreadystatechange=n):n()},abort:function(){n&&n(0,1)}}}});var zi,Ui,Yi=/^(?:toggle|show|hide)$/,Xi=RegExp("^(?:([-+])=|)("+J+")([a-z%]*)$","i"),Hi=/queueHooks$/,ji=[function(t,e,i){var n,r,o,s,c,a,l=this,h=t.style,u={},d=[],_=t.nodeType&&g(t);i.queue||(c=q._queueHooks(t,"fx"),null==c.unqueued&&(c.unqueued=0,a=c.empty.fire,c.empty.fire=function(){c.unqueued||a()}),c.unqueued++,l.always(function(){l.always(function(){c.unqueued--,q.queue(t,"fx").length||c.empty.fire()})})),1===t.nodeType&&("height"in e||"width"in e)&&(i.overflow=[h.overflow,h.overflowX,h.overflowY],"inline"===q.css(t,"display")&&"none"===q.css(t,"float")&&(q.support.inlineBlockNeedsLayout&&"inline"!==v(t.nodeName)?h.zoom=1:h.display="inline-block")),i.overflow&&(h.overflow="hidden",q.support.shrinkWrapBlocks||l.done(function(){h.overflow=i.overflow[0],h.overflowX=i.overflow[1],h.overflowY=i.overflow[2]}));for(n in e)o=e[n],Yi.exec(o)&&(delete e[n],r=r||"toggle"===o,o!==(_?"hide":"show")&&d.push(n));if(e=d.length)for((o=q._data(t,"fxshow")||q._data(t,"fxshow",{}),"hidden"in o&&(_=o.hidden),r&&(o.hidden=!_),_?q(t).show():l.done(function(){q(t).hide()}),l.done(function(){var e;q.removeData(t,"fxshow",!0);for(e in u)q.style(t,e,u[e])}),n=0);e>n;n++)r=d[n],s=l.createTween(r,_?o[r]:0),u[r]=o[r]||q.style(t,r),r in o||(o[r]=s.start,_&&(s.end=s.start,s.start="width"===r||"height"===r?1:0))}],qi={"*":[function(t,e){var i,n,r=this.createTween(t,e),o=Xi.exec(e),s=r.cur(),c=+s||0,a=1,l=20;
if(o){if(i=+o[2],n=o[3]||(q.cssNumber[t]?"":"px"),"px"!==n&&c){c=q.css(r.elem,t,!0)||i||1;do a=a||".5",c/=a,q.style(r.elem,t,c+n);while(a!==(a=r.cur()/s)&&1!==a&&--l)}r.unit=n,r.start=c,r.end=o[1]?c+(o[1]+1)*i:i}return r}]};q.Animation=q.extend(w,{tweener:function(t,e){q.isFunction(t)?(e=t,t=["*"]):t=t.split(" ");for(var i,n=0,r=t.length;r>n;n++)i=t[n],qi[i]=qi[i]||[],qi[i].unshift(e)},prefilter:function(t,e){e?ji.unshift(t):ji.push(t)}}),q.Tween=D,D.prototype={constructor:D,init:function(t,e,i,n,r,o){this.elem=t,this.prop=i,this.easing=r||"swing",this.options=e,this.start=this.now=this.cur(),this.end=n,this.unit=o||(q.cssNumber[i]?"":"px")},cur:function(){var t=D.propHooks[this.prop];return t&&t.get?t.get(this):D.propHooks._default.get(this)},run:function(t){var e,i=D.propHooks[this.prop];return this.pos=e=this.options.duration?q.easing[this.easing](t,this.options.duration*t,0,1,this.options.duration):t,this.now=(this.end-this.start)*e+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),i&&i.set?i.set(this):D.propHooks._default.set(this),this}},D.prototype.init.prototype=D.prototype,D.propHooks={_default:{get:function(t){var e;return null==t.elem[t.prop]||t.elem.style&&null!=t.elem.style[t.prop]?(e=q.css(t.elem,t.prop,!1,""),e&&"auto"!==e?e:0):t.elem[t.prop]},set:function(t){q.fx.step[t.prop]?q.fx.step[t.prop](t):t.elem.style&&(null!=t.elem.style[q.cssProps[t.prop]]||q.cssHooks[t.prop])?q.style(t.elem,t.prop,t.now+t.unit):t.elem[t.prop]=t.now}}},D.propHooks.scrollTop=D.propHooks.scrollLeft={set:function(t){t.elem.nodeType&&t.elem.parentNode&&(t.elem[t.prop]=t.now)}},q.each(["toggle","show","hide"],function(t,e){var i=q.fn[e];q.fn[e]=function(n,r,o){return null==n||"boolean"==typeof n||!t&&q.isFunction(n)&&q.isFunction(r)?i.apply(this,arguments):this.animate(O(e,!0),n,r,o)}}),q.fn.extend({fadeTo:function(t,e,i,n){return this.filter(g).css("opacity",0).show().end().animate({opacity:e},t,i,n)},animate:function(t,e,i,n){var r=q.isEmptyObject(t),o=q.speed(e,i,n);return e=function(){var e=w(this,q.extend({},t),o);r&&e.stop(!0)},r||!1===o.queue?this.each(e):this.queue(o.queue,e)},stop:function(t,i,n){var r=function(t){var e=t.stop;delete t.stop,e(n)};return"string"!=typeof t&&(n=i,i=t,t=e),i&&!1!==t&&this.queue(t||"fx",[]),this.each(function(){var e=!0,i=null!=t&&t+"queueHooks",o=q.timers,s=q._data(this);if(i)s[i]&&s[i].stop&&r(s[i]);else for(i in s)s[i]&&s[i].stop&&Hi.test(i)&&r(s[i]);for(i=o.length;i--;)o[i].elem!==this||null!=t&&o[i].queue!==t||(o[i].anim.stop(n),e=!1,o.splice(i,1));!e&&n||q.dequeue(this,t)})}}),q.each({slideDown:O("show"),slideUp:O("hide"),slideToggle:O("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(t,e){q.fn[t]=function(t,i,n){return this.animate(e,t,i,n)}}),q.speed=function(t,e,i){var n=t&&"object"==typeof t?q.extend({},t):{complete:i||!i&&e||q.isFunction(t)&&t,duration:t,easing:i&&e||e&&!q.isFunction(e)&&e};return n.duration=q.fx.off?0:"number"==typeof n.duration?n.duration:n.duration in q.fx.speeds?q.fx.speeds[n.duration]:q.fx.speeds._default,(null==n.queue||!0===n.queue)&&(n.queue="fx"),n.old=n.complete,n.complete=function(){q.isFunction(n.old)&&n.old.call(this),n.queue&&q.dequeue(this,n.queue)},n},q.easing={linear:function(t){return t},swing:function(t){return.5-Math.cos(t*Math.PI)/2}},q.timers=[],q.fx=D.prototype.init,q.fx.tick=function(){var t,i=q.timers,n=0;for(zi=q.now();n<i.length;n++)t=i[n],!t()&&i[n]===t&&i.splice(n--,1);i.length||q.fx.stop(),zi=e},q.fx.timer=function(t){t()&&q.timers.push(t)&&!Ui&&(Ui=setInterval(q.fx.tick,q.fx.interval))},q.fx.interval=13,q.fx.stop=function(){clearInterval(Ui),Ui=null},q.fx.speeds={slow:600,fast:200,_default:400},q.fx.step={},q.expr&&q.expr.filters&&(q.expr.filters.animated=function(t){return q.grep(q.timers,function(e){return t===e.elem}).length});var Ji=/^(?:body|html)$/i;q.fn.offset=function(t){if(arguments.length)return t===e?this:this.each(function(e){q.offset.setOffset(this,t,e)});var i,n,r,o,s,c,a,l={top:0,left:0},h=this[0],u=h&&h.ownerDocument;return u?(n=u.body)===h?q.offset.bodyOffset(h):(i=u.documentElement,q.contains(i,h)?("undefined"!=typeof h.getBoundingClientRect&&(l=h.getBoundingClientRect()),r=N(u),o=i.clientTop||n.clientTop||0,s=i.clientLeft||n.clientLeft||0,c=r.pageYOffset||i.scrollTop,a=r.pageXOffset||i.scrollLeft,{top:l.top+c-o,left:l.left+a-s}):l):void 0},q.offset={bodyOffset:function(t){var e=t.offsetTop,i=t.offsetLeft;return q.support.doesNotIncludeMarginInBodyOffset&&(e+=parseFloat(q.css(t,"marginTop"))||0,i+=parseFloat(q.css(t,"marginLeft"))||0),{top:e,left:i}},setOffset:function(t,e,i){var n=q.css(t,"position");"static"===n&&(t.style.position="relative");var r,o,s=q(t),c=s.offset(),a=q.css(t,"top"),l=q.css(t,"left"),h={},u={};("absolute"===n||"fixed"===n)&&-1<q.inArray("auto",[a,l])?(u=s.position(),r=u.top,o=u.left):(r=parseFloat(a)||0,o=parseFloat(l)||0),q.isFunction(e)&&(e=e.call(t,i,c)),null!=e.top&&(h.top=e.top-c.top+r),null!=e.left&&(h.left=e.left-c.left+o),"using"in e?e.using.call(t,h):s.css(h)}},q.fn.extend({position:function(){if(this[0]){var t=this[0],e=this.offsetParent(),i=this.offset(),n=Ji.test(e[0].nodeName)?{top:0,left:0}:e.offset();return i.top-=parseFloat(q.css(t,"marginTop"))||0,i.left-=parseFloat(q.css(t,"marginLeft"))||0,n.top+=parseFloat(q.css(e[0],"borderTopWidth"))||0,n.left+=parseFloat(q.css(e[0],"borderLeftWidth"))||0,{top:i.top-n.top,left:i.left-n.left}}},offsetParent:function(){return this.map(function(){for(var t=this.offsetParent||M.body;t&&!Ji.test(t.nodeName)&&"static"===q.css(t,"position");)t=t.offsetParent;return t||M.body})}}),q.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,i){var n=/Y/.test(i);q.fn[t]=function(r){return q.access(this,function(t,r,o){var s=N(t);return o===e?s?i in s?s[i]:s.document.documentElement[r]:t[r]:void(s?s.scrollTo(n?q(s).scrollLeft():o,n?o:q(s).scrollTop()):t[r]=o)},t,r,arguments.length,null)}}),q.each({Height:"height",Width:"width"},function(t,i){q.each({padding:"inner"+t,content:i,"":"outer"+t},function(n,r){q.fn[r]=function(r,o){var s=arguments.length&&(n||"boolean"!=typeof r),c=n||(!0===r||!0===o?"margin":"border");return q.access(this,function(i,n,r){var o;return q.isWindow(i)?i.document.documentElement["client"+t]:9===i.nodeType?(o=i.documentElement,Math.max(i.body["scroll"+t],o["scroll"+t],i.body["offset"+t],o["offset"+t],o["client"+t])):r===e?q.css(i,n,r,c):q.style(i,n,r,c)},i,s?r:e,s,null)}})}),t.jQuery=t.$=q,"function"==typeof define&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return q})}(window);